{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "0961d4d9-6c59-45b6-9f74-72db4895bc7b",
            "version": "KqlParameterItem/1.0",
            "name": "Resource",
            "type": 5,
            "isRequired": true,
            "typeSettings": {
              "resourceTypeFilter": {
                "microsoft.insights/components": true
              },
              "additionalResourceOptions": [
                "value::1"
              ],
              "showDefault": false
            },
            "defaultValue": "value::1"
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.insights/components"
      },
      "name": "Resource Parameters"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "495f4050-6f47-4117-a855-427ef18dc154",
            "version": "KqlParameterItem/1.0",
            "name": "Time",
            "type": 2,
            "isRequired": true,
            "query": "let Table=datatable(value:timespan, text:string, item_order:long)[\r\n24h, 'Last 24 hours', 1,\r\n3d, 'Last 3 days', 2,\r\n7d, 'Last 7 days', 3,\r\n30d, 'Last 30 days', 4,\r\n60d, 'Last 60 days', 5,\r\n90d, 'Last 90 days', 5,\r\n];\r\nlet View_1 = view () { print value=startofmonth(now()), text=\"This calendar month\", item_order=6};\r\nlet View_2 = view () { print value=startofmonth(datetime_add(\"month\", -1, now())), text=\"Last 2 calendar months\", item_order=7};\r\nlet View_3 = view () { print value=startofmonth(datetime_add(\"month\", -2, now())), text=\"Last 3 calendar months\", item_order=8};\r\nlet View_6 = view () { print value=startofmonth(datetime_add(\"month\", -6, now())), text=\"Last 6 calendar months\", item_order=9};\r\nlet View_13 = view () { print value=startofmonth(datetime_add(\"month\", -13, now())), text=\"Last 13 calendar months\", item_order=10};\r\nTable\r\n| project value=now() - value, text, item_order\r\n| union View_1, View_2, View_3, View_6, View_13\r\n| order by item_order asc\r\n| project value, text",
           "value": "2021-06-01T00:00:00Z",
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 0,
            "resourceType": "microsoft.insights/components"
          },
          {
            "id": "9e1d8606-09ba-4754-8321-330814617d16",
            "version": "KqlParameterItem/1.0",
            "name": "ConversionScope",
            "type": 2,
            "description": "Select Authenticated Users (most accurate) if user_AuthenticatedId is available. Otherwise, select Anonymous Users (least accurate) based on anonymous user_Id.",
            "isRequired": true,
            "query": "datatable(key:string, display:string)\r\n[\r\n\"user_Id\", \"Anonymous Users\", \r\n\"user_AuthenticatedId\", \"Authenticated Users\",\r\n]",
            "value": "user_AuthenticatedId",
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "queryType": 0,
            "resourceType": "microsoft.insights/components"
          },
          {
            "id": "da97155d-2a5d-4bb5-a404-bbac696e48c7",
            "version": "KqlParameterItem/1.0",
            "name": "Country",
            "type": 2,
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "union pageViews, customEvents\r\n| summarize by client_CountryOrRegion\r\n| where isnotempty(client_CountryOrRegion)\r\n| project value=client_CountryOrRegion, label=client_CountryOrRegion, r=1\r\n| union (\r\ndatatable(value:string, label:string, r:long)[\r\n\"*\", \"All Countries\", 0\r\n])\r\n| order by r asc, label asc\r\n| project value, label",
            "value": [
              "*"
            ],
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "queryType": 0,
            "resourceType": "microsoft.insights/components"
          },
          {
            "id": "6ffd17a5-c99f-4023-933f-bed2fb80797d",
            "version": "KqlParameterItem/1.0",
            "name": "OS",
            "label": "Operating System",
            "type": 2,
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "union pageViews, customEvents\r\n| summarize by client_OS\r\n| where isnotempty(client_OS)\r\n| project value=client_OS, label=client_OS, r=1\r\n| union (\r\ndatatable(value:string, label:string, r:long)[\r\n\"*\", \"All Operating Systems\", 0\r\n])\r\n| order by r asc, label asc\r\n| project value, label",
            "value": [
              "*"
            ],
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "queryType": 0,
            "resourceType": "microsoft.insights/components"
          },
          {
            "id": "09eab8d5-23a9-43e8-8496-0405c2e457ce",
            "version": "KqlParameterItem/1.0",
            "name": "Browser",
            "type": 2,
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "union pageViews, customEvents\r\n| summarize by client_Browser, group=tostring(split(client_Browser, \" \", 0)[0])\r\n| where isnotempty(client_Browser)\r\n| project value=client_Browser, label=client_Browser, group=tostring(split(client_Browser, \" \", 0)[0]), r=1, selected=false\r\n| union (\r\ndatatable(value:string, label:string, group:string, selected: bool, r:long)[\r\n\"*\", \"All Browsers\", \"All\", true, 0\r\n])\r\n| order by r asc, label asc\r\n| project value, label, group, selected",
            "value": [
              "*"
            ],
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "defaultValue": "value::1",
            "queryType": 0,
            "resourceType": "microsoft.insights/components"
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.insights/components"
      },
      "name": "Workbook Parameters"
    },
    {
      "type": 1,
      "content": {
        "json": "# No Resource is selected. Please select a value from the Resource parameter.\r\n",
        "style": "error"
      },
      "conditionalVisibility": {
        "parameterName": "Resource",
        "comparison": "isEqualTo"
      },
      "name": "Resource Parameter Missing"
    },
    {
      "type": 1,
      "content": {
        "json": "# No Time is selected. Please select a value from the Time parameter.\r\n",
        "style": "error"
      },
      "conditionalVisibility": {
        "parameterName": "Time",
        "comparison": "isEqualTo"
      },
      "name": "Time Parameter Missing"
    },
    {
      "type": 1,
      "content": {
        "json": "# No ConversionScope is selected. Please select a value from the ConversionScope parameter.\r\n",
        "style": "error"
      },
      "conditionalVisibility": {
        "parameterName": "ConversionScope",
        "comparison": "isEqualTo"
      },
      "name": "ConversionScope Parameter Missing"
    },
    {
      "type": 1,
      "content": {
        "json": "# No Country is selected. Please select a value from the Country parameter.\r\n",
        "style": "error"
      },
      "conditionalVisibility": {
        "parameterName": "Country",
        "comparison": "isEqualTo"
      },
      "name": "Country Parameter Missing"
    },
    {
      "type": 1,
      "content": {
        "json": "# No Operating System is selected. Please select a value from the Operating System parameter.\r\n",
        "style": "error"
      },
      "conditionalVisibility": {
        "parameterName": "OS",
        "comparison": "isEqualTo"
      },
      "name": "OS Parameter Missing"
    },
    {
      "type": 1,
      "content": {
        "json": "# No Browser is selected. Please select a value from the Browser parameter.\r\n",
        "style": "error"
      },
      "conditionalVisibility": {
        "parameterName": "Browser",
        "comparison": "isEqualTo"
      },
      "name": "Browser Parameter Missing"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "links": [
          {
            "id": "ce75a159-b005-424e-ac71-bff10eed3b97",
            "cellValue": "Tab",
            "linkTarget": "parameter",
            "linkLabel": "Summary",
            "subTarget": "HEART Overview",
            "style": "link"
          },
          {
            "id": "27dab657-c150-47c5-8a5f-b73b0d1dc928",
            "cellValue": "Tab",
            "linkTarget": "parameter",
            "linkLabel": "Adoption",
            "subTarget": "Adoption",
            "style": "link"
          },
          {
            "id": "6e195d77-85b7-4889-a32c-86895244e337",
            "cellValue": "Tab",
            "linkTarget": "parameter",
            "linkLabel": "Engagement",
            "subTarget": "Engagement",
            "style": "link"
          },
          {
            "id": "574c36fc-3aa9-44e9-8f1b-0c44728ee02d",
            "cellValue": "Tab",
            "linkTarget": "parameter",
            "linkLabel": "Retention",
            "subTarget": "Retention",
            "style": "link"
          },
          {
            "id": "76c92d09-38fa-42c1-877a-9d73ce5a435c",
            "cellValue": "Tab",
            "linkTarget": "parameter",
            "linkLabel": "Task Success",
            "subTarget": "Task Success",
            "style": "link"
          },
          {
            "id": "f21fcfe2-7dfa-4ac0-92bf-c637a4545921",
            "cellValue": "Tab",
            "linkTarget": "parameter",
            "linkLabel": "Happiness",
            "subTarget": "Happiness",
            "style": "link"
          },
          {
            "id": "8b97dc75-0ecc-45e8-aa11-675cd1697888",
            "cellValue": "Tab",
            "linkTarget": "parameter",
            "linkLabel": "Feature Metrics",
            "subTarget": "Feature",
            "style": "link"
          },
          {
            "id": "3a770d7b-f7cc-4f67-8f88-595d7aef489b",
            "cellValue": "Tab",
            "linkTarget": "parameter",
            "linkLabel": "Development Requirements",
            "subTarget": "Technical",
            "style": "link"
          }
        ]
      },
      "name": "Tabs"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Overview",
        "expandable": true,
        "expanded": true,
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# HEART \n---\nA product analytics framework, introduced by Google, that enables holistic measurement of a user experience by focusing on 5 dimensions captured through telemetry.\n\nThe 5 dimensions of HEART enable measurement of **H**appiness, **E**ngagement, **A**doption, **R**etention & **T**ask Success.\n\nAdoption, Engagement, and Retention form a user activity funnel: Adoption -> Engagement -> Retention. Some users will load the application (**Adoption**). A subset of those users will then choose to click on a component within the app, such as a button (**Engagement**). Some of the users active in the application will choose to return (**Retention**). Completing **tasks successfully** drives users down this funnel: users will choose to come back to the application if they are productive in the application. Finally, **Happiness** is the outcome of the other 4 dimensions. A product owner can measure how effectively the product converts adopted users to retained users with Happiness: users who progress down the Adoption -> Engagement -> Retention funnel and complete tasks successfully will show higher satisfaction.\n\n\nThe HEART Framework uses the [Click Analytics plugin for Application Insights](https://docs.microsoft.com/en-us/azure/azure-monitor/app/javascript-click-analytics-plugin). To calculate HEART Metrics, **the Click Analytics plugin must be implemented in the application.** Visit the **Development Requirements** tab to learn more about telemetry implementation."
            },
            "customWidth": "100",
            "conditionalVisibility": {
              "parameterName": "Tab",
              "comparison": "isEqualTo",
              "value": "HEART Overview"
            },
            "name": "Overview"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "HEART Overview"
      },
      "name": "HEART Summary Title"
    },
    {
      "type": 1,
      "content": {
        "json": "## HEART Metrics: User Activity Funnel\r\n---\r\nThe below KPIs represent a subset of HEART Metrics. These visuals describe the user activity funnel: Adoption -> Engagement -> Retention.\r\n\r\n"
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "HEART Overview"
      },
      "name": "HEART Metrics Title"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "8940997a-18f0-4050-927d-913c85c76182",
            "version": "KqlParameterItem/1.0",
            "name": "DateGrain",
            "label": "Date Grain",
            "type": 2,
            "isRequired": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[{\r\n\t\"value\": \"{\\\"date_start\\\": \\\"startofmonth(timestamp)\\\", \\\"date_label\\\": \\\"format_datetime(timestamp, \\\\\\\"yyyy-MM\\\\\\\")\\\", \\\"date_name\\\": \\\"\\\\\\\"month\\\\\\\"\\\", \\\"date_l1\\\": \\\"startofmonth(timestamp)\\\",  \\\"date_l1_label\\\": \\\"\\\\\\\"Month\\\\\\\"\\\", \\\"date_l2\\\": \\\"startofday(timestamp)\\\", \\\"date_l2_label\\\": \\\"\\\\\\\"Day\\\\\\\"\\\", \\\"date_l1_label_short\\\": \\\"\\\\\\\"M\\\\\\\"\\\", \\\"date_l2_label_short\\\": \\\"\\\\\\\"D\\\\\\\"\\\", \\\"date_name_short\\\": \\\"\\\\\\\"M\\\\\\\"\\\"}\",\r\n\t\"label\": \"Monthly\",\r\n    \"selected\": true\r\n},\r\n{\r\n\t\"value\": \"{\\\"date_start\\\": \\\"startofweek(timestamp)\\\", \\\"date_label\\\": \\\"startofweek(timestamp)\\\", \\\"date_name\\\": \\\"\\\\\\\"week\\\\\\\"\\\", \\\"date_l1\\\": \\\"startofmonth(timestamp)\\\", \\\"date_l1_label\\\": \\\"\\\\\\\"Month\\\\\\\"\\\", \\\"date_l2\\\": \\\"startofweek(timestamp)\\\", \\\"date_l2_label\\\": \\\"\\\\\\\"Week\\\\\\\"\\\", \\\"date_l1_label_short\\\": \\\"\\\\\\\"M\\\\\\\"\\\", \\\"date_l2_label_short\\\": \\\"\\\\\\\"W\\\\\\\"\\\", \\\"date_name_short\\\": \\\"\\\\\\\"W\\\\\\\"\\\"}\",\r\n\t\"label\": \"Weekly\",\r\n    \"selected\": false\r\n},\r\n{\r\n\t\"value\": \"{\\\"date_start\\\": \\\"startofday(timestamp)\\\", \\\"date_label\\\": \\\"startofday(timestamp)\\\", \\\"date_name\\\": \\\"\\\\\\\"day\\\\\\\"\\\", \\\"date_l1\\\": \\\"startofweek(timestamp)\\\", \\\"date_l1_label\\\": \\\"\\\\\\\"Week\\\\\\\"\\\", \\\"date_l2\\\": \\\"startofday(timestamp)\\\", \\\"date_l2_label\\\": \\\"\\\\\\\"Day\\\\\\\"\\\", \\\"date_l1_label_short\\\": \\\"\\\\\\\"W\\\\\\\"\\\", \\\"date_l2_label_short\\\": \\\"\\\\\\\"D\\\\\\\"\\\", \\\"date_name_short\\\": \\\"\\\\\\\"D\\\\\\\"\\\"}\",\r\n\t\"label\": \"Daily\",\r\n    \"selected\": false\r\n}]",
            "timeContext": {
              "durationMs": 86400000
            }
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.insights/components"
      },
      "conditionalVisibilities": [
        {
          "parameterName": "Tab",
          "comparison": "isNotEqualTo",
          "value": "Technical"
        },
        {
          "parameterName": "Tab",
          "comparison": "isNotEqualTo",
          "value": "Happiness"
        }
      ],
      "name": "Date Grain"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "template",
        "loadFromTemplateId": "Workbooks/Product Analytics using the Click Analytics Plugin/HEART Analytics Section - Engagement",
        "items": []
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "Engagement"
      },
      "name": "Engagement SubTemp"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "template",
        "loadFromTemplateId": "Workbooks/Product Analytics using the Click Analytics Plugin/HEART Analytics Section - Adoption",
        "items": []
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "Adoption"
      },
      "name": "Adoption SubTemp"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "template",
        "loadFromTemplateId": "Workbooks/Product Analytics using the Click Analytics Plugin/HEART Analytics Section - Retention",
        "items": []
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "Retention"
      },
      "name": "Retention SubTemp"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "template",
        "loadFromTemplateId": "Workbooks/Product Analytics using the Click Analytics Plugin/HEART Analytics Section - Task Success",
        "items": []
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "Task Success"
      },
      "name": "Task Success SubTemp"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "### Adoption: Aware Users\r\nCount of unique users who have visited the experience."
            },
            "customWidth": "33",
            "name": "text - 8"
          },
          {
            "type": 1,
            "content": {
              "json": "### Engagement: Active Users\r\nCount of unique users who have voluntarily interacted with the experience."
            },
            "customWidth": "34",
            "name": "text - 8 - Copy"
          },
          {
            "type": 1,
            "content": {
              "json": "### Retention: Month-over-Month Retained Users\r\nCount of unique users who were active in both the current and previous time periods."
            },
            "customWidth": "33",
            "name": "Retention Title"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "union pageViews, customEvents\n| where timestamp >= todatetime(\"{Time:value}\") \n    and ( client_CountryOrRegion in ({Country}) or \"*\" in ({Country}) )\n    and ( client_OS in ({OS}) or \"*\" in ({OS}) )\n    and ( client_Browser in ({Browser}) or \"*\" in ({Browser}) )\n| summarize [\"Aware Users\"]=dcountif({ConversionScope}, isnotempty({ConversionScope})) by Month=format_datetime(timestamp, \"yyyy-MM\")\n| order by Month asc",
              "size": 1,
              "aggregation": 5,
              "queryType": 0,
              "resourceType": "microsoft.insights/components",
              "crossComponentResources": [
                "{Resource}"
              ],
              "visualization": "linechart",
              "chartSettings": {
                "group": null,
                "createOtherGroup": 0,
                "showDataPoints": true,
                "ySettings": {
                  "numberFormatSettings": {
                    "unit": 0,
                    "options": {
                      "style": "decimal",
                      "useGrouping": true
                    }
                  },
                  "min": 0
                }
              }
            },
            "customWidth": "33",
            "name": "Aware Users",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "customEvents\n| where timestamp >= todatetime(\"{Time:value}\")\n    and ( client_CountryOrRegion in ({Country}) or \"*\" in ({Country}) )\n    and ( client_OS in ({OS}) or \"*\" in ({OS}) )\n    and ( client_Browser in ({Browser}) or \"*\" in ({Browser}) )\n| summarize [\"Active Users\"]=dcountif({ConversionScope},isnotnull(customDimensions.actionType) and isnotempty({ConversionScope})) by Month=format_datetime(timestamp, \"yyyy-MM\")\n| order by Month asc",
              "size": 1,
              "aggregation": 5,
              "queryType": 0,
              "resourceType": "microsoft.insights/components",
              "crossComponentResources": [
                "{Resource}"
              ],
              "visualization": "linechart",
              "chartSettings": {
                "group": null,
                "createOtherGroup": 0,
                "showDataPoints": true,
                "ySettings": {
                  "numberFormatSettings": {
                    "unit": 0,
                    "options": {
                      "style": "decimal",
                      "useGrouping": true
                    }
                  },
                  "min": 0
                }
              }
            },
            "customWidth": "34",
            "showPin": false,
            "name": "Active Users",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let datedata = customEvents\n| where timestamp >= todatetime(\"{Time:value}\")\n;\nlet data = customEvents\n| where isnotnull(customDimensions.actionType) and isnotempty({ConversionScope})\n    and ( client_CountryOrRegion in ({Country}) or \"*\" in ({Country}) )\n    and ( client_OS in ({OS}) or \"*\" in ({OS}) )\n    and ( client_Browser in ({Browser}) or \"*\" in ({Browser}) )\n;\nlet ActiveUsersLastMonth = data\n| where isnotnull(customDimensions.actionType) and isnotempty({ConversionScope})\n| summarize by Month = endofmonth(datetime_add(\"month\", 1, timestamp)), ActiveUser = {ConversionScope}\n;\nlet Retained = data\n| summarize by Month = endofmonth(timestamp), ActiveUser = {ConversionScope}\n| join kind = inner (ActiveUsersLastMonth) on Month, ActiveUser\n| summarize RetainedUsers=dcount(ActiveUser) by Month=format_datetime(Month, \"yyyy-MM\")\n;\ndatedata\n| summarize by Month = format_datetime(timestamp, \"yyyy-MM\")\n| join kind=leftouter (Retained) on Month\n| project Month, [\"Retained Users\"]=coalesce(RetainedUsers, 0)\n| order by Month asc",
              "size": 1,
              "aggregation": 5,
              "queryType": 0,
              "resourceType": "microsoft.insights/components",
              "crossComponentResources": [
                "{Resource}"
              ],
              "visualization": "linechart",
              "chartSettings": {
                "group": null,
                "createOtherGroup": 0,
                "showDataPoints": true,
                "ySettings": {
                  "numberFormatSettings": {
                    "unit": 0,
                    "options": {
                      "style": "decimal",
                      "useGrouping": true
                    }
                  },
                  "min": 0
                }
              }
            },
            "customWidth": "33",
            "showPin": false,
            "name": "Retained Users",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "HEART Overview"
      },
      "name": "HEART Overview"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "template",
        "loadFromTemplateId": "Workbooks/Product Analytics using the Click Analytics Plugin/HEART Analytics Section - Happiness",
        "items": []
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "Happiness"
      },
      "name": "Happiness SubTemp"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "template",
        "loadFromTemplateId": "Workbooks/Product Analytics using the Click Analytics Plugin/HEART Analytics Section - Feature Drill-Down",
        "items": []
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "Feature"
      },
      "name": "Feature SubTemp"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Telemetry Requirements",
              "expandable": true,
              "expanded": true,
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "## Click Analytics for Application Insights\r\nThe HEART Framework uses the [Click Analytics plugin for Application Insights](https://docs.microsoft.com/en-us/azure/azure-monitor/app/javascript-click-analytics-plugin). To calculate HEART Metrics, the **[Click Analytics plugin for Application Insights](https://docs.microsoft.com/en-us/azure/azure-monitor/app/javascript-click-analytics-plugin) must be implemented in the application**."
                  },
                  "name": "text - 12"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "## Data Dictionary\r\nThe required attributes to calculate HEART metrics are listed below."
                  },
                  "name": "Data Dictionary Title"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "| Source          | Attribute            | Description                                |\r\n|-----------------|----------------------|--------------------------------------------|\r\n| customEvents    | user_AuthenticatedId | unique authenticated user identifier       |\r\n| customEvents    | session_Id           | unique session identifier                  |\r\n| customEvents    | appName              | unique Application Insights app identifier |\r\n| customEvents    | itemType             | category of customEvents record            |\r\n| customEvents    | timestamp            | datetime of event                          |\r\n| customEvents    | operation_Id         | correlate telemetry events                 |\r\n| customEvents    | user_Id         \t | unique user identifier                 \t  |\r\n| customEvents*   | parentId             | name of feature                            |\r\n| customEvents*   | pageName             | name of page                               |\r\n| customEvents*   | actionType           | category of Click Analytics record         |\r\n| pageViews       | user_AuthenticatedId | unique authenticated user identifier       |\r\n| pageViews       | session_Id           | unique session identifier                  |\r\n| pageViews       | appName              | unique Application Insights app identifier |\r\n| pageViews       | timestamp            | datetime of event                          |\r\n| pageViews       | operation_Id         | correlate telemetry events                 |\r\n| pageViews       | user_Id         \t | unique user identifier                     |\r\n\r\n*The [Click Analytics plugin](https://docs.microsoft.com/en-us/azure/azure-monitor/app/javascript-click-analytics-plugin) must be implemented to emit these attributes."
                  },
                  "name": "customEvents Data Dictionary"
                }
              ]
            },
            "name": "Telemetry Requirements"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Telemetry Warnings",
              "expandable": true,
              "expanded": true,
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "## Telemetry Warnings\r\nCommon data discrepancies, along with their suggestion resolutions, are listed below."
                  },
                  "name": "Telemetry Warnings Title"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let WarningCodes = datatable (Code:long, Warning:string, Resolution:string)\r\n    [0, \"No Warning\", \"None\",\r\n     1, \"⚠️ No user rows found in selected time period.\", \"Ensure telemetry is emitting user rows in the selected time period. Ensure the Click Analytics plugin for Application Insights is implemented in the application.\",\r\n     2, \"⚠️ Multiple users found in the same session.\", \"Check if telemetry is creating sessions without creating a {ConversionScope}.\",\r\n     3, \"️️️⚠️ Row(s) in customEvents with actionType value but no {ConversionScope}\", \"At least one click has been emitted without a {ConversionScope}. Check if telemetry is creating sessions without establishing a {ConversionScope}.\",\r\n     4, \"⚠️ Row(s) in customEvents with {ConversionScope} but no actionType value.\", \"Visit the Click Analytics documentation for more information about its implementation.\",\r\n     5, \"⚠️ Users with actionType items but no pageView items\", \"At least 1 user has a click event without a pageView event. Implement pageViews and Click Analytics on the same pages of the experience.\",\r\n     6, \"⚠️ ClickEvent rows with no parentId value\", \"At least 1 ClickEvent is missing a parentId value. Implement parentId to identify features within the application.\",\r\n     ]\r\n;\r\nlet data = customEvents\r\n| where timestamp >= todatetime(\"{Time}\")\r\n    and ( client_CountryOrRegion in ({Country}) or \"*\" in ({Country}) )\r\n    and ( client_OS in ({OS}) or \"*\" in ({OS}) )\r\n    and ( client_Browser in ({Browser}) or \"*\" in ({Browser}) )\r\n;\r\nlet Code1Check = data\r\n| summarize Occurrences=countif(isnotempty({ConversionScope})), Total=count()\r\n| project Code = case(Occurrences == 0, 1, 0), Occurrences, Units=\"Row(s)\", Total\r\n;\r\nlet Code2Check = data\r\n| where isnotempty({ConversionScope})\r\n| summarize UserCount=dcount({ConversionScope}) by session_Id\r\n| summarize Occurrences=countif(UserCount > 1), Total=count()\r\n| project Code = case(Occurrences > 0, 2, 0), Occurrences, Units=\"Session(s)\", Total\r\n;\r\nlet Code3Check = data\r\n| summarize Occurrences=countif(isnull(customDimensions.actionType) and isnotempty({ConversionScope})), Total=count()\r\n| project Code = case(Occurrences > 0, 3, 0), Occurrences, Units=\"Row(s)\", Total\r\n;\r\nlet Code4Check = data\r\n| summarize Occurrences=countif(isnull(customDimensions.actionType) and isnotempty({ConversionScope})), Total=count()\r\n| project Code = case(Occurrences > 0, 4, 0), Occurrences, Units=\"Row(s)\", Total\r\n;\r\nlet Code5Check = data\r\n| where isnotnull(customDimensions.actionType) and isnotempty({ConversionScope})\r\n| join kind = leftanti (pageViews | where itemType == \"pageView\" and isnotempty({ConversionScope}) | distinct {ConversionScope}) \r\non {ConversionScope}\r\n| summarize Occurrences = dcount({ConversionScope}, 4), One=1\r\n| join kind=inner (customEvents| union pageViews| summarize Total=dcount({ConversionScope}), One=1)\r\non One\r\n| project Code = case(Occurrences > 0, 5, 0), Occurrences, Units=\"User(s)\", Total\r\n;\r\nlet Code6Check = data\r\n| where isnotnull(customDimensions.actionType)\r\n| project parentId = tostring(customDimensions.parentId)\r\n| summarize Occurrences=countif(parentId == \"not_specified\" or isempty(parentId)), Total=count()\r\n| project Code = case(Occurrences > 0, 6, 0), Occurrences, Units=\"Row(s)\", Total\r\n;\r\nunion Code1Check, Code2Check, Code3Check, Code4Check, Code5Check, Code6Check\r\n| join (WarningCodes) on Code\r\n| where Code > 0\r\n| project Warning, Occurrences=strcat(Occurrences, \" \", Units), Pct = Occurrences*1.0 / Total, [\"Suggested Resolution\"] = Resolution\r\n| order by Pct desc",
                    "size": 1,
                    "noDataMessage": "Good news: no warnings found!",
                    "noDataMessageStyle": 3,
                    "queryType": 0,
                    "resourceType": "microsoft.insights/components",
                    "crossComponentResources": [
                      "{Resource}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Warning",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "60ch"
                          }
                        },
                        {
                          "columnMatch": "Pct",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "10ch"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "percent",
                              "useGrouping": false,
                              "minimumSignificantDigits": 3,
                              "maximumSignificantDigits": 3
                            }
                          }
                        },
                        {
                          "columnMatch": "Suggested Resolution",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "118ch"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "100",
                  "name": "Telemetry Warnings"
                }
              ]
            },
            "name": "Telemetry Warnings"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Data Validation",
              "expandable": true,
              "expanded": true,
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "## Data Validation\r\nThe Attribute Completion grids below display the Completion % of the required attributes for the HEART Framework. Note that **these grids only consider records with a non-empty {ConversionScope}** to disregard any user-initiated back-end events.\r\n### How do I interpret Completion%? Is 100% necessary to calculate HEART Metrics? \r\nCompletion represents the proportion of records with a value. For example, a Completion% of 25% for parentId means that 75% of records have no value. For the most informed product decisions, Completion% above 90% is recommended for each required attribute. HEART Metrics can still be calculated with a lower Completion%; however, a lower Completion% could result in HEART Metrics calculated on an unrepresentative dataset."
                  },
                  "name": "Technical Requirements Text"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let customEventsPack = customEvents \r\n| where timestamp >= todatetime(\"{Time}\")\r\n    and ( client_CountryOrRegion in ({Country}) or \"*\" in ({Country}) )\r\n    and ( client_OS in ({OS}) or \"*\" in ({OS}) )\r\n    and ( client_Browser in ({Browser}) or \"*\" in ({Browser}) )\r\n| where isnotempty({ConversionScope})\r\n| project array = pack_array(*), Dummy = 1\r\n;\r\nlet customEventsAttributes = customEvents\r\n| getschema \r\n| project ColumnName, ColumnOrdinal, Dummy = 1\r\n| join kind = inner (customEventsPack) on Dummy\r\n| project ColumnName, value = tostring(array[ColumnOrdinal])\r\n| where ColumnName in (\"user_AuthenticatedId\", \"session_Id\", \"appName\", \"itemType\", \"timestamp\", \"operation_Id\", \"user_Id\")\r\n| summarize Complete=countif(value !in (\"\", \"not_specified\")), Rows=count() by ColumnName\r\n| project Source=\"customEvents\", Implementation=\"default\", Attribute=ColumnName, Rows, Complete\r\n;\r\nlet UnpackCD = customEvents\r\n| where isnotempty(user_AuthenticatedId)\r\n| project appName, parentId = tostring(customDimensions.parentId), pageName = tostring(customDimensions.pageName), actionType = tostring(customDimensions.actionType)\r\n| summarize parentIdComp = countif(isnotempty(parentId) and parentId != \"not_specified\"), \r\npageNameComp = countif(isnotempty(pageName) and pageName != \"not_specified\"), \r\nactionTypeComp = countif(isnotempty(actionType) and actionType != \"not_specified\"),\r\nRows=count() by appName\r\n| summarize parentIdComp=max(parentIdComp), pageNameComp=max(parentIdComp), actionTypeComp=max(actionTypeComp), Rows=max(Rows)\r\n;\r\nlet ClickAnalyticsAttributes = UnpackCD\r\n| summarize Complete=max(parentIdComp) by Rows, Attribute=\"parentId\"\r\n| project Source=\"customEvents\", Implementation=\"Click Analytics\", Attribute, Rows, Complete\r\n| union\r\n(UnpackCD\r\n| summarize Complete=max(pageNameComp) by Rows, Attribute=\"pageName\"\r\n| project Source=\"customEvents\", Implementation=\"Click Analytics\", Attribute, Rows, Complete\r\n)\r\n| union\r\n(UnpackCD\r\n| summarize Complete=max(actionTypeComp) by Rows, Attribute=\"actionType\"\r\n| project Source=\"customEvents\", Implementation=\"Click Analytics\", Attribute, Rows, Complete\r\n);\r\nlet pageViewsPack = pageViews \r\n| where timestamp >= todatetime(\"{Time}\")\r\n    and ( client_CountryOrRegion in ({Country}) or \"*\" in ({Country}) )\r\n    and ( client_OS in ({OS}) or \"*\" in ({OS}) )\r\n    and ( client_Browser in ({Browser}) or \"*\" in ({Browser}) )\r\n| where isnotempty({ConversionScope})\r\n| project array = pack_array(*), Dummy = 1\r\n;\r\nlet pageViewsAttributes=pageViews\r\n| getschema \r\n| project ColumnName, ColumnOrdinal, Dummy = 1\r\n| join kind = inner (pageViewsPack) on Dummy\r\n| project ColumnName, value = tostring(array[ColumnOrdinal])\r\n| where ColumnName in (\"user_AuthenticatedId\", \"session_Id\", \"appName\", \"timestamp\", \"operation_Id\", \"user_Id\")\r\n| summarize Complete=countif(value !in (\"\", \"not_specified\")), Rows=count() by ColumnName\r\n| project Source=\"pageViews\", Implementation=\"default\", Attribute=ColumnName, Rows, Complete\r\n;\r\nunion customEventsAttributes, ClickAnalyticsAttributes, pageViewsAttributes\r\n| extend Completion = Complete * 1.0 / Rows\r\n| project Status=case(Completion >= 0.90, '✔️ Good', '⚠️ Low Completion'), Source, Implementation, Attribute, Completion=coalesce(case(isnan(Completion), 0.0, Completion ), 0.0), Complete, Rows\r\n| order by Completion asc, Source asc, Implementation asc, Attribute asc\r\n",
                    "size": 0,
                    "title": "Attribute Completion",
                    "queryType": 0,
                    "resourceType": "microsoft.insights/components",
                    "crossComponentResources": [
                      "{Resource}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Completion",
                          "formatter": 3,
                          "formatOptions": {
                            "min": 0,
                            "max": 1,
                            "palette": "blue"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "percent",
                              "minimumSignificantDigits": 2,
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "ColumnName",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "26ch"
                          }
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "Status"
                        },
                        {
                          "columnId": "Source"
                        },
                        {
                          "columnId": "Implementation"
                        },
                        {
                          "columnId": "Attribute"
                        },
                        {
                          "columnId": "Completion",
                          "label": "Completion%"
                        },
                        {
                          "columnId": "Complete"
                        },
                        {
                          "columnId": "Rows"
                        }
                      ]
                    }
                  },
                  "customWidth": "100",
                  "name": "Attribute Completion"
                }
              ]
            },
            "name": "Data Validation"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Data Retention",
              "expandable": true,
              "expanded": true,
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "## Data Retention\r\nLearn more about data retention in the [Application Insights documentation](https://docs.microsoft.com/en-us/azure/azure-monitor/app/pricing#change-the-data-retention-period). For the most informed product decisions, at least 13 months of data is recommended to consider seasonality and year-over-year growth. "
                  },
                  "name": "Data Retention"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "customEvents\r\n| summarize [\"First Record\"]=min(timestamp), [\"Most Recent Record\"]=max(timestamp) by appName\r\n| order by [\"Most Recent Record\"] desc",
                    "size": 4,
                    "queryType": 0,
                    "resourceType": "microsoft.insights/components",
                    "crossComponentResources": [
                      "{Resource}"
                    ]
                  },
                  "name": "Records"
                }
              ]
            },
            "name": "Data Retention"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "Technical"
      },
      "name": "Technical Validation"
    }
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}
