{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "e4155510-3863-4784-b5d9-531d70985e65",
                  "version": "KqlParameterItem/1.0",
                  "name": "param_ams_resource",
                  "type": 5,
                  "isHiddenWhenLocked": true,
                  "typeSettings": {
                    "resourceTypeFilter": {
                      "microsoft.hanaonazure/sapmonitors": true,
                      "microsoft.workloads/monitors": true
                    },
                    "additionalResourceOptions": [
                      "value::1"
                    ],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "defaultValue": "value::1"
                },
                {
                  "id": "3f535992-6e3e-4a63-a672-90f6d5207f90",
                  "version": "KqlParameterItem/1.0",
                  "name": "param_provider_type",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "value": "MsSqlServer"
                },
                {
                  "id": "e00a9e90-fa1a-45d9-b5c6-94ddbea2d35e",
                  "version": "KqlParameterItem/1.0",
                  "name": "param_provider_instance",
                  "type": 1,
                  "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"{param_ams_resource}/providerInstances/\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2022-11-01-preview\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value[?(@.properties.provisioningState == 'Succeeded' && @.properties.providerSettings.providerType == '{param_provider_type}')].name\",\"columns\":[]}}]}",
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 12
                },
                {
                  "id": "1fd35da6-edb1-4453-9d4f-677360a05b0a",
                  "version": "KqlParameterItem/1.0",
                  "name": "provider_table_exists",
                  "type": 1,
                  "query": "let hasNonEmptyTable = (T:string) \r\n{ \r\ntoscalar( union isfuzzy=true ( table(T) | count as Count ), (print Count=0) | summarize sum(Count) ) > 0\r\n};\r\nlet TableName = 'MSSQL_SystemProps_CL';\r\nprint present=iif(hasNonEmptyTable(TableName), \"1\", \"0\")",
                  "isHiddenWhenLocked": true,
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "be109dc4-2064-48c4-b00b-52b7a0fb00a9",
                  "version": "KqlParameterItem/1.0",
                  "name": "param_check_tables",
                  "type": 1,
                  "query": "let checktable = (tb:string, columnName:string)\r\n{\r\n// 0 = no error\r\n// 1 = table does not exist (need to enable RFC)\r\n// 2 = table exists, but column v1 does not (or) column v1 exists but no data in the table (need to wait)\r\nlet dummy = \"unmÃ¶glicher-wert!\";\r\nlet MissingTable = view () { print miss = 1, columnV1 = dummy, records = -1 };\r\nlet checkRecords =\r\n  union\r\n    isfuzzy=true MissingTable,\r\n    (table(tb)\r\n      | summarize records = count()\r\n    )\r\n  | project records\r\n  | top 1 by records desc\r\n;\r\nlet checkTableExists =\r\n  union\r\n    isfuzzy=true MissingTable,\r\n    (table(tb)\r\n      | count\r\n      | extend miss = 0\r\n    )\r\n  | project miss\r\n  | limit 2\r\n  | top 1 by miss asc\r\n;\r\nlet checkColumnExists =\r\n  union\r\n    isfuzzy=true MissingTable,\r\n    (table(tb)\r\n      | extend miss = 0\r\n      | extend columnV1 = column_ifexists(columnName, dummy)\r\n    )\r\n  | project miss, columnV1\r\n  | limit 2\r\n  | top 1 by miss asc\r\n ;\r\nlet tableExists = toscalar(checkTableExists | summarize max(miss) != 1);\r\nlet columnV1Exists = toscalar(checkColumnExists | summarize max(columnV1) != dummy);\r\nlet tableRecords = toscalar(checkRecords | summarize max(records));\r\nlet x = iif(tableExists, iif(columnV1Exists, iif(tableRecords > 0, \"0\", \"2\"), \"2\"), \"1\");\r\ntoscalar(x)\r\n};\r\nlet backup = checktable(\"MSSQL_BckBackups_CL\", \"sapsid_s\");\r\nlet errorLogs = checktable(\"MSSQL_Errorlog_CL\", \"sapsid_s\");\r\nlet blockingProcesses = checktable(\"MSSQL_BlockingProcesses_CL\", \"sapsid_s\");\r\nlet aoOverview = checktable(\"MSSQL_AOOverview_CL\", \"sapsid_s\");\r\nlet aoFailover = checktable(\"MSSQL_AOFailovers_CL\", \"sapsid_s\");\r\n\r\nprint strcat('MSSQL_BckBackups_CL:',backup,\r\n',MSSQL_Errorlog_CL:',errorLogs,\r\n',MSSQL_BlockingProcesses_CL:',blockingProcesses,\r\n',MSSQL_AOOverview_CL:',aoOverview,\r\n',MSSQL_AOFailovers_CL:',aoFailover)",
                  "isHiddenWhenLocked": true,
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "provider check parameters"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "### No active Microsoft SQL Server provider found.\r\nCreate one or more Microsoft SQL Server providers to get started. [Learn More](https://learn.microsoft.com/en-us/azure/sap/monitor/provider-sql-server)",
                    "style": "warning"
                  },
                  "name": "text - 0"
                },
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "list",
                    "links": [
                      {
                        "id": "17108865-b53f-48c3-830e-58f5a6510e4a",
                        "cellValue": "{param_ams_resource}",
                        "linkTarget": "Resource",
                        "linkLabel": "Create Provider",
                        "subTarget": "monitor_provider",
                        "preText": "",
                        "style": "primary",
                        "bladeOpenContext": {
                          "bladeName": "ManageProviderv2.ReactView",
                          "extensionName": "Microsoft_Azure_WorkloadMonitor",
                          "bladeParameters": [
                            {
                              "name": "resourceId",
                              "source": "parameter",
                              "value": "param_ams_resource"
                            }
                          ]
                        }
                      }
                    ]
                  },
                  "name": "links - 1"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "param_provider_instance",
              "comparison": "isEqualTo"
            },
            "name": "No active provider group"
          },
          {
            "type": 1,
            "content": {
              "json": "If the provider is recently added, it may take up to 15 minutes for the initial telemetry information to be available for review. Else, check if system is down, or health of AMS system is degraded.",
              "style": "warning"
            },
            "conditionalVisibilities": [
              {
                "parameterName": "param_provider_instance",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "provider_table_exists",
                "comparison": "isEqualTo",
                "value": "0"
              }
            ],
            "name": "No data exists warning"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "200ae87c-8a88-4ac7-9c0d-324ba28f82ce",
                        "version": "KqlParameterItem/1.0",
                        "name": "Days",
                        "type": 4,
                        "isRequired": true,
                        "typeSettings": {
                          "selectableValues": [
                            {
                              "durationMs": 300000
                            },
                            {
                              "durationMs": 900000
                            },
                            {
                              "durationMs": 1800000
                            },
                            {
                              "durationMs": 3600000
                            },
                            {
                              "durationMs": 14400000
                            },
                            {
                              "durationMs": 43200000
                            },
                            {
                              "durationMs": 86400000
                            },
                            {
                              "durationMs": 172800000
                            },
                            {
                              "durationMs": 259200000
                            },
                            {
                              "durationMs": 604800000
                            },
                            {
                              "durationMs": 1209600000
                            },
                            {
                              "durationMs": 2419200000
                            },
                            {
                              "durationMs": 2592000000
                            },
                            {
                              "durationMs": 5184000000
                            },
                            {
                              "durationMs": 7776000000
                            }
                          ],
                          "allowCustom": true
                        },
                        "value": {
                          "durationMs": 1800000
                        },
                        "label": "Time Range"
                      },
                      {
                        "id": "f48305a3-3cf8-4a52-9350-197ab24e682f",
                        "version": "KqlParameterItem/1.0",
                        "name": "Provider",
                        "type": 2,
                        "isRequired": true,
                        "query": "MSSQL_SystemProps_CL\r\n| project PROVIDER_INSTANCE_s\r\n| distinct PROVIDER_INSTANCE_s\r\n| serialize RANK = row_number()\r\n| project value = PROVIDER_INSTANCE_s, label = PROVIDER_INSTANCE_s, selected = iif(RANK == 1, true, false)\r\n\r\n\r\n",
                        "typeSettings": {
                          "additionalResourceOptions": [],
                          "showDefault": false
                        },
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "194fceab-3864-4b6f-8f67-4a952e56e38c",
                        "version": "KqlParameterItem/1.0",
                        "name": "Hostname",
                        "type": 1,
                        "query": "let LastOne = MSSQL_SystemProps_CL\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| summarize TimeGenerated = max(TimeGenerated)\r\n| project TimeGenerated;\r\n\r\nMSSQL_SystemProps_CL\r\n| join kind=inner (LastOne) on TimeGenerated\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| project Value_s,TimeGenerated, Setting_s, PROVIDER_INSTANCE_s\r\n| where Setting_s == \"ComputerNamePhysicalNetBIOS\" \r\n| take 1\r\n",
                        "isHiddenWhenLocked": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "b3f90b4f-5de8-4c9d-bfbc-241d11180afc",
                        "version": "KqlParameterItem/1.0",
                        "name": "SQLInstance",
                        "type": 1,
                        "query": "let LastOne = MSSQL_SystemProps_CL\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| summarize TimeGenerated = max(TimeGenerated)\r\n| project TimeGenerated;\r\n\r\nMSSQL_SystemProps_CL\r\n| join kind=inner (LastOne) on TimeGenerated\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| project Value_s,TimeGenerated, Setting_s, PROVIDER_INSTANCE_s\r\n| where Setting_s == \"ServerName\" \r\n| take 1\r\n",
                        "isHiddenWhenLocked": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "099cbbdf-f22d-4a9c-8e10-d415a218757b",
                        "version": "KqlParameterItem/1.0",
                        "name": "WindowsRelease",
                        "type": 1,
                        "query": "let LastOne = MSSQL_SystemProps_CL\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| summarize TimeGenerated = max(TimeGenerated)\r\n| project TimeGenerated;\r\n\r\nMSSQL_SystemProps_CL\r\n| join kind=inner (LastOne) on TimeGenerated\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| project Value_s,TimeGenerated, Setting_s, PROVIDER_INSTANCE_s\r\n| where Setting_s == \"WindowsRelease\" \r\n| take 1\r\n\r\n",
                        "isHiddenWhenLocked": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "ef5589bb-09bf-475c-8ca2-553c7a58986e",
                        "version": "KqlParameterItem/1.0",
                        "name": "WindowsSKU",
                        "type": 1,
                        "query": "let LastOne = MSSQL_SystemProps_CL\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| summarize TimeGenerated = max(TimeGenerated)\r\n| project TimeGenerated;\r\n\r\nMSSQL_SystemProps_CL\r\n| join kind=inner (LastOne) on TimeGenerated\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| project Value_s,TimeGenerated, Setting_s, PROVIDER_INSTANCE_s\r\n| where Setting_s == \"WindowsSKU\" \r\n| take 1\r\n\r\n",
                        "isHiddenWhenLocked": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "a6dbf3a1-d650-4e1a-9431-6dbdf6cbcb1b",
                        "version": "KqlParameterItem/1.0",
                        "name": "SQLEdition",
                        "type": 1,
                        "query": "let LastOne = MSSQL_SystemProps_CL\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| summarize TimeGenerated = max(TimeGenerated)\r\n| project TimeGenerated;\r\n\r\nMSSQL_SystemProps_CL\r\n| join kind=inner (LastOne) on TimeGenerated\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| project Value_s,TimeGenerated, Setting_s, PROVIDER_INSTANCE_s\r\n| where Setting_s == \"Edition\" \r\n| take 1\r\n",
                        "isHiddenWhenLocked": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "a7cf8447-ff1e-4d78-a4b6-378460b0e55f",
                        "version": "KqlParameterItem/1.0",
                        "name": "SQLVersion",
                        "type": 1,
                        "query": "let LastOne = MSSQL_SystemProps_CL\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| summarize TimeGenerated = max(TimeGenerated)\r\n| project TimeGenerated;\r\n\r\nMSSQL_SystemProps_CL\r\n| join kind=inner (LastOne) on TimeGenerated\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| project Value_s,TimeGenerated, Setting_s, PROVIDER_INSTANCE_s\r\n| where Setting_s == \"ProductVersion\" \r\n| take 1\r\n\r\n",
                        "isHiddenWhenLocked": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "6d7934fd-6979-48f1-91a6-7cf13b868864",
                        "version": "KqlParameterItem/1.0",
                        "name": "WindowsLanguage",
                        "type": 1,
                        "query": "let LastOne = MSSQL_SystemProps_CL\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| summarize TimeGenerated = max(TimeGenerated)\r\n| project TimeGenerated;\r\n\r\nMSSQL_SystemProps_CL\r\n| join kind=inner (LastOne) on TimeGenerated\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| project Value_s,TimeGenerated, Setting_s, PROVIDER_INSTANCE_s\r\n| where Setting_s == \"WindowsOSLanguage\" \r\n| take 1\r\n\r\n",
                        "isHiddenWhenLocked": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "a8b3755a-1be3-48be-b301-b6a9412206df",
                        "version": "KqlParameterItem/1.0",
                        "name": "SAPSID",
                        "type": 1,
                        "query": "MSSQL_SystemProps_CL\r\n| where PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| project sapsid_s,TimeGenerated\r\n| order by TimeGenerated desc\r\n| take 1",
                        "isHiddenWhenLocked": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "5803cc2a-2362-400c-b8af-d3d65b202b34",
                        "version": "KqlParameterItem/1.0",
                        "name": "BlockingTableExists",
                        "type": 1,
                        "isRequired": true,
                        "query": "MSSQL_BlockingProcesses_CL \r\n| limit 1\r\n\r\n\r\n\r\n\r\n\r\n",
                        "isHiddenWhenLocked": true,
                        "timeContext": {
                          "durationMs": 3600000
                        },
                        "queryType": 0,
                        "resourceType": "microsoft.insights/components"
                      },
                      {
                        "id": "c7cf2086-8251-406d-aa14-021e9ec12e89",
                        "version": "KqlParameterItem/1.0",
                        "name": "param_alert_template",
                        "type": 1,
                        "value": "[\r\n\t{\r\n\t\t\"name\": \"MS SQL Server high CPU usage percent\",\r\n\t\t\"description\": \"Fired when a MS SQL Server instance CPU utilization percentage exceeds the specified threshold. Looks at the 95th percentile value over 5 minutes, and if it exceeds the threshold over 3 consecutive time periods the alert is triggered.\",\r\n\t\t\"author\": \"Microsoft\",\r\n\t\t\"templateId\": \"mssql-cpu-utilization-percent\",\r\n\t\t\"severity\": \"2\",\r\n\t\t\"alertTemplate\": {\r\n\t\t\t\"query\": \"MSSQL_CPUUsage_CL | where PROVIDER_INSTANCE_s == '{ProviderInstance}' | summarize AggregatedValue = percentile(CPU_SQL_d,95) by bin(TimeGenerated, 5m)\",\r\n\t\t\t\"thresholdOperator\": \"GreaterThan\",\r\n\t\t\t\"defaultThreshold\": \"90\",\r\n\t\t\t\"alertUnit\": \"percent\",\r\n\t\t\t\"metricMeasurement\": {\r\n\t\t\t\t\"thresholdOperator\": \"GreaterThan\",\r\n\t\t\t\t\"threshold\": \"3\",\r\n\t\t\t\t\"metricTriggerType\": \"Consecutive\",\r\n\t\t\t\t\"metricColumn\": \"PROVIDER_INSTANCE_s\",\r\n\t\t\t\t\"frequencyInMinutes\": \"10\",\r\n\t\t\t\t\"timeWindowInMinutes\": \"45\"\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\t\"name\": \"MS SQL Server low page life expectancy\",\r\n\t\t\"description\": \"Fired when the page life expectancy for a MS SQL Server instance drops below the threshold.\",\r\n\t\t\"author\": \"Microsoft\",\r\n\t\t\"templateId\": \"mssql-PLE-low\",\r\n\t\t\"severity\": \"2\",\r\n\t\t\"alertTemplate\": {\r\n\t\t\t\"query\": \"MSSQL_PageLifeExpectancy2_CL | where PROVIDER_INSTANCE_s == '{ProviderInstance}' and counter_name_s == 'Page life expectancy (Node 000)' | summarize AggregatedValue = avg(cntr_value_d) by bin(TimeGenerated, 5m)\",\r\n\t\t\t\"thresholdOperator\": \"LessThan\",\r\n\t\t\t\"defaultThreshold\": \"300\",\r\n\t\t\t\"alertUnit\": \"seconds\",\r\n\t\t\t\"metricMeasurement\": {\r\n\t\t\t\t\"thresholdOperator\": \"LessThan\",\r\n\t\t\t\t\"threshold\": \"3\",\r\n\t\t\t\t\"metricTriggerType\": \"Consecutive\",\r\n\t\t\t\t\"metricColumn\": \"PROVIDER_INSTANCE_s\",\r\n\t\t\t\t\"frequencyInMinutes\": \"10\",\r\n\t\t\t\t\"timeWindowInMinutes\": \"45\"\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\t\"name\": \"MS SQL Server high IO write time\",\r\n\t\t\"description\": \"Fired when the IO write time for a MS SQL Server instance reaches the defined threshold.\",\r\n\t\t\"author\": \"Microsoft\",\r\n\t\t\"templateId\": \"mssql-IO-write-high\",\r\n\t\t\"severity\": \"2\",\r\n\t\t\"alertTemplate\": {\r\n\t\t\t\"query\": \"MSSQL_IOPerformance_CL | where PROVIDER_INSTANCE_s == '{ProviderInstance}' | summarize AggregatedValue = avg(WriteLatency_ms__d) by bin(TimeGenerated, 15m)\",\r\n\t\t\t\"thresholdOperator\": \"GreaterThan\",\r\n\t\t\t\"defaultThreshold\": \"50\",\r\n\t\t\t\"alertUnit\": \"milliseconds\",\r\n\t\t\t\"metricMeasurement\": {\r\n\t\t\t\t\"thresholdOperator\": \"GreaterThan\",\r\n\t\t\t\t\"threshold\": \"3\",\r\n\t\t\t\t\"metricTriggerType\": \"Consecutive\",\r\n\t\t\t\t\"metricColumn\": \"PROVIDER_INSTANCE_s\",\r\n\t\t\t\t\"frequencyInMinutes\": \"10\",\r\n\t\t\t\t\"timeWindowInMinutes\": \"45\"\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\t\"name\": \"MS SQL Server high IO read time\",\r\n\t\t\"description\": \"Fired when the IO read time for a MS SQL Server instance reaches the defined threshold.\",\r\n\t\t\"author\": \"Microsoft\",\r\n\t\t\"templateId\": \"mssql-IO-read-high\",\r\n\t\t\"severity\": \"2\",\r\n\t\t\"alertTemplate\": {\r\n\t\t\t\"query\": \"MSSQL_IOPerformance_CL | where PROVIDER_INSTANCE_s == '{ProviderInstance}' | summarize AggregatedValue = avg(ReadLatency_ms__d) by bin(TimeGenerated, 15m)\",\r\n\t\t\t\"thresholdOperator\": \"GreaterThan\",\r\n\t\t\t\"defaultThreshold\": \"50\",\r\n\t\t\t\"alertUnit\": \"milliseconds\",\r\n\t\t\t\"metricMeasurement\": {\r\n\t\t\t\t\"thresholdOperator\": \"GreaterThan\",\r\n\t\t\t\t\"threshold\": \"3\",\r\n\t\t\t\t\"metricTriggerType\": \"Consecutive\",\r\n\t\t\t\t\"metricColumn\": \"PROVIDER_INSTANCE_s\",\r\n\t\t\t\t\"frequencyInMinutes\": \"10\",\r\n\t\t\t\t\"timeWindowInMinutes\": \"45\"\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\t\"name\": \"MS SQL Server high blocking time\",\r\n\t\t\"description\": \"Fired when a blocking situation last longer than the defined threshold.\",\r\n\t\t\"author\": \"Microsoft\",\r\n\t\t\"templateId\": \"mssql-long-blocking\",\r\n\t\t\"severity\": \"2\",\r\n\t\t\"alertTemplate\": {\r\n\t\t\t\"query\": \"MSSQL_BlockingProcesses_CL | where PROVIDER_INSTANCE_s == '{ProviderInstance}' | summarize AggregatedValue = max(blocked_d) by bin(TimeGenerated, 15m), hostprocess_s\",\r\n\t\t\t\"thresholdOperator\": \"GreaterThan\",\r\n\t\t\t\"defaultThreshold\": \"60\",\r\n\t\t\t\"alertUnit\": \"seconds\",\r\n\t\t\t\"metricMeasurement\": {\r\n\t\t\t\t\"thresholdOperator\": \"GreaterThan\",\r\n\t\t\t\t\"threshold\": \"3\",\r\n\t\t\t\t\"metricTriggerType\": \"Consecutive\",\r\n\t\t\t\t\"metricColumn\": \"hostprocess_s\",\r\n\t\t\t\t\"frequencyInMinutes\": \"5\",\r\n\t\t\t\t\"timeWindowInMinutes\": \"60\"\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n]",
                        "isHiddenWhenLocked": true,
                        "typeSettings": {
                          "multiLineText": true,
                          "editorLanguage": "text",
                          "multiLineHeight": 25
                        }
                      },
                      {
                        "id": "178e9201-75c2-4884-8777-933053948b0b",
                        "version": "KqlParameterItem/1.0",
                        "name": "param_backup_table_exists",
                        "type": 1,
                        "query": "let tableList = '{param_check_tables}';\r\nlet tableListValue = case(((tableList) contains 'MSSQL_BckBackups_CL:0'), \"0\",\r\n                            ((tableList) contains 'MSSQL_BckBackups_CL:1'),\"1\",\r\n                             ((tableList) contains 'MSSQL_BckBackups_CL:2'),\"2\",\"2\");\r\nprint toscalar(tableListValue);",
                        "isHiddenWhenLocked": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "45f32eca-e176-4bf5-8bab-2bc06d02f899",
                        "version": "KqlParameterItem/1.0",
                        "name": "param_error_log_table_exists",
                        "type": 1,
                        "query": "let tableList = '{param_check_tables}';\r\nlet tableListValue = case(((tableList) contains 'MSSQL_Errorlog_CL:0'), \"0\",\r\n                            ((tableList) contains 'MSSQL_Errorlog_CL:1'),\"1\",\r\n                             ((tableList) contains 'MSSQL_Errorlog_CL:2'),\"2\",\"2\");\r\nprint toscalar(tableListValue);",
                        "isHiddenWhenLocked": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "1118a0f0-3d09-429d-a153-d034e3e7e86c",
                        "version": "KqlParameterItem/1.0",
                        "name": "param_blocking_processes_table_exists",
                        "type": 1,
                        "query": "let tableList = '{param_check_tables}';\r\nlet tableListValue = case(((tableList) contains 'MSSQL_BlockingProcesses_CL:0'), \"0\",\r\n                            ((tableList) contains 'MSSQL_BlockingProcesses_CL:1'),\"1\",\r\n                             ((tableList) contains 'MSSQL_BlockingProcesses_CL:2'),\"2\",\"2\");\r\nprint toscalar(tableListValue);",
                        "isHiddenWhenLocked": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "55cdb37c-e9d7-4c80-8a0c-757039f83cb7",
                        "version": "KqlParameterItem/1.0",
                        "name": "param_ao_overview_table_exists",
                        "type": 1,
                        "query": "let tableList = '{param_check_tables}';\r\nlet tableListValue = case(((tableList) contains 'MSSQL_AOOverview_CL:0'), \"0\",\r\n                            ((tableList) contains 'MSSQL_AOOverview_CL:1'),\"1\",\r\n                             ((tableList) contains 'MSSQL_AOOverview_CL:2'),\"2\",\"2\");\r\nprint toscalar(tableListValue);",
                        "isHiddenWhenLocked": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "0591ab79-6bfc-4edd-84be-373e3d17d27a",
                        "version": "KqlParameterItem/1.0",
                        "name": "param_ao_failover_table_exists",
                        "type": 1,
                        "query": "let tableList = '{param_check_tables}';\r\nlet tableListValue = case(((tableList) contains 'MSSQL_AOFailovers_CL:0'), \"0\",\r\n                            ((tableList) contains 'MSSQL_AOFailovers_CL:1'),\"1\",\r\n                             ((tableList) contains 'MSSQL_AOFailovers_CL:2'),\"2\",\"2\");\r\nprint toscalar(tableListValue);",
                        "isHiddenWhenLocked": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      }
                    ],
                    "style": "above",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "customWidth": "30",
                  "name": "Provider instance details"
                },
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "nav",
                    "links": [
                      {
                        "id": "c2462911-2259-4790-b684-36340c3eeb6c",
                        "linkTarget": "WorkbookTemplate",
                        "linkLabel": "Alerts",
                        "style": "primary",
                        "workbookContext": {
                          "componentIdSource": "workbook",
                          "resourceIdsSource": "workbook",
                          "templateIdSource": "static",
                          "templateId": "Community-Workbooks/SapMonitor2.0/Alerts/Alerts",
                          "typeSource": "workbook",
                          "gallerySource": "workbook",
                          "locationSource": "default",
                          "passSpecificParams": true,
                          "templateParameters": [
                            {
                              "name": "AlertTemplates",
                              "source": "parameter",
                              "value": "param_alert_template"
                            },
                            {
                              "name": "ProviderType",
                              "source": "parameter",
                              "value": "param_provider_type"
                            }
                          ]
                        }
                      }
                    ]
                  },
                  "customWidth": "30",
                  "name": "links - 23"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "## Azure Monitor for SAP Solutions on MS SQL Server\r\n---\r\n<b style=\"color:DodgerBlue;\">OS Hostname:</b> {Hostname} on {WindowsRelease} ({WindowsSKU}) - {WindowsLanguage} </br>\r\n<b style=\"color:DodgerBlue;\">SQL Instance:</b> {SQLInstance} - {SQLEdition} Version {SQLVersion}  </br>\r\n<b style=\"color:DodgerBlue;\">SAP Instance:</b> {SAPSID} </br>"
                  },
                  "customWidth": "30",
                  "name": "Headline"
                },
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "tabs",
                    "links": [
                      {
                        "id": "fbb60b55-ac3d-4cdd-a3dd-32c8ffb01f5d",
                        "cellValue": "selectedTab",
                        "linkTarget": "parameter",
                        "linkLabel": "Current Load",
                        "subTarget": "1",
                        "style": "link"
                      },
                      {
                        "id": "f472571e-b506-49a5-bb71-93b0ef75f248",
                        "cellValue": "selectedTab",
                        "linkTarget": "parameter",
                        "linkLabel": "Statistics",
                        "subTarget": "2",
                        "style": "link"
                      },
                      {
                        "id": "098b5352-b142-431e-a6fd-0f1545cd5795",
                        "cellValue": "selectedTab",
                        "linkTarget": "parameter",
                        "linkLabel": "Resources",
                        "subTarget": "3",
                        "style": "link"
                      },
                      {
                        "id": "14f86c4f-0756-4323-929a-d8fb47b0bc10",
                        "cellValue": "selectedTab",
                        "linkTarget": "parameter",
                        "linkLabel": "Problems",
                        "subTarget": "4",
                        "style": "link"
                      },
                      {
                        "id": "aa8281e5-3ea7-4046-97c3-df99df3f3db3",
                        "cellValue": "selectedTab",
                        "linkTarget": "parameter",
                        "linkLabel": "AlwaysOn",
                        "subTarget": "5",
                        "style": "link"
                      },
                      {
                        "id": "9a7ffc96-573a-4eb4-9b7e-225f0d20d487",
                        "cellValue": "selectedTab",
                        "linkTarget": "parameter",
                        "linkLabel": "Backup",
                        "subTarget": "6",
                        "style": "link"
                      }
                    ]
                  },
                  "name": "Links - 12"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "MSSQL_BatchRequests_CL \r\n| where TimeGenerated {Days}\r\n| where PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| where counter_name_s has \"Batch\"\r\n| project TimeGenerated, counter_name_s, cntr_value_d\r\n| summarize avg(cntr_value_d) by counter_name_s,bin(TimeGenerated, {Days:grain})\r\n",
                    "size": 0,
                    "aggregation": 3,
                    "title": "Batch Request/sec ({Days:label} - Grain: {Days:grain})",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "areachart",
                    "chartSettings": {
                      "xSettings": {},
                      "ySettings": {}
                    }
                  },
                  "customWidth": "33",
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "1"
                  },
                  "name": "BatcheRequests",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "MSSQL_BatchRequests_CL\r\n| where TimeGenerated {Days}\r\n| where PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| where counter_name_s has 'Compilations'\r\n| project TimeGenerated, counter_name_s, cntr_value_d\r\n| summarize avg(cntr_value_d) by counter_name_s,bin(TimeGenerated, {Days:grain})",
                    "size": 0,
                    "aggregation": 3,
                    "title": "Compilations and Re-Compilations/sec ({Days:label} - Grain: {Days:grain})",
                    "noDataMessage": "Sorry, no data.",
                    "timeContextFromParameter": "Days",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "areachart",
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "SQL Compilations/sec                                                                                                            ",
                          "color": "orange"
                        },
                        {
                          "seriesName": "SQL Re-Compilations/sec                                                                                                         ",
                          "color": "redDark"
                        }
                      ],
                      "xSettings": {},
                      "ySettings": {}
                    }
                  },
                  "customWidth": "33",
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "1"
                  },
                  "name": "Compilations",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "MSSQL_CPUUsage_CL\r\n| where TimeGenerated {Days}\r\n| where PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| project TimeGenerated, CPU_SQL_d, CPU_Idle_d, CPU_Others_d\r\n| summarize avg(CPU_SQL_d), avg(CPU_Idle_d), avg(CPU_Others_d) by bin(TimeGenerated, {Days:grain})",
                    "size": 0,
                    "aggregation": 5,
                    "title": "CPU Usage ({Days:label} - Grain: {Days:grain})",
                    "noDataMessage": "No Data.",
                    "timeContextFromParameter": "Days",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "linechart",
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "avg_CPU_SQL_d",
                          "label": "SQL Server",
                          "color": "green"
                        },
                        {
                          "seriesName": "avg_CPU_Idle_d",
                          "label": "Idle",
                          "color": "blue"
                        },
                        {
                          "seriesName": "avg_CPU_Others_d",
                          "label": "Others",
                          "color": "red"
                        }
                      ]
                    }
                  },
                  "customWidth": "33",
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "1"
                  },
                  "name": "CPUUsage",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "MSSQL_PageLifeExpectancy2_CL\r\n| where TimeGenerated {Days}\r\n| where PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| where counter_name_s has \"Buffer\"\r\n| project TimeGenerated, counter_name_s, cntr_value_d\r\n| summarize avg(cntr_value_d) by counter_name_s,bin(TimeGenerated, {Days:grain})",
                    "size": 0,
                    "aggregation": 5,
                    "title": "Buffer Cache Hit Ratio ({Days:label} - Grain: {Days:grain})",
                    "noDataMessage": "No data.",
                    "timeContextFromParameter": "Days",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "barchart",
                    "tileSettings": {
                      "showBorder": false,
                      "titleContent": {
                        "columnMatch": "counter_name_s",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "cntr_value_d",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    },
                    "graphSettings": {
                      "type": 0,
                      "topContent": {
                        "columnMatch": "counter_name_s",
                        "formatter": 1
                      },
                      "centerContent": {
                        "columnMatch": "cntr_value_d",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    },
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Buffer cache hit ratio                                                                                                          ",
                          "color": "green"
                        }
                      ],
                      "xSettings": {},
                      "ySettings": {}
                    }
                  },
                  "customWidth": "33",
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "1"
                  },
                  "name": "BatchRequests",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "MSSQL_PageLifeExpectancy2_CL\r\n| where TimeGenerated {Days}\r\n| where PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| where counter_name_s has \"Page\"\r\n| project TimeGenerated, counter_name_s, cntr_value_d\r\n| summarize avg(cntr_value_d) by counter_name_s,bin(TimeGenerated, {Days:grain})",
                    "size": 0,
                    "aggregation": 5,
                    "title": "Page Life Expectancy ({Days:label} - Grain: {Days:grain})",
                    "noDataMessage": "No data.",
                    "timeContextFromParameter": "Days",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "linechart",
                    "chartSettings": {
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 24,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true
                          }
                        }
                      }
                    }
                  },
                  "customWidth": "33",
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "1"
                  },
                  "name": "PLE",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "MSSQL_MemoryOverview_CL\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| where TimeGenerated {Days}\r\n| summarize avg(allocated_kb_d) by type_s\r\n\r\n",
                    "size": 3,
                    "title": "Memory Overview ({Days:label})",
                    "noDataMessage": "No data found in the selected time frame.",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "piechart",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "allocated_kb_d",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "magenta"
                          },
                          "numberFormat": {
                            "unit": 3,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        }
                      ]
                    },
                    "tileSettings": {
                      "showBorder": false,
                      "titleContent": {
                        "columnMatch": "type_s",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "allocated_kb_d",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    },
                    "chartSettings": {
                      "yAxis": [
                        "avg_allocated_kb_d"
                      ],
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Andere",
                          "color": "gray"
                        }
                      ],
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 3,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true,
                            "maximumFractionDigits": 1
                          }
                        }
                      }
                    }
                  },
                  "customWidth": "33",
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "2"
                  },
                  "name": "MemoryOverview",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "MSSQL_WaitPercs_CL\r\n| where TimeGenerated {Days}\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| summarize avg(Percentage_d) by WaitType_s\r\n| order by avg_Percentage_d\r\n| take 10\r\n\r\n",
                    "size": 3,
                    "title": "Actual Top 10 Waits Statistics ({Days:label})",
                    "noDataMessage": "No data found in the selected time frame.",
                    "timeContextFromParameter": "Days",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "tiles",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "WaitType",
                          "formatter": 1,
                          "formatOptions": {}
                        },
                        {
                          "columnMatch": "Percentage",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "WaitType_s",
                          "label": "WaitType"
                        },
                        {
                          "columnId": "Percentage_d",
                          "label": "Percentage"
                        }
                      ]
                    },
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "WaitType_s",
                        "formatter": 1,
                        "formatOptions": {}
                      },
                      "leftContent": {
                        "columnMatch": "avg_Percentage_d",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "greenRed"
                        },
                        "numberFormat": {
                          "unit": 1,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "maximumFractionDigits": 2
                          }
                        }
                      },
                      "showBorder": true,
                      "sortCriteriaField": "avg_Percentage_d",
                      "sortOrderField": 2
                    },
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "PAGEIOLATCH_SH",
                          "color": "greenDark"
                        },
                        {
                          "seriesName": "ASYNC_NETWORK_IO",
                          "color": "orange"
                        },
                        {
                          "seriesName": "Other",
                          "color": "pink"
                        },
                        {
                          "seriesName": "PAGEIOLATCH_EX",
                          "color": "redDark"
                        },
                        {
                          "seriesName": "WRITELOG",
                          "color": "blueDark"
                        },
                        {
                          "seriesName": "CXPACKET",
                          "color": "lightBlue"
                        }
                      ],
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 1,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true
                          }
                        }
                      }
                    }
                  },
                  "customWidth": "33",
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "2"
                  },
                  "name": "WaitStats ",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "loadType": "always",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "MSSQL_IOPerformance_CL\r\n| where TimeGenerated {Days}\r\n| where PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| project TotalLatency_ms__d, ReadLatency_ms__d, WriteLatency_ms__d,TimeGenerated, Filename_s\r\n| summarize ReadLatency=avg(ReadLatency_ms__d) by bin(TimeGenerated, {Days:grain})\r\n\r\n\r\n\r\n\r\n",
                          "size": 0,
                          "aggregation": 3,
                          "title": "avg. DB IO Read Latency ({Days:label} - Grain: {Days:grain})",
                          "noDataMessage": "Sorry, no data.",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "visualization": "linechart",
                          "tileSettings": {
                            "showBorder": false
                          },
                          "graphSettings": {
                            "type": 0
                          },
                          "chartSettings": {
                            "seriesLabelSettings": [
                              {
                                "seriesName": "ReadLatency",
                                "label": "Read Latency (ms)",
                                "color": "orange"
                              }
                            ]
                          },
                          "mapSettings": {
                            "locInfo": "LatLong",
                            "sizeSettings": "TotalLatency_ms__d",
                            "sizeAggregation": "Sum",
                            "legendMetric": "TotalLatency_ms__d",
                            "legendAggregation": "Sum",
                            "itemColorSettings": {
                              "type": "heatmap",
                              "colorAggregation": "Sum",
                              "nodeColorField": "TotalLatency_ms__d",
                              "heatmapPalette": "greenRed"
                            }
                          }
                        },
                        "customWidth": "33",
                        "conditionalVisibility": {
                          "parameterName": "selectedTab",
                          "comparison": "isEqualTo",
                          "value": "1"
                        },
                        "name": "IO Latency",
                        "styleSettings": {
                          "maxWidth": "100%",
                          "showBorder": true
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "MSSQL_IOPerformance_CL\r\n| where TimeGenerated {Days}\r\n| where PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| project TotalLatency_ms__d, ReadLatency_ms__d, WriteLatency_ms__d,TimeGenerated, Filename_s\r\n| summarize WriteLatency=avg(WriteLatency_ms__d) by bin(TimeGenerated, {Days:grain})\r\n\r\n\r\n\r\n\r\n",
                          "size": 0,
                          "aggregation": 3,
                          "title": "avg. DB IO Write Latency ({Days:label} - Grain: {Days:grain})",
                          "noDataMessage": "Sorry, no data.",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "visualization": "linechart",
                          "tileSettings": {
                            "showBorder": false
                          },
                          "graphSettings": {
                            "type": 0
                          },
                          "chartSettings": {
                            "seriesLabelSettings": [
                              {
                                "seriesName": "WriteLatency",
                                "label": "Write Latency (ms)",
                                "color": "green"
                              }
                            ]
                          },
                          "mapSettings": {
                            "locInfo": "LatLong",
                            "sizeSettings": "TotalLatency_ms__d",
                            "sizeAggregation": "Sum",
                            "legendMetric": "TotalLatency_ms__d",
                            "legendAggregation": "Sum",
                            "itemColorSettings": {
                              "type": "heatmap",
                              "colorAggregation": "Sum",
                              "nodeColorField": "TotalLatency_ms__d",
                              "heatmapPalette": "greenRed"
                            }
                          }
                        },
                        "customWidth": "33",
                        "conditionalVisibility": {
                          "parameterName": "selectedTab",
                          "comparison": "isEqualTo",
                          "value": "1"
                        },
                        "name": "IO Latency  Write",
                        "styleSettings": {
                          "maxWidth": "100%",
                          "showBorder": true
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "MSSQL_IOPerformance_CL\r\n| where TimeGenerated {Days}\r\n| where PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| project TotalLatency_ms__d, ReadLatency_ms__d, WriteLatency_ms__d,TimeGenerated, Filename_s\r\n| summarize TotalLatency=avg(TotalLatency_ms__d) by  bin(TimeGenerated, {Days:grain})\r\n\r\n\r\n\r\n\r\n",
                          "size": 0,
                          "aggregation": 3,
                          "title": "avg. DB IO Total Latency ({Days:label} - Grain: {Days:grain})",
                          "noDataMessage": "Sorry, no data.",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "visualization": "linechart",
                          "tileSettings": {
                            "showBorder": false
                          },
                          "graphSettings": {
                            "type": 0
                          },
                          "chartSettings": {
                            "seriesLabelSettings": [
                              {
                                "seriesName": "TotalLatency",
                                "label": "Total Latency (ms)",
                                "color": "purple"
                              }
                            ]
                          },
                          "mapSettings": {
                            "locInfo": "LatLong",
                            "sizeSettings": "TotalLatency_ms__d",
                            "sizeAggregation": "Sum",
                            "legendMetric": "TotalLatency_ms__d",
                            "legendAggregation": "Sum",
                            "itemColorSettings": {
                              "type": "heatmap",
                              "colorAggregation": "Sum",
                              "nodeColorField": "TotalLatency_ms__d",
                              "heatmapPalette": "greenRed"
                            }
                          }
                        },
                        "customWidth": "33",
                        "conditionalVisibility": {
                          "parameterName": "selectedTab",
                          "comparison": "isEqualTo",
                          "value": "1"
                        },
                        "name": "IO Latency  Write - Kopieren",
                        "styleSettings": {
                          "maxWidth": "100%",
                          "showBorder": true
                        }
                      }
                    ]
                  },
                  "name": "Gruppe - 20"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "\r\nMSSQL_Top10Statements_CL\r\n| where last_execution_time_t {Days}\r\n| where PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| take 200\r\n| project TimeGenerated, last_execution_time_t, sqltext_s,exec_count_d,total_rows_d,avg_rows_d,total_logical_reads_d, avg_logical_reads_d , total_elapsed_time_d,avg_elapsed_time_d,total_cpu_time_d, avg_cpu_time_d, total_phys_reads_d, avg_phys_reads_d,total_log_writes_d, avg_log_writes_d\r\n| order by TimeGenerated, last_execution_time_t,total_elapsed_time_d desc\r\n",
                    "size": 0,
                    "title": "Top 10 SQL Statements ({Days:label})",
                    "noDataMessage": "Sorry, no data.",
                    "timeContextFromParameter": "Days",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 5,
                          "formatOptions": {}
                        },
                        {
                          "columnMatch": "last_execution_time_t",
                          "formatter": 6,
                          "formatOptions": {}
                        },
                        {
                          "columnMatch": "sqltext_s",
                          "formatter": 5,
                          "formatOptions": {}
                        },
                        {
                          "columnMatch": "exec_count_d",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "grayBlue"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        },
                        {
                          "columnMatch": "total_rows_d",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "grayBlue"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        },
                        {
                          "columnMatch": "avg_rows_d",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "grayBlue"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        },
                        {
                          "columnMatch": "total_logical_reads_d",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "grayBlue"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        },
                        {
                          "columnMatch": "avg_logical_reads_d",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "grayBlue"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        },
                        {
                          "columnMatch": "total_elapsed_time_d",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellow"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        },
                        {
                          "columnMatch": "avg_elapsed_time_d",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "grayBlue"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        },
                        {
                          "columnMatch": "total_cpu_time_d",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "grayBlue"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        },
                        {
                          "columnMatch": "avg_cpu_time_d",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "grayBlue"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        },
                        {
                          "columnMatch": "total_phys_reads_d",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "grayBlue"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        },
                        {
                          "columnMatch": "avg_phys_reads_d",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "grayBlue"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        },
                        {
                          "columnMatch": "total_log_writes_d",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "grayBlue"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        },
                        {
                          "columnMatch": "avg_log_writes_d",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "grayBlue"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        }
                      ],
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "TimeGenerated"
                        ],
                        "expandTopLevel": true,
                        "finalBy": "sqltext_s"
                      },
                      "sortBy": [
                        {
                          "itemKey": "$gen_heatmap_total_elapsed_time_d_9",
                          "sortOrder": 2
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "last_execution_time_t",
                          "label": "Last Execution"
                        },
                        {
                          "columnId": "sqltext_s",
                          "label": "SQL Statement"
                        },
                        {
                          "columnId": "exec_count_d",
                          "label": "Executions"
                        },
                        {
                          "columnId": "total_rows_d",
                          "label": "Rows (total)"
                        },
                        {
                          "columnId": "avg_rows_d",
                          "label": "Rows (avg)"
                        },
                        {
                          "columnId": "total_logical_reads_d",
                          "label": "Logical reads (total ms)"
                        },
                        {
                          "columnId": "avg_logical_reads_d",
                          "label": "Logical reads (avgms)"
                        },
                        {
                          "columnId": "total_elapsed_time_d",
                          "label": "Elapsed Time ( (total ms)"
                        },
                        {
                          "columnId": "avg_elapsed_time_d",
                          "label": "Elapsed Time ( (avg ms)"
                        },
                        {
                          "columnId": "total_cpu_time_d",
                          "label": "CPU Time (total ms)"
                        },
                        {
                          "columnId": "avg_cpu_time_d",
                          "label": "CPU Time  (avg ms)"
                        },
                        {
                          "columnId": "total_phys_reads_d",
                          "label": "Physical reads (total)"
                        },
                        {
                          "columnId": "avg_phys_reads_d",
                          "label": "Physical reads (avg)"
                        },
                        {
                          "columnId": "total_log_writes_d",
                          "label": "Writes (total)"
                        },
                        {
                          "columnId": "avg_log_writes_d",
                          "label": "Writes (avg)"
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_heatmap_total_elapsed_time_d_9",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "3"
                  },
                  "name": "Top10Stmt",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let LastOne = MSSQL_TableSizes_CL\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| where TimeGenerated > ago(1h)\r\n| summarize TimeGenerated = max(TimeGenerated)\r\n| project TimeGenerated;\r\n\r\nMSSQL_TableSizes_CL\r\n| join kind=inner (LastOne) on TimeGenerated\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| project Table_s, Row_Count_d, Reserved_GB__d, Used_GB__d,BLOB_Size_GB__d\r\n| order by Reserved_GB__d\r\n| limit 12\r\n",
                    "size": 3,
                    "title": "Top 12 actual largest Tables",
                    "noDataMessage": "Sorry, no data.",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Table_s",
                          "formatter": 1,
                          "formatOptions": {}
                        },
                        {
                          "columnMatch": "Row_Count_d",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "grayBlue"
                          }
                        },
                        {
                          "columnMatch": "Reserved_GB__d",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "grayBlue"
                          }
                        },
                        {
                          "columnMatch": "Used_GB__d",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "grayBlue"
                          }
                        },
                        {
                          "columnMatch": "BLOB_Size_GB__d",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "grayBlue"
                          }
                        }
                      ]
                    },
                    "sortBy": [],
                    "tileSettings": {
                      "showBorder": false
                    },
                    "graphSettings": {
                      "type": 0
                    },
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "TotalLatency_ms__d",
                          "label": "TotalLatency (ms)",
                          "color": "gray"
                        },
                        {
                          "seriesName": "ReadLatency_ms__d",
                          "label": "ReadLatency (ms)",
                          "color": "grayBlue"
                        },
                        {
                          "seriesName": "WriteLatency_ms__d",
                          "label": "WriteLatency (ms)",
                          "color": "green"
                        }
                      ],
                      "xSettings": {},
                      "ySettings": {}
                    },
                    "mapSettings": {
                      "locInfo": "LatLong",
                      "sizeSettings": "TotalLatency_ms__d",
                      "sizeAggregation": "Sum",
                      "legendMetric": "TotalLatency_ms__d",
                      "legendAggregation": "Sum",
                      "itemColorSettings": {
                        "type": "heatmap",
                        "colorAggregation": "Sum",
                        "nodeColorField": "TotalLatency_ms__d",
                        "heatmapPalette": "greenRed"
                      }
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "3"
                  },
                  "name": "TableSizes",
                  "styleSettings": {
                    "maxWidth": "100",
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "MSSQL_Errorlog_CL\r\n| where PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| where todatetime(EventTime_t) {Days}\r\n| distinct EventTime_t, ErrNum_d, ErrSeverity_d, column_ifexists('ErrState_s', ErrState_d), ErrText_s, SessionID_d, DBID_d\r\n\r\n",
                    "size": 4,
                    "title": "Recorded errors ({Days:label}).",
                    "noDataMessage": "No warnings or errors for the given timeframe.",
                    "noDataMessageStyle": 3,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "ErrSeverity_d",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": ">=",
                                "thresholdValue": "17",
                                "representation": "4",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": ">",
                                "thresholdValue": "10",
                                "representation": "2",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "1",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Text_s",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "-",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": ">=",
                                "thresholdValue": "17",
                                "representation": "4",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "<=",
                                "thresholdValue": "10",
                                "representation": "1",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": ">",
                                "thresholdValue": "10",
                                "representation": "2",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "ErrText_s",
                          "label": "Errormessage"
                        }
                      ]
                    },
                    "sortBy": []
                  },
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selectedTab",
                      "comparison": "isEqualTo",
                      "value": "4"
                    },
                    {
                      "parameterName": "param_error_log_table_exists",
                      "comparison": "isEqualTo",
                      "value": "0"
                    }
                  ],
                  "name": "ErrorAnalysis",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "MSSQL_BlockingProcesses_CL\r\n| where TimeGenerated {Days}\r\n| where PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| extend status_s = replace(@\"(\\s+)$\", @\"\", status_s) \r\n| extend waitresource_s = replace(@\"(\\s+)$\", @\"\", waitresource_s) \r\n| extend hostname_s = replace(@\"(\\s+)$\", @\"\", hostname_s) \r\n| project TimeGenerated, spid_d, blocked_d, type_s, status_s, cmd_s, lastwaittype_s, waitresource_s, waittime_d, cpu_d, ecid_d, dbid_d, physical_io_d, memusage_d, kpid_d, hostname_s, program_name_s, sql_handle_s\r\n| take 200\r\n\r\n\r\n\r\n",
                    "size": 0,
                    "title": "Blocking Processes ({Days:label})",
                    "noDataMessage": "No data.",
                    "timeContextFromParameter": "Days",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 5,
                          "formatOptions": {}
                        },
                        {
                          "columnMatch": "blocked_d",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "0",
                                "representation": "3",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "type_s",
                          "formatter": 5,
                          "formatOptions": {}
                        },
                        {
                          "columnMatch": "status_s",
                          "formatter": 1,
                          "formatOptions": {}
                        }
                      ],
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "TimeGenerated"
                        ],
                        "expandTopLevel": true,
                        "finalBy": "type_s"
                      }
                    }
                  },
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selectedTab",
                      "comparison": "isEqualTo",
                      "value": "4"
                    },
                    {
                      "parameterName": "BlockingTableExists",
                      "comparison": "isNotEqualTo",
                      "value": ""
                    }
                  ],
                  "name": "Blocking",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let LastOne = MSSQL_AOOverview_CL\r\n| where TimeGenerated {Days} and PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| summarize TimeGenerated = max(TimeGenerated)\r\n| project TimeGenerated;\r\n\r\nMSSQL_AOOverview_CL\r\n| join kind=inner (LastOne) on TimeGenerated\r\n| where PROVIDER_INSTANCE_s == '{Provider}' and replica_server_s <> '-'\r\n| project Server=replica_server_s, Role=replica_role_s, Location=replica_loc_s, State=sync_state_s, AG=ag_name_s, Mode=avail_mode_s, Connection=conn_state_s, DB=db_name_s, SecondsBehind=column_ifexists('sec_behind_d','sec_behind_s'), RedoQueueSize=column_ifexists('redoqueue_sz_d','redoqueue_sz_s'), SendQueueSize=column_ifexists('sendqueue_sz_d','sendqueue_sz_s'), LastLSNTime=column_ifexists('last_hardnd_tm_t','last_hardnd_tm_s'), LastLSN=last_hardnd_lsn_s\r\n| order by Server asc\r\n\r\n",
                    "size": 3,
                    "title": "AlwaysOn Overview",
                    "noDataMessage": "No Data.",
                    "timeContext": {
                      "durationMs": 86400000
                    },
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selectedTab",
                      "comparison": "isEqualTo",
                      "value": "5"
                    },
                    {
                      "parameterName": "param_ao_overview_table_exists",
                      "comparison": "isEqualTo",
                      "value": "0"
                    }
                  ],
                  "name": "AOOverview",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let LastOne = MSSQL_AOOverview_CL\r\n| where TimeGenerated {Days} and PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| summarize TimeGenerated = max(TimeGenerated)\r\n| project TimeGenerated;\r\n\r\nlet Secondaries = MSSQL_AOOverview_CL\r\n| join kind=inner (LastOne) on TimeGenerated\r\n| where PROVIDER_INSTANCE_s == '{Provider}' and replica_server_s <> '-'\r\n| where replica_role_s == 'SECONDARY'\r\n| project TimeGenerated,Server=replica_server_s, Role=replica_role_s,State=sync_state_s,Mode=avail_mode_s,Seconds=column_ifexists('sec_behind_d','sec_behind_d');\r\n\r\nlet Primary = MSSQL_AOOverview_CL\r\n| join kind=inner (LastOne) on TimeGenerated\r\n| where PROVIDER_INSTANCE_s == '{Provider}' and replica_server_s <> '-'\r\n| where replica_role_s == 'PRIMARY'\r\n| project TimeGenerated,Server=replica_server_s, Role=replica_role_s,State=sync_state_s,Mode=avail_mode_s,Seconds=column_ifexists('sec_behind_d','sec_behind_d')\r\n| lookup kind=leftouter (Secondaries) on TimeGenerated;\r\n\r\nunion Primary, Secondaries;\r\n\r\n\r\n\r\n",
                    "size": 0,
                    "title": "AlwaysOn Overview",
                    "noDataMessage": "No Data.",
                    "timeContext": {
                      "durationMs": 86400000
                    },
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "graph",
                    "graphSettings": {
                      "type": 0,
                      "topContent": {
                        "columnMatch": "State",
                        "formatter": 1
                      },
                      "centerContent": {
                        "columnMatch": "Server",
                        "formatter": 1
                      },
                      "bottomContent": {
                        "columnMatch": "Seconds",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 24,
                          "options": {
                            "style": "decimal"
                          }
                        }
                      },
                      "nodeIdField": "Server",
                      "sourceIdField": "Server",
                      "targetIdField": "Server1",
                      "edgeLabel": "Mode1",
                      "nodeSize": null,
                      "staticNodeSize": 100,
                      "colorSettings": {
                        "nodeColorField": "State",
                        "type": 3,
                        "thresholdsGrid": [
                          {
                            "operator": "==",
                            "thresholdValue": "SYNCHRONIZED",
                            "representation": "green"
                          },
                          {
                            "operator": "==",
                            "thresholdValue": "NOT SYNCHRONIZING",
                            "representation": "redBright"
                          },
                          {
                            "operator": "==",
                            "thresholdValue": "SYNCHRONIZING",
                            "representation": "yellow"
                          },
                          {
                            "operator": "Default",
                            "thresholdValue": null,
                            "representation": "gray"
                          }
                        ]
                      },
                      "groupByField": "Server1",
                      "hivesMargin": 5
                    }
                  },
                  "customWidth": "40",
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selectedTab",
                      "comparison": "isEqualTo",
                      "value": "5"
                    },
                    {
                      "parameterName": "param_ao_overview_table_exists",
                      "comparison": "isEqualTo",
                      "value": "0"
                    }
                  ],
                  "name": "AOOverview - Graph",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let min_t = toscalar(MSSQL_AOOverview_CL | where TimeGenerated {Days} | summarize min(TimeGenerated));\r\nlet max_t = toscalar(MSSQL_AOOverview_CL | where TimeGenerated {Days} | summarize max(TimeGenerated));\r\n\r\nlet redoserie=MSSQL_AOOverview_CL\r\n| where TimeGenerated {Days}\r\n| where PROVIDER_INSTANCE_s == '{Provider}' and replica_server_s <> '-'\r\n| make-series redoavg=avg(todecimal(column_ifexists('redoqueue_sz_d','redoqueue_sz_s'))) default=0 on TimeGenerated from min_t to max_t step 1m by replica_server_s;\r\n\r\nlet sendserie=MSSQL_AOOverview_CL\r\n| where TimeGenerated {Days}\r\n| where PROVIDER_INSTANCE_s == '{Provider}' and replica_server_s <> '-'\r\n| make-series sendavg=avg(todecimal(column_ifexists('sendqueue_sz_d','sendqueue_sz_s'))) default=0 on TimeGenerated from min_t to max_t step 1m by replica_server_s;\r\n\r\nlet sebeserie=MSSQL_AOOverview_CL\r\n| where TimeGenerated {Days}\r\n| where PROVIDER_INSTANCE_s == '{Provider}' and replica_server_s <> '-'\r\n| make-series secbehi=avg(todecimal(column_ifexists('sec_behind_d','sec_behind_d'))) default=0 on TimeGenerated from min_t to max_t step 1m by replica_server_s;\r\n\r\nredoserie\r\n| join sendserie on replica_server_s\r\n| join sebeserie on replica_server_s",
                    "size": 3,
                    "title": "AlwaysOn Queues ({Days:label})",
                    "noDataMessage": "No data.",
                    "timeContext": {
                      "durationMs": 86400000
                    },
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "redoavg",
                          "formatter": 21,
                          "formatOptions": {
                            "palette": "blueDark"
                          }
                        },
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "replica_server_s1",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "sendavg",
                          "formatter": 21,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "replica_server_s2",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "secbehi",
                          "formatter": 21,
                          "formatOptions": {
                            "palette": "turquoise"
                          }
                        },
                        {
                          "columnMatch": "redoqueue_sz_d",
                          "formatter": 5
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "replica_server_s",
                          "label": "Server"
                        },
                        {
                          "columnId": "redoavg",
                          "label": "Redo Queue"
                        },
                        {
                          "columnId": "sendavg",
                          "label": "Send Queue"
                        },
                        {
                          "columnId": "secbehi",
                          "label": "Seconds Behind"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selectedTab",
                      "comparison": "isEqualTo",
                      "value": "5"
                    },
                    {
                      "parameterName": "param_ao_overview_table_exists",
                      "comparison": "isEqualTo",
                      "value": "0"
                    }
                  ],
                  "name": "Abfrage - 19",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "",
                    "size": 3,
                    "title": "AlwaysOn Waitstats ({Days:label})",
                    "noDataMessage": "No data.",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "avgPerc",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "avgWaitc",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "avgWaits",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "avg2Waits",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "avgRes",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "avg2Res",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "avgSigs",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "avg2Sig",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 5
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "WaitType_s",
                          "label": "Waitytype"
                        },
                        {
                          "columnId": "avgPerc",
                          "label": "Percent"
                        },
                        {
                          "columnId": "avgWaitc",
                          "label": "Counts"
                        },
                        {
                          "columnId": "avgWaits",
                          "label": "Seconds"
                        },
                        {
                          "columnId": "avg2Waits",
                          "label": "Sec./Wait"
                        },
                        {
                          "columnId": "avgRes",
                          "label": "Res.waits Sec. "
                        },
                        {
                          "columnId": "avg2Res",
                          "label": "Sec./Res.wait",
                          "comment": "Seconds per Resourcewait"
                        },
                        {
                          "columnId": "avgSigs",
                          "label": "Signal Sec."
                        },
                        {
                          "columnId": "avg2Sig",
                          "label": "Sec./Sig.wait",
                          "comment": "Seconds per Signalwait"
                        }
                      ]
                    }
                  },
                  "customWidth": "65",
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selectedTab",
                      "comparison": "isEqualTo",
                      "value": "5"
                    },
                    {
                      "parameterName": "1",
                      "comparison": "isEqualTo",
                      "value": "1"
                    }
                  ],
                  "name": "AOWaitStats - Copy",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "MSSQL_AOFailovers_CL\r\n| where server_name_s <> '-'\r\n| where todatetime(column_ifexists('timestamp_t','timestamp_s')) {Days}\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| project server_name_s, column_ifexists('timestamp_t','timestamp_s'), Message\r\n| take 250\r\n\r\n",
                    "size": 1,
                    "title": "AlwaysOn Failovers ({Days:label})",
                    "noDataMessage": "No Failovers in the given time frame.",
                    "timeContext": {
                      "durationMs": 86400000
                    },
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "customWidth": "35",
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selectedTab",
                      "comparison": "isEqualTo",
                      "value": "5"
                    },
                    {
                      "parameterName": "param_ao_failover_table_exists",
                      "comparison": "isEqualTo",
                      "value": "0"
                    }
                  ],
                  "name": "AOFailovers",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "title": "Backup Metrics",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "MSSQL_BckBackups_CL\r\n| where todatetime(BackupFinishDate_s) {Days} and PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| summarize avg(todecimal(column_ifexists('BackupDurationSec_d','BackupDurationSec_s'))) by todatetime(BackupFinishDate_s), BackupType_s\r\n\r\n",
                          "size": 0,
                          "aggregation": 4,
                          "title": "Backup Duration",
                          "noDataMessage": "No backup found in the selected time frame.",
                          "timeContext": {
                            "durationMs": 604800000
                          },
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "visualization": "linechart",
                          "tileSettings": {
                            "showBorder": false
                          },
                          "chartSettings": {
                            "xAxis": "BackupFinishDate_s",
                            "group": "BackupType_s",
                            "createOtherGroup": null,
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 24,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true
                                }
                              }
                            }
                          }
                        },
                        "customWidth": "50",
                        "conditionalVisibilities": [
                          {
                            "parameterName": "selectedTab",
                            "comparison": "isEqualTo",
                            "value": "6"
                          },
                          {
                            "parameterName": "param_backup_table_exists",
                            "comparison": "isEqualTo",
                            "value": "0"
                          }
                        ],
                        "name": "BackupDuration",
                        "styleSettings": {
                          "showBorder": true
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "MSSQL_BckBackups_CL\r\n| where todatetime(BackupFinishDate_s) {Days} and PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| summarize avg(todecimal(column_ifexists('BackupSize_d','BackupSize_s'))) by todatetime(BackupFinishDate_s), BackupType_s\r\n\r\n",
                          "size": 0,
                          "aggregation": 4,
                          "title": "Backup Sizes",
                          "noDataMessage": "No backup found in the selected time frame.",
                          "timeContext": {
                            "durationMs": 86400000
                          },
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "visualization": "linechart",
                          "chartSettings": {
                            "xAxis": "BackupFinishDate_s",
                            "group": "BackupType_s",
                            "createOtherGroup": null,
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 4,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true
                                }
                              }
                            }
                          }
                        },
                        "customWidth": "50",
                        "conditionalVisibilities": [
                          {
                            "parameterName": "selectedTab",
                            "comparison": "isEqualTo",
                            "value": "6"
                          },
                          {
                            "parameterName": "param_backup_table_exists",
                            "comparison": "isEqualTo",
                            "value": "0"
                          }
                        ],
                        "name": "BackupSize",
                        "styleSettings": {
                          "showBorder": true
                        }
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "6"
                  },
                  "name": "BackupMetrics"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "MSSQL_BckBackups_CL\r\n| where todatetime(BackupFinishDate_s) {Days} and PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| summarize by sapsid_s, DBName_s, BackupFinishDate_s, BackupSet_s, Description_s, BackupType_s, BackupDuration_s, column_ifexists('BackupSize_d','BackupSize_s'), column_ifexists('BackupSetID_d','BackupSetID_s')\r\n| order by BackupFinishDate_s desc\r\n",
                    "size": 3,
                    "title": "Backups ({Days:label})",
                    "noDataMessage": "No backups in the given time frame.",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "BackupType_s",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Log",
                                "representation": "gray",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Full",
                                "representation": "green"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Differential",
                                "representation": "turquoise"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ],
                            "compositeBarSettings": {
                              "labelText": "",
                              "columnSettings": []
                            }
                          }
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "DBName_s",
                          "label": "Database"
                        },
                        {
                          "columnId": "BackupFinishDate_s",
                          "label": "Finished (UTC)"
                        },
                        {
                          "columnId": "BackupSet_s",
                          "label": "Backupname"
                        },
                        {
                          "columnId": "Description_s",
                          "label": "Description"
                        },
                        {
                          "columnId": "BackupType_s",
                          "label": "Type"
                        },
                        {
                          "columnId": "BackupDuration_s",
                          "label": "Duration"
                        },
                        {
                          "columnId": "BackupSize_d",
                          "label": "Size (MB)"
                        },
                        {
                          "columnId": "DeviceName_s",
                          "label": "Backupdevice"
                        },
                        {
                          "columnId": "BackupSetID_d",
                          "label": "BackupSetID"
                        }
                      ]
                    }
                  },
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selectedTab",
                      "comparison": "isEqualTo",
                      "value": "6"
                    },
                    {
                      "parameterName": "param_backup_table_exists",
                      "comparison": "isEqualTo",
                      "value": "0"
                    }
                  ],
                  "name": "Backups",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let LastOne = MSSQL_BlockingProcesses_CL\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| where TimeGenerated {Days}\r\n| summarize TimeGenerated = max(TimeGenerated)\r\n| project TimeGenerated;\r\nMSSQL_BlockingProcesses_CL \r\n| join kind=inner (LastOne) on TimeGenerated\r\n| where column_ifexists('spid_s', 'spid_d') != \"-\"\r\n| project\r\n    TimeGenerated,\r\n    type = type_s,\r\n    spid = column_ifexists('spid_s', spid_d),\r\n    blocked = column_ifexists('blocked_s', blocked_d),\r\n    cmd = cmd_s,\r\n    status = status_s,\r\n    wait_time = column_ifexists('waittime_s', waittime_d),\r\n    last_wait_type = lastwaittype_s,\r\n    wait_resource = waitresource_s,\r\n    program_name = program_name_s,\r\n    dbid = column_ifexists('dbid_s', dbid_d),\r\n    uid = column_ifexists('uid_s', uid_d),\r\n    cpu = column_ifexists('cpu_s', cpu_d),\r\n    phusical_io = column_ifexists('physical_io_s', physical_io_d),\r\n    memusage = column_ifexists('memusage_s', memusage_d),\r\n    login_time = column_ifexists('login_time_s', login_time_t),\r\n    last_batch = column_ifexists('last_batch_s', last_batch_t),\r\n    ecid = column_ifexists('ecid_s', ecid_d),\r\n    open_tran = column_ifexists('open_tran_s', open_tran_d),\r\n    host_name = hostname_s,\r\n    host_process = hostprocess_s\r\n| order by TimeGenerated, type asc\r\n\r\n\r\n",
                    "size": 1,
                    "title": "Actual blocking Processes",
                    "noDataMessage": "No current blocking processes.",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "type_s",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "BLOCKER",
                                "representation": "error",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "blocked",
                                "representation": "warning",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "TimeGenerated",
                          "label": "Time"
                        },
                        {
                          "columnId": "type_s",
                          "label": "Type"
                        },
                        {
                          "columnId": "spid_s",
                          "label": "SPID"
                        },
                        {
                          "columnId": "blocked_s",
                          "label": "Blocked"
                        },
                        {
                          "columnId": "cmd_s",
                          "label": "Command"
                        },
                        {
                          "columnId": "status_s",
                          "label": "Status"
                        },
                        {
                          "columnId": "waittime_s",
                          "label": "Wait Time"
                        },
                        {
                          "columnId": "lastwaittype_s",
                          "label": "Last Wait Type"
                        },
                        {
                          "columnId": "waitresource_s",
                          "label": "Wait Resource"
                        },
                        {
                          "columnId": "program_name_s",
                          "label": "Program Name"
                        },
                        {
                          "columnId": "dbid_s",
                          "label": "DB"
                        },
                        {
                          "columnId": "uid_s",
                          "label": "User"
                        },
                        {
                          "columnId": "cpu_s",
                          "label": "CPU"
                        },
                        {
                          "columnId": "physical_io_s",
                          "label": "physical IO"
                        },
                        {
                          "columnId": "memusage_s",
                          "label": "Memory"
                        },
                        {
                          "columnId": "login_time_s",
                          "label": "Login"
                        },
                        {
                          "columnId": "last_batch_s",
                          "label": "last Batch"
                        },
                        {
                          "columnId": "ecid_s",
                          "label": "Execution Context"
                        },
                        {
                          "columnId": "open_tran_s",
                          "label": "open Transaction"
                        },
                        {
                          "columnId": "hostname_s",
                          "label": "Hostname"
                        },
                        {
                          "columnId": "hostprocess_s",
                          "label": "Hostprocess"
                        }
                      ]
                    }
                  },
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selectedTab",
                      "comparison": "isEqualTo",
                      "value": "4"
                    },
                    {
                      "parameterName": "param_blocking_processes_table_exists",
                      "comparison": "isEqualTo",
                      "value": "0"
                    }
                  ],
                  "name": "Blockings",
                  "styleSettings": {
                    "showBorder": true
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "provider_table_exists",
              "comparison": "isEqualTo",
              "value": "1"
            },
            "name": "MetricsGroup"
          }
        ]
      },
      "name": "Monitoring Group"
    }
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}