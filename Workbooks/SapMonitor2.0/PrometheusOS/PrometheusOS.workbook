{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "loadType": "always",
        "items": [
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "393b2985-42a8-41df-8c73-12688b39a061",
                  "version": "KqlParameterItem/1.0",
                  "name": "param_provider_type",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "value": "PrometheusOS"
                },
                {
                  "id": "7cf896d4-3b93-4eb6-b8bf-cc5ef0b7b131",
                  "version": "KqlParameterItem/1.0",
                  "name": "param_ams_resource",
                  "type": 5,
                  "isHiddenWhenLocked": true,
                  "typeSettings": {
                    "resourceTypeFilter": {
                      "microsoft.workloads/monitors": true,
                      "microsoft.hanaonazure/sapmonitors": true
                    },
                    "additionalResourceOptions": [
                      "value::1"
                    ],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "defaultValue": "value::1"
                },
                {
                  "id": "a0a35526-759b-4cca-97f1-21010e0a5f3e",
                  "version": "KqlParameterItem/1.0",
                  "name": "param_provider_instance",
                  "type": 1,
                  "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"{param_ams_resource}/providerInstances/\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2022-11-01-preview\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value[?(@.properties.provisioningState == 'Succeeded' && @.properties.providerSettings.providerType == '{param_provider_type}')].name\",\"columns\":[]}}]}",
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 12
                },
                {
                  "id": "86cfee2a-ad2d-4cee-b219-369ecb6f4cdd",
                  "version": "KqlParameterItem/1.0",
                  "name": "param_alert_template",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "typeSettings": {
                    "multiLineText": true,
                    "editorLanguage": "text"
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "value": "[\r\n  {\r\n    \"name\": \"[Linux OS] - High CPU usage percent\",\r\n    \"description\": \"Fired when an Operating System CPU utilization percentage exceeds the specified threshold.\",\r\n    \"author\": \"Microsoft\",\r\n    \"templateId\": \"os-cpu-utilization-percent\",\r\n    \"severity\": \"2\",\r\n    \"alertTemplate\": {\r\n      \"query\": \"let raw_data = (Prometheus_OSExporter_CL | where name_s has 'cpu' and instance_s == '{ProviderInstance}' | extend labels = parse_json(labels_s) | extend mode = tostring(labels.mode)); let time_spent_by_system = ( raw_data | where mode == 'user' | summarize cpu_time_spent = sum(value_d), TimeGenerated = min(TimeGenerated) by  correlation_id_g); let time_spen_in_all_modes = ( raw_data |summarize time_spent_all_modes = sum(value_d), TimeGenerated = min(TimeGenerated) by correlation_id_g); time_spent_by_system | join kind=inner time_spen_in_all_modes on correlation_id_g | summarize AggregatedValue = (max(cpu_time_spent)-min(cpu_time_spent))*100/(max(time_spent_all_modes)-min(time_spent_all_modes)) by bin(TimeGenerated, 5m)\",\r\n      \"thresholdOperator\": \"GreaterThan\",\r\n      \"defaultThreshold\": \"90\",\r\n      \"alertUnit\": \"percent\",\r\n      \"metricMeasurement\": {\r\n        \"thresholdOperator\": \"GreaterThan\",\r\n        \"threshold\": \"3\",\r\n        \"metricTriggerType\": \"Consecutive\",\r\n        \"metricColumn\": \"PROVIDER_INSTANCE_s\",\r\n        \"frequencyInMinutes\": \"10\",\r\n        \"timeWindowInMinutes\": \"45\"\r\n      }\r\n    }\r\n  },\r\n  {\r\n    \"name\": \"[Linux OS] - High memory usage percent\",\r\n    \"description\": \"Fired when an Operating system memory utilization percentage exceeds the specified threshold.\",\r\n    \"author\": \"Microsoft\",\r\n    \"templateId\": \"os-high-memory-usage\",\r\n    \"severity\": \"2\",\r\n    \"alertTemplate\": {\r\n      \"query\": \"let modified_table = Prometheus_OSExporter_CL | where instance_s == '{ProviderInstance}'; let Free_Memory_Table = modified_table | where name_s == 'node_memory_MemFree_bytes' | project-away Computer,RawData,Type,_ResourceId,SourceSystem,MG,ManagementGroupName,TenantId | project-rename free_memory = value_d; Free_Memory_Table | summarize AggregatedValue = avg(free_memory)/1000000 by bin(TimeGenerated, 5m)\",\r\n      \"thresholdOperator\": \"LessThan\",\r\n      \"defaultThreshold\": \"5000\",\r\n      \"alertUnit\": \"MB\",\r\n      \"metricMeasurement\": {\r\n        \"thresholdOperator\": \"LessThan\",\r\n        \"threshold\": \"3\",\r\n        \"metricTriggerType\": \"Consecutive\",\r\n        \"metricColumn\": \"PROVIDER_INSTANCE_s\",\r\n        \"frequencyInMinutes\": \"10\",\r\n        \"timeWindowInMinutes\": \"45\"\r\n      }\r\n    }\r\n  },\r\n  {\r\n    \"name\": \"[Linux OS] - High Disk Read MB per Sec\",\r\n    \"description\": \"Fired when an Operating system Disk Read MegaBytes per second exceeds the specified threshold.\",\r\n    \"author\": \"Microsoft\",\r\n    \"templateId\": \"os-disk-read\",\r\n    \"severity\": \"2\",\r\n    \"alertTemplate\": {\r\n      \"query\": \"Prometheus_OSExporter_CL | where instance_s == '{ProviderInstance}' and (name_s == 'node_disk_read_bytes_total') | project-away Computer,RawData,Type,_ResourceId,SourceSystem,MG,ManagementGroupName,TenantId | extend device = tostring(parse_json(labels_s).device) | where name_s == 'node_disk_read_bytes_total' | summarize avg_read_mb = (avg(value_d))/1000000 by device, bin(TimeGenerated, 5m) | extend AggregatedValue = avg_read_mb/300\",\r\n      \"thresholdOperator\": \"GreaterThan\",\r\n      \"defaultThreshold\": \"100\",\r\n      \"alertUnit\": \"MB\",\r\n      \"metricMeasurement\": {\r\n        \"thresholdOperator\": \"LessThan\",\r\n        \"threshold\": \"3\",\r\n        \"metricTriggerType\": \"Consecutive\",\r\n        \"metricColumn\": \"PROVIDER_INSTANCE_s\",\r\n        \"frequencyInMinutes\": \"10\",\r\n        \"timeWindowInMinutes\": \"45\"\r\n      }\r\n    }\r\n  }\r\n]"
                },
                {
                  "id": "4b6409c6-600d-49be-b6de-5f6863f61403",
                  "version": "KqlParameterItem/1.0",
                  "name": "osProviderExist",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "param_provider_instance",
                        "operator": "is Empty",
                        "rightValType": "param",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                }
              ],
              "style": "above",
              "queryType": 12
            },
            "name": "parameters - 6"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "### No active OS (Linux) provider found.\r\nCreate one or more OS (Linux) providers to get started. [Learn More](https://learn.microsoft.com/en-us/azure/sap/monitor/provider-linux)",
                    "style": "warning"
                  },
                  "name": "text - 0"
                },
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "list",
                    "links": [
                      {
                        "id": "17108865-b53f-48c3-830e-58f5a6510e4a",
                        "cellValue": "{param_ams_resource}",
                        "linkTarget": "Resource",
                        "linkLabel": "Create Provider",
                        "subTarget": "monitor_provider",
                        "preText": "",
                        "style": "primary",
                        "bladeOpenContext": {
                          "bladeName": "ManageProviderv2.ReactView",
                          "extensionName": "Microsoft_Azure_WorkloadMonitor",
                          "bladeParameters": [
                            {
                              "name": "resourceId",
                              "source": "parameter",
                              "value": "param_ams_resource"
                            }
                          ]
                        }
                      }
                    ]
                  },
                  "name": "links - 1"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "osProviderExist",
              "comparison": "isEqualTo",
              "value": "false"
            },
            "name": "No active provider warning"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "d247dd32-c3b4-4c2e-8da1-ae98f2d993da",
                  "version": "KqlParameterItem/1.0",
                  "name": "provider_table_exists",
                  "type": 1,
                  "description": "Check if the provider table exists in the logs space",
                  "query": "let hasNonEmptyTable = (T:string) \r\n{ \r\ntoscalar( union isfuzzy=true ( table(T) | count as Count ), (print Count=0) | summarize sum(Count) ) > 0\r\n};\r\nlet TableName = 'Prometheus_OSExporter_CL';\r\nprint present=iif(hasNonEmptyTable(TableName), \"1\", \"0\")",
                  "isHiddenWhenLocked": true,
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "provider-table-check"
          },
          {
            "type": 1,
            "content": {
              "json": "The workbook is loading. This can take up to 2 minutes.",
              "style": "info"
            },
            "conditionalVisibility": {
              "parameterName": "osProviderExist",
              "comparison": "isEqualTo"
            },
            "name": "text - 5"
          },
          {
            "type": 1,
            "content": {
              "json": "If the provider is recently added, it may take up to 15 minutes for the initial telemetry information to be available for review. Else, check if system is down, or health of AMS system is degraded.",
              "style": "warning"
            },
            "conditionalVisibilities": [
              {
                "parameterName": "osProviderExist",
                "comparison": "isEqualTo",
                "value": "true"
              },
              {
                "parameterName": "provider_table_exists",
                "comparison": "isEqualTo",
                "value": "0"
              }
            ],
            "name": " No data exists warning"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "## Operating system metrics"
                  },
                  "name": "Heading text"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "a3f7ea14-e155-4147-bd18-482975ba1cf5",
                        "version": "KqlParameterItem/1.0",
                        "name": "hostname",
                        "label": "Host name",
                        "type": 2,
                        "description": "Select the host that needs to be monitored",
                        "isRequired": true,
                        "query": "Prometheus_OSExporter_CL\r\n| where name_s contains \"uname\"\r\n| extend hostname = parse_json(labels_s).nodename\r\n| distinct tostring(hostname)\r\n",
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::1"
                          ],
                          "showDefault": false
                        },
                        "defaultValue": "value::1",
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      }
                    ],
                    "style": "pills",
                    "doNotRunWhenHidden": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "customWidth": "50",
                  "name": "Hostname parameter"
                },
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "nav",
                    "links": [
                      {
                        "id": "a416b003-9d14-4634-9011-567b2f4268bb",
                        "linkTarget": "WorkbookTemplate",
                        "linkLabel": "Alerts",
                        "style": "primary",
                        "workbookContext": {
                          "componentIdSource": "workbook",
                          "resourceIdsSource": "workbook",
                          "templateIdSource": "static",
                          "templateId": "Community-Workbooks/SapMonitor2.0/Alerts/Alerts",
                          "typeSource": "workbook",
                          "gallerySource": "workbook",
                          "locationSource": "default",
                          "passSpecificParams": true,
                          "templateParameters": [
                            {
                              "name": "AlertTemplates",
                              "source": "parameter",
                              "value": "param_alert_template"
                            },
                            {
                              "name": "ProviderType",
                              "source": "parameter",
                              "value": "param_provider_type"
                            }
                          ]
                        }
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "links - 4"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "74e5374f-8a22-4fd9-b4a7-72a9985a7b40",
                        "version": "KqlParameterItem/1.0",
                        "name": "instance",
                        "type": 1,
                        "description": "Contains the Ip:port for the selected hostname",
                        "query": "Prometheus_OSExporter_CL\r\n|where name_s == \"node_uname_info\"\r\n|extend hostname = parse_json(labels_s).nodename\r\n|where hostname == '{hostname}'\r\n|order by TimeGenerated desc\r\n| summarize arg_max(TimeGenerated,instance_s)\r\n| project instance_s",
                        "isHiddenWhenLocked": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "9502bd61-fd80-4c05-a856-51fa54fe2fe9",
                        "version": "KqlParameterItem/1.0",
                        "name": "kernelVersion",
                        "type": 1,
                        "description": "List the OS type on the host",
                        "query": "Prometheus_OSExporter_CL\r\n|where name_s == \"node_uname_info\"\r\n|extend hostname = parse_json(labels_s).nodename\r\n|where hostname == '{hostname}'\r\n|order by TimeGenerated desc\r\n|top 1 by tostring(hostname)\r\n|project kernelVersion = parse_json(labels_s).release",
                        "isHiddenWhenLocked": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "95195171-0c48-43ca-bc55-adefe9450fca",
                        "version": "KqlParameterItem/1.0",
                        "name": "latestTimeCheck",
                        "type": 1,
                        "description": "To check if any data is received for the host in the last 5mins",
                        "query": "let instanceSet = Prometheus_OSExporter_CL\r\n| where instance_s == '{instance}'\r\n| summarize count();\r\n\r\nlet rows=Prometheus_OSExporter_CL\r\n| where instance_s == '{instance}' and name_s contains \"cpu\" and TimeGenerated > ago(5m)\r\n|summarize count();\r\n\r\nprint present=iff(toscalar(instanceSet)==\"0\",\"2\",iff(toscalar(rows)==\"0\",\"0\",\"1\"))",
                        "isHiddenWhenLocked": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "82a77084-fe96-4227-b565-6d61cd60b733",
                        "version": "KqlParameterItem/1.0",
                        "name": "lastTime",
                        "type": 1,
                        "description": "Last timestamp for the data received",
                        "query": "Prometheus_OSExporter_CL\r\n| where instance_s == '{instance}' and name_s contains \"cpu\"\r\n|top 1 by TimeGenerated desc\r\n|project TimeGenerated",
                        "isHiddenWhenLocked": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      }
                    ],
                    "style": "pills",
                    "doNotRunWhenHidden": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "{hostname}",
                    "comparison": "isNotEqualTo",
                    "value": "null"
                  },
                  "name": "instance parameter"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "## System information\r\n---\r\n<b style=\"color:DodgerBlue;\">Hostname :</b> {hostname}</br>\r\n<b style=\"color:DodgerBlue;\">Kernel version :</b> {kernelVersion}"
                  },
                  "customWidth": "50",
                  "name": "System information "
                },
                {
                  "type": 1,
                  "content": {
                    "json": "Please note that we have stopped receiving telemetry data for {hostname}. The last telemetry was received at \"{lastTime}\", please make sure that both the host and node_exporter agent is up and running to fetch the latest values.\r\n\r\n",
                    "style": "warning"
                  },
                  "conditionalVisibilities": [
                    {
                      "parameterName": "{instance}",
                      "comparison": "isNotEqualTo",
                      "value": "null"
                    },
                    {
                      "parameterName": "latestTimeCheck",
                      "comparison": "isEqualTo",
                      "value": "0"
                    }
                  ],
                  "name": "Warning for no data received"
                },
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "tabs",
                    "links": [
                      {
                        "id": "1d02b596-33bd-42ba-99fd-833f6d9127a6",
                        "cellValue": "tab_value",
                        "linkTarget": "parameter",
                        "linkLabel": "Overview",
                        "subTarget": "1",
                        "style": "link"
                      },
                      {
                        "id": "69319f35-5a75-4097-bb86-7f19d178d94c",
                        "cellValue": "tab_value",
                        "linkTarget": "parameter",
                        "linkLabel": "CPU",
                        "subTarget": "2",
                        "style": "link"
                      },
                      {
                        "id": "6fe1401d-2661-4a79-9495-9dd2729fc59b",
                        "cellValue": "tab_value",
                        "linkTarget": "parameter",
                        "linkLabel": "Memory",
                        "subTarget": "3",
                        "style": "link"
                      },
                      {
                        "id": "3c479394-8691-4126-9ea1-3e82e136de42",
                        "cellValue": "tab_value",
                        "linkTarget": "parameter",
                        "linkLabel": "Disk",
                        "subTarget": "4",
                        "style": "link"
                      },
                      {
                        "id": "757ef638-d38a-452b-aad5-bb88c0b02a58",
                        "cellValue": "tab_value",
                        "linkTarget": "parameter",
                        "linkLabel": "Network",
                        "subTarget": "5",
                        "style": "link"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "{instance}",
                    "comparison": "isNotEqualTo",
                    "value": "null"
                  },
                  "name": "Main tabs - Copy"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "//Last boot time\r\nlet a = Prometheus_OSExporter_CL\r\n|where name_s == \"node_boot_time_seconds\" and instance_s == '{instance}'\r\n|top 1 by TimeGenerated desc\r\n|project correlation_id_g,value_d;\r\n\r\n//Current system time\r\nlet b = Prometheus_OSExporter_CL\r\n|where name_s == \"node_time_seconds\" and instance_s == '{instance}'\r\n|project correlation_id_g,value_d;\r\n\r\na\r\n|join b on correlation_id_g\r\n|extend name = \"System Uptime\"\r\n|project name,abs(value_d1-value_d)",
                          "size": 3,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "name",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "Column1",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "none"
                              },
                              "numberFormat": {
                                "unit": 24,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": false,
                                  "minimumIntegerDigits": 1,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            "showBorder": true,
                            "size": "auto"
                          }
                        },
                        "customWidth": "25",
                        "name": "System uptime query"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "\tPrometheus_OSExporter_CL\r\n\t|where name_s == \"node_cpu_seconds_total\" and instance_s == '{instance}'\r\n\t|extend core = parse_json(labels_s).cpu\r\n\t|distinct tostring(core)\r\n\t|summarize count = count()\r\n    |extend core = \"CPU Cores\"",
                          "size": 3,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "core",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "count",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "none"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": false,
                                  "maximumFractionDigits": 2,
                                  "maximumSignificantDigits": 3
                                }
                              }
                            },
                            "showBorder": true
                          }
                        },
                        "customWidth": "25",
                        "name": "CPU core count query"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "Prometheus_OSExporter_CL\r\n|where name_s == \"node_memory_MemTotal_bytes\" and instance_s == '{instance}'\r\n|top 1 by TimeGenerated desc\r\n|project value_d\r\n|extend name = \"Total RAM\"",
                          "size": 3,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "name",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "value_d",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "none"
                              },
                              "numberFormat": {
                                "unit": 36,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": false,
                                  "minimumIntegerDigits": 1,
                                  "maximumFractionDigits": 2,
                                  "maximumSignificantDigits": 3
                                }
                              }
                            },
                            "showBorder": true
                          }
                        },
                        "customWidth": "25",
                        "name": "query - 11"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "Prometheus_OSExporter_CL\r\n|where name_s == \"node_memory_SwapTotal_bytes\" and instance_s == '{instance}'\r\n|top 1 by TimeGenerated desc\r\n|project value_d\r\n|extend name = \"Total swap\"",
                          "size": 3,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "name",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "value_d",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "none"
                              },
                              "numberFormat": {
                                "unit": 36,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": false,
                                  "minimumIntegerDigits": 1,
                                  "maximumFractionDigits": 2,
                                  "maximumSignificantDigits": 3
                                }
                              }
                            },
                            "showBorder": true
                          }
                        },
                        "customWidth": "25",
                        "name": "query - 12"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "7e1ba196-49f1-4166-85dc-e3c1b2f3d2c9",
                              "version": "KqlParameterItem/1.0",
                              "name": "OverviewTimeRange",
                              "type": 4,
                              "value": {
                                "durationMs": 1800000
                              },
                              "isHiddenWhenLocked": true,
                              "typeSettings": {
                                "selectableValues": [
                                  {
                                    "durationMs": 1800000
                                  }
                                ]
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "parameters - 6"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "//Query to calculate avg cpu usage per mode in last 5mins\r\nlet modified_table = Prometheus_OSExporter_CL\r\n|where name_s contains \"cpu\" and instance_s == '{instance}'\r\nand TimeGenerated > ago(5m)\r\n|project-away Computer,RawData,Type,_ResourceId,SourceSystem,MG,ManagementGroupName,TenantId\r\n|extend labels = parse_json(labels_s)\r\n|extend cpu_core = tostring(labels.cpu), mode = tostring(labels.mode);\r\nlet time_spent_per_mode_table = modified_table\r\n|summarize time_spent_per_mode = sum(value_d), TimeGenerated = min(TimeGenerated) by  correlation_id_g,tostring(mode);\r\nlet time_spent_in_all_modes = modified_table\r\n|summarize time_spent_all_modes = sum(value_d), TimeGenerated = min(TimeGenerated) by correlation_id_g;\r\ntime_spent_in_all_modes\r\n|join time_spent_per_mode_table on correlation_id_g\r\n|summarize time_spent_per_mode = (max(time_spent_per_mode)-min(time_spent_per_mode))*100/(max(time_spent_all_modes)-min(time_spent_all_modes)) by tostring(mode)",
                          "size": 3,
                          "title": "Avg CPU usage per mode (Last 5m)",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "visualization": "piechart",
                          "chartSettings": {
                            "yAxis": [
                              "time_spent_per_mode"
                            ],
                            "seriesLabelSettings": [
                              {
                                "seriesName": "idle",
                                "label": "Idle"
                              },
                              {
                                "seriesName": "user",
                                "label": "User"
                              },
                              {
                                "seriesName": "system",
                                "label": "System"
                              },
                              {
                                "seriesName": "iowait",
                                "label": "Iowait"
                              },
                              {
                                "seriesName": "nice",
                                "label": "Nice"
                              },
                              {
                                "seriesName": "Other",
                                "label": "Others"
                              }
                            ],
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "minimumIntegerDigits": 1,
                                  "minimumFractionDigits": 0,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          }
                        },
                        "customWidth": "50",
                        "name": "Cpu usage in last 5 mins query",
                        "styleSettings": {
                          "showBorder": true
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "//Query to calculate avg cpu usage per mode in last 15mins\r\nlet modified_table = Prometheus_OSExporter_CL\r\n|where name_s contains \"cpu\" and instance_s == '{instance}'\r\nand TimeGenerated > ago(15m)\r\n|project-away Computer,RawData,Type,_ResourceId,SourceSystem,MG,ManagementGroupName,TenantId\r\n|extend labels = parse_json(labels_s)\r\n|extend cpu_core = tostring(labels.cpu), mode = tostring(labels.mode);\r\nlet time_spent_per_mode_table = modified_table\r\n|summarize time_spent_per_mode = sum(value_d), TimeGenerated = min(TimeGenerated) by  correlation_id_g,tostring(mode);\r\nlet time_spent_in_all_modes = modified_table\r\n|summarize time_spent_all_modes = sum(value_d), TimeGenerated = min(TimeGenerated) by correlation_id_g;\r\ntime_spent_in_all_modes\r\n|join time_spent_per_mode_table on correlation_id_g\r\n|summarize time_spent_per_mode = (max(time_spent_per_mode)-min(time_spent_per_mode))*100/(max(time_spent_all_modes)-min(time_spent_all_modes)) by tostring(mode)\r\n",
                          "size": 3,
                          "title": "Avg CPU usage per mode (Last 15m)",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "visualization": "piechart",
                          "chartSettings": {
                            "yAxis": [
                              "time_spent_per_mode"
                            ],
                            "seriesLabelSettings": [
                              {
                                "seriesName": "idle",
                                "label": "Idle"
                              },
                              {
                                "seriesName": "user",
                                "label": "User"
                              },
                              {
                                "seriesName": "system",
                                "label": "System"
                              },
                              {
                                "seriesName": "iowait",
                                "label": "Iowait"
                              },
                              {
                                "seriesName": "nice",
                                "label": "Nice"
                              },
                              {
                                "seriesName": "Other",
                                "label": "Others"
                              }
                            ],
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "minimumIntegerDigits": 1,
                                  "minimumFractionDigits": 0,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          }
                        },
                        "customWidth": "50",
                        "name": "Cpu usage in last 15 mins query - Copy",
                        "styleSettings": {
                          "showBorder": true
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "//Query to calculate memory distribution\r\nlet modified_table = Prometheus_OSExporter_CL\r\n|where instance_s == '{instance}' and TimeGenerated {OverviewTimeRange};\r\n\r\nlet Total_Memory_Table = modified_table\r\n|where name_s == \"node_memory_MemTotal_bytes\"\r\n|project-away Computer,RawData,Type,_ResourceId,SourceSystem,MG,ManagementGroupName,TenantId\r\n|project-rename total_memory = value_d;\r\n\r\nlet Available_Memory_Table = modified_table\r\n|where name_s == \"node_memory_MemFree_bytes\"\r\n|project-away Computer,RawData,Type,_ResourceId,SourceSystem,MG,ManagementGroupName,TenantId\r\n|project-rename available_memory = value_d;\r\n\r\nlet table1 = Total_Memory_Table\r\n|join Available_Memory_Table on correlation_id_g\r\n|extend used_memory = (total_memory - available_memory)\r\n|make-series trend = max(used_memory) default=0 on TimeGenerated from {OverviewTimeRange:start} to {OverviewTimeRange:end} step 5m\r\n|extend label = \"1\";\r\n\r\nlet table2 = Total_Memory_Table\r\n|join Available_Memory_Table on correlation_id_g\r\n|extend used_memory = (total_memory - available_memory)\r\n|summarize avg_used_memory_percentage = avg(used_memory)*100/max(total_memory)\r\n|extend label = \"1\";\r\n\r\ntable1\r\n|join table2 on label\r\n|project-away label1",
                          "size": 0,
                          "title": "Avg Memory usage (Last 30m)",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "visualization": "tiles",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "used",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "free",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "buffers",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "cached",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "total",
                                "formatter": 22,
                                "formatOptions": {
                                  "compositeBarSettings": {
                                    "labelText": "",
                                    "columnSettings": [
                                      {
                                        "columnName": "used",
                                        "color": "redBright"
                                      },
                                      {
                                        "columnName": "free",
                                        "color": "green"
                                      },
                                      {
                                        "columnName": "buffers",
                                        "color": "greenDark"
                                      },
                                      {
                                        "columnName": "cached",
                                        "color": "greenDarkDark"
                                      }
                                    ]
                                  }
                                }
                              }
                            ]
                          },
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "tileName"
                            },
                            "leftContent": {
                              "columnMatch": "avg_used_memory_percentage",
                              "formatter": 12,
                              "formatOptions": {
                                "min": 0,
                                "max": 100,
                                "palette": "greenRed"
                              },
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": false,
                                  "minimumIntegerDigits": 1,
                                  "maximumFractionDigits": 2
                                }
                              },
                              "tooltipFormat": {
                                "tooltip": "Avg memory usage for last 30mins"
                              }
                            },
                            "secondaryContent": {
                              "columnMatch": "trend",
                              "formatter": 9,
                              "formatOptions": {
                                "min": 0,
                                "palette": "blue"
                              },
                              "tooltipFormat": {
                                "tooltip": "Memory usage trend for last 30mins"
                              }
                            },
                            "showBorder": true
                          }
                        },
                        "customWidth": "27",
                        "name": "Memory utilisation overview-1"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "//Query to get used and available space statistics for each filesystem\r\n//in last 30 minutes \r\nlet Total_Filesystem_Space_Table = Prometheus_OSExporter_CL\r\n|where instance_s == '{instance}' and TimeGenerated > ago(30m) and name_s == \"node_filesystem_size_bytes\"\r\n|project-away Computer,RawData,Type,_ResourceId,SourceSystem,MG,ManagementGroupName,TenantId\r\n|extend labels = parse_json(labels_s)\r\n|extend device= labels.device, fstype = labels.fstype, mountpoint = labels.mountpoint\r\n|project-rename total_filesystem_space = value_d;\r\n\r\nlet Available_Filesystem_Space_Table = Prometheus_OSExporter_CL\r\n|where instance_s == '{instance}' and TimeGenerated > ago(30m) and name_s == \"node_filesystem_avail_bytes\"\r\n|project-away Computer,RawData,Type,_ResourceId,SourceSystem,MG,ManagementGroupName,TenantId\r\n|project-rename available_filesystem_space = value_d;\r\n\r\nTotal_Filesystem_Space_Table \r\n|join Available_Filesystem_Space_Table on correlation_id_g, $left.labels_s==$right.labels_s\r\n|where tostring(fstype)== \"xfs\" or tostring(fstype)==\"nfs4\" or tostring(fstype)==\"ext4\"\r\n|extend used_filesystem_space = (total_filesystem_space-available_filesystem_space)\r\n|summarize max_used_percentage =(max(used_filesystem_space)*100)/(max(total_filesystem_space)) by tostring(mountpoint)\r\n|top 5 by max_used_percentage\r\n",
                          "size": 3,
                          "aggregation": 2,
                          "title": "Top 5 occupied filesystems (Last 30m)",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "visualization": "tiles",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "max_used",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "avg_used",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Utilisation",
                                "formatter": 22,
                                "formatOptions": {
                                  "compositeBarSettings": {
                                    "labelText": "",
                                    "columnSettings": [
                                      {
                                        "columnName": "avg_used",
                                        "color": "redBright"
                                      },
                                      {
                                        "columnName": "max_used",
                                        "color": "yellow"
                                      },
                                      {
                                        "columnName": "Utilisation",
                                        "color": "green"
                                      }
                                    ]
                                  }
                                }
                              }
                            ]
                          },
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "mountpoint",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "max_used_percentage",
                              "formatter": 12,
                              "formatOptions": {
                                "min": 0,
                                "max": 100,
                                "palette": "greenRed"
                              },
                              "numberFormat": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "minimumIntegerDigits": 1,
                                  "minimumFractionDigits": 0,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            "showBorder": false
                          },
                          "chartSettings": {
                            "yAxis": [
                              "avg_used",
                              "max_used",
                              "total_space"
                            ],
                            "xSettings": {
                              "numberFormatSettings": {
                                "unit": 0,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": false
                                }
                              }
                            },
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 36,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "minimumIntegerDigits": 1,
                                  "minimumFractionDigits": 0,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          }
                        },
                        "customWidth": "33",
                        "name": "Disk usage overview query",
                        "styleSettings": {
                          "margin": "5px",
                          "showBorder": true
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "//Query to calculate total bytes in and out of the network per interface\r\nPrometheus_OSExporter_CL\r\n|where instance_s == '{instance}' and TimeGenerated > ago(30m) and (name_s == \"node_network_transmit_bytes_total\" or name_s == \"node_network_receive_bytes_total\")\r\n|project-away Computer,RawData,Type,_ResourceId,SourceSystem,MG,ManagementGroupName,TenantId\r\n|extend interface = parse_json(labels_s).device\r\n|where interface != \"lo\"\r\n|summarize sum(value_d), TimeGenerated = min(TimeGenerated) by name_s,correlation_id_g\r\n|summarize network_bytes_total=(max(sum_value_d)-min(sum_value_d)) by name_s, bin(TimeGenerated,5m)",
                          "size": 0,
                          "aggregation": 6,
                          "title": "Total Network bytes (Last 30m)",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "visualization": "timechart",
                          "chartSettings": {
                            "yAxis": [
                              "network_bytes_total"
                            ],
                            "seriesLabelSettings": [
                              {
                                "seriesName": "node_network_transmit_bytes_total",
                                "label": "Network_out"
                              },
                              {
                                "seriesName": "node_network_receive_bytes_total",
                                "label": "Network_in"
                              }
                            ],
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 36,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "minimumIntegerDigits": 1,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          }
                        },
                        "customWidth": "40",
                        "name": "Overall network bytes total query",
                        "styleSettings": {
                          "margin": "5px",
                          "showBorder": true
                        }
                      }
                    ]
                  },
                  "conditionalVisibilities": [
                    {
                      "parameterName": "tab_value",
                      "comparison": "isEqualTo",
                      "value": "1"
                    },
                    {
                      "parameterName": "{instance}",
                      "comparison": "isNotEqualTo",
                      "value": "null"
                    }
                  ],
                  "name": "Overview group"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "19b8e1a6-a588-415c-98e5-ac695945502d",
                              "version": "KqlParameterItem/1.0",
                              "name": "cpuTimeRange",
                              "label": "Time Range",
                              "type": 4,
                              "description": "Select the required time range",
                              "value": {
                                "durationMs": 900000
                              },
                              "typeSettings": {
                                "selectableValues": [
                                  {
                                    "durationMs": 900000
                                  },
                                  {
                                    "durationMs": 1800000
                                  },
                                  {
                                    "durationMs": 3600000
                                  },
                                  {
                                    "durationMs": 14400000
                                  },
                                  {
                                    "durationMs": 43200000
                                  },
                                  {
                                    "durationMs": 86400000
                                  },
                                  {
                                    "durationMs": 172800000
                                  },
                                  {
                                    "durationMs": 259200000
                                  },
                                  {
                                    "durationMs": 604800000
                                  },
                                  {
                                    "durationMs": 1209600000
                                  },
                                  {
                                    "durationMs": 2592000000
                                  },
                                  {
                                    "durationMs": 5184000000
                                  },
                                  {
                                    "durationMs": 7776000000
                                  }
                                ],
                                "allowCustom": true
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "id": "d0325b93-bcee-4271-a0c8-c766e5f45bec",
                              "version": "KqlParameterItem/1.0",
                              "name": "cpuMode",
                              "label": "CPU Mode",
                              "type": 2,
                              "description": "Select the required cpu mode ",
                              "multiSelect": true,
                              "quote": "'",
                              "delimiter": ",",
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    { \"value\":\"idle\",\"selected\":true },\r\n    { \"value\":\"system\", \"selected\":true },\r\n    { \"value\":\"user\", \"selected\":true },\r\n    { \"value\":\"iowait\", \"selected\":true },\r\n    { \"value\":\"irq\"},\r\n    { \"value\":\"nice\"},\r\n    { \"value\":\"softirq\"},\r\n    { \"value\":\"steal\"}\r\n]",
                              "timeContext": {
                                "durationMs": 2592000000
                              }
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "parameters - 1"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "//Query to calculate cpu usage per mode\r\nlet modified_table = Prometheus_OSExporter_CL\r\n|where name_s contains \"cpu\" and instance_s == '{instance}'\r\nand TimeGenerated {cpuTimeRange}\r\n|project-away Computer,RawData,Type,_ResourceId,SourceSystem,MG,ManagementGroupName,TenantId\r\n|extend labels = parse_json(labels_s)\r\n|extend cpu_core = tostring(labels.cpu), mode = tostring(labels.mode);\r\nlet time_spent_per_mode_table = modified_table\r\n|summarize time_spent_per_mode = sum(value_d), TimeGenerated = min(TimeGenerated) by  correlation_id_g,tostring(mode);\r\nlet time_spent_in_all_modes = modified_table\r\n|summarize time_spent_all_modes = sum(value_d), TimeGenerated = min(TimeGenerated) by correlation_id_g;\r\ntime_spent_in_all_modes\r\n|join time_spent_per_mode_table on correlation_id_g\r\n|make-series time_spent_per_mode = (max(time_spent_per_mode)-min(time_spent_per_mode))*100/(max(time_spent_all_modes)-min(time_spent_all_modes)) default=0 on TimeGenerated from {cpuTimeRange:start} to {cpuTimeRange:end} step iff({cpuTimeRange:grain}==\"1m\",3m,{cpuTimeRange:grain}) by tostring(mode)\r\n|where mode in ({cpuMode})",
                          "size": 4,
                          "aggregation": 3,
                          "showAnnotations": true,
                          "title": "CPU usage timeline",
                          "noDataMessage": "The query returned no results. Please try selecting a different time range",
                          "timeBrushParameterName": "cpuTimeRange_timebrush",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "visualization": "timechart",
                          "chartSettings": {
                            "yAxis": [
                              "time_spent_per_mode"
                            ],
                            "showMetrics": false,
                            "showLegend": true,
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "minimumIntegerDigits": 1,
                                  "maximumFractionDigits": 1
                                }
                              }
                            }
                          }
                        },
                        "name": "Cpu_time_brush_query"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "//Query to calculate cpu usage per mode\r\nlet modified_table = Prometheus_OSExporter_CL\r\n|where name_s contains \"cpu\" and instance_s == '{instance}'\r\nand TimeGenerated {cpuTimeRange_timebrush}\r\n|project-away Computer,RawData,Type,_ResourceId,SourceSystem,MG,ManagementGroupName,TenantId\r\n|extend labels = parse_json(labels_s)\r\n|extend cpu_core = tostring(labels.cpu), mode = tostring(labels.mode);\r\nlet time_spent_per_mode_table = modified_table\r\n|summarize time_spent_per_mode = sum(value_d), TimeGenerated = min(TimeGenerated) by  correlation_id_g,tostring(mode);\r\nlet time_spent_in_all_modes = modified_table\r\n|summarize time_spent_all_modes = sum(value_d), TimeGenerated = min(TimeGenerated) by correlation_id_g;\r\ntime_spent_in_all_modes\r\n|join time_spent_per_mode_table on correlation_id_g\r\n|make-series percentage_cpu_usage = (max(time_spent_per_mode)-min(time_spent_per_mode))*100/(max(time_spent_all_modes)-min(time_spent_all_modes)) default=0 on TimeGenerated from {cpuTimeRange_timebrush:start} to {cpuTimeRange_timebrush:end} step iff({cpuTimeRange_timebrush:grain}==\"1m\",3m,{cpuTimeRange_timebrush:grain}) by tostring(mode)\r\n|where mode in ({cpuMode})",
                          "size": 0,
                          "aggregation": 3,
                          "title": "CPU usage",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "visualization": "timechart",
                          "chartSettings": {
                            "yAxis": [
                              "percentage_cpu_usage"
                            ],
                            "group": "mode",
                            "createOtherGroup": 50,
                            "seriesLabelSettings": [
                              {
                                "seriesName": "idle",
                                "label": "Idle"
                              },
                              {
                                "seriesName": "user",
                                "label": "User"
                              },
                              {
                                "seriesName": "system",
                                "label": "System"
                              },
                              {
                                "seriesName": "iowait",
                                "label": "Iowait"
                              },
                              {
                                "seriesName": "softirq",
                                "label": "Softirq"
                              },
                              {
                                "seriesName": "nice",
                                "label": "Nice"
                              },
                              {
                                "seriesName": "irq",
                                "label": "Irq"
                              },
                              {
                                "seriesName": "steal",
                                "label": "Steal"
                              }
                            ],
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 1,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "minimumIntegerDigits": 1,
                                  "minimumFractionDigits": 0,
                                  "maximumFractionDigits": 1
                                }
                              },
                              "min": 0,
                              "max": 100
                            }
                          }
                        },
                        "name": "query - 2"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "cd8d4923-47dc-4967-ae2b-07ba9dab1b14",
                              "version": "KqlParameterItem/1.0",
                              "name": "processTimeRange",
                              "label": "Time Range",
                              "type": 4,
                              "description": "Select the time range ",
                              "value": {
                                "durationMs": 14400000
                              },
                              "typeSettings": {
                                "selectableValues": [
                                  {
                                    "durationMs": 1800000
                                  },
                                  {
                                    "durationMs": 3600000
                                  },
                                  {
                                    "durationMs": 14400000
                                  },
                                  {
                                    "durationMs": 43200000
                                  },
                                  {
                                    "durationMs": 86400000
                                  },
                                  {
                                    "durationMs": 172800000
                                  },
                                  {
                                    "durationMs": 259200000
                                  },
                                  {
                                    "durationMs": 604800000
                                  },
                                  {
                                    "durationMs": 1209600000
                                  },
                                  {
                                    "durationMs": 2592000000
                                  },
                                  {
                                    "durationMs": 5184000000
                                  },
                                  {
                                    "durationMs": 7776000000
                                  }
                                ],
                                "allowCustom": true
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "parameters - 3"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "Prometheus_OSExporter_CL\r\n|where instance_s == '{instance}' and TimeGenerated {processTimeRange} and (name_s == \"node_procs_running\" or name_s == \"node_procs_blocked\")\r\n|project-away Computer,RawData,Type,_ResourceId,SourceSystem,MG,ManagementGroupName,TenantId\r\n|make-series Value = max(value_d) default=0 on TimeGenerated from {processTimeRange:start} to {processTimeRange:end} step {processTimeRange:grain} by name_s",
                          "size": 1,
                          "aggregation": 5,
                          "title": "Process count",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "visualization": "timechart",
                          "chartSettings": {
                            "group": "name_s",
                            "createOtherGroup": 20,
                            "seriesLabelSettings": [
                              {
                                "seriesName": "node_procs_running",
                                "label": "Running"
                              },
                              {
                                "seriesName": "node_procs_blocked",
                                "label": "Blocked"
                              }
                            ],
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 17,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "minimumIntegerDigits": 1,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          }
                        },
                        "name": "Process count query"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "Prometheus_OSExporter_CL\r\n|where instance_s == '{instance}' and TimeGenerated {processTimeRange} and name_s == \"node_forks_total\"\r\n|project-away Computer,RawData,Type,_ResourceId,SourceSystem,MG,ManagementGroupName,TenantId\r\n|make-series forks_count = (max(value_d)-min(value_d)) default=0 on TimeGenerated from {processTimeRange:start} to {processTimeRange:end} step iff({processTimeRange:grain}=='1m',3m,{processTimeRange:grain})",
                          "size": 1,
                          "aggregation": 5,
                          "title": "Forks count",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "visualization": "timechart"
                        },
                        "name": "Forks query"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "tab_value",
                    "comparison": "isEqualTo",
                    "value": "2"
                  },
                  "name": "CPU group"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "a5610f78-e8b9-477d-b0eb-da9e4ae3a57a",
                              "version": "KqlParameterItem/1.0",
                              "name": "memoryTimeRange",
                              "label": "Time Range",
                              "type": 4,
                              "description": "Select the required time range",
                              "value": {
                                "durationMs": 1800000
                              },
                              "typeSettings": {
                                "selectableValues": [
                                  {
                                    "durationMs": 900000
                                  },
                                  {
                                    "durationMs": 1800000
                                  },
                                  {
                                    "durationMs": 3600000
                                  },
                                  {
                                    "durationMs": 14400000
                                  },
                                  {
                                    "durationMs": 43200000
                                  },
                                  {
                                    "durationMs": 86400000
                                  },
                                  {
                                    "durationMs": 172800000
                                  },
                                  {
                                    "durationMs": 259200000
                                  },
                                  {
                                    "durationMs": 604800000
                                  },
                                  {
                                    "durationMs": 1209600000
                                  },
                                  {
                                    "durationMs": 2592000000
                                  },
                                  {
                                    "durationMs": 5184000000
                                  },
                                  {
                                    "durationMs": 7776000000
                                  }
                                ],
                                "allowCustom": true
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "parameters - 1"
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "title": "Physical memory ",
                          "expandable": true,
                          "expanded": true,
                          "items": [
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "//Query to calculate memory distribution\r\nlet modified_table = Prometheus_OSExporter_CL\r\n|where instance_s == '{instance}' and TimeGenerated {memoryTimeRange};\r\n\r\nlet Total_Memory_Table = modified_table\r\n|where name_s == \"node_memory_MemTotal_bytes\"\r\n|project-away Computer,RawData,Type,_ResourceId,SourceSystem,MG,ManagementGroupName,TenantId\r\n|project-rename total_memory = value_d;\r\n\r\nlet Available_Memory_Table = modified_table\r\n|where name_s == \"node_memory_MemAvailable_bytes\"\r\n|project-away Computer,RawData,Type,_ResourceId,SourceSystem,MG,ManagementGroupName,TenantId\r\n|project-rename available_memory = value_d;\r\n\r\nlet Free_Memory_Table = modified_table\r\n|where name_s == \"node_memory_MemFree_bytes\"\r\n|project-away Computer,RawData,Type,_ResourceId,SourceSystem,MG,ManagementGroupName,TenantId\r\n|project-rename free_memory = value_d;\r\n\r\nlet Buffer_Memory_Table = modified_table\r\n|where name_s == \"node_memory_Buffers_bytes\"\r\n|project-away Computer,RawData,Type,_ResourceId,SourceSystem,MG,ManagementGroupName,TenantId\r\n|project-rename buffer_memory = value_d;\r\n\r\nlet Cached_Memory_Table = modified_table\r\n|where name_s == \"node_memory_Cached_bytes\"\r\n|project-away Computer,RawData,Type,_ResourceId,SourceSystem,MG,ManagementGroupName,TenantId\r\n|project-rename cached_memory = value_d;\r\n\r\n((((Total_Memory_Table\r\n|join Available_Memory_Table on correlation_id_g)\r\n|join Free_Memory_Table on correlation_id_g)\r\n|join Buffer_Memory_Table on correlation_id_g)\r\n|join Cached_Memory_Table on correlation_id_g)\r\n|extend used_memory = (total_memory - free_memory - buffer_memory - cached_memory)\r\n|make-series used=avg(used_memory),free=avg(free_memory),buffers=avg(buffer_memory),cached=avg(cached_memory) default=0 on TimeGenerated from {memoryTimeRange:start} to {memoryTimeRange:end} step iff({memoryTimeRange:grain}==\"1m\",3m,{memoryTimeRange:grain})",
                                "size": 4,
                                "aggregation": 3,
                                "showAnnotations": true,
                                "title": "Memory usage timeline",
                                "noDataMessage": "The query returned no results. Please try selecting a different time range",
                                "timeBrushParameterName": "memoryTimeRange_timebrush",
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces",
                                "visualization": "timechart",
                                "chartSettings": {
                                  "showMetrics": false,
                                  "showLegend": true,
                                  "seriesLabelSettings": [
                                    {
                                      "seriesName": "used",
                                      "label": "Used"
                                    },
                                    {
                                      "seriesName": "free",
                                      "label": "Free"
                                    },
                                    {
                                      "seriesName": "buffers",
                                      "label": "Buffers"
                                    },
                                    {
                                      "seriesName": "cached",
                                      "label": "Cached"
                                    }
                                  ],
                                  "ySettings": {
                                    "numberFormatSettings": {
                                      "unit": 36,
                                      "options": {
                                        "style": "decimal",
                                        "useGrouping": true,
                                        "minimumIntegerDigits": 1,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  }
                                }
                              },
                              "name": "Memory usage timeline query"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "//Query to calculate memory distribution\r\nlet modified_table = Prometheus_OSExporter_CL\r\n|where instance_s == '{instance}' and TimeGenerated {memoryTimeRange_timebrush};\r\n\r\nlet Total_Memory_Table = modified_table\r\n|where name_s == \"node_memory_MemTotal_bytes\"\r\n|project-away Computer,RawData,Type,_ResourceId,SourceSystem,MG,ManagementGroupName,TenantId\r\n|project-rename total_memory = value_d;\r\n\r\nlet Available_Memory_Table = modified_table\r\n|where name_s == \"node_memory_MemAvailable_bytes\"\r\n|project-away Computer,RawData,Type,_ResourceId,SourceSystem,MG,ManagementGroupName,TenantId\r\n|project-rename available_memory = value_d;\r\n\r\nlet Free_Memory_Table = modified_table\r\n|where name_s == \"node_memory_MemFree_bytes\"\r\n|project-away Computer,RawData,Type,_ResourceId,SourceSystem,MG,ManagementGroupName,TenantId\r\n|project-rename free_memory = value_d;\r\n\r\nlet Buffer_Memory_Table = modified_table\r\n|where name_s == \"node_memory_Buffers_bytes\"\r\n|project-away Computer,RawData,Type,_ResourceId,SourceSystem,MG,ManagementGroupName,TenantId\r\n|project-rename buffer_memory = value_d;\r\n\r\nlet Cached_Memory_Table = modified_table\r\n|where name_s == \"node_memory_Cached_bytes\"\r\n|project-away Computer,RawData,Type,_ResourceId,SourceSystem,MG,ManagementGroupName,TenantId\r\n|project-rename cached_memory = value_d;\r\n\r\n((((Total_Memory_Table\r\n|join Available_Memory_Table on correlation_id_g)\r\n|join Free_Memory_Table on correlation_id_g)\r\n|join Buffer_Memory_Table on correlation_id_g)\r\n|join Cached_Memory_Table on correlation_id_g)\r\n|extend used_memory = (total_memory - free_memory - buffer_memory - cached_memory)\r\n|make-series used=avg(used_memory),free=avg(free_memory),buffers=avg(buffer_memory),cached=avg(cached_memory) default=0 on TimeGenerated from {memoryTimeRange_timebrush:start} to {memoryTimeRange_timebrush:end} step iff({memoryTimeRange_timebrush:grain}==\"1m\",3m,{memoryTimeRange_timebrush:grain})",
                                "size": 0,
                                "aggregation": 3,
                                "title": "Memory distribution",
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces",
                                "visualization": "timechart",
                                "chartSettings": {
                                  "seriesLabelSettings": [
                                    {
                                      "seriesName": "used",
                                      "label": "Used"
                                    },
                                    {
                                      "seriesName": "free",
                                      "label": "Free"
                                    },
                                    {
                                      "seriesName": "buffers",
                                      "label": "Buffers"
                                    },
                                    {
                                      "seriesName": "cached",
                                      "label": "Cached"
                                    }
                                  ],
                                  "ySettings": {
                                    "numberFormatSettings": {
                                      "unit": 36,
                                      "options": {
                                        "style": "decimal",
                                        "useGrouping": true,
                                        "minimumIntegerDigits": 1,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  }
                                }
                              },
                              "name": "Available Memory distribution query"
                            }
                          ]
                        },
                        "name": "Physical memory group"
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "title": "Virtual memory",
                          "expandable": true,
                          "expanded": true,
                          "items": [
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "// Query to get swap memory usage\r\nlet Total_Swap_Memory_Table = Prometheus_OSExporter_CL\r\n|where instance_s == '{instance}' and TimeGenerated {memoryTimeRange} and name_s == \"node_memory_SwapTotal_bytes\"\r\n|project-away Computer,RawData,Type,_ResourceId,SourceSystem,MG,ManagementGroupName,TenantId\r\n|project-rename total_swap_memory = value_d;\r\n\r\nlet Available_Swap_Memory_Table = Prometheus_OSExporter_CL\r\n|where instance_s == '{instance}' and TimeGenerated {memoryTimeRange} and name_s == \"node_memory_SwapFree_bytes\"\r\n|project-away Computer,RawData,Type,_ResourceId,SourceSystem,MG,ManagementGroupName,TenantId\r\n|project-rename available_swap_memory = value_d;\r\n\r\nTotal_Swap_Memory_Table\r\n|join Available_Swap_Memory_Table on correlation_id_g\r\n|make-series used = avg(total_swap_memory-available_swap_memory),available = avg(available_swap_memory) default=0 on TimeGenerated from {memoryTimeRange:start} to {memoryTimeRange:end} step iff({memoryTimeRange:grain}==\"1m\",3m,{memoryTimeRange:grain})\r\n",
                                "size": 4,
                                "aggregation": 3,
                                "showAnnotations": true,
                                "title": "Swap usage timeline",
                                "noDataMessage": "The query returned no results. Please try selecting a different time range",
                                "timeBrushParameterName": "swapTimeRange_timebrush",
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces",
                                "visualization": "timechart",
                                "chartSettings": {
                                  "showMetrics": false,
                                  "showLegend": true,
                                  "seriesLabelSettings": [
                                    {
                                      "seriesName": "used",
                                      "label": "Used"
                                    },
                                    {
                                      "seriesName": "available",
                                      "label": "Available"
                                    }
                                  ],
                                  "ySettings": {
                                    "numberFormatSettings": {
                                      "unit": 36,
                                      "options": {
                                        "style": "decimal",
                                        "useGrouping": true,
                                        "minimumIntegerDigits": 1,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  }
                                }
                              },
                              "name": "Swap usage timeline query"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "// Query to get swap memory usage\r\nlet Total_Swap_Memory_Table = Prometheus_OSExporter_CL\r\n|where instance_s == '{instance}' and TimeGenerated {swapTimeRange_timebrush} and name_s == \"node_memory_SwapTotal_bytes\"\r\n|project-away Computer,RawData,Type,_ResourceId,SourceSystem,MG,ManagementGroupName,TenantId\r\n|project-rename total_swap_memory = value_d;\r\n\r\nlet Available_Swap_Memory_Table = Prometheus_OSExporter_CL\r\n|where instance_s == '{instance}' and TimeGenerated {swapTimeRange_timebrush} and name_s == \"node_memory_SwapFree_bytes\"\r\n|project-away Computer,RawData,Type,_ResourceId,SourceSystem,MG,ManagementGroupName,TenantId\r\n|project-rename available_swap_memory = value_d;\r\n\r\nTotal_Swap_Memory_Table\r\n|join Available_Swap_Memory_Table on correlation_id_g\r\n|make-series used = avg(total_swap_memory-available_swap_memory),available = avg(available_swap_memory) default=0 on TimeGenerated from {swapTimeRange_timebrush:start} to {swapTimeRange_timebrush:end} step iff({swapTimeRange_timebrush:grain}==\"1m\",3m,{swapTimeRange_timebrush:grain})",
                                "size": 0,
                                "aggregation": 3,
                                "title": "Swap usage",
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces",
                                "visualization": "timechart",
                                "chartSettings": {
                                  "seriesLabelSettings": [
                                    {
                                      "seriesName": "used",
                                      "label": "Used"
                                    },
                                    {
                                      "seriesName": "available",
                                      "label": "Available"
                                    }
                                  ],
                                  "ySettings": {
                                    "numberFormatSettings": {
                                      "unit": 36,
                                      "options": {
                                        "style": "decimal",
                                        "useGrouping": true,
                                        "minimumIntegerDigits": 1,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  }
                                }
                              },
                              "name": "Swap usage query"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "//pgpgin – Number of pages the system has paged in into memory\r\n//pgpgout – Number of kilobytes the system has paged out from memory\r\nPrometheus_OSExporter_CL\r\n|where instance_s == '{instance}' and TimeGenerated {swapTimeRange_timebrush} and (name_s == \"node_vmstat_pgpgin\" or name_s == \"node_vmstat_pgpgout\")\r\n|project-away Computer,RawData,Type,_ResourceId,SourceSystem,MG,ManagementGroupName,TenantId\r\n|make-series max(value_d)-min(value_d) default=0 on TimeGenerated from {swapTimeRange_timebrush:start} to {swapTimeRange_timebrush:end} step iff({swapTimeRange_timebrush:grain}=='1m',3m,{swapTimeRange_timebrush:grain}) by name_s\r\n",
                                "size": 1,
                                "aggregation": 3,
                                "title": "Paging rate",
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces",
                                "visualization": "timechart",
                                "chartSettings": {
                                  "yAxis": [
                                    "Column1"
                                  ],
                                  "group": "name_s",
                                  "createOtherGroup": 50,
                                  "seriesLabelSettings": [
                                    {
                                      "seriesName": "node_vmstat_pgpgout",
                                      "label": "Pages_out"
                                    },
                                    {
                                      "seriesName": "node_vmstat_pgpgin",
                                      "label": "Pages_in"
                                    }
                                  ],
                                  "ySettings": {
                                    "numberFormatSettings": {
                                      "unit": 17,
                                      "options": {
                                        "style": "decimal",
                                        "useGrouping": true,
                                        "minimumIntegerDigits": 1,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  }
                                }
                              },
                              "name": "Page i/o activity"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "//pswpin – Number of pages the system has paged in from disk per second.\r\n//pswpout – Number of pages the system has paged out to disk per second.\r\nPrometheus_OSExporter_CL\r\n|where instance_s == '{instance}' and TimeGenerated {swapTimeRange_timebrush} and (name_s == \"node_vmstat_pswpin\" or name_s == \"node_vmstat_pswpout\")\r\n|project-away Computer,RawData,Type,_ResourceId,SourceSystem,MG,ManagementGroupName,TenantId\r\n|make-series max(value_d)-min(value_d) default=0 on TimeGenerated from {swapTimeRange_timebrush:start} to {swapTimeRange_timebrush:end} step iff({swapTimeRange_timebrush:grain}=='1m',3m,{swapTimeRange_timebrush:grain}) by name_s",
                                "size": 1,
                                "aggregation": 3,
                                "title": "Swap rate",
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces",
                                "visualization": "timechart",
                                "chartSettings": {
                                  "yAxis": [
                                    "Column1"
                                  ],
                                  "seriesLabelSettings": [
                                    {
                                      "seriesName": "node_vmstat_pswpout",
                                      "label": "Pages_swapped_out"
                                    },
                                    {
                                      "seriesName": "node_vmstat_pswpin",
                                      "label": "Pages_swapped_in"
                                    }
                                  ],
                                  "ySettings": {
                                    "numberFormatSettings": {
                                      "unit": 17,
                                      "options": {
                                        "style": "decimal",
                                        "useGrouping": true,
                                        "minimumIntegerDigits": 1,
                                        "maximumFractionDigits": 2
                                      }
                                    }
                                  }
                                }
                              },
                              "name": "query - 4"
                            }
                          ]
                        },
                        "name": "Virtual memory group"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "tab_value",
                    "comparison": "isEqualTo",
                    "value": "3"
                  },
                  "name": "Memory group"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "6c33f3e9-6261-41e0-a3be-403279573457",
                              "version": "KqlParameterItem/1.0",
                              "name": "diskTimeRange",
                              "label": "Time Range",
                              "type": 4,
                              "description": "Select the required time range",
                              "value": {
                                "durationMs": 1800000
                              },
                              "typeSettings": {
                                "selectableValues": [
                                  {
                                    "durationMs": 900000
                                  },
                                  {
                                    "durationMs": 1800000
                                  },
                                  {
                                    "durationMs": 3600000
                                  },
                                  {
                                    "durationMs": 14400000
                                  },
                                  {
                                    "durationMs": 43200000
                                  },
                                  {
                                    "durationMs": 86400000
                                  },
                                  {
                                    "durationMs": 172800000
                                  },
                                  {
                                    "durationMs": 259200000
                                  },
                                  {
                                    "durationMs": 604800000
                                  },
                                  {
                                    "durationMs": 1209600000
                                  },
                                  {
                                    "durationMs": 2592000000
                                  },
                                  {
                                    "durationMs": 5184000000
                                  },
                                  {
                                    "durationMs": 7776000000
                                  }
                                ],
                                "allowCustom": true
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "parameters - 1",
                        "styleSettings": {
                          "margin": "5px"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "//Query to get usage statistics for each filesystem\r\nlet modified_table = Prometheus_OSExporter_CL\r\n|where instance_s == '{instance}' and TimeGenerated {diskTimeRange} and (name_s == \"node_filesystem_size_bytes\" or name_s == \"node_filesystem_avail_bytes\")\r\n|project-away Computer,RawData,Type,_ResourceId,SourceSystem,MG,ManagementGroupName,TenantId;\r\nlet Total_Filesystem_Space_Table = modified_table\r\n|where name_s == \"node_filesystem_size_bytes\"\r\n|project-rename total_filesystem_space = value_d;\r\nlet Available_Filesystem_Space_Table = modified_table\r\n|where name_s == \"node_filesystem_avail_bytes\"\r\n|project-rename available_filesystem_space = value_d;\r\n\r\nlet Used_Filesystem_Space_Table = Total_Filesystem_Space_Table \r\n|join Available_Filesystem_Space_Table on correlation_id_g, $left.labels_s==$right.labels_s\r\n|extend used_filesystem_space = (total_filesystem_space-available_filesystem_space);\r\n\r\nlet Utilisation_table = Used_Filesystem_Space_Table\r\n|summarize Used = avg(used_filesystem_space)/(1024*1024), Max_Used = max(used_filesystem_space)/(1024*1024), Total = max(total_filesystem_space)/(1024*1024) by labels_s\r\n|extend Used_percentage = Used*100/Total\r\n|project Used = Used/(1024), Max_Used = Max_Used/(1024), Total = Total/(1024), labels_s,Used_percentage\r\n|project Used = round(Used,2), Max_Used = round(Max_Used,2), Total = round(Total,2), labels_s,Used_percentage;\r\n\r\nlet Trend_table = Used_Filesystem_Space_Table\r\n|make-series trend = max(used_filesystem_space) default=0 on TimeGenerated from {diskTimeRange:start} to {diskTimeRange:end} step {diskTimeRange:grain} by labels_s;\r\n\r\nUtilisation_table\r\n|join Trend_table on $left.labels_s==$right.labels_s\r\n|extend labels = parse_json(labels_s)\r\n|extend fstype = labels.fstype, mountpoint = labels.mountpoint\r\n|where tostring(fstype)== \"xfs\" or tostring(fstype)==\"nfs4\" or tostring(fstype)==\"ext4\"\r\n|project mountpoint,fstype, Used_percentage,Used,Max_Used,Total,trend\r\n|order by Used_percentage",
                          "size": 3,
                          "noDataMessage": "The query returned no results. Try selecting a different time range",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "device",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "60ch"
                                }
                              },
                              {
                                "columnMatch": "fstype",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "12ch"
                                }
                              },
                              {
                                "columnMatch": "mountpoint",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "30ch"
                                }
                              },
                              {
                                "columnMatch": "Used_percentage",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "max": 100,
                                  "palette": "greenRed"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": false,
                                    "minimumIntegerDigits": 1,
                                    "minimumFractionDigits": 0,
                                    "maximumFractionDigits": 2
                                  }
                                }
                              },
                              {
                                "columnMatch": "Used",
                                "formatter": 5,
                                "numberFormat": {
                                  "unit": 36,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": false,
                                    "minimumIntegerDigits": 1,
                                    "maximumFractionDigits": 2
                                  }
                                }
                              },
                              {
                                "columnMatch": "Total",
                                "formatter": 22,
                                "formatOptions": {
                                  "compositeBarSettings": {
                                    "labelText": "[\"Used\"] GB out of [\"Total\"] GB is used",
                                    "columnSettings": [
                                      {
                                        "columnName": "Used",
                                        "color": "redBright"
                                      },
                                      {
                                        "columnName": "Max_Used",
                                        "color": "yellow"
                                      },
                                      {
                                        "columnName": "Total",
                                        "color": "green"
                                      }
                                    ]
                                  },
                                  "customColumnWidthSetting": "250px"
                                },
                                "numberFormat": {
                                  "unit": 36,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": false,
                                    "minimumIntegerDigits": 1,
                                    "maximumFractionDigits": 2
                                  }
                                }
                              },
                              {
                                "columnMatch": "trend",
                                "formatter": 9,
                                "formatOptions": {
                                  "palette": "red"
                                }
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "mountpoint",
                                "label": "Mountpoint"
                              },
                              {
                                "columnId": "fstype",
                                "label": "Type"
                              },
                              {
                                "columnId": "Used_percentage",
                                "label": "Avg Utilisation %"
                              },
                              {
                                "columnId": "Total",
                                "label": "Statistics"
                              },
                              {
                                "columnId": "trend",
                                "label": "Trend"
                              }
                            ]
                          },
                          "sortBy": [],
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "device",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "Used",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          }
                        },
                        "name": "Disk space usage query"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "55eb0bdf-9e17-468b-80a6-2410a10c20b3",
                              "version": "KqlParameterItem/1.0",
                              "name": "blockDevice",
                              "label": "Block Device",
                              "type": 2,
                              "description": "Select the required block device",
                              "isRequired": true,
                              "multiSelect": true,
                              "quote": "'",
                              "delimiter": ",",
                              "query": "Prometheus_OSExporter_CL\r\n|where instance_s == '{instance}' and name_s contains \"disk\"\r\n|extend device = parse_json(labels_s).device\r\n//|where tostring(device) in (\"sda\",\"sdb\",\"sdc\",\"sdd\")\r\n|distinct tostring(device)",
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::all"
                                ],
                                "showDefault": false
                              },
                              "defaultValue": "value::all",
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "parameters - 5"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "//Query to calculate the r/w bytes of block devices\r\nPrometheus_OSExporter_CL\r\n|where instance_s == '{instance}' and TimeGenerated {diskTimeRange} and (name_s == \"node_disk_read_bytes_total\" or name_s == \"node_disk_written_bytes_total\")\r\n|project-away Computer,RawData,Type,_ResourceId,SourceSystem,MG,ManagementGroupName,TenantId\r\n|extend device = parse_json(labels_s).device\r\n|where device in ({blockDevice})\r\n|extend metric_name = strcat(device,\"_\",iff(name_s==\"node_disk_read_bytes_total\",\"read_bytes\",\"write_bytes\"))\r\n|summarize rate = (max(value_d)-min(value_d)) by metric_name,bin(TimeGenerated,iff({diskTimeRange:grain}=='1m',3m,{diskTimeRange:grain}))",
                          "size": 0,
                          "aggregation": 6,
                          "title": "Read/Write bytes",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "visualization": "timechart",
                          "chartSettings": {
                            "yAxis": [
                              "rate"
                            ],
                            "group": "metric_name",
                            "createOtherGroup": 15,
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 36,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "minimumIntegerDigits": 1,
                                  "minimumFractionDigits": 0,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          }
                        },
                        "name": "Disk r/w rate query"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "// Query to calculate the time spent by block devices on io\r\nPrometheus_OSExporter_CL\r\n|where instance_s == '{instance}' and TimeGenerated {diskTimeRange} and (name_s contains \"node_disk_write_time_seconds_total\" or name_s contains \"node_disk_read_time_seconds_total\" or name_s contains \"node_disk_io_time_seconds_total\")\r\n|project-away Computer,RawData,Type,_ResourceId,SourceSystem,MG,ManagementGroupName,TenantId\r\n|extend device = parse_json(labels_s).device\r\n//|extend value_d = tolong(value_d)\r\n|where device in ({blockDevice})\r\n|extend metric_name = strcat(tostring(device),strcat(\"_\",iff(name_s == \"node_disk_write_time_seconds_total\",\"write_time\",iff(name_s == \"node_disk_read_time_seconds_total\",\"read_time\",\"io_time\"))))\r\n|summarize time_spent = (max(value_d)-min(value_d)) by metric_name,bin(TimeGenerated,iff({diskTimeRange:grain}=='1m',3m,{diskTimeRange:grain}))",
                          "size": 1,
                          "aggregation": 6,
                          "title": "Read/Write time",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "visualization": "timechart",
                          "tileSettings": {
                            "showBorder": false,
                            "titleContent": {
                              "columnMatch": "device",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "avg_",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto"
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          },
                          "chartSettings": {
                            "yAxis": [
                              "time_spent"
                            ],
                            "group": "metric_name",
                            "createOtherGroup": 50,
                            "seriesLabelSettings": [
                              {
                                "seriesName": "node_disk_write_time_seconds_total",
                                "label": "write_time(seconds)"
                              },
                              {
                                "seriesName": "node_disk_io_time_seconds_total",
                                "label": "io_time(seconds)"
                              },
                              {
                                "seriesName": "node_disk_read_time_seconds_total",
                                "label": "read_time(seconds)"
                              }
                            ],
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 24,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "minimumIntegerDigits": 1,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          }
                        },
                        "name": "Time spent on I/O"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "//Query to calculate ongoing IO count per disk\r\nPrometheus_OSExporter_CL\r\n|where instance_s == '{instance}' and TimeGenerated {diskTimeRange} and name_s == \"node_disk_io_now\"\r\n|project-away Computer,RawData,Type,_ResourceId,SourceSystem,MG,ManagementGroupName,TenantId\r\n|extend device = parse_json(labels_s).device\r\n|where device in ({blockDevice})\r\n|summarize max(value_d) by tostring(device),bin(TimeGenerated,{diskTimeRange:grain})",
                          "size": 1,
                          "aggregation": 5,
                          "title": "Ongoing I/O count",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "visualization": "timechart",
                          "chartSettings": {
                            "yAxis": [
                              "max_value_d"
                            ],
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 17,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "minimumIntegerDigits": 1,
                                  "minimumFractionDigits": 0,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          }
                        },
                        "name": "Ongoing I/O count"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "//Query to calculate the r/w bytes of block devices\r\nPrometheus_OSExporter_CL\r\n|where instance_s == '{instance}' and TimeGenerated {diskTimeRange} and (name_s == \"Persistent_Memory_Reads\" or name_s == \"Persistent_Memory_Writes\")\r\n|project-away Computer,RawData,Type,_ResourceId,SourceSystem,MG,ManagementGroupName,TenantId\r\n|extend metric_name = name_s\r\n|summarize rate = (max(value_d)-min(value_d)) by metric_name,bin(TimeGenerated,iff({diskTimeRange:grain}=='1m',3m,{diskTimeRange:grain}))",
                          "size": 0,
                          "showAnnotations": true,
                          "title": "Persistent memory R/W (bytes)",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "visualization": "timechart"
                        },
                        "name": "Persistent memory R/W"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "tab_value",
                    "comparison": "isEqualTo",
                    "value": "4"
                  },
                  "name": "Disk group"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "7af52399-9f67-43b7-8205-026077500109",
                              "version": "KqlParameterItem/1.0",
                              "name": "networkTimeRange",
                              "label": "Time Range",
                              "type": 4,
                              "description": "Select the required time range to view the inbound/outbound rate for network interfaces",
                              "value": {
                                "durationMs": 1800000
                              },
                              "typeSettings": {
                                "selectableValues": [
                                  {
                                    "durationMs": 900000
                                  },
                                  {
                                    "durationMs": 1800000
                                  },
                                  {
                                    "durationMs": 3600000
                                  },
                                  {
                                    "durationMs": 14400000
                                  },
                                  {
                                    "durationMs": 43200000
                                  },
                                  {
                                    "durationMs": 86400000
                                  },
                                  {
                                    "durationMs": 172800000
                                  },
                                  {
                                    "durationMs": 259200000
                                  },
                                  {
                                    "durationMs": 604800000
                                  },
                                  {
                                    "durationMs": 1209600000
                                  },
                                  {
                                    "durationMs": 2592000000
                                  },
                                  {
                                    "durationMs": 5184000000
                                  },
                                  {
                                    "durationMs": 7776000000
                                  }
                                ],
                                "allowCustom": true
                              },
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            },
                            {
                              "id": "d140d050-794c-4260-912b-c70171ec8869",
                              "version": "KqlParameterItem/1.0",
                              "name": "networkDevice",
                              "label": "Network Interface",
                              "type": 2,
                              "description": "Select the required network interface",
                              "isRequired": true,
                              "multiSelect": true,
                              "quote": "'",
                              "delimiter": ",",
                              "query": "Prometheus_OSExporter_CL\r\n|where instance_s == '{instance}' and name_s contains \"node_network\"\r\n|extend interface = parse_json(labels_s).device\r\n|where interface!=\"lo\"\r\n|distinct tostring(interface)",
                              "typeSettings": {
                                "additionalResourceOptions": [
                                  "value::all"
                                ],
                                "showDefault": false
                              },
                              "timeContext": {
                                "durationMs": 2592000000
                              },
                              "defaultValue": "value::all",
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "parameters - 1"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "//Query to network packets going in and out of network\r\nPrometheus_OSExporter_CL\r\n|where instance_s == '{instance}' and TimeGenerated {networkTimeRange} and (name_s == \"node_network_transmit_packets_total\" or name_s == \"node_network_receive_packets_total\")\r\n|project-away Computer,RawData,Type,_ResourceId,SourceSystem,MG,ManagementGroupName,TenantId\r\n|extend interface = parse_json(labels_s).device\r\n|where interface in ({networkDevice})\r\n|extend metric_name = strcat(interface,\"_\",iff(name_s==\"node_network_transmit_packets_total\",\"out\",\"in\"))\r\n|make-series rate = (max(value_d)-min(value_d)) default=0 on TimeGenerated from {networkTimeRange:start} to {networkTimeRange:end} step iff({networkTimeRange:grain}=='1m',3m,{networkTimeRange:grain}) by metric_name",
                          "size": 4,
                          "aggregation": 6,
                          "showAnnotations": true,
                          "title": "Network inbound/outbound traffic",
                          "noDataMessage": "The query returned no results. Try selecting a different time range",
                          "timeBrushParameterName": "networkTimeRange_timebrush",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "visualization": "timechart",
                          "chartSettings": {
                            "yAxis": [
                              "rate"
                            ],
                            "group": "metric_name",
                            "createOtherGroup": 10,
                            "showMetrics": false,
                            "showLegend": true,
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 17,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "minimumIntegerDigits": 1,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          }
                        },
                        "name": "Network traffic timeline"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "//Query to calculate packets sent and received by each interface in the timeline period\r\nPrometheus_OSExporter_CL\r\n|where instance_s == '{instance}' and TimeGenerated {networkTimeRange_timebrush} and (name_s == \"node_network_transmit_packets_total\" or name_s == \"node_network_receive_packets_total\")\r\n|project-away Computer,RawData,Type,_ResourceId,SourceSystem,MG,ManagementGroupName,TenantId\r\n|extend interface = parse_json(labels_s).device\r\n|where interface in ({networkDevice})\r\n|extend metric_name = strcat(interface,\"_\",iff(name_s==\"node_network_transmit_packets_total\",\"out\",\"in\"))\r\n|make-series rate = (max(value_d)-min(value_d)) default=0 on TimeGenerated from {networkTimeRange_timebrush:start} to {networkTimeRange_timebrush:end} step iff({networkTimeRange_timebrush:grain}=='1m',3m,{networkTimeRange_timebrush:grain}) by metric_name",
                          "size": 0,
                          "aggregation": 6,
                          "title": "Network packets",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "visualization": "timechart",
                          "chartSettings": {
                            "yAxis": [
                              "rate"
                            ],
                            "group": "metric_name",
                            "createOtherGroup": 10,
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 17,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "minimumIntegerDigits": 1,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          }
                        },
                        "name": "Network traffic query"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "//Query to calculate total bytes in and out of selected network interfaces\r\nPrometheus_OSExporter_CL\r\n|where instance_s == '{instance}' and TimeGenerated {networkTimeRange_timebrush} and (name_s == \"node_network_transmit_bytes_total\" or name_s == \"node_network_receive_bytes_total\")\r\n|project-away Computer,RawData,Type,_ResourceId,SourceSystem,MG,ManagementGroupName,TenantId\r\n|extend interface = parse_json(labels_s).device\r\n|where interface in ({networkDevice})\r\n|extend metric_name = strcat(interface,\"_\",iff(name_s==\"node_network_transmit_bytes_total\",\"out\",\"in\"))\r\n|make-series network_bytes_count = (max(value_d)-min(value_d)) default=0 on TimeGenerated from {networkTimeRange_timebrush:start} to {networkTimeRange_timebrush:end} step iff({networkTimeRange_timebrush:grain}=='1m',3m,{networkTimeRange_timebrush:grain}) by metric_name",
                          "size": 0,
                          "aggregation": 6,
                          "title": "Network bytes",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "visualization": "timechart",
                          "chartSettings": {
                            "yAxis": [
                              "network_bytes_count"
                            ],
                            "group": "metric_name",
                            "createOtherGroup": 10,
                            "ySettings": {
                              "numberFormatSettings": {
                                "unit": 36,
                                "options": {
                                  "style": "decimal",
                                  "useGrouping": true,
                                  "minimumIntegerDigits": 1,
                                  "minimumFractionDigits": 0,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          }
                        },
                        "name": "Network bytes per interface query"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "tab_value",
                    "comparison": "isEqualTo",
                    "value": "5"
                  },
                  "name": "Network group"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "provider_table_exists",
              "comparison": "isNotEqualTo",
              "value": "0"
            },
            "name": "Metrics group"
          }
        ]
      },
      "name": "Node monitoring group"
    }
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}