{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "873995df-dc8d-416c-b620-44ce8c083850",
            "version": "KqlParameterItem/1.0",
            "name": "amsResource",
            "type": 5,
            "isRequired": true,
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "resourceTypeFilter": {
                "microsoft.workloads/monitors": true,
                "microsoft.hanaonazure/sapmonitors": true
              },
              "additionalResourceOptions": [
                "value::1"
              ],
              "showDefault": false
            },
            "defaultValue": "value::1"
          },
          {
            "id": "632fc734-2fdb-43ad-b298-02a2bd04a3a2",
            "version": "KqlParameterItem/1.0",
            "name": "workspace",
            "type": 5,
            "isRequired": true,
            "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{amsResource:subscriptionid}/resourceGroups/{amsResource:resourcegroup}/providers/Microsoft.Workloads/monitors/{amsResource:name}\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2023-04-01\"}],\"batchDisabled\":true,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.properties\",\"columns\":[{\"path\":\"$.logAnalyticsWorkspaceArmId\",\"columnid\":\"id\",\"columnType\":\"string\"}]}}]}",
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "resourceTypeFilter": {
                "microsoft.operationalinsights/workspaces": true
              },
              "additionalResourceOptions": [
                "value::1"
              ],
              "showDefault": false
            },
            "defaultValue": "value::1",
            "queryType": 12
          }
        ],
        "style": "above",
        "queryType": 12
      },
      "conditionalVisibility": {
        "parameterName": "hidden",
        "comparison": "isEqualTo",
        "value": "no"
      },
      "name": "all_providers"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "crossComponentResources": [
                "{workspace}"
              ],
              "parameters": [
                {
                  "id": "8db7d224-b80f-4cd8-8d5a-0d8413228340",
                  "version": "KqlParameterItem/1.0",
                  "name": "tableExists",
                  "type": 1,
                  "query": "let checktable = (tb:string, columnName:string)\r\n{\r\n// 0 = no error\r\n// 1 = table does not exist (need to enable RFC)\r\n// 2 = table exists, but column v1 does not (or) column v1 exists but no data in the table (need to wait)\r\nlet dummy = \"unmÃ¶glicher-wert!\";\r\nlet MissingTable = view () { print miss = 1, columnV1 = dummy, records = -1 };\r\nlet checkRecords =\r\n  union\r\n    isfuzzy=true MissingTable,\r\n    (table(tb)\r\n      | summarize records = count()\r\n    )\r\n  | project records\r\n  | top 1 by records desc\r\n;\r\nlet checkTableExists =\r\n  union\r\n    isfuzzy=true MissingTable,\r\n    (table(tb)\r\n      | count\r\n      | extend miss = 0\r\n    )\r\n  | project miss\r\n  | limit 2\r\n  | top 1 by miss asc\r\n;\r\nlet checkColumnExists =\r\n  union\r\n    isfuzzy=true MissingTable,\r\n    (table(tb)\r\n      | extend miss = 0\r\n      | extend columnV1 = column_ifexists(columnName, dummy)\r\n    )\r\n  | project miss, columnV1\r\n  | limit 2\r\n  | top 1 by miss asc\r\n ;\r\nlet tableExists = toscalar(checkTableExists | summarize max(miss) != 1);\r\nlet columnV1Exists = toscalar(checkColumnExists | summarize max(columnV1) != dummy);\r\nlet tableRecords = toscalar(checkRecords | summarize max(records));\r\nlet x = iif(tableExists, iif(columnV1Exists, iif(tableRecords > 0, \"0\", \"2\"), \"2\"), \"1\");\r\ntoscalar(x)\r\n};\r\nlet system = checktable('SapNetweaver_GetSystemInstanceList_CL', 'SID_s');\r\nlet process = checktable('SapNetweaver_GetProcessList_CL', 'SID_s');\r\nlet vms = checktable('COMMON_VM_ArmId_Mapping_CL', 'VM_ARM_ID_s');\r\nlet hana = checktable('SapHana_SystemAvailability_CL', 'PROVIDER_INSTANCE_s');\r\n\r\nprint strcat(\r\n'{\"SapNetweaver_GetSystemInstanceList_CL\":',system, ',',\r\n'\"SapNetweaver_GetProcessList_CL\":',process, ',',\r\n'\"SapHana_SystemAvailability_CL\":',hana, ',',\r\n'\"COMMON_VM_ArmId_Mapping_CL\":',vms, '}')",
                  "crossComponentResources": [
                    "{workspace}"
                  ],
                  "isHiddenWhenLocked": true,
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "28366602-f715-4e87-9e70-8e7279439b38",
                  "version": "KqlParameterItem/1.0",
                  "name": "vmIdsExist",
                  "type": 2,
                  "query": "print input = parse_json('{tableExists}')\r\n| mv-apply input to typeof(dynamic) on (\r\n    project error=tostring(input[\"COMMON_VM_ArmId_Mapping_CL\"])\r\n    | where isnotempty(error)\r\n    | project error = tolong(error)\r\n)\r\n| project value=iff(error==0, true, false)",
                  "crossComponentResources": [
                    "{workspace}"
                  ],
                  "isHiddenWhenLocked": true,
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::1"
                    ],
                    "showDefault": false
                  },
                  "defaultValue": "value::1",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "e4814ca9-6cff-421a-83e7-5553794ecd7e",
                  "version": "KqlParameterItem/1.0",
                  "name": "nwExists",
                  "type": 2,
                  "query": "print input = parse_json('{tableExists}')\r\n| mv-apply input to typeof(dynamic) on (\r\nproject error=tostring(input[\"SapNetweaver_GetProcessList_CL\"])\r\n    | where isnotempty(error)\r\n    | project error = tolong(error)\r\n)\r\n| project value=iff(error==0, true, false)",
                  "crossComponentResources": [
                    "{workspace}"
                  ],
                  "isHiddenWhenLocked": true,
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::1"
                    ],
                    "showDefault": false
                  },
                  "defaultValue": "value::1",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "09142554-8d2f-41f6-880c-682aa7aaa233",
                  "version": "KqlParameterItem/1.0",
                  "name": "hanaExists",
                  "type": 2,
                  "query": "print input = parse_json('{tableExists}')\r\n| mv-apply input to typeof(dynamic) on (\r\nproject error=tostring(input[\"SapHana_SystemAvailability_CL\"])\r\n    | where isnotempty(error)\r\n    | project error = tolong(error)\r\n)\r\n| project value=iff(error==0, true, false)",
                  "crossComponentResources": [
                    "{workspace}"
                  ],
                  "isHiddenWhenLocked": true,
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::1"
                    ],
                    "showDefault": false
                  },
                  "defaultValue": "value::1",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "8b9f3a88-484e-40d2-889c-597a76a22b08",
                  "version": "KqlParameterItem/1.0",
                  "name": "showData",
                  "type": 2,
                  "query": "print \"{vmIdsExist}\"==\"true\" and (\"{nwExists}\"==\"true\" or \"{hanaExists}\"==\"true\")",
                  "crossComponentResources": [
                    "{workspace}"
                  ],
                  "isHiddenWhenLocked": true,
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::1"
                    ],
                    "showDefault": false
                  },
                  "defaultValue": "value::1",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "conditionalVisibility": {
              "parameterName": "hidden",
              "comparison": "isEqualTo",
              "value": "no"
            },
            "name": "checkParams"
          },
          {
            "type": 1,
            "content": {
              "json": "The workbook is loading. This can take up to 2 minutes.",
              "style": "info"
            },
            "conditionalVisibility": {
              "parameterName": "nwExists",
              "comparison": "isEqualTo"
            },
            "name": "initialPrompt"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "print(\"Access to Log Analytics Workspace Validated.\")",
              "size": 4,
              "timeContext": {
                "durationMs": 86400000
              },
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{workspace}"
              ],
              "visualization": "card"
            },
            "conditionalVisibility": {
              "parameterName": "nwExists",
              "comparison": "isEqualTo"
            },
            "name": "AccesstoLAWPrompt"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": ""
                  },
                  "customWidth": "10",
                  "name": "bufferText1"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "<h1 style=\"text-align:center;\">Set up providers for {amsResource:name}</h1>\r\n<p style=\"text-align:center;\">View monitoring telemetry, set alerts and enable SAP Insights monitor for multiple source systems by setting up providers.</p>"
                  },
                  "customWidth": "80",
                  "name": "providersMissingDisplay"
                },
                {
                  "type": 1,
                  "content": {
                    "json": ""
                  },
                  "customWidth": "10",
                  "name": "bufferText2"
                },
                {
                  "type": 1,
                  "content": {
                    "json": ""
                  },
                  "customWidth": "42",
                  "name": "bufferText3"
                },
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "nav",
                    "links": [
                      {
                        "id": "d1806130-e6c8-4e3a-9bb0-d4bdc687137b",
                        "cellValue": "{amsResource}",
                        "linkTarget": "Resource",
                        "linkLabel": "View providers",
                        "subTarget": "monitor_provider",
                        "style": "primary"
                      }
                    ]
                  },
                  "customWidth": "16",
                  "name": "links - 3"
                },
                {
                  "type": 1,
                  "content": {
                    "json": ""
                  },
                  "customWidth": "42",
                  "name": "bufferText4"
                }
              ]
            },
            "conditionalVisibilities": [
              {
                "parameterName": "nwExists",
                "comparison": "isEqualTo",
                "value": "false"
              },
              {
                "parameterName": "hanaExists",
                "comparison": "isEqualTo",
                "value": "false"
              }
            ],
            "name": "providersMissing"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": ""
                  },
                  "customWidth": "10",
                  "name": "bufferText4"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "<h1 style=\"text-align:center;\">Configure insights for your AMS instance: {amsResource:name}</h1>\r\n<p style=\"text-align:center;\">With SAP insights, you can learn about the possible reasons that are impacting the availability or performance of your SAP system.</p>\r\n<p style=\"text-align:center;\"><strong>Prerequisite</strong>: Please ensure that you have unprotected the GetEnvironment method on each SAP instance. <a href=\"https://learn.microsoft.com/en-us/azure/sap/monitor/provider-netweaver#prerequisite-unprotect-methods-for-metrics\">Learn more</a></p>"
                  },
                  "customWidth": "80",
                  "name": "vmIdsTitleDisplay"
                },
                {
                  "type": 1,
                  "content": {
                    "json": ""
                  },
                  "customWidth": "10",
                  "name": "text - 8"
                },
                {
                  "type": 1,
                  "content": {
                    "json": ""
                  },
                  "customWidth": "42",
                  "name": "text - 12"
                },
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "list",
                    "links": [
                      {
                        "id": "ff88a33c-6039-46ff-8111-4fbb35e3f992",
                        "linkTarget": "OpenBlade",
                        "linkLabel": "Configure Insights",
                        "style": "primary",
                        "linkIsContextBlade": true,
                        "bladeOpenContext": {
                          "bladeName": "ManageInsights.ReactView",
                          "extensionName": "Microsoft_Azure_WorkloadMonitor",
                          "bladeParameters": [
                            {
                              "name": "resourceId",
                              "source": "parameter",
                              "value": "amsResource"
                            }
                          ]
                        }
                      }
                    ]
                  },
                  "customWidth": "16",
                  "name": "ConfigureButtonOnboarding"
                },
                {
                  "type": 1,
                  "content": {
                    "json": ""
                  },
                  "customWidth": "42",
                  "name": "text - 14"
                },
                {
                  "type": 1,
                  "content": {
                    "json": ""
                  },
                  "customWidth": "15",
                  "name": "bufferText1"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "<p style=\"text-align:center;\">If Insights is recently configured, it may take up to 30 minutes for the initial telemetry information to be available for review. Else, please submit a new support request.</p>",
                    "style": "info"
                  },
                  "customWidth": "70",
                  "name": "InfoBox"
                },
                {
                  "type": 1,
                  "content": {
                    "json": ""
                  },
                  "customWidth": "15",
                  "name": "bufferText2"
                }
              ]
            },
            "conditionalVisibilities": [
              {
                "parameterName": "vmIdsExist",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "vmIdsExist",
                "comparison": "isEqualTo",
                "value": "false"
              }
            ],
            "name": "vmIdsMissing"
          }
        ],
        "exportParameters": true
      },
      "name": "validationCheck"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "crossComponentResources": [
                "{workspace}"
              ],
              "parameters": [
                {
                  "id": "54eab0e3-55e7-4fae-9558-aecfd4df5e3a",
                  "version": "KqlParameterItem/1.0",
                  "name": "timePeriod",
                  "label": "Time Range",
                  "type": 4,
                  "isRequired": true,
                  "value": {
                    "durationMs": 3600000
                  },
                  "typeSettings": {
                    "selectableValues": [
                      {
                        "durationMs": 300000
                      },
                      {
                        "durationMs": 900000
                      },
                      {
                        "durationMs": 1800000
                      },
                      {
                        "durationMs": 3600000
                      },
                      {
                        "durationMs": 14400000
                      },
                      {
                        "durationMs": 43200000
                      },
                      {
                        "durationMs": 86400000
                      },
                      {
                        "durationMs": 172800000
                      },
                      {
                        "durationMs": 259200000
                      },
                      {
                        "durationMs": 604800000
                      },
                      {
                        "durationMs": 1209600000
                      },
                      {
                        "durationMs": 2419200000
                      },
                      {
                        "durationMs": 2592000000
                      }
                    ],
                    "allowCustom": true
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "bd7954e7-ce9c-47ee-94a6-652fb161f635",
                  "version": "KqlParameterItem/1.0",
                  "name": "selSID",
                  "label": "SID",
                  "type": 2,
                  "isRequired": true,
                  "query": "union isfuzzy=true \r\n(SapNetweaver_GetSystemInstanceList_CL\r\n| distinct SID_s),\r\n(SapHana_SystemOverview_CL \r\n| extend SID_s = tostring(VALUE_s)\r\n| where NAME_s == \"Instance ID\"\r\n| distinct SID_s)\r\n| distinct SID_s",
                  "crossComponentResources": [
                    "{workspace}"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "8c48e286-b612-4ea3-9979-aa4f3d3f75cf",
                  "version": "KqlParameterItem/1.0",
                  "name": "providerInstance",
                  "label": "SAP Provider",
                  "type": 2,
                  "isRequired": true,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/{amsResource}/providerInstances/\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2023-04-01\"}],\"batchDisabled\":true,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[]}}]}",
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "showDefault": false
                  },
                  "defaultValue": "value::all",
                  "queryType": 12
                },
                {
                  "id": "6023e0c7-9b1d-4e77-8f37-19c316c30084",
                  "version": "KqlParameterItem/1.0",
                  "name": "hidden",
                  "type": 1,
                  "value": "yes",
                  "isHiddenWhenLocked": true
                },
                {
                  "id": "3a7cab95-02f1-43db-ae7e-b303f0bf999b",
                  "version": "KqlParameterItem/1.0",
                  "name": "DefaultProcess2",
                  "type": 1,
                  "query": "SapNetweaver_GetProcessList_CL\r\n| where serverTimestamp_t between (todatetime(\"{timePeriod:startISO}\") .. todatetime(\"{timePeriod:endISO}\")) and SID_s==\"{selSID}\" and \"{providerInstance}\" contains PROVIDER_INSTANCE_s\r\n| limit 1\r\n| project description_s",
                  "crossComponentResources": [
                    "{workspace}"
                  ],
                  "isHiddenWhenLocked": true,
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                }
              ],
              "style": "pills",
              "doNotRunWhenHidden": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "customWidth": "80",
            "conditionalVisibilities": [
              {
                "parameterName": "showData",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "showData",
                "comparison": "isEqualTo",
                "value": "true"
              }
            ],
            "name": "parameters"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "eddf4903-edc3-4a35-85fe-0c92102a6bfc",
                  "linkTarget": "OpenBlade",
                  "linkLabel": "Configure Insights",
                  "style": "primary",
                  "linkIsContextBlade": true,
                  "bladeOpenContext": {
                    "bladeName": "ManageInsights.ReactView",
                    "extensionName": "Microsoft_Azure_WorkloadMonitor",
                    "bladeParameters": [
                      {
                        "name": "resourceId",
                        "source": "static",
                        "value": "{amsResource}"
                      }
                    ]
                  }
                }
              ]
            },
            "customWidth": "20",
            "conditionalVisibilities": [
              {
                "parameterName": "showData",
                "comparison": "isNotEqualTo",
                "value": "not set"
              },
              {
                "parameterName": "showData",
                "comparison": "isEqualTo",
                "value": "true"
              }
            ],
            "name": "ConfigureButton_Main"
          },
          {
            "type": 1,
            "content": {
              "json": "Select an SID to view insights.",
              "style": "warning"
            },
            "conditionalVisibilities": [
              {
                "parameterName": "selSID",
                "comparison": "isEqualTo"
              },
              {
                "parameterName": "showData",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "showData",
                "comparison": "isEqualTo",
                "value": "true"
              }
            ],
            "name": "starterBanner"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "crossComponentResources": [
                "{workspace}"
              ],
              "parameters": [
                {
                  "id": "8b9a4b92-95cc-4fb4-91fe-7a55143397f9",
                  "version": "KqlParameterItem/1.0",
                  "name": "selTab",
                  "type": 11,
                  "isRequired": true,
                  "query": "let options=datatable(value:string)[\"Availability\",\"Performance\"];\r\nunion (\r\n    options\r\n    | where (\"{nwExists}\"==\"true\" or \"{hanaExists}\"==\"true\") and value==\"Availability\"\r\n), (\r\n    options\r\n    | where \"{nwExists}\"==\"true\" and value==\"Performance\"\r\n)",
                  "crossComponentResources": [
                    "{workspace}"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                }
              ],
              "style": "pills",
              "doNotRunWhenHidden": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "conditionalVisibility": {
              "parameterName": "selSID",
              "comparison": "isNotEqualTo"
            },
            "name": "insightsParams"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "4f064bf8-9dff-419f-b20a-15d36ba50479",
                  "version": "KqlParameterItem/1.0",
                  "name": "subscription",
                  "type": 6,
                  "isRequired": true,
                  "query": "Resources\r\n| summarize by subscriptionId\r\n| project value = subscriptionId, label = subscriptionId, selected = subscriptionId == '{amsResource:subscription}'",
                  "isHiddenWhenLocked": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources"
                },
                {
                  "id": "14a664ce-e6c2-4b85-8e90-416299b721de",
                  "version": "KqlParameterItem/1.0",
                  "name": "alertTitle",
                  "type": 1,
                  "query": "print iff(\"{selTab}\"==\"Availability\", \"Unavailability alerts for {selSID}\", \"Performance degradation alerts for {selSID}\")",
                  "crossComponentResources": [
                    "{workspace}"
                  ],
                  "isHiddenWhenLocked": true,
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "97887b81-7f5b-431d-9b23-0eb755769a73",
                  "version": "KqlParameterItem/1.0",
                  "name": "alertSubTitle",
                  "type": 1,
                  "query": "print iff(\"{selTab}\"==\"Availability\", \"Unavailability alerts generated due to a lack of availability of the SAP instances. Click on the alert row to narrow the window for insights.\", \"Performance alerts generated due to degraded performance of the SAP instances. View the insights to investigate the root cause.\")",
                  "crossComponentResources": [
                    "{workspace}"
                  ],
                  "isHiddenWhenLocked": true,
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                }
              ],
              "style": "pills",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources"
            },
            "conditionalVisibilities": [
              {
                "parameterName": "selSID",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "hidden",
                "comparison": "isEqualTo",
                "value": "no"
              }
            ],
            "name": "hiddenInsightsParam"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [
                      "{workspace}"
                    ],
                    "parameters": [
                      {
                        "id": "edbc4b3c-e503-4169-95b4-8b75e695a428",
                        "version": "KqlParameterItem/1.0",
                        "name": "performanceAlertTemplates",
                        "type": 2,
                        "multiSelect": true,
                        "quote": "",
                        "delimiter": ",",
                        "isHiddenWhenLocked": true,
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::all"
                          ],
                          "showDefault": false
                        },
                        "jsonData": "[\"sapnetweaver-response-time\", \"sapnetweaver-batch-job-jobname\", \"sapnetweaver-cpu-user-utilization\",\"sapnetweaver-cpu-system-utilization\",\"sapnetweaver-memory-utilization\",\"sapnetweaver-instance-queue-wait\",\"sapnetweaver-instance-work-process-utilization\"]",
                        "defaultValue": "value::all"
                      },
                      {
                        "id": "5c48bbd9-9b60-4e0a-bd41-181d38566b43",
                        "version": "KqlParameterItem/1.0",
                        "name": "availabilityAlertTemplates",
                        "type": 2,
                        "multiSelect": true,
                        "quote": "",
                        "delimiter": ",",
                        "isHiddenWhenLocked": true,
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::all"
                          ],
                          "showDefault": false
                        },
                        "jsonData": "[\"sapnetweaver-system-availability\", \"sapnetweaver-instance-availability\", \"sapnetweaver-enqueue-server\",\"sapnetweaver-enqueue-replicator-server\",\"saphana-availability-reponse\",\"saphana-availability-reponse-services\"]",
                        "defaultValue": "value::all"
                      },
                      {
                        "id": "2da6ac7d-f135-4bce-b91a-41e09ea891ea",
                        "version": "KqlParameterItem/1.0",
                        "name": "alertsOptsData",
                        "type": 1,
                        "query": "AlertsManagementResources\r\n| where type =~ 'microsoft.alertsmanagement/alerts'\r\n| extend StartTime = todatetime(properties.essentials.startDateTime)\r\n| where StartTime between (todatetime(\"{timePeriod:startISO}\") .. todatetime(\"{timePeriod:endISO}\"))\r\n| extend State=tostring(properties.essentials.alertState)\r\n| extend AlertRule=tolower(tostring(properties.essentials.alertRule))\r\n| extend Severity=tostring(properties.essentials.severity)\r\n| extend MonitorCondition=tostring(properties.essentials.monitorCondition)\r\n| join kind=inner (Resources \r\n    | where type =~ 'microsoft.insights/scheduledQueryRules'\r\n    | extend workspace = tostring(properties.scopes[0])\r\n\t| extend pInstance=tags.['profile-id'], templateId=tags.['alert-template-id']\r\n    | where workspace =~ '{workspace}' and ((\"{selTab}\"==\"Availability\" and \"{availabilityAlertTemplates}\" contains templateId) or (\"{selTab}\"!=\"Availability\" and \"{performanceAlertTemplates}\" contains templateId))\r\n    | where (\"{providerInstance}\") contains pInstance \r\n    | project AlertRule=tolower(id), Description=properties.description, pInstance) on AlertRule\r\n| summarize Alerts=count() by Severity\r\n| extend json=pack_all()\r\n| summarize Result = tostring(make_list(json))",
                        "crossComponentResources": [
                          "{workspace}"
                        ],
                        "isHiddenWhenLocked": true,
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      {
                        "id": "ef926b47-be34-4b23-972c-cd995fb7ee32",
                        "version": "KqlParameterItem/1.0",
                        "name": "param_firedTime",
                        "type": 1,
                        "isHiddenWhenLocked": true
                      }
                    ],
                    "style": "above",
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources"
                  },
                  "conditionalVisibility": {
                    "parameterName": "hidden",
                    "comparison": "isEqualTo",
                    "value": "no"
                  },
                  "name": "alertFilters"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "## {alertTitle}\r\n{alertSubTitle}"
                  },
                  "name": "alertTitleDisplay"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "No alerts found in this time range or no alert rules have been configured for this monitoring profile.",
                    "style": "info"
                  },
                  "conditionalVisibility": {
                    "parameterName": "alertsOptsData",
                    "comparison": "isEqualTo",
                    "value": "[]"
                  },
                  "name": "noAlertsInfo"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "9521a919-9b4a-43e2-a259-0fa7fa3e4b15",
                        "version": "KqlParameterItem/1.0",
                        "name": "alertSeverity",
                        "type": 1,
                        "isHiddenWhenLocked": true,
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      },
                      {
                        "id": "c6e0fffe-fceb-4aaa-86e8-737d6ee09d74",
                        "version": "KqlParameterItem/1.0",
                        "name": "param_AlertName",
                        "type": 1,
                        "isHiddenWhenLocked": true
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.workloads/monitors"
                  },
                  "conditionalVisibility": {
                    "parameterName": "hidden",
                    "comparison": "isEqualTo",
                    "value": "no"
                  },
                  "name": "alertHiddenParams"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let sourceTable=print input = parse_json('{alertsOptsData}')\r\n| mv-apply input to typeof(dynamic) on (\r\n    project Alerts=toint(input.Alerts), Severity=tostring(input.Severity)\r\n);\r\nunion (\r\n    sourceTable\r\n    | summarize Value=sum(Alerts)\r\n    | extend Title=\"All alerts\", Order=0, Severity=\"\"\r\n), (\r\n    sourceTable\r\n    | summarize Value=sumif(Alerts, Severity==\"Sev0\")\r\n    | extend Title=\"Critical\", Order=1, Severity=\"Sev0\"\r\n), (\r\n    sourceTable\r\n    | summarize Value=sumif(Alerts, Severity==\"Sev1\")\r\n    | extend Title=\"Error\", Order=2, Severity=\"Sev1\"\r\n), (\r\n    sourceTable\r\n    | summarize Value=sumif(Alerts, Severity==\"Sev2\")\r\n    | extend Title=\"Warning\", Order=3, Severity=\"Sev2\"\r\n), (\r\n    sourceTable\r\n    | summarize Value=sumif(Alerts, Severity==\"Sev3\")\r\n    | extend Title=\"Information\", Order=4, Severity=\"Sev3\"\r\n), (\r\n    sourceTable\r\n    | summarize Value=sumif(Alerts, Severity==\"Sev4\")\r\n    | extend Title=\"Verbose\", Order=5, Severity=\"Sev4\"\r\n)\r\n| order by Order asc",
                    "size": 3,
                    "exportFieldName": "Severity",
                    "exportParameterName": "alertSeverity",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{workspace}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "Title",
                        "formatter": 1
                      },
                      "secondaryContent": {
                        "columnMatch": "Title",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "icons",
                          "thresholdsGrid": [
                            {
                              "operator": "==",
                              "thresholdValue": "Critical",
                              "representation": "Sev0",
                              "text": "[\"Value\"]"
                            },
                            {
                              "operator": "==",
                              "thresholdValue": "Error",
                              "representation": "Sev1",
                              "text": "[\"Value\"]"
                            },
                            {
                              "operator": "==",
                              "thresholdValue": "Warning",
                              "representation": "Sev2",
                              "text": "[\"Value\"]"
                            },
                            {
                              "operator": "==",
                              "thresholdValue": "Information",
                              "representation": "Sev3",
                              "text": "[\"Value\"]"
                            },
                            {
                              "operator": "==",
                              "thresholdValue": "Verbose",
                              "representation": "Sev4",
                              "text": "[\"Value\"]"
                            },
                            {
                              "operator": "==",
                              "thresholdValue": "All alerts",
                              "representation": "Alert",
                              "text": "[\"Value\"]"
                            },
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "Blank",
                              "text": "[\"Value\"]"
                            }
                          ]
                        }
                      },
                      "showBorder": false,
                      "size": "auto"
                    }
                  },
                  "conditionalVisibilities": [
                    {
                      "parameterName": "alertsOptsData",
                      "comparison": "isNotEqualTo"
                    },
                    {
                      "parameterName": "alertsOptsData",
                      "comparison": "isNotEqualTo",
                      "value": "[]"
                    }
                  ],
                  "name": "firedAlertsOverview"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "COMMON_VM_ArmId_Mapping_CL \r\n| distinct PROVIDER_INSTANCE_s, Provider_Type_s, VM_ARM_ID_s=tolower(VM_ARM_ID_s)\r\n| where isnotempty(VM_ARM_ID_s)\r\n| extend SAPComponent=iff(Provider_Type_s==\"SapHana\", \"SAP Hana\", iff(Provider_Type_s==\"SapNetWeaver\", \"SAP NetWeaver\", \"\"))",
                    "size": 3,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{workspace}"
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "hidden",
                    "comparison": "isEqualTo",
                    "value": "no"
                  },
                  "name": "providerTypeMapping"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AlertsManagementResources\r\n| where type =~ 'microsoft.alertsmanagement/alerts'\r\n| extend StartTime = todatetime(properties.essentials.startDateTime)\r\n| where StartTime between (todatetime(\"{timePeriod:startISO}\") .. todatetime(\"{timePeriod:endISO}\"))\r\n| extend State=tostring(properties.essentials.alertState)\r\n| extend AlertRule=tolower(tostring(properties.essentials.alertRule))\r\n| extend Severity=tostring(properties.essentials.severity)\r\n| extend MonitorCondition=tostring(properties.essentials.monitorCondition)\r\n| where isempty(\"{alertSeverity}\") or \"{alertSeverity}\" contains Severity\r\n| join kind=inner (Resources \r\n    | where type =~ 'microsoft.insights/scheduledQueryRules'\r\n    | extend workspace = tostring(properties.scopes[0])\r\n    | extend thresholdTag = strcat(properties.criteria.allOf[0].operator, \" \", properties.criteria.allOf[0].threshold)\r\n\t| extend pInstance=tags.['profile-id'], templateId=tags.['alert-template-id']\r\n    | where workspace =~ '{workspace}' and ((\"{selTab}\"==\"Availability\" and \"{availabilityAlertTemplates}\" contains templateId) or (\"{selTab}\"!=\"Availability\" and \"{performanceAlertTemplates}\" contains templateId)) and (\"{providerInstance}\") contains pInstance\r\n    | project AlertRule=tolower(id), Description=properties.description, pInstance, templateId, thresholdTag) on AlertRule\r\n| order by Severity asc, State, StartTime\r\n| project Name=strcat(name, \" (\", thresholdTag, \")\"), pInstance, Severity, State, StartTime, id, templateId, Insights=\"Investigate\", displayTime=strcat(datetime_add(\"minute\", -30, StartTime), \" - \", datetime_add(\"minute\", 30, StartTime))",
                    "size": 1,
                    "noDataMessage": "No alerts found in this time range or no alert rules have been configured for this monitoring profile.",
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Name",
                          "formatter": 1,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkIsContextBlade": true,
                            "workbookContext": {
                              "componentIdSource": "workbook",
                              "resourceIdsSource": "workbook",
                              "templateIdSource": "parameter",
                              "templateId": "sapInsightsWB",
                              "typeSource": "workbook",
                              "gallerySource": "workbook",
                              "locationSource": "workbook",
                              "passSpecificParams": true,
                              "templateParameters": [
                                {
                                  "name": "timePeriod",
                                  "source": "column",
                                  "value": "StartTime"
                                }
                              ]
                            },
                            "bladeOpenContext": {
                              "bladeName": "AlertDetailsTemplateBlade",
                              "extensionName": "Microsoft_Azure_Monitoring",
                              "bladeParameters": [
                                {
                                  "name": "alertId",
                                  "source": "column",
                                  "value": "id"
                                }
                              ]
                            }
                          },
                          "tooltipFormat": {
                            "tooltip": "Click on this to filter insights specific to this alert."
                          }
                        },
                        {
                          "columnMatch": "pInstance",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Sev0",
                                "representation": "Sev0",
                                "text": "0: Critical"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Sev1",
                                "representation": "Sev1",
                                "text": "1: Error"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Sev2",
                                "representation": "Sev2",
                                "text": "2: Warning"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Sev3",
                                "representation": "Sev3",
                                "text": "3: Information"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Sev4",
                                "representation": "Sev4",
                                "text": "4: Verbose"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "StartTime",
                          "formatter": 6,
                          "dateFormat": {
                            "showUtcTime": null,
                            "formatName": "shortDateTimePattern"
                          }
                        },
                        {
                          "columnMatch": "id",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "templateId",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "AlertInfo",
                          "formatter": 5,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkIsContextBlade": false,
                            "bladeOpenContext": {
                              "bladeName": "AlertDetailsTemplateBlade",
                              "extensionName": "Microsoft_Azure_Monitoring",
                              "bladeParameters": [
                                {
                                  "name": "alertId",
                                  "source": "column",
                                  "value": "id"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "MonitorCondition",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Resolved",
                                "representation": "Resolved",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Fired",
                                "representation": "Fired",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Description",
                          "formatter": 1
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "pInstance",
                          "label": "Provider"
                        },
                        {
                          "columnId": "StartTime",
                          "label": "Fired Time"
                        }
                      ]
                    },
                    "sortBy": []
                  },
                  "customWidth": "0",
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selTab",
                      "comparison": "isEqualTo",
                      "value": "Availability"
                    },
                    {
                      "parameterName": "alertsOptsData",
                      "comparison": "isNotEqualTo"
                    },
                    {
                      "parameterName": "alertsOptsData",
                      "comparison": "isNotEqualTo",
                      "value": "[]"
                    },
                    {
                      "parameterName": "hidden",
                      "comparison": "isEqualTo",
                      "value": "no"
                    }
                  ],
                  "showPin": false,
                  "name": "firedAlertsAvail"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"31e8cdd4-6e9b-496a-b63a-e47b40872160\",\"mergeType\":\"inner\",\"leftTable\":\"firedAlertsAvail\",\"rightTable\":\"providerTypeMapping\",\"leftColumn\":\"pInstance\",\"rightColumn\":\"PROVIDER_INSTANCE_s\"}],\"projectRename\":[{\"originalName\":\"[firedAlertsAvail].Name\",\"mergedName\":\"Name\",\"fromId\":\"31e8cdd4-6e9b-496a-b63a-e47b40872160\"},{\"originalName\":\"[firedAlertsAvail].pInstance\",\"mergedName\":\"pInstance\",\"fromId\":\"31e8cdd4-6e9b-496a-b63a-e47b40872160\"},{\"originalName\":\"[providerTypeMapping].VM_ARM_ID_s\",\"mergedName\":\"VM_ARM_ID_s\",\"fromId\":\"unknown\"},{\"originalName\":\"[firedAlertsAvail].id\",\"mergedName\":\"id\",\"fromId\":\"31e8cdd4-6e9b-496a-b63a-e47b40872160\"},{\"originalName\":\"[firedAlertsAvail].Severity\",\"mergedName\":\"Severity\",\"fromId\":\"31e8cdd4-6e9b-496a-b63a-e47b40872160\"},{\"originalName\":\"[firedAlertsAvail].State\",\"mergedName\":\"State\",\"fromId\":\"31e8cdd4-6e9b-496a-b63a-e47b40872160\"},{\"originalName\":\"[firedAlertsAvail].StartTime\",\"mergedName\":\"Fired Time\",\"fromId\":\"31e8cdd4-6e9b-496a-b63a-e47b40872160\"},{\"originalName\":\"[firedAlertsAvail].templateId\",\"mergedName\":\"templateId\",\"fromId\":\"31e8cdd4-6e9b-496a-b63a-e47b40872160\"},{\"originalName\":\"[providerTypeMapping].PROVIDER_INSTANCE_s\",\"mergedName\":\"PROVIDER_INSTANCE_s\",\"fromId\":\"31e8cdd4-6e9b-496a-b63a-e47b40872160\"},{\"originalName\":\"[providerTypeMapping].Provider_Type_s\",\"mergedName\":\"Provider_Type_s\",\"fromId\":\"31e8cdd4-6e9b-496a-b63a-e47b40872160\"},{\"originalName\":\"[providerTypeMapping].SAPComponent\",\"mergedName\":\"SAPComponent\",\"fromId\":\"31e8cdd4-6e9b-496a-b63a-e47b40872160\"},{\"originalName\":\"[firedAlertsAvail].Insights\",\"mergedName\":\"Insights\",\"fromId\":\"unknown\"},{\"originalName\":\"[firedAlertsAvail].displayTime\",\"mergedName\":\"displayTime\",\"fromId\":\"unknown\"}]}",
                    "size": 1,
                    "noDataMessage": "No alerts found in this time range or no alert rules have been configured for this monitoring profile.",
                    "exportedParameters": [
                      {
                        "fieldName": "Fired Time",
                        "parameterName": "param_firedTime",
                        "parameterType": 1
                      },
                      {
                        "fieldName": "templateId",
                        "parameterName": "param_templateId",
                        "parameterType": 1
                      },
                      {
                        "fieldName": "Name",
                        "parameterName": "param_AlertName",
                        "parameterType": 1
                      }
                    ],
                    "queryType": 7,
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Name",
                          "formatter": 1,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkIsContextBlade": true,
                            "workbookContext": {
                              "componentIdSource": "workbook",
                              "resourceIdsSource": "workbook",
                              "templateIdSource": "parameter",
                              "templateId": "sapInsightsWB",
                              "typeSource": "workbook",
                              "gallerySource": "workbook",
                              "locationSource": "workbook",
                              "passSpecificParams": true,
                              "templateParameters": [
                                {
                                  "name": "timePeriod",
                                  "source": "column",
                                  "value": "StartTime"
                                }
                              ]
                            },
                            "bladeOpenContext": {
                              "bladeName": "AlertDetailsTemplateBlade",
                              "extensionName": "Microsoft_Azure_Monitoring",
                              "bladeParameters": [
                                {
                                  "name": "alertId",
                                  "source": "column",
                                  "value": "id"
                                }
                              ]
                            },
                            "customColumnWidthSetting": "34%"
                          },
                          "tooltipFormat": {
                            "tooltip": "Click on this to filter insights specific to this alert."
                          }
                        },
                        {
                          "columnMatch": "pInstance",
                          "formatter": 1,
                          "formatOptions": {
                            "customColumnWidthSetting": "15%"
                          }
                        },
                        {
                          "columnMatch": "id",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Sev0",
                                "representation": "Sev0",
                                "text": "0: Critical"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Sev1",
                                "representation": "Sev1",
                                "text": "1: Error"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Sev2",
                                "representation": "Sev2",
                                "text": "2: Warning"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Sev3",
                                "representation": "Sev3",
                                "text": "3: Information"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Sev4",
                                "representation": "Sev4",
                                "text": "4: Verbose"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ],
                            "customColumnWidthSetting": "15%"
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "10%"
                          }
                        },
                        {
                          "columnMatch": "Fired Time",
                          "formatter": 6,
                          "formatOptions": {
                            "customColumnWidthSetting": "16%"
                          },
                          "dateFormat": {
                            "showUtcTime": null,
                            "formatName": "shortDateTimePattern"
                          }
                        },
                        {
                          "columnMatch": "templateId",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "PROVIDER_INSTANCE_s",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "SAPComponent",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Insights",
                          "formatter": 1,
                          "formatOptions": {
                            "linkTarget": "WorkbookTemplate",
                            "linkIsContextBlade": true,
                            "workbookContext": {
                              "componentIdSource": "workbook",
                              "resourceIdsSource": "workbook",
                              "templateIdSource": "static",
                              "templateId": "Community-Workbooks/SapMonitor2.0/AIOpsInsights/Availability Insights",
                              "typeSource": "workbook",
                              "gallerySource": "workbook",
                              "locationSource": "workbook",
                              "workbookName": "Availability alert investigation for {selSID}",
                              "passSpecificParams": true,
                              "templateParameters": [
                                {
                                  "name": "SID",
                                  "source": "parameter",
                                  "value": "selSID"
                                },
                                {
                                  "name": "Provider",
                                  "source": "parameter",
                                  "value": "providerInstance"
                                },
                                {
                                  "name": "TimeRange",
                                  "source": "parameter",
                                  "value": "timePeriod"
                                },
                                {
                                  "name": "TimePeriod",
                                  "source": "column",
                                  "value": "displayTime"
                                },
                                {
                                  "name": "SAPComponent",
                                  "source": "column",
                                  "value": "SAPComponent"
                                },
                                {
                                  "name": "AlertName",
                                  "source": "column",
                                  "value": "Name"
                                },
                                {
                                  "name": "AlertFired",
                                  "source": "column",
                                  "value": "Fired Time"
                                },
                                {
                                  "name": "VMID",
                                  "source": "column",
                                  "value": "VM_ARM_ID_s"
                                },
                                {
                                  "name": "Process",
                                  "source": "parameter",
                                  "value": "DefaultProcess2"
                                },
                                {
                                  "name": "Tab",
                                  "source": "static",
                                  "value": "Summary"
                                }
                              ]
                            },
                            "customColumnWidthSetting": "10%"
                          }
                        },
                        {
                          "columnMatch": "displayTime",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "StartTime",
                          "formatter": 6,
                          "dateFormat": {
                            "showUtcTime": null,
                            "formatName": "shortDateTimePattern"
                          }
                        },
                        {
                          "columnMatch": "AlertInfo",
                          "formatter": 5,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkIsContextBlade": false,
                            "bladeOpenContext": {
                              "bladeName": "AlertDetailsTemplateBlade",
                              "extensionName": "Microsoft_Azure_Monitoring",
                              "bladeParameters": [
                                {
                                  "name": "alertId",
                                  "source": "column",
                                  "value": "id"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "MonitorCondition",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Resolved",
                                "representation": "Resolved",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Fired",
                                "representation": "Fired",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Description",
                          "formatter": 1
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "pInstance",
                          "label": "Provider"
                        },
                        {
                          "columnId": "VM_ARM_ID_s",
                          "label": "VM Name"
                        },
                        {
                          "columnId": "Insights",
                          "label": "Action"
                        }
                      ]
                    },
                    "sortBy": []
                  },
                  "customWidth": "100",
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selTab",
                      "comparison": "isEqualTo",
                      "value": "Availability"
                    },
                    {
                      "parameterName": "alertsOptsData",
                      "comparison": "isNotEqualTo"
                    },
                    {
                      "parameterName": "alertsOptsData",
                      "comparison": "isNotEqualTo",
                      "value": "[]"
                    }
                  ],
                  "showPin": false,
                  "name": "firedAlertsAvailMerged"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AlertsManagementResources\r\n| where type =~ 'microsoft.alertsmanagement/alerts'\r\n| extend StartTime = todatetime(properties.essentials.startDateTime)\r\n| where StartTime between (todatetime(\"{timePeriod:startISO}\") .. todatetime(\"{timePeriod:endISO}\"))\r\n| extend State=tostring(properties.essentials.alertState)\r\n| extend AlertRule=tolower(tostring(properties.essentials.alertRule))\r\n| extend Severity=tostring(properties.essentials.severity)\r\n| extend MonitorCondition=tostring(properties.essentials.monitorCondition)\r\n| where isempty(\"{alertSeverity}\") or \"{alertSeverity}\" contains Severity\r\n| join kind=inner (Resources \r\n    | where type =~ 'microsoft.insights/scheduledQueryRules'\r\n    | extend workspace = tostring(properties.scopes[0])\r\n    | extend thresholdTag = strcat(properties.criteria.allOf[0].operator, \" \", properties.criteria.allOf[0].threshold)\r\n\t| extend pInstance=tags.['profile-id'], templateId=tags.['alert-template-id']\r\n    | where workspace =~ '{workspace}' and ((\"{selTab}\"==\"Availability\" and \"{availabilityAlertTemplates}\" contains templateId) or (\"{selTab}\"!=\"Availability\" and \"{performanceAlertTemplates}\" contains templateId)) and (\"{providerInstance}\") contains pInstance\r\n    | project AlertRule=tolower(id), Description=properties.description, pInstance, templateId, thresholdTag) on AlertRule\r\n| order by Severity asc, State, StartTime\r\n| project Name=strcat(name, \" (\", thresholdTag, \")\"), pInstance, Severity, State, id, StartTime, Insights=\"Investigate\", templateId",
                    "size": 1,
                    "noDataMessage": "No alerts found in this time range or no alert rules have been configured for this monitoring profile.",
                    "exportedParameters": [
                      {
                        "fieldName": "StartTime",
                        "parameterName": "param_firedTime",
                        "parameterType": 1
                      },
                      {
                        "fieldName": "templateId",
                        "parameterName": "param_templateId",
                        "parameterType": 1
                      }
                    ],
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Name",
                          "formatter": 1,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkIsContextBlade": true,
                            "workbookContext": {
                              "componentIdSource": "workbook",
                              "resourceIdsSource": "workbook",
                              "templateIdSource": "parameter",
                              "templateId": "sapInsightsWB",
                              "typeSource": "workbook",
                              "gallerySource": "workbook",
                              "locationSource": "workbook",
                              "passSpecificParams": true,
                              "templateParameters": [
                                {
                                  "name": "timePeriod",
                                  "source": "column",
                                  "value": "StartTime"
                                }
                              ]
                            },
                            "bladeOpenContext": {
                              "bladeName": "AlertDetailsTemplateBlade",
                              "extensionName": "Microsoft_Azure_Monitoring",
                              "bladeParameters": [
                                {
                                  "name": "alertId",
                                  "source": "column",
                                  "value": "id"
                                }
                              ]
                            },
                            "customColumnWidthSetting": "34%"
                          }
                        },
                        {
                          "columnMatch": "pInstance",
                          "formatter": 1,
                          "formatOptions": {
                            "customColumnWidthSetting": "15%"
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Sev0",
                                "representation": "Sev0",
                                "text": "0 Critical"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Sev1",
                                "representation": "Sev1",
                                "text": "1: Error"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Sev2",
                                "representation": "Sev2",
                                "text": "2: Warning"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Sev3",
                                "representation": "Sev3",
                                "text": "3: Information"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Sev4",
                                "representation": "Sev4",
                                "text": "4: Verbose"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ],
                            "customColumnWidthSetting": "15%"
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "10%"
                          }
                        },
                        {
                          "columnMatch": "id",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "StartTime",
                          "formatter": 6,
                          "formatOptions": {
                            "customColumnWidthSetting": "16%"
                          },
                          "dateFormat": {
                            "showUtcTime": null,
                            "formatName": "shortDateTimePattern"
                          }
                        },
                        {
                          "columnMatch": "Insights",
                          "formatter": 1,
                          "formatOptions": {
                            "linkTarget": "WorkbookTemplate",
                            "linkIsContextBlade": true,
                            "workbookContext": {
                              "componentIdSource": "workbook",
                              "resourceIdsSource": "workbook",
                              "templateIdSource": "static",
                              "templateId": "Community-Workbooks/SapMonitor2.0/AIOpsInsights/Performance Insights",
                              "typeSource": "workbook",
                              "gallerySource": "workbook",
                              "locationSource": "workbook",
                              "workbookName": "Performance alert investigation for {selSID}",
                              "passSpecificParams": true,
                              "templateParameters": [
                                {
                                  "name": "AlertFired",
                                  "source": "column",
                                  "value": "StartTime"
                                },
                                {
                                  "name": "AlertTemplate",
                                  "source": "column",
                                  "value": "templateId"
                                },
                                {
                                  "name": "AlertName",
                                  "source": "column",
                                  "value": "Name"
                                },
                                {
                                  "name": "SID",
                                  "source": "parameter",
                                  "value": "selSID"
                                },
                                {
                                  "name": "Provider",
                                  "source": "parameter",
                                  "value": "providerInstance"
                                },
                                {
                                  "name": "TimeRange",
                                  "source": "parameter",
                                  "value": "timePeriod"
                                }
                              ]
                            },
                            "customColumnWidthSetting": "10%"
                          }
                        },
                        {
                          "columnMatch": "templateId",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "AlertInfo",
                          "formatter": 1,
                          "formatOptions": {
                            "linkTarget": "OpenBlade",
                            "linkIsContextBlade": true,
                            "bladeOpenContext": {
                              "bladeName": "AlertDetailsTemplateBlade",
                              "extensionName": "Microsoft_Azure_Monitoring",
                              "bladeParameters": [
                                {
                                  "name": "alertId",
                                  "source": "column",
                                  "value": "id"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "MonitorCondition",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Description",
                          "formatter": 1
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "pInstance",
                          "label": "Provider"
                        },
                        {
                          "columnId": "StartTime",
                          "label": "Fired Time"
                        },
                        {
                          "columnId": "Insights",
                          "label": "Action"
                        }
                      ]
                    },
                    "sortBy": []
                  },
                  "customWidth": "100",
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selTab",
                      "comparison": "isEqualTo",
                      "value": "Performance"
                    },
                    {
                      "parameterName": "alertsOptsData",
                      "comparison": "isNotEqualTo"
                    },
                    {
                      "parameterName": "alertsOptsData",
                      "comparison": "isNotEqualTo",
                      "value": "[]"
                    }
                  ],
                  "showPin": false,
                  "name": "firedAlertsPerf"
                }
              ],
              "exportParameters": true
            },
            "conditionalVisibility": {
              "parameterName": "selSID",
              "comparison": "isNotEqualTo"
            },
            "name": "alertsPane"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "crossComponentResources": [
                "{workspace}"
              ],
              "parameters": [
                {
                  "id": "e2b6dde7-64ea-41ec-82f6-2c2d36633b2a",
                  "version": "KqlParameterItem/1.0",
                  "name": "startTime",
                  "type": 1,
                  "query": "print iff(isempty(\"{param_firedTime}\") or \"{param_firedTime}\" == \"none\", todatetime(\"{timePeriod:startISO}\"), datetime_add(\"minute\", -30, todatetime(\"{param_firedTime}\")));\r\nlet endTime = iff(isempty(\"{param_firedTime}\") or \"{param_firedTime}\" == \"none\", todatetime(\"{timePeriod:endISO}\"), datetime_add(\"minute\", 30, todatetime(\"{param_firedTime}\")))",
                  "crossComponentResources": [
                    "{workspace}"
                  ],
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "78c360ea-113c-4004-9971-936215fc4335",
                  "version": "KqlParameterItem/1.0",
                  "name": "endTime",
                  "type": 1,
                  "query": "print iff(isempty(\"{param_firedTime}\") or \"{param_firedTime}\" == \"none\", todatetime(\"{timePeriod:endISO}\"), datetime_add(\"minute\", 30, todatetime(\"{param_firedTime}\")))",
                  "crossComponentResources": [
                    "{workspace}"
                  ],
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "3afabf11-ec88-4a57-806c-ec715446a046",
                  "version": "KqlParameterItem/1.0",
                  "name": "minutesBin",
                  "type": 1,
                  "query": "let dateDiff = tolong(datetime_diff('minute', todatetime(\"{endTime}\"), todatetime(\"{startTime}\")));\r\nlet numParts = iff(dateDiff <= 4000, iff(dateDiff<10, iff(dateDiff==0, 1, dateDiff), dateDiff/5), tolong(4000));\r\nprint iff(dateDiff <= 4000, iff(dateDiff<10, dateDiff, 5), dateDiff/4000)",
                  "crossComponentResources": [
                    "{workspace}"
                  ],
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "5936cbc3-4c18-49aa-a8df-5ee069b0fb59",
                  "version": "KqlParameterItem/1.0",
                  "name": "showPlot",
                  "type": 1,
                  "query": "print iff(isnotempty(\"{minutesBin}\") and {minutesBin} > 0, true, false)",
                  "crossComponentResources": [
                    "{workspace}"
                  ],
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "b4e66584-69ad-4429-8731-6967fa16b278",
                  "version": "KqlParameterItem/1.0",
                  "name": "displayRange",
                  "type": 1,
                  "query": "print strcat(\"{startTime}\", \" - \", \"{endTime}\")",
                  "isHiddenWhenLocked": true,
                  "queryType": 0,
                  "resourceType": "microsoft.workloads/monitors"
                },
                {
                  "id": "4c6293b3-496e-46d6-a724-433e72cc5df3",
                  "version": "KqlParameterItem/1.0",
                  "name": "DefaultProcess",
                  "type": 1,
                  "query": "let startTime = todatetime(\"{startTime}\");\r\nlet endTime = todatetime(\"{endTime}\");\r\n\r\nSapNetweaver_GetProcessList_CL\r\n| where serverTimestamp_t between (startTime .. endTime) and SID_s==\"{selSID}\" and \"{providerInstance}\" contains PROVIDER_INSTANCE_s\r\n| limit 1\r\n| project description_s",
                  "crossComponentResources": [
                    "{workspace}"
                  ],
                  "isHiddenWhenLocked": true,
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "conditionalVisibility": {
              "parameterName": "param_SID",
              "comparison": "isNotEqualTo"
            },
            "name": "visibilityCheck"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "## SAP system availability insights for {selSID}\r\nSelecting an alert filters these insights to a 1-hour window around the selected alert."
                        },
                        "name": "availabilityTitleDisplay"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{amsResource}"
                          ],
                          "parameters": [
                            {
                              "id": "9ca288fe-75f6-4a54-9687-9e36ad1f9234",
                              "version": "KqlParameterItem/1.0",
                              "name": "providerType",
                              "type": 11,
                              "isRequired": true,
                              "query": "let options=datatable(value: string, label: string)[\r\n    \"netweaver\", \"SAP NetWeaver\", \r\n    \"hana\", \"SAP HANA\"\r\n];\r\nunion(options\r\n| where (\"{nwExists}\"==\"true\" and value==\"netweaver\")),\r\n(options\r\n| where (\"{hanaExists}\"==\"true\" and value==\"hana\"))",
                              "crossComponentResources": [
                                "{amsResource}"
                              ],
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "queryType": 0,
                              "resourceType": "microsoft.workloads/monitors"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.workloads/monitors"
                        },
                        "name": "parameters - 3"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let startTime = todatetime(\"{startTime}\");\r\nlet endTime = todatetime(\"{endTime}\");\r\n\r\nlet binSize=tolong(\"{minutesBin}\")*1m;\r\nlet hundredBin=datetime_diff(\"minute\", endTime, startTime);\r\n\r\nlet ParentAvailTable=SapNetweaver_GetProcessList_CL\r\n| where serverTimestamp_t between (startTime .. endTime) and SID_s==\"{selSID}\" and \"{providerInstance}\" contains PROVIDER_INSTANCE_s\r\n| project description_s, SID_s, hostname_s, dispstatus_s, serverTimestamp_t, ApplicationServer=strcat(hostname_s, \"_\", iff(toint(instanceNr_d)<10, strcat(\"0\", toint(instanceNr_d)), tostring(toint(instanceNr_d))));\r\n\r\nunion(ParentAvailTable\r\n| make-series AvailabilityTrend=iff(count() > 0, round(toreal(countif(dispstatus_s == 'SAPControl-GREEN')) / toreal(count()) * 100, 1), real(null)) default=real(null) on serverTimestamp_t step binSize  by SID_s, hostname_s, description_s, ApplicationServer\r\n| project Availability=toreal(series_stats_dynamic(series_fill_const(AvailabilityTrend, 0.0)).avg), SID_s, hostname_s, description_s, ApplicationServer \r\n| join kind=inner (\r\n    ParentAvailTable\r\n        | make-series AvailabilityTrend=iff(count() > 0, round(toreal(countif(dispstatus_s == 'SAPControl-GREEN')) / toreal(count()) * 100, 1), real(null)) default=real(null) on serverTimestamp_t step iff(hundredBin<100, 1m, hundredBin/100*1m) by SID_s, hostname_s, description_s\r\n        | project AvailabilityTrend=series_fill_const(AvailabilityTrend, 0.0), SID_s, hostname_s, description_s\r\n) on hostname_s, description_s, SID_s\r\n| join kind=inner (\r\n    COMMON_VM_ArmId_Mapping_CL\r\n    | where (isempty(sid_s) or sid_s==\"{selSID}\") and \"{providerInstance}\" contains PROVIDER_INSTANCE_s\r\n    | distinct VM_ARM_ID_s=tolower(VM_ARM_ID_s), vm_name_s) on $left.hostname_s==$right.vm_name_s\r\n| project description_s, SID_s, ApplicationServer, VM_ARM_ID_s, hostname_s, Availability, AvailabilityTrend\r\n| extend Insights=\"\", Display=\"\", SAPComponent='SAP NetWeaver', id=strcat(hostname_s,\"_\",description_s),parentid=hostname_s),\r\n(ParentAvailTable\r\n| distinct hostname_s\r\n| join kind=inner (\r\n    COMMON_VM_ArmId_Mapping_CL\r\n    | where (isempty(sid_s) or sid_s==\"{selSID}\") and \"{providerInstance}\" contains PROVIDER_INSTANCE_s\r\n    | distinct VM_ARM_ID_s=tolower(VM_ARM_ID_s), vm_name_s) on $left.hostname_s==$right.vm_name_s\r\n| project-away vm_name_s\r\n| extend id=hostname_s, parentid=\"\", SAPComponent='SAP NetWeaver', Insights=\"Investigate\", Display=hostname_s)",
                          "size": 3,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "ApplicationServer",
                                "formatter": 1,
                                "formatOptions": {
                                  "linkTarget": "WorkbookTemplate",
                                  "linkIsContextBlade": true,
                                  "workbookContext": {
                                    "componentIdSource": "workbook",
                                    "resourceIdsSource": "parameter",
                                    "resourceIds": "workspace",
                                    "templateIdSource": "static",
                                    "templateId": "Community-Workbooks/SapMonitor2.0/SapNetWeaver/ApplicationServerInsights",
                                    "typeSource": "workbook",
                                    "gallerySource": "workbook",
                                    "locationSource": "default",
                                    "passSpecificParams": true,
                                    "templateParameters": [
                                      {
                                        "name": "ApplicationServer",
                                        "source": "cell",
                                        "value": ""
                                      },
                                      {
                                        "name": "TimeRange",
                                        "source": "parameter",
                                        "value": "timePeriod"
                                      },
                                      {
                                        "name": "SID",
                                        "source": "column",
                                        "value": "SID_s"
                                      }
                                    ]
                                  }
                                }
                              },
                              {
                                "columnMatch": "VM_ARM_ID_s",
                                "formatter": 5,
                                "formatOptions": {
                                  "linkTarget": "Resource",
                                  "linkIsContextBlade": false,
                                  "customColumnWidthSetting": "5%"
                                }
                              },
                              {
                                "columnMatch": "hostname_s",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Availability",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "is Empty",
                                      "representation": "Blank",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "<",
                                      "thresholdValue": "50",
                                      "representation": "4",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "<",
                                      "thresholdValue": "100",
                                      "representation": "2",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": true,
                                    "maximumFractionDigits": 2
                                  }
                                }
                              },
                              {
                                "columnMatch": "AvailabilityTrend",
                                "formatter": 9,
                                "formatOptions": {
                                  "min": 0,
                                  "max": 100,
                                  "palette": "green"
                                }
                              },
                              {
                                "columnMatch": "Insights",
                                "formatter": 1,
                                "formatOptions": {
                                  "linkTarget": "WorkbookTemplate",
                                  "linkIsContextBlade": true,
                                  "workbookContext": {
                                    "componentIdSource": "workbook",
                                    "resourceIdsSource": "workbook",
                                    "templateIdSource": "static",
                                    "templateId": "Community-Workbooks/SapMonitor2.0/AIOpsInsights/Availability Insights",
                                    "typeSource": "workbook",
                                    "gallerySource": "workbook",
                                    "locationSource": "workbook",
                                    "workbookName": "Availability insights for {selSID}",
                                    "passSpecificParams": true,
                                    "templateParameters": [
                                      {
                                        "name": "VMID",
                                        "source": "column",
                                        "value": "VM_ARM_ID_s"
                                      },
                                      {
                                        "name": "SID",
                                        "source": "parameter",
                                        "value": "selSID"
                                      },
                                      {
                                        "name": "Provider",
                                        "source": "parameter",
                                        "value": "providerInstance"
                                      },
                                      {
                                        "name": "TimePeriod",
                                        "source": "parameter",
                                        "value": "displayRange"
                                      },
                                      {
                                        "name": "SAPComponent",
                                        "source": "column",
                                        "value": "SAPComponent"
                                      },
                                      {
                                        "name": "TimeRange",
                                        "source": "parameter",
                                        "value": "timePeriod"
                                      },
                                      {
                                        "name": "AlertName",
                                        "source": "parameter",
                                        "value": "param_AlertName"
                                      },
                                      {
                                        "name": "AlertFired",
                                        "source": "parameter",
                                        "value": "param_firedTime"
                                      },
                                      {
                                        "name": "Process",
                                        "source": "parameter",
                                        "value": "DefaultProcess"
                                      },
                                      {
                                        "name": "Tab",
                                        "source": "static",
                                        "value": "Summary"
                                      }
                                    ]
                                  }
                                }
                              },
                              {
                                "columnMatch": "SAPComponent",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "id",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "parentid",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "VM Name",
                                "formatter": 1
                              },
                              {
                                "columnMatch": "display_s",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Group",
                                "formatter": 1
                              },
                              {
                                "columnMatch": "Process",
                                "formatter": 1
                              }
                            ],
                            "hierarchySettings": {
                              "idColumn": "id",
                              "parentColumn": "parentid",
                              "treeType": 0,
                              "expanderColumn": "Display",
                              "expandTopLevel": true
                            },
                            "labelSettings": [
                              {
                                "columnId": "description_s",
                                "label": "Process"
                              },
                              {
                                "columnId": "SID_s",
                                "label": "SID"
                              },
                              {
                                "columnId": "ApplicationServer",
                                "label": "Application Server"
                              },
                              {
                                "columnId": "VM_ARM_ID_s",
                                "label": "VM Name"
                              },
                              {
                                "columnId": "hostname_s",
                                "label": "VM Name"
                              },
                              {
                                "columnId": "Availability",
                                "label": "Process Availability"
                              },
                              {
                                "columnId": "AvailabilityTrend",
                                "label": "Availability Trend"
                              },
                              {
                                "columnId": "Insights",
                                "label": "Action"
                              },
                              {
                                "columnId": "Display",
                                "label": "VM Name"
                              },
                              {
                                "columnId": "SAPComponent",
                                "label": "Component"
                              }
                            ]
                          }
                        },
                        "customWidth": "0",
                        "conditionalVisibilities": [
                          {
                            "parameterName": "nwExists",
                            "comparison": "isEqualTo",
                            "value": "true"
                          },
                          {
                            "parameterName": "providerType",
                            "comparison": "isEqualTo",
                            "value": "netweaver"
                          }
                        ],
                        "name": "netweaverAvailability"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let startTime = todatetime(\"{startTime}\");\r\nlet endTime = todatetime(\"{endTime}\");\r\n\r\nlet bin = tolong(\"{minutesBin}\");\r\nlet binSize=iff(bin < 60, 60m, bin*1m);\r\nlet hundredBin=datetime_diff(\"hour\", endTime, startTime);\r\n\r\nlet ParentAvailTable=SapHana_SystemOverview_CL \r\n| extend sid = tostring(VALUE_s)\r\n| extend provider = tostring(PROVIDER_INSTANCE_s)\r\n| where \"{providerInstance}\" contains provider\r\n| where NAME_s == \"Instance ID\" and sid == \"{selSID}\"\r\n| distinct SID_s = sid, PROVIDER_INSTANCE_s=provider\r\n| join kind=inner (SapHana_SystemAvailability_CL\r\n    | where Time_Generated_t between (startTime .. endTime)\r\n    ) on PROVIDER_INSTANCE_s\r\n| project-away DATABASE_NAME_s\r\n| join kind=inner (SapHana_size01_CL \r\n    | where SYSTEM_ID_s == \"{selSID}\"\r\n    | distinct PROVIDER_INSTANCE_s, DATABASE_NAME_s\r\n    ) on PROVIDER_INSTANCE_s\r\n| project DATABASE_NAME_s, PORT_d, SERVICE_NAME_s, SERVICE_ACTIVE_s, HOST_s, HOST_ACTIVE_s, Time_Generated_t, SID_s;\r\n\r\nunion(ParentAvailTable\r\n| make-series AvailabilityTrend=iff(count() > 0, round(toreal(countif(HOST_ACTIVE_s == 'YES')) / toreal(count()) * 100, 1), real(null)) default=real(null) on Time_Generated_t step binSize  by HOST_s, DATABASE_NAME_s\r\n| project Availability=round(toreal(series_stats_dynamic(series_fill_const(AvailabilityTrend, 0.0)).avg), 1), HOST_s, DATABASE_NAME_s \r\n| join kind=inner (\r\n    ParentAvailTable\r\n        | make-series AvailabilityTrend=iff(count() > 0, round(toreal(countif(HOST_ACTIVE_s == 'YES')) / toreal(count()) * 100, 1), real(null)) default=real(null) on Time_Generated_t step iff(hundredBin<100, 1h, hundredBin/100*1h) by HOST_s, DATABASE_NAME_s\r\n        | project AvailabilityTrend=series_fill_const(AvailabilityTrend, 0.0), HOST_s, DATABASE_NAME_s\r\n) on HOST_s, DATABASE_NAME_s\r\n| join kind=inner (\r\n    COMMON_VM_ArmId_Mapping_CL\r\n    | where (isempty(sid_s) or sid_s==\"{selSID}\") and \"{providerInstance}\" contains PROVIDER_INSTANCE_s\r\n    | distinct VM_ARM_ID_s=tolower(VM_ARM_ID_s), vm_name_s) on $left.HOST_s==$right.vm_name_s\r\n| project description_s=DATABASE_NAME_s, VM_ARM_ID_s, Availability, AvailabilityTrend\r\n| extend Insights=\"Investigate\", SAPComponent='SAP Hana', SID_s = \"{selSID}\"\r\n| extend display_s=description_s, parentid=\"\", id=description_s, Service=\"\"),\r\n(ParentAvailTable\r\n| where isnotempty(SERVICE_NAME_s)\r\n| extend Service=strcat(SERVICE_NAME_s, \" (:\", toint(PORT_d), \")\")\r\n| make-series AvailabilityTrend=iff(count() > 0, round(toreal(countif(SERVICE_ACTIVE_s == 'YES')) / toreal(count()) * 100, 1), real(null)) default=real(null) on Time_Generated_t step binSize  by HOST_s, DATABASE_NAME_s, Service\r\n| project Availability=round(toreal(series_stats_dynamic(series_fill_const(AvailabilityTrend, 0.0)).avg), 1), HOST_s, DATABASE_NAME_s, Service \r\n| join kind=inner (\r\n    ParentAvailTable\r\n        | where isnotempty(SERVICE_NAME_s)\r\n        | extend Service=strcat(SERVICE_NAME_s, \" (:\", toint(PORT_d), \")\")\r\n        | make-series AvailabilityTrend=iff(count() > 0, round(toreal(countif(SERVICE_ACTIVE_s == 'YES')) / toreal(count()) * 100, 1), real(null)) default=real(null) on Time_Generated_t step iff(hundredBin<100, 1h, hundredBin/100*1h) by HOST_s, DATABASE_NAME_s, Service\r\n        | project AvailabilityTrend=series_fill_const(AvailabilityTrend, 0.0), HOST_s, DATABASE_NAME_s, Service\r\n) on HOST_s, DATABASE_NAME_s, Service\r\n| join kind=inner (\r\n    COMMON_VM_ArmId_Mapping_CL\r\n    | where (isempty(sid_s) or sid_s==\"{selSID}\") and \"{providerInstance}\" contains PROVIDER_INSTANCE_s\r\n    | distinct VM_ARM_ID_s=tolower(VM_ARM_ID_s), vm_name_s) on $left.HOST_s==$right.vm_name_s\r\n| project description_s=DATABASE_NAME_s, Service, VM_ARM_ID_s, Availability, AvailabilityTrend\r\n| extend Insights=\"\", SAPComponent='SAP Hana', SID_s = \"{selSID}\"\r\n| extend display_s=Service\r\n| extend parentid=description_s\r\n| extend id=strcat(parentid,\"_\",Service))\r\n| project id, parentid, description_s, Service, VM_ARM_ID_s, SID_s, Availability, AvailabilityTrend, Insights, SAPComponent, display_s",
                          "size": 3,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "id",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "parentid",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "description_s",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Service",
                                "formatter": 5,
                                "formatOptions": {
                                  "customColumnWidthSetting": "10%"
                                }
                              },
                              {
                                "columnMatch": "VM_ARM_ID_s",
                                "formatter": 13,
                                "formatOptions": {
                                  "linkTarget": "Resource",
                                  "linkIsContextBlade": false,
                                  "showIcon": true,
                                  "customColumnWidthSetting": "3%"
                                }
                              },
                              {
                                "columnMatch": "Availability",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "<",
                                      "thresholdValue": "50",
                                      "representation": "4",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "<",
                                      "thresholdValue": "100",
                                      "representation": "2",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": true,
                                    "maximumFractionDigits": 2
                                  }
                                },
                                "tooltipFormat": {
                                  "tooltip": "Click on this to expand availability trend and RCA."
                                }
                              },
                              {
                                "columnMatch": "AvailabilityTrend",
                                "formatter": 9,
                                "formatOptions": {
                                  "min": 0,
                                  "max": 100,
                                  "palette": "green"
                                }
                              },
                              {
                                "columnMatch": "Insights",
                                "formatter": 1,
                                "formatOptions": {
                                  "linkTarget": "WorkbookTemplate",
                                  "linkIsContextBlade": true,
                                  "workbookContext": {
                                    "componentIdSource": "workbook",
                                    "resourceIdsSource": "workbook",
                                    "templateIdSource": "static",
                                    "templateId": "Community-Workbooks/SapMonitor2.0/AIOpsInsights/Availability Insights",
                                    "typeSource": "workbook",
                                    "gallerySource": "workbook",
                                    "locationSource": "workbook",
                                    "workbookName": "Availability insights for {selSID}",
                                    "passSpecificParams": true,
                                    "templateParameters": [
                                      {
                                        "name": "Database",
                                        "source": "column",
                                        "value": "description_s"
                                      },
                                      {
                                        "name": "VMID",
                                        "source": "column",
                                        "value": "VM_ARM_ID_s"
                                      },
                                      {
                                        "name": "SID",
                                        "source": "parameter",
                                        "value": "selSID"
                                      },
                                      {
                                        "name": "Provider",
                                        "source": "parameter",
                                        "value": "providerInstance"
                                      },
                                      {
                                        "name": "TimePeriod",
                                        "source": "parameter",
                                        "value": "displayRange"
                                      },
                                      {
                                        "name": "SAPComponent",
                                        "source": "column",
                                        "value": "SAPComponent"
                                      },
                                      {
                                        "name": "TimeRange",
                                        "source": "parameter",
                                        "value": "timePeriod"
                                      },
                                      {
                                        "name": "AlertName",
                                        "source": "parameter",
                                        "value": "param_AlertName"
                                      },
                                      {
                                        "name": "AlertFired",
                                        "source": "parameter",
                                        "value": "param_firedTime"
                                      }
                                    ]
                                  }
                                }
                              },
                              {
                                "columnMatch": "SAPComponent",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "display_s",
                                "formatter": 1
                              },
                              {
                                "columnMatch": "hostname_s",
                                "formatter": 5
                              }
                            ],
                            "hierarchySettings": {
                              "idColumn": "id",
                              "parentColumn": "parentid",
                              "treeType": 0,
                              "expanderColumn": "display_s",
                              "expandTopLevel": false
                            },
                            "labelSettings": [
                              {
                                "columnId": "VM_ARM_ID_s",
                                "label": "VM Name"
                              },
                              {
                                "columnId": "SID_s",
                                "label": "SID"
                              },
                              {
                                "columnId": "Availability",
                                "label": "Availability"
                              },
                              {
                                "columnId": "AvailabilityTrend",
                                "label": "Availability Trend"
                              },
                              {
                                "columnId": "Insights",
                                "label": "Action"
                              },
                              {
                                "columnId": "SAPComponent",
                                "label": "Component"
                              },
                              {
                                "columnId": "display_s",
                                "label": "Database / Service"
                              }
                            ]
                          }
                        },
                        "customWidth": "0",
                        "conditionalVisibilities": [
                          {
                            "parameterName": "hanaExists",
                            "comparison": "isEqualTo",
                            "value": "true"
                          },
                          {
                            "parameterName": "providerType",
                            "comparison": "isEqualTo",
                            "value": "hana"
                          }
                        ],
                        "showPin": false,
                        "name": "hanaAvailability"
                      }
                    ]
                  },
                  "customWidth": "100",
                  "name": "insightsGrids"
                }
              ]
            },
            "customWidth": "0",
            "conditionalVisibilities": [
              {
                "parameterName": "selTab",
                "comparison": "isEqualTo",
                "value": "Availability"
              },
              {
                "parameterName": "selSID",
                "comparison": "isNotEqualTo"
              }
            ],
            "name": "availability"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "## Summary view for {selSID}\r\nKey metric trends for all types of issues."
                        },
                        "name": "performanceTitleDisplay"
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "items": [
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "let endTime=todatetime(\"{endTime}\");\r\nlet startTime=todatetime(\"{startTime}\");\r\nlet binSize=tolong(\"{minutesBin}\");\r\n\r\nSapNetweaver_SWNC_CL \r\n| where TimeGenerated between (startTime .. endTime) and SID_s==\"{selSID}\" and \"{providerInstance}\" contains PROVIDER_INSTANCE_s\r\n| summarize ResponseTime = avg(ST03_Avg_Resp_Time_d) by bin(TimeGenerated, iff(binSize<60, 1m, binSize*1m))\r\n| sort by ResponseTime desc",
                                "size": 0,
                                "aggregation": 3,
                                "title": "Response time (ms) for Issue type = High Response Time",
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces",
                                "crossComponentResources": [
                                  "{workspace}"
                                ],
                                "visualization": "timechart",
                                "chartSettings": {
                                  "ySettings": {
                                    "numberFormatSettings": {
                                      "unit": 23,
                                      "options": {
                                        "style": "decimal",
                                        "useGrouping": true,
                                        "maximumSignificantDigits": 1
                                      }
                                    }
                                  }
                                }
                              },
                              "name": "is01plot"
                            },
                            {
                              "type": 11,
                              "content": {
                                "version": "LinkItem/1.0",
                                "style": "nav",
                                "links": [
                                  {
                                    "id": "896c19c4-8fa2-4f28-8d3b-54ef8067127e",
                                    "linkTarget": "WorkbookTemplate",
                                    "linkLabel": "View insights",
                                    "style": "secondary",
                                    "linkIsContextBlade": true,
                                    "workbookContext": {
                                      "componentIdSource": "workbook",
                                      "resourceIdsSource": "workbook",
                                      "templateIdSource": "static",
                                      "templateId": "Community-Workbooks/SapMonitor2.0/AIOpsInsights/Performance Insights",
                                      "typeSource": "workbook",
                                      "gallerySource": "workbook",
                                      "locationSource": "workbook",
                                      "workbookName": "Performance insights for {selSID}",
                                      "passSpecificParams": true,
                                      "templateParameters": [
                                        {
                                          "name": "TimeRange",
                                          "source": "parameter",
                                          "value": "timePeriod"
                                        },
                                        {
                                          "name": "SID",
                                          "source": "parameter",
                                          "value": "selSID"
                                        },
                                        {
                                          "name": "Provider",
                                          "source": "parameter",
                                          "value": "providerInstance"
                                        },
                                        {
                                          "name": "AlertTemplate",
                                          "source": "static",
                                          "value": "sapnetweaver-response-time"
                                        }
                                      ]
                                    }
                                  }
                                ]
                              },
                              "name": "iso1navBtn"
                            }
                          ]
                        },
                        "customWidth": "50",
                        "name": "is01overview"
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "items": [
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "let endTime=todatetime(\"{endTime}\");\r\nlet startTime=todatetime(\"{startTime}\");\r\nlet binSize=tolong(\"{minutesBin}\");\r\n\r\nSapNetweaver_SWNC_CL \r\n| where TimeGenerated between (startTime .. endTime) and SID_s==\"{selSID}\" and \"{providerInstance}\" contains PROVIDER_INSTANCE_s\r\n| where Task_Type_Name_s==\"BCKGRD\"\r\n| summarize ResponseTime = avg(ST03_Avg_Resp_Time_d) by bin(TimeGenerated, iff(binSize<60, 1m, binSize*1m))\r\n| sort by ResponseTime desc",
                                "size": 0,
                                "aggregation": 3,
                                "title": "Response time (ms) for Issue type = Long Batch Jobs",
                                "queryType": 0,
                                "resourceType": "microsoft.operationalinsights/workspaces",
                                "crossComponentResources": [
                                  "{workspace}"
                                ],
                                "visualization": "timechart",
                                "chartSettings": {
                                  "ySettings": {
                                    "numberFormatSettings": {
                                      "unit": 23,
                                      "options": {
                                        "style": "decimal",
                                        "useGrouping": true,
                                        "maximumSignificantDigits": 1
                                      }
                                    }
                                  }
                                }
                              },
                              "name": "is02plot"
                            },
                            {
                              "type": 11,
                              "content": {
                                "version": "LinkItem/1.0",
                                "style": "nav",
                                "links": [
                                  {
                                    "id": "a0caa7a4-861a-4ebe-98cf-2f0c921a0a8a",
                                    "linkTarget": "WorkbookTemplate",
                                    "linkLabel": "View insights",
                                    "style": "secondary",
                                    "linkIsContextBlade": true,
                                    "workbookContext": {
                                      "componentIdSource": "workbook",
                                      "resourceIdsSource": "workbook",
                                      "templateIdSource": "static",
                                      "templateId": "Community-Workbooks/SapMonitor2.0/AIOpsInsights/Performance Insights",
                                      "typeSource": "workbook",
                                      "gallerySource": "workbook",
                                      "locationSource": "workbook",
                                      "workbookName": "Performance insights for {selSID}",
                                      "passSpecificParams": true,
                                      "templateParameters": [
                                        {
                                          "name": "TimeRange",
                                          "source": "parameter",
                                          "value": "timePeriod"
                                        },
                                        {
                                          "name": "SID",
                                          "source": "parameter",
                                          "value": "selSID"
                                        },
                                        {
                                          "name": "Provider",
                                          "source": "parameter",
                                          "value": "providerInstance"
                                        },
                                        {
                                          "name": "AlertTemplate",
                                          "source": "static",
                                          "value": "sapnetweaver-batch-job-jobname"
                                        }
                                      ]
                                    }
                                  }
                                ]
                              },
                              "name": "iso2navBtn"
                            }
                          ]
                        },
                        "customWidth": "50",
                        "name": "is02overview"
                      }
                    ]
                  },
                  "name": "noIssueType"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "selTab",
              "comparison": "isEqualTo",
              "value": "Performance"
            },
            "name": "performance"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "showData",
        "comparison": "isEqualTo",
        "value": "true"
      },
      "name": "parentGroup"
    }
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}