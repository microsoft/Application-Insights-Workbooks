{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "8a38505e-bc37-434f-aea7-98cb928cfca7",
                  "version": "KqlParameterItem/1.0",
                  "name": "param_provider_type",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "value": "Db2"
                },
                {
                  "id": "4c92fb1b-8038-44c2-8597-e80fd1e84a2a",
                  "version": "KqlParameterItem/1.0",
                  "name": "param_ams_resource",
                  "type": 5,
                  "isHiddenWhenLocked": true,
                  "typeSettings": {
                    "resourceTypeFilter": {
                      "microsoft.workloads/monitors": true,
                      "microsoft.hanaonazure/sapmonitors": true
                    },
                    "additionalResourceOptions": [
                      "value::1"
                    ],
                    "showDefault": false
                  },
                  "defaultValue": "value::1"
                },
                {
                  "id": "8389bd71-dbe5-45c4-8e89-4c262b1a1af7",
                  "version": "KqlParameterItem/1.0",
                  "name": "param_provider_instance",
                  "type": 1,
                  "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"{param_ams_resource}/providerInstances/\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2022-11-01-preview\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value[?(@.properties.provisioningState == 'Succeeded' && @.properties.providerSettings.providerType == '{param_provider_type}')].name\",\"columns\":[]}}]}",
                  "isHiddenWhenLocked": true,
                  "queryType": 12
                },
                {
                  "id": "0e60d97d-0281-4b5c-beb5-13d6515f38c5",
                  "version": "KqlParameterItem/1.0",
                  "name": "provider_table_exists",
                  "type": 1,
                  "query": "let hasNonEmptyTable = (T:string) \r\n{ \r\ntoscalar( union isfuzzy=true ( table(T) | count as Count ), (print Count=0) | summarize sum(Count) ) > 0\r\n};\r\nlet TableName = 'DB2_Applications_CL';\r\nprint present=iif(hasNonEmptyTable(TableName), \"1\", \"0\")",
                  "isHiddenWhenLocked": true,
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "220d856b-31a6-4caa-9dc4-60c1e7733d5f",
                  "version": "KqlParameterItem/1.0",
                  "name": "param_check_tables",
                  "type": 1,
                  "query": "let checktable = (tb:string, columnName:string)\r\n{\r\n// 0 = no error\r\n// 1 = table does not exist\r\n// 2 = table exists, but column v1 does not (or) column v1 exists but no data in the table (need to wait)\r\nlet dummy = \"unmÃ¶glicher-wert!\";\r\nlet MissingTable = view () { print miss = 1, columnV1 = dummy, records = -1 };\r\nlet checkRecords =\r\n  union\r\n    isfuzzy=true MissingTable,\r\n    (table(tb)\r\n      | summarize records = count()\r\n    )\r\n  | project records\r\n  | top 1 by records desc\r\n;\r\nlet checkTableExists =\r\n  union\r\n    isfuzzy=true MissingTable,\r\n    (table(tb)\r\n      | count\r\n      | extend miss = 0\r\n    )\r\n  | project miss\r\n  | limit 2\r\n  | top 1 by miss asc\r\n;\r\nlet checkColumnExists =\r\n  union\r\n    isfuzzy=true MissingTable,\r\n    (table(tb)\r\n      | extend miss = 0\r\n      | extend columnV1 = column_ifexists(columnName, dummy)\r\n    )\r\n  | project miss, columnV1\r\n  | limit 2\r\n  | top 1 by miss asc\r\n ;\r\nlet tableExists = toscalar(checkTableExists | summarize max(miss) != 1);\r\nlet columnV1Exists = toscalar(checkColumnExists | summarize max(columnV1) != dummy);\r\nlet tableRecords = toscalar(checkRecords | summarize max(records));\r\nlet x = iif(tableExists, iif(columnV1Exists, iif(tableRecords > 0, \"0\", \"2\"), \"2\"), \"1\");\r\ntoscalar(x)\r\n};\r\nlet locksAndBlocks = checktable(\"DB2_LocksAndBlocks_CL\", \"sapsid_s\");\r\n\r\nprint strcat('DB2_LocksAndBlocks_CL:',locksAndBlocks)",
                  "isHiddenWhenLocked": true,
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                }
              ],
              "style": "above",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "customWidth": "100",
            "name": "Parameters to check active provider"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "### No active IBM DB2 provider found.\r\nCreate one or more IBM DB2 providers to get started. [Learn More](https://learn.microsoft.com/en-us/azure/sap/monitor/provider-ibm-db2)",
                    "style": "warning"
                  },
                  "name": "Warning for no active provider"
                },
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "list",
                    "links": [
                      {
                        "id": "17108865-b53f-48c3-830e-58f5a6510e4a",
                        "cellValue": "{param_ams_resource}",
                        "linkTarget": "Resource",
                        "linkLabel": "Create Provider",
                        "subTarget": "monitor_provider",
                        "preText": "",
                        "style": "primary",
                        "bladeOpenContext": {
                          "bladeName": "ManageProviderv2.ReactView",
                          "extensionName": "Microsoft_Azure_WorkloadMonitor",
                          "bladeParameters": [
                            {
                              "name": "resourceId",
                              "source": "parameter",
                              "value": "param_ams_resource"
                            }
                          ]
                        }
                      }
                    ]
                  },
                  "name": "links - 1"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "param_provider_instance",
              "comparison": "isEqualTo"
            },
            "name": "No active provider grp"
          },
          {
            "type": 1,
            "content": {
              "json": "If the provider is recently added, it may take up to 15 minutes for the initial telemetry information to be available for review. Else, check if system is down, or health of AMS system is degraded.",
              "style": "warning"
            },
            "conditionalVisibilities": [
              {
                "parameterName": "param_provider_instance",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "provider_table_exists",
                "comparison": "isEqualTo",
                "value": "0"
              }
            ],
            "name": "No data exists warning"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "ed8e8eec-f9c8-461d-b76f-d796fd071ccc",
                        "version": "KqlParameterItem/1.0",
                        "name": "Days",
                        "label": "Timeframe",
                        "type": 4,
                        "isRequired": true,
                        "typeSettings": {
                          "selectableValues": [
                            {
                              "durationMs": 300000
                            },
                            {
                              "durationMs": 900000
                            },
                            {
                              "durationMs": 1800000
                            },
                            {
                              "durationMs": 3600000
                            },
                            {
                              "durationMs": 14400000
                            },
                            {
                              "durationMs": 43200000
                            },
                            {
                              "durationMs": 86400000
                            },
                            {
                              "durationMs": 172800000
                            },
                            {
                              "durationMs": 259200000
                            },
                            {
                              "durationMs": 604800000
                            },
                            {
                              "durationMs": 1209600000
                            },
                            {
                              "durationMs": 2419200000
                            },
                            {
                              "durationMs": 2592000000
                            },
                            {
                              "durationMs": 5184000000
                            },
                            {
                              "durationMs": 7776000000
                            }
                          ],
                          "allowCustom": false
                        },
                        "value": {
                          "durationMs": 1800000
                        }
                      },
                      {
                        "id": "2651447a-4547-4666-ba87-fd8f523df77f",
                        "version": "KqlParameterItem/1.0",
                        "name": "Provider",
                        "type": 2,
                        "isRequired": true,
                        "query": "DB2_Applications_CL\r\n| where TimeGenerated {Days}\r\n| project PROVIDER_INSTANCE_s\r\n| distinct PROVIDER_INSTANCE_s\r\n| serialize RANK = row_number()\r\n| project value = PROVIDER_INSTANCE_s, label = PROVIDER_INSTANCE_s, selected = iif(RANK == 1, true, false)\r\n| order by value\r\n\r\n",
                        "typeSettings": {
                          "additionalResourceOptions": [],
                          "showDefault": false
                        },
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "3a4a5b4a-5fb4-4a04-8045-58c4b218ce5c",
                        "version": "KqlParameterItem/1.0",
                        "name": "Hostname",
                        "type": 1,
                        "query": "let LastOne = DB2_SystemInfo_CL\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| summarize TimeGenerated = max(TimeGenerated)\r\n| project TimeGenerated;\r\n\r\nDB2_SystemInfo_CL\r\n| join kind=inner (LastOne) on TimeGenerated\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| project HOST_NAME_s\r\n| take 1\r\n",
                        "isHiddenWhenLocked": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "e29f6992-d736-4a70-9a73-95264e3d2f72",
                        "version": "KqlParameterItem/1.0",
                        "name": "OSRelease",
                        "type": 1,
                        "query": "let LastOne = DB2_SystemInfo_CL\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| summarize TimeGenerated = max(TimeGenerated)\r\n| project TimeGenerated;\r\n\r\nDB2_SystemInfo_CL\r\n| join kind=inner (LastOne) on TimeGenerated\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| project OS_FULL_VERSION_s\r\n| take 1\r\n",
                        "isHiddenWhenLocked": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "887c5210-0da7-4e94-92e7-27a5f39f4ec0",
                        "version": "KqlParameterItem/1.0",
                        "name": "DB2Instance",
                        "type": 1,
                        "query": "let LastOne = DB2_InstanceInfo_CL\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| summarize TimeGenerated = max(TimeGenerated)\r\n| project TimeGenerated;\r\n\r\nDB2_InstanceInfo_CL\r\n| join kind=inner (LastOne) on TimeGenerated\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| project INST_NAME_s\r\n| take 1\r\n",
                        "isHiddenWhenLocked": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "bd694b5e-8df6-4512-8838-58953bf4fb73",
                        "version": "KqlParameterItem/1.0",
                        "name": "DB2Version",
                        "type": 1,
                        "query": "let LastOne = DB2_InstanceInfo_CL\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| summarize TimeGenerated = max(TimeGenerated)\r\n| project TimeGenerated;\r\n\r\nDB2_InstanceInfo_CL\r\n| join kind=inner (LastOne) on TimeGenerated\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| project SERVICE_LEVEL_s\r\n| take 1\r\n",
                        "isHiddenWhenLocked": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "16cbe8de-c86c-4d14-ada1-a8e398662d60",
                        "version": "KqlParameterItem/1.0",
                        "name": "DB2FixPack",
                        "type": 1,
                        "query": "let LastOne = DB2_InstanceInfo_CL\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| summarize TimeGenerated = max(TimeGenerated)\r\n| project TimeGenerated;\r\n\r\nDB2_InstanceInfo_CL\r\n| join kind=inner (LastOne) on TimeGenerated\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| project tostring(coalesce(toint(FIXPACK_NUM_d),0))\r\n| take 1\r\n",
                        "isHiddenWhenLocked": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "0c03475a-2a1b-4f4c-a4a2-63fedd675e6f",
                        "version": "KqlParameterItem/1.0",
                        "name": "DB2License",
                        "type": 1,
                        "query": "let LastOne = DB2_InstanceInfo_CL\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| summarize TimeGenerated = max(TimeGenerated)\r\n| project TimeGenerated;\r\n\r\nDB2_InstanceInfo_CL\r\n| join kind=inner (LastOne) on TimeGenerated\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| project LICENSE_s\r\n| take 1\r\n",
                        "isHiddenWhenLocked": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "c84fb733-4800-4818-9cc3-56f6b836a143",
                        "version": "KqlParameterItem/1.0",
                        "name": "DB2LicenseType",
                        "type": 1,
                        "query": "let LastOne = DB2_InstanceInfo_CL\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| summarize TimeGenerated = max(TimeGenerated)\r\n| project TimeGenerated;\r\n\r\nDB2_InstanceInfo_CL\r\n| join kind=inner (LastOne) on TimeGenerated\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| project TYPE_s\r\n| take 1\r\n",
                        "isHiddenWhenLocked": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "34e0c89d-2a9c-477f-9958-14f6f8314f4a",
                        "version": "KqlParameterItem/1.0",
                        "name": "DB2SID",
                        "type": 1,
                        "query": "let LastOne = DB2_InstanceInfo_CL\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| summarize TimeGenerated = max(TimeGenerated)\r\n| project TimeGenerated;\r\n\r\nDB2_InstanceInfo_CL\r\n| join kind=inner (LastOne) on TimeGenerated\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| project SID_s\r\n| take 1\r\n",
                        "isHiddenWhenLocked": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "7d228d6b-c09a-4fbc-bc6a-b5ac9f8a957c",
                        "version": "KqlParameterItem/1.0",
                        "name": "param_alert_template",
                        "type": 1,
                        "value": "[\r\n\t{\r\n\t\t\"name\": \"DB2 Unknown connections\",\r\n\t\t\"description\": \"Fired when unknown connections to the database are identified.\",\r\n\t\t\"author\": \"Microsoft\",\r\n\t\t\"templateId\": \"db2-unknown-connections\",\r\n\t\t\"severity\": \"2\",\r\n\t\t\"alertTemplate\": {\r\n\t\t\t\"query\": \"DB2_Applications_CL | where PROVIDER_INSTANCE_s == '{ProviderInstance}' | where APPL_NAME_s !has ' R3trans ' and APPL_NAME_s !has ' tp ' and APPL_NAME_s !has '*LOCAL' and APPL_NAME_s !has '*N[0-9]' and APPL_NAME_s !has 'BODS' and APPL_NAME_s !has 'CONPOLSC' and APPL_NAME_s !has 'DB2DBD' and APPL_NAME_s !has 'DB2HANA' and APPL_NAME_s !has 'DSMCLTR' and APPL_NAME_s !has 'DS_ConnMgt' and APPL_NAME_s !has 'GDBP01' and APPL_NAME_s !has 'ODBC00' and APPL_NAME_s !has 'ODBC_MDM' and APPL_NAME_s !has 'ODBC_RO' and APPL_NAME_s !has 'ODBD' and APPL_NAME_s !has 'ODBP' and APPL_NAME_s !has 'ODBQ' and APPL_NAME_s !has 'python' and APPL_NAME_s !has 'R3load' and APPL_NAME_s !has 'R3szchk' and APPL_NAME_s !has 'R3ta' and APPL_NAME_s !has 'SAPSR3DB' and APPL_NAME_s !has 'SAPSR4DB' and APPL_NAME_s !has 'SAPuptool' and APPL_NAME_s !startswith 'SRC' and APPL_NAME_s !startswith 'UC_' and APPL_NAME_s !startswith 'db2' and APPL_NAME_s !has 'disp+work' \",\r\n\t\t\t\"thresholdOperator\": \"GreaterThan\",\r\n\t\t\t\"defaultThreshold\": \"5\",\r\n\t\t\t\"alertUnit\": \"connections\",\r\n\t\t\t\"metricMeasurement\": {\r\n\t\t\t\t\"thresholdOperator\": \"GreaterThan\",\r\n\t\t\t\t\"threshold\": \"3\",\r\n\t\t\t\t\"metricTriggerType\": \"Consecutive\",\r\n\t\t\t\t\"metricColumn\": \"APPL_NAME_s\",\r\n\t\t\t\t\"frequencyInMinutes\": \"10\",\r\n\t\t\t\t\"timeWindowInMinutes\": \"45\"\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\t\"name\": \"DB2 Stale Table Statistics\",\r\n\t\t\"description\": \"Fired when stale tables statistics were found.\",\r\n\t\t\"author\": \"Microsoft\",\r\n\t\t\"templateId\": \"db2-stale-stats\",\r\n\t\t\"severity\": \"2\",\r\n\t\t\"alertTemplate\": {\r\n\t\t\t\"query\": \"DB2_Stale_Table_Stats_CL | where PROVIDER_INSTANCE_s == '{ProviderInstance}' | project TABSCHEMA_s, TABNAME_s | summarize count() by TABSCHEMA_s, TABNAME_s\",\r\n\t\t\t\"thresholdOperator\": \"LessThan\",\r\n\t\t\t\"defaultThreshold\": \"50\",\r\n\t\t\t\"alertUnit\": \"statistics\",\r\n\t\t\t\"metricMeasurement\": {\r\n\t\t\t\t\"thresholdOperator\": \"GreaterThan\",\r\n\t\t\t\t\"threshold\": \"3\",\r\n\t\t\t\t\"metricTriggerType\": \"Consecutive\",\r\n\t\t\t\t\"metricColumn\": \"TABNAME_s\",\r\n\t\t\t\t\"frequencyInMinutes\": \"10\",\r\n\t\t\t\t\"timeWindowInMinutes\": \"45\"\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\t\"name\": \"DB2 Last Backup\",\r\n\t\t\"description\": \"Fired when the last successful backup is older than 2 days.\",\r\n\t\t\"author\": \"Microsoft\",\r\n\t\t\"templateId\": \"db2-last-backup\",\r\n\t\t\"severity\": \"1\",\r\n\t\t\"alertTemplate\": {\r\n\t\t\t\"query\": \"DB2_Last_Backup_CL | where PROVIDER_INSTANCE_s == '{ProviderInstance}' | project TIMESINCELASTBACKUP_d\",\r\n\t\t\t\"thresholdOperator\": \"GreaterThan\",\r\n\t\t\t\"defaultThreshold\": \"1\",\r\n\t\t\t\"alertUnit\": \"days\",\r\n\t\t\t\"metricMeasurement\": {\r\n\t\t\t\t\"thresholdOperator\": \"GreaterThan\",\r\n\t\t\t\t\"threshold\": \"1\",\r\n\t\t\t\t\"metricTriggerType\": \"Consecutive\",\r\n\t\t\t\t\"metricColumn\": \"TIMESINCELASTBACKUP_d\",\r\n\t\t\t\t\"frequencyInMinutes\": \"10\",\r\n\t\t\t\t\"timeWindowInMinutes\": \"45\"\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\t\"name\": \"DB2 Log Generation Rate\",\r\n\t\t\"description\": \"Fired when the Log Generation exceeds then threshold.\",\r\n\t\t\"author\": \"Microsoft\",\r\n\t\t\"templateId\": \"db2-log-gen-rate\",\r\n\t\t\"severity\": \"1\",\r\n\t\t\"alertTemplate\": {\r\n\t\t\t\"query\": \"DB2_Log_Generation_Rate_CL | where PROVIDER_INSTANCE_s == '{ProviderInstance}' | project START_TIME_s, LOGSARCHIVED_d, DEVICE_s, TYPE_s\",\r\n\t\t\t\"thresholdOperator\": \"GreaterThan\",\r\n\t\t\t\"defaultThreshold\": \"500\",\r\n\t\t\t\"alertUnit\": \"logs\",\r\n\t\t\t\"metricMeasurement\": {\r\n\t\t\t\t\"thresholdOperator\": \"GreaterThan\",\r\n\t\t\t\t\"threshold\": \"500\",\r\n\t\t\t\t\"metricTriggerType\": \"Consecutive\",\r\n\t\t\t\t\"metricColumn\": \"START_TIME_s\",\r\n\t\t\t\t\"frequencyInMinutes\": \"10\",\r\n\t\t\t\t\"timeWindowInMinutes\": \"45\"\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\t\"name\": \"DB2 Tables per Tablespace\",\r\n\t\t\"description\": \"Fired when the amount of tables in a tables space exceeds the threshold.\",\r\n\t\t\"author\": \"Microsoft\",\r\n\t\t\"templateId\": \"db2-tbl-per-tsp\",\r\n\t\t\"severity\": \"2\",\r\n\t\t\"alertTemplate\": {\r\n\t\t\t\"query\": \"DB2_Check_Tables_Per_Tablespace_CL | where PROVIDER_INSTANCE_s == '{ProviderInstance}' | project  TBSPACE_s, COUNT_d\",\r\n\t\t\t\"thresholdOperator\": \"GreaterThan\",\r\n\t\t\t\"defaultThreshold\": \"5000\",\r\n\t\t\t\"alertUnit\": \"tables\",\r\n\t\t\t\"metricMeasurement\": {\r\n\t\t\t\t\"thresholdOperator\": \"GreaterThan\",\r\n\t\t\t\t\"threshold\": \"1000\",\r\n\t\t\t\t\"metricTriggerType\": \"Consecutive\",\r\n\t\t\t\t\"metricColumn\": \"TBSPACE_s\",\r\n\t\t\t\t\"frequencyInMinutes\": \"60\",\r\n\t\t\t\t\"timeWindowInMinutes\": \"360\"\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\t\"name\": \"DB2 Outstanding logs\",\r\n\t\t\"description\": \"Fired when outstanding logs were identified.\",\r\n\t\t\"author\": \"Microsoft\",\r\n\t\t\"templateId\": \"db2-outstanding-logs\",\r\n\t\t\"severity\": \"2\",\r\n\t\t\"alertTemplate\": {\r\n\t\t\t\"query\": \"DB2_Outstanding_Archive_logs_CL | where PROVIDER_INSTANCE_s == '{ProviderInstance}' | project LOG_DELTA= CURR_ACT_LOG_d - CURR_ARCH_LOG_d | where LOG_DELTA > 0\",\r\n\t\t\t\"thresholdOperator\": \"GreaterThan\",\r\n\t\t\t\"defaultThreshold\": \"50\",\r\n\t\t\t\"alertUnit\": \"Logs\",\r\n\t\t\t\"metricMeasurement\": {\r\n\t\t\t\t\"thresholdOperator\": \"GreaterThan\",\r\n\t\t\t\t\"threshold\": \"50\",\r\n\t\t\t\t\"metricTriggerType\": \"Consecutive\",\r\n\t\t\t\t\"metricColumn\": \"LOG_DELTA\",\r\n\t\t\t\t\"frequencyInMinutes\": \"5\",\r\n\t\t\t\t\"timeWindowInMinutes\": \"60\"\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\t\"name\": \"DB2 Rollbacks\",\r\n\t\t\"description\": \"Fired when Rollbacks occur that need more than 10MB of log to rollback.\",\r\n\t\t\"author\": \"Microsoft\",\r\n\t\t\"templateId\": \"db2-rollbacks\",\r\n\t\t\"severity\": \"1\",\r\n\t\t\"alertTemplate\": {\r\n\t\t\t\"query\": \"DB2_Rollbacks_CL | where PROVIDER_INSTANCE_s == '{ProviderInstance}' | summarize count()\",\r\n\t\t\t\"thresholdOperator\": \"GreaterThan\",\r\n\t\t\t\"defaultThreshold\": \"5\",\r\n\t\t\t\"alertUnit\": \"minutes\",\r\n\t\t\t\"metricMeasurement\": {\r\n\t\t\t\t\"thresholdOperator\": \"GreaterThan\",\r\n\t\t\t\t\"threshold\": \"5\",\r\n\t\t\t\t\"metricTriggerType\": \"Consecutive\",\r\n\t\t\t\t\"metricColumn\": \"PROVIDER_INSTANCE_s\",\r\n\t\t\t\t\"frequencyInMinutes\": \"5\",\r\n\t\t\t\t\"timeWindowInMinutes\": \"60\"\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\t\"name\": \"DB2 Uncompressed Tables\",\r\n\t\t\"description\": \"Fired when uncompressed tables were identified.\",\r\n\t\t\"author\": \"Microsoft\",\r\n\t\t\"templateId\": \"db2-uncompr-tables\",\r\n\t\t\"severity\": \"3\",\r\n\t\t\"alertTemplate\": {\r\n\t\t\t\"query\": \"DB2_Uncompressed_Tables_CL | where PROVIDER_INSTANCE_s == '{ProviderInstance}' | SumOfUncompressedTables = summarize count()\",\r\n\t\t\t\"thresholdOperator\": \"GreaterThan\",\r\n\t\t\t\"defaultThreshold\": \"1\",\r\n\t\t\t\"alertUnit\": \"Tables\",\r\n\t\t\t\"metricMeasurement\": {\r\n\t\t\t\t\"thresholdOperator\": \"GreaterThan\",\r\n\t\t\t\t\"threshold\": \"1\",\r\n\t\t\t\t\"metricTriggerType\": \"Consecutive\",\r\n\t\t\t\t\"metricColumn\": \"SumOfUncompressedTables\",\r\n\t\t\t\t\"frequencyInMinutes\": \"5\",\r\n\t\t\t\t\"timeWindowInMinutes\": \"60\"\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\t\"name\": \"DB2 Tablespaces Autoresize\",\r\n\t\t\"description\": \"Fired when a table space without the option AutoResize was identified.\",\r\n\t\t\"author\": \"Microsoft\",\r\n\t\t\"templateId\": \"db2-tbsp-autoresize\",\r\n\t\t\"severity\": \"2\",\r\n\t\t\"alertTemplate\": {\r\n\t\t\t\"query\": \"DB2_TableSpace_Autoresize_CL | where PROVIDER_INSTANCE_s == '{ProviderInstance}' | project AUTORESIZE_s | where AUTORESIZE_s == \\\"NO\\\" | SumOfAutoResize = summarize count()\",\r\n\t\t\t\"thresholdOperator\": \"GreaterThan\",\r\n\t\t\t\"defaultThreshold\": \"5\",\r\n\t\t\t\"alertUnit\": \"Tables\",\r\n\t\t\t\"metricMeasurement\": {\r\n\t\t\t\t\"thresholdOperator\": \"GreaterThan\",\r\n\t\t\t\t\"threshold\": \"5\",\r\n\t\t\t\t\"metricTriggerType\": \"Consecutive\",\r\n\t\t\t\t\"metricColumn\": \"SumOfAutoResize\",\r\n\t\t\t\t\"frequencyInMinutes\": \"5\",\r\n\t\t\t\t\"timeWindowInMinutes\": \"60\"\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\t\"name\": \"DB2 Log Usage\",\r\n\t\t\"description\": \"Fired when a transaction usage to much of transaction log space.\",\r\n\t\t\"author\": \"Microsoft\",\r\n\t\t\"templateId\": \"db2-log-usage\",\r\n\t\t\"severity\": \"2\",\r\n\t\t\"alertTemplate\": {\r\n\t\t\t\"query\": \"DB2_Trans_Log_Usage_CL | where PROVIDER_INSTANCE_s == '{ProviderInstance}' | project LOG_UTILIZATION_PERCENT_s\",\r\n\t\t\t\"thresholdOperator\": \"GreaterThan\",\r\n\t\t\t\"defaultThreshold\": \"20\",\r\n\t\t\t\"alertUnit\": \"Log usage\",\r\n\t\t\t\"metricMeasurement\": {\r\n\t\t\t\t\"thresholdOperator\": \"GreaterThan\",\r\n\t\t\t\t\"threshold\": \"20\",\r\n\t\t\t\t\"metricTriggerType\": \"Consecutive\",\r\n\t\t\t\t\"metricColumn\": \"SumOfAutoResize\",\r\n\t\t\t\t\"frequencyInMinutes\": \"5\",\r\n\t\t\t\t\"timeWindowInMinutes\": \"60\"\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\t\"name\": \"DB2 CPU Usage\",\r\n\t\t\"description\": \"Fired when CPU usage exceed the treshold.\",\r\n\t\t\"author\": \"Microsoft\",\r\n\t\t\"templateId\": \"db2-cpu-usage\",\r\n\t\t\"severity\": \"2\",\r\n\t\t\"alertTemplate\": {\r\n\t\t\t\"query\": \"DB2_Applications_CL | where PROVIDER_INSTANCE_s == '{ProviderInstance}' | summarize UserCPU=sum(AGENT_USR_CPU_TIME_S_d), SystemCPU=sum(AGENT_SYS_CPU_TIME_S_d) by TimeGenerated | order by TimeGenerated | project TimeGenerated, CPU= iif(UserCPU + SystemCPU >= 0,UserCPU + SystemCPU,0.00)\",\r\n\t\t\t\"thresholdOperator\": \"GreaterThan\",\r\n\t\t\t\"defaultThreshold\": \"20\",\r\n\t\t\t\"alertUnit\": \"percent\",\r\n\t\t\t\"metricMeasurement\": {\r\n\t\t\t\t\"thresholdOperator\": \"GreaterThan\",\r\n\t\t\t\t\"threshold\": \"20\",\r\n\t\t\t\t\"metricTriggerType\": \"Consecutive\",\r\n\t\t\t\t\"metricColumn\": \"SumOfAutoResize\",\r\n\t\t\t\t\"frequencyInMinutes\": \"5\",\r\n\t\t\t\t\"timeWindowInMinutes\": \"60\"\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\t\"name\": \"DB2 Availability\",\r\n\t\t\"description\": \"Fired when the DB2 hasn't returned an SQL respond for the last 5 mins.\",\r\n\t\t\"author\": \"Microsoft\",\r\n\t\t\"templateId\": \"db2-availability\",\r\n\t\t\"severity\": \"1\",\r\n\t\t\"alertTemplate\": {\r\n\t\t\t\"query\": \"let StartTime=now(); DB2_Availability_CL | where PROVIDER_INSTANCE_s == '{ProviderInstance}' | top 1 by TimeGenerated desc | extend AggregateValue = iff(StartTime - TimeGenerated > 2min, 1, 0) | summarize AggregatedValue = max(AggregateValue) by bin(TimeGenerated, 5m)\",\r\n\t\t\t\"thresholdOperator\": \"GreaterThan\",\r\n\t\t\t\"defaultThreshold\": \"0\",\r\n\t\t\t\"metricMeasurement\": {\r\n\t\t\t\t\"thresholdOperator\": \"GreaterThan\",\r\n\t\t\t\t\"threshold\": \"0\",\r\n\t\t\t\t\"metricTriggerType\": \"Consecutive\",\r\n\t\t\t\t\"frequencyInMinutes\": \"5\",\r\n\t\t\t\t\"timeWindowInMinutes\": \"15\"\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\t\"name\": \"DB2 Data Disk filesystem utilization\",\r\n\t\t\"description\": \"Fired when the DB2 data disk filesystem exceeds the percentage threshold.\",\r\n\t\t\"author\": \"Microsoft\",\r\n\t\t\"templateId\": \"db2-disk-utilization\",\r\n\t\t\"severity\": \"1\",\r\n\t\t\"alertTemplate\": {\r\n\t\t\t\"query\": \"DB2_DiskUtilization_CL | order by TimeGenerated desc | where PROVIDER_INSTANCE_s == '{ProviderInstance}' and CONTAINER_NAME_s contains 'sapdata' | summarize AggregatedValue = percentile((FS_USED_SIZE_MB_d/FS_TOTAL_SIZE_MB_d*100),95) by bin(TimeGenerated, 5m)\",\r\n\t\t\t\"thresholdOperator\": \"GreaterThan\",\r\n\t\t\t\"defaultThreshold\": \"80\",\r\n\t\t\t\"alertUnit\": \"percent\",\r\n\t\t\t\"metricMeasurement\": {\r\n\t\t\t\t\"thresholdOperator\": \"Equal\",\r\n\t\t\t\t\"threshold\": \"1\",\r\n\t\t\t\t\"metricTriggerType\": \"Consecutive\",\r\n\t\t\t\t\"frequencyInMinutes\": \"15\",\r\n\t\t\t\t\"timeWindowInMinutes\": \"45\"\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\t\"name\": \"DB2 Temp Disk filesystem utilization\",\r\n\t\t\"description\": \"Fired when the DB2 temp disk filesystem exceeds the percentage threshold.\",\r\n\t\t\"author\": \"Microsoft\",\r\n\t\t\"templateId\": \"db2-tmpdisk-utilization\",\r\n\t\t\"severity\": \"3\",\r\n\t\t\"alertTemplate\": {\r\n\t\t\t\"query\": \"DB2_DiskUtilization_CL | order by TimeGenerated desc | where PROVIDER_INSTANCE_s == '{ProviderInstance}' and CONTAINER_NAME_s contains 'saptmp' | summarize AggregatedValue = percentile((FS_USED_SIZE_MB_d/FS_TOTAL_SIZE_MB_d*100),95) by bin(TimeGenerated, 5m)\",\r\n\t\t\t\"thresholdOperator\": \"GreaterThan\",\r\n\t\t\t\"defaultThreshold\": \"80\",\r\n\t\t\t\"alertUnit\": \"percent\",\r\n\t\t\t\"metricMeasurement\": {\r\n\t\t\t\t\"thresholdOperator\": \"Equal\",\r\n\t\t\t\t\"threshold\": \"1\",\r\n\t\t\t\t\"metricTriggerType\": \"Consecutive\",\r\n\t\t\t\t\"frequencyInMinutes\": \"15\",\r\n\t\t\t\t\"timeWindowInMinutes\": \"45\"\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\t\"name\": \"DB2 memory utilization\",\r\n\t\t\"description\": \"Fired when the memory utilization exceeds the percentage threshold.\",\r\n\t\t\"author\": \"Microsoft\",\r\n\t\t\"templateId\": \"db2-memory-utilization\",\r\n\t\t\"severity\": \"2\",\r\n\t\t\"alertTemplate\": {\r\n\t\t\t\"query\": \"DB2_MemoryUtilization_CL | where PROVIDER_INSTANCE_s == '{ProviderInstance}' | extend memoryPercent=TOTAL_USED_MEMORY_MB_d/TOTAL_MEMORY_MB_d*100 | summarize AggregatedValue = percentile(memoryPercent,95) by bin(TimeGenerated, 5m)\",\r\n\t\t\t\"thresholdOperator\": \"GreaterThan\",\r\n\t\t\t\"defaultThreshold\": \"90\",\r\n\t\t\t\"alertUnit\": \"percent\",\r\n\t\t\t\"metricMeasurement\": {\r\n\t\t\t\t\"thresholdOperator\": \"GreaterThan\",\r\n\t\t\t\t\"threshold\": \"1\",\r\n\t\t\t\t\"metricTriggerType\": \"Consecutive\",\r\n\t\t\t\t\"frequencyInMinutes\": \"10\",\r\n\t\t\t\t\"timeWindowInMinutes\": \"45\"\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\t\"name\": \"DB2 log shipping trailing\",\r\n\t\t\"description\": \"Fired when the log shipping exceeds the delay in seconds.\",\r\n\t\t\"author\": \"Microsoft\",\r\n\t\t\"templateId\": \"db2-ha-dr-logship\",\r\n\t\t\"severity\": \"2\",\r\n\t\t\"alertTemplate\": {\r\n\t\t\t\"query\": \"DB2_HADR_CL | where PROVIDER_INSTANCE_s == '{ProviderInstance}' and HADR_SYNCMODE_s in('NEARSYNC','SYNC') | extend AggregateValue = LOG_HADR_WAIT_CUR_d | summarize AggregatedValue = max(AggregateValue) by bin(TimeGenerated, 5m)\",\r\n\t\t\t\"thresholdOperator\": \"GreaterThan\",\r\n\t\t\t\"defaultThreshold\": \"10\",\r\n\t\t\t\"alertUnit\": \"seconds\",\r\n\t\t\t\"metricMeasurement\": {\r\n\t\t\t\t\"thresholdOperator\": \"GreaterThan\",\r\n\t\t\t\t\"threshold\": \"0\",\r\n\t\t\t\t\"metricTriggerType\": \"Consecutive\",\r\n\t\t\t\t\"frequencyInMinutes\": \"5\",\r\n\t\t\t\t\"timeWindowInMinutes\": \"30\"\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\t\"name\": \"DB2 replication target is not in connected status\",\r\n\t\t\"description\": \"Fired when any of the sync target is not in connected status.\",\r\n\t\t\"author\": \"Microsoft\",\r\n\t\t\"templateId\": \"db2-ha-dr-disconnect\",\r\n\t\t\"severity\": \"2\",\r\n\t\t\"alertTemplate\": {\r\n\t\t\t\"query\": \"DB2_HADR_CL | where PROVIDER_INSTANCE_s == '{ProviderInstance}' | extend AggregateValue = iff(HADR_CONNECT_STATUS_s != 'CONNECTED', 1, 0) | summarize AggregatedValue = max(AggregateValue) by bin(TimeGenerated, 5m)\",\r\n\t\t\t\"thresholdOperator\": \"GreaterThan\",\r\n\t\t\t\"defaultThreshold\": \"0\",\r\n\t\t\t\"metricMeasurement\": {\r\n\t\t\t\t\"thresholdOperator\": \"GreaterThan\",\r\n\t\t\t\t\"threshold\": \"0\",\r\n\t\t\t\t\"metricTriggerType\": \"Consecutive\",\r\n\t\t\t\t\"frequencyInMinutes\": \"5\",\r\n\t\t\t\t\"timeWindowInMinutes\": \"30\"\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n]",
                        "isHiddenWhenLocked": true,
                        "typeSettings": {
                          "multiLineText": true,
                          "editorLanguage": "text",
                          "multiLineHeight": 30
                        }
                      },
                      {
                        "id": "e1bd8dcd-6050-4383-9d5d-69573769f019",
                        "version": "KqlParameterItem/1.0",
                        "name": "param_locks_and_blocks_table_exists",
                        "type": 1,
                        "isHiddenWhenLocked": true,
                        "criteriaData": [
                          {
                            "criteriaContext": {
                              "leftOperand": "param_check_tables",
                              "operator": "contains",
                              "rightValType": "static",
                              "rightVal": "DB2_LocksAndBlocks_CL:0",
                              "resultValType": "static",
                              "resultVal": "0"
                            }
                          },
                          {
                            "criteriaContext": {
                              "leftOperand": "param_check_tables",
                              "operator": "contains",
                              "rightValType": "static",
                              "rightVal": "DB2_LocksAndBlocks_CL:1",
                              "resultValType": "static",
                              "resultVal": "1"
                            }
                          },
                          {
                            "criteriaContext": {
                              "operator": "Default",
                              "resultValType": "static",
                              "resultVal": "2"
                            }
                          }
                        ]
                      }
                    ],
                    "style": "above",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "customWidth": "25",
                  "name": "ProviderInstances"
                },
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "list",
                    "links": [
                      {
                        "id": "81b770f0-c654-4684-9894-482dc74a192e",
                        "linkTarget": "WorkbookTemplate",
                        "linkLabel": "Alerts",
                        "style": "primary",
                        "workbookContext": {
                          "componentIdSource": "workbook",
                          "resourceIdsSource": "workbook",
                          "templateIdSource": "static",
                          "templateId": "Community-Workbooks/SapMonitor2.0/Alerts/Alerts",
                          "typeSource": "workbook",
                          "gallerySource": "workbook",
                          "locationSource": "default",
                          "passSpecificParams": true,
                          "templateParameters": [
                            {
                              "name": "AlertTemplates",
                              "source": "parameter",
                              "value": "param_alert_template"
                            },
                            {
                              "name": "ProviderType",
                              "source": "parameter",
                              "value": "param_provider_type"
                            }
                          ]
                        }
                      }
                    ]
                  },
                  "customWidth": "25",
                  "name": "links - 16"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "## Azure Monitor for SAP solutions on IBM Db2\n---\n\n<b style=\"color:DodgerBlue;\">OS Hostname:</b> {Hostname} on {OSRelease}</br>\n<b style=\"color:DodgerBlue;\">Db2 Instance:</b> {DB2Instance} Version {DB2Version}  (FP: {DB2FixPack}) {DB2License} ({DB2LicenseType})  </br>\n<b style=\"color:DodgerBlue;\">SAP Instance:</b> {DB2SID}"
                  },
                  "customWidth": "50",
                  "name": "text - 2"
                },
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "tabs",
                    "links": [
                      {
                        "id": "565677a0-83de-4de4-a45c-a94be97172fb",
                        "cellValue": "selectedTab",
                        "linkTarget": "parameter",
                        "linkLabel": "Summary",
                        "subTarget": "1",
                        "preText": "Summary",
                        "style": "primary"
                      },
                      {
                        "id": "469af889-e9b1-4a94-baa3-395271181de1",
                        "cellValue": "selectedTab",
                        "linkTarget": "parameter",
                        "linkLabel": "Database Usage",
                        "subTarget": "2",
                        "preText": "Database Usage",
                        "style": "primary"
                      },
                      {
                        "id": "a093cf8e-87df-4021-8755-2042c3159379",
                        "cellValue": "selectedTab",
                        "linkTarget": "parameter",
                        "linkLabel": "Statement",
                        "subTarget": "3",
                        "style": "link"
                      },
                      {
                        "id": "453df8dd-1460-44ea-8aa5-4e7f3ec43e36",
                        "cellValue": "selectedTab",
                        "linkTarget": "parameter",
                        "linkLabel": "Locking",
                        "subTarget": "4",
                        "style": "link"
                      },
                      {
                        "id": "e85c7bb4-ea85-495d-b78e-95480ab52927",
                        "cellValue": "selectedTab",
                        "linkTarget": "parameter",
                        "linkLabel": "Applications",
                        "subTarget": "5",
                        "style": "link"
                      },
                      {
                        "id": "dc3db6c2-eacb-4946-ba17-c1c2e099f069",
                        "cellValue": "selectedTab",
                        "linkTarget": "parameter",
                        "linkLabel": "Throughput",
                        "subTarget": "6",
                        "style": "link"
                      },
                      {
                        "id": "8e4004dd-5920-47f7-b373-620bd095f67e",
                        "cellValue": "selectedTab",
                        "linkTarget": "parameter",
                        "linkLabel": "IO",
                        "subTarget": "7",
                        "style": "link"
                      },
                      {
                        "id": "b4ec882b-b81d-4509-a774-d9a7b1d8102e",
                        "cellValue": "selectedTab",
                        "linkTarget": "parameter",
                        "linkLabel": "Storage",
                        "subTarget": "8",
                        "style": "link"
                      }
                    ]
                  },
                  "name": "Tabs"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "DB2_Applications_CL \r\n| project TimeGenerated, PROVIDER_INSTANCE_s\r\n| where TimeGenerated {Days}\r\n| where PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| summarize count() by bin(TimeGenerated, {Days:grain})",
                    "size": 0,
                    "title": "Number of Connections ({Days:label} - Grain: {Days:grain})",
                    "color": "green",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "linechart",
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "count_",
                          "label": "#Connections"
                        }
                      ]
                    }
                  },
                  "customWidth": "25",
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "2"
                  },
                  "name": "#Connections",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "DB2_Applications_CL \r\n| where TimeGenerated {Days}\r\n| where PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| summarize LogicalReads=sum(POOL_DATA_L_READS_d + POOL_INDEX_L_READS_d) by bin(TimeGenerated, {Days:grain})\r\n| order by TimeGenerated\r\n| project TimeGenerated, LogicalReads= iif(LogicalReads - next(LogicalReads) >= 0,LogicalReads - next(LogicalReads),0.00)",
                    "size": 0,
                    "title": "Logical Reads ({Days:label} - Grain: {Days:grain})",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "linechart"
                  },
                  "customWidth": "25",
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "2"
                  },
                  "name": "LogicalReads",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "DB2_Applications_CL \r\n| where TimeGenerated {Days}\r\n| where PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| summarize PhysicalReads=sum(POOL_DATA_P_READS_d + POOL_INDEX_P_READS_d) by bin(TimeGenerated, {Days:grain})\r\n| order by TimeGenerated\r\n| project TimeGenerated, PhysicalReads = iif(PhysicalReads - next(PhysicalReads) >= 0,PhysicalReads - next(PhysicalReads),0.00)",
                    "size": 0,
                    "title": "Physical Reads ({Days:label} - Grain: {Days:grain})",
                    "color": "orange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "linechart"
                  },
                  "customWidth": "25",
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "2"
                  },
                  "name": "PhysicalReads",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "DB2_Applications_CL \r\n| where TimeGenerated {Days}\r\n| where PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| summarize LockWaits=sum(LOCK_WAITS_d) by bin(TimeGenerated, {Days:grain})\r\n| order by TimeGenerated\r\n| project TimeGenerated, LockWaits= iif(LockWaits - next(LockWaits) >= 0,LockWaits - next(LockWaits),0.00)",
                    "size": 0,
                    "title": "Lock Waits ({Days:label} - Grain: {Days:grain})",
                    "color": "magenta",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "linechart"
                  },
                  "customWidth": "25",
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "2"
                  },
                  "name": "LockWaits",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "DB2_Applications_CL \r\n| where TimeGenerated {Days}\r\n| where PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| summarize Sorts=sum(TOTAL_SORTS_d) by bin(TimeGenerated, {Days:grain})\r\n| order by TimeGenerated\r\n| project TimeGenerated, Sorts= iif(Sorts - next(Sorts) >=0,Sorts - next(Sorts),0.00)",
                    "size": 0,
                    "title": "Total Sorts ({Days:label} - Grain: {Days:grain})",
                    "color": "purple",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "linechart"
                  },
                  "customWidth": "25",
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "2"
                  },
                  "name": "TotalSorts",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "DB2_Applications_CL \r\n| where TimeGenerated {Days}\r\n| where PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| summarize UserCPU=sum(AGENT_USR_CPU_TIME_S_d), SystemCPU=sum(AGENT_SYS_CPU_TIME_S_d) by bin(TimeGenerated, {Days:grain})\r\n| order by TimeGenerated\r\n| project TimeGenerated, UserCPU= iif(UserCPU - next(UserCPU) >= 0,UserCPU - next(UserCPU),0.00), SystemCPU= iif(SystemCPU - next(SystemCPU) >=0,SystemCPU - next(SystemCPU),0.00)\r\n\r\n\r\n",
                    "size": 0,
                    "title": "CPU Usage ({Days:label} - Grain: {Days:grain})",
                    "color": "grayBlue",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "linechart",
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "UserCPU",
                          "color": "green"
                        },
                        {
                          "seriesName": "SystemCPU",
                          "color": "red"
                        }
                      ]
                    }
                  },
                  "customWidth": "25",
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "2"
                  },
                  "name": "CPU Usage",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "DB2_Applications_CL \r\n| where TimeGenerated {Days}  and todatetime(UOW_START_TIME_s) {Days}\r\n| where PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| summarize Transactions=sum(INT_COMMITS_d + INT_ROLLBACKS_d) by bin(TimeGenerated, {Days:grain})\r\n| order by TimeGenerated\r\n| project TimeGenerated, TransactionsRate= iif(Transactions - next(Transactions) >= 0,Transactions - next(Transactions),0.00)\r\n\r\n\r\n",
                    "size": 0,
                    "title": "Transaction Rate ({Days:label} - Grain: {Days:grain})",
                    "color": "grayBlue",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "linechart",
                    "graphSettings": {
                      "type": 0
                    },
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "TransactionsRate",
                          "color": "green"
                        },
                        {
                          "seriesName": "AvgActivityTime",
                          "color": "magenta"
                        }
                      ]
                    }
                  },
                  "customWidth": "25",
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "2"
                  },
                  "name": "Transaction Rate",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "DB2_Applications_CL \r\n| where TimeGenerated {Days} and todatetime(UOW_START_TIME_s) {Days}\r\n| where PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| summarize AvgActivityTime=avg(datetime_diff('millisecond',todatetime(UOW_STOP_TIME_s),todatetime(UOW_START_TIME_s))) by bin(TimeGenerated, {Days:grain})\r\n| order by TimeGenerated\r\n| project TimeGenerated, AvgActivityTime= iif(AvgActivityTime >= 0,AvgActivityTime,0.00)\r\n\r\n\r\n\r\n",
                    "size": 0,
                    "title": "Avg. Transaction Time ({Days:label} - Grain: {Days:grain})",
                    "color": "grayBlue",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "linechart",
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "UserCPU",
                          "color": "green"
                        },
                        {
                          "seriesName": "SystemCPU",
                          "color": "red"
                        }
                      ]
                    }
                  },
                  "customWidth": "25",
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "2"
                  },
                  "name": "AvgTransactionTime",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "DB2_Applications_CL\r\n| project PROVIDER_INSTANCE_s, APPL_NAME_s, TimeGenerated\r\n| where TimeGenerated {Days} and PROVIDER_INSTANCE_s == '{Provider}' and toupper(APPL_NAME_s) == 'DISP+WORK.EXE'\r\n| summarize count() by TimeGenerated\r\n| summarize z=countif(count_ == 0), nz=countif(count_ != 0)\r\n| project AvailPerc = iif(toreal(z / nz + 1) * 100 <= 100, toreal(z / nz + 1) * 100, 100.00) \r\n\r\n\r\n",
                    "size": 0,
                    "title": "Availability ({Days:label} - Grain: {Days:grain})",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "graph",
                    "tileSettings": {
                      "titleContent": {
                        "formatter": 1
                      },
                      "subtitleContent": {
                        "columnMatch": "AvailPerc",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "TGMin",
                        "formatter": 6
                      },
                      "rightContent": {
                        "columnMatch": "TGMax",
                        "formatter": 6
                      },
                      "showBorder": false
                    },
                    "graphSettings": {
                      "type": 2,
                      "topContent": {
                        "numberFormat": {
                          "unit": 1,
                          "options": {
                            "style": "decimal"
                          }
                        }
                      },
                      "centerContent": {
                        "columnMatch": "AvailPerc",
                        "numberFormat": {
                          "unit": 1,
                          "options": {
                            "style": "decimal"
                          }
                        }
                      },
                      "nodeIdField": "AvailPerc",
                      "graphOrientation": 3,
                      "showOrientationToggles": false,
                      "nodeSize": null,
                      "staticNodeSize": 100,
                      "colorSettings": {
                        "nodeColorField": "AvailPerc",
                        "type": 3,
                        "thresholdsGrid": [
                          {
                            "operator": "==",
                            "thresholdValue": "100",
                            "representation": "green"
                          },
                          {
                            "operator": ">=",
                            "thresholdValue": "90",
                            "representation": "yellow"
                          },
                          {
                            "operator": "<",
                            "thresholdValue": "90",
                            "representation": "redBright"
                          },
                          {
                            "operator": "Default",
                            "thresholdValue": null,
                            "representation": "blue"
                          }
                        ]
                      },
                      "hivesMargin": 5
                    }
                  },
                  "customWidth": "25",
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "1"
                  },
                  "name": "Availability",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "DB2_Applications_CL \r\n| where TimeGenerated {Days} //and todatetime(UOW_START_TIME_s) {Days}\r\n| where PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| summarize Selectx=sum(SELECT_SQL_STMTS_d), DDLx=sum(DDL_SQL_STMTS_d), DMLx=sum(UID_SQL_STMTS_d)  by bin(TimeGenerated, {Days:grain})\r\n| order by TimeGenerated\r\n| project TimeGenerated, Selects= iif(Selectx - next(Selectx) >= 0,Selectx - next(Selectx),0.00), DDL= iif(DDLx - next(DDLx) >= 0,DDLx - next(DDLx),0.00),DML= iif(DMLx - next(DMLx) >= 0,DMLx - next(DMLx),0.00)\r\n\r\n\r\n\r\n",
                    "size": 0,
                    "title": "Statements ({Days:label} - Grain: {Days:grain})",
                    "color": "grayBlue",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "linechart",
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Selects",
                          "color": "blue"
                        },
                        {
                          "seriesName": "DDL",
                          "color": "purple"
                        },
                        {
                          "seriesName": "DML",
                          "color": "turquoise"
                        }
                      ]
                    }
                  },
                  "customWidth": "25",
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "1"
                  },
                  "name": "Statements",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "DB2_Applications_CL \r\n| where TimeGenerated {Days} //and todatetime(UOW_START_TIME_s) {Days}\r\n| where PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| summarize SelectR=sum(ROWS_SELECTED_d), UpdatedR=sum(ROWS_UPDATED_d), InsertedR=sum(ROWS_INSERTED_d), DeletedR=sum(ROWS_DELETED_d)  by bin(TimeGenerated, {Days:grain})\r\n| order by TimeGenerated\r\n| project TimeGenerated, RowsSelected= iif(SelectR - next(SelectR) >= 0,SelectR - next(SelectR),0.00), RowsUpdated = iif(UpdatedR - next(UpdatedR) >= 0,UpdatedR - next(UpdatedR),0.00),RowsInserted= iif(InsertedR - next(InsertedR) >= 0,InsertedR - next(InsertedR),0.00),RowsDeleted= iif(DeletedR - next(DeletedR) >= 0,DeletedR - next(DeletedR),0.00)\r\n\r\n\r\n\r\n",
                    "size": 0,
                    "title": "Rows ({Days:label} - Grain: {Days:grain})",
                    "color": "grayBlue",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "linechart",
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Selects",
                          "color": "blue"
                        },
                        {
                          "seriesName": "DDL",
                          "color": "purple"
                        },
                        {
                          "seriesName": "DML",
                          "color": "turquoise"
                        }
                      ]
                    }
                  },
                  "customWidth": "25",
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "1"
                  },
                  "name": "Rows",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "DB2_Waits_CL \r\n| project TimeGenerated, PROVIDER_INSTANCE_s, WORKLOAD_NAME_s, WAITTYPE_s, AGENT_WAIT_TIME_d\r\n| where TimeGenerated {Days} \r\n| where PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| where WORKLOAD_NAME_s == \"SYSDEFAULTUSERWORKLOAD\" //and (WAITTYPE_s == \"tcpip_send_wait_time\"  or WAITTYPE_s == \"tcpip_recv_wait_time\")\r\n| summarize WaitTime=avg(AGENT_WAIT_TIME_d) by bin(TimeGenerated, {Days:grain}), WAITTYPE_s\r\n| order by WAITTYPE_s, TimeGenerated\r\n\r\n\r\n| project TimeGenerated, WAITTYPE_s, WaitTimeX = iif(WaitTime - next(WaitTime) >= 0 and WAITTYPE_s == next(WAITTYPE_s),WaitTime - next(WaitTime),0.00)\r\n//| where isempty(prev(WaitTime)) == false and WaitTime > 0\r\n\r\n",
                    "size": 0,
                    "title": "Waits (SYSDEFAULTUSERWORKLOAD) ({Days:label} - Grain: {Days:grain})",
                    "color": "grayBlue",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "areachart",
                    "graphSettings": {
                      "type": 0,
                      "topContent": {
                        "columnMatch": "WAITTYPE_s",
                        "formatter": 1
                      },
                      "centerContent": {
                        "columnMatch": "WaitTime",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    },
                    "chartSettings": {
                      "xAxis": "TimeGenerated",
                      "group": "WAITTYPE_s",
                      "createOtherGroup": 3
                    }
                  },
                  "customWidth": "25",
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "1"
                  },
                  "name": "Waits",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "DB2_Waits_CL \r\n| project TimeGenerated, PROVIDER_INSTANCE_s, WORKLOAD_NAME_s, WAITTYPE_s, AGENT_WAIT_TIME_d\r\n| where TimeGenerated {Days} \r\n| where PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| summarize WaitTime=avg(AGENT_WAIT_TIME_d) by bin(TimeGenerated, {Days:grain}), WAITTYPE_s\r\n| order by WAITTYPE_s, TimeGenerated\r\n| project TimeGenerated, WAITTYPE_s, WaitTimeX = iif(WaitTime - next(WaitTime) >= 0 and WAITTYPE_s == next(WAITTYPE_s),WaitTime - next(WaitTime),0.00)\r\n\r\n\r\n",
                    "size": 0,
                    "title": "Waits ({Days:label} - Grain: {Days:grain})",
                    "color": "grayBlue",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "barchart",
                    "graphSettings": {
                      "type": 0,
                      "topContent": {
                        "columnMatch": "WAITTYPE_s",
                        "formatter": 1
                      },
                      "centerContent": {
                        "columnMatch": "WaitTime",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    },
                    "chartSettings": {
                      "xAxis": "TimeGenerated",
                      "group": "WAITTYPE_s",
                      "createOtherGroup": null
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "4"
                  },
                  "name": "Waits p4",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let LastOne = DB2_Top20ProblemStmts_CL\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| summarize TimeGenerated = max(TimeGenerated)\r\n| project TimeGenerated;\r\n\r\nDB2_Top20ProblemStmts_CL\r\n| join kind=inner (LastOne) on TimeGenerated \r\n| where PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| project STATEMENT_s, ROWS_READ_d, PCT_TOT_RR = toreal(PCT_TOT_RR_s), TOTAL_CPU_TIME_d, PCT_TOT_CPU = toreal(PCT_TOT_CPU_s), STMT_EXEC_TIME_d, PCT_TOT_EXEC = toreal(PCT_TOT_EXEC_s), TOTAL_SECTION_SORT_TIME_d, PCT_TOT_SRT = toreal(PCT_TOT_SRT_s), NUM_EXECUTIONS_d,AVG_EXEC_TIME = toreal(AVG_EXEC_TIME_s)\r\n| sort by PCT_TOT_CPU desc\r\n",
                    "size": 0,
                    "title": "Top 20 expensive statements (with more than 5% of total costs)",
                    "timeContext": {
                      "durationMs": 86400000
                    },
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "STATEMENT_s",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "65ch"
                          }
                        },
                        {
                          "columnMatch": "ROWS_READ_d",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        },
                        {
                          "columnMatch": "PCT_TOT_RR",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "TOTAL_CPU_TIME_d",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        },
                        {
                          "columnMatch": "PCT_TOT_CPU",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "STMT_EXEC_TIME_d",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        },
                        {
                          "columnMatch": "PCT_TOT_EXEC",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "TOTAL_SECTION_SORT_TIME_d",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        },
                        {
                          "columnMatch": "PCT_TOT_SRT",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "NUM_EXECUTIONS_d",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        },
                        {
                          "columnMatch": "PCT_TOT_RR_s",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "todecimal(PCT_TOT_RR_s)",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "todecimal(PCT_TOT_CPU_s)",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "todecimal(PCT_TOT_EXEC_s)",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "todecimal(PCT_TOT_SRT_s)",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "sortBy": [
                        {
                          "itemKey": "AVG_EXEC_TIME",
                          "sortOrder": 2
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "STATEMENT_s",
                          "label": "SQL Statement"
                        },
                        {
                          "columnId": "ROWS_READ_d",
                          "label": "Rows read"
                        },
                        {
                          "columnId": "PCT_TOT_RR",
                          "label": "Percent Reads"
                        },
                        {
                          "columnId": "TOTAL_CPU_TIME_d",
                          "label": "Total CPU Time"
                        },
                        {
                          "columnId": "PCT_TOT_CPU",
                          "label": "Percent CPU"
                        },
                        {
                          "columnId": "STMT_EXEC_TIME_d",
                          "label": "Statement Execution Time"
                        },
                        {
                          "columnId": "PCT_TOT_EXEC",
                          "label": "Percent Executions"
                        },
                        {
                          "columnId": "TOTAL_SECTION_SORT_TIME_d",
                          "label": "Total Sort Time"
                        },
                        {
                          "columnId": "PCT_TOT_SRT",
                          "label": "Percent Sorts"
                        },
                        {
                          "columnId": "NUM_EXECUTIONS_d",
                          "label": "Number of Execution"
                        },
                        {
                          "columnId": "AVG_EXEC_TIME",
                          "label": "Average Execution Time"
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "AVG_EXEC_TIME",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "6"
                  },
                  "name": "Top20Prob",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let LastOne = DB2_Top20ExecTime_CL  \r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| summarize TimeGenerated = max(TimeGenerated)\r\n| project TimeGenerated;\r\n\r\nDB2_Top20ExecTime_CL  \r\n| join kind=inner (LastOne) on TimeGenerated \r\n| project TIME_SECONDS_d, EXECUTIONS_d, TEXT_s\r\n| order by TIME_SECONDS_d desc, EXECUTIONS_d desc\r\n",
                    "size": 0,
                    "title": "Top 20 Runtime & Executions",
                    "timeContext": {
                      "durationMs": 86400000
                    },
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "TIME_SECONDS_d",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue",
                            "customColumnWidthSetting": "20ch"
                          }
                        },
                        {
                          "columnMatch": "EXECUTIONS_d",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue",
                            "customColumnWidthSetting": "20ch"
                          }
                        },
                        {
                          "columnMatch": "TEXT_s",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "170ch"
                          }
                        }
                      ],
                      "sortBy": [
                        {
                          "itemKey": "$gen_heatmap_TIME_SECONDS_d_0",
                          "sortOrder": 2
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "TIME_SECONDS_d",
                          "label": "Avg. runtime (s)"
                        },
                        {
                          "columnId": "EXECUTIONS_d",
                          "label": "Executions"
                        },
                        {
                          "columnId": "TEXT_s",
                          "label": "SQL Statement"
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_heatmap_TIME_SECONDS_d_0",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "3"
                  },
                  "name": "Apps-Top20",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let LastOne = DB2_InFlightStmts_CL \r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| summarize TimeGenerated = max(TimeGenerated)\r\n| project TimeGenerated;\r\n\r\nDB2_InFlightStmts_CL \r\n| join kind=inner (LastOne) on TimeGenerated \r\n| where PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| project TimeGenerated, SESSION_AUTH_ID_s, APPLICATION_HANDLE_d, APPLICATION_NAME_s, ELAPSED_TIME_SEC_d, TOTAL_CPU_TIME_d, ROWS_READ_d, STMT_s\r\n",
                    "size": 0,
                    "title": "In-Flight statements",
                    "timeContext": {
                      "durationMs": 86400000
                    },
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "labelSettings": [
                        {
                          "columnId": "TimeGenerated",
                          "label": "Time"
                        },
                        {
                          "columnId": "SESSION_AUTH_ID_s",
                          "label": "Authentication"
                        },
                        {
                          "columnId": "APPLICATION_HANDLE_d",
                          "label": "Handle"
                        },
                        {
                          "columnId": "APPLICATION_NAME_s",
                          "label": "Application"
                        },
                        {
                          "columnId": "ELAPSED_TIME_SEC_d",
                          "label": "Elapsed Time (s)"
                        },
                        {
                          "columnId": "TOTAL_CPU_TIME_d",
                          "label": "CPU Time"
                        },
                        {
                          "columnId": "ROWS_READ_d",
                          "label": "Rows read"
                        },
                        {
                          "columnId": "STMT_s",
                          "label": "SQL Statement"
                        }
                      ]
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "3"
                  },
                  "name": "query - 18",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let LastOne = DB2_Applications_CL\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| summarize TimeGenerated = max(TimeGenerated)\r\n| project TimeGenerated;\r\n\r\nDB2_Applications_CL\r\n| join kind=inner (LastOne) on TimeGenerated \r\n| where PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| project APPL_NAME_s, APPL_STATUS_s, CLIENT_PID_d, CLIENT_NNAME_s, AGENT_USR_CPU_TIME_S_d, TOTAL_SORTS_d, ROWS_READ_d, ROWS_WRITTEN_d, COMMIT_SQL_STMTS_d, UOW_STOP_TIME_s, APPL_CON_TIME_s\r\n",
                    "size": 3,
                    "title": "Applications",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "TOTAL_SORTS_d",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        },
                        {
                          "columnMatch": "ROWS_READ_d",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        },
                        {
                          "columnMatch": "ROWS_WRITTEN_d",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        },
                        {
                          "columnMatch": "COMMIT_SQL_STMTS_d",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        }
                      ],
                      "sortBy": [
                        {
                          "itemKey": "APPL_NAME_s",
                          "sortOrder": 1
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "APPL_NAME_s",
                          "label": "Application"
                        },
                        {
                          "columnId": "APPL_STATUS_s",
                          "label": "Status"
                        },
                        {
                          "columnId": "CLIENT_PID_d",
                          "label": "Client PID"
                        },
                        {
                          "columnId": "CLIENT_NNAME_s",
                          "label": "Hostname"
                        },
                        {
                          "columnId": "AGENT_USR_CPU_TIME_S_d",
                          "label": "CPU Time"
                        },
                        {
                          "columnId": "TOTAL_SORTS_d",
                          "label": "Total Sort"
                        },
                        {
                          "columnId": "ROWS_READ_d",
                          "label": "Rows read"
                        },
                        {
                          "columnId": "ROWS_WRITTEN_d",
                          "label": "Rows written"
                        },
                        {
                          "columnId": "COMMIT_SQL_STMTS_d",
                          "label": "SQL Commits"
                        },
                        {
                          "columnId": "UOW_STOP_TIME_s",
                          "label": "UOW Stop Time"
                        },
                        {
                          "columnId": "APPL_CON_TIME_s",
                          "label": "Connection Time"
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "APPL_NAME_s",
                        "sortOrder": 1
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "5"
                  },
                  "name": "Apps-Connections",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "DB2_Applications_CL \r\n| where TimeGenerated {Days} //and todatetime(UOW_START_TIME_s) {Days}\r\n| where PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| summarize FailedSQLx=avg(FAILED_SQL_STMTS_d)  by bin(TimeGenerated, {Days:grain})\r\n| order by TimeGenerated\r\n| project TimeGenerated, FailedSQL= iif(FailedSQLx - next(FailedSQLx) >= 0,FailedSQLx - next(FailedSQLx),0.00)\r\n\r\n\r\n\r\n",
                    "size": 0,
                    "title": "Failed SQL ({Days:label} - Grain: {Days:grain})",
                    "color": "grayBlue",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "linechart",
                    "chartSettings": {
                      "seriesLabelSettings": [
                        {
                          "seriesName": "Selects",
                          "color": "blue"
                        },
                        {
                          "seriesName": "DDL",
                          "color": "purple"
                        },
                        {
                          "seriesName": "DML",
                          "color": "turquoise"
                        }
                      ]
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "3"
                  },
                  "name": "Failed SQL",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let LastOne = DB2_Bufferpools_CL \r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| summarize TimeGenerated = max(TimeGenerated)\r\n| project TimeGenerated;\r\n\r\nDB2_Bufferpools_CL \r\n| join kind=inner (LastOne) on TimeGenerated \r\n| where PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| project BUFFERPOOLID_d, BPNAME_s, DBPARTGRP_s, NPAGES_s, PAGESIZE_d, NUMBLOCKPAGES_d, BLOCKSIZE_d, TimeGenerated\r\n| order by BUFFERPOOLID_d asc\r\n\r\n",
                    "size": 1,
                    "title": "Bufferpools",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "labelSettings": [
                        {
                          "columnId": "BUFFERPOOLID_d",
                          "label": "ID"
                        },
                        {
                          "columnId": "BPNAME_s",
                          "label": "Name"
                        },
                        {
                          "columnId": "DBPARTGRP_s",
                          "label": "Partition Group"
                        },
                        {
                          "columnId": "NPAGES_s",
                          "label": "Pages"
                        },
                        {
                          "columnId": "PAGESIZE_d",
                          "label": "Pagesize"
                        },
                        {
                          "columnId": "NUMBLOCKPAGES_d",
                          "label": "Blockpages"
                        },
                        {
                          "columnId": "BLOCKSIZE_d",
                          "label": "Blocksize"
                        },
                        {
                          "columnId": "TimeGenerated",
                          "label": "Time"
                        }
                      ]
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "7"
                  },
                  "name": "IO-Bufferpool",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": " let LastOne =  DB2_TableSpaces_CL \r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| summarize TimeGenerated = max(TimeGenerated)\r\n| project TimeGenerated;\r\n\r\n DB2_TableSpaces_CL \r\n| join kind=inner (LastOne) on TimeGenerated \r\n| where PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| project TBSP_ID_d, TBSP_NAME_s, TBSP_TYPE_s,TBSP_CONTENT_TYPE_s, TBSP_STATE_s,TBSP_TOTAL_SIZE_KB_d,TBSP_USABLE_SIZE_KB_d,TBSP_USED_SIZE_KB_d,TBSP_FREE_SIZE_KB_d,TBSP_AUTO_RESIZE_ENABLED_s,TBSP_INCREASE_SIZE_s, TimeGenerated\r\n| order by TBSP_ID_d asc\r\n\r\n",
                    "size": 0,
                    "title": "Tablespaces",
                    "timeContext": {
                      "durationMs": 86400000
                    },
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "TBSP_TOTAL_SIZE_KB_d",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        },
                        {
                          "columnMatch": "TBSP_USABLE_SIZE_KB_d",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        },
                        {
                          "columnMatch": "TBSP_USED_SIZE_KB_d",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        },
                        {
                          "columnMatch": "TBSP_FREE_SIZE_KB_d",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        },
                        {
                          "columnMatch": "TBSP_INCREASE_SIZE_s",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "TBSP_ID_d",
                          "label": "ID"
                        },
                        {
                          "columnId": "TBSP_NAME_s",
                          "label": "Name"
                        },
                        {
                          "columnId": "TBSP_TYPE_s",
                          "label": "Type"
                        },
                        {
                          "columnId": "TBSP_CONTENT_TYPE_s",
                          "label": "Content Type"
                        },
                        {
                          "columnId": "TBSP_STATE_s",
                          "label": "State"
                        },
                        {
                          "columnId": "TBSP_TOTAL_SIZE_KB_d",
                          "label": "Total size (kb)"
                        },
                        {
                          "columnId": "TBSP_USABLE_SIZE_KB_d",
                          "label": "Usable size (kb)"
                        },
                        {
                          "columnId": "TBSP_USED_SIZE_KB_d",
                          "label": "Used size (kb)"
                        },
                        {
                          "columnId": "TBSP_FREE_SIZE_KB_d",
                          "label": "Free size (kb)"
                        },
                        {
                          "columnId": "TBSP_AUTO_RESIZE_ENABLED_s",
                          "label": "auto resize"
                        },
                        {
                          "columnId": "TBSP_INCREASE_SIZE_s",
                          "label": "Resize size"
                        },
                        {
                          "columnId": "TimeGenerated",
                          "label": "Time"
                        }
                      ]
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "8"
                  },
                  "name": "Storage-Tablespaces",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let LastOne = DB2_LocksAndBlocks_CL  \r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| summarize TimeGenerated = max(TimeGenerated)\r\n| project TimeGenerated;\r\n\r\nDB2_LocksAndBlocks_CL  \r\n| join kind=inner (LastOne) on TimeGenerated \r\n| where PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| project LOCK_OBJECT_TYPE_s, LOCK_MODE_s,LOCK_STATUS_s,LOCK_COUNT_d,LOCK_HOLD_COUNT_d,TABSCHEMA_s,TABNAME_s,APPLICATION_HANDLE_d,APPLICATION_NAME_s,APPLICATION_ID_s, TimeGenerated\r\n| order by LOCK_STATUS_s desc, TABSCHEMA_s asc, TABNAME_s asc\r\n\r\n",
                    "size": 0,
                    "title": "Current Locks",
                    "timeContext": {
                      "durationMs": 86400000
                    },
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "LOCK_STATUS_s",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "G",
                                "representation": "Sev3",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "W",
                                "representation": "Sev0",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "C",
                                "representation": "Sev1",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Sev0",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "LOCK_OBJECT_TYPE_s",
                          "label": "Type"
                        },
                        {
                          "columnId": "LOCK_MODE_s",
                          "label": "Mode"
                        },
                        {
                          "columnId": "LOCK_STATUS_s",
                          "label": "Status"
                        },
                        {
                          "columnId": "LOCK_COUNT_d",
                          "label": "Count"
                        },
                        {
                          "columnId": "LOCK_HOLD_COUNT_d",
                          "label": "Hold Locks"
                        },
                        {
                          "columnId": "TABSCHEMA_s",
                          "label": "Schema"
                        },
                        {
                          "columnId": "TABNAME_s",
                          "label": "Name"
                        },
                        {
                          "columnId": "APPLICATION_HANDLE_d",
                          "label": "Appl. Handle"
                        },
                        {
                          "columnId": "APPLICATION_NAME_s",
                          "label": "Appl .Name"
                        },
                        {
                          "columnId": "APPLICATION_ID_s",
                          "label": "Appl. ID"
                        },
                        {
                          "columnId": "TimeGenerated",
                          "label": "Time"
                        }
                      ]
                    }
                  },
                  "conditionalVisibilities": [
                    {
                      "parameterName": "selectedTab",
                      "comparison": "isEqualTo",
                      "value": "4"
                    },
                    {
                      "parameterName": "param_locks_and_blocks_table_exists",
                      "comparison": "isEqualTo",
                      "value": "0"
                    }
                  ],
                  "name": "Locks-LocksAndBlocks",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": " let LastOne = DB2_TableSizes_CL\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| summarize TimeGenerated = max(TimeGenerated)\r\n| project TimeGenerated;\r\n\r\nDB2_TableSizes_CL\r\n| join kind=inner (LastOne) on TimeGenerated \r\n| where PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| project STATS_TIME_s,SCHEMANAME_s,TABNAME_s,ROWS_PER_TABLE_d,USED_MB_d = toreal(USED_MB_s),ALLOCATED_MB_b = toreal(ALLOCATED_MB_s)\r\n| order by ROWS_PER_TABLE_d desc",
                    "size": 2,
                    "title": "Tablesizes (top 100)",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "ROWS_PER_TABLE_d",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        },
                        {
                          "columnMatch": "USED_MB_d",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        },
                        {
                          "columnMatch": "ALLOCATED_MB_b",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        }
                      ],
                      "sortBy": [
                        {
                          "itemKey": "$gen_heatmap_ALLOCATED_MB_b_5",
                          "sortOrder": 2
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "STATS_TIME_s",
                          "label": "Statistic Time"
                        },
                        {
                          "columnId": "SCHEMANAME_s",
                          "label": "Schema"
                        },
                        {
                          "columnId": "TABNAME_s",
                          "label": "Table"
                        },
                        {
                          "columnId": "ROWS_PER_TABLE_d",
                          "label": "Rows"
                        },
                        {
                          "columnId": "USED_MB_d",
                          "label": "Used Space (MB)"
                        },
                        {
                          "columnId": "ALLOCATED_MB_b",
                          "label": "Allocated Space (MB)"
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_heatmap_ALLOCATED_MB_b_5",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "selectedTab",
                    "comparison": "isEqualTo",
                    "value": "8"
                  },
                  "name": "Storage-Tablesizes",
                  "styleSettings": {
                    "showBorder": true
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "provider_table_exists",
              "comparison": "isEqualTo",
              "value": "1"
            },
            "name": "Metrics Group"
          }
        ]
      },
      "name": "DB Monitoring group"
    }
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}