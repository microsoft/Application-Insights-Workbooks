{
    "version": "Notebook/1.0",
    "items": [
      {
        "type": 9,
        "content": {
          "version": "KqlParameterItem/1.0",
          "parameters": [
            {
              "id": "fe04b060-a336-4f44-882a-f73613825d3a",
              "version": "KqlParameterItem/1.0",
              "name": "TimeRange",
              "label": "Time Range",
              "type": 4,
              "isRequired": true,
              "typeSettings": {
                "selectableValues": [
                  {
                    "durationMs": 300000
                  },
                  {
                    "durationMs": 900000
                  },
                  {
                    "durationMs": 1800000
                  },
                  {
                    "durationMs": 3600000
                  },
                  {
                    "durationMs": 14400000
                  },
                  {
                    "durationMs": 43200000
                  },
                  {
                    "durationMs": 86400000
                  },
                  {
                    "durationMs": 172800000
                  },
                  {
                    "durationMs": 259200000
                  },
                  {
                    "durationMs": 604800000
                  },
                  {
                    "durationMs": 1209600000
                  },
                  {
                    "durationMs": 2419200000
                  },
                  {
                    "durationMs": 2592000000
                  },
                  {
                    "durationMs": 5184000000
                  },
                  {
                    "durationMs": 7776000000
                  }
                ],
                "allowCustom": true
              },
              "timeContext": {
                "durationMs": 604800000
              },
              "value": {
                "durationMs": 604800000
              },
              "key": "fe04b060-a336-4f44-882a-f73613825d3a"
            },
            {
              "id": "56e7925e-87ac-4da5-a28a-8d7a8c854195",
              "version": "KqlParameterItem/1.0",
              "name": "AzureAIProject",
              "label": "Azure AI Project",
              "type": 5,
              "isRequired": true,
              "isHiddenWhenLocked": true,
              "typeSettings": {
                "additionalResourceOptions": [
                  "value::1"
                ],
                "showDefault": false,
                "componentIdOnly": true
              },
              "defaultValue": "value::1",
              "key": "56e7925e-87ac-4da5-a28a-8d7a8c854195"
            },
            {
              "id": "910ca8e9-cacd-453a-8a2a-bafeb4463e06",
              "version": "KqlParameterItem/1.0",
              "name": "ApplicationInsights",
              "label": "Application Insights",
              "type": 5,
              "isRequired": true,
              "multiSelect": false,
              "query": "// this resource might be an ai resource OR an appinsights resource already\r\nresources | where id =~ \"{AzureAIProject}\"\r\n| extend appInsights = iff(\r\n// if the type alerady is appinsights, return it\r\ntype =~ \"microsoft.insights/components\", id,\r\n// if it wasn't look for the linked item inside properties\r\ntostring(properties.applicationInsights))\r\n| project appInsights, name, selected=1",
              "crossComponentResources": [
                "{AzureAIProject}"
              ],
              "isHiddenWhenLocked": true,
              "typeSettings": {
                "additionalResourceOptions": [
                  "value::1"
                ],
                "showDefault": false
              },
              "timeContextFromParameter": null,
              "defaultValue": "value::1",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "key": "910ca8e9-cacd-453a-8a2a-bafeb4463e06"
            },
            {
              "id": "e7d3b1f7-46be-42a0-a230-bd956710205f",
              "version": "KqlParameterItem/1.0",
              "name": "Model",
              "label": "Model",
              "type": 2,
              "isRequired": false,
              "multiSelect": true,
              "quote": "'",
              "delimiter": ",",
              "query": "dependencies\r\n| where isnotnull(customDimensions[\"gen_ai.system\"]) and isnotempty(customDimensions[\"gen_ai.response.model\"])\r\n| project response_model = customDimensions[\"gen_ai.response.model\"]\r\n| distinct tostring(response_model)",
              "crossComponentResources": [
                "{ApplicationInsights}"
              ],
              "isHiddenWhenLocked": false,
              "typeSettings": {
                "additionalResourceOptions": [
                  "value::all"
                ],
                "selectAllValue": "*",
                "showDefault": false
              },
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "TimeRange",
              "defaultValue": "value::all",
              "queryType": 0,
              "resourceType": "microsoft.insights/components",
              "key": "e7d3b1f7-46be-42a0-a230-bd956710205f"
            },
            {
              "id": "8d86fb4d-756c-4cd4-afdb-7ce2f8481600",
              "version": "KqlParameterItem/1.0",
              "name": "Application",
              "label": "Application",
              "type": 2,
              "multiSelect": true,
              "quote": "'",
              "delimiter": ",",
              "query": "dependencies\r\n| where isnotnull(customDimensions[\"gen_ai.system\"]) and isnotempty(customDimensions[\"gen_ai.response.model\"])\r\n| project application = cloud_RoleName\r\n| distinct tostring(application)\r\n",
              "crossComponentResources": [
                "{ApplicationInsights}"
              ],
              "isHiddenWhenLocked": false,
              "typeSettings": {
                "additionalResourceOptions": [
                  "value::all"
                ],
                "selectAllValue": "*",
                "showDefault": false
              },
              "timeContext": {
                "durationMs": 0
              },
              "timeContextFromParameter": "TimeRange",
              "defaultValue": "value::all",
              "queryType": 0,
              "resourceType": "microsoft.insights/components",
              "key": "8d86fb4d-756c-4cd4-afdb-7ce2f8481600"
            }
          ],
          "style": "pills"
        },
        "name": "parameters",
        "id": "3d2881a4-b8e6-4cad-9da4-76f80cdd4687",
        "styleSettings": {
          "showBorder": false,
          "borderStyle": "light rounded",
          "x": 0,
          "y": 0,
          "w": 24,
          "h": 2
        }
      },
      {
        "type": 1,
        "name": "Operational Metrics",
        "content": {
          "json": "",
          "title": "Operational Metrics"
        },
        "styleSettings": {
          "showBorder": false,
          "borderStyle": "light rounded",
          "w": 24,
          "h": 1,
          "x": 0,
          "y": 2,
          "margin": "0",
          "padding": "0"
        },
        "id": "1d02e727-7504-44a2-b343-3ab4df211b00"
      },
      {
        "type": 3,
        "content": {
          "version": "KqlItem/1.0",
          "query": "dependencies\r\n| where customDimensions[\"gen_ai.operation.name\"] == \"chat\"\r\n  and customDimensions[\"gen_ai.response.model\"] in ({Model})\r\n  and cloud_RoleName in ({Application})\r\n  and timestamp {TimeRange}  // Replace {TimeRange} with your specific time filter\r\n| summarize \r\n    total_tokens = sum(\r\n        toint(customDimensions[\"gen_ai.usage.input_tokens\"]) + \r\n        toint(customDimensions[\"gen_ai.usage.output_tokens\"])\r\n    )\r\n  by bin(timestamp, 1d)  // Adjust the time bin as needed (e.g., 1d for daily)\r\n| summarize \r\n    initial_total_tokens = todouble(arg_min(timestamp, total_tokens).[1]), \r\n    final_total_tokens = todouble(arg_max(timestamp, total_tokens).[1]),\r\n    total_tokens = sum(total_tokens)\r\n| extend overall_percentage_change = round(\r\n    (final_total_tokens - initial_total_tokens) / initial_total_tokens * 100\r\n)\r\n| project metric = \"Total tokens\", total_tokens, overall_percentage_change",
          "size": 4,
          "timeContextFromParameter": "TimeRange",
          "queryType": 0,
          "resourceType": "microsoft.insights/components",
          "crossComponentResources": [
            "{ApplicationInsights}"
          ],
          "visualization": "tiles",
          "sortBy": [],
          "tileSettings": {
            "titleContent": {
              "columnMatch": "metric",
              "formatter": 1
            },
            "leftContent": {
              "columnMatch": "total_tokens",
              "formatter": 12,
              "formatOptions": {
                "palette": "none"
              },
              "numberFormat": {
                "unit": 17,
                "options": {
                  "style": "decimal",
                  "maximumFractionDigits": 0
                }
              }
            },
            "rightContent": {
              "columnMatch": "completion_tokens",
              "formatter": 1
            },
            "secondaryContent": {
              "columnMatch": "overall_percentage_change",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": ">",
                    "thresholdValue": "0",
                    "representation": "green",
                    "text": "{0}{1} increase over {TimeRange:label}"
                  },
                  {
                    "operator": "<",
                    "thresholdValue": "0",
                    "representation": "red",
                    "text": "{0}{1} decrease over {TimeRange:label}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "gray",
                    "text": "No change over {TimeRange:label}"
                  }
                ],
                "showAsTag": true
              },
              "numberFormat": {
                "unit": 1,
                "options": {
                  "style": "decimal",
                  "maximumFractionDigits": 1
                }
              }
            },
            "showBorder": true,
            "size": "full",
            "styleSettings": {
              "borderStyle": "rounded",
              "backgroundColor": "colorGray100"
            }
          }
        },
        "customWidth": "25",
        "name": "tokens tile",
        "styleSettings": {
          "showBorder": false,
          "borderStyle": "light rounded",
          "x": 0,
          "y": 3,
          "w": 6,
          "h": 3,
          "padding": "0"
        },
        "id": "bc649845-2d64-4587-b9b3-3b4a6ffe217d"
      },
      {
        "type": 3,
        "content": {
          "version": "KqlItem/1.0",
          "query": "dependencies\r\n| where customDimensions[\"gen_ai.operation.name\"] == \"chat\"\r\n  and customDimensions[\"gen_ai.response.model\"] in ({Model})\r\n  and cloud_RoleName in ({Application})\r\n  and timestamp {TimeRange}  // Replace {TimeRange} with your specific time filter\r\n| summarize \r\n    avg_duration = avg(duration) \r\n by bin(timestamp, 1d)  // Adjust the time bin as needed (e.g., 1d for daily)\r\n| summarize \r\n    initial_avg_duration = todouble(arg_min(timestamp, avg_duration).[1]), \r\n    final_avg_duration = todouble(arg_max(timestamp, avg_duration).[1]),\r\n    avg_duration= round(avg(avg_duration))\r\n| extend overall_percentage_change = round(\r\n    (initial_avg_duration - final_avg_duration) / initial_avg_duration * 100)\r\n| project metric = \"Latency\", avg_duration, overall_percentage_change",
          "size": 4,
          "timeContextFromParameter": "TimeRange",
          "queryType": 0,
          "resourceType": "microsoft.insights/components",
          "crossComponentResources": [
            "{ApplicationInsights}"
          ],
          "visualization": "tiles",
          "tileSettings": {
            "titleContent": {
              "columnMatch": "metric",
              "formatter": 1
            },
            "leftContent": {
              "columnMatch": "avg_duration",
              "formatter": 12,
              "formatOptions": {
                "palette": "none"
              },
              "numberFormat": {
                "unit": 22,
                "options": {
                  "style": "decimal",
                  "maximumFractionDigits": 2
                }
              }
            },
            "rightContent": {
              "columnMatch": "completion_tokens",
              "formatter": 1
            },
            "secondaryContent": {
              "columnMatch": "overall_percentage_change",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": ">",
                    "thresholdValue": "0",
                    "representation": "green",
                    "text": "{0}{1} increase over {TimeRange:label}"
                  },
                  {
                    "operator": "<",
                    "thresholdValue": "0",
                    "representation": "red",
                    "text": "{0}{1} decrease over {TimeRange:label}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "gray",
                    "text": "No change over {TimeRange:label}"
                  }
                ],
                "showAsTag": true
              },
              "numberFormat": {
                "unit": 1,
                "options": {
                  "style": "decimal",
                  "maximumFractionDigits": 1
                }
              }
            },
            "showBorder": true,
            "size": "full",
            "styleSettings": {
              "borderStyle": "rounded",
              "backgroundColor": "colorGray100"
            }
          }
        },
        "customWidth": "25",
        "name": "latency tile",
        "styleSettings": {
          "showBorder": false,
          "borderStyle": "light rounded",
          "x": 6,
          "y": 3,
          "w": 6,
          "h": 3,
          "padding": "0"
        },
        "id": "14eb89eb-829f-4e94-8c70-f86d79af32a2"
      },
      {
        "type": 3,
        "content": {
          "version": "KqlItem/1.0",
          "query": "dependencies\r\n| where customDimensions[\"gen_ai.operation.name\"] == \"chat\"\r\n  and customDimensions[\"gen_ai.response.model\"] in ({Model})\r\n  and cloud_RoleName in ({Application})\r\n  and timestamp {TimeRange}  // Replace {TimeRange} with your specific time filter\r\n| summarize \r\n    total_requests = count() \r\n  by bin(timestamp, 1d)  // Adjust the time bin as needed (e.g., 1d for daily)\r\n| summarize \r\n    initial_total_requests = todouble(arg_min(timestamp, total_requests).[1]), \r\n    final_total_requests = todouble(arg_max(timestamp, total_requests).[1]),\r\n    total_requests = sum(total_requests)\r\n| extend overall_percentage_change = round(\r\n    (initial_total_requests - final_total_requests) / initial_total_requests * 100\r\n)\r\n| project metric = \"Total requests\", total_requests, overall_percentage_change\r\n",
          "size": 4,
          "timeContextFromParameter": "TimeRange",
          "queryType": 0,
          "resourceType": "microsoft.insights/components",
          "crossComponentResources": [
            "{ApplicationInsights}"
          ],
          "visualization": "tiles",
          "tileSettings": {
            "titleContent": {
              "columnMatch": "metric",
              "formatter": 1
            },
            "leftContent": {
              "columnMatch": "total_requests",
              "formatter": 12,
              "formatOptions": {
                "palette": "none"
              },
              "numberFormat": {
                "unit": 17,
                "options": {
                  "style": "decimal"
                }
              }
            },
            "rightContent": {
              "columnMatch": "completion_tokens",
              "formatter": 1
            },
            "secondaryContent": {
              "columnMatch": "overall_percentage_change",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": ">",
                    "thresholdValue": "0",
                    "representation": "green",
                    "text": "{0}{1} increase over {TimeRange:label}"
                  },
                  {
                    "operator": "<",
                    "thresholdValue": "0",
                    "representation": "red",
                    "text": "{0}{1} decrease over {TimeRange:label}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "gray",
                    "text": "No change over {TimeRange:label}"
                  }
                ],
                "showAsTag": true
              },
              "numberFormat": {
                "unit": 1,
                "options": {
                  "style": "decimal",
                  "maximumFractionDigits": 1
                }
              }
            },
            "showBorder": true,
            "size": "full",
            "styleSettings": {
              "borderStyle": "rounded",
              "backgroundColor": "colorGray100"
            }
          }
        },
        "customWidth": "25",
        "name": "requests tile",
        "styleSettings": {
          "showBorder": false,
          "borderStyle": "light rounded",
          "x": 12,
          "y": 3,
          "w": 6,
          "h": 3,
          "padding": "0"
        },
        "id": "b3d9a2a8-4dbf-40e2-afb3-b19e9f92565c"
      },
      {
        "type": 1,
        "name": "Evaluation metrics",
        "content": {
          "json": "",
          "title": "Evaluation Metrics"
        },
        "styleSettings": {
          "showBorder": false,
          "borderStyle": "light rounded",
          "w": 24,
          "h": 1,
          "x": 0,
          "y": 6,
          "margin": "0",
          "padding": "0"
        },
        "id": "f2cc1aed-fcde-4e39-b57c-86ba28e6767e"
      },
      {
        "type": 3,
        "content": {
          "version": "KqlItem/1.0",
          "query": "exceptions\r\n| where cloud_RoleName in ({Application}) and timestamp {TimeRange} \r\n| summarize total_exception = count() by bin(timestamp, 1d)\r\n| join kind=inner (\r\n    requests\r\n    | where cloud_RoleName in ({Application}) and timestamp {TimeRange} \r\n    | summarize total_requests = count() by bin(timestamp, 1d)\r\n) on timestamp\r\n| summarize \r\n    initial_total_exception = todouble(arg_min(timestamp, total_exception).[1]),\r\n    final_total_exception = todouble(arg_max(timestamp, total_exception).[1]),\r\n    initial_total_requests = todouble(arg_min(timestamp, total_requests).[1]),\r\n    final_total_requests = todouble(arg_max(timestamp, total_requests).[1]),\r\n    total_exception = sum(total_exception),\r\n    total_requests = sum(total_requests)\r\n| extend overall_percentage_change = round((final_total_exception - initial_total_exception) / initial_total_exception * 100)\r\n| extend overall_percentage_by_request = iff(total_requests == 0, 0.0, round((todouble(total_exception) / todouble(total_requests))*100))\r\n| project metric = \"Total exceptions (% req)\", total_exception,overall_percentage_by_request",
          "size": 4,
          "timeContextFromParameter": "TimeRange",
          "queryType": 0,
          "resourceType": "microsoft.insights/components",
          "crossComponentResources": [
            "{ApplicationInsights}"
          ],
          "visualization": "tiles",
          "tileSettings": {
            "titleContent": {
              "columnMatch": "metric",
              "formatter": 1
            },
            "leftContent": {
              "columnMatch": "total_exception",
              "formatter": 12,
              "formatOptions": {
                "palette": "none"
              }
            },
            "rightContent": {
              "columnMatch": "overall_percentage_by_request",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "Blank",
                    "text": "({0}{1})"
                  }
                ]
              },
              "numberFormat": {
                "unit": 1,
                "options": {
                  "style": "decimal"
                }
              }
            },
            "secondaryContent": {
              "columnMatch": "overall_percentage_change",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": ">",
                    "thresholdValue": "0",
                    "representation": "green",
                    "text": "{0}{1} increase over {TimeRange:label}"
                  },
                  {
                    "operator": "<",
                    "thresholdValue": "0",
                    "representation": "red",
                    "text": "{0}{1} decrease over {TimeRange:label}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "gray",
                    "text": "No change over {TimeRange:label}"
                  }
                ],
                "showAsTag": true
              },
              "numberFormat": {
                "unit": 1,
                "options": {
                  "style": "decimal",
                  "maximumFractionDigits": 1
                }
              }
            },
            "showBorder": true,
            "size": "full",
            "styleSettings": {
              "borderStyle": "rounded",
              "backgroundColor": "colorGray100"
            }
          }
        },
        "customWidth": "25",
        "name": "exceptions tile",
        "styleSettings": {
          "showBorder": false,
          "borderStyle": "light rounded",
          "x": 18,
          "y": 3,
          "w": 6,
          "h": 3,
          "padding": "0"
        },
        "id": "0d068a98-a4ab-49e9-97bf-26d0fb026c8d"
      },
      {
        "type": 3,
        "content": {
          "version": "KqlItem/1.0",
          "query": "let application = dynamic([{Application}]);\r\nlet model = dynamic([{Model}]);\r\nlet response_ids=(\r\ndependencies\r\n| where customDimensions[\"gen_ai.operation.name\"] == \"chat\" and (\"*\" in (model) or array_length(model) == 0 or customDimensions[\"gen_ai.response.model\"] in (model))\r\n| where ('*' in (application) or array_length(application) == 0 or cloud_RoleName in (application)) and timestamp {TimeRange}\r\n| project customDimensions.[\"gen_ai.response.id\"]\r\n); \r\ntraces\r\n| where customDimensions[\"event.name\"] startswith \"gen_ai.evaluation\" and customDimensions[\"event.name\"] != \"gen_ai.evaluation.user_feedback\"\r\n| where ('*' in (application) or array_length(application) == 0 or cloud_RoleName in (application)) and timestamp {TimeRange}  // Replace {TimeRange} with your specific time filter\r\n| where customDimensions.[\"gen_ai.response.id\"] in (response_ids)\r\n| project metric = extract(\"gen_ai\\\\.evaluation\\\\.(.*)\", 1, tostring(customDimensions[\"event.name\"])), score = toint(customDimensions[\"gen_ai.evaluation.score\"])\r\n| summarize TotalScores = count(), ScoresInTotal = sum(score) by tostring(metric)\r\n| extend Percentage = round(todouble(ScoresInTotal) / (TotalScores * 5) * 100)\r\n| join kind=inner (\r\ntraces\r\n| where customDimensions[\"event.name\"] startswith \"gen_ai.evaluation\" and customDimensions[\"event.name\"] != \"gen_ai.evaluation.user_feedback\"\r\n| where ('*' in (application) or array_length(application) == 0 or cloud_RoleName in (application)) and timestamp {TimeRange}  // Replace {TimeRange} with your specific time filter\r\n| where customDimensions.[\"gen_ai.response.id\"] in (response_ids)\r\n| project metric = extract(\"gen_ai\\\\.evaluation\\\\.(.*)\", 1, tostring(customDimensions[\"event.name\"])), score = toint(customDimensions[\"gen_ai.evaluation.score\"]), timestamp\r\n| summarize TotalScores = count(), ScoresInTotal = sum(score) by tostring(metric), bin(timestamp,1d)\r\n| extend Percentage = round(todouble(ScoresInTotal) / (TotalScores * 5) * 100)\r\n| summarize \r\n    initial_metric_percentage = todouble(arg_min(timestamp, Percentage).[1]), \r\n    final_metric_exception = todouble(arg_max(timestamp, Percentage).[1])\r\n    by metric\r\n) on metric\r\n| extend PercentageChange = round(todouble(initial_metric_percentage - final_metric_exception))\r\n| project metric=strcat(toupper(substring(metric, 0, 1)), substring(metric, 1)),initial_metric_percentage,final_metric_exception, Percentage,PercentageChange",
          "size": 4,
          "timeContextFromParameter": "TimeRange",
          "queryType": 0,
          "resourceType": "microsoft.insights/components",
          "crossComponentResources": [
            "{ApplicationInsights}"
          ],
          "visualization": "tiles",
          "tileSettings": {
            "titleContent": {
              "columnMatch": "metric",
              "formatter": 1
            },
            "leftContent": {
              "columnMatch": "Percentage",
              "formatter": 12,
              "formatOptions": {
                "palette": "none"
              },
              "numberFormat": {
                "unit": 1,
                "options": {
                  "style": "decimal"
                }
              }
            },
            "rightContent": {
              "columnMatch": "completion_tokens",
              "formatter": 1
            },
            "secondaryContent": {
              "columnMatch": "PercentageChange",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": ">",
                    "thresholdValue": "0",
                    "representation": "green",
                    "text": "{0}{1} increase over {TimeRange:label}"
                  },
                  {
                    "operator": "<",
                    "thresholdValue": "0",
                    "representation": "red",
                    "text": "{0}{1} decrease over {TimeRange:label}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "gray",
                    "text": "No change over {TimeRange:label}"
                  }
                ],
                "showAsTag": true
              },
              "numberFormat": {
                "unit": 1,
                "options": {
                  "style": "decimal",
                  "maximumFractionDigits": 1
                }
              }
            },
            "showBorder": true,
            "size": "auto",
            "styleSettings": {
              "borderStyle": "rounded",
              "backgroundColor": "colorGray100",
              "layout": "grid"
            }
          },
          "title": ""
        },
        "name": "evaluation metrics query tiles",
        "styleSettings": {
          "showBorder": false,
          "borderStyle": "light rounded",
          "x": 0,
          "y": 7,
          "w": 24,
          "h": 4,
          "margin": "0",
          "padding": "0"
        },
        "id": "89d62328-30bf-4ad3-aae6-68be74e90132"
      },
      {
        "type": 1,
        "name": "Charts",
        "content": {
          "json": "",
          "title": "Charts"
        },
        "styleSettings": {
          "showBorder": false,
          "borderStyle": "light rounded",
          "w": 24,
          "h": 1,
          "x": 0,
          "y": 11,
          "margin": "0",
          "padding": "0"
        },
        "id": "d44bf433-eb82-41a0-b01d-49f9f2e6f68e"
      },
      {
        "type": 3,
        "content": {
          "version": "KqlItem/1.0",
          "query": "let application = dynamic([{Application}]);\r\nlet model = dynamic([{Model}]);\r\ndependencies\r\n| where customDimensions[\"gen_ai.operation.name\"] == \"chat\" and (\"*\" in (model) or array_length(model) == 0 or customDimensions[\"gen_ai.response.model\"] in (model))\r\n  and ('*' in (application) or array_length(application) == 0 or cloud_RoleName in (application))\r\n  and timestamp {TimeRange}  // Replace {TimeRange} with your specific time filter\r\n| summarize \r\n    Prompt_Tokens = sum(toint(customDimensions[\"gen_ai.usage.input_tokens\"])),\r\n    Completion_Tokens = sum(toint(customDimensions[\"gen_ai.usage.output_tokens\"])),\r\n    Total_Tokens = sum(toint(customDimensions[\"gen_ai.usage.input_tokens\"]) + toint(customDimensions[\"gen_ai.usage.output_tokens\"]))\r\n    by bin(timestamp, 1d)\r\n| render linechart with (title=\"Token Usage Over Time\", ytitle=\"Token Count\", xtitle=\"Time\")",
          "size": 0,
          "title": "Token consumption(Input vs Output vs Total)",
          "timeContextFromParameter": "TimeRange",
          "queryType": 0,
          "resourceType": "microsoft.insights/components",
          "crossComponentResources": [
            "{ApplicationInsights}"
          ],
          "visualization": "linechart",
          "chartSettings": {
            "showMetrics": false,
            "showLegend": true,
            "seriesLabelSettings": [
              {
                "seriesName": "Prompt_Tokens",
                "label": "Input Tokens"
              },
              {
                "seriesName": "Completion_Tokens",
                "label": "Output Tokens"
              },
              {
                "seriesName": "Total_Tokens",
                "label": "Total Tokens"
              }
            ],
            "showDataPoints": true,
            "simpleLegendSettings": {
              "position": "bottom"
            },
            "xSettings": {
              "label": "Time"
            },
            "ySettings": {
              "label": "Token consumption"
            }
          }
        },
        "name": "Token consumption(Input vs Output vs Total)",
        "id": "5dd92ecb-030a-496d-bd61-c8dedff06913",
        "styleSettings": {
          "showBorder": true,
          "borderStyle": "light rounded",
          "x": 0,
          "y": 12,
          "w": 24,
          "h": 6
        }
      },
      {
        "type": 3,
        "content": {
          "version": "KqlItem/1.0",
          "query": "let application = dynamic([{Application}]);\r\nrequests\r\n| where  ('*' in (application) or array_length(application) == 0 or cloud_RoleName in (application)) and timestamp {TimeRange}  \r\n| summarize request_count = count() by success, bin (timestamp,1d)\r\n| project  request_count, success,timestamp  ",
          "size": 1,
          "title": "Total requests",
          "timeContextFromParameter": "TimeRange",
          "queryType": 0,
          "resourceType": "microsoft.insights/components",
          "crossComponentResources": [
            "{ApplicationInsights}"
          ],
          "visualization": "linechart",
          "chartSettings": {
            "showMetrics": false,
            "showLegend": true,
            "seriesLabelSettings": [
              {
                "seriesName": "True",
                "label": "Sucessful",
                "color": "greenDark"
              },
              {
                "seriesName": "False",
                "label": "Exceptions",
                "color": "red"
              }
            ],
            "simpleLegendSettings": {
              "position": "bottom"
            },
            "xSettings": {
              "label": "Time"
            },
            "ySettings": {
              "label": "Total requests"
            }
          }
        },
        "customWidth": "33.3",
        "name": "query - 1",
        "styleSettings": {
          "showBorder": true,
          "borderStyle": "light rounded",
          "x": 0,
          "y": 18,
          "w": 8,
          "h": 6
        },
        "id": "6beefe53-1b57-4d1e-be93-70a4590a0cde"
      },
      {
        "type": 3,
        "content": {
          "version": "KqlItem/1.0",
          "query": "let application = dynamic([{Application}]);\r\nrequests\r\n| where success == \"True\" and ('*' in (application) or array_length(application) == 0 or cloud_RoleName in (application)) and timestamp {TimeRange}  // Replace {TimeRange} with your specific time filter\r\n| summarize avg_duration=avg(duration), total_request=count()\r\n   by bin(timestamp, 1d)  // Adjust the time bin as needed (e.g., 1d for daily)\r\n| project duration=avg_duration, timestamp\r\n\r\n",
          "size": 1,
          "aggregation": 3,
          "title": "Time to response",
          "color": "lightBlue",
          "timeContextFromParameter": "TimeRange",
          "queryType": 0,
          "resourceType": "microsoft.insights/components",
          "crossComponentResources": [
            "{ApplicationInsights}"
          ],
          "visualization": "linechart",
          "chartSettings": {
            "yAxis": [
              "duration"
            ],
            "showMetrics": false,
            "seriesLabelSettings": [
              {
                "seriesName": "duration",
                "color": "lightBlue"
              }
            ],
            "showDataPoints": true,
            "xSettings": {
              "label": "Time"
            },
            "ySettings": {
              "numberFormatSettings": {
                "unit": 23,
                "options": {
                  "style": "decimal",
                  "useGrouping": true,
                  "maximumFractionDigits": 0
                }
              },
              "label": "Time to response"
            }
          }
        },
        "customWidth": "33.3",
        "name": "query - 2",
        "styleSettings": {
          "showBorder": true,
          "borderStyle": "light rounded",
          "x": 8,
          "y": 18,
          "w": 8,
          "h": 6
        },
        "id": "1c14d45e-cca7-4a39-a08d-fd8aed64ee09"
      },
      {
        "type": 3,
        "content": {
          "version": "KqlItem/1.0",
          "query": "let application = dynamic([{Application}]);\r\nrequests\r\n| where  ('*' in (application) or array_length(application) == 0 or cloud_RoleName in (application)) and timestamp {TimeRange}  // Replace {TimeRange} with your specific time filter\r\n| summarize Count = count() by success",
          "size": 1,
          "title": "Request status",
          "timeContextFromParameter": "TimeRange",
          "queryType": 0,
          "resourceType": "microsoft.insights/components",
          "crossComponentResources": [
            "{ApplicationInsights}"
          ],
          "visualization": "piechart",
          "chartSettings": {
            "showMetrics": false,
            "showLegend": true,
            "seriesLabelSettings": [
              {
                "seriesName": "True",
                "label": "Sucess",
                "color": "greenDark"
              },
              {
                "seriesName": "False",
                "label": "Exception",
                "color": "red"
              }
            ],
            "simpleLegendSettings": {
              "position": "bottom"
            }
          }
        },
        "customWidth": "33.3",
        "name": "query - 3",
        "styleSettings": {
          "showBorder": true,
          "borderStyle": "light rounded",
          "x": 16,
          "y": 18,
          "w": 8,
          "h": 6
        },
        "id": "8ddd5a7f-b5dc-4cb8-ab49-8583204a6d76"
      },
      {
        "type": 3,
        "content": {
          "version": "KqlItem/1.0",
          "query": "let application = dynamic([{Application}]);\r\nlet model = dynamic([{Model}]);\r\nlet response_ids=(\r\ndependencies\r\n| where customDimensions[\"gen_ai.operation.name\"] == \"chat\" and (\"*\" in (model) or array_length(model) == 0 or customDimensions[\"gen_ai.response.model\"] in (model))\r\n| where ('*' in (application) or array_length(application) == 0 or cloud_RoleName in (application)) and timestamp {TimeRange}\r\n| project customDimensions.[\"gen_ai.response.id\"]\r\n); \r\ntraces\r\n| where customDimensions[\"event.name\"] startswith \"gen_ai.evaluation\" and customDimensions[\"event.name\"] != \"gen_ai.evaluation.user_feedback\"\r\n| where ('*' in (application) or array_length(application) == 0 or cloud_RoleName in (application)) and timestamp {TimeRange}\r\n| where customDimensions.[\"gen_ai.response.id\"] in (response_ids)\r\n| project metric = extract(\"gen_ai\\\\.evaluation\\\\.(.*)\", 1, tostring(customDimensions[\"event.name\"])), score = toint(customDimensions[\"gen_ai.evaluation.score\"]), timestamp\r\n| summarize totalscores = count(), scoresintotal = sum(score) by tostring(metric), bin(timestamp,1d) \r\n| extend percentage = round(todouble(scoresintotal) / (totalscores * 5) * 100)\r\n| project strcat(toupper(substring(metric, 0, 1)), substring(metric, 1)),percentage, timestamp\r\n",
          "size": 1,
          "title": "Daily quality passing rate",
          "timeContextFromParameter": "TimeRange",
          "queryType": 0,
          "resourceType": "microsoft.insights/components",
          "crossComponentResources": [
            "{ApplicationInsights}"
          ],
          "visualization": "linechart",
          "chartSettings": {
            "showMetrics": false,
            "showLegend": true,
            "simpleLegendSettings": {
              "position": "bottom"
            },
            "xSettings": {
              "label": "Time"
            },
            "ySettings": {
              "label": "Passing rate(0-100%)"
            }
          }
        },
        "name": "query - 4",
        "styleSettings": {
          "showBorder": true,
          "borderStyle": "light rounded",
          "x": 0,
          "y": 24,
          "w": 24,
          "h": 6
        },
        "id": "baf17bd7-d0a9-4189-8a62-c3671816fc66"
      },
      {
        "type": 3,
        "content": {
          "version": "KqlItem/1.0",
          "query": "let application = dynamic([{Application}]);\r\nlet model = dynamic([{Model}]);\r\nlet response_ids=(\r\ndependencies\r\n| where customDimensions[\"gen_ai.operation.name\"] == \"chat\" and (\"*\" in (model) or array_length(model) == 0 or customDimensions[\"gen_ai.response.model\"] in (model))\r\n| where ('*' in (application) or array_length(application) == 0 or cloud_RoleName in (application)) and timestamp {TimeRange}\r\n| project customDimensions.[\"gen_ai.response.id\"]\r\n); \r\ntraces\r\n| where customDimensions[\"event.name\"] startswith \"gen_ai.evaluation\" and customDimensions[\"event.name\"] != \"gen_ai.evaluation.user_feedback\"\r\n| where ('*' in (application) or array_length(application) == 0 or cloud_RoleName in (application)) and timestamp {TimeRange} \r\n| where customDimensions.[\"gen_ai.response.id\"] in (response_ids)\r\n| project metric = extract(\"gen_ai\\\\.evaluation\\\\.(.*)\", 1, tostring(customDimensions[\"event.name\"])), score = toint(customDimensions[\"gen_ai.evaluation.score\"]), timestamp\r\n| summarize totalscores = count(), scoresintotal = sum(score) by tostring(metric), bin(timestamp,1d) \r\n| extend percentage = round(todouble(scoresintotal) / (totalscores * 5) * 100)\r\n| project strcat(toupper(substring(metric, 0, 1)), substring(metric, 1)),percentage, timestamp\r\n",
          "size": 1,
          "title": "Daily safety defect rate",
          "timeContextFromParameter": "TimeRange",
          "queryType": 0,
          "resourceType": "microsoft.insights/components",
          "crossComponentResources": [
            "{ApplicationInsights}"
          ],
          "visualization": "linechart",
          "chartSettings": {
            "showMetrics": false,
            "showLegend": true,
            "simpleLegendSettings": {
              "position": "bottom"
            },
            "xSettings": {
              "label": "Time"
            },
            "ySettings": {
              "label": "Defect rate(0-100%)"
            }
          }
        },
        "customWidth": "66.67",
        "name": "Daily safety defect rate",
        "styleSettings": {
          "showBorder": true,
          "borderStyle": "light rounded",
          "x": 0,
          "y": 30,
          "w": 16,
          "h": 6
        },
        "id": "a02e6c4f-5318-4e47-8c74-94e601ec8bf9"
      },
      {
        "type": 3,
        "content": {
          "version": "KqlItem/1.0",
          "query": "let application=dynamic([{Application}]);\r\nlet model=dynamic([{Model}]);\r\nlet response_ids=(\r\ndependencies\r\n| where customDimensions[\"gen_ai.operation.name\"] == \"chat\" and (\"*\" in (model) or array_length(model) == 0 or customDimensions[\"gen_ai.response.model\"] in (model))\r\n| where ('*' in (application) or array_length(application) == 0 or cloud_RoleName in (application)) and timestamp {TimeRange}\r\n| project customDimensions.[\"gen_ai.response.id\"]\r\n); \r\ntraces\r\n| where customDimensions[\"event.name\"] == \"gen_ai.evaluation.user_feedback\"\r\n| where ('*' in (application) or array_length(application) == 0 or cloud_RoleName in (application)) and timestamp {TimeRange} \r\n| where customDimensions.[\"gen_ai.response.id\"] in (response_ids)\r\n| extend FeedbackType = case(toint(customDimensions[\"gen_ai.evaluation.score\"]) == -1, \"Positive\", toint(customDimensions[\"gen_ai.evaluation.score\"]) == 1, \"Negative\", \"Unknown\")\r\n| summarize Count = count() by FeedbackType",
          "size": 1,
          "title": "User feedback",
          "timeContextFromParameter": "TimeRange",
          "queryType": 0,
          "resourceType": "microsoft.insights/components",
          "crossComponentResources": [
            "{ApplicationInsights}"
          ],
          "visualization": "piechart",
          "chartSettings": {
            "showMetrics": false,
            "showLegend": true,
            "seriesLabelSettings": [
              {
                "seriesName": "Positive",
                "label": "Thumbs up",
                "color": "greenDark"
              },
              {
                "seriesName": "Negative",
                "label": "Thumbs down",
                "color": "red"
              }
            ],
            "simpleLegendSettings": {
              "position": "bottom"
            }
          }
        },
        "customWidth": "33.3",
        "name": "query - 6",
        "styleSettings": {
          "showBorder": true,
          "borderStyle": "light rounded",
          "x": 16,
          "y": 30,
          "w": 8,
          "h": 6
        },
        "id": "43bd5f18-c128-4585-8fb7-cfa0f6e7b5d0"
      }
    ],
    "layout": {
      "type": "grid"
    },
    "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
  }