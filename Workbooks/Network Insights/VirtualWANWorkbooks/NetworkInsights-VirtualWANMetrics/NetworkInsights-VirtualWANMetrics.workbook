{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "value::all"
        ],
        "parameters": [
          {
            "id": "f7b258f8-b504-4628-9349-6cc13494fbde",
            "version": "KqlParameterItem/1.0",
            "name": "virtualWAN",
            "label": "Virtual WAN",
            "type": 5,
            "isRequired": true,
            "value": null,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "a32fb2e3-81f6-4a93-b6ce-11a571cf0e35",
            "version": "KqlParameterItem/1.0",
            "name": "vpnGateway",
            "label": "VPN Gateways",
            "type": 5,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "resources\r\n| where type =~ \"microsoft.network/virtualwans\" and id =~ '{virtualWAN}'\r\n| mv-expand virtualHub = properties.virtualHubs\r\n| project hubId = tolower(virtualHub.id)\r\n| join kind=inner (\r\nresources\r\n| where type =~ \"microsoft.network/virtualhubs\"\r\n| where isnotempty(properties.vpnGateway.id)\r\n| project hubId = tolower(id), vpnGateway = tolower(properties.vpnGateway.id)\r\n) on hubId\r\n| project vpnGateway, selected = 1",
            "crossComponentResources": [
              "value::all"
            ],
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": []
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "f352a667-6fe1-49ba-8b36-db25c13cccad",
            "version": "KqlParameterItem/1.0",
            "name": "expressRouteGateway",
            "label": "Express Route Gateways",
            "type": 5,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "resources\r\n| where type =~ \"microsoft.network/virtualwans\" and id =~ '{virtualWAN}'\r\n| mv-expand virtualHub = properties.virtualHubs\r\n| project hubId = tolower(virtualHub.id)\r\n| join kind=inner (\r\nresources\r\n| where type =~ \"microsoft.network/virtualhubs\"\r\n| where isnotempty(properties.expressRouteGateway.id)\r\n| project hubId = tolower(id), erGateway = tolower(properties.expressRouteGateway.id)\r\n) on hubId\r\n| project erGateway, selected = 1",
            "crossComponentResources": [
              "value::all"
            ],
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": []
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "096613e4-3ff4-465c-bbb5-eabe86bfb15e",
            "version": "KqlParameterItem/1.0",
            "name": "p2SVpnGateway",
            "label": "P2S VPN Gateways",
            "type": 5,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "resources\r\n| where type =~ \"microsoft.network/virtualwans\" and id =~ '{virtualWAN}'\r\n| mv-expand virtualHub = properties.virtualHubs\r\n| project hubId = tolower(virtualHub.id)\r\n| join kind=inner (\r\nresources\r\n| where type =~ \"microsoft.network/virtualhubs\"\r\n| where isnotempty(properties.p2SVpnGateway.id)\r\n| project hubId = tolower(id), p2sVpnGateway = tolower(properties.p2SVpnGateway.id)\r\n) on hubId\r\n| project p2sVpnGateway, selected = 1",
            "crossComponentResources": [
              "value::all"
            ],
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": []
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "6719e1c0-1bdb-42d0-911c-aa77e3da2d14",
            "version": "KqlParameterItem/1.0",
            "name": "azureFirewall",
            "label": "Azure Firewall",
            "type": 5,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "resources\r\n| where type =~ \"microsoft.network/virtualwans\" and id =~ '{virtualWAN}'\r\n| mv-expand virtualHub = properties.virtualHubs\r\n| project hubId = tolower(virtualHub.id)\r\n| join kind=inner (\r\nresources\r\n| where type =~ \"microsoft.network/virtualhubs\"\r\n| where isnotempty(properties.azureFirewall.id)\r\n| project hubId = tolower(id), firewall = tolower(properties.azureFirewall.id)\r\n) on hubId\r\n| project firewall, selected = 1",
            "crossComponentResources": [
              "value::all"
            ],
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": []
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "7febaca6-d287-4b9a-9033-31b74cac40cb",
            "version": "KqlParameterItem/1.0",
            "name": "erCircuits",
            "label": "Express Route Circuits",
            "type": 5,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "resources\r\n| where type =~ \"microsoft.network/virtualwans\" and id =~ '{virtualWAN}'\r\n| mv-expand virtualHub = properties.virtualHubs\r\n| project hubId = tolower(virtualHub.id)\r\n| join kind=inner (\r\nresources\r\n| where type =~ \"microsoft.network/virtualhubs\"\r\n| where isnotempty(properties.expressRouteGateway.id)\r\n| project hubId = tolower(id), erGateway = tolower(properties.expressRouteGateway.id)\r\n) on hubId\r\n| project erGateway\r\n| join kind=inner (\r\nresources\r\n| where type =~ \"microsoft.network/expressroutegateways\"\r\n| mv-expand connectionDetails = properties.expressRouteConnections\r\n| extend peeringId = connectionDetails.properties.expressRouteCircuitPeering.id\r\n| project erGateway = tolower(id), erCircuit = tolower(split(peeringId, '/peerings/')[0])\r\n| distinct erGateway, erCircuit\r\n) on erGateway\r\n| distinct erCircuit\r\n| project erCircuit, selected = 1",
            "crossComponentResources": [
              "value::all"
            ],
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": []
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "51cc9691-04f1-477f-864a-d49c72e38ee6",
            "version": "KqlParameterItem/1.0",
            "name": "TimeRange",
            "label": "Time Range",
            "type": 4,
            "isRequired": true,
            "value": {
              "durationMs": 86400000
            },
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 1800000
                },
                {
                  "durationMs": 3600000
                },
                {
                  "durationMs": 43200000
                },
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 172800000
                },
                {
                  "durationMs": 259200000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 7776000000
                }
              ],
              "allowCustom": true
            },
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "ae5bf44c-0afd-48e4-9e46-26cd8f7f0adb",
            "version": "KqlParameterItem/1.0",
            "name": "virtualHubQuery",
            "type": 1,
            "description": "Query to get VWAN Vnet Connection Counts",
            "query": "resources\r\n| where type =~ \"microsoft.network/virtualhubs\"\r\n| where properties.virtualWan.id =~ '{virtualWAN}'\r\n| project id, name\r\n| extend d = pack(\"httpMethod\", \"GET\", \"requestHeaderDetails\", pack(\"commandName\", \"Microsoft_Azure_HybridNetworking\") ,\"url\", strcat(\"https://management.azure.com\", id, \"/hubVirtualNetworkConnections/?api-version=2021-03-01\"))\r\n| summarize mylist = make_list(d)\r\n| extend request = pack(\"requests\", mylist)\r\n| project request",
            "crossComponentResources": [
              "value::all"
            ],
            "isHiddenWhenLocked": true,
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          }
        ],
        "style": "pills",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources"
      },
      "name": "parameters - Filters 3"
    },
    {
      "type": 1,
      "content": {
        "json": "#### Virtual WAN Regional Hub Status and Hub Capacities (Gbps)\r\n\r\n**Geographical Hub Location Map** displays the Virtual WAN hubs that are deployed in various Azure regsions. \r\n**Virtual WAN Hubs Status** is indicated by Green or Red color - Green indicates that all the deployed gateways in a hub are successfully deployed and active; Red indicates that one or more of the gateways are in a failed state. \r\n**Virtual WAN Hub Capacity** is the total capapcity in Gbps of each hub displayed below the map. The hub capapcity is derived by adding the capacities of all the gateways in each Virtual WAN hub (Gateway capcacity is derived by # of gateway scale units * bandwidth of each scale unit in Gbps)"
      },
      "name": "Map help"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "resources\r\n| where type =~ \"microsoft.network/virtualhubs\"\r\n| where properties.virtualWan.id =~ '{virtualWAN}'\r\n| project hubId = tolower(id), hubLocation = location\r\n| join kind=leftouter (\r\nresources\r\n| where type =~ \"microsoft.network/vpngateways\"\r\n| project hubId = tolower(properties.virtualHub.id), vpnGWStatus = properties.provisioningState, vpnGWScaleUnit = properties.vpnGatewayScaleUnit\r\n) on hubId\r\n| join kind=leftouter (\r\nresources\r\n| where type =~ \"microsoft.network/p2svpngateways\"\r\n| project hubId = tolower(properties.virtualHub.id), p2sGWStatus = properties.provisioningState, p2sGWScaleUnit = properties.vpnGatewayScaleUnit\r\n) on hubId\r\n| join kind=leftouter (\r\nresources\r\n| where type =~ \"microsoft.network/expressroutegateways\"\r\n| project hubId = tolower(properties.virtualHub.id), erGWStatus = properties.provisioningState, erGWMinScaleUnit = properties.autoScaleConfiguration.bounds.min\r\n) on hubId\r\n| extend totalHubCapacityInGbps = iff(isnotempty(vpnGWScaleUnit), vpnGWScaleUnit, 0) + iff(isnotempty(p2sGWScaleUnit), p2sGWScaleUnit, 0) + iff(isnotempty(erGWMinScaleUnit), 2 * erGWMinScaleUnit, 0)\r\n| extend hubGatewaysStatus = iff ((isempty(vpnGWStatus) or vpnGWStatus =~ 'Succeeded') and (isempty(p2sGWStatus) or p2sGWStatus =~ 'Succeeded') and (isempty(erGWStatus) or erGWStatus =~ 'Succeeded'), 1, 0)\r\n| project hubId, hubLocation, hubGatewaysStatus, totalHubCapacityInGbps\r\n",
        "size": 3,
        "noDataMessage": "No virtual WAN selected",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "value::all"
        ],
        "visualization": "map",
        "mapSettings": {
          "locInfo": "AzureResource",
          "locInfoColumn": "hubId",
          "sizeAggregation": "Sum",
          "defaultSize": 12,
          "legendMetric": "totalHubCapacityInGbps",
          "legendAggregation": "Sum",
          "itemColorSettings": {
            "nodeColorField": "hubGatewaysStatus",
            "colorAggregation": "Sum",
            "type": "thresholds",
            "thresholdsGrid": [
              {
                "operator": "==",
                "thresholdValue": "1",
                "representation": "green"
              },
              {
                "operator": "==",
                "thresholdValue": "0",
                "representation": "redBright"
              },
              {
                "operator": "Default",
                "thresholdValue": null,
                "representation": "blue"
              }
            ]
          }
        }
      },
      "name": "Virtual WAN Regional Status and Hub Capacities (Gbps)"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "resources\r\n| where type =~ \"microsoft.network/virtualhubs\"\r\n| where properties.virtualWan.id =~ '{virtualWAN}'\r\n| project hubId = tolower(id), hubStatus = properties.provisioningState\r\n| join kind=leftouter (\r\nresources\r\n| where type =~ \"microsoft.network/vpngateways\"\r\n| project hubId = tolower(properties.virtualHub.id), vpnGWStatus = properties.provisioningState, vpnGWScaleUnit = properties.vpnGatewayScaleUnit\r\n) on hubId\r\n| join kind=leftouter (\r\nresources\r\n| where type =~ \"microsoft.network/p2svpngateways\"\r\n| project hubId = tolower(properties.virtualHub.id), p2sGWStatus = properties.provisioningState, p2sGWScaleUnit = properties.vpnGatewayScaleUnit\r\n) on hubId\r\n| join kind=leftouter (\r\nresources\r\n| where type =~ \"microsoft.network/expressroutegateways\"\r\n| project hubId = tolower(properties.virtualHub.id), erGWStatus = properties.provisioningState, erGWMinScaleUnit = properties.autoScaleConfiguration.bounds.min\r\n) on hubId\r\n| extend totalHubCapacityInGbps = (iff(isnotempty(vpnGWScaleUnit), vpnGWScaleUnit, 0) + iff(isnotempty(p2sGWScaleUnit), p2sGWScaleUnit, 0) + iff(isnotempty(erGWMinScaleUnit), 2 * erGWMinScaleUnit, 0))*0.5\r\n| project hubId, hubStatus, vpnGWStatus, vpnGWScaleUnit, p2sGWStatus, p2sGWScaleUnit, erGWStatus, erGWMinScaleUnit, totalHubCapacityInGbps",
        "size": 3,
        "title": "Hub level status and capacities without firewall",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "value::all"
        ],
        "visualization": "table",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "hubId",
              "formatter": 13,
              "formatOptions": {
                "linkTarget": "OpenBlade",
                "showIcon": true,
                "bladeOpenContext": {
                  "bladeName": "VirtualHubManagementViewModel",
                  "extensionName": "Microsoft_Azure_HybridNetworking",
                  "bladeParameters": [
                    {
                      "name": "virtualHubId",
                      "source": "cell",
                      "value": ""
                    }
                  ]
                }
              }
            },
            {
              "columnMatch": "hubStatus",
              "formatter": 1
            },
            {
              "columnMatch": "vpnGWStatus",
              "formatter": 1,
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal"
                },
                "emptyValCustomText": "-"
              }
            },
            {
              "columnMatch": "vpnGWScaleUnit",
              "formatter": 1,
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal"
                },
                "emptyValCustomText": "-"
              }
            },
            {
              "columnMatch": "p2sGWStatus",
              "formatter": 1,
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal"
                },
                "emptyValCustomText": "-"
              }
            },
            {
              "columnMatch": "p2sGWScaleUnit",
              "formatter": 1,
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal"
                },
                "emptyValCustomText": "-"
              }
            },
            {
              "columnMatch": "erGWStatus",
              "formatter": 1,
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal"
                },
                "emptyValCustomText": "-"
              }
            },
            {
              "columnMatch": "erGWMinScaleUnit",
              "formatter": 1,
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal"
                },
                "emptyValCustomText": "-"
              }
            },
            {
              "columnMatch": "totalHubCapacityInGbps",
              "formatter": 1,
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal"
                },
                "emptyValCustomText": "0"
              }
            }
          ],
          "labelSettings": [
            {
              "columnId": "hubId",
              "label": "Virtual Hub"
            },
            {
              "columnId": "hubStatus",
              "label": "Hub Deployment Status"
            },
            {
              "columnId": "vpnGWStatus",
              "label": "VPN Gateway Status"
            },
            {
              "columnId": "vpnGWScaleUnit",
              "label": "VPN Gateway Scale Units"
            },
            {
              "columnId": "p2sGWStatus",
              "label": "P2S Gateway Status"
            },
            {
              "columnId": "p2sGWScaleUnit",
              "label": "P2S Gateway Scale Units"
            },
            {
              "columnId": "erGWStatus",
              "label": "ER Gateway Status"
            },
            {
              "columnId": "erGWMinScaleUnit",
              "label": "ER Gateway Scale Units"
            },
            {
              "columnId": "totalHubCapacityInGbps",
              "label": "Provisioned Hub Capacity (Gbps)"
            }
          ]
        }
      },
      "conditionalVisibility": {
        "parameterName": "tab",
        "comparison": "isEqualTo",
        "value": "-1"
      },
      "name": "Hub level status and capacities without firewall"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "resources\r\n| where type =~ \"microsoft.network/virtualhubs\"\r\n| where properties.virtualWan.id =~ '{virtualWAN}'\r\n| project hubId = tolower(id), hubStatus = properties.provisioningState\r\n| join kind=leftouter (\r\nresources\r\n| where type =~ \"microsoft.network/vpngateways\"\r\n| project vpngwId = tolower(id), hubId = tolower(properties.virtualHub.id), vpnGWStatus = properties.provisioningState, vpnGWScaleUnit = properties.vpnGatewayScaleUnit\r\n) on hubId\r\n| project hubId, vpngwId",
        "size": 3,
        "title": "vpn gateway to hubs matching",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "value::all"
        ],
        "visualization": "table",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "hubId",
              "formatter": 13,
              "formatOptions": {
                "linkTarget": "OpenBlade",
                "showIcon": true,
                "bladeOpenContext": {
                  "bladeName": "VirtualHubManagementViewModel",
                  "extensionName": "Microsoft_Azure_HybridNetworking",
                  "bladeParameters": [
                    {
                      "name": "virtualHubId",
                      "source": "cell",
                      "value": ""
                    }
                  ]
                }
              }
            },
            {
              "columnMatch": "hubStatus",
              "formatter": 1
            },
            {
              "columnMatch": "vpnGWStatus",
              "formatter": 1,
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal"
                },
                "emptyValCustomText": "-"
              }
            },
            {
              "columnMatch": "vpnGWScaleUnit",
              "formatter": 1,
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal"
                },
                "emptyValCustomText": "-"
              }
            },
            {
              "columnMatch": "p2sGWStatus",
              "formatter": 1,
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal"
                },
                "emptyValCustomText": "-"
              }
            },
            {
              "columnMatch": "p2sGWScaleUnit",
              "formatter": 1,
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal"
                },
                "emptyValCustomText": "-"
              }
            },
            {
              "columnMatch": "erGWStatus",
              "formatter": 1,
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal"
                },
                "emptyValCustomText": "-"
              }
            },
            {
              "columnMatch": "erGWMinScaleUnit",
              "formatter": 1,
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal"
                },
                "emptyValCustomText": "-"
              }
            },
            {
              "columnMatch": "totalHubCapacityInGbps",
              "formatter": 1,
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal"
                },
                "emptyValCustomText": "0"
              }
            }
          ],
          "labelSettings": [
            {
              "columnId": "hubId",
              "label": "Virtual Hub"
            }
          ]
        }
      },
      "conditionalVisibility": {
        "parameterName": "tab",
        "comparison": "isEqualTo",
        "value": "-1"
      },
      "name": "vpn gateway to hubs matching"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "resources\r\n| where type =~ \"microsoft.network/virtualwans\" and id =~ '{virtualWAN}'\r\n| mv-expand virtualHub = properties.virtualHubs\r\n| project hubId = tolower(virtualHub.id)\r\n| join kind=inner (\r\nresources\r\n| where type =~ \"microsoft.network/azurefirewalls\"\r\n| project hubId = tolower(properties.virtualHub.id), firewallStatus = properties.provisioningState\r\n) on hubId\r\n| project hubId, firewallStatus",
        "size": 3,
        "title": "Firewall Status",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "value::all"
        ],
        "visualization": "table"
      },
      "conditionalVisibility": {
        "parameterName": "tab",
        "comparison": "isEqualTo",
        "value": "-1"
      },
      "name": "Firewall Status"
    },
    {
      "type": 10,
      "content": {
        "chartId": "workbook1b5f06fe-6eb8-4352-97f3-3e0da75b23b0",
        "version": "MetricsItem/2.0",
        "size": 0,
        "chartType": 0,
        "resourceType": "microsoft.network/vpngateways",
        "metricScope": 0,
        "resourceParameter": "vpnGateway",
        "resourceIds": [
          "{vpnGateway}"
        ],
        "timeContextFromParameter": "TimeRange",
        "timeContext": {
          "durationMs": 86400000
        },
        "metrics": [
          {
            "namespace": "microsoft.network/vpngateways",
            "metric": "microsoft.network/vpngateways-Traffic-AverageBandwidth",
            "aggregation": 4
          }
        ],
        "title": "Consumed capacity metric",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Subscription",
              "formatter": 5
            },
            {
              "columnMatch": "Name",
              "formatter": 13,
              "formatOptions": {
                "linkTarget": "Resource",
                "showIcon": true
              }
            },
            {
              "columnMatch": "microsoft.network/vpngateways-Traffic-AverageBandwidth",
              "formatter": 1,
              "numberFormat": {
                "unit": 11,
                "options": {
                  "style": "decimal"
                }
              }
            },
            {
              "columnMatch": "Timeline",
              "formatter": 9
            },
            {
              "columnMatch": "Metric",
              "formatter": 1
            },
            {
              "columnMatch": "Aggregation",
              "formatter": 5
            },
            {
              "columnMatch": "Value",
              "formatter": 1
            }
          ],
          "rowLimit": 10000,
          "labelSettings": [
            {
              "columnId": "microsoft.network/vpngateways-Traffic-AverageBandwidth",
              "label": "Gateway S2S Bandwidth (Average)"
            },
            {
              "columnId": "microsoft.network/vpngateways-Traffic-AverageBandwidth Timeline",
              "label": "Gateway S2S Bandwidth Timeline"
            }
          ]
        }
      },
      "conditionalVisibility": {
        "parameterName": "tab",
        "comparison": "isEqualTo",
        "value": "-1"
      },
      "name": "metric - 21"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"ea8985d5-4294-407e-946a-d4e030c8e066\",\"mergeType\":\"innerunique\",\"leftTable\":\"metric - 21\",\"rightTable\":\"vpn gateway to hubs matching\",\"leftColumn\":\"Name\",\"rightColumn\":\"vpngwId\"}],\"projectRename\":[{\"originalName\":\"[metric - 21].Subscription\",\"mergedName\":\"Subscription\",\"fromId\":\"ea8985d5-4294-407e-946a-d4e030c8e066\"},{\"originalName\":\"[metric - 21].Name\",\"mergedName\":\"VPN Gateway\",\"fromId\":\"ea8985d5-4294-407e-946a-d4e030c8e066\"},{\"originalName\":\"[metric - 21].microsoft.network/vpngateways-Traffic-AverageBandwidth\",\"mergedName\":\"Gateway S2S Bandwidth (Average)\",\"fromId\":\"ea8985d5-4294-407e-946a-d4e030c8e066\"},{\"originalName\":\"[metric - 21].microsoft.network/vpngateways-Traffic-AverageBandwidth Timeline\",\"mergedName\":\"Gateway S2S Bandwidth Timeline\",\"fromId\":\"ea8985d5-4294-407e-946a-d4e030c8e066\"},{\"originalName\":\"[vpn gateway to hubs matching].hubId\",\"mergedName\":\"Virtual Hub\",\"fromId\":\"ea8985d5-4294-407e-946a-d4e030c8e066\"},{\"originalName\":\"[vpn gateway to hubs matching].vpngwId\",\"mergedName\":\"vpngwId\",\"fromId\":\"ea8985d5-4294-407e-946a-d4e030c8e066\"},{\"originalName\":\"[metric - 21].Subscription\"},{\"originalName\":\"[metric - 21].microsoft.network/vpngateways-Traffic-AverageBandwidth Timeline\"}]}",
        "size": 0,
        "title": "Hub to VPN and Consumed cap",
        "exportToExcelOptions": "all",
        "queryType": 7,
        "visualization": "table",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Gateway S2S Bandwidth (Average)",
              "formatter": 0,
              "numberFormat": {
                "unit": 11,
                "options": {
                  "style": "decimal"
                }
              }
            }
          ]
        }
      },
      "conditionalVisibility": {
        "parameterName": "tab",
        "comparison": "isEqualTo",
        "value": "-1"
      },
      "name": "query - 23"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"ea8985d5-4294-407e-946a-d4e030c8e06f\",\"mergeType\":\"innerunique\",\"leftTable\":\"Hub level status and capacities without firewall\",\"rightTable\":\"query - 23\",\"leftColumn\":\"hubId\",\"rightColumn\":\"Virtual Hub\"}],\"projectRename\":[{\"originalName\":\"[Hub level status and capacities without firewall].hubId\",\"mergedName\":\"Virtual Hub\",\"fromId\":\"ea8985d5-4294-407e-946a-d4e030c8e06f\"},{\"originalName\":\"[query - 23].Gateway S2S Bandwidth (Average)\",\"mergedName\":\"Gateway S2S Bandwidth (Average)\",\"fromId\":\"ea8985d5-4294-407e-946a-d4e030c8e06f\"},{\"originalName\":\"[query - 23].VPN Gateway\"},{\"originalName\":\"[query - 23].Virtual Hub\"},{\"originalName\":\"[Hub level status and capacities without firewall].hubStatus\"},{\"originalName\":\"[Hub level status and capacities without firewall].vpnGWStatus\"},{\"originalName\":\"[Hub level status and capacities without firewall].vpnGWScaleUnit\"},{\"originalName\":\"[Hub level status and capacities without firewall].p2sGWStatus\"},{\"originalName\":\"[Hub level status and capacities without firewall].p2sGWScaleUnit\"},{\"originalName\":\"[Hub level status and capacities without firewall].erGWStatus\"},{\"originalName\":\"[Hub level status and capacities without firewall].erGWMinScaleUnit\"},{\"originalName\":\"[Hub level status and capacities without firewall].totalHubCapacityInGbps\"},{\"originalName\":\"[query - 23].vpngwId\"},{\"originalName\":\"[query - 23].Subscription\"},{\"originalName\":\"[query - 23].Gateway S2S Bandwidth Timeline\"}]}",
        "size": 0,
        "queryType": 7,
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Gateway S2S Bandwidth (Average)",
              "formatter": 0,
              "formatOptions": {
                "aggregation": "Sum"
              },
              "numberFormat": {
                "unit": 11,
                "options": {
                  "style": "decimal"
                }
              }
            },
            {
              "columnMatch": "vpngwId",
              "formatter": 0,
              "formatOptions": {
                "aggregation": "Unique"
              }
            }
          ],
          "hierarchySettings": {
            "treeType": 1,
            "groupBy": [
              "Virtual Hub"
            ],
            "expandTopLevel": true
          }
        }
      },
      "conditionalVisibility": {
        "parameterName": "tab",
        "comparison": "isEqualTo",
        "value": "-1"
      },
      "name": "query - 24"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"8a47059f-c364-47ed-b3ec-f2b15f063071\",\"mergeType\":\"leftouter\",\"leftTable\":\"Hub level status and capacities without firewall\",\"rightTable\":\"Firewall Status\",\"leftColumn\":\"hubId\",\"rightColumn\":\"hubId\"},{\"id\":\"ea8985d5-4294-407e-946a-d4e030c8e080\",\"mergeType\":\"innerunique\",\"leftTable\":\"Hub level status and capacities without firewall\",\"rightTable\":\"query - 24\",\"leftColumn\":\"hubId\",\"rightColumn\":\"Virtual Hub\"}],\"projectRename\":[{\"originalName\":\"[Hub level status and capacities without firewall].hubId\",\"mergedName\":\"Virtual Hub\",\"fromId\":\"8a47059f-c364-47ed-b3ec-f2b15f063071\"},{\"originalName\":\"[Hub level status and capacities without firewall].hubStatus\",\"mergedName\":\"Hub Deployment Status\",\"fromId\":\"8a47059f-c364-47ed-b3ec-f2b15f063071\"},{\"originalName\":\"[Hub level status and capacities without firewall].vpnGWStatus\",\"mergedName\":\"VPN Gateway Status\",\"fromId\":\"8a47059f-c364-47ed-b3ec-f2b15f063071\"},{\"originalName\":\"[Hub level status and capacities without firewall].vpnGWScaleUnit\",\"mergedName\":\"VPN Gateway Scale Units\",\"fromId\":\"8a47059f-c364-47ed-b3ec-f2b15f063071\"},{\"originalName\":\"[Hub level status and capacities without firewall].p2sGWStatus\",\"mergedName\":\"P2S Gateway Status\",\"fromId\":\"8a47059f-c364-47ed-b3ec-f2b15f063071\"},{\"originalName\":\"[Hub level status and capacities without firewall].p2sGWScaleUnit\",\"mergedName\":\"P2S Gateway Scale Units\",\"fromId\":\"8a47059f-c364-47ed-b3ec-f2b15f063071\"},{\"originalName\":\"[Hub level status and capacities without firewall].erGWStatus\",\"mergedName\":\"ER Gateway Status\",\"fromId\":\"8a47059f-c364-47ed-b3ec-f2b15f063071\"},{\"originalName\":\"[Hub level status and capacities without firewall].erGWMinScaleUnit\",\"mergedName\":\"ER Gateway Scale Units\",\"fromId\":\"8a47059f-c364-47ed-b3ec-f2b15f063071\"},{\"originalName\":\"[Firewall Status].firewallStatus\",\"mergedName\":\"firewallStatus\",\"fromId\":\"8a47059f-c364-47ed-b3ec-f2b15f063071\"},{\"originalName\":\"[Hub level status and capacities without firewall].totalHubCapacityInGbps\",\"mergedName\":\"Total Hub Capacity (Gbps)\",\"fromId\":\"8a47059f-c364-47ed-b3ec-f2b15f063071\"},{\"originalName\":\"[query - 24].Gateway S2S Bandwidth Timeline\",\"mergedName\":\"Gateway S2S Bandwidth Timeline\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 24].hubStatus\",\"mergedName\":\"hubStatus\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 24].vpnGWStatus\",\"mergedName\":\"vpnGWStatus\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 24].vpnGWScaleUnit\",\"mergedName\":\"vpnGWScaleUnit\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 24].p2sGWStatus\",\"mergedName\":\"p2sGWStatus\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 24].p2sGWScaleUnit\",\"mergedName\":\"p2sGWScaleUnit\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 24].erGWStatus\",\"mergedName\":\"erGWStatus\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 24].erGWMinScaleUnit\",\"mergedName\":\"erGWMinScaleUnit\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 24].totalHubCapacityInGbps\",\"mergedName\":\"totalHubCapacityInGbps\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 24].VPN Gateway\",\"mergedName\":\"VPN Gateway\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 24].vpngwId\",\"mergedName\":\"vpngwId\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 24].Gateway S2S Bandwidth (Average)\",\"mergedName\":\"Gateway S2S Bandwidth (Average)\",\"fromId\":\"ea8985d5-4294-407e-946a-d4e030c8e080\"},{\"originalName\":\"[Firewall Status].hubId\"},{\"originalName\":\"[query - 24].Virtual Hub\"},{\"originalName\":\"[query - 24].Subscription\"},{\"originalName\":\"[query - 24].hubId\"}]}",
        "size": 3,
        "title": "Virtual WAN Hub level Status and Capacities",
        "noDataMessage": "No virtual hubs found",
        "showExportToExcel": true,
        "queryType": 7,
        "visualization": "table",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Virtual Hub",
              "formatter": 13,
              "formatOptions": {
                "linkTarget": "OpenBlade",
                "showIcon": true,
                "bladeOpenContext": {
                  "bladeName": "VirtualHubManagementViewModel",
                  "extensionName": "Microsoft_Azure_HybridNetworking",
                  "bladeParameters": [
                    {
                      "name": "virtualHubId",
                      "source": "cell",
                      "value": ""
                    }
                  ]
                }
              }
            },
            {
              "columnMatch": "Hub Deployment Status",
              "formatter": 1
            },
            {
              "columnMatch": "VPN Gateway Status",
              "formatter": 1,
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal"
                },
                "emptyValCustomText": "-"
              }
            },
            {
              "columnMatch": "VPN Gateway Scale Units",
              "formatter": 1,
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal"
                },
                "emptyValCustomText": "-"
              }
            },
            {
              "columnMatch": "P2S Gateway Status",
              "formatter": 1,
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal"
                },
                "emptyValCustomText": "-"
              }
            },
            {
              "columnMatch": "P2S Gateway Scale Units",
              "formatter": 1,
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal"
                },
                "emptyValCustomText": "-"
              }
            },
            {
              "columnMatch": "ER Gateway Status",
              "formatter": 1,
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal"
                },
                "emptyValCustomText": "-"
              }
            },
            {
              "columnMatch": "ER Gateway Scale Units",
              "formatter": 1,
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal"
                },
                "emptyValCustomText": "-"
              }
            },
            {
              "columnMatch": "firewallStatus",
              "formatter": 1,
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal"
                },
                "emptyValCustomText": "-"
              }
            },
            {
              "columnMatch": "Gateway S2S Bandwidth (Average)",
              "formatter": 0,
              "numberFormat": {
                "unit": 11,
                "options": {
                  "style": "decimal"
                }
              }
            }
          ],
          "filter": true,
          "labelSettings": [
            {
              "columnId": "firewallStatus",
              "label": "Firewall Status"
            },
            {
              "columnId": "Total Hub Capacity (Gbps)",
              "label": "Provisioned Hub Capacity (Gbps)"
            },
            {
              "columnId": "Gateway S2S Bandwidth (Average)",
              "label": "Consumed Capacity"
            }
          ]
        }
      },
      "name": "Virtual WAN Hub level Status and Capacities"
    },
    {
      "type": 1,
      "content": {
        "json": "| **Configuration** | **Description** |\r\n| --- | --- |\r\n| Virtual WAN Hub Deployment Status | Diplays the Hub Vnet deployment status | \r\n| Virtual WAN VPN Gateway Deployment Status and Scale Units | Diplays VPN Gateway deployment status and provisioned capacity | \r\n| Virtual WAN P2S Gateway Deployment Status and Scale Units | Diplays P2S Gateway deployment status  and provisioned capacity | \r\n| Virtual WAN ER Gateway Deployment Status and Scale Units | Diplays ER Gateway deployment status and provisioned capacity | \r\n| Total Virtual WAN Hub Capcity | Is the total capacity in Gbps of each hub and it is derived by adding the capacities of all the gateways in the Virtual WAN hub (Gateway capacity is derived by # of gateway scale units * bandwidth of each scale unit in Gbps) | \r\n\r\n"
      },
      "name": "Hub level configuration help"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "links": [
          {
            "id": "971bc1ed-6323-4cb2-a0bb-7ee1e78e3c08",
            "cellValue": "tab",
            "linkTarget": "parameter",
            "linkLabel": "Hub Gateway Level Metrics",
            "subTarget": "0",
            "style": "link"
          },
          {
            "id": "0bdb654d-f48f-4d00-84e8-b2ccee5eebd0",
            "cellValue": "tab",
            "linkTarget": "parameter",
            "linkLabel": "S2S VPN Connection Metrics",
            "subTarget": "1",
            "style": "link"
          },
          {
            "id": "f9dbbe16-1452-4ad7-a6d1-0110641f23f2",
            "cellValue": "tab",
            "linkTarget": "parameter",
            "linkLabel": "P2S VPN Connection Metrics",
            "subTarget": "2",
            "style": "link"
          },
          {
            "id": "8623012d-d26b-409a-91d9-f25925a528c8",
            "cellValue": "tab",
            "linkTarget": "parameter",
            "linkLabel": "ER Circuit Metrics",
            "subTarget": "3",
            "style": "link"
          },
          {
            "id": "0941a955-9e11-44ac-8387-2a0d31d0c6e8",
            "cellValue": "tab",
            "linkTarget": "parameter",
            "linkLabel": "Metrics Help",
            "subTarget": "4",
            "style": "link"
          }
        ]
      },
      "name": "Tabs",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\r\n| where type =~ \"microsoft.network/virtualhubs\"\r\n| where properties.virtualWan.id =~ '{virtualWAN}'\r\n| project hubId = tolower(id), hubName=name, vnetConnectionCount = array_length(properties.virtualNetworkConnections)\r\n| join kind=leftouter (\r\nresources\r\n| where type =~ \"microsoft.network/vpngateways\"\r\n| project hubId = tolower(properties.virtualHub.id), vpnConnectionCount = array_length(properties.connections)\r\n) on hubId\r\n| join kind=leftouter (\r\nresources\r\n| where type =~ \"microsoft.network/p2svpngateways\"\r\n| project hubId = tolower(properties.virtualHub.id), p2sConnectionCount = array_length(properties.p2SConnectionConfigurations)\r\n) on hubId\r\n| join kind=leftouter (\r\nresources\r\n| where type =~ \"microsoft.network/expressroutegateways\"\r\n| project hubId = tolower(properties.virtualHub.id), erConnectionCount = array_length(properties.expressRouteConnections)\r\n) on hubId\r\n| extend vpnConnectionCount = iff(isnotempty(vpnConnectionCount), vpnConnectionCount, 0),\r\n         p2sConnectionCount = iff(isnotempty(p2sConnectionCount), p2sConnectionCount, 0),\r\n         erConnectionCount = iff(isnotempty(erConnectionCount), erConnectionCount, 0),\r\n         vnetConnectionCount = iff(isnotempty(vnetConnectionCount), vnetConnectionCount, 0)\r\n| project hubId, hubName, vpnConnectionCount, p2sConnectionCount, erConnectionCount\r\n",
              "size": 3,
              "title": "Virtual WAN Connection Counts",
              "noDataMessage": "No Connections found",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "value::all"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "hubId",
                    "formatter": 13,
                    "formatOptions": {
                      "linkTarget": "OpenBlade",
                      "showIcon": true,
                      "bladeOpenContext": {
                        "bladeName": "VirtualHubManagementViewModel",
                        "extensionName": "Microsoft_Azure_HybridNetworking",
                        "bladeParameters": [
                          {
                            "name": "virtualHubId",
                            "source": "cell",
                            "value": ""
                          }
                        ]
                      }
                    }
                  }
                ],
                "filter": true,
                "labelSettings": [
                  {
                    "columnId": "hubId",
                    "label": "Virtual Hub"
                  },
                  {
                    "columnId": "vpnConnectionCount",
                    "label": "VPN Connection Count"
                  },
                  {
                    "columnId": "p2sConnectionCount",
                    "label": "P2S Connection Configuration Count"
                  },
                  {
                    "columnId": "erConnectionCount",
                    "label": "ER Connection Count"
                  }
                ]
              },
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "Column1",
                  "formatter": 13,
                  "formatOptions": {
                    "linkTarget": null,
                    "showIcon": true
                  }
                },
                "leftContent": {
                  "columnMatch": "Column1",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                },
                "showBorder": false
              },
              "graphSettings": {
                "type": 0,
                "topContent": {
                  "columnMatch": "Column1",
                  "formatter": 1
                },
                "centerContent": {
                  "columnMatch": "Column2",
                  "formatter": 1,
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              },
              "mapSettings": {
                "locInfo": "AzureResource",
                "sizeSettings": "Column2",
                "sizeAggregation": "Sum",
                "legendMetric": "Column2",
                "legendAggregation": "Sum",
                "itemColorSettings": {
                  "type": "heatmap",
                  "colorAggregation": "Sum",
                  "nodeColorField": "Column2",
                  "heatmapPalette": "greenRed"
                },
                "locInfoColumn": "Column1"
              }
            },
            "conditionalVisibility": {
              "parameterName": "tab",
              "comparison": "isEqualTo",
              "value": "-1"
            },
            "name": "Virtual WAN Connection Counts"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":\"{{virtualHubQuery:escapejson}}\",\"headers\":[],\"method\":\"POST\",\"path\":\"/batch\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2020-06-01\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.responses[*].content.value\",\"columns\":[{\"path\":\"$.length\",\"columnid\":\"Vnet_Count\"},{\"path\":\"$[0].id\",\"columnid\":\"HubName\",\"substringRegexMatch\":\"(.*)/(.*)/(.*)/(.*).*\",\"substringReplace\":\"$2\"}]}}]}",
              "size": 0,
              "queryType": 12,
              "sortBy": []
            },
            "conditionalVisibility": {
              "parameterName": "tab",
              "comparison": "isEqualTo",
              "value": "-1"
            },
            "name": "Virtual WAN VNet Connection Count"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"f2aecb87-affc-469c-9818-c16135e3f1c3\",\"mergeType\":\"leftouter\",\"leftTable\":\"Virtual WAN Connection Counts\",\"rightTable\":\"Virtual WAN VNet Connection Count\",\"leftColumn\":\"hubName\",\"rightColumn\":\"HubName\"}],\"projectRename\":[{\"originalName\":\"[Virtual WAN Connection Counts].hubId\",\"mergedName\":\"Virtual Hub\",\"fromId\":\"f2aecb87-affc-469c-9818-c16135e3f1c3\"},{\"originalName\":\"[Virtual WAN Connection Counts].vpnConnectionCount\",\"mergedName\":\"VPN Connection Count\",\"fromId\":\"f2aecb87-affc-469c-9818-c16135e3f1c3\"},{\"originalName\":\"[Virtual WAN Connection Counts].p2sConnectionCount\",\"mergedName\":\"P2S Connection Configuration Count\",\"fromId\":\"f2aecb87-affc-469c-9818-c16135e3f1c3\"},{\"originalName\":\"[Virtual WAN Connection Counts].erConnectionCount\",\"mergedName\":\"ER Connection Count\",\"fromId\":\"f2aecb87-affc-469c-9818-c16135e3f1c3\"},{\"originalName\":\"[Virtual WAN VNet Connection Count].Vnet_Count\",\"mergedName\":\"Virtual Network Connection Count\",\"fromId\":\"f2aecb87-affc-469c-9818-c16135e3f1c3\"},{\"originalName\":\"[Virtual WAN VNet Connection Count].HubName\",\"mergedName\":\"HubName\",\"fromId\":\"f2aecb87-affc-469c-9818-c16135e3f1c3\"},{\"originalName\":\"[Total Connection Count]\",\"mergedName\":\"Total Connection Count\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"[\\\"Virtual Network Connection Count\\\"] + [\\\"VPN Connection Count\\\"] + [\\\"P2S Connection Configuration Count\\\"] + [\\\"ER Connection Count\\\"]\"}}]},{\"originalName\":\"[Virtual WAN Connection Counts].hubName\"}]}",
              "size": 0,
              "queryType": 7,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Virtual Network Connection Count",
                    "formatter": 0,
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal"
                      },
                      "emptyValCustomText": "0"
                    }
                  },
                  {
                    "columnMatch": "HubName",
                    "formatter": 5
                  }
                ]
              }
            },
            "conditionalVisibility": {
              "parameterName": "tab",
              "comparison": "isEqualTo",
              "value": "0"
            },
            "name": "Virtual VWan Connections"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "tab",
        "comparison": "isEqualTo",
        "value": "0"
      },
      "name": "Hub Gateway Level Metrics Group"
    },
    {
      "type": 10,
      "content": {
        "chartId": "workbookfab00c1e-9879-4ac8-a6bd-921ec030e971",
        "version": "MetricsItem/2.0",
        "size": 0,
        "chartType": 2,
        "resourceType": "microsoft.network/vpngateways",
        "metricScope": 0,
        "resourceParameter": "vpnGateway",
        "resourceIds": [
          "{vpnGateway}"
        ],
        "timeContextFromParameter": "TimeRange",
        "timeContext": {
          "durationMs": 86400000
        },
        "metrics": [
          {
            "namespace": "microsoft.network/vpngateways",
            "metric": "microsoft.network/vpngateways--AverageBandwidth",
            "aggregation": 4,
            "splitBy": null,
            "columnName": ""
          }
        ],
        "title": "S2S Gateway Average Bandwidth",
        "gridFormatType": 1,
        "tileSettings": {
          "showBorder": false,
          "titleContent": {
            "columnMatch": "Name",
            "formatter": 13
          },
          "leftContent": {
            "columnMatch": "Value",
            "formatter": 12,
            "formatOptions": {
              "palette": "auto"
            },
            "numberFormat": {
              "unit": 17,
              "options": {
                "maximumSignificantDigits": 3,
                "maximumFractionDigits": 2
              }
            }
          }
        },
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Subscription",
              "formatter": 5
            },
            {
              "columnMatch": "Name",
              "formatter": 13,
              "formatOptions": {
                "linkTarget": "Resource"
              }
            },
            {
              "columnMatch": "microsoft.network/vpngateways--AverageBandwidth Timeline",
              "formatter": 5
            },
            {
              "columnMatch": "microsoft.network/vpngateways--AverageBandwidth",
              "formatter": 1,
              "numberFormat": {
                "unit": 11,
                "options": null
              }
            },
            {
              "columnMatch": "Metric",
              "formatter": 1
            },
            {
              "columnMatch": "Aggregation",
              "formatter": 5
            },
            {
              "columnMatch": "Value",
              "formatter": 1
            },
            {
              "columnMatch": "Timeline",
              "formatter": 9
            }
          ],
          "rowLimit": 10000,
          "labelSettings": [
            {
              "columnId": "Name",
              "label": "VPN Gateway"
            },
            {
              "columnId": "Segment Field",
              "label": "Dimension"
            },
            {
              "columnId": "Segment",
              "label": "Connected Site"
            }
          ]
        }
      },
      "conditionalVisibility": {
        "parameterName": "tab",
        "comparison": "isEqualTo",
        "value": "0"
      },
      "name": "S2S Gateway Average Bandwidth"
    },
    {
      "type": 10,
      "content": {
        "chartId": "workbook38465d76-17f3-4aea-97a0-d40632360f8a",
        "version": "MetricsItem/2.0",
        "size": 0,
        "chartType": 2,
        "resourceType": "microsoft.network/p2svpngateways",
        "metricScope": 0,
        "resourceParameter": "p2SVpnGateway",
        "resourceIds": [
          "{p2SVpnGateway}"
        ],
        "timeContextFromParameter": "TimeRange",
        "timeContext": {
          "durationMs": 86400000
        },
        "metrics": [
          {
            "namespace": "microsoft.network/p2svpngateways",
            "metric": "microsoft.network/p2svpngateways--P2SBandwidth",
            "aggregation": 4,
            "splitBy": null
          }
        ],
        "title": "P2S Gateway Average Bandwidth",
        "gridSettings": {
          "rowLimit": 10000
        }
      },
      "conditionalVisibility": {
        "parameterName": "tab",
        "comparison": "isEqualTo",
        "value": "0"
      },
      "name": "P2S Gateway Average Bandwidth"
    },
    {
      "type": 10,
      "content": {
        "chartId": "workbook3c4076dd-62ef-4563-8fec-3bd9f96075ab",
        "version": "MetricsItem/2.0",
        "size": 0,
        "chartType": 2,
        "resourceType": "microsoft.network/expressroutegateways",
        "metricScope": 0,
        "resourceParameter": "expressRouteGateway",
        "resourceIds": [
          "{expressRouteGateway}"
        ],
        "timeContextFromParameter": "TimeRange",
        "timeContext": {
          "durationMs": 86400000
        },
        "metrics": [
          {
            "namespace": "microsoft.network/expressroutegateways",
            "metric": "microsoft.network/expressroutegateways-Traffic-ErGatewayConnectionBitsInPerSecond",
            "aggregation": 4,
            "splitBy": null
          }
        ],
        "title": "Express Route Gateway BitsInPerSecond",
        "gridSettings": {
          "rowLimit": 10000
        }
      },
      "conditionalVisibility": {
        "parameterName": "tab",
        "comparison": "isEqualTo",
        "value": "0"
      },
      "name": "Express Route Gateway BitsInPerSecond"
    },
    {
      "type": 10,
      "content": {
        "chartId": "workbook3c4076dd-62ef-4563-8fec-3bd9f96075ab",
        "version": "MetricsItem/2.0",
        "size": 0,
        "chartType": 2,
        "resourceType": "microsoft.network/expressroutegateways",
        "metricScope": 0,
        "resourceParameter": "expressRouteGateway",
        "resourceIds": [
          "{expressRouteGateway}"
        ],
        "timeContextFromParameter": "TimeRange",
        "timeContext": {
          "durationMs": 86400000
        },
        "metrics": [
          {
            "namespace": "microsoft.network/expressroutegateways",
            "metric": "microsoft.network/expressroutegateways-Traffic-ErGatewayConnectionBitsOutPerSecond",
            "aggregation": 4,
            "splitBy": null
          }
        ],
        "title": "Express Route Gateway BitsOutPerSecond",
        "gridSettings": {
          "rowLimit": 10000
        }
      },
      "conditionalVisibility": {
        "parameterName": "tab",
        "comparison": "isEqualTo",
        "value": "0"
      },
      "name": "Express Route Gateway BitsOutPerSecond"
    },
    {
      "type": 10,
      "content": {
        "chartId": "workbook8075a021-5aa5-4148-9429-bb6e749e5752",
        "version": "MetricsItem/2.0",
        "size": 0,
        "chartType": 2,
        "resourceType": "microsoft.network/azurefirewalls",
        "metricScope": 0,
        "resourceParameter": "azureFirewall",
        "resourceIds": [
          "{azureFirewall}"
        ],
        "timeContextFromParameter": "TimeRange",
        "timeContext": {
          "durationMs": 86400000
        },
        "metrics": [
          {
            "namespace": "microsoft.network/azurefirewalls",
            "metric": "microsoft.network/azurefirewalls--DataProcessed",
            "aggregation": 1,
            "splitBy": null
          }
        ],
        "title": "Firewall Total Data Processed",
        "gridSettings": {
          "rowLimit": 10000
        }
      },
      "conditionalVisibility": {
        "parameterName": "tab",
        "comparison": "isEqualTo",
        "value": "0"
      },
      "name": "Firewall Total Data Processed"
    },
    {
      "type": 10,
      "content": {
        "chartId": "workbook85ce8310-a9a1-4640-ae00-03845fe8f7f5",
        "version": "MetricsItem/2.0",
        "size": 2,
        "chartType": 0,
        "resourceType": "microsoft.network/vpngateways",
        "metricScope": 0,
        "resourceParameter": "vpnGateway",
        "resourceIds": [
          "{vpnGateway}"
        ],
        "timeContextFromParameter": "TimeRange",
        "timeContext": {
          "durationMs": 86400000
        },
        "metrics": [
          {
            "namespace": "microsoft.network/vpngateways",
            "metric": "microsoft.network/vpngateways--TunnelAverageBandwidth",
            "aggregation": 4,
            "splitBy": "ConnectionName",
            "splitBySortOrder": 2,
            "splitByLimit": 5
          },
          {
            "namespace": "microsoft.network/vpngateways",
            "metric": "microsoft.network/vpngateways--TunnelEgressBytes",
            "aggregation": 1,
            "splitBy": "ConnectionName",
            "splitBySortOrder": 2,
            "splitByLimit": 5
          },
          {
            "namespace": "microsoft.network/vpngateways",
            "metric": "microsoft.network/vpngateways--TunnelIngressBytes",
            "aggregation": 1,
            "splitBy": "ConnectionName",
            "splitBySortOrder": 2,
            "splitByLimit": 5
          },
          {
            "namespace": "microsoft.network/vpngateways",
            "metric": "microsoft.network/vpngateways--TunnelEgressPacketDropTSMismatch",
            "aggregation": 1,
            "splitBy": "ConnectionName",
            "splitBySortOrder": 2,
            "splitByLimit": 5
          },
          {
            "namespace": "microsoft.network/vpngateways",
            "metric": "microsoft.network/vpngateways--TunnelEgressPackets",
            "aggregation": 1,
            "splitBy": "ConnectionName",
            "splitBySortOrder": 2,
            "splitByLimit": 5
          },
          {
            "namespace": "microsoft.network/vpngateways",
            "metric": "microsoft.network/vpngateways--TunnelIngressPackets",
            "aggregation": 1,
            "splitBy": "ConnectionName",
            "splitBySortOrder": 2,
            "splitByLimit": 5
          },
          {
            "namespace": "microsoft.network/vpngateways",
            "metric": "microsoft.network/vpngateways--TunnelIngressPacketDropTSMismatch",
            "aggregation": 1,
            "splitBy": "ConnectionName",
            "splitBySortOrder": 2,
            "splitByLimit": 5
          }
        ],
        "title": "VPN Connection Level Metrics",
        "gridFormatType": 1,
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Subscription",
              "formatter": 5
            },
            {
              "columnMatch": "Name",
              "formatter": 13,
              "formatOptions": {
                "linkTarget": "Resource",
                "showIcon": true
              }
            },
            {
              "columnMatch": "Metric",
              "formatter": 1
            },
            {
              "columnMatch": "Aggregation",
              "formatter": 5
            },
            {
              "columnMatch": "Segment",
              "formatter": 5
            },
            {
              "columnMatch": "Value",
              "formatter": 1
            },
            {
              "columnMatch": "Timeline",
              "formatter": 9,
              "formatOptions": {
                "palette": "blue"
              }
            },
            {
              "columnMatch": "microsoft.network/vpngateways--TunnelAverageBandwidth Timeline",
              "formatter": 5
            },
            {
              "columnMatch": "microsoft.network/vpngateways--TunnelAverageBandwidth",
              "formatter": 1,
              "numberFormat": {
                "unit": 11,
                "options": null
              }
            },
            {
              "columnMatch": "microsoft.network/vpngateways--TunnelEgressBytes Timeline",
              "formatter": 5
            },
            {
              "columnMatch": "microsoft.network/vpngateways--TunnelEgressBytes",
              "formatter": 1,
              "numberFormat": {
                "unit": 2,
                "options": null
              }
            },
            {
              "columnMatch": "microsoft.network/vpngateways--TunnelIngressBytes Timeline",
              "formatter": 5
            },
            {
              "columnMatch": "microsoft.network/vpngateways--TunnelIngressBytes",
              "formatter": 1,
              "numberFormat": {
                "unit": 2,
                "options": null
              }
            },
            {
              "columnMatch": "microsoft.network/vpngateways--TunnelEgressPacketDropTSMismatch Timeline",
              "formatter": 5
            },
            {
              "columnMatch": "microsoft.network/vpngateways--TunnelEgressPacketDropTSMismatch",
              "formatter": 1,
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal"
                }
              }
            }
          ],
          "rowLimit": 10000,
          "filter": true,
          "hierarchySettings": {
            "treeType": 1,
            "groupBy": [
              "Segment"
            ],
            "expandTopLevel": true
          },
          "labelSettings": [
            {
              "columnId": "Name",
              "label": "VPN Gateway"
            },
            {
              "columnId": "Segment Field",
              "label": "Dimension"
            },
            {
              "columnId": "Segment",
              "label": "Connected Site"
            }
          ]
        }
      },
      "conditionalVisibility": {
        "parameterName": "tab",
        "comparison": "isEqualTo",
        "value": "1"
      },
      "name": "VPN Connection Level Metrics"
    },
    {
      "type": 10,
      "content": {
        "chartId": "workbookf9dbfd5e-505e-4205-b8bd-7bc6f3e4c7ac",
        "version": "MetricsItem/2.0",
        "size": 0,
        "chartType": 2,
        "resourceType": "microsoft.network/p2svpngateways",
        "metricScope": 0,
        "resourceParameter": "p2SVpnGateway",
        "resourceIds": [
          "{p2SVpnGateway}"
        ],
        "timeContextFromParameter": "TimeRange",
        "timeContext": {
          "durationMs": 86400000
        },
        "metrics": [
          {
            "namespace": "microsoft.network/p2svpngateways",
            "metric": "microsoft.network/p2svpngateways--P2SConnectionCount",
            "aggregation": 3,
            "splitBy": "Protocol"
          }
        ],
        "title": "P2S VPN Connection Count (by Protocol)",
        "gridSettings": {
          "rowLimit": 10000
        }
      },
      "conditionalVisibility": {
        "parameterName": "tab",
        "comparison": "isEqualTo",
        "value": "2"
      },
      "name": "P2S VPN Connection Count (by Protocol)"
    },
    {
      "type": 10,
      "content": {
        "chartId": "workbook5dc336f1-f542-4ea6-b758-a0de0c0909e9",
        "version": "MetricsItem/2.0",
        "size": 0,
        "chartType": 2,
        "resourceType": "microsoft.network/expressroutecircuits",
        "metricScope": 0,
        "resourceParameter": "erCircuits",
        "resourceIds": [
          "{erCircuits}"
        ],
        "timeContextFromParameter": "TimeRange",
        "timeContext": {
          "durationMs": 86400000
        },
        "metrics": [
          {
            "namespace": "microsoft.network/expressroutecircuits",
            "metric": "microsoft.network/expressroutecircuits-Traffic-BitsInPerSecond",
            "aggregation": 4,
            "splitBy": null
          }
        ],
        "title": "ExpressRoute Circuit BitsInPerSecond",
        "gridSettings": {
          "rowLimit": 10000
        }
      },
      "conditionalVisibility": {
        "parameterName": "tab",
        "comparison": "isEqualTo",
        "value": "3"
      },
      "name": "ExpressRoute Circuit BitsInPerSecond"
    },
    {
      "type": 10,
      "content": {
        "chartId": "workbook5dc336f1-f542-4ea6-b758-a0de0c0909e9",
        "version": "MetricsItem/2.0",
        "size": 0,
        "chartType": 2,
        "resourceType": "microsoft.network/expressroutecircuits",
        "metricScope": 0,
        "resourceParameter": "erCircuits",
        "resourceIds": [
          "{erCircuits}"
        ],
        "timeContextFromParameter": "TimeRange",
        "timeContext": {
          "durationMs": 86400000
        },
        "metrics": [
          {
            "namespace": "microsoft.network/expressroutecircuits",
            "metric": "microsoft.network/expressroutecircuits-Traffic-BitsOutPerSecond",
            "aggregation": 4,
            "splitBy": null
          }
        ],
        "title": "ExpressRoute Circuit BitsOutPerSecond",
        "gridSettings": {
          "rowLimit": 10000
        }
      },
      "conditionalVisibility": {
        "parameterName": "tab",
        "comparison": "isEqualTo",
        "value": "3"
      },
      "name": "ExpressRoute Circuit BitsOutPerSecond"
    },
    {
      "type": 10,
      "content": {
        "chartId": "workbook5dc336f1-f542-4ea6-b758-a0de0c0909e9",
        "version": "MetricsItem/2.0",
        "size": 0,
        "chartType": 2,
        "resourceType": "microsoft.network/expressroutecircuits",
        "metricScope": 0,
        "resourceParameter": "erCircuits",
        "resourceIds": [
          "{erCircuits}"
        ],
        "timeContextFromParameter": "TimeRange",
        "timeContext": {
          "durationMs": 86400000
        },
        "metrics": [
          {
            "namespace": "microsoft.network/expressroutecircuits",
            "metric": "microsoft.network/expressroutecircuits-Traffic-QosDropBitsInPerSecond",
            "aggregation": 4,
            "splitBy": null
          }
        ],
        "title": "ExpressRoute Circuit DroppedInBitsPerSecond",
        "gridSettings": {
          "rowLimit": 10000
        }
      },
      "conditionalVisibility": {
        "parameterName": "tab",
        "comparison": "isEqualTo",
        "value": "3"
      },
      "name": "ExpressRoute Circuit DroppedInBitsPerSecond"
    },
    {
      "type": 10,
      "content": {
        "chartId": "workbook5dc336f1-f542-4ea6-b758-a0de0c0909e9",
        "version": "MetricsItem/2.0",
        "size": 0,
        "chartType": 2,
        "resourceType": "microsoft.network/expressroutecircuits",
        "metricScope": 0,
        "resourceParameter": "erCircuits",
        "resourceIds": [
          "{erCircuits}"
        ],
        "timeContextFromParameter": "TimeRange",
        "timeContext": {
          "durationMs": 86400000
        },
        "metrics": [
          {
            "namespace": "microsoft.network/expressroutecircuits",
            "metric": "microsoft.network/expressroutecircuits-Traffic-QosDropBitsOutPerSecond",
            "aggregation": 4,
            "splitBy": null
          }
        ],
        "title": "ExpressRoute Circuit DroppedOutBitsPerSecond",
        "gridSettings": {
          "rowLimit": 10000
        }
      },
      "conditionalVisibility": {
        "parameterName": "tab",
        "comparison": "isEqualTo",
        "value": "3"
      },
      "name": "ExpressRoute Circuit DroppedOutBitsPerSecond"
    },
    {
      "type": 1,
      "content": {
        "json": "\r\n## Hub Gateway Level Metrics\r\n| **Metric** | **Description** |\r\n| --- | --- |\r\n|Virtual WAN Connection Counts| Displays the total number of Virtual WAN Connections of type VPN, P2S, ER and Vnet|\r\n|S2S Gateway Average Bandwidth| Average site-to-site aggregate bandwidth of a gateway in bytes per second|\r\n|P2S Gateway Average Bandwidth| Average point-to-site aggregate bandwidth of a gateway in bytes per second|\r\n|Express Route Gateway BitsInPerSecond| Bits ingressing Azure per second|\r\n|Express Route Gateway BitsOutPerSecond| Bits egressing Azure per second|\r\n|Firewall Total Data Processed|Total Data Processed by Azure Firewall in Virtual Hub|\r\n\r\n## S2S VPN Connection Metrics\r\n| **Metric** | **Description** |\r\n| --- | --- |\r\n|Tunnel Bandwidth| Average bandwidth of a tunnel in bytes per second|\r\n|Tunnel Egress Bytes| Outgoing bytes of a tunnel|\r\n|Tunnel Egress Packets| Outgoing packet count of a tunnel|\r\n|Tunnel Egress TS Mismatch Packet Drop| Outgoing packet drop count from traffic selector mismatch of a tunnel|\r\n|Tunnel Ingress Bytes| Incoming bytes of a tunnel|\r\n|Tunnel Ingress Packet| Incoming packet count of a tunnel|\r\n|Tunnel Ingress TS Mismatch Packet Drop| Incoming packet drop count from traffic selector mismatch of a tunnel|\r\n\r\n## P2S VPN Connection Metrics\r\n| **Metric** | **Description** |\r\n| --- | --- |\r\n|P2S Connection Count| Point-to-site connection count of a gateway|\r\n\r\n## ER Circuit Metrics\r\n| **Metric** | **Description** |\r\n| --- | --- |\r\n|ExpressRoute Circuit BitsInPerSecond| Bits ingressing Azure per second|\r\n|ExpressRoute Circuit BitsOutPerSecond| Bits egressing Azure per second|"
      },
      "conditionalVisibility": {
        "parameterName": "tab",
        "comparison": "isEqualTo",
        "value": "4"
      },
      "name": "text - 17"
    }
  ],
  "fallbackResourceIds": [
    "Azure Monitor"
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}
