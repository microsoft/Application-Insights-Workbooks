{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "448a29bd-9c86-4cc9-b114-e89eb4532388",
            "version": "KqlParameterItem/1.0",
            "name": "qdsStartTime",
            "type": 1,
            "isRequired": true,
            "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"union\\r\\n(\\r\\n// The most recent interval that is earlier than the end of time range.\\r\\n// This may be earlier than the start of time range by at most 2h.\\r\\nsqldb_single_database_query_runtime_stats\\r\\n| where interval_start_time between (({timeRange:start} - 2h) .. {timeRange:end})\\r\\n| where logical_server_name =~ @\\\"{serverName}\\\"\\r\\n| where database_name == @\\\"{databaseName}\\\"\\r\\n| summarize interval_start_time = max(interval_start_time)\\r\\n),\\r\\n(\\r\\n// earliest interval start within time range\\r\\nsqldb_single_database_query_runtime_stats\\r\\n| where interval_end_time >= {timeRange:start} and interval_start_time <= {timeRange:end}\\r\\n| where logical_server_name =~ @\\\"{serverName}\\\"\\r\\n| where database_name == @\\\"{databaseName}\\\"\\r\\n| summarize interval_start_time = min(interval_start_time)\\r\\n)\\r\\n// return the earliest of these times as start of QDS range\\r\\n// if there isn't a complete QDS interval within time range, this will show the most recent available interval outside of the range\\r\\n| summarize qds_start_time = min(interval_start_time)\\r\\n\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
            "isHiddenWhenLocked": true,
            "queryType": 9
          },
          {
            "id": "19a73be4-a8a4-43ee-9b97-828f23b34f80",
            "version": "KqlParameterItem/1.0",
            "name": "qdsEndTime",
            "type": 1,
            "isRequired": true,
            "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"union\\r\\n(\\r\\n// The most recent interval that is earlier than the end of time range.\\r\\n// This may be earlier than the start of time range by at most 2h.\\r\\nsqldb_single_database_query_runtime_stats\\r\\n| where interval_end_time between (({timeRange:start} - 2h) .. {timeRange:end})\\r\\n| where logical_server_name =~ @\\\"{serverName}\\\"\\r\\n| where database_name == @\\\"{databaseName}\\\"\\r\\n| summarize interval_end_time = max(interval_end_time)\\r\\n),\\r\\n(\\r\\n// latest interval end within time range\\r\\nsqldb_single_database_query_runtime_stats\\r\\n| where interval_end_time >= {timeRange:start} and interval_start_time <= {timeRange:end}\\r\\n| where logical_server_name =~ @\\\"{serverName}\\\"\\r\\n| where database_name == @\\\"{databaseName}\\\"\\r\\n| summarize interval_end_time = max(interval_end_time)\\r\\n)\\r\\n// return the latest of these times as end of QDS range\\r\\n// if there isn't a complete QDS interval within time range, this will show the latest available interval\\r\\n| summarize qds_end_time = datetime_add(\\\"second\\\", 1, max(interval_end_time)) // make-series treats the end of interval as not inclusive, fudge by 1 second\\r\\n\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
            "isHiddenWhenLocked": true,
            "queryType": 9
          },
          {
            "version": "KqlParameterItem/1.0",
            "name": "qdsCollectionReplicaType",
            "type": 1,
            "isRequired": true,
            "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"// QDS data may be collected on the primary or on its secondary HA replica.\\r\\n// QDS data collection from geo and named replicas is blocked to avoid associating query workload from the primary with the server/database name of a geo or named secondary.\\r\\n// If QDS data is collected from both primary and HA secondary, KQL queries must be restricted to data from either primary or HA secondary to avoid wrong results from querying duplicate data.\\r\\n// This parameter determines the replica type to use in that filter.\\r\\n// HA secondary is used only if all data within the interval is from HA secondary. Otherwise, primary is used.\\r\\nsqldb_single_database_query_runtime_stats\\r\\n| where interval_start_time >= todatetime(\\\"{qdsStartTime}\\\") and interval_end_time <= todatetime(\\\"{qdsEndTime}\\\")\\r\\n| where logical_server_name =~ @\\\"{serverName}\\\"\\r\\n| where database_name == @\\\"{databaseName}\\\"\\r\\n| summarize count_from_ha_secondary = countif(replica_type == \\\"HA secondary\\\"),\\r\\n            count_from_primary = countif(replica_type == \\\"Primary\\\")\\r\\n| project replica_type = iif(count_from_ha_secondary > 0 and count_from_primary == 0, \\\"HA secondary\\\", \\\"Primary\\\")\\r\\n\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
            "isHiddenWhenLocked": true,
            "queryType": 9,
            "id": "597f2e25-7cb4-416e-aaa8-d156dccd25b4"
          }
        ],
        "style": "above",
        "queryType": 9
      },
      "name": "top_query_qds_time_parameters"
    },
    {
      "type": 1,
      "content": {
        "json": "A top query is defined as a query consuming the most resources in a time interval. Resource consumption is reflected by metrics such as _execution count_, _CPU time_, _duration_, _logical reads_, etc. For each top query, choosing an aggregation type lets you see its _total_, _average_, _minimum_, or _maximum_ resource consumption within the selected time interval.\r\n\r\nQuery Store aggregates and stores data using fixed time intervals. Query statistics are collected and displayed for complete intervals only. Because of this, top query data may be delayed. For example, if Query Store interval length is one hour (which is the default configuration), then it will take at least one hour for the most recent query data to become available.\r\n\r\nTop query data is obtained from [Query Store](https://go.microsoft.com/fwlink/?linkid=2213253), using [sys.query_store_query](https://go.microsoft.com/fwlink/?linkid=2213428), [sys.query_store_query_text](https://go.microsoft.com/fwlink/?linkid=2213154), [sys.query_store_plan](https://go.microsoft.com/fwlink/?linkid=2213251), [sys.query_store_runtime_stats](https://go.microsoft.com/fwlink/?linkid=2213252), [sys.query_store_wait_stats](https://go.microsoft.com/fwlink/?linkid=2213155), and other views."
      },
      "conditionalVisibilities": [
        {
          "parameterName": "showDescriptions",
          "comparison": "isEqualTo",
          "value": "true"
        },
        {
          "parameterName": "qdsStartTime",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsEndTime",
          "comparison": "isNotEqualTo"
        }
      ],
      "name": "qds_help"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "7d626640-0324-4fe2-ace6-65b0fa6db0ef",
            "version": "KqlParameterItem/1.0",
            "name": "qdsAggBy",
            "label": "Aggregate by",
            "type": 10,
            "description": "Select the level of aggregation. Use \"Query/plan hash\" to aggregate statistics for similar queries and query plans across all databases. Use \"Query/plan ID\" to aggregate statistics by individual queries and plans within each database.",
            "isRequired": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[\r\n    {\"value\":\"query_hash\",\"label\":\"Query/plan hash\"},\r\n    {\"value\":\"query_id\",\"label\":\"Query/plan ID\"}\r\n]",
            "timeContext": {
              "durationMs": 86400000
            },
            "value": "query_hash"
          },
          {
            "id": "e7bd7068-660b-41bd-894d-b6008ac6e4ca",
            "version": "KqlParameterItem/1.0",
            "name": "qdsAggregation",
            "label": "Aggregation",
            "type": 2,
            "description": "Select the type of aggregation to use for query runtime statistics",
            "isRequired": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[\r\n    {\"value\":\"total\",\"label\":\"Total\"},\r\n    {\"value\":\"avg\",\"label\":\"Average\"},\r\n    {\"value\":\"max\",\"label\":\"Maximum\"},\r\n    {\"value\":\"min\",\"label\":\"Minimum\"},\r\n    {\"value\":\"stdev\",\"label\":\"Standard deviation\"}\r\n]",
            "timeContext": {
              "durationMs": 86400000
            },
            "value": "total"
          },
          {
            "id": "d78e016e-7f9c-4ddb-be50-9cc3317387b6",
            "version": "KqlParameterItem/1.0",
            "name": "qdsMetric",
            "label": "Metric",
            "type": 2,
            "description": "Find top queries sorting by selected metric in descending order",
            "isRequired": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[\r\n    {\"value\":\"count_executions\",\"label\":\"Execution count\"},\r\n    {\"value\":\"duration\",\"label\":\"Duration\"},\r\n    {\"value\":\"cpu_time\",\"label\":\"CPU time\"},\r\n    {\"value\":\"logical_io_reads\",\"label\":\"Logical reads\"},\r\n    {\"value\":\"logical_io_writes\",\"label\":\"Logical writes\"},\r\n    {\"value\":\"physical_io_reads\",\"label\":\"Physical reads (pages)\"},\r\n    {\"value\":\"num_physical_io_reads\",\"label\":\"Physical reads (IOs)\"},\r\n    {\"value\":\"clr_time\",\"label\":\"CLR time\"},\r\n    {\"value\":\"dop\",\"label\":\"DOP\"},\r\n    {\"value\":\"query_max_used_memory\",\"label\":\"Memory grant\"},\r\n    {\"value\":\"rowcount\",\"label\":\"Row count\"},\r\n    {\"value\":\"log_bytes_used\",\"label\":\"Transaction log space used\"},\r\n    {\"value\":\"tempdb_space_used\",\"label\":\"Tempdb space used\"},\r\n    {\"value\":\"page_server_io_reads\",\"label\":\"Page server reads (pages)\"}\r\n]",
            "timeContext": {
              "durationMs": 86400000
            },
            "value": "cpu_time"
          },
          {
            "id": "45b94f24-7a79-4941-9036-2578462ffc96",
            "version": "KqlParameterItem/1.0",
            "name": "qdsTopQueryCount",
            "label": "Top query limit",
            "type": 2,
            "description": "The number of top queries to display",
            "isRequired": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[\r\n    {\"value\":5,\"label\":\"5\"},\r\n    {\"value\":10,\"label\":\"10\"},\r\n    {\"value\":25,\"label\":\"25\"},\r\n    {\"value\":50,\"label\":\"50\"},\r\n    {\"value\":100,\"label\":\"100\"},\r\n    {\"value\":200,\"label\":\"200\"}\r\n]",
            "timeContext": {
              "durationMs": 86400000
            },
            "value": "10"
          },
          {
            "id": "2c8e60d0-a395-4aa6-aeba-1d2c39195c3c",
            "version": "KqlParameterItem/1.0",
            "name": "qdsExecutionType",
            "label": "Execution types",
            "type": 2,
            "description": "Select one or more query execution types",
            "isRequired": true,
            "multiSelect": true,
            "quote": "",
            "delimiter": ",",
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "selectAllValue": "0,1,2,3,4",
              "showDefault": false
            },
            "jsonData": "[\r\n    {\"value\":\"0\",\"label\":\"Regular\"},\r\n    {\"value\":\"3\",\"label\":\"Aborted\"},\r\n    {\"value\":\"4\",\"label\":\"Exception\"}\r\n]",
            "timeContext": {
              "durationMs": 86400000
            },
            "defaultValue": "value::all"
          },
          {
            "id": "f3ca5023-b39e-4246-8f67-9708b721da46",
            "version": "KqlParameterItem/1.0",
            "name": "qdsQueryId",
            "label": "Query ID",
            "type": 1,
            "description": "Enter a Query ID to show that query only. This is an optional parameter.",
            "typeSettings": {
              "paramValidationRules": [
                {
                  "regExp": "\\\"",
                  "match": false,
                  "message": "Query ID filter value may not contain double quotes"
                }
              ]
            },
            "value": ""
          },
          {
            "id": "07f39986-d4e0-4205-b586-dc4924600e4d",
            "version": "KqlParameterItem/1.0",
            "name": "qdsQueryHash",
            "label": "Query hash",
            "type": 1,
            "description": "Enter a query hash to show top queries with that hash. This is an optional parameter.",
            "typeSettings": {
              "paramValidationRules": [
                {
                  "regExp": "\\\"",
                  "match": false,
                  "message": "Query hash filter value may not contain double quotes"
                }
              ]
            },
            "value": ""
          },
          {
            "id": "7917da4e-962c-4ce8-8296-e6f6f22e3992",
            "version": "KqlParameterItem/1.0",
            "name": "qdsQueryText",
            "label": "Query text",
            "type": 1,
            "description": "Enter a string to find queries with SQL text containing this string. This is an optional parameter.",
            "typeSettings": {
              "multiLineText": true,
              "editorLanguage": "sql",
              "multiLineHeight": 3
            }
          },
          {
            "id": "5fdd560a-69f7-4aca-9dec-7d7b239f4bd3",
            "version": "KqlParameterItem/1.0",
            "name": "qdsMetricLabelMidsentenceCase",
            "type": 1,
            "isHiddenWhenLocked": true,
            "criteriaData": [
              {
                "criteriaContext": {
                  "leftOperand": "qdsMetric",
                  "operator": "==",
                  "rightValType": "static",
                  "rightVal": "count_executions",
                  "resultValType": "static",
                  "resultVal": "execution count"
                }
              },
              {
                "criteriaContext": {
                  "leftOperand": "qdsMetric",
                  "operator": "==",
                  "rightValType": "static",
                  "rightVal": "duration",
                  "resultValType": "static",
                  "resultVal": "duration"
                }
              },
              {
                "criteriaContext": {
                  "leftOperand": "qdsMetric",
                  "operator": "==",
                  "rightValType": "static",
                  "rightVal": "cpu_time",
                  "resultValType": "static",
                  "resultVal": "CPU time"
                }
              },
              {
                "criteriaContext": {
                  "leftOperand": "qdsMetric",
                  "operator": "==",
                  "rightValType": "static",
                  "rightVal": "logical_io_reads",
                  "resultValType": "static",
                  "resultVal": "logical reads"
                }
              },
              {
                "criteriaContext": {
                  "leftOperand": "qdsMetric",
                  "operator": "==",
                  "rightValType": "static",
                  "rightVal": "logical_io_writes",
                  "resultValType": "static",
                  "resultVal": "logical writes"
                }
              },
              {
                "criteriaContext": {
                  "leftOperand": "qdsMetric",
                  "operator": "==",
                  "rightValType": "static",
                  "rightVal": "physical_io_reads",
                  "resultValType": "static",
                  "resultVal": "physical reads (pages)"
                }
              },
              {
                "criteriaContext": {
                  "leftOperand": "qdsMetric",
                  "operator": "==",
                  "rightValType": "static",
                  "rightVal": "num_physical_io_reads",
                  "resultValType": "static",
                  "resultVal": "physical reads (IOs)"
                }
              },
              {
                "criteriaContext": {
                  "leftOperand": "qdsMetric",
                  "operator": "==",
                  "rightValType": "static",
                  "rightVal": "clr_time",
                  "resultValType": "static",
                  "resultVal": "CLR time"
                }
              },
              {
                "criteriaContext": {
                  "leftOperand": "qdsMetric",
                  "operator": "==",
                  "rightValType": "static",
                  "rightVal": "dop",
                  "resultValType": "static",
                  "resultVal": "DOP"
                }
              },
              {
                "criteriaContext": {
                  "leftOperand": "qdsMetric",
                  "operator": "==",
                  "rightValType": "static",
                  "rightVal": "query_max_used_memory",
                  "resultValType": "static",
                  "resultVal": "memory grant"
                }
              },
              {
                "criteriaContext": {
                  "leftOperand": "qdsMetric",
                  "operator": "==",
                  "rightValType": "static",
                  "rightVal": "rowcount",
                  "resultValType": "static",
                  "resultVal": "row count"
                }
              },
              {
                "criteriaContext": {
                  "leftOperand": "qdsMetric",
                  "operator": "==",
                  "rightValType": "static",
                  "rightVal": "log_bytes_used",
                  "resultValType": "static",
                  "resultVal": "transaction log space used"
                }
              },
              {
                "criteriaContext": {
                  "leftOperand": "qdsMetric",
                  "operator": "==",
                  "rightValType": "static",
                  "rightVal": "tempdb_space_used",
                  "resultValType": "static",
                  "resultVal": "tempdb space used"
                }
              },
              {
                "criteriaContext": {
                  "leftOperand": "qdsMetric",
                  "operator": "==",
                  "rightValType": "static",
                  "rightVal": "page_server_io_reads",
                  "resultValType": "static",
                  "resultVal": "page server reads (pages)"
                }
              },
              {
                "criteriaContext": {
                  "operator": "Default",
                  "rightValType": "param",
                  "resultValType": "param"
                }
              }
            ],
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "13721e52-abef-4034-95e1-f7b0a13d12b3",
            "version": "KqlParameterItem/1.0",
            "name": "qdsMetricUnit",
            "type": 1,
            "isHiddenWhenLocked": true,
            "criteriaData": [
              {
                "criteriaContext": {
                  "leftOperand": "qdsMetric",
                  "operator": "==",
                  "rightValType": "static",
                  "rightVal": "duration",
                  "resultValType": "static",
                  "resultVal": "time"
                }
              },
              {
                "criteriaContext": {
                  "leftOperand": "qdsMetric",
                  "operator": "==",
                  "rightValType": "static",
                  "rightVal": "cpu_time",
                  "resultValType": "static",
                  "resultVal": "time"
                }
              },
              {
                "criteriaContext": {
                  "leftOperand": "qdsMetric",
                  "operator": "==",
                  "rightValType": "static",
                  "rightVal": "clr_time",
                  "resultValType": "static",
                  "resultVal": "time"
                }
              },
              {
                "criteriaContext": {
                  "leftOperand": "qdsMetric",
                  "operator": "==",
                  "rightValType": "static",
                  "rightVal": "query_max_used_memory",
                  "resultValType": "static",
                  "resultVal": "bytes"
                }
              },
              {
                "criteriaContext": {
                  "leftOperand": "qdsMetric",
                  "operator": "==",
                  "rightValType": "static",
                  "rightVal": "log_bytes_used",
                  "resultValType": "static",
                  "resultVal": "bytes"
                }
              },
              {
                "criteriaContext": {
                  "leftOperand": "qdsMetric",
                  "operator": "==",
                  "rightValType": "static",
                  "rightVal": "tempdb_space_used",
                  "resultValType": "static",
                  "resultVal": "bytes"
                }
              },
              {
                "criteriaContext": {
                  "operator": "Default",
                  "resultValType": "static",
                  "resultVal": "unitless"
                }
              }
            ],
            "timeContext": {
              "durationMs": 86400000
            }
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "conditionalVisibilities": [
        {
          "parameterName": "qdsStartTime",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsEndTime",
          "comparison": "isNotEqualTo"
        }
      ],
      "name": "top_query_parameters"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "87206c56-9a13-4649-85a4-c25af12b86b5",
            "version": "KqlParameterItem/1.0",
            "name": "showQueriesAs",
            "label": "Show queries as",
            "type": 10,
            "description": "Show queries as tiles or as a grid",
            "isRequired": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[\r\n    {\"value\":\"tiles\",\"label\":\"Tiles\"},\r\n    {\"value\":\"grid\",\"label\":\"Grid\"}\r\n]",
            "timeContext": {
              "durationMs": 86400000
            },
            "value": "tiles"
          }
        ],
        "style": "above",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "conditionalVisibilities": [
        {
          "parameterName": "qdsStartTime",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsEndTime",
          "comparison": "isNotEqualTo"
        }
      ],
      "customWidth": "20",
      "name": "show_query_as_parameters"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "list",
        "links": [
          {
            "id": "71ac9443-fccd-4088-8448-59bb14fd1b02",
            "linkTarget": "WorkbookTemplate",
            "linkLabel": "Query Store intervals",
            "style": "secondary",
            "linkIsContextBlade": true,
            "workbookContext": {
              "componentIdSource": "workbook",
              "resourceIdsSource": "workbook",
              "templateIdSource": "static",
              "templateId": "Community-Workbooks/Database watcher/Azure SQL Database/database/top queries/query store intervals",
              "typeSource": "workbook",
              "gallerySource": "workbook",
              "locationSource": "default",
              "workbookName": "Query Store intervals"
            }
          }
        ]
      },
      "conditionalVisibilities": [
        {
          "parameterName": "qdsMetric",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsAggregation",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsTopQueryCount",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsAggBy",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsStartTime",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsEndTime",
          "comparison": "isNotEqualTo"
        }
      ],
      "customWidth": "80",
      "name": "top_queries_context_pane_nav"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"sqldb_single_database_query_runtime_stats\\r\\n| where interval_start_time >= todatetime(\\\"{qdsStartTime}\\\") and interval_end_time <= todatetime(\\\"{qdsEndTime}\\\")\\r\\n| where logical_server_name =~ @\\\"{serverName}\\\"\\r\\n| where database_name == @\\\"{databaseName}\\\"\\r\\n| where replica_type == \\\"{qdsCollectionReplicaType}\\\"\\r\\n| where execution_type in ({qdsExecutionType})\\r\\n| summarize dcount_query_id = dcount(query_id),\\r\\n            any_query_id = take_any(query_id),\\r\\n            query_sql_text = take_any(query_sql_text),\\r\\n            count_executions = case(\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"avg\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", avg(count_executions),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"min\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", min(toreal(count_executions)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"max\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", max(toreal(count_executions)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"stdev\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", max(toreal(count_executions)),\\r\\n                                   \\\"{qdsAggregation}\\\" in (\\\"total\\\",\\\"avg\\\",\\\"min\\\",\\\"max\\\",\\\"stdev\\\"), sum(toreal(count_executions)),\\r\\n                                   real(null)\\r\\n                                   ),\\r\\n            duration_us = case(\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_duration_us * count_executions),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_duration_us),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_duration_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_duration_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_cpu_time_us), // use maximum stdev for the interval\\r\\n                              real(null)\\r\\n                              ),\\r\\n            cpu_time_us = case(\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_cpu_time_us * count_executions),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_cpu_time_us),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_cpu_time_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_cpu_time_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_cpu_time_us),\\r\\n                              real(null)\\r\\n                              ),\\r\\n            logical_io_reads = case(\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_logical_io_reads * count_executions),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_logical_io_reads),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_logical_io_reads)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_logical_io_reads)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_logical_io_reads),\\r\\n                                   real(null)\\r\\n                                   ),\\r\\n            logical_io_writes = case(\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_logical_io_writes * count_executions),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_logical_io_writes),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_logical_io_writes)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_logical_io_writes)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_logical_io_writes),\\r\\n                                    real(null)\\r\\n                                    ),\\r\\n            physical_io_reads = case(\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_physical_io_reads * count_executions),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_physical_io_reads),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_physical_io_reads)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_physical_io_reads)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_physical_io_reads),\\r\\n                                    real(null)\\r\\n                                    ),\\r\\n            num_physical_io_reads = case(\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_num_physical_io_reads * count_executions),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_num_physical_io_reads),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_num_physical_io_reads)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_num_physical_io_reads)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_num_physical_io_reads),\\r\\n                                        real(null)\\r\\n                                        ),\\r\\n            clr_time_us = case(\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_clr_time_us * count_executions),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_clr_time_us),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_clr_time_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_clr_time_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_clr_time_us),\\r\\n                              real(null)\\r\\n                              ),\\r\\n            dop = case(\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"total\\\", sumif(avg_dop * count_executions, is_parallel_plan), // Total DOP for serial queries is meaningless, show as zero\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_dop),\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_dop)),\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_dop)),\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_dop),\\r\\n                      real(null)\\r\\n                      ),\\r\\n            rowcount = case(\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_rowcount * count_executions),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_rowcount),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_rowcount)),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_rowcount)),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_rowcount),\\r\\n                           real(null)\\r\\n                           ),\\r\\n            query_max_used_memory = case(\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_query_max_used_memory * count_executions),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_query_max_used_memory),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_query_max_used_memory)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_query_max_used_memory)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_query_max_used_memory),\\r\\n                                        real(null)\\r\\n                                        ),\\r\\n            log_bytes_used = case(\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_log_bytes_used * count_executions),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_log_bytes_used),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_log_bytes_used)),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_log_bytes_used)),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_log_bytes_used),\\r\\n                                 real(null)\\r\\n                                 ),\\r\\n            tempdb_space_used = case(\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_tempdb_space_used * count_executions),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_tempdb_space_used),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_tempdb_space_used)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_tempdb_space_used)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_tempdb_space_used),\\r\\n                                    real(null)\\r\\n                                    ),\\r\\n            page_server_io_reads = case(\\r\\n                                       \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_page_server_io_reads * count_executions),\\r\\n                                       \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_page_server_io_reads),\\r\\n                                       \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_page_server_io_reads)),\\r\\n                                       \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_page_server_io_reads)),\\r\\n                                       \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_page_server_io_reads),\\r\\n                                       real(null)\\r\\n                                       )\\r\\n            by query_hash,\\r\\n               query_id = iif(\\\"{qdsAggBy}\\\"==\\\"query_id\\\", query_id, long(null))\\r\\n| extend query_id = iif(isnull(query_id), any_query_id, query_id),\\r\\n         multi_query_text_warning = iif(dcount_query_id > 1, strcat(\\\"There are \\\", tostring(dcount_query_id), \\\" distinct queries for this query hash. Displayed query text and query details are for one of these \\\", tostring(dcount_query_id), \\\" queries. To see query text and details for a specific query, use aggregation by Query ID.\\\"), \\\"\\\"),\\r\\n         ranked_metric = case(\\r\\n                             \\\"{qdsMetric}\\\"==\\\"count_executions\\\", toreal(count_executions),\\r\\n                             \\\"{qdsMetric}\\\"==\\\"logical_io_reads\\\", toreal(logical_io_reads),\\r\\n                             \\\"{qdsMetric}\\\"==\\\"logical_io_writes\\\", toreal(logical_io_writes),\\r\\n                             \\\"{qdsMetric}\\\"==\\\"physical_io_reads\\\", toreal(physical_io_reads),\\r\\n                             \\\"{qdsMetric}\\\"==\\\"num_physical_io_reads\\\", toreal(num_physical_io_reads),\\r\\n                             \\\"{qdsMetric}\\\"==\\\"dop\\\", toreal(dop),\\r\\n                             \\\"{qdsMetric}\\\"==\\\"rowcount\\\", toreal(rowcount),\\r\\n                             \\\"{qdsMetric}\\\"==\\\"page_server_io_reads\\\", toreal(page_server_io_reads),\\r\\n                             real(null)\\r\\n                             )\\r\\n| sort by count_executions desc | extend count_executions_rank = row_rank(count_executions)\\r\\n| sort by duration_us desc | extend duration_rank = row_rank(duration_us)\\r\\n| sort by cpu_time_us desc | extend cpu_time_rank = row_rank(cpu_time_us)\\r\\n| sort by logical_io_reads desc | extend logical_io_reads_rank = row_rank(logical_io_reads)\\r\\n| sort by logical_io_writes desc | extend logical_io_writes_rank = row_rank(logical_io_writes)\\r\\n| sort by physical_io_reads desc | extend physical_io_reads_rank = row_rank(physical_io_reads)\\r\\n| sort by num_physical_io_reads desc | extend num_physical_io_reads_rank = row_rank(num_physical_io_reads)\\r\\n| sort by clr_time_us desc | extend clr_time_rank = row_rank(clr_time_us)\\r\\n| sort by dop desc | extend dop_rank = row_rank(dop)\\r\\n| sort by query_max_used_memory desc | extend query_max_used_memory_rank = row_rank(query_max_used_memory)\\r\\n| sort by rowcount desc | extend rowcount_rank = row_rank(rowcount)\\r\\n| sort by log_bytes_used desc | extend log_bytes_used_rank = row_rank(log_bytes_used)\\r\\n| sort by tempdb_space_used desc | extend tempdb_space_used_rank = row_rank(tempdb_space_used)\\r\\n| sort by page_server_io_reads desc | extend page_server_io_reads_rank = row_rank(page_server_io_reads)\\r\\n| extend ranks = dynamic_to_json(pack_array(\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Executions\\\", \\\"Rank\\\", count_executions_rank, \\\"Value\\\", count_executions),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Duration\\\", \\\"Rank\\\", duration_rank, \\\"Value\\\", duration_us),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"CPU time\\\", \\\"Rank\\\", cpu_time_rank, \\\"Value\\\", cpu_time_us),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Logical reads\\\", \\\"Rank\\\", logical_io_reads_rank, \\\"Value\\\", logical_io_reads),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Logical writes\\\", \\\"Rank\\\", logical_io_writes_rank, \\\"Value\\\", logical_io_writes),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Physical reads (pages)\\\", \\\"Rank\\\", physical_io_reads_rank, \\\"Value\\\", physical_io_reads),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Physical reads (IOs)\\\", \\\"Rank\\\", num_physical_io_reads_rank, \\\"Value\\\", num_physical_io_reads),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"CLR time\\\", \\\"Rank\\\", clr_time_rank, \\\"Value\\\", clr_time_us),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"DOP\\\", \\\"Rank\\\", dop_rank, \\\"Value\\\", dop),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Memory grant\\\", \\\"Rank\\\", query_max_used_memory_rank, \\\"Value\\\", query_max_used_memory),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Row count\\\", \\\"Rank\\\", rowcount_rank, \\\"Value\\\", rowcount),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Transaction log space used\\\", \\\"Rank\\\", log_bytes_used_rank, \\\"Value\\\", log_bytes_used),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Tempdb space used\\\", \\\"Rank\\\", tempdb_space_used_rank, \\\"Value\\\", tempdb_space_used),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Page server reads (pages)\\\", \\\"Rank\\\", page_server_io_reads_rank, \\\"Value\\\", page_server_io_reads)\\r\\n                                           ))\\r\\n| project-away count_executions_rank, duration_rank, cpu_time_rank, logical_io_reads_rank, logical_io_writes_rank, physical_io_reads_rank, num_physical_io_reads_rank, clr_time_rank, dop_rank, query_max_used_memory_rank, rowcount_rank, log_bytes_used_rank, tempdb_space_used_rank, page_server_io_reads_rank\\r\\n| sort by ranked_metric desc\\r\\n| extend rank = row_rank(ranked_metric)\\r\\n| project query_hash,\\r\\n          query_id,\\r\\n          rank,\\r\\n          ranked_metric,\\r\\n          count_executions,\\r\\n          query_sql_text,\\r\\n          query_sql_text_json = dynamic_to_json(pack(\\\"query_sql_text\\\", query_sql_text)),\\r\\n          multi_query_text_warning,\\r\\n          tile_label = case(\\r\\n                           \\\"{qdsAggBy}\\\"==\\\"query_id\\\", strcat(\\\"Query ID: \\\", tostring(query_id)),\\r\\n                           \\\"{qdsAggBy}\\\"==\\\"query_hash\\\", strcat(\\\"Query hash: \\\", tostring(query_hash)),\\r\\n                           \\\"\\\"\\r\\n                           ),\\r\\n          ranks\\r\\n// Restrict by query_id/query_hash after ranking to preserve query rank value in results\\r\\n| where query_id == iif(isnotempty(@\\\"{qdsQueryId}\\\"), tolong(@\\\"{qdsQueryId}\\\"), query_id)\\r\\n| where query_hash == iif(isnotempty(@\\\"{qdsQueryHash}\\\"), @\\\"{qdsQueryHash}\\\", query_hash)\\r\\n| where query_sql_text contains \\\"{qdsQueryText:escape}\\\"\\r\\n| sort by rank asc, count_executions desc // secondary sort for determinism when primary sort is tied\\r\\n| take {qdsTopQueryCount}\\r\\n;\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
        "size": 3,
        "showAnalytics": true,
        "title": "Top queries ranked by {qdsAggregation} {qdsMetricLabelMidsentenceCase}",
        "noDataMessage": "There is no data for specified parameters.",
        "exportedParameters": [
          {
            "fieldName": "query_sql_text_json",
            "parameterName": "query_sql_text_json",
            "defaultValue": "\"<Select a query>\""
          },
          {
            "fieldName": "query_id",
            "parameterName": "query_id",
            "parameterType": 1,
            "defaultValue": "0"
          },
          {
            "fieldName": "query_hash",
            "parameterName": "query_hash",
            "parameterType": 1,
            "defaultValue": "\"\""
          },
          {
            "fieldName": "multi_query_text_warning",
            "parameterName": "multi_query_text_warning",
            "parameterType": 1,
            "defaultValue": "\"\""
          },
          {
            "fieldName": "ranks",
            "parameterName": "ranks",
            "parameterType": 1
          }
        ],
        "queryType": 9,
        "visualization": "tiles",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "count_executions",
              "formatter": 22,
              "formatOptions": {
                "compositeBarSettings": {
                  "labelText": "",
                  "columnSettings": [
                    {
                      "columnName": "count_successful_executions",
                      "color": "green"
                    },
                    {
                      "columnName": "count_aborted_executions",
                      "color": "orange"
                    },
                    {
                      "columnName": "count_exception_executions",
                      "color": "red"
                    }
                  ]
                }
              },
              "tooltipFormat": {
                "tooltip": "Successful (green), aborted (orange), and exception (red) executions"
              }
            }
          ]
        },
        "tileSettings": {
          "titleContent": {
            "formatter": 1,
            "tooltipFormat": {
              "tooltip": "Query rank"
            }
          },
          "leftContent": {
            "columnMatch": "rank",
            "formatter": 12,
            "formatOptions": {
              "palette": "none"
            },
            "tooltipFormat": {
              "tooltip": "Query rank"
            }
          },
          "rightContent": {
            "columnMatch": "ranked_metric",
            "formatter": 4,
            "formatOptions": {
              "palette": "coldHot"
            },
            "numberFormat": {
              "unit": 0,
              "options": {
                "style": "decimal",
                "useGrouping": true,
                "maximumFractionDigits": 2
              }
            }
          },
          "secondaryContent": {
            "columnMatch": "tile_label",
            "formatter": 1
          },
          "showBorder": true,
          "sortCriteriaField": "rank",
          "sortOrderField": 1,
          "size": "auto"
        }
      },
      "conditionalVisibilities": [
        {
          "parameterName": "qdsMetric",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsAggregation",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsTopQueryCount",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsAggBy",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "showQueriesAs",
          "comparison": "isEqualTo",
          "value": "tiles"
        },
        {
          "parameterName": "qdsMetricUnit",
          "comparison": "isEqualTo",
          "value": "unitless"
        },
        {
          "parameterName": "qdsStartTime",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsEndTime",
          "comparison": "isNotEqualTo"
        }
      ],
      "name": "qds_top_queries_tiles_unitless"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"sqldb_single_database_query_runtime_stats\\r\\n| where interval_start_time >= todatetime(\\\"{qdsStartTime}\\\") and interval_end_time <= todatetime(\\\"{qdsEndTime}\\\")\\r\\n| where logical_server_name =~ @\\\"{serverName}\\\"\\r\\n| where database_name == @\\\"{databaseName}\\\"\\r\\n| where replica_type == \\\"{qdsCollectionReplicaType}\\\"\\r\\n| where execution_type in ({qdsExecutionType})\\r\\n| summarize dcount_query_id = dcount(query_id),\\r\\n            any_query_id = take_any(query_id),\\r\\n            query_sql_text = take_any(query_sql_text),\\r\\n            count_executions = case(\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"avg\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", avg(count_executions),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"min\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", min(toreal(count_executions)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"max\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", max(toreal(count_executions)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"stdev\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", max(toreal(count_executions)),\\r\\n                                   \\\"{qdsAggregation}\\\" in (\\\"total\\\",\\\"avg\\\",\\\"min\\\",\\\"max\\\",\\\"stdev\\\"), sum(toreal(count_executions)),\\r\\n                                   real(null)\\r\\n                                   ),\\r\\n            duration_us = case(\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_duration_us * count_executions),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_duration_us),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_duration_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_duration_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_cpu_time_us), // use maximum stdev for the interval\\r\\n                              real(null)\\r\\n                              ),\\r\\n            cpu_time_us = case(\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_cpu_time_us * count_executions),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_cpu_time_us),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_cpu_time_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_cpu_time_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_cpu_time_us),\\r\\n                              real(null)\\r\\n                              ),\\r\\n            logical_io_reads = case(\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_logical_io_reads * count_executions),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_logical_io_reads),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_logical_io_reads)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_logical_io_reads)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_logical_io_reads),\\r\\n                                   real(null)\\r\\n                                   ),\\r\\n            logical_io_writes = case(\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_logical_io_writes * count_executions),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_logical_io_writes),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_logical_io_writes)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_logical_io_writes)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_logical_io_writes),\\r\\n                                    real(null)\\r\\n                                    ),\\r\\n            physical_io_reads = case(\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_physical_io_reads * count_executions),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_physical_io_reads),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_physical_io_reads)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_physical_io_reads)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_physical_io_reads),\\r\\n                                    real(null)\\r\\n                                    ),\\r\\n            num_physical_io_reads = case(\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_num_physical_io_reads * count_executions),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_num_physical_io_reads),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_num_physical_io_reads)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_num_physical_io_reads)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_num_physical_io_reads),\\r\\n                                        real(null)\\r\\n                                        ),\\r\\n            clr_time_us = case(\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_clr_time_us * count_executions),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_clr_time_us),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_clr_time_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_clr_time_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_clr_time_us),\\r\\n                              real(null)\\r\\n                              ),\\r\\n            dop = case(\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"total\\\", sumif(avg_dop * count_executions, is_parallel_plan), // Total DOP for serial queries is meaningless, show as zero\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_dop),\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_dop)),\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_dop)),\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_dop),\\r\\n                      real(null)\\r\\n                      ),\\r\\n            rowcount = case(\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_rowcount * count_executions),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_rowcount),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_rowcount)),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_rowcount)),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_rowcount),\\r\\n                           real(null)\\r\\n                           ),\\r\\n            query_max_used_memory = case(\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_query_max_used_memory * count_executions),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_query_max_used_memory),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_query_max_used_memory)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_query_max_used_memory)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_query_max_used_memory),\\r\\n                                        real(null)\\r\\n                                        ),\\r\\n            log_bytes_used = case(\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_log_bytes_used * count_executions),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_log_bytes_used),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_log_bytes_used)),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_log_bytes_used)),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_log_bytes_used),\\r\\n                                 real(null)\\r\\n                                 ),\\r\\n            tempdb_space_used = case(\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_tempdb_space_used * count_executions),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_tempdb_space_used),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_tempdb_space_used)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_tempdb_space_used)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_tempdb_space_used),\\r\\n                                    real(null)\\r\\n                                    ),\\r\\n            page_server_io_reads = case(\\r\\n                                       \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_page_server_io_reads * count_executions),\\r\\n                                       \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_page_server_io_reads),\\r\\n                                       \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_page_server_io_reads)),\\r\\n                                       \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_page_server_io_reads)),\\r\\n                                       \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_page_server_io_reads),\\r\\n                                       real(null)\\r\\n                                       )\\r\\n            by query_hash,\\r\\n               query_id = iif(\\\"{qdsAggBy}\\\"==\\\"query_id\\\", query_id, long(null))\\r\\n| extend query_id = iif(isnull(query_id), any_query_id, query_id),\\r\\n         multi_query_text_warning = iif(dcount_query_id > 1, strcat(\\\"There are \\\", tostring(dcount_query_id), \\\" distinct queries for this query hash. Displayed query text and query details are for one of these \\\", tostring(dcount_query_id), \\\" queries. To see query text and details for a specific query, use aggregation by Query ID.\\\"), \\\"\\\"),\\r\\n         ranked_metric = case(\\r\\n                             \\\"{qdsMetric}\\\"==\\\"count_executions\\\", toreal(count_executions),\\r\\n                             \\\"{qdsMetric}\\\"==\\\"duration\\\", toreal(duration_us),\\r\\n                             \\\"{qdsMetric}\\\"==\\\"cpu_time\\\", toreal(cpu_time_us),\\r\\n                             \\\"{qdsMetric}\\\"==\\\"clr_time\\\", toreal(clr_time_us),\\r\\n                             real(null)\\r\\n                             )\\r\\n| sort by count_executions desc | extend count_executions_rank = row_rank(count_executions)\\r\\n| sort by duration_us desc | extend duration_rank = row_rank(duration_us)\\r\\n| sort by cpu_time_us desc | extend cpu_time_rank = row_rank(cpu_time_us)\\r\\n| sort by logical_io_reads desc | extend logical_io_reads_rank = row_rank(logical_io_reads)\\r\\n| sort by logical_io_writes desc | extend logical_io_writes_rank = row_rank(logical_io_writes)\\r\\n| sort by physical_io_reads desc | extend physical_io_reads_rank = row_rank(physical_io_reads)\\r\\n| sort by num_physical_io_reads desc | extend num_physical_io_reads_rank = row_rank(num_physical_io_reads)\\r\\n| sort by clr_time_us desc | extend clr_time_rank = row_rank(clr_time_us)\\r\\n| sort by dop desc | extend dop_rank = row_rank(dop)\\r\\n| sort by query_max_used_memory desc | extend query_max_used_memory_rank = row_rank(query_max_used_memory)\\r\\n| sort by rowcount desc | extend rowcount_rank = row_rank(rowcount)\\r\\n| sort by log_bytes_used desc | extend log_bytes_used_rank = row_rank(log_bytes_used)\\r\\n| sort by tempdb_space_used desc | extend tempdb_space_used_rank = row_rank(tempdb_space_used)\\r\\n| sort by page_server_io_reads desc | extend page_server_io_reads_rank = row_rank(page_server_io_reads)\\r\\n| extend ranks = dynamic_to_json(pack_array(\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Executions\\\", \\\"Rank\\\", count_executions_rank, \\\"Value\\\", count_executions),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Duration\\\", \\\"Rank\\\", duration_rank, \\\"Value\\\", duration_us),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"CPU time\\\", \\\"Rank\\\", cpu_time_rank, \\\"Value\\\", cpu_time_us),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Logical reads\\\", \\\"Rank\\\", logical_io_reads_rank, \\\"Value\\\", logical_io_reads),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Logical writes\\\", \\\"Rank\\\", logical_io_writes_rank, \\\"Value\\\", logical_io_writes),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Physical reads (pages)\\\", \\\"Rank\\\", physical_io_reads_rank, \\\"Value\\\", physical_io_reads),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Physical reads (IOs)\\\", \\\"Rank\\\", num_physical_io_reads_rank, \\\"Value\\\", num_physical_io_reads),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"CLR time\\\", \\\"Rank\\\", clr_time_rank, \\\"Value\\\", clr_time_us),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"DOP\\\", \\\"Rank\\\", dop_rank, \\\"Value\\\", dop),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Memory grant\\\", \\\"Rank\\\", query_max_used_memory_rank, \\\"Value\\\", query_max_used_memory),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Row count\\\", \\\"Rank\\\", rowcount_rank, \\\"Value\\\", rowcount),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Transaction log space used\\\", \\\"Rank\\\", log_bytes_used_rank, \\\"Value\\\", log_bytes_used),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Tempdb space used\\\", \\\"Rank\\\", tempdb_space_used_rank, \\\"Value\\\", tempdb_space_used),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Page server reads (pages)\\\", \\\"Rank\\\", page_server_io_reads_rank, \\\"Value\\\", page_server_io_reads)\\r\\n                                           ))\\r\\n| project-away count_executions_rank, duration_rank, cpu_time_rank, logical_io_reads_rank, logical_io_writes_rank, physical_io_reads_rank, num_physical_io_reads_rank, clr_time_rank, dop_rank, query_max_used_memory_rank, rowcount_rank, log_bytes_used_rank, tempdb_space_used_rank, page_server_io_reads_rank\\r\\n| sort by ranked_metric desc\\r\\n| extend rank = row_rank(ranked_metric)\\r\\n| project query_hash,\\r\\n          query_id,\\r\\n          rank,\\r\\n          ranked_metric,\\r\\n          count_executions,\\r\\n          query_sql_text,\\r\\n          query_sql_text_json = dynamic_to_json(pack(\\\"query_sql_text\\\", query_sql_text)),\\r\\n          multi_query_text_warning,\\r\\n          tile_label = case(\\r\\n                           \\\"{qdsAggBy}\\\"==\\\"query_id\\\", strcat(\\\"Query ID: \\\", tostring(query_id)),\\r\\n                           \\\"{qdsAggBy}\\\"==\\\"query_hash\\\", strcat(\\\"Query hash: \\\", tostring(query_hash)),\\r\\n                           \\\"\\\"\\r\\n                           ),\\r\\n          ranks\\r\\n// Restrict by query_id/query_hash after ranking to preserve query rank value in results\\r\\n| where query_id == iif(isnotempty(@\\\"{qdsQueryId}\\\"), tolong(@\\\"{qdsQueryId}\\\"), query_id)\\r\\n| where query_hash == iif(isnotempty(@\\\"{qdsQueryHash}\\\"), @\\\"{qdsQueryHash}\\\", query_hash)\\r\\n| sort by rank asc, count_executions desc // secondary sort for determinism when primary sort is tied\\r\\n| take {qdsTopQueryCount}\\r\\n;\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
        "size": 3,
        "showAnalytics": true,
        "title": "Top queries ranked by {qdsAggregation} {qdsMetricLabelMidsentenceCase}",
        "noDataMessage": "There is no data for specified parameters.",
        "exportedParameters": [
          {
            "fieldName": "query_sql_text_json",
            "parameterName": "query_sql_text_json",
            "defaultValue": "\"<Select a query>\""
          },
          {
            "fieldName": "query_id",
            "parameterName": "query_id",
            "parameterType": 1,
            "defaultValue": "0"
          },
          {
            "fieldName": "query_hash",
            "parameterName": "query_hash",
            "parameterType": 1,
            "defaultValue": "\"\""
          },
          {
            "fieldName": "multi_query_text_warning",
            "parameterName": "multi_query_text_warning",
            "parameterType": 1
          },
          {
            "fieldName": "ranks",
            "parameterName": "ranks",
            "parameterType": 1
          }
        ],
        "queryType": 9,
        "visualization": "tiles",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "count_executions",
              "formatter": 22,
              "formatOptions": {
                "compositeBarSettings": {
                  "labelText": "",
                  "columnSettings": [
                    {
                      "columnName": "count_successful_executions",
                      "color": "green"
                    },
                    {
                      "columnName": "count_aborted_executions",
                      "color": "orange"
                    },
                    {
                      "columnName": "count_exception_executions",
                      "color": "red"
                    }
                  ]
                }
              },
              "tooltipFormat": {
                "tooltip": "Successful (green), aborted (orange), and exception (red) executions"
              }
            }
          ]
        },
        "tileSettings": {
          "titleContent": {
            "formatter": 1,
            "tooltipFormat": {
              "tooltip": "Query rank"
            }
          },
          "leftContent": {
            "columnMatch": "rank",
            "formatter": 12,
            "formatOptions": {
              "palette": "none"
            },
            "tooltipFormat": {
              "tooltip": "Query rank"
            }
          },
          "rightContent": {
            "columnMatch": "ranked_metric",
            "formatter": 4,
            "formatOptions": {
              "palette": "coldHot"
            },
            "numberFormat": {
              "unit": 22,
              "options": {
                "style": "decimal",
                "maximumFractionDigits": 2
              }
            }
          },
          "secondaryContent": {
            "columnMatch": "tile_label",
            "formatter": 1
          },
          "showBorder": true,
          "sortCriteriaField": "rank",
          "sortOrderField": 1,
          "size": "auto"
        }
      },
      "conditionalVisibilities": [
        {
          "parameterName": "qdsMetric",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsAggregation",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsTopQueryCount",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsAggBy",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "showQueriesAs",
          "comparison": "isEqualTo",
          "value": "tiles"
        },
        {
          "parameterName": "qdsMetricUnit",
          "comparison": "isEqualTo",
          "value": "time"
        },
        {
          "parameterName": "qdsStartTime",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsEndTime",
          "comparison": "isNotEqualTo"
        }
      ],
      "name": "qds_top_queries_tiles_time"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"sqldb_single_database_query_runtime_stats\\r\\n| where interval_start_time >= todatetime(\\\"{qdsStartTime}\\\") and interval_end_time <= todatetime(\\\"{qdsEndTime}\\\")\\r\\n| where logical_server_name =~ @\\\"{serverName}\\\"\\r\\n| where database_name == @\\\"{databaseName}\\\"\\r\\n| where replica_type == \\\"{qdsCollectionReplicaType}\\\"\\r\\n| where execution_type in ({qdsExecutionType})\\r\\n| summarize dcount_query_id = dcount(query_id),\\r\\n            any_query_id = take_any(query_id),\\r\\n            query_sql_text = take_any(query_sql_text),\\r\\n            count_executions = case(\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"avg\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", avg(count_executions),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"min\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", min(toreal(count_executions)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"max\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", max(toreal(count_executions)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"stdev\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", max(toreal(count_executions)),\\r\\n                                   \\\"{qdsAggregation}\\\" in (\\\"total\\\",\\\"avg\\\",\\\"min\\\",\\\"max\\\",\\\"stdev\\\"), sum(toreal(count_executions)),\\r\\n                                   real(null)\\r\\n                                   ),\\r\\n            duration_us = case(\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_duration_us * count_executions),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_duration_us),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_duration_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_duration_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_cpu_time_us), // use maximum stdev for the interval\\r\\n                              real(null)\\r\\n                              ),\\r\\n            cpu_time_us = case(\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_cpu_time_us * count_executions),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_cpu_time_us),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_cpu_time_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_cpu_time_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_cpu_time_us),\\r\\n                              real(null)\\r\\n                              ),\\r\\n            logical_io_reads = case(\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_logical_io_reads * count_executions),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_logical_io_reads),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_logical_io_reads)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_logical_io_reads)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_logical_io_reads),\\r\\n                                   real(null)\\r\\n                                   ),\\r\\n            logical_io_writes = case(\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_logical_io_writes * count_executions),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_logical_io_writes),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_logical_io_writes)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_logical_io_writes)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_logical_io_writes),\\r\\n                                    real(null)\\r\\n                                    ),\\r\\n            physical_io_reads = case(\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_physical_io_reads * count_executions),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_physical_io_reads),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_physical_io_reads)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_physical_io_reads)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_physical_io_reads),\\r\\n                                    real(null)\\r\\n                                    ),\\r\\n            num_physical_io_reads = case(\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_num_physical_io_reads * count_executions),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_num_physical_io_reads),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_num_physical_io_reads)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_num_physical_io_reads)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_num_physical_io_reads),\\r\\n                                        real(null)\\r\\n                                        ),\\r\\n            clr_time_us = case(\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_clr_time_us * count_executions),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_clr_time_us),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_clr_time_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_clr_time_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_clr_time_us),\\r\\n                              real(null)\\r\\n                              ),\\r\\n            dop = case(\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"total\\\", sumif(avg_dop * count_executions, is_parallel_plan), // Total DOP for serial queries is meaningless, show as zero\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_dop),\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_dop)),\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_dop)),\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_dop),\\r\\n                      real(null)\\r\\n                      ),\\r\\n            rowcount = case(\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_rowcount * count_executions),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_rowcount),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_rowcount)),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_rowcount)),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_rowcount),\\r\\n                           real(null)\\r\\n                           ),\\r\\n            query_max_used_memory = case(\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_query_max_used_memory * count_executions),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_query_max_used_memory),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_query_max_used_memory)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_query_max_used_memory)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_query_max_used_memory),\\r\\n                                        real(null)\\r\\n                                        ),\\r\\n            log_bytes_used = case(\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_log_bytes_used * count_executions),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_log_bytes_used),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_log_bytes_used)),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_log_bytes_used)),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_log_bytes_used),\\r\\n                                 real(null)\\r\\n                                 ),\\r\\n            tempdb_space_used = case(\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_tempdb_space_used * count_executions),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_tempdb_space_used),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_tempdb_space_used)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_tempdb_space_used)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_tempdb_space_used),\\r\\n                                    real(null)\\r\\n                                    ),\\r\\n            page_server_io_reads = case(\\r\\n                                       \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_page_server_io_reads * count_executions),\\r\\n                                       \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_page_server_io_reads),\\r\\n                                       \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_page_server_io_reads)),\\r\\n                                       \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_page_server_io_reads)),\\r\\n                                       \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_page_server_io_reads),\\r\\n                                       real(null)\\r\\n                                       )\\r\\n            by query_hash,\\r\\n               query_id = iif(\\\"{qdsAggBy}\\\"==\\\"query_id\\\", query_id, long(null))\\r\\n| extend query_id = iif(isnull(query_id), any_query_id, query_id),\\r\\n         multi_query_text_warning = iif(dcount_query_id > 1, strcat(\\\"There are \\\", tostring(dcount_query_id), \\\" distinct queries for this query hash. Displayed query text and query details are for one of these \\\", tostring(dcount_query_id), \\\" queries. To see query text and details for a specific query, use aggregation by Query ID.\\\"), \\\"\\\"),\\r\\n         ranked_metric = case(\\r\\n                             \\\"{qdsMetric}\\\"==\\\"query_max_used_memory\\\", toreal(query_max_used_memory * 8 * 1024),\\r\\n                             \\\"{qdsMetric}\\\"==\\\"log_bytes_used\\\", toreal(log_bytes_used),\\r\\n                             \\\"{qdsMetric}\\\"==\\\"tempdb_space_used\\\", toreal(tempdb_space_used * 8 * 1024),\\r\\n                             real(null)\\r\\n                             )\\r\\n| sort by count_executions desc | extend count_executions_rank = row_rank(count_executions)\\r\\n| sort by duration_us desc | extend duration_rank = row_rank(duration_us)\\r\\n| sort by cpu_time_us desc | extend cpu_time_rank = row_rank(cpu_time_us)\\r\\n| sort by logical_io_reads desc | extend logical_io_reads_rank = row_rank(logical_io_reads)\\r\\n| sort by logical_io_writes desc | extend logical_io_writes_rank = row_rank(logical_io_writes)\\r\\n| sort by physical_io_reads desc | extend physical_io_reads_rank = row_rank(physical_io_reads)\\r\\n| sort by num_physical_io_reads desc | extend num_physical_io_reads_rank = row_rank(num_physical_io_reads)\\r\\n| sort by clr_time_us desc | extend clr_time_rank = row_rank(clr_time_us)\\r\\n| sort by dop desc | extend dop_rank = row_rank(dop)\\r\\n| sort by query_max_used_memory desc | extend query_max_used_memory_rank = row_rank(query_max_used_memory)\\r\\n| sort by rowcount desc | extend rowcount_rank = row_rank(rowcount)\\r\\n| sort by log_bytes_used desc | extend log_bytes_used_rank = row_rank(log_bytes_used)\\r\\n| sort by tempdb_space_used desc | extend tempdb_space_used_rank = row_rank(tempdb_space_used)\\r\\n| sort by page_server_io_reads desc | extend page_server_io_reads_rank = row_rank(page_server_io_reads)\\r\\n| extend ranks = dynamic_to_json(pack_array(\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Executions\\\", \\\"Rank\\\", count_executions_rank, \\\"Value\\\", count_executions),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Duration\\\", \\\"Rank\\\", duration_rank, \\\"Value\\\", duration_us),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"CPU time\\\", \\\"Rank\\\", cpu_time_rank, \\\"Value\\\", cpu_time_us),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Logical reads\\\", \\\"Rank\\\", logical_io_reads_rank, \\\"Value\\\", logical_io_reads),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Logical writes\\\", \\\"Rank\\\", logical_io_writes_rank, \\\"Value\\\", logical_io_writes),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Physical reads (pages)\\\", \\\"Rank\\\", physical_io_reads_rank, \\\"Value\\\", physical_io_reads),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Physical reads (IOs)\\\", \\\"Rank\\\", num_physical_io_reads_rank, \\\"Value\\\", num_physical_io_reads),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"CLR time\\\", \\\"Rank\\\", clr_time_rank, \\\"Value\\\", clr_time_us),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"DOP\\\", \\\"Rank\\\", dop_rank, \\\"Value\\\", dop),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Memory grant\\\", \\\"Rank\\\", query_max_used_memory_rank, \\\"Value\\\", query_max_used_memory),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Row count\\\", \\\"Rank\\\", rowcount_rank, \\\"Value\\\", rowcount),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Transaction log space used\\\", \\\"Rank\\\", log_bytes_used_rank, \\\"Value\\\", log_bytes_used),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Tempdb space used\\\", \\\"Rank\\\", tempdb_space_used_rank, \\\"Value\\\", tempdb_space_used),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Page server reads (pages)\\\", \\\"Rank\\\", page_server_io_reads_rank, \\\"Value\\\", page_server_io_reads)\\r\\n                                           ))\\r\\n| project-away count_executions_rank, duration_rank, cpu_time_rank, logical_io_reads_rank, logical_io_writes_rank, physical_io_reads_rank, num_physical_io_reads_rank, clr_time_rank, dop_rank, query_max_used_memory_rank, rowcount_rank, log_bytes_used_rank, tempdb_space_used_rank, page_server_io_reads_rank\\r\\n| sort by ranked_metric desc\\r\\n| extend rank = row_rank(ranked_metric)\\r\\n| project query_hash,\\r\\n          query_id,\\r\\n          rank,\\r\\n          ranked_metric,\\r\\n          count_executions,\\r\\n          query_sql_text_json = dynamic_to_json(pack(\\\"query_sql_text\\\", query_sql_text)),\\r\\n          multi_query_text_warning,\\r\\n          tile_label = case(\\r\\n                           \\\"{qdsAggBy}\\\"==\\\"query_id\\\", strcat(\\\"Query ID: \\\", tostring(query_id)),\\r\\n                           \\\"{qdsAggBy}\\\"==\\\"query_hash\\\", strcat(\\\"Query hash: \\\", tostring(query_hash)),\\r\\n                           \\\"\\\"\\r\\n                           ),\\r\\n          ranks\\r\\n// Restrict by query_id/query_hash after ranking to preserve query rank value in results\\r\\n| where query_id == iif(isnotempty(@\\\"{qdsQueryId}\\\"), tolong(@\\\"{qdsQueryId}\\\"), query_id)\\r\\n| where query_hash == iif(isnotempty(@\\\"{qdsQueryHash}\\\"), @\\\"{qdsQueryHash}\\\", query_hash)\\r\\n| sort by rank asc, count_executions desc // secondary sort for determinism when primary sort is tied\\r\\n| take {qdsTopQueryCount}\\r\\n;\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
        "size": 3,
        "showAnalytics": true,
        "title": "Top queries ranked by {qdsAggregation} {qdsMetricLabelMidsentenceCase}",
        "noDataMessage": "There is no data for specified parameters.",
        "exportedParameters": [
          {
            "fieldName": "query_sql_text_json",
            "parameterName": "query_sql_text_json",
            "defaultValue": "\"<Select a query>\""
          },
          {
            "fieldName": "query_id",
            "parameterName": "query_id",
            "parameterType": 1,
            "defaultValue": "0"
          },
          {
            "fieldName": "query_hash",
            "parameterName": "query_hash",
            "parameterType": 1,
            "defaultValue": "\"\""
          },
          {
            "fieldName": "multi_query_text_warning",
            "parameterName": "multi_query_text_warning",
            "parameterType": 1
          },
          {
            "fieldName": "ranks",
            "parameterName": "ranks",
            "parameterType": 1
          }
        ],
        "queryType": 9,
        "visualization": "tiles",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "count_executions",
              "formatter": 22,
              "formatOptions": {
                "compositeBarSettings": {
                  "labelText": "",
                  "columnSettings": [
                    {
                      "columnName": "count_successful_executions",
                      "color": "green"
                    },
                    {
                      "columnName": "count_aborted_executions",
                      "color": "orange"
                    },
                    {
                      "columnName": "count_exception_executions",
                      "color": "red"
                    }
                  ]
                }
              },
              "tooltipFormat": {
                "tooltip": "Successful (green), aborted (orange), and exception (red) executions"
              }
            }
          ]
        },
        "tileSettings": {
          "titleContent": {
            "formatter": 1,
            "tooltipFormat": {
              "tooltip": "Query rank"
            }
          },
          "leftContent": {
            "columnMatch": "rank",
            "formatter": 12,
            "formatOptions": {
              "palette": "none"
            },
            "tooltipFormat": {
              "tooltip": "Query rank"
            }
          },
          "rightContent": {
            "columnMatch": "ranked_metric",
            "formatter": 4,
            "formatOptions": {
              "palette": "coldHot"
            },
            "numberFormat": {
              "unit": 2,
              "options": {
                "style": "decimal",
                "maximumFractionDigits": 2
              }
            },
            "tooltipFormat": {
              "tooltip": "Query runtime statistic"
            }
          },
          "secondaryContent": {
            "columnMatch": "tile_label",
            "formatter": 1
          },
          "showBorder": true,
          "sortCriteriaField": "rank",
          "sortOrderField": 1,
          "size": "auto"
        }
      },
      "conditionalVisibilities": [
        {
          "parameterName": "qdsMetric",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsAggregation",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsTopQueryCount",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsAggBy",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "showQueriesAs",
          "comparison": "isEqualTo",
          "value": "tiles"
        },
        {
          "parameterName": "qdsMetricUnit",
          "comparison": "isEqualTo",
          "value": "bytes"
        },
        {
          "parameterName": "qdsStartTime",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsEndTime",
          "comparison": "isNotEqualTo"
        }
      ],
      "name": "qds_top_queries_tiles_bytes"
    },
    {
      "type": 1,
      "content": {
        "json": "Each tile represents a query (if aggregating by `Query ID`) or all queries with the same query hash (if aggregating by `Query hash`). The large number on the tile is **query rank** by `{qdsAggregation} {qdsMetricLabelMidsentenceCase}`. Two queries have the same rank if their resource usage during the interval is the same.Each tile represents all queries with the same query hash. The large number on the tile is **query rank** by `{qdsAggregation} {qdsMetricLabelMidsentenceCase}`. Two queries have the same rank if their resource usage during the interval is the same.\r\n\r\nThe tile also shows `{qdsAggregation} {qdsMetricLabelMidsentenceCase}` value, aggregated over selected time range. The length of the bar below this value is proportional to resource usage by this query, compared to other top queries displayed.\r\n\r\nThe `Query hash` value is displayed at the bottom of each tile. You can copy it and paste it in the `Query hash` parameter box above to focus on a specific top query.\r\n\r\nThe tile also shows `{qdsAggregation} {qdsMetricLabelMidsentenceCase}` value, aggregated over selected time range. The length of the bar below this value is proportional to resource usage by this query, compared to other top queries displayed.\r\n\r\n`Query ID` or `Query hash` values are displayed at the bottom of each tile. You can copy these values and paste them in the parameter boxes above to focus on specific top queries."
      },
      "conditionalVisibilities": [
        {
          "parameterName": "showDescriptions",
          "comparison": "isEqualTo",
          "value": "true"
        },
        {
          "parameterName": "showQueriesAs",
          "comparison": "isEqualTo",
          "value": "tiles"
        },
        {
          "parameterName": "qdsMetric",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsAggregation",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsTopQueryCount",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsStartTime",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsEndTime",
          "comparison": "isNotEqualTo"
        }
      ],
      "name": "qds_tiles_help"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"sqldb_single_database_query_runtime_stats\\r\\n| where interval_start_time >= todatetime(\\\"{qdsStartTime}\\\") and interval_end_time <= todatetime(\\\"{qdsEndTime}\\\")\\r\\n| where logical_server_name =~ @\\\"{serverName}\\\"\\r\\n| where database_name == @\\\"{databaseName}\\\"\\r\\n| where replica_type == \\\"{qdsCollectionReplicaType}\\\"\\r\\n| where execution_type in ({qdsExecutionType})\\r\\n| summarize dcount_query_id = dcount(query_id),\\r\\n            any_query_id = take_any(query_id),\\r\\n            dcount_sql_module_name = dcount(sql_module_name),\\r\\n            any_sql_module_name = take_any(sql_module_name),\\r\\n            dcount_context_settings_id = dcount(context_settings_id),\\r\\n            any_context_settings_id = take_any(context_settings_id),\\r\\n            dcount_plan_id = dcount(plan_id),\\r\\n            plan_id = take_any(plan_id),\\r\\n            query_sql_text = take_any(query_sql_text),\\r\\n            count_executions = case(\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"avg\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", round(avg(count_executions), 2),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"min\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", min(toreal(count_executions)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"max\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", max(toreal(count_executions)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"stdev\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", max(toreal(count_executions)),\\r\\n                                   \\\"{qdsAggregation}\\\" in (\\\"total\\\",\\\"avg\\\",\\\"min\\\",\\\"max\\\",\\\"stdev\\\"), sum(toreal(count_executions)),\\r\\n                                   real(null)\\r\\n                                   ),\\r\\n            count_successful_executions = case(\\r\\n                                              \\\"{qdsAggregation}\\\"==\\\"avg\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", round(avgif(count_executions, execution_type_desc == \\\"Regular\\\"), 2),\\r\\n                                              \\\"{qdsAggregation}\\\"==\\\"min\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", minif(toreal(count_executions), execution_type_desc == \\\"Regular\\\"),\\r\\n                                              \\\"{qdsAggregation}\\\"==\\\"max\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", maxif(toreal(count_executions), execution_type_desc == \\\"Regular\\\"),\\r\\n                                              \\\"{qdsAggregation}\\\"==\\\"stdev\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", maxif(toreal(count_executions), execution_type_desc == \\\"Regular\\\"),\\r\\n                                              \\\"{qdsAggregation}\\\" in (\\\"total\\\",\\\"avg\\\",\\\"min\\\",\\\"max\\\",\\\"stdev\\\"), sumif(toreal(count_executions), execution_type_desc == \\\"Regular\\\"),\\r\\n                                              real(null)\\r\\n                                              ),\\r\\n            count_aborted_executions = case(\\r\\n                                           \\\"{qdsAggregation}\\\"==\\\"avg\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", round(avgif(count_executions, execution_type_desc == \\\"Aborted\\\"), 2),\\r\\n                                           \\\"{qdsAggregation}\\\"==\\\"min\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", minif(toreal(count_executions), execution_type_desc == \\\"Aborted\\\"),\\r\\n                                           \\\"{qdsAggregation}\\\"==\\\"max\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", maxif(toreal(count_executions), execution_type_desc == \\\"Aborted\\\"),\\r\\n                                           \\\"{qdsAggregation}\\\"==\\\"stdev\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", maxif(toreal(count_executions), execution_type_desc == \\\"Aborted\\\"),\\r\\n                                           \\\"{qdsAggregation}\\\" in (\\\"total\\\",\\\"avg\\\",\\\"min\\\",\\\"max\\\",\\\"stdev\\\"), sumif(toreal(count_executions), execution_type_desc == \\\"Aborted\\\"),\\r\\n                                           real(null)\\r\\n                                           ),\\r\\n            count_exception_executions = case(\\r\\n                                             \\\"{qdsAggregation}\\\"==\\\"avg\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", round(avgif(count_executions, execution_type_desc == \\\"Exception\\\"), 2),\\r\\n                                             \\\"{qdsAggregation}\\\"==\\\"min\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", minif(toreal(count_executions), execution_type_desc == \\\"Exception\\\"),\\r\\n                                             \\\"{qdsAggregation}\\\"==\\\"max\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", maxif(toreal(count_executions), execution_type_desc == \\\"Exception\\\"),\\r\\n                                             \\\"{qdsAggregation}\\\"==\\\"stdev\\\" and \\\"{qdsMetric}\\\"==\\\"count_executions\\\", maxif(toreal(count_executions), execution_type_desc == \\\"Exception\\\"),\\r\\n                                             \\\"{qdsAggregation}\\\" in (\\\"total\\\",\\\"avg\\\",\\\"min\\\",\\\"max\\\",\\\"stdev\\\"), sumif(toreal(count_executions), execution_type_desc == \\\"Exception\\\"),\\r\\n                                             real(null)\\r\\n                                             ),\\r\\n            duration_us = case(\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_duration_us * count_executions),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_duration_us),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_duration_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_duration_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_cpu_time_us), // use maximum stdev for the interval\\r\\n                              real(null)\\r\\n                              ),\\r\\n            cpu_time_us = case(\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_cpu_time_us * count_executions),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_cpu_time_us),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_cpu_time_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_cpu_time_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_cpu_time_us),\\r\\n                              real(null)\\r\\n                              ),\\r\\n            logical_io_reads = case(\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_logical_io_reads * count_executions),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_logical_io_reads),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_logical_io_reads)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_logical_io_reads)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_logical_io_reads),\\r\\n                                   real(null)\\r\\n                                   ),\\r\\n            logical_io_writes = case(\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_logical_io_writes * count_executions),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_logical_io_writes),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_logical_io_writes)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_logical_io_writes)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_logical_io_writes),\\r\\n                                    real(null)\\r\\n                                    ),\\r\\n            physical_io_reads = case(\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_physical_io_reads * count_executions),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_physical_io_reads),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_physical_io_reads)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_physical_io_reads)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_physical_io_reads),\\r\\n                                    real(null)\\r\\n                                    ),\\r\\n            num_physical_io_reads = case(\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_num_physical_io_reads * count_executions),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_num_physical_io_reads),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_num_physical_io_reads)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_num_physical_io_reads)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_num_physical_io_reads),\\r\\n                                        real(null)\\r\\n                                        ),\\r\\n            clr_time_us = case(\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_clr_time_us * count_executions),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_clr_time_us),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_clr_time_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_clr_time_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_clr_time_us),\\r\\n                              real(null)\\r\\n                              ),\\r\\n            dop = case(\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"total\\\", sumif(avg_dop * count_executions, is_parallel_plan), // Total DOP for serial queries is meaningless, show as zero\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_dop),\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_dop)),\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_dop)),\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_dop),\\r\\n                      real(null)\\r\\n                      ),\\r\\n            query_max_used_memory = case(\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_query_max_used_memory * count_executions),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_query_max_used_memory),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_query_max_used_memory)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_query_max_used_memory)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_query_max_used_memory),\\r\\n                                        real(null)\\r\\n                                        ),\\r\\n            rowcount = case(\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_rowcount * count_executions),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_rowcount),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_rowcount)),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_rowcount)),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_rowcount),\\r\\n                           real(null)\\r\\n                           ),\\r\\n            log_bytes_used = case(\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_log_bytes_used * count_executions),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_log_bytes_used),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_log_bytes_used)),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_log_bytes_used)),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_log_bytes_used),\\r\\n                                 real(null)\\r\\n                                 ),\\r\\n            tempdb_space_used = case(\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_tempdb_space_used * count_executions),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_tempdb_space_used),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_tempdb_space_used)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_tempdb_space_used)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_tempdb_space_used),\\r\\n                                    real(null)\\r\\n                                    ),\\r\\n            page_server_io_reads = case(\\r\\n                                       \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_page_server_io_reads * count_executions),\\r\\n                                       \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_page_server_io_reads),\\r\\n                                       \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_page_server_io_reads)),\\r\\n                                       \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_page_server_io_reads)),\\r\\n                                       \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_page_server_io_reads),\\r\\n                                       real(null)\\r\\n                                       ),\\r\\n            sql_module_name = iif(\\\"{qdsAggBy}\\\"==\\\"query_id\\\", take_any(sql_module_name), \\\"\\\"),\\r\\n            context_settings_id = iif(\\\"{qdsAggBy}\\\"==\\\"query_id\\\", take_any(context_settings_id), long(null))\\r\\n            by query_hash,\\r\\n               query_id = iif(\\\"{qdsAggBy}\\\"==\\\"query_id\\\", query_id, long(null))\\r\\n| extend query_id = iif(isnull(query_id), any_query_id, query_id),\\r\\n         multi_query_text_warning = iif(dcount_query_id > 1, strcat(\\\"There are \\\", tostring(dcount_query_id), \\\" distinct queries for this query hash. Displayed query text and query details are for one of these \\\", tostring(dcount_query_id), \\\" queries. To see query text and details for a specific query, use aggregation by Query ID.\\\"), \\\"\\\")\\r\\n| project query_hash,\\r\\n          query_id_agg = iif(dcount_query_id == 1, tostring(query_id), strcat(query_id, \\\" (+\\\", tostring(dcount_query_id - 1), \\\")\\\")),\\r\\n          plan_id_agg = iif(dcount_plan_id == 1, tostring(plan_id), strcat(plan_id, \\\" (+\\\", tostring(dcount_plan_id - 1), \\\")\\\")),\\r\\n          query_sql_text,\\r\\n          count_executions,\\r\\n          count_successful_executions,\\r\\n          count_aborted_executions,\\r\\n          count_exception_executions,\\r\\n          duration_us,\\r\\n          cpu_time_us,\\r\\n          logical_io_reads,\\r\\n          logical_io_writes,\\r\\n          physical_io_reads,\\r\\n          num_physical_io_reads,\\r\\n          clr_time_us,\\r\\n          dop,\\r\\n          query_max_used_memory_kb = query_max_used_memory * 8,\\r\\n          rowcount,\\r\\n          log_bytes_used,\\r\\n          tempdb_space_used_kb = tempdb_space_used * 8,\\r\\n          page_server_io_reads,\\r\\n          q_id = query_id, //workaround for a bug where a column with a name that contains the name of a hidden column is incorrectly hidden\\r\\n          sql_module_name_agg = iif(dcount_sql_module_name == 1, any_sql_module_name, strcat(any_sql_module_name, \\\" (+\\\", tostring(dcount_sql_module_name - 1), \\\")\\\")),\\r\\n          context_settings_id_agg = iif(dcount_context_settings_id == 1, tostring(any_context_settings_id), strcat(any_context_settings_id, \\\" (+\\\", tostring(dcount_context_settings_id - 1), \\\")\\\")),\\r\\n          query_sql_text_json = dynamic_to_json(pack(\\\"query_sql_text\\\", query_sql_text)),\\r\\n          multi_query_text_warning\\r\\n| sort by count_executions desc | extend count_executions_rank = row_rank(count_executions)\\r\\n| sort by duration_us desc | extend duration_rank = row_rank(duration_us)\\r\\n| sort by cpu_time_us desc | extend cpu_time_rank = row_rank(cpu_time_us)\\r\\n| sort by logical_io_reads desc | extend logical_io_reads_rank = row_rank(logical_io_reads)\\r\\n| sort by logical_io_writes desc | extend logical_io_writes_rank = row_rank(logical_io_writes)\\r\\n| sort by physical_io_reads desc | extend physical_io_reads_rank = row_rank(physical_io_reads)\\r\\n| sort by num_physical_io_reads desc | extend num_physical_io_reads_rank = row_rank(num_physical_io_reads)\\r\\n| sort by clr_time_us desc | extend clr_time_rank = row_rank(clr_time_us)\\r\\n| sort by dop desc | extend dop_rank = row_rank(dop)\\r\\n| sort by query_max_used_memory_kb desc | extend query_max_used_memory_rank = row_rank(query_max_used_memory_kb)\\r\\n| sort by rowcount desc | extend rowcount_rank = row_rank(rowcount)\\r\\n| sort by log_bytes_used desc | extend log_bytes_used_rank = row_rank(log_bytes_used)\\r\\n| sort by tempdb_space_used_kb desc | extend tempdb_space_used_rank = row_rank(tempdb_space_used_kb)\\r\\n| sort by page_server_io_reads desc | extend page_server_io_reads_rank = row_rank(page_server_io_reads)\\r\\n| extend ranks = dynamic_to_json(pack_array(\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Executions\\\", \\\"Rank\\\", count_executions_rank, \\\"Value\\\", count_executions),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Duration\\\", \\\"Rank\\\", duration_rank, \\\"Value\\\", duration_us),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"CPU time\\\", \\\"Rank\\\", cpu_time_rank, \\\"Value\\\", cpu_time_us),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Logical reads\\\", \\\"Rank\\\", logical_io_reads_rank, \\\"Value\\\", logical_io_reads),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Logical writes\\\", \\\"Rank\\\", logical_io_writes_rank, \\\"Value\\\", logical_io_writes),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Physical reads (pages)\\\", \\\"Rank\\\", physical_io_reads_rank, \\\"Value\\\", physical_io_reads),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Physical reads (IOs)\\\", \\\"Rank\\\", num_physical_io_reads_rank, \\\"Value\\\", num_physical_io_reads),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"CLR time\\\", \\\"Rank\\\", clr_time_rank, \\\"Value\\\", clr_time_us),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"DOP\\\", \\\"Rank\\\", dop_rank, \\\"Value\\\", dop),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Memory grant\\\", \\\"Rank\\\", query_max_used_memory_rank, \\\"Value\\\", query_max_used_memory_kb),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Row count\\\", \\\"Rank\\\", rowcount_rank, \\\"Value\\\", rowcount),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Transaction log space used\\\", \\\"Rank\\\", log_bytes_used_rank, \\\"Value\\\", log_bytes_used),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Tempdb space used\\\", \\\"Rank\\\", tempdb_space_used_rank, \\\"Value\\\", tempdb_space_used_kb),\\r\\n                                           bag_pack(\\\"Metric\\\", \\\"Page server reads (pages)\\\", \\\"Rank\\\", page_server_io_reads_rank, \\\"Value\\\", page_server_io_reads)\\r\\n                                           ))\\r\\n| project-away count_executions_rank, duration_rank, cpu_time_rank, logical_io_reads_rank, logical_io_writes_rank, physical_io_reads_rank, num_physical_io_reads_rank, clr_time_rank, dop_rank, query_max_used_memory_rank, rowcount_rank, log_bytes_used_rank, tempdb_space_used_rank, page_server_io_reads_rank\\r\\n| sort by case(\\r\\n              \\\"{qdsMetric}\\\"==\\\"count_executions\\\", toreal(count_executions),\\r\\n              \\\"{qdsMetric}\\\"==\\\"duration\\\", toreal(duration_us),\\r\\n              \\\"{qdsMetric}\\\"==\\\"cpu_time\\\", toreal(cpu_time_us),\\r\\n              \\\"{qdsMetric}\\\"==\\\"logical_io_reads\\\", toreal(logical_io_reads),\\r\\n              \\\"{qdsMetric}\\\"==\\\"logical_io_writes\\\", toreal(logical_io_writes),\\r\\n              \\\"{qdsMetric}\\\"==\\\"physical_io_reads\\\", toreal(physical_io_reads),\\r\\n              \\\"{qdsMetric}\\\"==\\\"num_physical_io_reads\\\", toreal(num_physical_io_reads),\\r\\n              \\\"{qdsMetric}\\\"==\\\"clr_time\\\", toreal(clr_time_us),\\r\\n              \\\"{qdsMetric}\\\"==\\\"dop\\\", toreal(dop),\\r\\n              \\\"{qdsMetric}\\\"==\\\"query_max_used_memory\\\", toreal(query_max_used_memory_kb),\\r\\n              \\\"{qdsMetric}\\\"==\\\"rowcount\\\", toreal(rowcount),\\r\\n              \\\"{qdsMetric}\\\"==\\\"log_bytes_used\\\", toreal(log_bytes_used),\\r\\n              \\\"{qdsMetric}\\\"==\\\"tempdb_space_used\\\", toreal(tempdb_space_used_kb),\\r\\n              \\\"{qdsMetric}\\\"==\\\"page_server_io_reads\\\", toreal(page_server_io_reads),\\r\\n              real(null)\\r\\n              ) desc,\\r\\n          count_executions desc // secondary sort for determinism when primary sort is tied\\r\\n// Restrict by query_id/query_hash after ranking to preserve query rank value in results\\r\\n| where q_id == iif(isnotempty(@\\\"{qdsQueryId}\\\"), tolong(@\\\"{qdsQueryId}\\\"), q_id)\\r\\n| where query_hash == iif(isnotempty(@\\\"{qdsQueryHash}\\\"), @\\\"{qdsQueryHash}\\\", query_hash)\\r\\n| take {qdsTopQueryCount}\\r\\n;\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
        "size": 0,
        "showAnalytics": true,
        "title": "Top queries by {qdsAggregation} {qdsMetricLabelMidsentenceCase}",
        "noDataMessage": "There is no data for specified parameters.",
        "exportedParameters": [
          {
            "fieldName": "query_sql_text_json",
            "parameterName": "query_sql_text_json",
            "defaultValue": "\"<Select a query>\""
          },
          {
            "fieldName": "q_id",
            "parameterName": "query_id",
            "parameterType": 1,
            "defaultValue": "0"
          },
          {
            "fieldName": "query_hash",
            "parameterName": "query_hash",
            "parameterType": 1,
            "defaultValue": "\"\""
          },
          {
            "fieldName": "multi_query_text_warning",
            "parameterName": "multi_query_text_warning",
            "parameterType": 1
          },
          {
            "fieldName": "ranks",
            "parameterName": "ranks",
            "parameterType": 1,
            "defaultValue": ""
          }
        ],
        "showExportToExcel": true,
        "queryType": 9,
        "visualization": "table",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "count_executions",
              "formatter": 22,
              "formatOptions": {
                "compositeBarSettings": {
                  "labelText": "",
                  "columnSettings": [
                    {
                      "columnName": "count_successful_executions",
                      "color": "green"
                    },
                    {
                      "columnName": "count_aborted_executions",
                      "color": "orange"
                    },
                    {
                      "columnName": "count_exception_executions",
                      "color": "red"
                    }
                  ]
                }
              },
              "tooltipFormat": {
                "tooltip": "Successful (green), aborted (orange), and exception (red) executions"
              }
            },
            {
              "columnMatch": "count_successful_executions",
              "formatter": 5
            },
            {
              "columnMatch": "count_aborted_executions",
              "formatter": 5
            },
            {
              "columnMatch": "count_exception_executions",
              "formatter": 5
            },
            {
              "columnMatch": "duration_us",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "18ch"
              },
              "numberFormat": {
                "unit": 22,
                "options": {
                  "style": "decimal",
                  "useGrouping": true,
                  "maximumFractionDigits": 2
                }
              }
            },
            {
              "columnMatch": "cpu_time_us",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "18ch"
              },
              "numberFormat": {
                "unit": 22,
                "options": {
                  "style": "decimal",
                  "useGrouping": true,
                  "maximumFractionDigits": 2
                }
              }
            },
            {
              "columnMatch": "logical_io_reads",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "18ch"
              },
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal",
                  "useGrouping": true,
                  "maximumFractionDigits": 2
                }
              }
            },
            {
              "columnMatch": "logical_io_writes",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "18ch"
              },
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal",
                  "useGrouping": true,
                  "maximumFractionDigits": 2
                }
              }
            },
            {
              "columnMatch": "physical_io_reads",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "24ch"
              },
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal",
                  "useGrouping": true,
                  "maximumFractionDigits": 2
                }
              }
            },
            {
              "columnMatch": "num_physical_io_reads",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "24ch"
              },
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal",
                  "useGrouping": true,
                  "maximumFractionDigits": 2
                }
              }
            },
            {
              "columnMatch": "clr_time_us",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "18ch"
              },
              "numberFormat": {
                "unit": 22,
                "options": {
                  "style": "decimal",
                  "useGrouping": true,
                  "maximumFractionDigits": 2
                }
              }
            },
            {
              "columnMatch": "dop",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "14ch"
              },
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal",
                  "useGrouping": true,
                  "maximumFractionDigits": 2
                }
              }
            },
            {
              "columnMatch": "query_max_used_memory_kb",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "18ch"
              },
              "numberFormat": {
                "unit": 3,
                "options": {
                  "style": "decimal",
                  "useGrouping": true,
                  "maximumFractionDigits": 2
                }
              }
            },
            {
              "columnMatch": "rowcount",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "18ch"
              },
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal",
                  "useGrouping": true,
                  "maximumFractionDigits": 2
                }
              }
            },
            {
              "columnMatch": "log_bytes_used",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "18ch"
              },
              "numberFormat": {
                "unit": 2,
                "options": {
                  "style": "decimal",
                  "useGrouping": true,
                  "maximumFractionDigits": 2
                }
              }
            },
            {
              "columnMatch": "tempdb_space_used_kb",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "18ch"
              },
              "numberFormat": {
                "unit": 3,
                "options": {
                  "style": "decimal",
                  "useGrouping": true,
                  "maximumFractionDigits": 2
                }
              }
            },
            {
              "columnMatch": "page_server_io_reads",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "20ch"
              },
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal",
                  "useGrouping": false,
                  "maximumFractionDigits": 2
                }
              }
            },
            {
              "columnMatch": "q_id",
              "formatter": 5
            },
            {
              "columnMatch": "sql_module_name_agg",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "18ch"
              },
              "tooltipFormat": {
                "tooltip": "Available when aggregating by Query ID"
              }
            },
            {
              "columnMatch": "context_settings_id_agg",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "22ch"
              },
              "tooltipFormat": {
                "tooltip": "Available when aggregating by Query ID"
              }
            },
            {
              "columnMatch": "query_sql_text_json",
              "formatter": 5
            },
            {
              "columnMatch": "multi_query_text_warning",
              "formatter": 5
            },
            {
              "columnMatch": "ranks",
              "formatter": 5
            }
          ],
          "filter": true,
          "labelSettings": [
            {
              "columnId": "query_hash",
              "label": "Query hash"
            },
            {
              "columnId": "query_id_agg",
              "label": "Query ID"
            },
            {
              "columnId": "plan_id_agg",
              "label": "Plan ID"
            },
            {
              "columnId": "query_sql_text",
              "label": "Query text"
            },
            {
              "columnId": "count_executions",
              "label": "Executions"
            },
            {
              "columnId": "duration_us",
              "label": "Duration"
            },
            {
              "columnId": "cpu_time_us",
              "label": "CPU time"
            },
            {
              "columnId": "logical_io_reads",
              "label": "Logical reads"
            },
            {
              "columnId": "logical_io_writes",
              "label": "Logical writes"
            },
            {
              "columnId": "physical_io_reads",
              "label": "Physical reads (pages)"
            },
            {
              "columnId": "num_physical_io_reads",
              "label": "Physical reads (IOs)"
            },
            {
              "columnId": "clr_time_us",
              "label": "CLR time"
            },
            {
              "columnId": "dop",
              "label": "DOP"
            },
            {
              "columnId": "query_max_used_memory_kb",
              "label": "Memory grant"
            },
            {
              "columnId": "rowcount",
              "label": "Rows"
            },
            {
              "columnId": "log_bytes_used",
              "label": "Log space"
            },
            {
              "columnId": "tempdb_space_used_kb",
              "label": "Tempdb space"
            },
            {
              "columnId": "page_server_io_reads",
              "label": "Page server reads"
            },
            {
              "columnId": "sql_module_name_agg",
              "label": "SQL module"
            },
            {
              "columnId": "context_settings_id_agg",
              "label": "Context settings ID"
            }
          ]
        }
      },
      "conditionalVisibilities": [
        {
          "parameterName": "qdsMetric",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsAggregation",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsTopQueryCount",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsAggBy",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "showQueriesAs",
          "comparison": "isEqualTo",
          "value": "grid"
        },
        {
          "parameterName": "qdsStartTime",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsEndTime",
          "comparison": "isNotEqualTo",
          "value": ""
        }
      ],
      "name": "qds_top_queries_grid"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "ef3541b2-fdd5-4705-8689-b9ce167c1767",
            "version": "KqlParameterItem/1.0",
            "name": "qdsAnyWaits",
            "type": 1,
            "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"sqldb_single_database_query_wait_stats\\r\\n| where interval_start_time >= todatetime(\\\"{qdsStartTime}\\\") and interval_end_time <= todatetime(\\\"{qdsEndTime}\\\")\\r\\n| where logical_server_name =~ @\\\"{serverName}\\\"\\r\\n| where database_name == @\\\"{databaseName}\\\"\\r\\n| where replica_type == \\\"{qdsCollectionReplicaType}\\\"\\r\\n| where query_id == iif(\\\"{qdsAggBy}\\\"==\\\"query_id\\\", {query_id}, query_id)\\r\\n| where query_hash == iif(\\\"{qdsAggBy}\\\"==\\\"query_hash\\\", \\\"{query_hash}\\\", query_hash)\\r\\n| count\\r\\n| project Count = tostring(Count)\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 9
          }
        ],
        "style": "pills",
        "queryType": 9
      },
      "conditionalVisibility": {
        "parameterName": "sqldb_single_database_query_wait_stats",
        "comparison": "isEqualTo",
        "value": "1"
      },
      "name": "qds_waits_existence_parameters"
    },
    {
      "type": 1,
      "content": {
        "json": "{multi_query_text_warning}",
        "style": "info"
      },
      "conditionalVisibilities": [
        {
          "parameterName": "multi_query_text_warning",
          "comparison": "isNotEqualTo",
          "value": ""
        },
        {
          "parameterName": "multi_query_text_warning",
          "comparison": "isNotEqualTo",
          "value": "\"\""
        }
      ],
      "name": "multi_query_text_warning"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"datatable(ranks:dynamic)[dynamic({ranks})]\\r\\n| mv-expand bagexpansion=array ranks\\r\\n| mv-expand metric = ranks.Metric to typeof(string), rank = ranks.Rank to typeof(int), value = ranks.Value to typeof(real)\\r\\n| where value > 0 // Do not include high ranks if usage is zero\\r\\n| where not (metric==\\\"DOP\\\" and value==1 or metric==\\\"Executions\\\" and value==1 or metric==\\\"Rows\\\" and value==1) // Do not consider trivial usage\\r\\n| project r=rank, metric, rank\\r\\n| sort by rank asc, metric asc;\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
        "size": 1,
        "title": "Query ranks",
        "noDataMessage": "Selected query is not ranked high by any metric",
        "queryType": 9,
        "visualization": "table",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "r",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "<=",
                    "thresholdValue": "1",
                    "representation": "Sev0",
                    "text": "[\"metric\"]"
                  },
                  {
                    "operator": "<=",
                    "thresholdValue": "3",
                    "representation": "Sev1",
                    "text": "[\"metric\"]"
                  },
                  {
                    "operator": "<=",
                    "thresholdValue": "10",
                    "representation": "Sev2",
                    "text": "[\"metric\"]"
                  },
                  {
                    "operator": "<=",
                    "thresholdValue": "20",
                    "representation": "Sev3",
                    "text": "[\"metric\"]"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "Sev4",
                    "text": "[\"metric\"]"
                  }
                ],
                "customColumnWidthSetting": "27ch"
              }
            },
            {
              "columnMatch": "metric",
              "formatter": 5
            },
            {
              "columnMatch": "rank",
              "formatter": 0,
              "tooltipFormat": {
                "tooltip": "Lower numbers mean higher ranks, i.e. higher resource consumption for this metric"
              }
            }
          ],
          "labelSettings": [
            {
              "columnId": "r",
              "label": "Metric"
            },
            {
              "columnId": "rank",
              "label": "Rank"
            }
          ]
        },
        "sortBy": [],
        "tileSettings": {
          "titleContent": {
            "formatter": 1
          },
          "leftContent": {
            "columnMatch": "rank",
            "formatter": 12,
            "formatOptions": {
              "palette": "hotCold"
            },
            "tooltipFormat": {
              "tooltip": "Rank 1 by \"CPU time\" means that the query is the top consumer of CPU, compared to other queries in the same time interval. The metrics ranked in the 1-10 range, if any for this query, are shown."
            }
          },
          "rightContent": {
            "columnMatch": "metric",
            "formatter": 1
          },
          "showBorder": true,
          "sortCriteriaField": "rank",
          "sortOrderField": 1,
          "size": "auto"
        }
      },
      "conditionalVisibilities": [
        {
          "parameterName": "qdsMetric",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsAggregation",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsTopQueryCount",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsAggBy",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "ranks",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsStartTime",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsEndTime",
          "comparison": "isNotEqualTo"
        }
      ],
      "customWidth": "25",
      "name": "top_query_ranks"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"sqldb_single_database_query_wait_stats\\r\\n| where interval_start_time >= todatetime(\\\"{qdsStartTime}\\\") and interval_end_time <= todatetime(\\\"{qdsEndTime}\\\")\\r\\n| where logical_server_name =~ @\\\"{serverName}\\\"\\r\\n| where database_name == @\\\"{databaseName}\\\"\\r\\n| where replica_type == \\\"{qdsCollectionReplicaType}\\\"\\r\\n| where execution_type in ({qdsExecutionType})\\r\\n| where query_id == iif(\\\"{qdsAggBy}\\\"==\\\"query_id\\\", {query_id}, query_id)\\r\\n| where query_hash == iif(\\\"{qdsAggBy}\\\"==\\\"query_hash\\\", \\\"{query_hash}\\\", query_hash)\\r\\n| summarize query_wait_time_ms = case(\\r\\n                                     \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(toreal(total_query_wait_time_ms)),\\r\\n                                     \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_query_wait_time_ms),\\r\\n                                     \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_query_wait_time_ms)),\\r\\n                                     \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_query_wait_time_ms)),\\r\\n                                     \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_query_wait_time_ms), // use maximum stdev for the interval\\r\\n                                     real(null)\\r\\n                                     )\\r\\n            by wait_category_desc\\r\\n\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
        "size": 1,
        "title": "Query wait categories",
        "noDataMessage": "There is no data for specified parameters.",
        "queryType": 9,
        "visualization": "barchart",
        "chartSettings": {
          "yAxis": [
            "query_wait_time_ms"
          ],
          "showMetrics": false,
          "seriesLabelSettings": [
            {
              "seriesName": "Unknown",
              "color": "gray"
            },
            {
              "seriesName": "CPU",
              "color": "magenta"
            },
            {
              "seriesName": "Worker Thread",
              "color": "brown"
            },
            {
              "seriesName": "Lock",
              "color": "redBright"
            },
            {
              "seriesName": "Latch",
              "color": "blueDark"
            },
            {
              "seriesName": "Buffer Latch",
              "color": "purple"
            },
            {
              "seriesName": "Buffer IO",
              "color": "lightBlue"
            },
            {
              "seriesName": "Tran Log IO",
              "color": "green"
            },
            {
              "seriesName": "Network IO",
              "color": "greenDark"
            },
            {
              "seriesName": "Parallelism",
              "color": "orange"
            },
            {
              "seriesName": "Memory",
              "color": "turquoise"
            },
            {
              "seriesName": "Other Disk IO",
              "color": "grayBlue"
            },
            {
              "seriesName": "Replication",
              "color": "pink"
            },
            {
              "seriesName": "Log Rate Governor",
              "color": "red"
            }
          ],
          "ySettings": {
            "numberFormatSettings": {
              "unit": 23,
              "options": {
                "style": "decimal",
                "useGrouping": true,
                "maximumFractionDigits": 2
              }
            }
          }
        }
      },
      "conditionalVisibilities": [
        {
          "parameterName": "query_hash",
          "comparison": "isNotEqualTo",
          "value": "\"\""
        },
        {
          "parameterName": "qdsMetric",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsAggregation",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsTopQueryCount",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "sqldb_single_database_query_wait_stats",
          "comparison": "isEqualTo",
          "value": "1"
        },
        {
          "parameterName": "qdsAnyWaits",
          "comparison": "isNotEqualTo",
          "value": "0"
        },
        {
          "parameterName": "showQueriesAs",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsStartTime",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsEndTime",
          "comparison": "isNotEqualTo"
        }
      ],
      "customWidth": "25",
      "name": "qds_query_wait_categories"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "{\"version\":\"1.0.0\",\"content\":\"{query_sql_text_json}\",\"transformers\":null}",
        "size": 1,
        "title": "Query SQL text",
        "noDataMessage": "Unknown",
        "queryType": 8,
        "visualization": "card",
        "textSettings": {
          "style": "editor"
        }
      },
      "conditionalVisibilities": [
        {
          "parameterName": "query_hash",
          "comparison": "isNotEqualTo",
          "value": "\"\""
        },
        {
          "parameterName": "qdsMetric",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsAggregation",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsTopQueryCount",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "showQueriesAs",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsStartTime",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsEndTime",
          "comparison": "isNotEqualTo"
        }
      ],
      "customWidth": "50",
      "name": "query_sql_text"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Query details",
        "expandable": true,
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"let query_property = datatable(key:int, query_property_name:string) [\\r\\n1, \\\"query_hash\\\",\\r\\n1, \\\"sql_module_name\\\"\\r\\n];\\r\\nsqldb_single_database_query_runtime_stats\\r\\n| where interval_start_time >= todatetime(\\\"{qdsStartTime}\\\") and interval_end_time <= todatetime(\\\"{qdsEndTime}\\\")\\r\\n| where logical_server_name =~ @\\\"{serverName}\\\"\\r\\n| where database_name == @\\\"{databaseName}\\\"\\r\\n| where replica_type == \\\"{qdsCollectionReplicaType}\\\"\\r\\n| where query_id == {query_id}\\r\\n| summarize arg_max(interval_end_time, query_hash, sql_module_name) // get query details from the last row in the time range\\r\\n| extend key = int(1)\\r\\n| join kind=inner query_property on key\\r\\n| project query_property_name, query_hash, sql_module_name\\r\\n| extend query_property_value = case(\\r\\n                                    query_property_name == \\\"query_hash\\\", query_hash,\\r\\n                                    query_property_name == \\\"sql_module_name\\\", sql_module_name,\\r\\n                                    \\\"\\\"\\r\\n                                    )\\r\\n| project-away query_hash, sql_module_name\\r\\n| sort by query_property_name asc;\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
              "size": 3,
              "showAnalytics": true,
              "noDataMessage": "There is no data for specified parameters.",
              "showExportToExcel": true,
              "queryType": 9,
              "gridSettings": {
                "labelSettings": [
                  {
                    "columnId": "query_property_name",
                    "label": "Property"
                  },
                  {
                    "columnId": "query_property_value",
                    "label": "Value"
                  }
                ]
              }
            },
            "customWidth": "33",
            "name": "query_details_string"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"let query_property = datatable(key:int, query_property_name:string) [\\r\\n1, \\\"query_id\\\",\\r\\n1, \\\"context_settings_id\\\",\\r\\n1, \\\"sql_module_object_id\\\",\\r\\n1, \\\"query_count_compiles\\\"\\r\\n];\\r\\nsqldb_single_database_query_runtime_stats\\r\\n| where interval_start_time >= todatetime(\\\"{qdsStartTime}\\\") and interval_end_time <= todatetime(\\\"{qdsEndTime}\\\")\\r\\n| where logical_server_name =~ @\\\"{serverName}\\\"\\r\\n| where database_name == @\\\"{databaseName}\\\"\\r\\n| where replica_type == \\\"{qdsCollectionReplicaType}\\\"\\r\\n| where query_id == {query_id}\\r\\n| summarize arg_max(interval_end_time, query_id, context_settings_id, sql_module_object_id, query_count_compiles) // get query details from the last row in the time range\\r\\n| extend key = int(1)\\r\\n| join kind=inner query_property on key\\r\\n| project query_property_name, query_id, context_settings_id, sql_module_object_id, query_count_compiles\\r\\n| extend query_property_value = case(\\r\\n                                    query_property_name == \\\"query_id\\\", query_id,\\r\\n                                    query_property_name == \\\"context_settings_id\\\", context_settings_id,\\r\\n                                    query_property_name == \\\"sql_module_object_id\\\", sql_module_object_id,\\r\\n                                    query_property_name == \\\"query_count_compiles\\\", query_count_compiles,\\r\\n                                    long(null)\\r\\n                                    )\\r\\n| project-away query_id, context_settings_id, sql_module_object_id, query_count_compiles\\r\\n| sort by query_property_name asc;\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
              "size": 3,
              "showAnalytics": true,
              "noDataMessage": "There is no data for specified parameters.",
              "showExportToExcel": true,
              "queryType": 9,
              "gridSettings": {
                "labelSettings": [
                  {
                    "columnId": "query_property_name",
                    "label": "Property"
                  },
                  {
                    "columnId": "query_property_value",
                    "label": "Value"
                  }
                ]
              }
            },
            "customWidth": "33",
            "name": "query_details_number_id"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"let query_property = datatable(key:int, query_property_name:string) [\\r\\n1, \\\"query_last_compile_duration_us\\\",\\r\\n1, \\\"query_last_optimize_duration_us\\\",\\r\\n1, \\\"query_last_optimize_cpu_time_us\\\"\\r\\n];\\r\\nsqldb_single_database_query_runtime_stats\\r\\n| where interval_start_time >= todatetime(\\\"{qdsStartTime}\\\") and interval_end_time <= todatetime(\\\"{qdsEndTime}\\\")\\r\\n| where logical_server_name =~ @\\\"{serverName}\\\"\\r\\n| where database_name == @\\\"{databaseName}\\\"\\r\\n| where replica_type == \\\"{qdsCollectionReplicaType}\\\"\\r\\n| where query_id == {query_id}\\r\\n| summarize arg_max(interval_end_time, query_last_compile_duration_us, query_last_optimize_duration_us, query_last_optimize_cpu_time_us) // get query details from the last row in the time range\\r\\n| extend key = int(1)\\r\\n| join kind=inner query_property on key\\r\\n| project query_property_name, query_last_compile_duration_us, query_last_optimize_duration_us, query_last_optimize_cpu_time_us\\r\\n| extend query_property_value = case(\\r\\n                                    query_property_name == \\\"query_last_compile_duration_us\\\", query_last_compile_duration_us,\\r\\n                                    query_property_name == \\\"query_last_optimize_duration_us\\\", query_last_optimize_duration_us,\\r\\n                                    query_property_name == \\\"query_last_optimize_cpu_time_us\\\", query_last_optimize_cpu_time_us,\\r\\n                                    long(null)\\r\\n                                    )\\r\\n| project-away query_last_compile_duration_us, query_last_optimize_duration_us, query_last_optimize_cpu_time_us\\r\\n| sort by query_property_name asc;\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
              "size": 3,
              "showAnalytics": true,
              "noDataMessage": "There is no data for specified parameters.",
              "showExportToExcel": true,
              "queryType": 9,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "query_property_value",
                    "formatter": 0,
                    "numberFormat": {
                      "unit": 22,
                      "options": {
                        "style": "decimal",
                        "useGrouping": true
                      }
                    }
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "query_property_name",
                    "label": "Property"
                  },
                  {
                    "columnId": "query_property_value",
                    "label": "Value"
                  }
                ]
              }
            },
            "customWidth": "33",
            "name": "query_details_duration"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"let query_property = datatable(key:int, query_property_name:string) [\\r\\n1, \\\"query_last_compile_memory_kb\\\"\\r\\n];\\r\\nsqldb_single_database_query_runtime_stats\\r\\n| where interval_start_time >= todatetime(\\\"{qdsStartTime}\\\") and interval_end_time <= todatetime(\\\"{qdsEndTime}\\\")\\r\\n| where logical_server_name =~ @\\\"{serverName}\\\"\\r\\n| where database_name == @\\\"{databaseName}\\\"\\r\\n| where replica_type == \\\"{qdsCollectionReplicaType}\\\"\\r\\n| where query_id == {query_id}\\r\\n| summarize arg_max(interval_end_time, query_last_compile_memory_kb) // get query details from the last row in the time range\\r\\n| extend key = int(1)\\r\\n| join kind=inner query_property on key\\r\\n| project query_property_name, query_last_compile_memory_kb\\r\\n| extend query_property_value = case(\\r\\n                                    query_property_name == \\\"query_last_compile_memory_kb\\\", query_last_compile_memory_kb,\\r\\n                                    long(null)\\r\\n                                    )\\r\\n| project-away query_last_compile_memory_kb\\r\\n| sort by query_property_name asc;\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
              "size": 3,
              "showAnalytics": true,
              "noDataMessage": "There is no data for specified parameters.",
              "showExportToExcel": true,
              "queryType": 9,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "query_property_value",
                    "formatter": 0,
                    "numberFormat": {
                      "unit": 3,
                      "options": {
                        "style": "decimal",
                        "useGrouping": true
                      }
                    }
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "query_property_name",
                    "label": "Property"
                  },
                  {
                    "columnId": "query_property_value",
                    "label": "Value"
                  }
                ]
              }
            },
            "customWidth": "33",
            "name": "query_details_kb"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"let query_property = datatable(key:int, query_property_name:string) [\\r\\n1, \\\"query_initial_compile_start_time\\\",\\r\\n1, \\\"query_last_compile_start_time\\\",\\r\\n1, \\\"query_last_execution_time\\\"\\r\\n];\\r\\nsqldb_single_database_query_runtime_stats\\r\\n| where interval_start_time >= todatetime(\\\"{qdsStartTime}\\\") and interval_end_time <= todatetime(\\\"{qdsEndTime}\\\")\\r\\n| where logical_server_name =~ @\\\"{serverName}\\\"\\r\\n| where database_name == @\\\"{databaseName}\\\"\\r\\n| where replica_type == \\\"{qdsCollectionReplicaType}\\\"\\r\\n| where query_id == {query_id}\\r\\n| summarize arg_max(interval_end_time, query_initial_compile_start_time, query_last_compile_start_time, query_last_execution_time) // get query details from the last row in the time range\\r\\n| extend key = int(1)\\r\\n| join kind=inner query_property on key\\r\\n| project query_property_name, query_initial_compile_start_time, query_last_compile_start_time, query_last_execution_time\\r\\n| extend query_property_value = case(\\r\\n                                    query_property_name == \\\"query_initial_compile_start_time\\\", query_initial_compile_start_time,\\r\\n                                    query_property_name == \\\"query_last_compile_start_time\\\", query_last_compile_start_time,\\r\\n                                    query_property_name == \\\"query_last_execution_time\\\", query_last_execution_time,\\r\\n                                    datetime(null)\\r\\n                                    )\\r\\n| project-away query_initial_compile_start_time, query_last_compile_start_time, query_last_execution_time\\r\\n| sort by query_property_name asc;\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
              "size": 3,
              "showAnalytics": true,
              "noDataMessage": "There is no data for specified parameters.",
              "showExportToExcel": true,
              "queryType": 9,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "query_property_value",
                    "formatter": 6,
                    "dateFormat": {
                      "showUtcTime": null,
                      "formatName": "shortDateTimePattern"
                    }
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "query_property_name",
                    "label": "Property"
                  },
                  {
                    "columnId": "query_property_value",
                    "label": "Value"
                  }
                ]
              }
            },
            "customWidth": "33",
            "name": "query_details_datetime"
          }
        ]
      },
      "conditionalVisibilities": [
        {
          "parameterName": "query_id",
          "comparison": "isNotEqualTo",
          "value": "0"
        },
        {
          "parameterName": "qdsMetric",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsAggregation",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsTopQueryCount",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "showQueriesAs",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsStartTime",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsEndTime",
          "comparison": "isNotEqualTo"
        }
      ],
      "name": "query_details_group"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "5e875829-c0a1-4d00-b853-d90b119a5883",
            "version": "KqlParameterItem/1.0",
            "name": "showPlansAs",
            "label": "Show query plans as",
            "type": 10,
            "description": "Select \"Chart\" to show query plans as bars on a time chart. Select \"Grid\" to show a summary of query plan statistics in a grid.",
            "isRequired": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[\r\n    {\"value\":\"chart\",\"label\":\"Chart\"},\r\n    {\"value\":\"grid\",\"label\":\"Grid\"}\r\n]",
            "timeContext": {
              "durationMs": 86400000
            },
            "value": "chart"
          },
          {
            "id": "e13aabd4-e4d7-46a7-a1d7-20292f9a521b",
            "version": "KqlParameterItem/1.0",
            "name": "selectedGridPlan",
            "type": 1,
            "isRequired": true,
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 86400000
            },
            "value": "{\"plan_id\":0,\"interval_end_time\":\"1900-01-01\"}"
          },
          {
            "version": "KqlParameterItem/1.0",
            "name": "selectedChartPlan",
            "type": 1,
            "isRequired": true,
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 86400000
            },
            "value": "{\"x\":\"1900-01-01\",\"series\":\"\"}",
            "id": "8dafcf7a-df0e-4d9b-83ec-55579bad8df5"
          },
          {
            "id": "b66d1dc9-af20-41b2-8a68-ad2aab7d2ee6",
            "version": "KqlParameterItem/1.0",
            "name": "planTabName",
            "type": 1,
            "isHiddenWhenLocked": true,
            "value": "details"
          }
        ],
        "style": "above",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "conditionalVisibilities": [
        {
          "parameterName": "qdsMetric",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsAggregation",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsTopQueryCount",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsAggBy",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "query_hash",
          "comparison": "isNotEqualTo",
          "value": "\"\""
        },
        {
          "parameterName": "showQueriesAs",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsStartTime",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsEndTime",
          "comparison": "isNotEqualTo"
        }
      ],
      "name": "query_plan_parameters"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"sqldb_single_database_query_runtime_stats\\r\\n| where interval_start_time >= todatetime(\\\"{qdsStartTime}\\\") and interval_end_time <= todatetime(\\\"{qdsEndTime}\\\")\\r\\n| where logical_server_name =~ @\\\"{serverName}\\\"\\r\\n| where database_name == @\\\"{databaseName}\\\"\\r\\n| where replica_type == \\\"{qdsCollectionReplicaType}\\\"\\r\\n| where query_id == iif(\\\"{qdsAggBy}\\\"==\\\"query_id\\\", {query_id}, query_id)\\r\\n| where query_hash == iif(\\\"{qdsAggBy}\\\"==\\\"query_hash\\\", \\\"{query_hash}\\\", query_hash)\\r\\n| where execution_type in ({qdsExecutionType})\\r\\n| summarize dcount_plan_id = dcount(plan_id),\\r\\n            any_plan_id = take_any(plan_id),\\r\\n            count_executions = case(\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(toreal(count_executions)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"avg\\\", round(avg(count_executions), 2),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(count_executions)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(count_executions)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(toreal(count_executions)),\\r\\n                                   real(null)\\r\\n                                   ),\\r\\n            duration_us = case(\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_duration_us * count_executions),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_duration_us),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_duration_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_duration_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_cpu_time_us), // use maximum stdev for the interval\\r\\n                              real(null)\\r\\n                              ),\\r\\n            cpu_time_us = case(\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_cpu_time_us * count_executions),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_cpu_time_us),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_cpu_time_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_cpu_time_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_cpu_time_us),\\r\\n                              real(null)\\r\\n                              ),\\r\\n            logical_io_reads = case(\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_logical_io_reads * count_executions),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_logical_io_reads),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_logical_io_reads)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_logical_io_reads)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_logical_io_reads),\\r\\n                                   real(null)\\r\\n                                   ),\\r\\n            logical_io_writes = case(\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_logical_io_writes * count_executions),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_logical_io_writes),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_logical_io_writes)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_logical_io_writes)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_logical_io_writes),\\r\\n                                    real(null)\\r\\n                                    ),\\r\\n            physical_io_reads = case(\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_physical_io_reads * count_executions),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_physical_io_reads),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_physical_io_reads)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_physical_io_reads)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_physical_io_reads),\\r\\n                                    real(null)\\r\\n                                    ),\\r\\n            num_physical_io_reads = case(\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_num_physical_io_reads * count_executions),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_num_physical_io_reads),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_num_physical_io_reads)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_num_physical_io_reads)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_num_physical_io_reads),\\r\\n                                        real(null)\\r\\n                                        ),\\r\\n            clr_time_us = case(\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_clr_time_us * count_executions),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_clr_time_us),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_clr_time_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_clr_time_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_clr_time_us),\\r\\n                              real(null)\\r\\n                              ),\\r\\n            dop = case(\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"total\\\", sumif(avg_dop * count_executions, is_parallel_plan), // Total DOP for serial queries is meaningless, show as zero\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_dop),\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_dop)),\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_dop)),\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_dop),\\r\\n                      real(null)\\r\\n                      ),\\r\\n            query_max_used_memory = case(\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_query_max_used_memory * count_executions),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_query_max_used_memory),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_query_max_used_memory)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_query_max_used_memory)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_query_max_used_memory),\\r\\n                                        real(null)\\r\\n                                        ),\\r\\n            rowcount = case(\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_rowcount * count_executions),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_rowcount),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_rowcount)),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_rowcount)),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_rowcount),\\r\\n                           real(null)\\r\\n                           ),\\r\\n            log_bytes_used = case(\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_log_bytes_used * count_executions),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_log_bytes_used),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_log_bytes_used)),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_log_bytes_used)),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_log_bytes_used),\\r\\n                                 real(null)\\r\\n                                 ),\\r\\n            tempdb_space_used = case(\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_tempdb_space_used * count_executions),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_tempdb_space_used),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_tempdb_space_used)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_tempdb_space_used)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_tempdb_space_used),\\r\\n                                    real(null)\\r\\n                                    ),\\r\\n            page_server_io_reads = case(\\r\\n                                       \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_page_server_io_reads * count_executions),\\r\\n                                       \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_page_server_io_reads),\\r\\n                                       \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_page_server_io_reads)),\\r\\n                                       \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_page_server_io_reads)),\\r\\n                                       \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_page_server_io_reads),\\r\\n                                       real(null)\\r\\n                                       ),\\r\\n            interval_end_time = max(interval_end_time)\\r\\n            by query_plan_hash,\\r\\n               plan_id = iif(\\\"{qdsAggBy}\\\"==\\\"query_id\\\", plan_id, long(null)),\\r\\n               execution_type_desc,\\r\\n               is_forced_plan,\\r\\n               plan_forcing_type_desc\\r\\n| extend plan_id = iif(isnull(plan_id), any_plan_id, plan_id)\\r\\n| project query_plan_hash,\\r\\n          plan_id,\\r\\n          p_id_agg = iif(dcount_plan_id == 1, tostring(any_plan_id), strcat(any_plan_id, \\\" (+\\\", tostring(dcount_plan_id - 1), \\\")\\\")),\\r\\n          interval_end_time,\\r\\n          execution_type_desc,\\r\\n          count_executions,\\r\\n          plan_forcing = case(plan_forcing_type_desc == \\\"AUTO\\\", \\\"Auto\\\", plan_forcing_type_desc == \\\"MANUAL\\\" or is_forced_plan, \\\"Manual\\\", \\\"None\\\"),\\r\\n          duration_us,\\r\\n          cpu_time_us,\\r\\n          logical_io_reads,\\r\\n          logical_io_writes,\\r\\n          physical_io_reads,\\r\\n          num_physical_io_reads,\\r\\n          clr_time_us,\\r\\n          dop,\\r\\n          query_max_used_memory_kb = query_max_used_memory * 8,\\r\\n          rowcount,\\r\\n          log_bytes_used,\\r\\n          tempdb_space_used_kb = tempdb_space_used * 8,\\r\\n          page_server_io_reads\\r\\n| sort by case(\\r\\n              \\\"{qdsMetric}\\\"==\\\"count_executions\\\", toreal(count_executions),\\r\\n              \\\"{qdsMetric}\\\"==\\\"duration\\\", toreal(duration_us),\\r\\n              \\\"{qdsMetric}\\\"==\\\"cpu_time\\\", toreal(cpu_time_us),\\r\\n              \\\"{qdsMetric}\\\"==\\\"logical_io_reads\\\", toreal(logical_io_reads),\\r\\n              \\\"{qdsMetric}\\\"==\\\"logical_io_writes\\\", toreal(logical_io_writes),\\r\\n              \\\"{qdsMetric}\\\"==\\\"physical_io_reads\\\", toreal(physical_io_reads),\\r\\n              \\\"{qdsMetric}\\\"==\\\"num_physical_io_reads\\\", toreal(num_physical_io_reads),\\r\\n              \\\"{qdsMetric}\\\"==\\\"clr_time\\\", toreal(clr_time_us),\\r\\n              \\\"{qdsMetric}\\\"==\\\"dop\\\", toreal(dop),\\r\\n              \\\"{qdsMetric}\\\"==\\\"query_max_used_memory\\\", toreal(query_max_used_memory_kb),\\r\\n              \\\"{qdsMetric}\\\"==\\\"rowcount\\\", toreal(rowcount),\\r\\n              \\\"{qdsMetric}\\\"==\\\"log_bytes_used\\\", toreal(log_bytes_used),\\r\\n              \\\"{qdsMetric}\\\"==\\\"tempdb_space_used\\\", toreal(tempdb_space_used_kb),\\r\\n              \\\"{qdsMetric}\\\"==\\\"page_server_io_reads\\\", toreal(page_server_io_reads),\\r\\n              real(null)\\r\\n              ) desc,\\r\\n          count_executions desc // secondary sort for determinism when primary sort is tied\\r\\n| take 100 // assumption: looking at more than 100 plans is not interesting\\r\\n;\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
        "size": 1,
        "showAnalytics": true,
        "title": "{qdsAggregation:label} metrics by query plan",
        "noDataMessage": "There is no data for specified parameters.",
        "exportFieldName": "",
        "exportParameterName": "selectedGridPlan",
        "exportDefaultValue": "{\"plan_id\":0,\"interval_end_time\":\"\"}",
        "showExportToExcel": true,
        "queryType": 9,
        "visualization": "table",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "plan_id",
              "formatter": 5
            },
            {
              "columnMatch": "interval_end_time",
              "formatter": 5
            },
            {
              "columnMatch": "execution_type_desc",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "Aborted",
                    "representation": "orange",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Exception",
                    "representation": "red",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "text": "{0}{1}"
                  }
                ],
                "customColumnWidthSetting": "18ch"
              }
            },
            {
              "columnMatch": "count_executions",
              "formatter": 0,
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal",
                  "useGrouping": true
                }
              },
              "tooltipFormat": {
                "tooltip": "Successful (green), aborted (orange), and exception (red) executions"
              }
            },
            {
              "columnMatch": "plan_forcing",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "Auto",
                    "representation": "lightBlue",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Manual",
                    "representation": "magenta",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "text": "{0}{1}"
                  }
                ]
              }
            },
            {
              "columnMatch": "duration_us",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "15ch"
              },
              "numberFormat": {
                "unit": 22,
                "options": {
                  "style": "decimal",
                  "useGrouping": true,
                  "maximumFractionDigits": 2
                }
              }
            },
            {
              "columnMatch": "cpu_time_us",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "18ch"
              },
              "numberFormat": {
                "unit": 22,
                "options": {
                  "style": "decimal",
                  "useGrouping": true,
                  "maximumFractionDigits": 2
                }
              }
            },
            {
              "columnMatch": "logical_io_reads",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "18ch"
              },
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal",
                  "useGrouping": true,
                  "maximumFractionDigits": 2
                }
              }
            },
            {
              "columnMatch": "logical_io_writes",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "18ch"
              },
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal",
                  "useGrouping": true,
                  "maximumFractionDigits": 2
                }
              }
            },
            {
              "columnMatch": "physical_io_reads",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "24ch"
              },
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal",
                  "useGrouping": true,
                  "maximumFractionDigits": 2
                }
              }
            },
            {
              "columnMatch": "num_physical_io_reads",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "22ch"
              },
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal",
                  "useGrouping": true,
                  "maximumFractionDigits": 2
                }
              }
            },
            {
              "columnMatch": "clr_time_us",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "18ch"
              },
              "numberFormat": {
                "unit": 22,
                "options": {
                  "style": "decimal",
                  "useGrouping": true,
                  "maximumFractionDigits": 2
                }
              }
            },
            {
              "columnMatch": "dop",
              "formatter": 0,
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal",
                  "useGrouping": true,
                  "maximumFractionDigits": 2
                }
              }
            },
            {
              "columnMatch": "query_max_used_memory_kb",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "18ch"
              },
              "numberFormat": {
                "unit": 3,
                "options": {
                  "style": "decimal",
                  "useGrouping": true,
                  "maximumFractionDigits": 2
                }
              }
            },
            {
              "columnMatch": "rowcount",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "18ch"
              },
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal",
                  "useGrouping": true,
                  "maximumFractionDigits": 2
                }
              }
            },
            {
              "columnMatch": "log_bytes_used",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "18ch"
              },
              "numberFormat": {
                "unit": 2,
                "options": {
                  "style": "decimal",
                  "useGrouping": true,
                  "maximumFractionDigits": 2
                }
              }
            },
            {
              "columnMatch": "tempdb_space_used_kb",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "18ch"
              },
              "numberFormat": {
                "unit": 3,
                "options": {
                  "style": "decimal",
                  "useGrouping": true,
                  "maximumFractionDigits": 2
                }
              }
            },
            {
              "columnMatch": "page_server_io_reads",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "22ch"
              },
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal",
                  "useGrouping": true
                }
              }
            },
            {
              "columnMatch": "count_successful_executions",
              "formatter": 5
            },
            {
              "columnMatch": "count_aborted_executions",
              "formatter": 5
            },
            {
              "columnMatch": "count_exception_executions",
              "formatter": 5
            }
          ],
          "filter": true,
          "labelSettings": [
            {
              "columnId": "query_plan_hash",
              "label": "Plan hash"
            },
            {
              "columnId": "p_id_agg",
              "label": "Plan ID"
            },
            {
              "columnId": "execution_type_desc",
              "label": "Execution type"
            },
            {
              "columnId": "count_executions",
              "label": "Executions"
            },
            {
              "columnId": "plan_forcing",
              "label": "Forcing"
            },
            {
              "columnId": "duration_us",
              "label": "Duration"
            },
            {
              "columnId": "cpu_time_us",
              "label": "CPU time"
            },
            {
              "columnId": "logical_io_reads",
              "label": "Logical reads"
            },
            {
              "columnId": "logical_io_writes",
              "label": "Logical writes"
            },
            {
              "columnId": "physical_io_reads",
              "label": "Physical reads (pages)"
            },
            {
              "columnId": "num_physical_io_reads",
              "label": "Physical reads (IOs)"
            },
            {
              "columnId": "clr_time_us",
              "label": "CLR time"
            },
            {
              "columnId": "dop",
              "label": "DOP"
            },
            {
              "columnId": "query_max_used_memory_kb",
              "label": "Memory grant"
            },
            {
              "columnId": "rowcount",
              "label": "Rows"
            },
            {
              "columnId": "log_bytes_used",
              "label": "Log space"
            },
            {
              "columnId": "tempdb_space_used_kb",
              "label": "Tempdb space"
            },
            {
              "columnId": "page_server_io_reads",
              "label": "Page server reads"
            }
          ]
        }
      },
      "conditionalVisibilities": [
        {
          "parameterName": "qdsMetric",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsAggregation",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsTopQueryCount",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsAggBy",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "showPlansAs",
          "comparison": "isEqualTo",
          "value": "grid"
        },
        {
          "parameterName": "query_hash",
          "comparison": "isNotEqualTo",
          "value": "\"\""
        },
        {
          "parameterName": "qdsStartTime",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsEndTime",
          "comparison": "isNotEqualTo"
        }
      ],
      "name": "qds_query_plans_grid"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"sqldb_single_database_query_runtime_stats\\r\\n| where interval_start_time >= todatetime(\\\"{qdsStartTime}\\\") and interval_end_time <= todatetime(\\\"{qdsEndTime}\\\")\\r\\n| where logical_server_name =~ @\\\"{serverName}\\\"\\r\\n| where database_name == @\\\"{databaseName}\\\"\\r\\n| where replica_type == \\\"{qdsCollectionReplicaType}\\\"\\r\\n| where query_id == iif(\\\"{qdsAggBy}\\\"==\\\"query_id\\\", {query_id}, query_id)\\r\\n| where query_hash == iif(\\\"{qdsAggBy}\\\"==\\\"query_hash\\\", \\\"{query_hash}\\\", query_hash)\\r\\n| where execution_type in ({qdsExecutionType})\\r\\n| summarize any_plan_id = take_any(plan_id),\\r\\n            count_executions = case(\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(toreal(count_executions)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"avg\\\", round(avg(count_executions), 2),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(count_executions)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(count_executions)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(toreal(count_executions)),\\r\\n                                   real(null)\\r\\n                                   ),\\r\\n            logical_io_reads = case(\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_logical_io_reads * count_executions),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_logical_io_reads),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_logical_io_reads)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_logical_io_reads)),\\r\\n                                   \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_logical_io_reads),\\r\\n                                   real(null)\\r\\n                                   ),\\r\\n            logical_io_writes = case(\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_logical_io_writes * count_executions),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_logical_io_writes),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_logical_io_writes)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_logical_io_writes)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_logical_io_writes),\\r\\n                                    real(null)\\r\\n                                    ),\\r\\n            physical_io_reads = case(\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_physical_io_reads * count_executions),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_physical_io_reads),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_physical_io_reads)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_physical_io_reads)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_physical_io_reads),\\r\\n                                    real(null)\\r\\n                                    ),\\r\\n            num_physical_io_reads = case(\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_num_physical_io_reads * count_executions),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_num_physical_io_reads),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_num_physical_io_reads)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_num_physical_io_reads)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_num_physical_io_reads),\\r\\n                                        real(null)\\r\\n                                        ),\\r\\n            clr_time_us = case(\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_clr_time_us * count_executions),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_clr_time_us),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_clr_time_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_clr_time_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_clr_time_us),\\r\\n                              real(null)\\r\\n                              ),\\r\\n            dop = case(\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"total\\\", sumif(avg_dop * count_executions, is_parallel_plan), // Total DOP for serial queries is meaningless, show as zero\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_dop),\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_dop)),\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_dop)),\\r\\n                      \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_dop),\\r\\n                      real(null)\\r\\n                      ),\\r\\n            rowcount = case(\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_rowcount * count_executions),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_rowcount),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_rowcount)),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_rowcount)),\\r\\n                           \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_rowcount),\\r\\n                           real(null)\\r\\n                           ),\\r\\n            page_server_io_reads = case(\\r\\n                                       \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_page_server_io_reads * count_executions),\\r\\n                                       \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_page_server_io_reads),\\r\\n                                       \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_page_server_io_reads)),\\r\\n                                       \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_page_server_io_reads)),\\r\\n                                       \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_page_server_io_reads),\\r\\n                                       real(null)\\r\\n                                       )\\r\\n            by query_plan_hash,\\r\\n               plan_id = iif(\\\"{qdsAggBy}\\\"==\\\"query_id\\\", plan_id, long(null)),\\r\\n               interval_end_time\\r\\n| extend plan_id = iif(isnull(plan_id), any_plan_id, plan_id),\\r\\n         metric = case(\\r\\n                      \\\"{qdsMetric}\\\"==\\\"count_executions\\\", toreal(count_executions),\\r\\n                      \\\"{qdsMetric}\\\"==\\\"logical_io_reads\\\", toreal(logical_io_reads),\\r\\n                      \\\"{qdsMetric}\\\"==\\\"logical_io_writes\\\", toreal(logical_io_writes),\\r\\n                      \\\"{qdsMetric}\\\"==\\\"physical_io_reads\\\", toreal(physical_io_reads),\\r\\n                      \\\"{qdsMetric}\\\"==\\\"num_physical_io_reads\\\", toreal(num_physical_io_reads),\\r\\n                      \\\"{qdsMetric}\\\"==\\\"dop\\\", toreal(dop),\\r\\n                      \\\"{qdsMetric}\\\"==\\\"rowcount\\\", toreal(rowcount),\\r\\n                      \\\"{qdsMetric}\\\"==\\\"page_server_io_reads\\\", toreal(page_server_io_reads),\\r\\n                      real(null)\\r\\n                      )\\r\\n| project plan_label = iif(\\\"{qdsAggBy}\\\"==\\\"query_id\\\", strcat(\\\"Plan ID: \\\", tostring(plan_id)), strcat(\\\"Plan hash: \\\", query_plan_hash)),\\r\\n          interval_end_time,\\r\\n          metric\\r\\n| make-series metric = max(metric) default = long(null) on interval_end_time from todatetime(\\\"{qdsStartTime}\\\") to todatetime(\\\"{qdsEndTime}\\\") step {timeRange:grain} by plan_label;\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
        "size": 0,
        "showAnnotations": true,
        "showAnalytics": true,
        "title": "{qdsAggregation:label} {qdsMetricLabelMidsentenceCase} by query plan",
        "noDataMessage": "There is no data for specified parameters.",
        "exportParameterName": "selectedChartPlan",
        "exportDefaultValue": "0",
        "queryType": 9,
        "visualization": "unstackedbar",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "count_executions",
              "formatter": 22,
              "formatOptions": {
                "compositeBarSettings": {
                  "labelText": "",
                  "columnSettings": [
                    {
                      "columnName": "count_successful_executions",
                      "color": "green"
                    },
                    {
                      "columnName": "count_aborted_executions",
                      "color": "orange"
                    },
                    {
                      "columnName": "count_exception_executions",
                      "color": "red"
                    }
                  ]
                }
              },
              "tooltipFormat": {
                "tooltip": "Successful (green), aborted (orange), and exception (red) executions"
              }
            }
          ]
        },
        "tileSettings": {
          "titleContent": {
            "formatter": 1,
            "tooltipFormat": {
              "tooltip": "Query rank"
            }
          },
          "leftContent": {
            "columnMatch": "rank",
            "formatter": 12,
            "formatOptions": {
              "palette": "none"
            },
            "tooltipFormat": {
              "tooltip": "Query rank"
            }
          },
          "rightContent": {
            "columnMatch": "ranked_metric",
            "formatter": 4,
            "formatOptions": {
              "palette": "coldHot"
            },
            "numberFormat": {
              "unit": 0,
              "options": {
                "style": "decimal",
                "useGrouping": true,
                "maximumFractionDigits": 2
              }
            }
          },
          "showBorder": true,
          "sortCriteriaField": "rank",
          "sortOrderField": 1,
          "size": "auto"
        },
        "chartSettings": {
          "yAxis": [
            "metric"
          ],
          "group": "plan_label",
          "createOtherGroup": null,
          "showLegend": true,
          "ySettings": {
            "numberFormatSettings": {
              "unit": 17,
              "options": {
                "style": "decimal",
                "useGrouping": true,
                "maximumFractionDigits": 2
              }
            }
          }
        }
      },
      "conditionalVisibilities": [
        {
          "parameterName": "qdsMetric",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsAggregation",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsTopQueryCount",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsAggBy",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "showPlansAs",
          "comparison": "isEqualTo",
          "value": "chart"
        },
        {
          "parameterName": "qdsMetricUnit",
          "comparison": "isEqualTo",
          "value": "unitless"
        },
        {
          "parameterName": "query_hash",
          "comparison": "isNotEqualTo",
          "value": "\"\""
        },
        {
          "parameterName": "qdsStartTime",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsEndTime",
          "comparison": "isNotEqualTo"
        }
      ],
      "name": "qds_query_plan_chart_unitless"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"sqldb_single_database_query_runtime_stats\\r\\n| where interval_start_time >= todatetime(\\\"{qdsStartTime}\\\") and interval_end_time <= todatetime(\\\"{qdsEndTime}\\\")\\r\\n| where logical_server_name =~ @\\\"{serverName}\\\"\\r\\n| where database_name == @\\\"{databaseName}\\\"\\r\\n| where replica_type == \\\"{qdsCollectionReplicaType}\\\"\\r\\n| where query_id == iif(\\\"{qdsAggBy}\\\"==\\\"query_id\\\", {query_id}, query_id)\\r\\n| where query_hash == iif(\\\"{qdsAggBy}\\\"==\\\"query_hash\\\", \\\"{query_hash}\\\", query_hash)\\r\\n| where execution_type in ({qdsExecutionType})\\r\\n| summarize any_plan_id = take_any(plan_id),\\r\\n            duration_us = case(\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_duration_us * count_executions),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_duration_us),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_duration_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_duration_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_cpu_time_us), // use maximum stdev for the interval\\r\\n                              real(null)\\r\\n                              ),\\r\\n            cpu_time_us = case(\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_cpu_time_us * count_executions),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_cpu_time_us),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_cpu_time_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_cpu_time_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_cpu_time_us),\\r\\n                              real(null)\\r\\n                              ),\\r\\n            clr_time_us = case(\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_clr_time_us * count_executions),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_clr_time_us),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_clr_time_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_clr_time_us)),\\r\\n                              \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_clr_time_us),\\r\\n                              real(null)\\r\\n                              )\\r\\n            by query_plan_hash,\\r\\n               plan_id = iif(\\\"{qdsAggBy}\\\"==\\\"query_id\\\", plan_id, long(null)),\\r\\n               interval_end_time\\r\\n| extend plan_id = iif(isnull(plan_id), any_plan_id, plan_id),\\r\\n         metric = case(\\r\\n                      \\\"{qdsMetric}\\\"==\\\"duration\\\", toreal(duration_us),\\r\\n                      \\\"{qdsMetric}\\\"==\\\"cpu_time\\\", toreal(cpu_time_us),\\r\\n                      \\\"{qdsMetric}\\\"==\\\"clr_time\\\", toreal(clr_time_us),\\r\\n                      real(null)\\r\\n                      )\\r\\n| project plan_label = iif(\\\"{qdsAggBy}\\\"==\\\"query_id\\\", strcat(\\\"Plan ID: \\\", tostring(plan_id)), strcat(\\\"Plan hash: \\\", query_plan_hash)),\\r\\n          interval_end_time,\\r\\n          metric\\r\\n| make-series metric = max(metric) default = long(null) on interval_end_time from todatetime(\\\"{qdsStartTime}\\\") to todatetime(\\\"{qdsEndTime}\\\") step {timeRange:grain} by plan_label;\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
        "size": 0,
        "showAnnotations": true,
        "showAnalytics": true,
        "title": "{qdsAggregation:label} {qdsMetricLabelMidsentenceCase} by query plan",
        "noDataMessage": "There is no data for specified parameters.",
        "exportParameterName": "selectedChartPlan",
        "exportDefaultValue": "0",
        "queryType": 9,
        "visualization": "unstackedbar",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "count_executions",
              "formatter": 22,
              "formatOptions": {
                "compositeBarSettings": {
                  "labelText": "",
                  "columnSettings": [
                    {
                      "columnName": "count_successful_executions",
                      "color": "green"
                    },
                    {
                      "columnName": "count_aborted_executions",
                      "color": "orange"
                    },
                    {
                      "columnName": "count_exception_executions",
                      "color": "red"
                    }
                  ]
                }
              },
              "tooltipFormat": {
                "tooltip": "Successful (green), aborted (orange), and exception (red) executions"
              }
            }
          ]
        },
        "tileSettings": {
          "titleContent": {
            "formatter": 1,
            "tooltipFormat": {
              "tooltip": "Query rank"
            }
          },
          "leftContent": {
            "columnMatch": "rank",
            "formatter": 12,
            "formatOptions": {
              "palette": "none"
            },
            "tooltipFormat": {
              "tooltip": "Query rank"
            }
          },
          "rightContent": {
            "columnMatch": "ranked_metric",
            "formatter": 4,
            "formatOptions": {
              "palette": "coldHot"
            },
            "numberFormat": {
              "unit": 0,
              "options": {
                "style": "decimal",
                "useGrouping": true,
                "maximumFractionDigits": 2
              }
            }
          },
          "showBorder": true,
          "sortCriteriaField": "rank",
          "sortOrderField": 1,
          "size": "auto"
        },
        "chartSettings": {
          "yAxis": [
            "metric"
          ],
          "group": "plan_label",
          "createOtherGroup": null,
          "showLegend": true,
          "ySettings": {
            "numberFormatSettings": {
              "unit": 22,
              "options": {
                "style": "decimal",
                "useGrouping": true,
                "maximumFractionDigits": 2
              }
            }
          }
        }
      },
      "conditionalVisibilities": [
        {
          "parameterName": "qdsMetric",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsAggregation",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsTopQueryCount",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsAggBy",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "showPlansAs",
          "comparison": "isEqualTo",
          "value": "chart"
        },
        {
          "parameterName": "qdsMetricUnit",
          "comparison": "isEqualTo",
          "value": "time"
        },
        {
          "parameterName": "query_hash",
          "comparison": "isNotEqualTo",
          "value": "\"\""
        },
        {
          "parameterName": "showQueriesAs",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsStartTime",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsEndTime",
          "comparison": "isNotEqualTo"
        }
      ],
      "name": "qds_query_plan_chart_time"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"sqldb_single_database_query_runtime_stats\\r\\n| where interval_start_time >= todatetime(\\\"{qdsStartTime}\\\") and interval_end_time <= todatetime(\\\"{qdsEndTime}\\\")\\r\\n| where logical_server_name =~ @\\\"{serverName}\\\"\\r\\n| where database_name == @\\\"{databaseName}\\\"\\r\\n| where replica_type == \\\"{qdsCollectionReplicaType}\\\"\\r\\n| where query_id == iif(\\\"{qdsAggBy}\\\"==\\\"query_id\\\", {query_id}, query_id)\\r\\n| where query_hash == iif(\\\"{qdsAggBy}\\\"==\\\"query_hash\\\", \\\"{query_hash}\\\", query_hash)\\r\\n| where execution_type in ({qdsExecutionType})\\r\\n| summarize any_plan_id = take_any(plan_id),\\r\\n            query_max_used_memory = case(\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_query_max_used_memory * count_executions),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_query_max_used_memory),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_query_max_used_memory)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_query_max_used_memory)),\\r\\n                                        \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_query_max_used_memory),\\r\\n                                        real(null)\\r\\n                                        ),\\r\\n            log_bytes_used = case(\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_log_bytes_used * count_executions),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_log_bytes_used),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_log_bytes_used)),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_log_bytes_used)),\\r\\n                                 \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_log_bytes_used),\\r\\n                                 real(null)\\r\\n                                 ),\\r\\n            tempdb_space_used = case(\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"total\\\", sum(avg_tempdb_space_used * count_executions),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"avg\\\", avg(avg_tempdb_space_used),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"min\\\", min(toreal(min_tempdb_space_used)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"max\\\", max(toreal(max_tempdb_space_used)),\\r\\n                                    \\\"{qdsAggregation}\\\"==\\\"stdev\\\", max(stdev_tempdb_space_used),\\r\\n                                    real(null)\\r\\n                                    )\\r\\n            by query_plan_hash,\\r\\n               plan_id = iif(\\\"{qdsAggBy}\\\"==\\\"query_id\\\", plan_id, long(null)),\\r\\n               interval_end_time\\r\\n| extend plan_id = iif(isnull(plan_id), any_plan_id, plan_id),\\r\\n         metric = case(\\r\\n                      \\\"{qdsMetric}\\\"==\\\"query_max_used_memory\\\", toreal(query_max_used_memory * 8 * 1024),\\r\\n                      \\\"{qdsMetric}\\\"==\\\"log_bytes_used\\\", toreal(log_bytes_used),\\r\\n                      \\\"{qdsMetric}\\\"==\\\"tempdb_space_used\\\", toreal(tempdb_space_used * 8 * 1024),\\r\\n                      real(null)\\r\\n                      )\\r\\n| project plan_label = iif(\\\"{qdsAggBy}\\\"==\\\"query_id\\\", strcat(\\\"Plan ID: \\\", tostring(plan_id)), strcat(\\\"Plan hash: \\\", query_plan_hash)),\\r\\n          interval_end_time,\\r\\n          metric\\r\\n| make-series metric = max(metric) default = long(null) on interval_end_time from todatetime(\\\"{qdsStartTime}\\\") to todatetime(\\\"{qdsEndTime}\\\") step {timeRange:grain} by plan_label;\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
        "size": 0,
        "showAnnotations": true,
        "showAnalytics": true,
        "title": "{qdsAggregation:label} {qdsMetricLabelMidsentenceCase} by query plan",
        "noDataMessage": "There is no data for specified parameters.",
        "exportParameterName": "selectedChartPlan",
        "exportDefaultValue": "0",
        "queryType": 9,
        "visualization": "unstackedbar",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "count_executions",
              "formatter": 22,
              "formatOptions": {
                "compositeBarSettings": {
                  "labelText": "",
                  "columnSettings": [
                    {
                      "columnName": "count_successful_executions",
                      "color": "green"
                    },
                    {
                      "columnName": "count_aborted_executions",
                      "color": "orange"
                    },
                    {
                      "columnName": "count_exception_executions",
                      "color": "red"
                    }
                  ]
                }
              },
              "tooltipFormat": {
                "tooltip": "Successful (green), aborted (orange), and exception (red) executions"
              }
            }
          ]
        },
        "tileSettings": {
          "titleContent": {
            "formatter": 1,
            "tooltipFormat": {
              "tooltip": "Query rank"
            }
          },
          "leftContent": {
            "columnMatch": "rank",
            "formatter": 12,
            "formatOptions": {
              "palette": "none"
            },
            "tooltipFormat": {
              "tooltip": "Query rank"
            }
          },
          "rightContent": {
            "columnMatch": "ranked_metric",
            "formatter": 4,
            "formatOptions": {
              "palette": "coldHot"
            },
            "numberFormat": {
              "unit": 0,
              "options": {
                "style": "decimal",
                "useGrouping": true,
                "maximumFractionDigits": 2
              }
            }
          },
          "showBorder": true,
          "sortCriteriaField": "rank",
          "sortOrderField": 1,
          "size": "auto"
        },
        "chartSettings": {
          "yAxis": [
            "metric"
          ],
          "group": "plan_label",
          "createOtherGroup": null,
          "showLegend": true,
          "ySettings": {
            "numberFormatSettings": {
              "unit": 2,
              "options": {
                "style": "decimal",
                "useGrouping": true,
                "maximumFractionDigits": 2
              }
            }
          }
        }
      },
      "conditionalVisibilities": [
        {
          "parameterName": "qdsMetric",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsAggregation",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsTopQueryCount",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsAggBy",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "showPlansAs",
          "comparison": "isEqualTo",
          "value": "chart"
        },
        {
          "parameterName": "qdsMetricUnit",
          "comparison": "isEqualTo",
          "value": "bytes"
        },
        {
          "parameterName": "query_hash",
          "comparison": "isNotEqualTo",
          "value": "\"\""
        },
        {
          "parameterName": "qdsStartTime",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsEndTime",
          "comparison": "isNotEqualTo"
        }
      ],
      "name": "qds_query_plan_chart_bytes"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "ffe8027f-b68d-4d91-8d73-3743e54a65c3",
            "version": "KqlParameterItem/1.0",
            "name": "selectedChartPlanId",
            "type": 1,
            "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"sqldb_single_database_query_runtime_stats\\r\\n| where interval_start_time >= todatetime(\\\"{qdsStartTime}\\\") and interval_end_time <= todatetime(\\\"{qdsEndTime}\\\")\\r\\n| where logical_server_name =~ @\\\"{serverName}\\\"\\r\\n| where database_name =~ @\\\"{databaseName}\\\"\\r\\n| where replica_type == \\\"{qdsCollectionReplicaType}\\\"\\r\\n| where execution_type in ({qdsExecutionType})\\r\\n| where query_id == iif(\\\"{qdsAggBy}\\\"==\\\"query_id\\\", {query_id}, query_id)\\r\\n| where query_plan_hash == iif(\\\"{qdsAggBy}\\\"==\\\"query_hash\\\", replace_string(\\\"{selectedChartPlan:$.series}\\\", \\\"Plan hash: \\\", \\\"\\\"), query_plan_hash)\\r\\n| where plan_id == iif(\\\"{qdsAggBy}\\\"==\\\"query_id\\\", tolong(replace_string(\\\"{selectedChartPlan:$.series}\\\", \\\"Plan ID: \\\", \\\"\\\")), plan_id)\\r\\n| top 1 by collection_time_utc desc\\r\\n| project plan_id\\r\\n\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 9
          },
          {
            "id": "73cbfd4f-8c4b-4a6a-9538-318000a212af",
            "version": "KqlParameterItem/1.0",
            "name": "selectedChartPlanHash",
            "type": 1,
            "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"sqldb_single_database_query_runtime_stats\\r\\n| where interval_start_time >= todatetime(\\\"{qdsStartTime}\\\") and interval_end_time <= todatetime(\\\"{qdsEndTime}\\\")\\r\\n| where logical_server_name =~ @\\\"{serverName}\\\"\\r\\n| where database_name =~ @\\\"{databaseName}\\\"\\r\\n| where replica_type == \\\"{qdsCollectionReplicaType}\\\"\\r\\n| where execution_type in ({qdsExecutionType})\\r\\n| where query_id == iif(\\\"{qdsAggBy}\\\"==\\\"query_id\\\", {query_id}, query_id)\\r\\n| where query_plan_hash == iif(\\\"{qdsAggBy}\\\"==\\\"query_hash\\\", replace_string(\\\"{selectedChartPlan:$.series}\\\", \\\"Plan hash: \\\", \\\"\\\"), query_plan_hash)\\r\\n| where plan_id == iif(\\\"{qdsAggBy}\\\"==\\\"query_id\\\", tolong(replace_string(\\\"{selectedChartPlan:$.series}\\\", \\\"Plan ID: \\\", \\\"\\\")), plan_id)\\r\\n| top 1 by collection_time_utc desc\\r\\n| project query_plan_hash\\r\\n\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 9
          },
          {
            "id": "3bbed235-3813-4be5-bfe3-0766b4383fe5",
            "version": "KqlParameterItem/1.0",
            "name": "selectedChartIntervalEndTime",
            "type": 1,
            "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"// Time (x-coordinate) selected on a chart is generated by make-series and is unlikely to match any existing interval_end_time.\\r\\n// Look up the nearest interval_end_time here.\\r\\nunion\\r\\n(\\r\\nsqldb_single_database_query_runtime_stats\\r\\n| where interval_start_time >= todatetime(\\\"{qdsStartTime}\\\") and interval_end_time <= todatetime(\\\"{selectedChartPlan:$.x}\\\")\\r\\n| where logical_server_name =~ @\\\"{serverName}\\\"\\r\\n| where database_name =~ @\\\"{databaseName}\\\"\\r\\n| where replica_type == \\\"{qdsCollectionReplicaType}\\\"\\r\\n| where execution_type in ({qdsExecutionType})\\r\\n| where query_id == iif(\\\"{qdsAggBy}\\\"==\\\"query_id\\\", {query_id}, query_id)\\r\\n| where query_plan_hash == iif(\\\"{qdsAggBy}\\\"==\\\"query_hash\\\", replace_string(\\\"{selectedChartPlan:$.series}\\\", \\\"Plan hash: \\\", \\\"\\\"), query_plan_hash)\\r\\n| where plan_id == iif(\\\"{qdsAggBy}\\\"==\\\"query_id\\\", tolong(replace_string(\\\"{selectedChartPlan:$.series}\\\", \\\"Plan ID: \\\", \\\"\\\")), plan_id)\\r\\n| summarize interval_end_time = max(interval_end_time)\\r\\n),\\r\\n(\\r\\nsqldb_single_database_query_runtime_stats\\r\\n| where interval_start_time >= todatetime(\\\"{selectedChartPlan:$.x}\\\") and interval_end_time <= todatetime(\\\"{qdsEndTime}\\\")\\r\\n| where logical_server_name =~ @\\\"{serverName}\\\"\\r\\n| where database_name =~ @\\\"{databaseName}\\\"\\r\\n| where query_id == iif(\\\"{qdsAggBy}\\\"==\\\"query_id\\\", {query_id}, query_id)\\r\\n| where query_plan_hash == iif(\\\"{qdsAggBy}\\\"==\\\"query_hash\\\", replace_string(\\\"{selectedChartPlan:$.series}\\\", \\\"Plan hash: \\\", \\\"\\\"), query_plan_hash)\\r\\n| where plan_id == iif(\\\"{qdsAggBy}\\\"==\\\"query_id\\\", tolong(replace_string(\\\"{selectedChartPlan:$.series}\\\", \\\"Plan ID: \\\", \\\"\\\")), plan_id)\\r\\n| summarize interval_end_time = min(interval_end_time)\\r\\n)\\r\\n| summarize interval_end_time = min(interval_end_time)\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 9
          },
          {
            "id": "58eba7e0-da24-47e5-9fc3-01af84b0046c",
            "version": "KqlParameterItem/1.0",
            "name": "selectedGridPlanId",
            "type": 1,
            "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"print plan_id = tolong(\\\"{selectedGridPlan:$.plan_id}\\\")\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 9
          },
          {
            "version": "KqlParameterItem/1.0",
            "name": "selectedGridPlanHash",
            "type": 1,
            "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"print plan_hash = \\\"{selectedGridPlan:$.query_plan_hash}\\\"\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 9,
            "id": "9a067423-b19d-4dc7-a256-e07c2b9ea121"
          },
          {
            "id": "aa9ce676-6214-44be-8a4a-af84f775c14e",
            "version": "KqlParameterItem/1.0",
            "name": "selectedGridIntervalEndTime",
            "type": 1,
            "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"print interval_end_time = \\\"{selectedGridPlan:$.interval_end_time}\\\"\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 9
          },
          {
            "id": "3977044c-1e4b-4277-86a0-0cf85f2ed2e5",
            "version": "KqlParameterItem/1.0",
            "name": "selectedPlanId",
            "type": 1,
            "isHiddenWhenLocked": true,
            "criteriaData": [
              {
                "criteriaContext": {
                  "leftOperand": "showPlansAs",
                  "operator": "==",
                  "rightValType": "static",
                  "rightVal": "grid",
                  "resultValType": "param",
                  "resultVal": "selectedGridPlanId"
                }
              },
              {
                "criteriaContext": {
                  "leftOperand": "showPlansAs",
                  "operator": "==",
                  "rightValType": "static",
                  "rightVal": "chart",
                  "resultValType": "param",
                  "resultVal": "selectedChartPlanId"
                }
              },
              {
                "criteriaContext": {
                  "operator": "Default",
                  "resultValType": "static",
                  "resultVal": "0"
                }
              }
            ],
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "version": "KqlParameterItem/1.0",
            "name": "selectedPlanHash",
            "type": 1,
            "isHiddenWhenLocked": true,
            "criteriaData": [
              {
                "criteriaContext": {
                  "leftOperand": "showPlansAs",
                  "operator": "==",
                  "rightValType": "static",
                  "rightVal": "grid",
                  "resultValType": "param",
                  "resultVal": "selectedGridPlanHash"
                }
              },
              {
                "criteriaContext": {
                  "leftOperand": "showPlansAs",
                  "operator": "==",
                  "rightValType": "static",
                  "rightVal": "chart",
                  "resultValType": "param",
                  "resultVal": "selectedChartPlanHash"
                }
              },
              {
                "criteriaContext": {
                  "operator": "Default",
                  "resultValType": "static",
                  "resultVal": "0"
                }
              }
            ],
            "timeContext": {
              "durationMs": 86400000
            },
            "id": "2581ca6b-6021-4f79-96fe-3d0d49cda90c"
          },
          {
            "version": "KqlParameterItem/1.0",
            "name": "selectedIntervalEndTime",
            "type": 1,
            "isHiddenWhenLocked": true,
            "criteriaData": [
              {
                "criteriaContext": {
                  "leftOperand": "showPlansAs",
                  "operator": "==",
                  "rightValType": "static",
                  "rightVal": "grid",
                  "resultValType": "param",
                  "resultVal": "selectedGridIntervalEndTime"
                }
              },
              {
                "criteriaContext": {
                  "leftOperand": "showPlansAs",
                  "operator": "==",
                  "rightValType": "static",
                  "rightVal": "chart",
                  "resultValType": "param",
                  "resultVal": "selectedChartIntervalEndTime"
                }
              },
              {
                "criteriaContext": {
                  "operator": "Default",
                  "resultValType": "static",
                  "resultVal": "\"1900-01-01\""
                }
              }
            ],
            "timeContext": {
              "durationMs": 86400000
            },
            "id": "903fef93-1c44-4bd7-867e-14b50d01f80e"
          }
        ],
        "style": "pills",
        "queryType": 9
      },
      "name": "selected_plan_parameters"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "links": [
          {
            "id": "96c6627e-1c4f-49cb-86e8-928964ecfc19",
            "cellValue": "planTabName",
            "linkTarget": "parameter",
            "linkLabel": "Plan details",
            "subTarget": "details",
            "style": "link"
          },
          {
            "id": "e8e0a56b-d1d9-46d0-ab32-e5864d25574f",
            "cellValue": "planTabName",
            "linkTarget": "parameter",
            "linkLabel": "Plan XML",
            "subTarget": "xmlPlan",
            "style": "link"
          }
        ]
      },
      "conditionalVisibilities": [
        {
          "parameterName": "qdsMetric",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsAggregation",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsTopQueryCount",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsAggBy",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "query_hash",
          "comparison": "isNotEqualTo",
          "value": "\"\""
        },
        {
          "parameterName": "selectedPlanId",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "selectedIntervalEndTime",
          "comparison": "isNotEqualTo",
          "value": "null"
        }
      ],
      "name": "plan_detail_tabs"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"let plan_property = datatable(key:int, plan_property_name:string) [\\r\\n1, \\\"engine_version\\\",\\r\\n1, \\\"query_plan_hash\\\",\\r\\n1, \\\"last_force_failure_reason_desc\\\",\\r\\n1, \\\"plan_forcing_type_desc\\\"\\r\\n];\\r\\nsqldb_single_database_query_runtime_stats\\r\\n| where interval_end_time == todatetime(\\\"{selectedIntervalEndTime}\\\")\\r\\n| where logical_server_name =~ @\\\"{serverName}\\\"\\r\\n| where database_name == @\\\"{databaseName}\\\"\\r\\n| where replica_type == \\\"{qdsCollectionReplicaType}\\\"\\r\\n| where execution_type in ({qdsExecutionType})\\r\\n| where plan_id == iif(\\\"{qdsAggBy}\\\"==\\\"query_id\\\", {selectedPlanId}, plan_id)\\r\\n| where query_plan_hash == iif(\\\"{qdsAggBy}\\\"==\\\"query_hash\\\", \\\"{selectedPlanHash}\\\", query_plan_hash)\\r\\n| summarize arg_max(interval_end_time, engine_version, query_plan_hash, last_force_failure_reason_desc, plan_forcing_type_desc)\\r\\n| extend key = int(1)\\r\\n| join kind=inner plan_property on key\\r\\n| project plan_property_name, engine_version, query_plan_hash, last_force_failure_reason_desc, plan_forcing_type_desc\\r\\n| extend plan_property_value = case(\\r\\n                                    plan_property_name == \\\"engine_version\\\", engine_version,\\r\\n                                    plan_property_name == \\\"query_plan_hash\\\", query_plan_hash,\\r\\n                                    plan_property_name == \\\"last_force_failure_reason_desc\\\", last_force_failure_reason_desc,\\r\\n                                    plan_property_name == \\\"plan_forcing_type_desc\\\", plan_forcing_type_desc,\\r\\n                                    \\\"\\\"\\r\\n                                    )\\r\\n| project-away engine_version, query_plan_hash, last_force_failure_reason_desc, plan_forcing_type_desc\\r\\n| sort by plan_property_name asc;\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
              "size": 3,
              "showAnalytics": true,
              "noDataMessage": "There is no data for specified parameters.",
              "showExportToExcel": true,
              "queryType": 9,
              "gridSettings": {
                "labelSettings": [
                  {
                    "columnId": "plan_property_name",
                    "label": "Property"
                  },
                  {
                    "columnId": "plan_property_value",
                    "label": "Value"
                  }
                ]
              }
            },
            "customWidth": "33",
            "name": "plan_details_string"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"let plan_property = datatable(key:int, plan_property_name:string) [\\r\\n1, \\\"is_parallel_plan\\\",\\r\\n1, \\\"is_forced_plan\\\",\\r\\n1, \\\"is_natively_compiled\\\",\\r\\n1, \\\"has_compile_replay_script\\\"\\r\\n];\\r\\nsqldb_single_database_query_runtime_stats\\r\\n| where interval_end_time == todatetime(\\\"{selectedIntervalEndTime}\\\")\\r\\n| where logical_server_name =~ @\\\"{serverName}\\\"\\r\\n| where database_name == @\\\"{databaseName}\\\"\\r\\n| where replica_type == \\\"{qdsCollectionReplicaType}\\\"\\r\\n| where execution_type in ({qdsExecutionType})\\r\\n| where plan_id == iif(\\\"{qdsAggBy}\\\"==\\\"query_id\\\", {selectedPlanId}, plan_id)\\r\\n| where query_plan_hash == iif(\\\"{qdsAggBy}\\\"==\\\"query_hash\\\", \\\"{selectedPlanHash}\\\", query_plan_hash)\\r\\n| summarize arg_max(interval_end_time, is_parallel_plan, is_forced_plan, is_natively_compiled, has_compile_replay_script)\\r\\n| extend key = int(1)\\r\\n| join kind=inner plan_property on key\\r\\n| project plan_property_name, is_parallel_plan, is_forced_plan, is_natively_compiled, has_compile_replay_script\\r\\n| extend plan_property_value = case(\\r\\n                                    plan_property_name == \\\"is_parallel_plan\\\", is_parallel_plan,\\r\\n                                    plan_property_name == \\\"is_forced_plan\\\", is_forced_plan,\\r\\n                                    plan_property_name == \\\"is_natively_compiled\\\", is_natively_compiled,\\r\\n                                    plan_property_name == \\\"has_compile_replay_script\\\", has_compile_replay_script,\\r\\n                                    bool(null)\\r\\n                                    )\\r\\n| project-away is_parallel_plan, is_forced_plan, is_natively_compiled, has_compile_replay_script\\r\\n| sort by plan_property_name asc;\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
              "size": 3,
              "showAnalytics": true,
              "noDataMessage": "There is no data for specified parameters.",
              "showExportToExcel": true,
              "queryType": 9,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "plan_property_value",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "true",
                          "representation": "Check",
                          "text": ""
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "false",
                          "representation": "Subtract",
                          "text": ""
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "plan_property_name",
                    "label": "Property"
                  },
                  {
                    "columnId": "plan_property_value",
                    "label": "Value"
                  }
                ]
              }
            },
            "customWidth": "33",
            "name": "plan_details_boolean"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"let plan_property = datatable(key:int, plan_property_name:string) [\\r\\n1, \\\"plan_id\\\",\\r\\n1, \\\"plan_group_id\\\",\\r\\n1, \\\"force_failure_count\\\",\\r\\n1, \\\"plan_count_compiles\\\",\\r\\n1, \\\"compatibility_level\\\"\\r\\n];\\r\\nsqldb_single_database_query_runtime_stats\\r\\n| where interval_end_time == todatetime(\\\"{selectedIntervalEndTime}\\\")\\r\\n| where logical_server_name =~ @\\\"{serverName}\\\"\\r\\n| where database_name == @\\\"{databaseName}\\\"\\r\\n| where replica_type == \\\"{qdsCollectionReplicaType}\\\"\\r\\n| where execution_type in ({qdsExecutionType})\\r\\n| where plan_id == iif(\\\"{qdsAggBy}\\\"==\\\"query_id\\\", {selectedPlanId}, plan_id)\\r\\n| where query_plan_hash == iif(\\\"{qdsAggBy}\\\"==\\\"query_hash\\\", \\\"{selectedPlanHash}\\\", query_plan_hash)\\r\\n| summarize arg_max(interval_end_time, plan_id, plan_group_id, force_failure_count, plan_count_compiles, compatibility_level)\\r\\n| extend key = int(1)\\r\\n| join kind=inner plan_property on key\\r\\n| project plan_property_name, plan_id, plan_group_id, force_failure_count, plan_count_compiles, compatibility_level\\r\\n| extend plan_property_value = case(\\r\\n                                    plan_property_name == \\\"plan_id\\\", plan_id,\\r\\n                                    plan_property_name == \\\"plan_group_id\\\", plan_group_id,\\r\\n                                    plan_property_name == \\\"force_failure_count\\\", force_failure_count,\\r\\n                                    plan_property_name == \\\"plan_count_compiles\\\", plan_count_compiles,\\r\\n                                    plan_property_name == \\\"compatibility_level\\\", tolong(compatibility_level),\\r\\n                                    long(null)\\r\\n                                    )\\r\\n| project-away plan_id, plan_group_id, force_failure_count, plan_count_compiles, compatibility_level\\r\\n| sort by plan_property_name asc;\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
              "size": 3,
              "showAnalytics": true,
              "noDataMessage": "There is no data for specified parameters.",
              "showExportToExcel": true,
              "queryType": 9,
              "gridSettings": {
                "labelSettings": [
                  {
                    "columnId": "plan_property_name",
                    "label": "Property"
                  },
                  {
                    "columnId": "plan_property_value",
                    "label": "Value"
                  }
                ]
              }
            },
            "customWidth": "33",
            "name": "plan_details_number"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"let plan_property = datatable(key:int, plan_property_name:string) [\\r\\n1, \\\"plan_initial_compile_start_time\\\",\\r\\n1, \\\"plan_last_compile_start_time\\\",\\r\\n1, \\\"plan_last_execution_time\\\"\\r\\n];\\r\\nsqldb_single_database_query_runtime_stats\\r\\n| where interval_end_time == todatetime(\\\"{selectedIntervalEndTime}\\\")\\r\\n| where logical_server_name =~ @\\\"{serverName}\\\"\\r\\n| where database_name == @\\\"{databaseName}\\\"\\r\\n| where replica_type == \\\"{qdsCollectionReplicaType}\\\"\\r\\n| where execution_type in ({qdsExecutionType})\\r\\n| where plan_id == iif(\\\"{qdsAggBy}\\\"==\\\"query_id\\\", {selectedPlanId}, plan_id)\\r\\n| where query_plan_hash == iif(\\\"{qdsAggBy}\\\"==\\\"query_hash\\\", \\\"{selectedPlanHash}\\\", query_plan_hash)\\r\\n| summarize arg_max(interval_end_time, plan_initial_compile_start_time, plan_last_compile_start_time, plan_last_execution_time)\\r\\n| extend key = int(1)\\r\\n| join kind=inner plan_property on key\\r\\n| project plan_property_name, plan_initial_compile_start_time, plan_last_compile_start_time, plan_last_execution_time\\r\\n| extend plan_property_value = case(\\r\\n                                    plan_property_name == \\\"plan_initial_compile_start_time\\\", plan_initial_compile_start_time,\\r\\n                                    plan_property_name == \\\"plan_last_compile_start_time\\\", plan_last_compile_start_time,\\r\\n                                    plan_property_name == \\\"plan_last_execution_time\\\", plan_last_execution_time,\\r\\n                                    datetime(null)\\r\\n                                    )\\r\\n| project-away plan_initial_compile_start_time, plan_last_compile_start_time, plan_last_execution_time\\r\\n| sort by plan_property_name asc;\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
              "size": 3,
              "showAnalytics": true,
              "noDataMessage": "There is no data for specified parameters.",
              "showExportToExcel": true,
              "queryType": 9,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "plan_property_value",
                    "formatter": 6,
                    "dateFormat": {
                      "showUtcTime": null,
                      "formatName": "shortDateTimePattern"
                    }
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "plan_property_name",
                    "label": "Property"
                  },
                  {
                    "columnId": "plan_property_value",
                    "label": "Value"
                  }
                ]
              }
            },
            "customWidth": "33",
            "name": "plan_details_datetime"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"let plan_property = datatable(key:int, plan_property_name:string) [\\r\\n1, \\\"plan_avg_compile_duration\\\",\\r\\n1, \\\"plan_last_compile_duration\\\"\\r\\n];\\r\\nsqldb_single_database_query_runtime_stats\\r\\n| where interval_end_time == todatetime(\\\"{selectedIntervalEndTime}\\\")\\r\\n| where logical_server_name =~ @\\\"{serverName}\\\"\\r\\n| where database_name == @\\\"{databaseName}\\\"\\r\\n| where replica_type == \\\"{qdsCollectionReplicaType}\\\"\\r\\n| where execution_type in ({qdsExecutionType})\\r\\n| where plan_id == iif(\\\"{qdsAggBy}\\\"==\\\"query_id\\\", {selectedPlanId}, plan_id)\\r\\n| where query_plan_hash == iif(\\\"{qdsAggBy}\\\"==\\\"query_hash\\\", \\\"{selectedPlanHash}\\\", query_plan_hash)\\r\\n| summarize arg_max(interval_end_time, plan_avg_compile_duration_us, plan_last_compile_duration_us)\\r\\n| extend key = int(1)\\r\\n| join kind=inner plan_property on key\\r\\n| project plan_property_name, plan_avg_compile_duration_us, plan_last_compile_duration_us\\r\\n| extend plan_property_value = case(\\r\\n                                    plan_property_name == \\\"plan_avg_compile_duration\\\", plan_avg_compile_duration_us,\\r\\n                                    plan_property_name == \\\"plan_last_compile_duration\\\", toreal(plan_last_compile_duration_us),\\r\\n                                    real(null)\\r\\n                                    )\\r\\n| project-away plan_avg_compile_duration_us, plan_last_compile_duration_us\\r\\n| sort by plan_property_name asc;\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
              "size": 3,
              "showAnalytics": true,
              "noDataMessage": "There is no data for specified parameters.",
              "showExportToExcel": true,
              "queryType": 9,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "plan_property_value",
                    "formatter": 0,
                    "numberFormat": {
                      "unit": 22,
                      "options": {
                        "style": "decimal",
                        "useGrouping": true
                      }
                    }
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "plan_property_name",
                    "label": "Property"
                  },
                  {
                    "columnId": "plan_property_value",
                    "label": "Value"
                  }
                ]
              }
            },
            "customWidth": "33",
            "name": "plan_details_duration"
          }
        ]
      },
      "conditionalVisibilities": [
        {
          "parameterName": "planTabName",
          "comparison": "isEqualTo",
          "value": "details"
        },
        {
          "parameterName": "selectedPlanId",
          "comparison": "isNotEqualTo"
        }
      ],
      "name": "plan_details_group"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "{\"version\":\"AzureDataExplorerQuery/1.0\",\"queryText\":\"sqldb_single_database_query_runtime_stats\\r\\n| where interval_start_time >= todatetime(\\\"{qdsStartTime}\\\") and interval_end_time <= todatetime(\\\"{qdsEndTime}\\\")\\r\\n| where logical_server_name =~ @\\\"{serverName}\\\"\\r\\n| where database_name == @\\\"{databaseName}\\\"\\r\\n| where replica_type == \\\"{qdsCollectionReplicaType}\\\"\\r\\n| where execution_type in ({qdsExecutionType})\\r\\n| where plan_id == iif(\\\"{qdsAggBy}\\\"==\\\"query_id\\\", {selectedPlanId}, plan_id)\\r\\n| where query_plan_hash == iif(\\\"{qdsAggBy}\\\"==\\\"query_hash\\\", \\\"{selectedPlanHash}\\\", query_plan_hash)\\r\\n| summarize arg_max(interval_end_time, query_plan)\\r\\n| project query_plan\",\"clusterName\":\"{adxClusterUri}\",\"databaseName\":\"{adxDatabase}\"}",
        "size": 3,
        "noDataMessage": "Unknown",
        "queryType": 9,
        "visualization": "card",
        "textSettings": {
          "style": "editor"
        }
      },
      "conditionalVisibilities": [
        {
          "parameterName": "query_hash",
          "comparison": "isNotEqualTo",
          "value": "\"\""
        },
        {
          "parameterName": "qdsMetric",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsAggregation",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "qdsTopQueryCount",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "selectedPlanId",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "selectedIntervalEndTime",
          "comparison": "isNotEqualTo",
          "value": "null"
        },
        {
          "parameterName": "planTabName",
          "comparison": "isEqualTo",
          "value": "xmlPlan"
        }
      ],
      "customWidth": "50",
      "name": "query_xml_plan"
    }
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}