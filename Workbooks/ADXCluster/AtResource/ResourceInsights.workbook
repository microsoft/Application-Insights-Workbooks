{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "f3c4e9cb-8f5c-45ef-9ff9-9517d2a4aa19",
            "version": "KqlParameterItem/1.0",
            "name": "Resource",
            "label": "ADX-Cluster",
            "type": 5,
            "isRequired": true,
            "value": "value::1",
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "resourceTypeFilter": {
                "microsoft.kusto/clusters": true
              },
              "additionalResourceOptions": [
                "value::1"
              ]
            }
          },
          {
            "id": "182d6324-854c-4cc0-802a-de4f3bee9f76",
            "version": "KqlParameterItem/1.0",
            "name": "TimeRange",
            "label": "Time range",
            "type": 4,
            "isRequired": true,
            "value": {
              "durationMs": 604800000
            },
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 900000
                },
                {
                  "durationMs": 1800000
                },
                {
                  "durationMs": 3600000
                },
                {
                  "durationMs": 14400000
                },
                {
                  "durationMs": 43200000
                },
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 172800000
                },
                {
                  "durationMs": 259200000
                },
                {
                  "durationMs": 604800000
                }
              ],
              "allowCustom": true
            }
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.kusto/clusters"
      },
      "name": "parameters - 0",
      "styleSettings": {
        "margin": "15px 0 0 0"
      }
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "{Resource}"
        ],
        "parameters": [
          {
            "id": "aae60b9f-7b11-4c85-a963-81bfcf6b85c1",
            "version": "KqlParameterItem/1.0",
            "name": "Usage",
            "type": 1,
            "isRequired": true,
            "query": "let hasNonEmptyTable = (T:string, T2:string) \r\n{ \r\n   toscalar( \r\n   union isfuzzy=true \r\n   ( table(T) | take 1 | count as Count ),\r\n   ( table(T2) | take 1 | count as Count),\r\n   (print Count=0) \r\n   | summarize sum(Count) \r\n   ) > 1\r\n};\r\nlet TableName = 'ADXCommand';\r\nlet TableName2 = 'ADXQuery';\r\nprint  IsPresent=iif(hasNonEmptyTable(TableName,TableName2 ), \"present\", \"not present\")",
            "crossComponentResources": [
              "{Resource}"
            ],
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 604800000
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 0,
            "resourceType": "microsoft.kusto/clusters"
          }
        ],
        "style": "above",
        "queryType": 0,
        "resourceType": "microsoft.kusto/clusters"
      },
      "conditionalVisibility": {
        "parameterName": "1",
        "comparison": "isEqualTo",
        "value": "2"
      },
      "name": "parameters - 4"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "links": [
          {
            "cellValue": "tab",
            "linkTarget": "parameter",
            "linkLabel": "Overview",
            "subTarget": "Overview",
            "style": "link"
          },
          {
            "cellValue": "tab",
            "linkTarget": "parameter",
            "linkLabel": "Key Metrics",
            "subTarget": "Cluster",
            "style": "link"
          },
          {
            "cellValue": "tab",
            "linkTarget": "parameter",
            "linkLabel": "Usage",
            "subTarget": "Commands",
            "style": "link"
          },
          {
            "cellValue": "tab",
            "linkTarget": "parameter",
            "linkLabel": "Tables",
            "subTarget": "TablesTab",
            "style": "link"
          }
        ]
      },
      "name": "Tabs",
      "styleSettings": {
        "margin": "-15px 0px -15px 0px"
      }
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 10,
            "content": {
              "chartId": "workbook19356bdc-cfd5-47c7-8e70-05bbd3f39558",
              "version": "MetricsItem/2.0",
              "size": 3,
              "chartType": -1,
              "resourceType": "microsoft.kusto/clusters",
              "metricScope": 0,
              "resourceParameter": "Resource",
              "resourceIds": [
                "{Resource}"
              ],
              "timeContextFromParameter": "TimeRange",
              "timeContext": {
                "durationMs": 604800000
              },
              "metrics": [
                {
                  "namespace": "microsoft.kusto/clusters",
                  "metric": "microsoft.kusto/clusters-Cluster health-KeepAlive",
                  "aggregation": 4,
                  "columnName": "Keep Alive (Avg)"
                }
              ],
              "gridFormatType": 1,
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "Metric",
                  "formatter": 1,
                  "tooltipFormat": {
                    "tooltip": "An average Keep Alive below 0.995 (over a long period) may indicate a health issue or may indicate that your cluster was suspended (Pay attention to your time range. This rule is important over a long period). This tile shows up to 4 significant digits."
                  }
                },
                "subtitleContent": {
                  "columnMatch": "Value",
                  "formatter": 18,
                  "formatOptions": {
                    "thresholdsOptions": "icons",
                    "thresholdsGrid": [
                      {
                        "operator": "<=",
                        "thresholdValue": "0.995",
                        "representation": "2",
                        "text": ""
                      },
                      {
                        "operator": "Default",
                        "thresholdValue": null,
                        "representation": "success",
                        "text": ""
                      }
                    ]
                  },
                  "tooltipFormat": {
                    "tooltip": "An average Keep Alive below 0.995 (over a long period) may indicate a health issue or may indicate that your cluster was suspended (Pay attention to your time range. This rule is important over a long period). This tile shows up to 4 significant digits."
                  }
                },
                "leftContent": {
                  "columnMatch": "Value",
                  "formatter": 1,
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "useGrouping": false,
                      "maximumFractionDigits": 2,
                      "maximumSignificantDigits": 4
                    }
                  },
                  "tooltipFormat": {
                    "tooltip": "An average Keep Alive below 0.995 (over a long period) may indicate a health issue or may indicate that your cluster was suspended (Pay attention to your time range. This rule is important over a long period). This tile shows up to 4 significant digits."
                  }
                },
                "secondaryContent": {
                  "columnMatch": "Timeline",
                  "formatter": 9,
                  "formatOptions": {
                    "min": 0,
                    "max": 1,
                    "palette": "blue"
                  },
                  "tooltipFormat": {
                    "tooltip": "An average Keep Alive below 0.995 (over a long period) may indicate a health issue or may indicate that your cluster was suspended (Pay attention to your time range. This rule is important over a long period). This tile shows up to 4 significant digits."
                  }
                },
                "showBorder": false,
                "size": "full"
              },
              "gridSettings": {
                "rowLimit": 10000
              },
              "sortBy": []
            },
            "customWidth": "0",
            "showPin": false,
            "name": "summary tiles"
          },
          {
            "type": 10,
            "content": {
              "chartId": "workbook19356bdc-cfd5-47c7-8e70-05bbd3f39558",
              "version": "MetricsItem/2.0",
              "size": 3,
              "chartType": -1,
              "resourceType": "microsoft.kusto/clusters",
              "metricScope": 0,
              "resourceParameter": "Resource",
              "resourceIds": [
                "{Resource}"
              ],
              "timeContextFromParameter": "TimeRange",
              "timeContext": {
                "durationMs": 604800000
              },
              "metrics": [
                {
                  "namespace": "microsoft.kusto/clusters",
                  "metric": "microsoft.kusto/clusters-Cluster health-CPU",
                  "aggregation": 4,
                  "columnName": "CPU (Avg)"
                }
              ],
              "gridFormatType": 1,
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "Metric",
                  "formatter": 1,
                  "tooltipFormat": {
                    "tooltip": "An average CPU of 80% or less (over a long period) is sustainable for a cluster"
                  }
                },
                "subtitleContent": {
                  "columnMatch": "Value",
                  "formatter": 18,
                  "formatOptions": {
                    "thresholdsOptions": "icons",
                    "thresholdsGrid": [
                      {
                        "operator": ">=",
                        "thresholdValue": "80",
                        "representation": "2",
                        "text": ""
                      },
                      {
                        "operator": "==",
                        "thresholdValue": "0",
                        "representation": "Normal",
                        "text": ""
                      },
                      {
                        "operator": "Default",
                        "thresholdValue": null,
                        "representation": "success",
                        "text": ""
                      }
                    ]
                  },
                  "tooltipFormat": {
                    "tooltip": "An average CPU of 80% or less (over a long period) is sustainable for a cluster"
                  }
                },
                "leftContent": {
                  "columnMatch": "Value",
                  "formatter": 1,
                  "numberFormat": {
                    "unit": 1,
                    "options": {
                      "style": "decimal",
                      "useGrouping": false,
                      "maximumFractionDigits": 4
                    }
                  },
                  "tooltipFormat": {
                    "tooltip": "An average CPU of 80% or less (over a long period) is sustainable for a cluster"
                  }
                },
                "secondaryContent": {
                  "columnMatch": "Timeline",
                  "formatter": 9,
                  "formatOptions": {
                    "min": 0,
                    "max": 100,
                    "palette": "blue"
                  },
                  "tooltipFormat": {
                    "tooltip": "An average CPU of 80% or less is sustainable for a cluster (over a long time period)"
                  }
                },
                "showBorder": false,
                "size": "full"
              },
              "gridSettings": {
                "rowLimit": 10000
              },
              "sortBy": []
            },
            "customWidth": "0",
            "showPin": false,
            "name": "summary tiles",
            "styleSettings": {
              "margin": "0px"
            }
          },
          {
            "type": 10,
            "content": {
              "chartId": "workbookc80219c7-4cf9-4a69-be8f-b72305af2789",
              "version": "MetricsItem/2.0",
              "size": 3,
              "chartType": -1,
              "resourceType": "microsoft.kusto/clusters",
              "metricScope": 0,
              "resourceParameter": "Resource",
              "resourceIds": [
                "{Resource}"
              ],
              "timeContextFromParameter": "TimeRange",
              "timeContext": {
                "durationMs": 604800000
              },
              "metrics": [
                {
                  "namespace": "microsoft.kusto/clusters",
                  "metric": "microsoft.kusto/clusters-Cluster health-IngestionUtilization",
                  "aggregation": 4,
                  "columnName": "Ingestion Utilization (Avg)"
                }
              ],
              "gridFormatType": 1,
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "Metric",
                  "formatter": 13,
                  "formatOptions": {
                    "linkTarget": null,
                    "showIcon": false
                  },
                  "tooltipFormat": {
                    "tooltip": "Percentage of actual resources used to ingest data from the total resources allocated, in the capacity policy, to perform ingestion.  An average ingestion utilization of 80% or less (over a long period) is a sustainable state for a cluster."
                  }
                },
                "subtitleContent": {
                  "columnMatch": "Value",
                  "formatter": 18,
                  "formatOptions": {
                    "thresholdsOptions": "icons",
                    "thresholdsGrid": [
                      {
                        "operator": ">=",
                        "thresholdValue": "80",
                        "representation": "2",
                        "text": ""
                      },
                      {
                        "operator": "Default",
                        "thresholdValue": null,
                        "representation": "success",
                        "text": ""
                      }
                    ]
                  },
                  "tooltipFormat": {
                    "tooltip": "Percentage of actual resources used to ingest data from the total resources allocated, in the capacity policy, to perform ingestion.  An average ingestion utilization of 80% or less (over a long period) is a sustainable state for a cluster."
                  }
                },
                "leftContent": {
                  "columnMatch": "Value",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "none"
                  },
                  "numberFormat": {
                    "unit": 1,
                    "options": {
                      "style": "decimal",
                      "useGrouping": false,
                      "maximumFractionDigits": 4
                    }
                  },
                  "tooltipFormat": {
                    "tooltip": "Percentage of actual resources used to ingest data from the total resources allocated, in the capacity policy, to perform ingestion.  An average ingestion utilization of 80% or less (over a long period) is a sustainable state for a cluster."
                  }
                },
                "secondaryContent": {
                  "columnMatch": "Timeline",
                  "formatter": 9,
                  "formatOptions": {
                    "min": 0,
                    "max": 100,
                    "palette": "blue"
                  },
                  "tooltipFormat": {
                    "tooltip": "Percentage of actual resources used to ingest data from the total resources allocated, in the capacity policy, to perform ingestion.  An average ingestion utilization of 80% or less (over a long period) is a sustainable state for a cluster."
                  }
                },
                "showBorder": false,
                "size": "full"
              },
              "gridSettings": {
                "rowLimit": 10000
              }
            },
            "customWidth": "0",
            "showPin": false,
            "name": "metric"
          },
          {
            "type": 10,
            "content": {
              "chartId": "workbookc80219c7-4cf9-4a69-be8f-b72305af2789",
              "version": "MetricsItem/2.0",
              "size": 3,
              "chartType": -1,
              "resourceType": "microsoft.kusto/clusters",
              "metricScope": 0,
              "resourceParameter": "Resource",
              "resourceIds": [
                "{Resource}"
              ],
              "timeContextFromParameter": "TimeRange",
              "timeContext": {
                "durationMs": 604800000
              },
              "metrics": [
                {
                  "namespace": "microsoft.kusto/clusters",
                  "metric": "microsoft.kusto/clusters-Ingestion health and performance-IngestionLatencyInSeconds",
                  "aggregation": 4,
                  "columnName": "Ingestion Latency (Avg)"
                }
              ],
              "gridFormatType": 1,
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "Metric",
                  "formatter": 13,
                  "formatOptions": {
                    "linkTarget": null,
                    "showIcon": false
                  },
                  "tooltipFormat": {
                    "tooltip": "The ingestion latency period depends on the ingestion scenario. As a general rule, an average Ingestion Latency above 15 minutes (over a long period) may indicate a problem"
                  }
                },
                "subtitleContent": {
                  "columnMatch": "Value",
                  "formatter": 18,
                  "formatOptions": {
                    "thresholdsOptions": "icons",
                    "thresholdsGrid": [
                      {
                        "operator": ">=",
                        "thresholdValue": "900",
                        "representation": "2",
                        "text": ""
                      },
                      {
                        "operator": "Default",
                        "thresholdValue": null,
                        "representation": "success",
                        "text": ""
                      }
                    ]
                  },
                  "tooltipFormat": {
                    "tooltip": "The ingestion latency period depends on the ingestion scenario. As a general rule, an average Ingestion Latency above 15 minutes (over a long period) may indicate a problem"
                  }
                },
                "leftContent": {
                  "columnMatch": "Value",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "none"
                  },
                  "numberFormat": {
                    "unit": 24,
                    "options": {
                      "style": "decimal",
                      "useGrouping": false,
                      "maximumFractionDigits": 2
                    }
                  },
                  "tooltipFormat": {
                    "tooltip": "The ingestion latency period depends on the ingestion scenario. As a general rule, an average Ingestion Latency above 15 minutes (over a long period) may indicate a problem"
                  }
                },
                "secondaryContent": {
                  "columnMatch": "Timeline",
                  "formatter": 9,
                  "formatOptions": {
                    "palette": "blue"
                  },
                  "tooltipFormat": {
                    "tooltip": "The ingestion latency period depends on the ingestion scenario. As a general rule, an average Ingestion Latency above 15 minutes (over a long period) may indicate a problem"
                  }
                },
                "showBorder": false,
                "size": "full"
              },
              "gridSettings": {
                "rowLimit": 10000
              }
            },
            "customWidth": "0",
            "showPin": false,
            "name": "metric - 13"
          },
          {
            "type": 10,
            "content": {
              "chartId": "workbook19356bdc-cfd5-47c7-8e70-05bbd3f39558",
              "version": "MetricsItem/2.0",
              "size": 3,
              "chartType": -1,
              "resourceType": "microsoft.kusto/clusters",
              "metricScope": 0,
              "resourceParameter": "Resource",
              "resourceIds": [
                "{Resource}"
              ],
              "timeContextFromParameter": "TimeRange",
              "timeContext": {
                "durationMs": 604800000
              },
              "metrics": [
                {
                  "namespace": "microsoft.kusto/clusters",
                  "metric": "microsoft.kusto/clusters-Cluster health-CacheUtilization",
                  "aggregation": 4,
                  "columnName": "Cache Utilization (Avg)"
                }
              ],
              "gridFormatType": 1,
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "Metric",
                  "formatter": 1,
                  "tooltipFormat": {
                    "tooltip": "An average cache utilization of 80% or less (over a long period) is a sustainable state for a cluster. If the average cache utilization is above 80% (over a long period), the cluster should be scaled up to a storage optimized pricing tier or scaled out to more instances.  Alternatively, adapt the cache policy (fewer days in cache)."
                  }
                },
                "subtitleContent": {
                  "columnMatch": "Value",
                  "formatter": 18,
                  "formatOptions": {
                    "thresholdsOptions": "icons",
                    "thresholdsGrid": [
                      {
                        "operator": ">=",
                        "thresholdValue": "80",
                        "representation": "2",
                        "text": ""
                      },
                      {
                        "operator": "Default",
                        "thresholdValue": null,
                        "representation": "success",
                        "text": ""
                      }
                    ]
                  },
                  "tooltipFormat": {
                    "tooltip": "An average cache utilization of 80% or less (over a long period) is a sustainable state for a cluster. If the average cache utilization is above 80% (over a long period), the cluster should be scaled up to a storage optimized pricing tier or scaled out to more instances. Alternatively, adapt the cache policy (fewer days in cache)."
                  }
                },
                "leftContent": {
                  "columnMatch": "Value",
                  "formatter": 1,
                  "numberFormat": {
                    "unit": 1,
                    "options": {
                      "style": "decimal",
                      "useGrouping": false,
                      "maximumFractionDigits": 2
                    }
                  },
                  "tooltipFormat": {
                    "tooltip": "An average cache utilization of 80% or less (over a long period) is a sustainable state for a cluster. If the average cache utilization is above 80% (over a long period), the cluster should be scaled up to a storage optimized pricing tier or scaled out to more instances. Alternatively, adapt the cache policy (fewer days in cache)."
                  }
                },
                "secondaryContent": {
                  "columnMatch": "Timeline",
                  "formatter": 9,
                  "formatOptions": {
                    "min": 0,
                    "max": 100,
                    "palette": "blue"
                  },
                  "tooltipFormat": {
                    "tooltip": "An average cache utilization of 80% or less (over a long period) is a sustainable state for a cluster. If the average cache utilization is above 80% (over a long period), the cluster should be scaled up to a storage optimized pricing tier or scaled out to more instances. Alternatively, adapt the cache policy (fewer days in cache)."
                  }
                },
                "showBorder": false,
                "size": "full"
              },
              "gridSettings": {
                "rowLimit": 10000
              },
              "sortBy": []
            },
            "customWidth": "0",
            "showPin": false,
            "name": "Cache Utilization"
          },
          {
            "type": 10,
            "content": {
              "chartId": "workbook19356bdc-cfd5-47c7-8e70-05bbd3f39558",
              "version": "MetricsItem/2.0",
              "size": 3,
              "chartType": -1,
              "resourceType": "microsoft.kusto/clusters",
              "metricScope": 0,
              "resourceParameter": "Resource",
              "resourceIds": [
                "{Resource}"
              ],
              "timeContextFromParameter": "TimeRange",
              "timeContext": {
                "durationMs": 604800000
              },
              "metrics": [
                {
                  "namespace": "microsoft.kusto/clusters",
                  "metric": "microsoft.kusto/clusters-Ingestion health and performance-IngestionResult",
                  "aggregation": 7,
                  "columnName": "Succeeded Ingestions (#)"
                }
              ],
              "gridFormatType": 1,
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "Metric",
                  "formatter": 1,
                  "tooltipFormat": {
                    "tooltip": "Total number of ingestion operations that succeeded"
                  }
                },
                "subtitleContent": {
                  "columnMatch": "Value",
                  "formatter": 18,
                  "formatOptions": {
                    "thresholdsOptions": "icons",
                    "thresholdsGrid": [
                      {
                        "operator": ">=",
                        "thresholdValue": "0",
                        "representation": "Normal",
                        "text": ""
                      },
                      {
                        "operator": "Default",
                        "thresholdValue": null,
                        "representation": "Blank",
                        "text": ""
                      }
                    ]
                  },
                  "tooltipFormat": {
                    "tooltip": "Total number of ingestion operations that succeeded"
                  }
                },
                "leftContent": {
                  "columnMatch": "Value",
                  "formatter": 1,
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "useGrouping": false,
                      "maximumFractionDigits": 2
                    }
                  },
                  "tooltipFormat": {
                    "tooltip": "Total number of ingestion operations that succeeded"
                  }
                },
                "secondaryContent": {
                  "columnMatch": "Timeline",
                  "formatter": 9,
                  "formatOptions": {
                    "min": 0,
                    "max": 100,
                    "palette": "blue"
                  },
                  "tooltipFormat": {
                    "tooltip": "Total number of ingestion operations that succeeded"
                  }
                },
                "showBorder": false,
                "size": "full"
              },
              "filters": [
                {
                  "id": "2",
                  "key": "IngestionResultDetails",
                  "operator": 0,
                  "values": [
                    "Success"
                  ]
                }
              ],
              "gridSettings": {
                "rowLimit": 10000
              },
              "sortBy": []
            },
            "customWidth": "0",
            "showPin": false,
            "name": "succeeded ingestions"
          },
          {
            "type": 10,
            "content": {
              "chartId": "workbook19356bdc-cfd5-47c7-8e70-05bbd3f39558",
              "version": "MetricsItem/2.0",
              "size": 3,
              "chartType": -1,
              "resourceType": "microsoft.kusto/clusters",
              "metricScope": 0,
              "resourceParameter": "Resource",
              "resourceIds": [
                "{Resource}"
              ],
              "timeContextFromParameter": "TimeRange",
              "timeContext": {
                "durationMs": 604800000
              },
              "metrics": [
                {
                  "namespace": "microsoft.kusto/clusters",
                  "metric": "microsoft.kusto/clusters-Ingestion health and performance-IngestionResult",
                  "aggregation": 7,
                  "columnName": "Failed Ingestions (#)"
                }
              ],
              "gridFormatType": 1,
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "Metric",
                  "formatter": 1,
                  "tooltipFormat": {
                    "tooltip": "Total number of ingestion operations that failed (every ingestion operation that was not succeeded)"
                  }
                },
                "subtitleContent": {
                  "columnMatch": "Value",
                  "formatter": 18,
                  "formatOptions": {
                    "thresholdsOptions": "icons",
                    "thresholdsGrid": [
                      {
                        "operator": ">",
                        "thresholdValue": "0",
                        "representation": "2",
                        "text": ""
                      },
                      {
                        "operator": "Default",
                        "thresholdValue": null,
                        "representation": "Blank",
                        "text": ""
                      }
                    ]
                  },
                  "tooltipFormat": {
                    "tooltip": "Total number of ingestion operations that failed (every ingestion operation that was not succeeded)"
                  }
                },
                "leftContent": {
                  "columnMatch": "Value",
                  "formatter": 1,
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "useGrouping": false,
                      "maximumFractionDigits": 2
                    }
                  },
                  "tooltipFormat": {
                    "tooltip": "Total number of ingestion operations that failed (every ingestion operation that was not succeeded)"
                  }
                },
                "secondaryContent": {
                  "columnMatch": "Timeline",
                  "formatter": 9,
                  "formatOptions": {
                    "min": 0,
                    "max": 100,
                    "palette": "blue"
                  },
                  "tooltipFormat": {
                    "tooltip": "Total number of ingestion operations that failed (every ingestion operation that was not succeeded)"
                  }
                },
                "showBorder": false,
                "size": "full"
              },
              "filters": [
                {
                  "id": "1",
                  "key": "IngestionResultDetails",
                  "operator": 1,
                  "values": [
                    "Success"
                  ]
                }
              ],
              "gridSettings": {
                "rowLimit": 10000
              },
              "sortBy": []
            },
            "customWidth": "0",
            "showPin": false,
            "name": "succeeded ingestions - Copy"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "bb21d008-530e-48a4-bf2c-41f9b20e9986",
                  "version": "KqlParameterItem/1.0",
                  "name": "Help-Not Used",
                  "label": "Metrics help",
                  "type": 10,
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[{\"value\": \"Yes\", \"label\": \"Show\"},\r\n{\"value\": \"No\", \"label\": \"Hide\", \"selected\":\"True\"}]",
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "value": "Yes"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.kusto/clusters"
            },
            "customWidth": "20",
            "conditionalVisibility": {
              "parameterName": "1",
              "comparison": "isEqualTo",
              "value": "2"
            },
            "name": "Hhelp parameter"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"1.0.0\",\"content\":\"[{\\\"value\\\": \\\"Yes\\\", \\\"label\\\": \\\"ðŸ’¡ Metrics Help\\\"}]\",\"transformers\":null}",
              "size": 4,
              "exportFieldName": "value",
              "exportParameterName": "Help",
              "queryType": 8,
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "label",
                  "formatter": 1,
                  "formatOptions": {
                    "compositeBarSettings": {
                      "labelText": "",
                      "columnSettings": []
                    }
                  },
                  "tooltipFormat": {
                    "tooltip": "Click to show metrics help"
                  }
                },
                "showBorder": false
              }
            },
            "customWidth": "0",
            "name": "Help Icon",
            "styleSettings": {
              "margin": "-43px 0px 0px 0px"
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "##### Keep Alive\r\nTracks the responsiveness of the cluster. <br><br>\r\nA fully responsive cluster returns value 1 and a blocked or disconnected cluster returns 0.<br><br>\r\nAn average Keep Alive below 0.995 (over a long period) may indicate a health issue or may indicate that your cluster was suspended (Pay attention to your time range. This rule is important over a long period). <br><br>This tile shows up to 4 significant digits.\r\n"
                  },
                  "customWidth": "9",
                  "name": "Keep Alive Help",
                  "styleSettings": {
                    "margin": "0px 5px 5px 5px"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "##### CPU\r\nPercentage of allocated compute resources currently in use by machines in the cluster.<br><br>\r\nAn average CPU of 80% or less is sustainable for a cluster. The maximum value of CPU is 100%, which means there are no additional compute resources to process data.<br><br>\r\nWhen a cluster isn't performing well, check the usage tab to to determine if there are specific users or applications that are consuming high CPU. \r\n"
                  },
                  "customWidth": "9",
                  "name": "CPU Help",
                  "styleSettings": {
                    "margin": "0px 0px 0px 5px"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "##### Ingestion utilization\r\n\r\nPercentage of actual resources used to ingest data from the total resources allocated, in the capacity policy, to perform ingestion.<br><br>The default capacity policy is no more than 512 concurrent ingestion operations or 75% of the cluster resources invested in ingestion.<br><br>\r\nAverage ingestion utilization of 80% or less is a sustainable state for a cluster. Maximum value of ingestion utilization is 100%, which means all cluster ingestion ability is used and an ingestion queue may result."
                  },
                  "customWidth": "10",
                  "name": "Ingestion utilization Help ",
                  "styleSettings": {
                    "margin": "0px 5px 5px 20px"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "##### Ingestion Latency\r\n\r\nLatency of data ingested, from the time the data was received in the cluster until it's ready for query. <br><br>The ingestion latency period depends on the ingestion scenario. <br>As a general rule, an average Ingestion Latency above 15 minutes (over a long period) may indicate a problem"
                  },
                  "customWidth": "10",
                  "name": "Ingestion Latency Help",
                  "styleSettings": {
                    "margin": "0px 5px 5px 5px"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "##### Cache Utilization\r\n\r\nPercentage of allocated cache resources currently in use by the cluster. Cache is the size of SSD allocated for user activity according to the defined cache policy.\r\n\r\nAn average cache utilization of 80% or less is a sustainable state for a cluster. If the average cache utilization is above 80%, the cluster should be\r\n[scaled up](https://docs.microsoft.com/azure/data-explorer/manage-cluster-vertical-scaling) to a storage optimized pricing tier <br> or\r\n[scaled out](https://docs.microsoft.com/azure/data-explorer/manage-cluster-horizontal-scaling) to more instances. <br>It's recommended to use [optimized autoscale](https://docs.microsoft.com/azure/data-explorer/manage-cluster-horizontal-scaling#optimized-autoscale) configuration.<br><br>Alternatively, adapt the cache policy (fewer days in cache). <br> <br>If cache utilization is over 100%, the size of data to be cached, according to the caching policy, is larger that the total size of cache on the cluster."
                  },
                  "customWidth": "9",
                  "name": "Cache utilization Help "
                },
                {
                  "type": 1,
                  "content": {
                    "json": "##### Succeeded Ingestions\r\n\r\nTotal number of ingestion operations that succeeded.\r\n"
                  },
                  "customWidth": "9",
                  "name": "Succeeded Ingestions Help",
                  "styleSettings": {
                    "margin": "0px 0px 10px 0px"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "##### Failed Ingestions\r\n\r\nTotal number of ingestion operations that failed.<br><br>\r\nIf this tile is not visible, it means that no failed ingestions detected. <br><br>\r\nFor more information, you can check the ingestion metrics at the \"Key Metrics\" tab or use the [.show ingestion failures command](https://docs.microsoft.com/azure/data-explorer/kusto/management/ingestionfailures).<br>\r\nIngestion failures that occur during other parts of the ingestion flow will not appear in the result set of this command. Such a failure may occur, for example, before data ingestion control commands are sent to the Azure Data Explorer Data Engine service."
                  },
                  "customWidth": "9",
                  "name": "Failed Ingestions Help",
                  "styleSettings": {
                    "margin": "0px 0px 0px 10px"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "Help",
              "comparison": "isEqualTo",
              "value": "Yes"
            },
            "name": "Help Group"
          },
          {
            "type": 1,
            "content": {
              "json": " \r\n ---\r\n "
            },
            "customWidth": "100",
            "name": "Empty Space",
            "styleSettings": {
              "margin": "25px 0px -10px 0px"
            }
          },
          {
            "type": 1,
            "content": {
              "json": "<svg viewBox=\"0 0 18 18\" width=\"20\" class=\"fxt-escapeShadow\" role=\"presentation\" focusable=\"false\" xmlns:svg=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" aria-hidden=\"true\"><g><defs></defs><path d=\"M17.5 9.44a3.85 3.85 0 0 0-3.32-3.74A4.85 4.85 0 0 0 9.23 1a5 5 0 0 0-4.75 3.29 4.58 4.58 0 0 0-4 4.46 4.66 4.66 0 0 0 4.79 4.53 3 3 0 0 0 .42 0h7.75a.64.64 0 0 0 .2 0 3.9 3.9 0 0 0 3.86-3.84z\" fill=\"url(#9b4b971a-fb5a-4299-ab97-14581e9298eb)\"></path><path d=\"M14.53 15.14l-2 2.14a.26.26 0 0 1-.44-.14l-1.21-5.9A.26.26 0 0 1 11 11l1.32-.54a.26.26 0 0 1 .33.13l1.95 4.3a.24.24 0 0 1-.07.25z\" fill=\"#37c2b1\"></path><path d=\"M8 15.14l2 2.14a.26.26 0 0 0 .44-.14l1.21-5.9a.26.26 0 0 0-.15-.28l-1.32-.54a.26.26 0 0 0-.33.13l-1.95 4.3a.24.24 0 0 0 .1.29z\" fill=\"#42e8ca\"></path><path d=\"M11.58 6l.26-.22a.41.41 0 0 1 .57.05.37.37 0 0 1 .07.12l.12.32a.42.42 0 0 0 .45.26l.33-.06a.41.41 0 0 1 .47.33.33.33 0 0 1 0 .14l-.06.33a.42.42 0 0 0 .26.45l.32.11a.42.42 0 0 1 .24.53.75.75 0 0 1-.07.12l-.22.25a.42.42 0 0 0 0 .52l.22.26a.4.4 0 0 1-.06.57.41.41 0 0 1-.11.07l-.32.12a.4.4 0 0 0-.26.45l.06.33a.39.39 0 0 1-.33.46.33.33 0 0 1-.14 0h-.33a.4.4 0 0 0-.45.26l-.12.31a.4.4 0 0 1-.52.24.37.37 0 0 1-.12-.07l-.25-.25a.4.4 0 0 0-.52 0l-.26.21a.4.4 0 0 1-.57-.05.24.24 0 0 1-.07-.12l-.12-.31a.39.39 0 0 0-.45-.26l-.33.06a.41.41 0 0 1-.47-.34.29.29 0 0 1 0-.13l.06-.33a.4.4 0 0 0-.26-.45l-.31-.12a.42.42 0 0 1-.29-.5.75.75 0 0 1 .07-.12l.22-.26a.42.42 0 0 0 0-.52l-.22-.25a.41.41 0 0 1 .06-.58.23.23 0 0 1 .12-.06l.31-.12a.42.42 0 0 0 .26-.45L8.8 7a.41.41 0 0 1 .33-.47h.14l.33.06a.41.41 0 0 0 .45-.26l.12-.33a.41.41 0 0 1 .52-.24l.12.07.26.22a.41.41 0 0 0 .51-.05z\" fill=\"#005ba1\"></path><circle cx=\"11.33\" cy=\"9.02\" r=\"2.36\" fill=\"#ffca00\"></circle></g></svg> &nbsp;<span style=\"font-family: Open Sans; font-weight: 620; font-size: 14px;font-style: bold;margin:-10px -304px 0px 0px;position: relative;top:-5px\">Advisor Recommendations (Not affected by the Time Range)\r\n</span> \r\n"
            },
            "customWidth": "45",
            "name": "text - 15",
            "styleSettings": {
              "margin": "25px 0px -10px 0px"
            }
          },
          {
            "type": 1,
            "content": {
              "json": "<svg viewBox=\"0 0 16 16\" width=\"20\" class=\"fxt-escapeShadow\" role=\"presentation\" focusable=\"false\" xmlns:svg=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" aria-hidden=\"true\"><g><path d=\"M2.78 8.15h-.31l5.72 5.47 4.49-4.69h1.41L8.22 15 1.31 8.44a3.78 3.78 0 0 1-.49-.57 3.64 3.64 0 0 1-.38-.66h1.89l2.17-2.3 3.57 3.42 2.45-2.55L11.75 7l2.78-.06a3.41 3.41 0 0 0 .36-.94 3.11 3.11 0 0 0 .11-.87 3.06 3.06 0 0 0-.28-1.26 3.32 3.32 0 0 0-.72-1A3.27 3.27 0 0 0 11.68 2a3.24 3.24 0 0 0-1.16.23 4.12 4.12 0 0 0-.92.56 7.39 7.39 0 0 0-.81.78c-.26.29-.52.59-.8.89q-.43-.46-.84-.85a8.31 8.31 0 0 0-.85-.75 3.81 3.81 0 0 0-1-.54 2.86 2.86 0 0 0-1.16-.2 3.31 3.31 0 0 0-1.25.28 3.37 3.37 0 0 0-1 .72 3.2 3.2 0 0 0-.67 1A3.14 3.14 0 0 0 1 5.43a3.4 3.4 0 0 0 .11.76h-1A2.38 2.38 0 0 1 0 5.84v-.38a4.25 4.25 0 0 1 1.18-3 4.19 4.19 0 0 1 3-1.31 3.82 3.82 0 0 1 1.16.13 4.19 4.19 0 0 1 .95.38 6 6 0 0 1 .84.61c.27.24.55.51.84.79.28-.3.55-.57.81-.82a5.37 5.37 0 0 1 .81-.65 4.23 4.23 0 0 1 .94-.43A4 4 0 0 1 11.66 1a4.07 4.07 0 0 1 1.66.29 4.14 4.14 0 0 1 1.36.88 4.34 4.34 0 0 1 .94 1.32 4.32 4.32 0 0 1 .38 1.6 4.18 4.18 0 0 1-.24 1.48A4.12 4.12 0 0 1 15 7.88L11.35 8l-.8-.78L8.1 9.75 4.53 6.32z\"></path></g></svg>&nbsp;<span style=\"font-family: Open Sans; font-weight: 620; font-size: 14px;font-style: bold;margin:-10px -304px 0px 0px;position: relative;top:-5px\">Resourch Health (Not affected by the Time Range)\r\n</span> "
            },
            "customWidth": "55",
            "name": "Health Icon",
            "styleSettings": {
              "margin": "25px 0px -10px 0px"
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Resource:subscription}/providers/Microsoft.Advisor/recommendations\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2017-04-19\"},{\"key\":\"$filter\",\"value\":\"ResourceId eq {Resource:value}\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value[*]\",\"columns\":[{\"path\":\"$.properties.shortDescription.solution\",\"columnid\":\"Description\"},{\"path\":\"$.properties.category\",\"columnid\":\"Category\"},{\"path\":\"$.properties.lastUpdated\",\"columnid\":\"LastUpdated\"}]}}]}",
              "size": 3,
              "noDataMessage": "ðŸŽ‰ You are following all of the Advisor recommendations for this cluster",
              "noDataMessageStyle": 3,
              "queryType": 12,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Description",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "75%"
                    }
                  },
                  {
                    "columnMatch": "LastUpdated",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "25%"
                    }
                  }
                ]
              },
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "Description"
                },
                "subtitleContent": {
                  "columnMatch": "LastUpdated",
                  "formatter": 1
                },
                "showBorder": true,
                "size": "auto"
              }
            },
            "customWidth": "45",
            "name": "Advisor Recommendations"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"AzureHealthQuery/1.0\",\"queryType\":\"Detailed\"}",
              "size": 3,
              "queryType": 4,
              "resourceType": "microsoft.kusto/clusters",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Name",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Availability state",
                    "formatter": 11,
                    "formatOptions": {
                      "customColumnWidthSetting": "8%"
                    }
                  },
                  {
                    "columnMatch": "Detailed status",
                    "formatter": 5,
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false
                      },
                      "emptyValCustomText": "-"
                    }
                  },
                  {
                    "columnMatch": "Occurred time",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "12%"
                    }
                  },
                  {
                    "columnMatch": "Reason chronicity",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "10%"
                    }
                  },
                  {
                    "columnMatch": "Reason type",
                    "formatter": 5,
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false
                      },
                      "emptyValCustomText": "-"
                    }
                  },
                  {
                    "columnMatch": "Reported time",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "12%"
                    }
                  },
                  {
                    "columnMatch": "Summary",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "58%"
                    }
                  },
                  {
                    "columnMatch": "Title",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Resource group",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Subscription",
                    "formatter": 5
                  }
                ]
              }
            },
            "customWidth": "55",
            "name": "Resource Health"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "paragraph",
              "links": [
                {
                  "id": "947cc63d-d9ae-483c-88cd-1205e4b5337d",
                  "cellValue": "{Resource}",
                  "linkTarget": "Resource",
                  "linkLabel": "Advisor Recommendations page >",
                  "subTarget": "resourceadvisor",
                  "preText": "",
                  "style": "link"
                }
              ]
            },
            "customWidth": "45",
            "name": "Advisor Link"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "paragraph",
              "links": [
                {
                  "id": "257a330a-6096-45a2-8897-45ac1eb40836",
                  "cellValue": "{Resource}",
                  "linkTarget": "Resource",
                  "linkLabel": "Resource Health page >",
                  "subTarget": "resourcehealth",
                  "style": "link"
                }
              ]
            },
            "customWidth": "0",
            "name": "Health Link"
          },
          {
            "type": 1,
            "content": {
              "json": " \r\n ---\r\n "
            },
            "customWidth": "100",
            "name": "Empty Space 2",
            "styleSettings": {
              "margin": "25px 0px -10px 0px"
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "f27feb91-b0a0-461d-88be-2ee75b5a2f14",
                        "version": "KqlParameterItem/1.0",
                        "name": "include_system_operations",
                        "label": "System Operations",
                        "type": 2,
                        "description": "System Operations (Data Management) are used for ingestion and other cluster management aspects",
                        "isRequired": true,
                        "typeSettings": {
                          "additionalResourceOptions": [],
                          "showDefault": false
                        },
                        "jsonData": "[\r\n{ \"value\": \"false\", \"label\": \"false always - Do Not Include Data Management Operations\", \"selected\": \"true\" }, \r\n{ \"value\": \"false\", \"label\": \"false always -Include Data Management Operations\", \"selected\": \"false\" }\r\n]",
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      }
                    ],
                    "style": "above",
                    "queryType": 0,
                    "resourceType": "microsoft.kusto/clusters"
                  },
                  "customWidth": "100",
                  "conditionalVisibility": {
                    "parameterName": "1",
                    "comparison": "isEqualTo",
                    "value": "2"
                  },
                  "name": "parameters - 6"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "letÂ system_databasesÂ =Â dynamic(['KustoMonitoringPersistentDatabase',Â '$systemdb']);Â \r\nletÂ system_usersÂ =Â dynamic(['AAD app id=b753584e-c468-4503-852a-374280ce7a62',Â 'KustoServiceBuiltInPrincipal']);Â //Â b753584e-c468-4503-852a-374280ce7a62Â isÂ KustoRunner\r\nletÂ system_cluster_management_applicationsÂ =Â dynamic(['Kusto.WinSvc.CM.Svc']);Â //Â KustoÂ ClusterÂ Management\r\nletÂ CommandTableÂ =Â ADXCommandÂ \r\n|Â whereÂ TimeGeneratedÂ >Â datetime(2020-09-09T09:30:00Z)Â \r\n|Â whereÂ LastUpdatedOnÂ {TimeRange}\r\n|Â whereÂ DatabaseNameÂ Â !inÂ (system_databases)Â andÂ UserÂ !inÂ (system_users)Â andÂ ApplicationNameÂ !inÂ (system_cluster_management_applications)\r\n|Â whereÂ (({include_system_operations}Â ==Â \"false\"Â andÂ ApplicationNameÂ !=Â 'Kusto.WinSvc.DM.Svc')Â orÂ {include_system_operations}Â ==Â \"true\")\r\n|Â extendÂ MemoryPeakÂ =Â tolong(ResourceUtilization.MemoryPeak)Â \r\n|Â parseÂ _ResourceIdÂ withÂ *Â \"providers/microsoft.kusto/clusters/\"Â cluster_name\r\n|Â project-awayÂ ResourceUtilization;\r\nletÂ QueryTableÂ =Â ADXQuery\r\n|Â whereÂ LastUpdatedOnÂ {TimeRange}\r\n|Â whereÂ DatabaseNameÂ Â !inÂ (system_databases)Â andÂ UserÂ !inÂ (system_users)Â andÂ ApplicationNameÂ !inÂ (system_cluster_management_applications)\r\n|Â whereÂ (({include_system_operations}Â ==Â \"false\"Â andÂ ApplicationNameÂ !=Â 'Kusto.WinSvc.DM.Svc')Â orÂ {include_system_operations}Â ==Â \"true\")\r\n|Â extendÂ MemoryPeakÂ =Â tolong(MemoryPeak)\r\n|Â parseÂ _ResourceIdÂ withÂ *Â \"providers/microsoft.kusto/clusters/\"Â cluster_name\r\n|Â extendÂ CommandTypeÂ =Â 'Query';\r\nletÂ dataset_commands_queriesÂ =Â CommandTableÂ |Â unionÂ (QueryTable)\r\n|Â projectÂ CommandType,Â DatabaseName,Â StartedOn,Â LastUpdatedOn,Â Duration,Â State,Â FailureReason,Â RootActivityId,Â User,Â ApplicationName,Â Principal,Â TotalCPU,Â MemoryPeak,Â CorrelationId,Â cluster_name;\r\nletÂ datasetÂ =Â dataset_commands_queries\r\nÂ Â Â Â |Â whereÂ cluster_nameÂ ==Â '{Resource:name}'\r\nÂ Â Â Â //|Â whereÂ totimespan(TotalCPU)Â >Â totimespan(0)\r\nÂ Â Â Â |Â summarizeÂ TotalCPU=max(TotalCPU)Â \r\nÂ Â ,Â MemoryPeak=max(MemoryPeak)Â byÂ User,Â ApplicationName,Â CorrelationIdÂ \r\n;\r\nletÂ totalCPUÂ =Â toscalar(datasetÂ |Â summarizeÂ sum((totimespan(TotalCPU)/1s)));\r\nletÂ totalMemoryÂ =Â toscalar(datasetÂ |Â summarizeÂ sum(MemoryPeak));\r\nletÂ topMemoryÂ =Â \r\nÂ Â Â Â dataset\r\nÂ Â Â Â |Â top-nestedÂ 10000Â ofÂ UserÂ withÂ others=\"Others\"Â byÂ sum(MemoryPeak),Â top-nestedÂ 10000Â ofÂ ApplicationNameÂ withÂ others=\"Others\"Â byÂ sum(MemoryPeak)\r\nÂ Â Â Â |Â extendÂ PercentOfTotalClusterMemoryUsedÂ =Â aggregated_ApplicationName/toreal(totalMemory)\r\n;\r\nletÂ topCpuÂ =Â \r\nÂ Â Â Â dataset\r\nÂ Â Â Â |Â top-nestedÂ 10000Â ofÂ UserÂ withÂ others=\"Others\"Â byÂ sum(totimespan(TotalCPU)/1s),Â top-nestedÂ 10000Â ofÂ ApplicationNameÂ withÂ others=\"Others\"Â byÂ sum(totimespan(TotalCPU)/1s)\r\nÂ Â Â Â |Â extendÂ PercentOfTotalClusterCpuUsedÂ =Â aggregated_ApplicationName/toreal(totalCPU)\r\n;\r\ntopMemory\r\n|Â joinÂ kindÂ =Â fullouter(topCpu)Â onÂ User,Â ApplicationName\r\n|Â extendÂ BothPercentagesÂ =Â PercentOfTotalClusterMemoryUsed+PercentOfTotalClusterCpuUsed\r\n|Â topÂ 10Â byÂ BothPercentagesÂ desc\r\n|Â extendÂ UserÂ =Â case(ApplicationName==\"Kusto.WinSvc.DM.Svc\",Â strcat(\"KustoÂ DataÂ ManagementÂ \",\"(\",User,\")\"),\r\nApplicationName==\"KustoQueryRunner\",Â strcat(\"KustoÂ QueryÂ RunnerÂ \",\"(\",User,\")\"),\r\nUser==\"AADÂ appÂ id=e0331ea9-83fc-4409-a17d-6375364c3280\",Â \"DataMapÂ AgentÂ 001Â (appÂ id:Â e0331ea9-83fc-4409-a17d-6375364c3280)\",Â //Â UsedÂ forÂ internalÂ MSÂ clustersÂ \r\nUser)\r\n| extend PercentOfTotalClusterMemoryUsed_display = iff(isnan(PercentOfTotalClusterMemoryUsedÂ *Â 100), toreal(0), PercentOfTotalClusterMemoryUsedÂ *Â 100)\r\n| extend PercentOfTotalClusterCpuUsed_display = iff(isnan(PercentOfTotalClusterCpuUsedÂ *Â 100), toreal(0), PercentOfTotalClusterCpuUsedÂ *Â 100)\r\n| whereÂ notÂ (ApplicationNameÂ ==Â \"Others\"Â andÂ Â PercentOfTotalClusterMemoryUsed_displayÂ Â ==Â 0Â andÂ PercentOfTotalClusterCpuUsed_displayÂ ==Â 0)\r\n| projectÂ User,Â ApplicationName,Â PercentOfTotalClusterMemoryUsed_displayÂ ,Â PercentOfTotalClusterCpuUsed_display",
                    "size": 3,
                    "title": "ðŸ‘¤ Top Resource Consumers",
                    "timeContext": {
                      "durationMs": 604800000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.kusto/clusters",
                    "crossComponentResources": [
                      "{Resource}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "User",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "40%"
                          }
                        },
                        {
                          "columnMatch": "ApplicationName",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "25%"
                          }
                        },
                        {
                          "columnMatch": "PercentOfTotalClusterMemoryUsed_display",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue",
                            "customColumnWidthSetting": "20%"
                          },
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          },
                          "tooltipFormat": {
                            "tooltip": "Percent Of Total Cluster Memory Used"
                          }
                        },
                        {
                          "columnMatch": "PercentOfTotalClusterCpuUsed_display",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue",
                            "customColumnWidthSetting": "15%"
                          },
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          },
                          "tooltipFormat": {
                            "tooltip": "Percent Of Total Cluster CPU Used"
                          }
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "User",
                          "label": "Principal"
                        },
                        {
                          "columnId": "ApplicationName",
                          "label": "Application"
                        },
                        {
                          "columnId": "PercentOfTotalClusterMemoryUsed_display",
                          "label": "% of Used Cluster Memory",
                          "comment": "Relative portion of the actual cluster memory consumption"
                        },
                        {
                          "columnId": "PercentOfTotalClusterCpuUsed_display",
                          "label": "% of Used Cluster CPU",
                          "comment": "Relative portion of the actual CPU consumption"
                        }
                      ]
                    },
                    "tileSettings": {
                      "showBorder": false,
                      "titleContent": {
                        "columnMatch": "User",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "Column1",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    },
                    "graphSettings": {
                      "type": 0,
                      "topContent": {
                        "columnMatch": "User",
                        "formatter": 1
                      },
                      "centerContent": {
                        "columnMatch": "Column1",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    },
                    "chartSettings": {
                      "showLegend": true,
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 1,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true
                          }
                        }
                      }
                    }
                  },
                  "customWidth": "60",
                  "conditionalVisibility": {
                    "parameterName": "Usage",
                    "comparison": "isEqualTo",
                    "value": "present"
                  },
                  "name": "Top Resource Consumers - Overview",
                  "styleSettings": {
                    "margin": "20px 20px 0px 0px"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "letÂ system_databasesÂ =Â dynamic(['KustoMonitoringPersistentDatabase',Â '$systemdb']);Â \r\nletÂ system_usersÂ =Â dynamic(['AAD app id=b753584e-c468-4503-852a-374280ce7a62',Â 'KustoServiceBuiltInPrincipal']);Â //Â b753584e-c468-4503-852a-374280ce7a62Â isÂ Kusto Query Runner\r\nletÂ system_cluster_management_applicationsÂ =Â dynamic(['Kusto.WinSvc.CM.Svc']);Â //Â KustoÂ ClusterÂ Management\r\nlet CommandTable = ADXCommand | extend MemoryPeak = tolong(ResourceUtilization.MemoryPeak) \r\n|Â whereÂ DatabaseNameÂ Â !inÂ (system_databases)Â andÂ UserÂ !inÂ (system_users)Â andÂ ApplicationNameÂ !inÂ (system_cluster_management_applications)\r\n|Â whereÂ ApplicationNameÂ !=Â 'Kusto.WinSvc.DM.Svc'\r\n| parse _ResourceId with * \"providers/microsoft.kusto/clusters/\" cluster_name\r\n| project-away ResourceUtilization;\r\nlet QueryTable = ADXQuery\r\n|Â whereÂ DatabaseNameÂ Â !inÂ (system_databases)Â andÂ UserÂ !inÂ (system_users)Â andÂ ApplicationNameÂ !inÂ (system_cluster_management_applications)\r\n|Â whereÂ ApplicationNameÂ !=Â 'Kusto.WinSvc.DM.Svc'\r\n| extend MemoryPeak = tolong(MemoryPeak)\r\n| parse _ResourceId with * \"providers/microsoft.kusto/clusters/\" cluster_name\r\n| extend CommandType = 'Query';\r\nlet dataset_commands_queries = CommandTable | union (QueryTable)\r\n| project CommandType, DatabaseName, StartedOn, LastUpdatedOn, Duration, State,\r\nFailureReason, RootActivityId, User,\r\nApplicationName,\r\nPrincipal,\r\nTotalCPU,\r\nMemoryPeak,\r\nCorrelationId,\r\ncluster_name;\r\nlet raw = dataset_commands_queries\r\n    | where LastUpdatedOn {TimeRange}\r\n    | where cluster_name == '{Resource:name}'\r\n    | where StartedOn > ago(365d)\r\n;\r\nraw\r\n| evaluate activity_engagement(User, StartedOn, 1d, 7d)\r\n| join kind = inner (\r\n    raw\r\n    | evaluate activity_engagement(User, StartedOn, 1d, 30d)\r\n    ) on StartedOn\r\n| project StartedOn, Daily=dcount_activities_inner, Weekly=dcount_activities_outer, Monthly = dcount_activities_outer1     \r\n| where StartedOn > ago(90d)\r\n| project Daily,StartedOn,Weekly,Monthly | sort by StartedOn asc\r\n",
                    "size": 0,
                    "aggregation": 3,
                    "title": "ðŸ‘¥ Unique User Count  (Over a sliding timeline window. Not affected by the Time Range)",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.kusto/clusters",
                    "crossComponentResources": [
                      "{Resource}"
                    ],
                    "visualization": "timechart",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Column1",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          },
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal"
                            }
                          },
                          "tooltipFormat": {
                            "tooltip": "Percent Of Total Cluster Memory Used"
                          }
                        },
                        {
                          "columnMatch": "Column2",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          },
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal"
                            }
                          },
                          "tooltipFormat": {
                            "tooltip": "Percent Of Total Cluster CPU Used"
                          }
                        }
                      ]
                    },
                    "tileSettings": {
                      "showBorder": false,
                      "titleContent": {
                        "columnMatch": "User",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "Column1",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    },
                    "graphSettings": {
                      "type": 0,
                      "topContent": {
                        "columnMatch": "User",
                        "formatter": 1
                      },
                      "centerContent": {
                        "columnMatch": "Column1",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    },
                    "chartSettings": {
                      "showLegend": true,
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 0,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true
                          }
                        }
                      }
                    }
                  },
                  "customWidth": "40",
                  "conditionalVisibility": {
                    "parameterName": "Usage",
                    "comparison": "isEqualTo",
                    "value": "present"
                  },
                  "name": "query usage",
                  "styleSettings": {
                    "margin": "20px 0px 0px 0px"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "###### Heaviest Resource Consumers "
                  },
                  "customWidth": "45",
                  "conditionalVisibility": {
                    "parameterName": "Usage",
                    "comparison": "isEqualTo",
                    "value": "not present"
                  },
                  "name": "Heaviest User Count Header"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "###### Unique User Count"
                  },
                  "customWidth": "40",
                  "conditionalVisibility": {
                    "parameterName": "Usage",
                    "comparison": "isEqualTo",
                    "value": "not present"
                  },
                  "name": "Unique User Count"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "<svg width=\"400\" viewBox=\"0 0 482 271\" class=\"ext-vm-onboarding-sample-image-svg\" role=\"presentation\" focusable=\"false\" xmlns:svg=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" aria-hidden=\"true\"><g><path fill=\"#ABABAB\" d=\"M399 249H93a1 1 0 1 1 0-2h306a1 1 0 1 1 0 2z\"></path><path d=\"M301.333 220.333h-47.526c-2.649 0-6.171-.622-6.171-6V88.5a1 1 0 1 1 2 0v125.833c0 2.953 1.091 4 4.171 4h47.526a1 1 0 1 1 0 2zm-73.17 0h-47.526a1 1 0 1 1 0-2h47.526c3.08 0 4.171-1.047 4.171-4V88.5a1 1 0 1 1 2 0v125.833c-.001 5.378-3.522 6-6.171 6z\" class=\"msportalfx-svg-c04\"></path><path d=\"M276.777 186.134H350v62.023h-73.223z\" class=\"msportalfx-svg-c01\"></path><path d=\"M350 249.156h-73.224a1 1 0 0 1-1-1v-62.022a1 1 0 0 1 1-1H350a1 1 0 0 1 1 1v62.022a1 1 0 0 1-1 1zm-72.224-2H349v-60.022h-71.224v60.022z\" class=\"msportalfx-svg-c04\"></path><path d=\"M128.777 186.134H202v62.023h-73.223z\" class=\"msportalfx-svg-c01\"></path><path d=\"M202 249.156h-73.224a1 1 0 0 1-1-1v-62.022a1 1 0 0 1 1-1H202a1 1 0 0 1 1 1v62.022a1 1 0 0 1-1 1zm-72.224-2H201v-60.022h-71.224v60.022z\" class=\"msportalfx-svg-c04\"></path><path d=\"M180.941 214.203l-10.817 12.98-17.547-28.124L142 216.366V238h47.594z\" class=\"msportalfx-svg-c15\"></path><path d=\"M188.685 238.513l-7.762-21.345-10.474 12.567-17.359-27.821-9.31 15.234-2.56-1.564 11.843-19.379 17.736 28.425 11.16-13.392 9.545 26.249z\" class=\"msportalfx-svg-c19\"></path><path fill=\"#ABABAB\" d=\"M409 249h-3a1 1 0 1 1 0-2h3a1 1 0 1 1 0 2z\"></path><path d=\"M322.667 113l4 4-4 4-4-4zm0 10a6 6 0 0 0-6-6m12 0a6 6 0 0 0-6 6m-6-6a6 6 0 0 0 6-6m0 0a6 6 0 0 0 6 6m.333 0h3m-18 0h3m6 6v3m0-15v-3\" fill=\"none\" stroke=\"#A0A1A2\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path><g stroke=\"#59B4D9\"><path stroke-miterlimit=\"10\" d=\"M159.667 98l2 2-2 2-2-2z\" class=\"msportalfx-svg-c01\"></path><path fill=\"none\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M159.667 103a3 3 0 0 0-3-3m6 0a3 3 0 0 0-3 3m-3-3a3 3 0 0 0 3-3M155 100h2m6 0h2m-5 3v2m0-10v2m-.333 0a3 3 0 0 0 3 3\"></path></g><path d=\"M201.667 27l2 2-2 2-2-2zm0 5a3 3 0 0 0-3-3m6 0a3 3 0 0 0-3 3m-3-3a3 3 0 0 0 3-3M197 29h2m6 0h2m-5 3v2m0-10v2m-.333 0a3 3 0 0 0 3 3m129 23l2 2-2 2-2-2zm0 5a3 3 0 0 0-3-3m6 0a3 3 0 0 0-3 3m-3-3a3 3 0 0 0 3-3M329 54h2m6 0h2m-5 3v2m0-10v2m-.333 0a3 3 0 0 0 3 3\" fill=\"none\" stroke=\"#A0A1A2\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path><circle cx=\"150.667\" cy=\"128\" r=\"2\" class=\"msportalfx-svg-c03\"></circle><circle cx=\"264.667\" cy=\"136\" r=\"2\" class=\"msportalfx-svg-c03\"></circle><circle cx=\"257.667\" cy=\"19\" r=\"2\" class=\"msportalfx-svg-c03\"></circle><circle cx=\"153.667\" cy=\"35\" r=\"2\" class=\"msportalfx-svg-c03\"></circle><path d=\"M324.667 73a2 2 0 1 0 .001-3.999 2 2 0 0 0-.001 3.999zm-117 72a2 2 0 1 0 .001-3.999 2 2 0 0 0-.001 3.999z\" class=\"msportalfx-svg-c15\"></path><g stroke=\"#59B4D9\"><path stroke-miterlimit=\"10\" d=\"M152.667 60.429L157.238 65l-4.571 4.571L148.095 65z\" class=\"msportalfx-svg-c01\"></path><path fill=\"none\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M152.667 71.857A6.857 6.857 0 0 0 145.81 65m13.714 0a6.857 6.857 0 0 0-6.857 6.857M145.81 65a6.857 6.857 0 0 0 6.857-6.857m0 0A6.857 6.857 0 0 0 159.524 65m.476 0h1m-16 0h1m7 7v1m0-15v-1\"></path></g><g stroke=\"#59B4D9\"><path stroke-miterlimit=\"10\" d=\"M307.667 29l2 2-2 2-2-2z\" class=\"msportalfx-svg-c01\"></path><path fill=\"none\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M307.667 34a3 3 0 0 0-3-3m6 0a3 3 0 0 0-3 3m-3-3a3 3 0 0 0 3-3M303 31h2m6 0h2m-5 3v2m0-10v2m-.333 0a3 3 0 0 0 3 3\"></path></g><path d=\"M311.597 102.771c0-8.961-7.194-16.222-16.078-16.222-.669 0-1.329.051-1.963.138a43.97 43.97 0 0 0 1.524-11.436C295.077 51.363 275.877 32 252.195 32c-18.921 0-34.965 12.355-40.66 29.509a28.744 28.744 0 0 0-9.573-1.652c-16.203 0-29.314 13.239-29.314 29.567 0 16.338 13.111 29.576 29.311 29.576 0 0 .029-.013.042-.013V119h94.821l-.016-.08c8.272-.653 14.791-7.623 14.791-16.149\" class=\"msportalfx-svg-c01\"></path><path d=\"M228.837 38.985c-.588.386-1.168.783-1.735 1.197v5.429h1.735v-6.626zm15.805-3.021c2.155 0 3.626-1.343 4.26-3.834a42.1 42.1 0 0 0-1.826.178c-.42 1.439-1.19 2.269-2.332 2.269-.844 0-1.53-.532-2.001-1.513-.555.126-1.106.263-1.653.41.765 1.622 2.008 2.49 3.552 2.49zm49.184 33.227c.285 0 .555-.031.816-.077a42.162 42.162 0 0 0-.223-1.387 2.056 2.056 0 0 1-.491.075c-1.633 0-2.695-1.959-2.695-5.41 0-1.556.222-2.777.589-3.687a44.243 44.243 0 0 0-.8-1.822c-.99 1.161-1.585 3.015-1.585 5.49.04 4.389 1.796 6.818 4.389 6.818zm16.618 38.788c-1.633 0-2.695-1.959-2.695-5.41 0-3.613 1.143-5.533 2.715-5.533.03 0 .054.012.084.013a16.386 16.386 0 0 0-.578-1.354c-2.376.341-4.018 2.74-4.018 6.855.04 4.305 1.732 6.719 4.244 6.81.205-.465.389-.94.551-1.426-.101.013-.195.045-.303.045zM249.522 119v-2.246h-1.531l-2.899 1.551.176.695h1.417l1.061-.572h.041V119zm47.408-6.904h-1.531l-2.899 1.553.347 1.367 2.307-1.245h.041V119h1.627l-.016-.08c.042-.003.082-.012.124-.016v-6.808zm-79.597.647c-2.561 0-4.418 2.217-4.597 6.257h1.806c.136-3.171 1.218-4.869 2.688-4.869 1.75 0 2.585 1.917 2.676 4.869h1.804c-.112-3.943-1.684-6.257-4.377-6.257zm-22.241 3.562l.347 1.368 2.307-1.245h.041v2.269a29.97 29.97 0 0 0 1.735.194v-4.137h-1.531l-2.899 1.551zm10.296-49.701h-.041l-2.307 1.245-.347-1.368 2.899-1.551h1.531V78.2h-1.735V66.604zm-24 30h-.041l-2.307 1.245-.347-1.368 2.899-1.551h1.531v13.27h-1.735V96.604zm5.074-30.312h-.041l-2.307 1.245-.347-1.367 2.899-1.553h1.531v13.271h-1.735V66.292zm89.337-15.693h-.041l-2.307 1.245-.347-1.367 2.899-1.552h1.531v13.271h-1.735V50.599zm-18.544-7.286h-.041l-2.307 1.245-.347-1.367 2.899-1.553h1.531V54.91h-1.735V43.313zm-16.276 38.636h-.041l-2.307 1.246-.347-1.368 2.899-1.552h1.531v13.271h-1.735V81.949zm16-12h-.041l-2.307 1.246-.347-1.368 2.899-1.552h1.531v13.271h-1.735V69.949zm-26.192 32.479h-.041l-2.307 1.245-.347-1.368 2.899-1.551h1.531v13.27h-1.735v-11.596zm28.936.032c0 4.513-1.674 7.003-4.614 7.003-2.593 0-4.349-2.43-4.39-6.818 0-4.451 1.919-6.901 4.614-6.901 2.797-.001 4.39 2.49 4.39 6.716zm-7.207.204c0 3.451 1.062 5.41 2.695 5.41 1.837 0 2.715-2.144 2.715-5.532 0-3.267-.837-5.411-2.695-5.411-1.572 0-2.715 1.92-2.715 5.533zm27.74 2.297c0 4.512-1.674 7.003-4.614 7.003-2.593 0-4.349-2.43-4.39-6.819 0-4.451 1.919-6.9 4.614-6.9 2.798-.001 4.39 2.489 4.39 6.716zm-7.207.204c0 3.45 1.062 5.411 2.695 5.411 1.837 0 2.715-2.145 2.715-5.533 0-3.267-.837-5.41-2.695-5.41-1.572 0-2.715 1.919-2.715 5.532zm-63.864-6.468c0 4.512-1.674 7.003-4.614 7.003-2.593 0-4.349-2.43-4.39-6.819 0-4.451 1.919-6.9 4.614-6.9 2.797-.001 4.39 2.49 4.39 6.716zm-7.207.204c0 3.45 1.062 5.411 2.695 5.411 1.837 0 2.715-2.145 2.715-5.533 0-3.267-.837-5.41-2.695-5.41-1.572 0-2.715 1.919-2.715 5.532zm78.338-21.172c0 4.512-1.674 7.002-4.614 7.002-2.593 0-4.349-2.43-4.39-6.818 0-4.451 1.919-6.9 4.614-6.9 2.798-.001 4.39 2.489 4.39 6.716zm-7.207.203c0 3.451 1.062 5.411 2.695 5.411 1.837 0 2.715-2.144 2.715-5.533 0-3.267-.837-5.41-2.695-5.41-1.572-.001-2.715 1.918-2.715 5.532zm23.848 14.432c0 4.513-1.674 7.003-4.614 7.003-2.593 0-4.349-2.43-4.39-6.818 0-4.451 1.919-6.901 4.614-6.901 2.797-.001 4.39 2.491 4.39 6.716zm-7.207.204c0 3.451 1.062 5.41 2.695 5.41 1.837 0 2.715-2.144 2.715-5.532 0-3.267-.837-5.411-2.695-5.411-1.572 0-2.715 1.92-2.715 5.533zm-60.061-7.927c0 4.512-1.674 7.002-4.614 7.002-2.593 0-4.349-2.43-4.39-6.818 0-4.451 1.919-6.9 4.614-6.9 2.798-.001 4.39 2.489 4.39 6.716zm-7.207.203c0 3.451 1.062 5.411 2.695 5.411 1.837 0 2.715-2.144 2.715-5.533 0-3.267-.837-5.41-2.695-5.41-1.572 0-2.715 1.918-2.715 5.532zm-26.441 5.81c0 4.512-1.674 7.002-4.614 7.002-2.593 0-4.349-2.43-4.39-6.818 0-4.451 1.919-6.9 4.614-6.9 2.797 0 4.39 2.49 4.39 6.716zm-7.208.203c0 3.451 1.062 5.411 2.695 5.411 1.837 0 2.715-2.144 2.715-5.533 0-3.267-.837-5.41-2.695-5.41-1.571 0-2.715 1.919-2.715 5.532zm39.883-27.255c0 4.512-1.674 7.002-4.614 7.002-2.593 0-4.349-2.43-4.39-6.818 0-4.451 1.919-6.9 4.614-6.9 2.797-.001 4.39 2.489 4.39 6.716zm-7.207.203c0 3.451 1.062 5.411 2.695 5.411 1.837 0 2.715-2.144 2.715-5.533 0-3.267-.837-5.41-2.695-5.41-1.572-.001-2.715 1.918-2.715 5.532zm23.286-5.696c0 4.512-1.674 7.003-4.614 7.003-2.593 0-4.349-2.43-4.39-6.819 0-4.451 1.919-6.9 4.614-6.9 2.797 0 4.39 2.49 4.39 6.716zm-7.207.204c0 3.45 1.062 5.411 2.695 5.411 1.837 0 2.715-2.145 2.715-5.533 0-3.267-.837-5.41-2.695-5.41-1.572 0-2.715 1.919-2.715 5.532z\" class=\"msportalfx-svg-c15\"></path><path d=\"M296.821 120H201v-.015c-16.272-.513-29.352-14.024-29.352-30.562 0-16.854 13.599-30.566 30.313-30.566 3.021 0 6.027.467 8.95 1.39C217.17 42.711 233.635 31 252.194 31c24.195 0 43.882 19.851 43.886 44.25 0 3.447-.407 6.91-1.209 10.313.218-.01.434-.015.648-.015 9.417 0 17.078 7.726 17.078 17.223 0 8.54-6.329 15.809-14.602 17.021l-1.174.208zM203 118h93.223l.504-.077c7.777-.614 13.87-7.27 13.87-15.151 0-8.394-6.764-15.223-15.078-15.223-.59 0-1.205.043-1.827.129l-1.493.204.391-1.455a43.047 43.047 0 0 0 1.49-11.177C294.077 51.953 275.287 33 252.194 33c-18.028 0-33.987 11.583-39.711 28.824l-.321.966-.96-.338a27.758 27.758 0 0 0-9.241-1.595c-15.612 0-28.313 12.814-28.313 28.566 0 15.69 12.593 28.468 28.114 28.575l1.238-.012V118z\" class=\"msportalfx-svg-c04\"></path><path d=\"M313.564 239.159c2.37 0 4.339-1.836 4.764-3.971h-9.532c.427 2.135 2.393 3.971 4.768 3.971zm17.121-10.081c-2.022-1.032-3.055-5.128-3.055-12.219 0-9.071-1.075-20.263-14.255-20.263s-14.255 11.191-14.255 20.263c0 7.091-1.018 11.201-3.055 12.219-1.288.644-1.389 4.073 2.036 4.073h30.547c3.565 0 3.294-3.431 2.037-4.073z\" class=\"msportalfx-svg-c19\"></path><path d=\"M312 196.644c-11.876.762-12.88 11.471-12.88 20.216 0 7.091-1.018 11.2-3.055 12.219-1.288.644-1.389 4.073 2.036 4.073H312v-36.508z\" class=\"msportalfx-svg-c15\"></path></g></svg>"
                        },
                        "customWidth": "60",
                        "showPin": false,
                        "name": "Image"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "<span style=\"color: #000000; font-family: Babas; font-size: 2em;\">Get more visibility into the usage and performance of your cluster</span>\r\n\r\nThis section provides additional monitoring coverage that is based on platform logs (diagnostic logs).</br>\r\nTo activate additional monitoring, you must enable the \"Command\" and \"Query\" diagnostic settings and send them to Log Analytics. [Learn more](https://docs.microsoft.com/en-us/azure/data-explorer/using-diagnostic-logs?tabs=commands-and-queries#set-up-diagnostic-logs-for-an-azure-data-explorer-cluster)</div>"
                        },
                        "customWidth": "60",
                        "showPin": false,
                        "name": "text - 2"
                      },
                      {
                        "type": 11,
                        "content": {
                          "version": "LinkItem/1.0",
                          "style": "paragraph",
                          "links": [
                            {
                              "cellValue": "{Resource}",
                              "linkTarget": "Resource",
                              "linkLabel": "Configure Logs for Monitoring >",
                              "subTarget": "diagnostics",
                              "preText": "",
                              "postText": "",
                              "style": "primary"
                            }
                          ]
                        },
                        "customWidth": "70",
                        "name": "links - 8"
                      }
                    ]
                  },
                  "customWidth": "90",
                  "conditionalVisibility": {
                    "parameterName": "Usage",
                    "comparison": "isEqualTo",
                    "value": "not present"
                  },
                  "name": "Onboarding Message - Not onboarded yet"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "Loading",
                          "style": "info"
                        },
                        "customWidth": "60",
                        "showPin": false,
                        "name": "text - 2"
                      }
                    ]
                  },
                  "customWidth": "90",
                  "conditionalVisibility": {
                    "parameterName": "Usage",
                    "comparison": "isEqualTo",
                    "value": ""
                  },
                  "name": "Onboarding Message - onboarded no data"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "{\"version\":\"1.0.0\",\"content\":\"[{\\\"value\\\": \\\"Yes\\\", \\\"label\\\": \\\"ðŸ’¡ Help\\\"}]\",\"transformers\":null}",
                          "size": 4,
                          "exportFieldName": "value",
                          "exportParameterName": "HelpConsumers",
                          "queryType": 8,
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "label",
                              "formatter": 1,
                              "formatOptions": {
                                "compositeBarSettings": {
                                  "labelText": "",
                                  "columnSettings": []
                                }
                              },
                              "tooltipFormat": {
                                "tooltip": "Click to show help"
                              }
                            },
                            "showBorder": false
                          }
                        },
                        "customWidth": "0",
                        "conditionalVisibility": {
                          "parameterName": "Usage",
                          "comparison": "isEqualTo",
                          "value": "present"
                        },
                        "name": "Help Consumers",
                        "styleSettings": {
                          "margin": "-50px 0px 0px 0px"
                        }
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "This table shows the distribution of the memory/CPU consumption, relative to the actual memory and CPU consumption of the cluster. </BR>For more usage information go to the Usage tab."
                        },
                        "customWidth": "60",
                        "conditionalVisibilities": [
                          {
                            "parameterName": "Usage",
                            "comparison": "isEqualTo",
                            "value": "present"
                          },
                          {
                            "parameterName": "HelpConsumers",
                            "comparison": "isEqualTo",
                            "value": "Yes"
                          }
                        ],
                        "name": "More Info",
                        "styleSettings": {
                          "margin": "0px 0px 0px 0px"
                        }
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "Usage",
                    "comparison": "isEqualTo",
                    "value": "present"
                  },
                  "name": "Inner Help"
                }
              ]
            },
            "name": "expander",
            "styleSettings": {
              "padding": "10px"
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "tab",
        "comparison": "isEqualTo",
        "value": "Overview"
      },
      "name": "Overview"
    },
    {
      "type": 1,
      "content": {
        "json": "*Information about metrics is available [here](https://docs.microsoft.com/en-us/azure/data-explorer/using-metrics#cluster-metrics)*"
      },
      "conditionalVisibility": {
        "parameterName": "tab",
        "comparison": "isEqualTo",
        "value": "Cluster"
      },
      "name": "metrics help text"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Cluster",
        "items": [
          {
            "type": 10,
            "content": {
              "chartId": "workbook19356bdc-cfd5-47c7-8e70-05bbd3f39558",
              "version": "MetricsItem/2.0",
              "size": 1,
              "chartType": 2,
              "resourceType": "microsoft.kusto/clusters",
              "metricScope": 0,
              "resourceParameter": "Resource",
              "resourceIds": [
                "{Resource}"
              ],
              "timeContextFromParameter": "TimeRange",
              "timeContext": {
                "durationMs": 604800000
              },
              "metrics": [
                {
                  "namespace": "microsoft.kusto/clusters",
                  "metric": "microsoft.kusto/clusters-Cluster health-KeepAlive",
                  "aggregation": 4,
                  "splitBy": null
                }
              ],
              "title": "Keep Alive",
              "showOpenInMe": true,
              "gridSettings": {
                "rowLimit": 10000
              },
              "sortBy": [],
              "showExportToExcel": true
            },
            "customWidth": "25",
            "showPin": false,
            "name": "keep alive"
          },
          {
            "type": 10,
            "content": {
              "chartId": "workbook19356bdc-cfd5-47c7-8e70-05bbd3f39558",
              "version": "MetricsItem/2.0",
              "size": 1,
              "chartType": 2,
              "resourceType": "microsoft.kusto/clusters",
              "metricScope": 0,
              "resourceParameter": "Resource",
              "resourceIds": [
                "{Resource}"
              ],
              "timeContextFromParameter": "TimeRange",
              "timeContext": {
                "durationMs": 604800000
              },
              "metrics": [
                {
                  "namespace": "microsoft.kusto/clusters",
                  "metric": "microsoft.kusto/clusters-Cluster health-CPU",
                  "aggregation": 4,
                  "splitBy": null
                }
              ],
              "title": "CPU",
              "showOpenInMe": true,
              "gridSettings": {
                "rowLimit": 10000
              },
              "sortBy": [],
              "showExportToExcel": true
            },
            "customWidth": "25",
            "showPin": false,
            "name": "CPU"
          },
          {
            "type": 10,
            "content": {
              "chartId": "workbook19356bdc-cfd5-47c7-8e70-05bbd3f39558",
              "version": "MetricsItem/2.0",
              "size": 1,
              "chartType": 2,
              "resourceType": "microsoft.kusto/clusters",
              "metricScope": 0,
              "resourceParameter": "Resource",
              "resourceIds": [
                "{Resource}"
              ],
              "timeContextFromParameter": "TimeRange",
              "timeContext": {
                "durationMs": 604800000
              },
              "metrics": [
                {
                  "namespace": "microsoft.kusto/clusters",
                  "metric": "microsoft.kusto/clusters-Cluster health-CacheUtilization",
                  "aggregation": 4,
                  "splitBy": null
                }
              ],
              "title": "Cache Utilization",
              "showOpenInMe": true,
              "gridSettings": {
                "rowLimit": 10000
              },
              "sortBy": [],
              "showExportToExcel": true
            },
            "customWidth": "25",
            "showPin": false,
            "name": "cache"
          },
          {
            "type": 10,
            "content": {
              "chartId": "workbook19356bdc-cfd5-47c7-8e70-05bbd3f39558",
              "version": "MetricsItem/2.0",
              "size": 1,
              "chartType": 2,
              "resourceType": "microsoft.kusto/clusters",
              "metricScope": 0,
              "resourceParameter": "Resource",
              "resourceIds": [
                "{Resource}"
              ],
              "timeContextFromParameter": "TimeRange",
              "timeContext": {
                "durationMs": 604800000
              },
              "metrics": [
                {
                  "namespace": "microsoft.kusto/clusters",
                  "metric": "microsoft.kusto/clusters-Cluster health-InstanceCount",
                  "aggregation": 4,
                  "splitBy": null
                }
              ],
              "title": "Instance Count",
              "showOpenInMe": true,
              "gridSettings": {
                "rowLimit": 10000
              },
              "sortBy": [],
              "showExportToExcel": true
            },
            "customWidth": "25",
            "showPin": false,
            "name": "Instance Count"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Queries",
              "expandable": true,
              "items": [
                {
                  "type": 10,
                  "content": {
                    "chartId": "workbook19356bdc-cfd5-47c7-8e70-05bbd3f39558",
                    "version": "MetricsItem/2.0",
                    "size": 1,
                    "chartType": 2,
                    "resourceType": "microsoft.kusto/clusters",
                    "metricScope": 0,
                    "resourceParameter": "Resource",
                    "resourceIds": [
                      "{Resource}"
                    ],
                    "timeContextFromParameter": "TimeRange",
                    "timeContext": {
                      "durationMs": 604800000
                    },
                    "metrics": [
                      {
                        "namespace": "microsoft.kusto/clusters",
                        "metric": "microsoft.kusto/clusters-Query performance-TotalNumberOfConcurrentQueries",
                        "aggregation": 4,
                        "splitBy": null
                      }
                    ],
                    "title": "Concurrent Queries ",
                    "showOpenInMe": true,
                    "gridSettings": {
                      "rowLimit": 10000
                    },
                    "sortBy": [],
                    "showExportToExcel": true
                  },
                  "customWidth": "25",
                  "showPin": false,
                  "name": "Concurrent Queries "
                },
                {
                  "type": 10,
                  "content": {
                    "chartId": "workbook19356bdc-cfd5-47c7-8e70-05bbd3f39558",
                    "version": "MetricsItem/2.0",
                    "size": 1,
                    "chartType": 2,
                    "resourceType": "microsoft.kusto/clusters",
                    "metricScope": 0,
                    "resourceParameter": "Resource",
                    "resourceIds": [
                      "{Resource}"
                    ],
                    "timeContextFromParameter": "TimeRange",
                    "timeContext": {
                      "durationMs": 604800000
                    },
                    "metrics": [
                      {
                        "namespace": "microsoft.kusto/clusters",
                        "metric": "microsoft.kusto/clusters-Query performance-QueryDuration",
                        "aggregation": 4,
                        "splitBy": "QueryStatus"
                      }
                    ],
                    "title": "Query Duration",
                    "showOpenInMe": true,
                    "gridSettings": {
                      "rowLimit": 10000
                    },
                    "sortBy": [],
                    "showExportToExcel": true
                  },
                  "customWidth": "25",
                  "showPin": false,
                  "name": "keep alive"
                },
                {
                  "type": 10,
                  "content": {
                    "chartId": "workbook19356bdc-cfd5-47c7-8e70-05bbd3f39558",
                    "version": "MetricsItem/2.0",
                    "size": 1,
                    "chartType": 2,
                    "resourceType": "microsoft.kusto/clusters",
                    "metricScope": 0,
                    "resourceParameter": "Resource",
                    "resourceIds": [
                      "{Resource}"
                    ],
                    "timeContextFromParameter": "TimeRange",
                    "timeContext": {
                      "durationMs": 604800000
                    },
                    "metrics": [
                      {
                        "namespace": "microsoft.kusto/clusters",
                        "metric": "microsoft.kusto/clusters-Cluster health-TotalNumberOfThrottledCommands",
                        "aggregation": 4,
                        "splitBy": null,
                        "columnName": "Throttled Commands"
                      }
                    ],
                    "title": "Throttled Commands",
                    "showOpenInMe": true,
                    "gridSettings": {
                      "rowLimit": 10000
                    },
                    "sortBy": [],
                    "showExportToExcel": true
                  },
                  "customWidth": "25",
                  "showPin": false,
                  "name": "Throttled Commands"
                },
                {
                  "type": 10,
                  "content": {
                    "chartId": "workbook19356bdc-cfd5-47c7-8e70-05bbd3f39558",
                    "version": "MetricsItem/2.0",
                    "size": 1,
                    "chartType": 2,
                    "resourceType": "microsoft.kusto/clusters",
                    "metricScope": 0,
                    "resourceParameter": "Resource",
                    "resourceIds": [
                      "{Resource}"
                    ],
                    "timeContextFromParameter": "TimeRange",
                    "timeContext": {
                      "durationMs": 604800000
                    },
                    "metrics": [
                      {
                        "namespace": "microsoft.kusto/clusters",
                        "metric": "microsoft.kusto/clusters-Query performance-TotalNumberOfThrottledQueries",
                        "aggregation": 4,
                        "splitBy": null,
                        "columnName": "Throttled queries"
                      }
                    ],
                    "title": "Throttled Queries",
                    "showOpenInMe": true,
                    "gridSettings": {
                      "rowLimit": 10000
                    },
                    "sortBy": [],
                    "showExportToExcel": true
                  },
                  "customWidth": "25",
                  "showPin": false,
                  "name": "Throttled Queries"
                }
              ]
            },
            "name": "Queries Internal",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Ingestion",
              "expandable": true,
              "items": [
                {
                  "type": 10,
                  "content": {
                    "chartId": "workbook19356bdc-cfd5-47c7-8e70-05bbd3f39558",
                    "version": "MetricsItem/2.0",
                    "size": 1,
                    "chartType": 2,
                    "resourceType": "microsoft.kusto/clusters",
                    "metricScope": 0,
                    "resourceParameter": "Resource",
                    "resourceIds": [
                      "{Resource}"
                    ],
                    "timeContextFromParameter": "TimeRange",
                    "timeContext": {
                      "durationMs": 604800000
                    },
                    "metrics": [
                      {
                        "namespace": "microsoft.kusto/clusters",
                        "metric": "microsoft.kusto/clusters-Cluster health-IngestionUtilization",
                        "aggregation": 4,
                        "splitBy": null
                      }
                    ],
                    "title": "Ingestion Utilization",
                    "showOpenInMe": true,
                    "gridSettings": {
                      "rowLimit": 10000
                    },
                    "sortBy": [],
                    "showExportToExcel": true
                  },
                  "customWidth": "25",
                  "showPin": false,
                  "name": "ingestion"
                },
                {
                  "type": 10,
                  "content": {
                    "chartId": "workbook19356bdc-cfd5-47c7-8e70-05bbd3f39558",
                    "version": "MetricsItem/2.0",
                    "size": 1,
                    "chartType": 2,
                    "resourceType": "microsoft.kusto/clusters",
                    "metricScope": 0,
                    "resourceParameter": "Resource",
                    "resourceIds": [
                      "{Resource}"
                    ],
                    "timeContextFromParameter": "TimeRange",
                    "timeContext": {
                      "durationMs": 604800000
                    },
                    "metrics": [
                      {
                        "namespace": "microsoft.kusto/clusters",
                        "metric": "microsoft.kusto/clusters-Ingestion health and performance-IngestionLatencyInSeconds",
                        "aggregation": 4,
                        "splitBy": null
                      }
                    ],
                    "title": "Ingestion Latency",
                    "showOpenInMe": true,
                    "gridSettings": {
                      "rowLimit": 10000
                    },
                    "sortBy": [],
                    "showExportToExcel": true
                  },
                  "customWidth": "25",
                  "showPin": false,
                  "name": "Ingestion Latency"
                },
                {
                  "type": 10,
                  "content": {
                    "chartId": "workbook19356bdc-cfd5-47c7-8e70-05bbd3f39558",
                    "version": "MetricsItem/2.0",
                    "size": 1,
                    "chartType": 2,
                    "resourceType": "microsoft.kusto/clusters",
                    "metricScope": 0,
                    "resourceParameter": "Resource",
                    "resourceIds": [
                      "{Resource}"
                    ],
                    "timeContextFromParameter": "TimeRange",
                    "timeContext": {
                      "durationMs": 604800000
                    },
                    "metrics": [
                      {
                        "namespace": "microsoft.kusto/clusters",
                        "metric": "microsoft.kusto/clusters-Ingestion health and performance-IngestionResult",
                        "aggregation": 7,
                        "splitBy": "IngestionResultDetails"
                      }
                    ],
                    "title": "Ingestion Result",
                    "showOpenInMe": true,
                    "gridSettings": {
                      "rowLimit": 10000
                    },
                    "sortBy": [],
                    "showExportToExcel": true
                  },
                  "customWidth": "25",
                  "showPin": false,
                  "name": "Ingestion Result"
                },
                {
                  "type": 10,
                  "content": {
                    "chartId": "workbook19356bdc-cfd5-47c7-8e70-05bbd3f39558",
                    "version": "MetricsItem/2.0",
                    "size": 1,
                    "chartType": 2,
                    "resourceType": "microsoft.kusto/clusters",
                    "metricScope": 0,
                    "resourceParameter": "Resource",
                    "resourceIds": [
                      "{Resource}"
                    ],
                    "timeContextFromParameter": "TimeRange",
                    "timeContext": {
                      "durationMs": 604800000
                    },
                    "metrics": [
                      {
                        "namespace": "microsoft.kusto/clusters",
                        "metric": "microsoft.kusto/clusters-Ingestion health and performance-IngestionVolumeInMB",
                        "aggregation": 1,
                        "splitBy": null
                      }
                    ],
                    "title": "Ingestion Volume",
                    "showOpenInMe": true,
                    "gridSettings": {
                      "rowLimit": 10000
                    },
                    "sortBy": [],
                    "showExportToExcel": true
                  },
                  "customWidth": "25",
                  "showPin": false,
                  "name": "Ingestion Volume"
                }
              ]
            },
            "name": "Ingestion Internal Group",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Streaming Ingestion",
              "expandable": true,
              "items": [
                {
                  "type": 10,
                  "content": {
                    "chartId": "workbook19356bdc-cfd5-47c7-8e70-05bbd3f39558",
                    "version": "MetricsItem/2.0",
                    "size": 1,
                    "chartType": 2,
                    "resourceType": "microsoft.kusto/clusters",
                    "metricScope": 0,
                    "resourceParameter": "Resource",
                    "resourceIds": [
                      "{Resource}"
                    ],
                    "timeContextFromParameter": "TimeRange",
                    "timeContext": {
                      "durationMs": 604800000
                    },
                    "metrics": [
                      {
                        "namespace": "microsoft.kusto/clusters",
                        "metric": "microsoft.kusto/clusters-Streaming Ingest-StreamingIngestDataRate",
                        "aggregation": 4,
                        "splitBy": null
                      }
                    ],
                    "title": "Streaming Ingest Data Rate",
                    "showOpenInMe": true,
                    "gridSettings": {
                      "rowLimit": 10000
                    },
                    "sortBy": [],
                    "showExportToExcel": true
                  },
                  "customWidth": "25",
                  "showPin": false,
                  "name": "Streaming Ingest Data Rate"
                },
                {
                  "type": 10,
                  "content": {
                    "chartId": "workbook19356bdc-cfd5-47c7-8e70-05bbd3f39558",
                    "version": "MetricsItem/2.0",
                    "size": 1,
                    "chartType": 2,
                    "resourceType": "microsoft.kusto/clusters",
                    "metricScope": 0,
                    "resourceParameter": "Resource",
                    "resourceIds": [
                      "{Resource}"
                    ],
                    "timeContextFromParameter": "TimeRange",
                    "timeContext": {
                      "durationMs": 604800000
                    },
                    "metrics": [
                      {
                        "namespace": "microsoft.kusto/clusters",
                        "metric": "microsoft.kusto/clusters-Streaming Ingest-StreamingIngestDuration",
                        "aggregation": 4,
                        "splitBy": null
                      }
                    ],
                    "title": "Streaming Ingest Duration",
                    "showOpenInMe": true,
                    "gridSettings": {
                      "rowLimit": 10000
                    },
                    "sortBy": [],
                    "showExportToExcel": true
                  },
                  "customWidth": "25",
                  "showPin": false,
                  "name": "Streaming Ingest Duration"
                },
                {
                  "type": 10,
                  "content": {
                    "chartId": "workbook19356bdc-cfd5-47c7-8e70-05bbd3f39558",
                    "version": "MetricsItem/2.0",
                    "size": 1,
                    "chartType": 2,
                    "resourceType": "microsoft.kusto/clusters",
                    "metricScope": 0,
                    "resourceParameter": "Resource",
                    "resourceIds": [
                      "{Resource}"
                    ],
                    "timeContextFromParameter": "TimeRange",
                    "timeContext": {
                      "durationMs": 604800000
                    },
                    "metrics": [
                      {
                        "namespace": "microsoft.kusto/clusters",
                        "metric": "microsoft.kusto/clusters-Streaming Ingest-SteamingIngestRequestRate",
                        "aggregation": 7,
                        "splitBy": null,
                        "columnName": "Streaming Ingest Request Rate (Total number of streaming ingestion requests)"
                      }
                    ],
                    "title": "Streaming Ingest Request Rate",
                    "showOpenInMe": true,
                    "gridSettings": {
                      "rowLimit": 10000
                    },
                    "sortBy": [],
                    "showExportToExcel": true
                  },
                  "customWidth": "25",
                  "showPin": false,
                  "name": "Streaming Ingest Request Rate"
                },
                {
                  "type": 10,
                  "content": {
                    "chartId": "workbook19356bdc-cfd5-47c7-8e70-05bbd3f39558",
                    "version": "MetricsItem/2.0",
                    "size": 1,
                    "chartType": 2,
                    "resourceType": "microsoft.kusto/clusters",
                    "metricScope": 0,
                    "resourceParameter": "Resource",
                    "resourceIds": [
                      "{Resource}"
                    ],
                    "timeContextFromParameter": "TimeRange",
                    "timeContext": {
                      "durationMs": 604800000
                    },
                    "metrics": [
                      {
                        "namespace": "microsoft.kusto/clusters",
                        "metric": "microsoft.kusto/clusters-Streaming Ingest-StreamingIngestResults",
                        "aggregation": 4,
                        "splitBy": "Result"
                      }
                    ],
                    "title": "Streaming Ingest Result",
                    "showOpenInMe": true,
                    "gridSettings": {
                      "rowLimit": 10000
                    },
                    "sortBy": [],
                    "showExportToExcel": true
                  },
                  "customWidth": "25",
                  "showPin": false,
                  "name": "Streaming Ingest Result"
                }
              ]
            },
            "name": "Streaming Ingestion",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "tab",
        "comparison": "isEqualTo",
        "value": "Cluster"
      },
      "name": "Cluster Group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "255d43af-8d9e-4b60-a8a1-335be810533f",
                  "version": "KqlParameterItem/1.0",
                  "name": "include_system_operations",
                  "label": "System operations",
                  "type": 2,
                  "description": "System operations (Data Management) are used for ingestion and other cluster management aspects",
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\r\n{ \"value\": \"false\", \"label\": \"Do Not Include Data Management Operations\", \"selected\": \"false\" }, \r\n{ \"value\": \"true\", \"label\": \"Include Data Management Operations\", \"selected\": \"true\" }\r\n]",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                }
              ],
              "style": "above",
              "queryType": 0,
              "resourceType": "microsoft.kusto/clusters"
            },
            "conditionalVisibility": {
              "parameterName": "Usage",
              "comparison": "isEqualTo",
              "value": "present"
            },
            "name": "parameters - 7"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "letÂ system_databasesÂ =Â dynamic(['KustoMonitoringPersistentDatabase',Â '$systemdb']);Â \r\nletÂ system_usersÂ =Â dynamic(['AAD app id=b753584e-c468-4503-852a-374280ce7a62',Â 'KustoServiceBuiltInPrincipal']);Â //Â b753584e-c468-4503-852a-374280ce7a62Â isÂ KustoRunner\r\nletÂ system_cluster_management_applicationsÂ =Â dynamic(['Kusto.WinSvc.CM.Svc']);Â //Â KustoÂ ClusterÂ Management\r\nletÂ CommandTableÂ =Â ADXCommandÂ \r\n|Â whereÂ TimeGeneratedÂ >Â datetime(2020-09-09T09:30:00Z)Â \r\n|Â whereÂ LastUpdatedOnÂ {TimeRange}\r\n|Â whereÂ DatabaseNameÂ Â !inÂ (system_databases)Â andÂ UserÂ !inÂ (system_users)Â andÂ ApplicationNameÂ !inÂ (system_cluster_management_applications)\r\n|Â whereÂ (({include_system_operations}Â ==Â \"false\"Â andÂ ApplicationNameÂ !=Â 'Kusto.WinSvc.DM.Svc')Â orÂ {include_system_operations}Â ==Â \"true\")\r\n|Â extendÂ MemoryPeakÂ =Â tolong(ResourceUtilization.MemoryPeak)Â \r\n|Â parseÂ _ResourceIdÂ withÂ *Â \"providers/microsoft.kusto/clusters/\"Â cluster_name\r\n|Â project-awayÂ ResourceUtilization;\r\nletÂ QueryTableÂ =Â ADXQuery\r\n|Â whereÂ LastUpdatedOnÂ {TimeRange}\r\n|Â whereÂ DatabaseNameÂ Â !inÂ (system_databases)Â andÂ UserÂ !inÂ (system_users)Â andÂ ApplicationNameÂ !inÂ (system_cluster_management_applications)\r\n|Â whereÂ (({include_system_operations}Â ==Â \"false\"Â andÂ ApplicationNameÂ !=Â 'Kusto.WinSvc.DM.Svc')Â orÂ {include_system_operations}Â ==Â \"true\")\r\n|Â extendÂ MemoryPeakÂ =Â tolong(MemoryPeak)\r\n|Â parseÂ _ResourceIdÂ withÂ *Â \"providers/microsoft.kusto/clusters/\"Â cluster_name\r\n|Â extendÂ CommandTypeÂ =Â 'Query';\r\nletÂ dataset_commands_queriesÂ =Â CommandTableÂ |Â unionÂ (QueryTable)\r\n|Â projectÂ CommandType,Â DatabaseName,Â StartedOn,Â LastUpdatedOn,Â Duration,Â State,Â FailureReason,Â RootActivityId,Â User,Â ApplicationName,Â Principal,Â TotalCPU,Â MemoryPeak,Â CorrelationId,Â cluster_name;\r\nletÂ datasetÂ =Â dataset_commands_queries\r\nÂ Â Â Â |Â whereÂ cluster_nameÂ ==Â '{Resource:name}'\r\nÂ Â Â Â //|Â whereÂ totimespan(TotalCPU)Â >Â totimespan(0)\r\nÂ Â Â Â |Â summarizeÂ TotalCPU=max(TotalCPU)Â \r\nÂ Â ,Â MemoryPeak=max(MemoryPeak)Â byÂ User,Â ApplicationName,Â CorrelationIdÂ \r\n;\r\nletÂ totalCPUÂ =Â toscalar(datasetÂ |Â summarizeÂ sum((totimespan(TotalCPU)/1s)));\r\nletÂ totalMemoryÂ =Â toscalar(datasetÂ |Â summarizeÂ sum(MemoryPeak));\r\nletÂ topMemoryÂ =Â \r\nÂ Â Â Â dataset\r\nÂ Â Â Â |Â top-nestedÂ 10000Â ofÂ UserÂ withÂ others=\"Others\"Â byÂ sum(MemoryPeak),Â top-nestedÂ 10000Â ofÂ ApplicationNameÂ withÂ others=\"Others\"Â byÂ sum(MemoryPeak)\r\nÂ Â Â Â |Â extendÂ PercentOfTotalClusterMemoryUsedÂ =Â aggregated_ApplicationName/toreal(totalMemory)\r\n;\r\nletÂ topCpuÂ =Â \r\nÂ Â Â Â dataset\r\nÂ Â Â Â |Â top-nestedÂ 10000Â ofÂ UserÂ withÂ others=\"Others\"Â byÂ sum(totimespan(TotalCPU)/1s),Â top-nestedÂ 10000Â ofÂ ApplicationNameÂ withÂ others=\"Others\"Â byÂ sum(totimespan(TotalCPU)/1s)\r\nÂ Â Â Â |Â extendÂ PercentOfTotalClusterCpuUsedÂ =Â aggregated_ApplicationName/toreal(totalCPU)\r\n;\r\ntopMemory\r\n|Â joinÂ kindÂ =Â fullouter(topCpu)Â onÂ User,Â ApplicationName\r\n|Â extendÂ BothPercentagesÂ =Â PercentOfTotalClusterMemoryUsed+PercentOfTotalClusterCpuUsed\r\n|Â topÂ 10Â byÂ BothPercentagesÂ desc\r\n|Â extendÂ UserÂ =Â case(ApplicationName==\"Kusto.WinSvc.DM.Svc\",Â strcat(\"KustoÂ DataÂ ManagementÂ \",\"(\",User,\")\"),\r\nApplicationName==\"KustoQueryRunner\",Â strcat(\"KustoÂ QueryÂ RunnerÂ \",\"(\",User,\")\"),\r\nUser==\"AADÂ appÂ id=e0331ea9-83fc-4409-a17d-6375364c3280\",Â \"DataMapÂ AgentÂ 001Â (appÂ id:Â e0331ea9-83fc-4409-a17d-6375364c3280)\",Â //Â UsedÂ forÂ internalÂ MSÂ clustersÂ \r\nUser)\r\n| extend PercentOfTotalClusterMemoryUsed_display = iff(isnan(PercentOfTotalClusterMemoryUsedÂ *Â 100), toreal(0), PercentOfTotalClusterMemoryUsedÂ *Â 100)\r\n| extend PercentOfTotalClusterCpuUsed_display = iff(isnan(PercentOfTotalClusterCpuUsedÂ *Â 100), toreal(0), PercentOfTotalClusterCpuUsedÂ *Â 100)\r\n| whereÂ notÂ (ApplicationNameÂ ==Â \"Others\"Â andÂ Â PercentOfTotalClusterMemoryUsed_displayÂ Â ==Â 0Â andÂ PercentOfTotalClusterCpuUsed_displayÂ ==Â 0)\r\n| projectÂ User,Â ApplicationName,Â PercentOfTotalClusterMemoryUsed_displayÂ ,Â PercentOfTotalClusterCpuUsed_display",
                    "size": 3,
                    "showAnalytics": true,
                    "title": "Top Resource Consumers",
                    "timeContext": {
                      "durationMs": 604800000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.kusto/clusters",
                    "crossComponentResources": [
                      "{Resource}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "User",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "45%"
                          }
                        },
                        {
                          "columnMatch": "ApplicationName",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "20%"
                          }
                        },
                        {
                          "columnMatch": "PercentOfTotalClusterMemoryUsed_display",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue",
                            "customColumnWidthSetting": "20%"
                          },
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          },
                          "tooltipFormat": {
                            "tooltip": "Percent Of Total Cluster Memory Used"
                          }
                        },
                        {
                          "columnMatch": "PercentOfTotalClusterCpuUsed_display",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue",
                            "customColumnWidthSetting": "15%"
                          },
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal"
                            }
                          },
                          "tooltipFormat": {
                            "tooltip": "Percent Of Total Cluster CPU Used"
                          }
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "User",
                          "label": "Principal"
                        },
                        {
                          "columnId": "ApplicationName",
                          "label": "Application"
                        },
                        {
                          "columnId": "PercentOfTotalClusterMemoryUsed_display",
                          "label": "% of Used Cluster Memory",
                          "comment": "Relative portion of the actual cluster memory consumption"
                        },
                        {
                          "columnId": "PercentOfTotalClusterCpuUsed_display",
                          "label": "% of Used Cluster CPU",
                          "comment": "Relative portion of the actual CPU consumption"
                        }
                      ]
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "showLegend": true
                    }
                  },
                  "customWidth": "60",
                  "conditionalVisibility": {
                    "parameterName": "Usage",
                    "comparison": "isEqualTo",
                    "value": "present"
                  },
                  "name": "Top Resource Consumers"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "letÂ system_databasesÂ =Â dynamic(['KustoMonitoringPersistentDatabase',Â '$systemdb']);Â \r\nletÂ system_usersÂ =Â dynamic(['AAD app id=b753584e-c468-4503-852a-374280ce7a62',Â 'KustoServiceBuiltInPrincipal']);Â //Â b753584e-c468-4503-852a-374280ce7a62Â isÂ Kusto Query Runner\r\nletÂ system_cluster_management_applicationsÂ =Â dynamic(['Kusto.WinSvc.CM.Svc']);Â //Â KustoÂ ClusterÂ Management\r\nlet CommandTable = ADXCommand | extend MemoryPeak = tolong(ResourceUtilization.MemoryPeak)\r\n|Â whereÂ LastUpdatedOnÂ {TimeRange}\r\n|Â whereÂ DatabaseNameÂ Â !inÂ (system_databases)Â andÂ UserÂ !in (system_users)Â andÂ ApplicationNameÂ !inÂ (system_cluster_management_applications)\r\n|Â whereÂ (({include_system_operations}Â ==Â \"false\"Â andÂ ApplicationNameÂ !=Â 'Kusto.WinSvc.DM.Svc')Â orÂ {include_system_operations}Â ==Â \"true\")\r\n| parse _ResourceId with * \"providers/microsoft.kusto/clusters/\" cluster_name\r\n| project-away ResourceUtilization;\r\nlet QueryTable = ADXQuery\r\n|Â whereÂ LastUpdatedOnÂ {TimeRange}\r\n|Â whereÂ DatabaseNameÂ Â !inÂ (system_databases)Â andÂ UserÂ !inÂ (system_users)Â andÂ ApplicationNameÂ !inÂ (system_cluster_management_applications)\r\n|Â whereÂ (({include_system_operations}Â ==Â \"false\"Â andÂ ApplicationNameÂ !=Â 'Kusto.WinSvc.DM.Svc')Â orÂ {include_system_operations}Â ==Â \"true\")\r\n| extend MemoryPeak = tolong(MemoryPeak)\r\n| parse _ResourceId with * \"providers/microsoft.kusto/clusters/\" cluster_name\r\n| extend CommandType = 'Query';\r\nlet dataset_commands_queries = CommandTable | union (QueryTable)\r\n| project CommandType, DatabaseName, StartedOn, LastUpdatedOn, Duration, State,\r\nFailureReason, RootActivityId, User, ApplicationName, Principal,TotalCPU,MemoryPeak,CorrelationId,cluster_name;\r\nlet dataset = dataset_commands_queries\r\n    | where cluster_name == '{Resource:name}'\r\n| where  CommandType != 'TableSetOrAppend'\r\n| summarize Count=count() by User, ApplicationName\r\n| project User, ApplicationName, Count\r\n| extend User = case(ApplicationName==\"Kusto.WinSvc.DM.Svc\", strcat(\"Kusto Data Management \",\"(\",User,\")\"),\r\nUser==\"AAD app id=e0331ea9-83fc-4409-a17d-6375364c3280\", \"DataMap Agent 001 (app id: e0331ea9-83fc-4409-a17d-6375364c3280)\", //Â UsedÂ forÂ internalÂ MSÂ clusters\r\nUser)\r\n| top 10 by Count;\r\n    //| order by Count desc\r\n    // <Option #1 for top-nested> | top-nested 10 of User with others=\"Other Values\" by agg_User=sum(Count) desc;\r\n    // <Option #2 for top-nested>| top-nested 10 of User by agg_User=sum(Count) desc, top-nested 5 of ApplicationName with others=\"Other applications\" by agg_App=sum(Count) desc\r\n    // <Option #2 for top-nested>| where not (ApplicationName == \"Other applications\" and agg_App == 0)\r\n    // <Option #2 for top-nested>| project-away agg_User;\r\ndataset\r\n",
                    "size": 3,
                    "showAnalytics": true,
                    "title": "Top Principals and Applications by Command and Query Count",
                    "timeContext": {
                      "durationMs": 604800000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.kusto/clusters",
                    "crossComponentResources": [
                      "{Resource}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "User",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "45%"
                          }
                        },
                        {
                          "columnMatch": "ApplicationName",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "45%"
                          }
                        },
                        {
                          "columnMatch": "agg_App",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue",
                            "customColumnWidthSetting": "15%"
                          }
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "User",
                          "label": "Principal"
                        },
                        {
                          "columnId": "ApplicationName",
                          "label": "Application"
                        },
                        {
                          "columnId": "Count"
                        }
                      ]
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "createOtherGroup": 11
                    }
                  },
                  "customWidth": "40",
                  "conditionalVisibility": {
                    "parameterName": "Usage",
                    "comparison": "isEqualTo",
                    "value": "present"
                  },
                  "name": "Top Users by Command and Query Count - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "letÂ system_databasesÂ =Â dynamic(['KustoMonitoringPersistentDatabase',Â '$systemdb']);Â \r\nletÂ system_usersÂ =Â dynamic(['AAD app id=b753584e-c468-4503-852a-374280ce7a62',Â 'KustoServiceBuiltInPrincipal']);Â //Â b753584e-c468-4503-852a-374280ce7a62Â isÂ KustoRunner\r\nletÂ system_cluster_management_applicationsÂ =Â dynamic(['Kusto.WinSvc.CM.Svc']);Â //Â KustoÂ ClusterÂ Management\r\nlet CommandTable = ADXCommand | extend MemoryPeak = tolong(ResourceUtilization.MemoryPeak)\r\n|Â whereÂ LastUpdatedOnÂ {TimeRange}\r\n|Â whereÂ DatabaseNameÂ Â !inÂ (system_databases)Â andÂ UserÂ !inÂ (system_users)Â andÂ ApplicationNameÂ !inÂ (system_cluster_management_applications)\r\n|Â whereÂ (({include_system_operations}Â ==Â \"false\"Â andÂ ApplicationNameÂ !=Â 'Kusto.WinSvc.DM.Svc')Â orÂ {include_system_operations}Â ==Â \"true\")\r\n| parse _ResourceId with * \"providers/microsoft.kusto/clusters/\" cluster_name\r\n| project-away ResourceUtilization;\r\nlet QueryTable = ADXQuery\r\n|Â whereÂ LastUpdatedOnÂ {TimeRange}\r\n|Â whereÂ DatabaseNameÂ Â !inÂ (system_databases)Â andÂ UserÂ !inÂ (system_users)Â andÂ ApplicationNameÂ !inÂ (system_cluster_management_applications)\r\n|Â whereÂ (({include_system_operations}Â ==Â \"false\"Â andÂ ApplicationNameÂ !=Â 'Kusto.WinSvc.DM.Svc')Â orÂ {include_system_operations}Â ==Â \"true\")\r\n| extend MemoryPeak = tolong(MemoryPeak)\r\n| parse _ResourceId with * \"providers/microsoft.kusto/clusters/\" cluster_name\r\n| extend CommandType = 'Query';\r\nlet dataset_commands_queries = CommandTable | union (QueryTable)\r\n| extend ApplicationName = case(ApplicationName==\"Kusto.WinSvc.DM.Svc\", \"Kusto Data Management\",\r\nApplicationName)\r\n| project CommandType, DatabaseName, StartedOn, LastUpdatedOn, Duration, State,\r\nFailureReason, RootActivityId, User, ApplicationName, Principal,TotalCPU,MemoryPeak,CorrelationId,cluster_name;\r\nlet dataset = dataset_commands_queries\r\n    | where cluster_name == '{Resource:name}'\r\n| where  CommandType != 'TableSetOrAppend'\r\n| summarize Count=count() by ApplicationName\r\n| project ApplicationName, Count\r\n| order by Count desc\r\n//| top-nested 10 of User with others=\"Other Values\" by agg_User=sum(Count) desc;\r\n| top-nested 10 of ApplicationName with others=\"Other Values\"  by agg_App=sum(Count) desc;\r\n//|where not (ApplicationName == \"Other applications\" and agg_App == 0)\r\n//|project-away agg_User;\r\ndataset\r\n",
                    "size": 3,
                    "showAnalytics": true,
                    "title": "Top Applications by Command and Query Count",
                    "timeContext": {
                      "durationMs": 604800000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.kusto/clusters",
                    "crossComponentResources": [
                      "{Resource}"
                    ],
                    "visualization": "piechart",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "agg_App",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "agg_User",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue",
                            "compositeBarSettings": {
                              "labelText": "",
                              "columnSettings": []
                            }
                          }
                        }
                      ],
                      "sortBy": [
                        {
                          "itemKey": "$gen_bar_agg_App_1",
                          "sortOrder": 2
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "ApplicationName",
                          "label": "Application"
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_bar_agg_App_1",
                        "sortOrder": 2
                      }
                    ],
                    "chartSettings": {
                      "createOtherGroup": 11
                    }
                  },
                  "customWidth": "33",
                  "conditionalVisibility": {
                    "parameterName": "Usage",
                    "comparison": "isEqualTo",
                    "value": "present"
                  },
                  "name": "Top Applications by Command and Query Count"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "letÂ system_databasesÂ =Â dynamic(['KustoMonitoringPersistentDatabase',Â '$systemdb']);Â \r\nletÂ system_usersÂ =Â dynamic(['AAD app id=b753584e-c468-4503-852a-374280ce7a62',Â 'KustoServiceBuiltInPrincipal']);Â //Â b753584e-c468-4503-852a-374280ce7a62Â isÂ KustoRunner\r\nletÂ system_cluster_management_applicationsÂ =Â dynamic(['Kusto.WinSvc.CM.Svc']);Â //Â KustoÂ ClusterÂ Management\r\nlet CommandTable = ADXCommand | extend MemoryPeak = tolong(ResourceUtilization.MemoryPeak)\r\n|Â whereÂ LastUpdatedOnÂ {TimeRange}\r\n|Â whereÂ DatabaseNameÂ Â !inÂ (system_databases)Â andÂ UserÂ !inÂ (system_users)Â andÂ ApplicationNameÂ !inÂ (system_cluster_management_applications)\r\n|Â whereÂ (({include_system_operations}Â ==Â \"false\"Â andÂ ApplicationNameÂ !=Â 'Kusto.WinSvc.DM.Svc')Â orÂ {include_system_operations}Â ==Â \"true\")\r\n| parse _ResourceId with * \"providers/microsoft.kusto/clusters/\" cluster_name\r\n| project-away ResourceUtilization;\r\nlet QueryTable = ADXQuery\r\n|Â whereÂ LastUpdatedOnÂ {TimeRange}\r\n|Â whereÂ DatabaseNameÂ Â !inÂ (system_databases)Â andÂ UserÂ !inÂ (system_users)Â andÂ ApplicationNameÂ !inÂ (system_cluster_management_applications)\r\n|Â whereÂ (({include_system_operations}Â ==Â \"false\"Â andÂ ApplicationNameÂ !=Â 'Kusto.WinSvc.DM.Svc')Â orÂ {include_system_operations}Â ==Â \"true\")\r\n| extend MemoryPeak = tolong(MemoryPeak)\r\n| parse _ResourceId with * \"providers/microsoft.kusto/clusters/\" cluster_name\r\n| extend CommandType = 'Query';\r\nlet dataset_commands_queries = CommandTable | union (QueryTable)\r\n| project CommandType, DatabaseName, StartedOn, LastUpdatedOn, Duration, State,\r\nFailureReason, RootActivityId, User, ApplicationName, Principal,TotalCPU,MemoryPeak,CorrelationId,cluster_name;\r\nlet dataset = dataset_commands_queries\r\n    | where cluster_name == '{Resource:name}'\r\n| where  CommandType != 'TableSetOrAppend'\r\n| extend User = case(ApplicationName==\"Kusto.WinSvc.DM.Svc\", strcat(\"Kusto Data Management \",\"(\",User,\")\"),\r\nApplicationName==\"KustoQueryRunner\", strcat(\"Kusto Query Runner \",\"(\",User,\")\"),\r\nUser==\"AAD app id=e0331ea9-83fc-4409-a17d-6375364c3280\", \"DataMap Agent 001 (app id: e0331ea9-83fc-4409-a17d-6375364c3280)\", //Â UsedÂ forÂ internalÂ MSÂ clustersÂ \r\nUser)\r\n| summarize Count=count() by User\r\n| project User, Count\r\n| order by Count desc\r\n| top-nested 10 of User with others=\"Other Values\" by agg_User=sum(Count) desc;\r\ndataset\r\n",
                    "size": 3,
                    "showAnalytics": true,
                    "title": "Top Principals by Command and Query Count",
                    "timeContext": {
                      "durationMs": 604800000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.kusto/clusters",
                    "crossComponentResources": [
                      "{Resource}"
                    ],
                    "visualization": "piechart",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "agg_User",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue",
                            "compositeBarSettings": {
                              "labelText": "",
                              "columnSettings": []
                            }
                          }
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "User"
                        },
                        {
                          "columnId": "agg_User",
                          "label": "Count (Commands & Queries)"
                        }
                      ]
                    },
                    "chartSettings": {
                      "createOtherGroup": 11
                    }
                  },
                  "customWidth": "33",
                  "conditionalVisibility": {
                    "parameterName": "Usage",
                    "comparison": "isEqualTo",
                    "value": "present"
                  },
                  "name": "Top Users by Command and Query Count"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "letÂ system_databasesÂ =Â dynamic(['KustoMonitoringPersistentDatabase',Â '$systemdb']);Â \r\nletÂ system_usersÂ =Â dynamic(['AAD app id=b753584e-c468-4503-852a-374280ce7a62',Â 'KustoServiceBuiltInPrincipal']);Â //Â b753584e-c468-4503-852a-374280ce7a62Â isÂ KustoRunner\r\nletÂ system_cluster_management_applicationsÂ =Â dynamic(['Kusto.WinSvc.CM.Svc']);Â //Â KustoÂ ClusterÂ Management\r\nlet CommandTable = ADXCommand | extend MemoryPeak = tolong(ResourceUtilization.MemoryPeak)\r\n|Â whereÂ LastUpdatedOnÂ {TimeRange}\r\n|Â whereÂ DatabaseNameÂ Â !inÂ (system_databases)Â andÂ UserÂ !inÂ (system_users)Â andÂ ApplicationNameÂ !inÂ (system_cluster_management_applications)\r\n|Â whereÂ (({include_system_operations}Â ==Â \"false\"Â andÂ ApplicationNameÂ !=Â 'Kusto.WinSvc.DM.Svc')Â orÂ {include_system_operations}Â ==Â \"true\")\r\n| parse _ResourceId with * \"providers/microsoft.kusto/clusters/\" cluster_name\r\n| project-away ResourceUtilization;\r\nlet QueryTable = ADXQuery\r\n|Â whereÂ LastUpdatedOnÂ {TimeRange}\r\n|Â whereÂ DatabaseNameÂ Â !inÂ (system_databases)Â andÂ UserÂ !inÂ (system_users)Â andÂ ApplicationNameÂ !inÂ (system_cluster_management_applications)\r\n|Â whereÂ (({include_system_operations}Â ==Â \"false\"Â andÂ ApplicationNameÂ !=Â 'Kusto.WinSvc.DM.Svc')Â orÂ {include_system_operations}Â ==Â \"true\")\r\n| extend MemoryPeak = tolong(MemoryPeak)\r\n| parse _ResourceId with * \"providers/microsoft.kusto/clusters/\" cluster_name\r\n| extend CommandType = 'Query';\r\nlet dataset_commands_queries = CommandTable | union (QueryTable)\r\n| project CommandType, DatabaseName, StartedOn, LastUpdatedOn, Duration, State,\r\nFailureReason, RootActivityId, User, ApplicationName, Principal,TotalCPU,MemoryPeak,CorrelationId,cluster_name;\r\nlet dataset = dataset_commands_queries\r\n    | where cluster_name == '{Resource:name}'\r\n| where  CommandType != 'TableSetOrAppend'\r\n| summarize Count=count() by CommandType\r\n| project CommandType, Count\r\n| order by Count desc\r\n| top-nested 9 of CommandType with others=\"Other Values\"  by agg_App=sum(Count) desc;\r\ndataset\r\n",
                    "size": 3,
                    "showAnalytics": true,
                    "title": "Top Commands by Command Types",
                    "timeContext": {
                      "durationMs": 604800000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.kusto/clusters",
                    "crossComponentResources": [
                      "{Resource}"
                    ],
                    "visualization": "piechart",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "agg_App",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "agg_User",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue",
                            "compositeBarSettings": {
                              "labelText": "",
                              "columnSettings": []
                            }
                          }
                        }
                      ],
                      "sortBy": [
                        {
                          "itemKey": "$gen_bar_agg_App_1",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_bar_agg_App_1",
                        "sortOrder": 2
                      }
                    ],
                    "chartSettings": {
                      "createOtherGroup": 11
                    }
                  },
                  "customWidth": "33",
                  "conditionalVisibility": {
                    "parameterName": "Usage",
                    "comparison": "isEqualTo",
                    "value": "present"
                  },
                  "name": "Top Commands by Command Types"
                }
              ]
            },
            "customWidth": "100",
            "name": "expander for commands",
            "styleSettings": {
              "padding": "10px"
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "letÂ system_databasesÂ =Â dynamic(['KustoMonitoringPersistentDatabase',Â '$systemdb']);Â \r\nletÂ system_usersÂ =Â dynamic(['AAD app id=b753584e-c468-4503-852a-374280ce7a62',Â 'KustoServiceBuiltInPrincipal']);Â //Â b753584e-c468-4503-852a-374280ce7a62Â isÂ KustoRunner\r\nletÂ system_cluster_management_applicationsÂ =Â dynamic(['Kusto.WinSvc.CM.Svc']);Â //Â KustoÂ ClusterÂ Management\r\nlet CommandTable = ADXCommand\r\n| where TimeGenerated > ago(17d)\r\n|Â whereÂ DatabaseNameÂ Â !inÂ (system_databases)Â andÂ UserÂ !inÂ (system_users)Â andÂ ApplicationNameÂ !inÂ (system_cluster_management_applications)\r\n|Â whereÂ (({include_system_operations}Â ==Â \"false\"Â andÂ ApplicationNameÂ !=Â 'Kusto.WinSvc.DM.Svc')Â orÂ {include_system_operations}Â ==Â \"true\")\r\n|extend MemoryPeak = tolong(ResourceUtilization.MemoryPeak)\r\n| parse _ResourceId with * \"providers/microsoft.kusto/clusters/\" cluster_name\r\n| project-away ResourceUtilization;\r\nlet QueryTable = ADXQuery\r\n| where TimeGenerated > ago(17d)\r\n|Â whereÂ DatabaseNameÂ Â !inÂ (system_databases)Â andÂ UserÂ !inÂ (system_users)Â andÂ ApplicationNameÂ !inÂ (system_cluster_management_applications)\r\n|Â whereÂ (({include_system_operations}Â ==Â \"false\"Â andÂ ApplicationNameÂ !=Â 'Kusto.WinSvc.DM.Svc')Â orÂ {include_system_operations}Â ==Â \"true\")\r\n| extend MemoryPeak = tolong(MemoryPeak)\r\n| parse _ResourceId with * \"providers/microsoft.kusto/clusters/\" cluster_name\r\n| extend CommandType = 'Query';\r\nlet dataset_commands_queries = CommandTable | union (QueryTable)\r\n| project CommandType, DatabaseName, StartedOn, LastUpdatedOn, Duration, State,\r\nFailureReason, RootActivityId, User, ApplicationName, Principal,TotalCPU,MemoryPeak,CorrelationId,cluster_name;\r\nlet dataset = dataset_commands_queries\r\n| where cluster_name == '{Resource:name}';\r\nlet FullList = dataset | where CommandType != 'TableSetOrAppend';\r\n    let Last24Hours =\r\n        FullList\r\n        | where StartedOn >= ago(1d) and StartedOn < now()\r\n        | summarize Count=count() by User, ApplicationName\r\n        | top 100 by Count desc\r\n    ;\r\n    let HistoricalDailyAverage =\r\n        FullList\r\n        | where StartedOn >= ago(16d) and StartedOn < ago(1d)\r\n        | summarize Count=count()/15.0 by User, ApplicationName\r\n        | top 100 by Count desc\r\n    ;\r\n    let TimeRangeComparison =\r\n        Last24Hours\r\n        | join kind=leftouter (HistoricalDailyAverage) on User, ApplicationName\r\n        | project User=coalesce(User, User1), ApplicationName, Last24Hours=Count, HistoricalDailyAverage=round(Count1,0)\r\n        | extend PercentChange=round((Last24Hours-HistoricalDailyAverage)/toreal(HistoricalDailyAverage), 2)\r\n        | top 10 by Last24Hours desc\r\n    ;\r\n    TimeRangeComparison\r\n    | extend User = case(ApplicationName==\"Kusto.WinSvc.DM.Svc\", strcat(\"Kusto Data Management \",\"(\",User,\")\"),\r\n    ApplicationName==\"KustoQueryRunner\", strcat(\"Kusto Query Runner \",\"(\",User,\")\"),\r\n    User==\"AAD app id=e0331ea9-83fc-4409-a17d-6375364c3280\", \"DataMap Agent 001 (app id: e0331ea9-83fc-4409-a17d-6375364c3280)\", //Â UsedÂ forÂ internalÂ MSÂ clustersÂ \r\n    User)\r\n    | project User, ApplicationName, Last24Hours, HistoricalDailyAverage=round(HistoricalDailyAverage,0), PercentChange\r\n    | order by Last24Hours desc",
              "size": 3,
              "showAnalytics": true,
              "title": "Changes in Query Count by Principal (Not affected by the Time Range)",
              "noDataMessage": "The query returned no results. (Possible reason: no queries run in the past 24 hours)",
              "queryType": 0,
              "resourceType": "microsoft.kusto/clusters",
              "crossComponentResources": [
                "{Resource}"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "User",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "35%"
                    }
                  },
                  {
                    "columnMatch": "ApplicationName",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "25%"
                    }
                  },
                  {
                    "columnMatch": "Last24Hours",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "blue",
                      "customColumnWidthSetting": "10%"
                    },
                    "numberFormat": {
                      "unit": 17,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false
                      }
                    }
                  },
                  {
                    "columnMatch": "HistoricalDailyAverage",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "gray",
                      "customColumnWidthSetting": "20%"
                    },
                    "numberFormat": {
                      "unit": 17,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false
                      }
                    },
                    "tooltipFormat": {
                      "tooltip": "StardedOn >= ago (16d) and StardedOn < ago(1d)"
                    }
                  },
                  {
                    "columnMatch": "PercentChange",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "<",
                          "thresholdValue": "0",
                          "representation": "trenddown",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": ">",
                          "thresholdValue": "0",
                          "representation": "trendup",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Infinity",
                          "representation": "Blank",
                          "text": "  âˆž"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "10%"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "percent",
                        "useGrouping": false
                      }
                    }
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "User",
                    "label": "Principal"
                  },
                  {
                    "columnId": "ApplicationName",
                    "label": "Application"
                  },
                  {
                    "columnId": "Last24Hours",
                    "label": "Last 24 Hours"
                  },
                  {
                    "columnId": "HistoricalDailyAverage",
                    "label": "Historical Daily Average"
                  },
                  {
                    "columnId": "PercentChange",
                    "label": "% Change"
                  }
                ]
              },
              "chartSettings": {
                "showLegend": true
              }
            },
            "customWidth": "60",
            "conditionalVisibility": {
              "parameterName": "Usage",
              "comparison": "isEqualTo",
              "value": "present"
            },
            "name": "Changes in Query Count by User "
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "letÂ system_databasesÂ =Â dynamic(['KustoMonitoringPersistentDatabase',Â '$systemdb']);Â \r\nletÂ system_usersÂ =Â dynamic(['AAD app id=b753584e-c468-4503-852a-374280ce7a62',Â 'KustoServiceBuiltInPrincipal']);Â //Â b753584e-c468-4503-852a-374280ce7a62Â isÂ Kusto Quert Runner\r\nletÂ system_cluster_management_applicationsÂ =Â dynamic(['Kusto.WinSvc.CM.Svc']);Â //Â KustoÂ ClusterÂ Management\r\nlet CommandTable = ADXCommand | extend MemoryPeak = tolong(ResourceUtilization.MemoryPeak)\r\n|Â whereÂ LastUpdatedOnÂ {TimeRange}\r\n|Â whereÂ DatabaseNameÂ Â !inÂ (system_databases)Â andÂ UserÂ !inÂ (system_users)Â andÂ ApplicationNameÂ !inÂ (system_cluster_management_applications)\r\n|Â whereÂ (({include_system_operations}Â ==Â \"false\"Â andÂ ApplicationNameÂ !=Â 'Kusto.WinSvc.DM.Svc')Â orÂ {include_system_operations}Â ==Â \"true\")\r\n| parse _ResourceId with * \"providers/microsoft.kusto/clusters/\" cluster_name\r\n| project-away ResourceUtilization;\r\nlet QueryTable = ADXQuery\r\n|Â whereÂ LastUpdatedOnÂ {TimeRange}\r\n|Â whereÂ DatabaseNameÂ Â !inÂ (system_databases)Â andÂ UserÂ !inÂ (system_users)Â andÂ ApplicationNameÂ !inÂ (system_cluster_management_applications)\r\n|Â whereÂ (({include_system_operations}Â ==Â \"false\"Â andÂ ApplicationNameÂ !=Â 'Kusto.WinSvc.DM.Svc')Â orÂ {include_system_operations}Â ==Â \"true\")\r\n| extend MemoryPeak = tolong(MemoryPeak)\r\n| parse _ResourceId with * \"providers/microsoft.kusto/clusters/\" cluster_name\r\n| extend CommandType = 'Query';\r\nlet dataset_commands_queries = CommandTable | union (QueryTable)\r\n| project CommandType, DatabaseName, StartedOn, LastUpdatedOn, Duration, State,\r\nFailureReason, RootActivityId, User, ApplicationName, Principal,TotalCPU,MemoryPeak,CorrelationId,cluster_name;\r\nlet dataset = dataset_commands_queries\r\n    | where cluster_name == '{Resource:name}';\r\ndataset | where CommandType != 'TableSetOrAppend' and State == 'Failed'\r\n| summarize Count=count() by User, ApplicationName\r\n| top 10 by Count desc\r\n| extend User = case(ApplicationName==\"Kusto.WinSvc.DM.Svc\", strcat(\"Kusto Data Management \",\"(\",User,\")\"),\r\nApplicationName==\"KustoQueryRunner\", strcat(\"Kusto Query Runner \",\"(\",User,\")\"),\r\nUser==\"AAD app id=e0331ea9-83fc-4409-a17d-6375364c3280\", \"DataMap Agent 001 (app id: e0331ea9-83fc-4409-a17d-6375364c3280)\", //Â UsedÂ forÂ internalÂ MSÂ clustersÂ \r\nUser)\r\n| order by Count desc\r\n",
              "size": 3,
              "showAnalytics": true,
              "title": "Failed Queries Count",
              "noDataMessage": "ðŸŽ‰ No failed queries found",
              "noDataMessageStyle": 3,
              "timeContext": {
                "durationMs": 604800000
              },
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.kusto/clusters",
              "crossComponentResources": [
                "{Resource}"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "User",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "45%"
                    }
                  },
                  {
                    "columnMatch": "ApplicationName",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "45%"
                    }
                  },
                  {
                    "columnMatch": "Count",
                    "formatter": 3,
                    "formatOptions": {
                      "palette": "red",
                      "customColumnWidthSetting": "10%"
                    }
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "User",
                    "label": "Principal"
                  },
                  {
                    "columnId": "ApplicationName"
                  },
                  {
                    "columnId": "Count"
                  }
                ]
              },
              "chartSettings": {
                "showLegend": true
              }
            },
            "customWidth": "40",
            "conditionalVisibility": {
              "parameterName": "Usage",
              "comparison": "isEqualTo",
              "value": "present"
            },
            "name": "Failed Queries Count"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Count, Memory, and CPU By Principal",
              "expandable": true,
              "expanded": true,
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "letÂ system_databasesÂ =Â dynamic(['KustoMonitoringPersistentDatabase',Â '$systemdb']);Â \r\nletÂ system_usersÂ =Â dynamic(['AAD app id=b753584e-c468-4503-852a-374280ce7a62',Â 'KustoServiceBuiltInPrincipal']);Â //Â b753584e-c468-4503-852a-374280ce7a62Â isÂ Kusto Query Runner\r\nletÂ system_cluster_management_applicationsÂ =Â dynamic(['Kusto.WinSvc.CM.Svc']);Â //Â KustoÂ ClusterÂ Management\r\nlet CommandTable = ADXCommand | extend MemoryPeak = tolong(ResourceUtilization.MemoryPeak)\r\n|Â whereÂ StartedOnÂ {TimeRange}\r\n|Â whereÂ DatabaseNameÂ Â !inÂ (system_databases)Â andÂ UserÂ !inÂ (system_users)Â andÂ ApplicationNameÂ !inÂ (system_cluster_management_applications)\r\n|Â whereÂ (({include_system_operations}Â ==Â \"false\"Â andÂ ApplicationNameÂ !=Â 'Kusto.WinSvc.DM.Svc')Â orÂ {include_system_operations}Â ==Â \"true\")\r\n| parse _ResourceId with * \"providers/microsoft.kusto/clusters/\" cluster_name\r\n| project-away ResourceUtilization;\r\nlet QueryTable = ADXQuery\r\n|Â whereÂ StartedOnÂ {TimeRange}\r\n|Â whereÂ DatabaseNameÂ Â !inÂ (system_databases)Â andÂ UserÂ !inÂ (system_users)Â andÂ ApplicationNameÂ !inÂ (system_cluster_management_applications)\r\n|Â whereÂ (({include_system_operations}Â ==Â \"false\"Â andÂ ApplicationNameÂ !=Â 'Kusto.WinSvc.DM.Svc')Â orÂ {include_system_operations}Â ==Â \"true\")\r\n| extend MemoryPeak = tolong(MemoryPeak)\r\n| parse _ResourceId with * \"providers/microsoft.kusto/clusters/\" cluster_name\r\n| extend CommandType = 'Query';\r\nlet dataset_commands_queries = CommandTable | union (QueryTable)\r\n| project CommandType, DatabaseName, StartedOn, LastUpdatedOn, Duration, State,\r\nFailureReason, RootActivityId, User, ApplicationName, Principal,TotalCPU,MemoryPeak,CorrelationId,cluster_name;\r\nlet dataset = dataset_commands_queries\r\n    | where cluster_name == '{Resource:name}';\r\nlet FullList = dataset | where CommandType != 'TableSetOrAppend'\r\n    | project User, StartedOn , ApplicationName, CommandType\r\n;\r\nlet Top =\r\n    dataset\r\n    | summarize Count=count() by User\r\n    | top 10 by Count desc\r\n    | extend OriginalUser = User\r\n    | extend Category=User\r\n;\r\nFullList\r\n| join kind=leftouter(Top) on $left.User == $right.OriginalUser\r\n| project User=coalesce(Category, 'Other'), ApplicationName, CommandType, StartedOn\r\n| extend User = case(ApplicationName==\"Kusto.WinSvc.DM.Svc\", strcat(\"Kusto Data Management \",\"(\",User,\")\"),\r\nApplicationName==\"KustoQueryRunner\", strcat(\"Kusto Query Runner \",\"(\",User,\")\"),\r\nUser==\"AAD app id=e0331ea9-83fc-4409-a17d-6375364c3280\", \"DataMap Agent 001 (app id: e0331ea9-83fc-4409-a17d-6375364c3280)\", //Â UsedÂ forÂ internalÂ MSÂ clustersÂ \r\nUser)\r\n| summarize count() by User, bin(StartedOn, 1h)\r\n| summarize sum(count_) by bin(StartedOn, 1h),tostring(User) | sort by StartedOn asc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Query Count by Principal",
                    "timeContext": {
                      "durationMs": 604800000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.kusto/clusters",
                    "crossComponentResources": [
                      "{Resource}"
                    ],
                    "visualization": "timechart",
                    "chartSettings": {
                      "showLegend": true
                    }
                  },
                  "customWidth": "33",
                  "conditionalVisibility": {
                    "parameterName": "Usage",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "Query Count by User"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "letÂ system_databasesÂ =Â dynamic(['KustoMonitoringPersistentDatabase',Â '$systemdb']);Â \r\nletÂ system_usersÂ =Â dynamic(['AAD app id=b753584e-c468-4503-852a-374280ce7a62',Â 'KustoServiceBuiltInPrincipal']);Â //Â b753584e-c468-4503-852a-374280ce7a62Â isÂ Kusto Query Runner\r\nletÂ system_cluster_management_applicationsÂ =Â dynamic(['Kusto.WinSvc.CM.Svc']);Â //Â KustoÂ ClusterÂ Management\r\nlet CommandTable = ADXCommand | extend MemoryPeak = tolong(ResourceUtilization.MemoryPeak)\r\n|Â whereÂ StartedOnÂ {TimeRange}\r\n|Â whereÂ DatabaseNameÂ Â !inÂ (system_databases)Â andÂ UserÂ !inÂ (system_users)Â andÂ ApplicationNameÂ !inÂ (system_cluster_management_applications)\r\n|Â whereÂ (({include_system_operations}Â ==Â \"false\"Â andÂ ApplicationNameÂ !=Â 'Kusto.WinSvc.DM.Svc')Â orÂ {include_system_operations}Â ==Â \"true\")\r\n| parse _ResourceId with * \"providers/microsoft.kusto/clusters/\" cluster_name\r\n| project-away ResourceUtilization;\r\nlet QueryTable = ADXQuery\r\n|Â whereÂ StartedOnÂ {TimeRange}\r\n|Â whereÂ DatabaseNameÂ Â !inÂ (system_databases)Â andÂ UserÂ !inÂ (system_users)Â andÂ ApplicationNameÂ !inÂ (system_cluster_management_applications)\r\n|Â whereÂ (({include_system_operations}Â ==Â \"false\"Â andÂ ApplicationNameÂ !=Â 'Kusto.WinSvc.DM.Svc')Â orÂ {include_system_operations}Â ==Â \"true\")\r\n| extend MemoryPeak = tolong(MemoryPeak)\r\n| parse _ResourceId with * \"providers/microsoft.kusto/clusters/\" cluster_name\r\n| extend CommandType = 'Query';\r\nlet dataset_commands_queries = CommandTable | union (QueryTable)\r\n| project CommandType, DatabaseName, StartedOn, LastUpdatedOn, Duration, State,\r\nFailureReason, RootActivityId, User, ApplicationName, Principal,TotalCPU,MemoryPeak,CorrelationId,cluster_name;\r\nlet dataset = dataset_commands_queries\r\n    | where cluster_name == '{Resource:name}';\r\nlet FullList = dataset | where CommandType != 'TableSetOrAppend'\r\n     | project User, ApplicationName, CommandType, StartedOn, MemoryPeak\r\n     | extend User = case(ApplicationName==\"Kusto.WinSvc.DM.Svc\", strcat(\"Kusto Data Management \",\"(\",User,\")\"),\r\nApplicationName==\"KustoQueryRunner\", strcat(\"Kusto Query Runner \",\"(\",User,\")\"),\r\nUser==\"AAD app id=e0331ea9-83fc-4409-a17d-6375364c3280\", \"DataMap Agent 001 (app id: e0331ea9-83fc-4409-a17d-6375364c3280)\", //Â UsedÂ forÂ internalÂ MSÂ clustersÂ \r\nUser)\r\n;\r\nlet Top =\r\n    FullList\r\n    | summarize Memory=sum(MemoryPeak) by User\r\n    | top 10 by Memory desc\r\n    | extend OriginalUser = User\r\n    | project OriginalUser, Category=User\r\n;\r\nFullList\r\n| join kind=leftouter(Top) on $left.User == $right.OriginalUser\r\n| project User=coalesce(Category, 'Other'), StartedOn, MemoryPeakGB=MemoryPeak/1024.0/1024.0/1024.0\r\n| summarize MemoryPeakGB=sum(MemoryPeakGB) by User, bin(StartedOn, 1h)\r\n| summarize sum(MemoryPeakGB) by bin(StartedOn, 1h),tostring(User) | sort by StartedOn asc",
                    "size": 0,
                    "aggregation": 3,
                    "showAnalytics": true,
                    "title": "Total Memory by Principal",
                    "timeContext": {
                      "durationMs": 604800000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.kusto/clusters",
                    "crossComponentResources": [
                      "{Resource}"
                    ],
                    "visualization": "timechart",
                    "chartSettings": {
                      "showLegend": true,
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 5,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true
                          }
                        }
                      }
                    }
                  },
                  "customWidth": "33",
                  "conditionalVisibility": {
                    "parameterName": "Usage",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "Total Memory by User"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "letÂ system_databasesÂ =Â dynamic(['KustoMonitoringPersistentDatabase',Â '$systemdb']);Â \r\nletÂ system_usersÂ =Â dynamic(['AAD app id=b753584e-c468-4503-852a-374280ce7a62',Â 'KustoServiceBuiltInPrincipal']);Â //Â b753584e-c468-4503-852a-374280ce7a62Â isÂ Kusto Query Runner\r\nletÂ system_cluster_management_applicationsÂ =Â dynamic(['Kusto.WinSvc.CM.Svc']);Â //Â KustoÂ ClusterÂ Management\r\nlet CommandTable = ADXCommand | extend MemoryPeak = tolong(ResourceUtilization.MemoryPeak)\r\n|Â whereÂ StartedOnÂ {TimeRange}\r\n|Â whereÂ DatabaseNameÂ Â !inÂ (system_databases)Â andÂ UserÂ !inÂ (system_users)Â andÂ ApplicationNameÂ !inÂ (system_cluster_management_applications)\r\n|Â whereÂ (({include_system_operations}Â ==Â \"false\"Â andÂ ApplicationNameÂ !=Â 'Kusto.WinSvc.DM.Svc')Â orÂ {include_system_operations}Â ==Â \"true\")\r\n| parse _ResourceId with * \"providers/microsoft.kusto/clusters/\" cluster_name\r\n| project-away ResourceUtilization;\r\nlet QueryTable = ADXQuery\r\n|Â whereÂ StartedOnÂ {TimeRange}\r\n|Â whereÂ DatabaseNameÂ Â !inÂ (system_databases)Â andÂ UserÂ !inÂ (system_users)Â andÂ ApplicationNameÂ !inÂ (system_cluster_management_applications)\r\n|Â whereÂ (({include_system_operations}Â ==Â \"false\"Â andÂ ApplicationNameÂ !=Â 'Kusto.WinSvc.DM.Svc')Â orÂ {include_system_operations}Â ==Â \"true\")\r\n| extend MemoryPeak = tolong(MemoryPeak)\r\n| parse _ResourceId with * \"providers/microsoft.kusto/clusters/\" cluster_name\r\n| extend CommandType = 'Query';\r\nlet dataset_commands_queries = CommandTable | union (QueryTable)\r\n| project CommandType, DatabaseName, StartedOn, LastUpdatedOn, Duration, State,\r\nFailureReason, RootActivityId, User, ApplicationName, Principal,TotalCPU,MemoryPeak,CorrelationId,cluster_name;\r\nlet dataset = dataset_commands_queries\r\n    | where StartedOn {TimeRange}\r\n    | where cluster_name == '{Resource:name}';\r\nlet FullList = dataset | where CommandType != 'TableSetOrAppend'\r\n      | project User, ApplicationName, CommandType, StartedOn, TotalCPU\r\n      | extend User = case(ApplicationName==\"Kusto.WinSvc.DM.Svc\", strcat(\"Kusto Data Management \",\"(\",User,\")\"),\r\n    ApplicationName==\"KustoQueryRunner\", strcat(\"Kusto Query Runner \",\"(\",User,\")\"),\r\n    User==\"AAD app id=e0331ea9-83fc-4409-a17d-6375364c3280\", \"DataMap Agent 001 (app id: e0331ea9-83fc-4409-a17d-6375364c3280)\", //Â UsedÂ forÂ internalÂ MSÂ clustersÂ \r\n    User)\r\n;\r\nlet Top =\r\n    FullList\r\n    | summarize TotalCpu=sum(totimespan(TotalCPU)) by User\r\n    | top 10 by TotalCpu desc\r\n    | extend OriginalUser = User\r\n    | project OriginalUser, Category=User\r\n;\r\nFullList\r\n| join kind=leftouter(Top) on $left.User == $right.OriginalUser\r\n| project User=coalesce(Category, 'Other'), StartedOn, TotalCpuMinutes=totimespan(TotalCPU)/1m\r\n| summarize TotalCpuMinutes=sum(TotalCpuMinutes) by User, bin(StartedOn, 1h)\r\n| top-nested  of bin(StartedOn, 1h) by sum(TotalCpuMinutes),top-nested 5 of User with others=\"Other Values\" by sum_TotalCpuMinutes=sum(TotalCpuMinutes) desc | sort by StartedOn asc | project StartedOn,User,sum_TotalCpuMinutes\r\n",
                    "size": 0,
                    "aggregation": 3,
                    "showAnalytics": true,
                    "title": "Total CPU by Principal",
                    "timeContext": {
                      "durationMs": 604800000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.kusto/clusters",
                    "crossComponentResources": [
                      "{Resource}"
                    ],
                    "visualization": "timechart",
                    "chartSettings": {
                      "showLegend": true,
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 25,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true
                          }
                        }
                      }
                    }
                  },
                  "customWidth": "33",
                  "conditionalVisibility": {
                    "parameterName": "Usage",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "Total CPU by User"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "Usage",
              "comparison": "isEqualTo",
              "value": "present"
            },
            "name": "By Users",
            "styleSettings": {
              "margin": "5px 0px 0px 0px"
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Count, Memory, and CPU By Application",
              "expandable": true,
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "letÂ system_databasesÂ =Â dynamic(['KustoMonitoringPersistentDatabase',Â '$systemdb']);Â \r\nletÂ system_usersÂ =Â dynamic(['AAD app id=b753584e-c468-4503-852a-374280ce7a62',Â 'KustoServiceBuiltInPrincipal']);Â //Â b753584e-c468-4503-852a-374280ce7a62Â isÂ Kusto Query Runner\r\nletÂ system_cluster_management_applicationsÂ =Â dynamic(['Kusto.WinSvc.CM.Svc']);Â //Â KustoÂ ClusterÂ Management\r\nlet CommandTable = ADXCommand | extend MemoryPeak = tolong(ResourceUtilization.MemoryPeak)\r\n|Â whereÂ StartedOnÂ {TimeRange}\r\n|Â whereÂ DatabaseNameÂ Â !inÂ (system_databases)Â andÂ UserÂ !inÂ (system_users)Â andÂ ApplicationNameÂ !inÂ (system_cluster_management_applications)\r\n|Â whereÂ (({include_system_operations}Â ==Â \"false\"Â andÂ ApplicationNameÂ !=Â 'Kusto.WinSvc.DM.Svc')Â orÂ {include_system_operations}Â ==Â \"true\")\r\n| parse _ResourceId with * \"providers/microsoft.kusto/clusters/\" cluster_name\r\n| project-away ResourceUtilization;\r\nlet QueryTable = ADXQuery\r\n|Â whereÂ StartedOnÂ {TimeRange}\r\n|Â whereÂ DatabaseNameÂ Â !inÂ (system_databases)Â andÂ UserÂ !inÂ (system_users)Â andÂ ApplicationNameÂ !inÂ (system_cluster_management_applications)\r\n|Â whereÂ (({include_system_operations}Â ==Â \"false\"Â andÂ ApplicationNameÂ !=Â 'Kusto.WinSvc.DM.Svc')Â orÂ {include_system_operations}Â ==Â \"true\")\r\n| extend MemoryPeak = tolong(MemoryPeak)\r\n| parse _ResourceId with * \"providers/microsoft.kusto/clusters/\" cluster_name\r\n| extend CommandType = 'Query';\r\nlet dataset_commands_queries = CommandTable | union (QueryTable)\r\n| extend ApplicationName = case(ApplicationName==\"Kusto.WinSvc.DM.Svc\", \"Kusto Data Management\", ApplicationName)\r\n| project CommandType, DatabaseName, StartedOn, LastUpdatedOn, Duration, State,\r\nFailureReason, RootActivityId, User, ApplicationName, Principal,TotalCPU,MemoryPeak,CorrelationId,cluster_name;\r\nlet dataset = dataset_commands_queries\r\n    | where cluster_name == '{Resource:name}';\r\nlet FullList = dataset | where CommandType != 'TableSetOrAppend'\r\n   | project ApplicationName, StartedOn, CommandType, User\r\n;\r\nlet Top =\r\n    FullList\r\n    | summarize Count=count() by ApplicationName\r\n    | top 10 by Count desc\r\n    | extend Category=ApplicationName\r\n;\r\nFullList\r\n| join kind=leftouter(Top) on ApplicationName \r\n| project Application=coalesce(Category, '-'), CommandType, User, StartedOn\r\n| summarize count() by Application, bin(StartedOn, 1h)\r\n| summarize sum(count_) by bin(StartedOn, time(1h)),tostring(Application) | sort by StartedOn asc\r\n  ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Query Count by Application",
                    "timeContext": {
                      "durationMs": 604800000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.kusto/clusters",
                    "crossComponentResources": [
                      "{Resource}"
                    ],
                    "visualization": "timechart",
                    "chartSettings": {
                      "showLegend": true
                    }
                  },
                  "customWidth": "33",
                  "conditionalVisibility": {
                    "parameterName": "Usage",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "Query Count by Application"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "letÂ system_databasesÂ =Â dynamic(['KustoMonitoringPersistentDatabase',Â '$systemdb']);Â \r\nletÂ system_usersÂ =Â dynamic(['AAD app id=b753584e-c468-4503-852a-374280ce7a62',Â 'KustoServiceBuiltInPrincipal']);Â //Â b753584e-c468-4503-852a-374280ce7a62Â isÂ Kusto Query Runner\r\nletÂ system_cluster_management_applicationsÂ =Â dynamic(['Kusto.WinSvc.CM.Svc']);Â //Â KustoÂ ClusterÂ Management\r\nlet CommandTable = ADXCommand | extend MemoryPeak = tolong(ResourceUtilization.MemoryPeak) \r\n|Â whereÂ StartedOnÂ {TimeRange}\r\n|Â whereÂ DatabaseNameÂ Â !inÂ (system_databases)Â andÂ UserÂ !inÂ (system_users)Â andÂ ApplicationNameÂ !inÂ (system_cluster_management_applications)\r\n|Â whereÂ (({include_system_operations}Â ==Â \"false\"Â andÂ ApplicationNameÂ !=Â 'Kusto.WinSvc.DM.Svc')Â orÂ {include_system_operations}Â ==Â \"true\")\r\n| parse _ResourceId with * \"providers/microsoft.kusto/clusters/\" cluster_name\r\n| project-away ResourceUtilization;\r\nlet QueryTable = ADXQuery\r\n|Â whereÂ StartedOnÂ {TimeRange}\r\n|Â whereÂ DatabaseNameÂ Â !inÂ (system_databases)Â andÂ UserÂ !inÂ (system_users)Â andÂ ApplicationNameÂ !inÂ (system_cluster_management_applications)\r\n|Â whereÂ (({include_system_operations}Â ==Â \"false\"Â andÂ ApplicationNameÂ !=Â 'Kusto.WinSvc.DM.Svc')Â orÂ {include_system_operations}Â ==Â \"true\")\r\n| extend MemoryPeak = tolong(MemoryPeak)\r\n| parse _ResourceId with * \"providers/microsoft.kusto/clusters/\" cluster_name\r\n| extend CommandType = 'Query';\r\nlet dataset_commands_queries = CommandTable | union (QueryTable)\r\n| extend ApplicationName = case(ApplicationName==\"Kusto.WinSvc.DM.Svc\", \"Kusto Data Management\", ApplicationName)\r\n| project CommandType, DatabaseName, StartedOn, LastUpdatedOn, Duration, State,\r\nFailureReason, RootActivityId, User, ApplicationName, Principal,TotalCPU,MemoryPeak,CorrelationId,cluster_name;\r\nlet dataset = dataset_commands_queries\r\n    | where cluster_name == '{Resource:name}';\r\nlet FullList = dataset | where CommandType != 'TableSetOrAppend'\r\n   | project ApplicationName, StartedOn, CommandType, User, MemoryPeak\r\n;\r\nlet Top =\r\n    FullList\r\n   | summarize Memory=sum(MemoryPeak) by ApplicationName\r\n    | top 10 by Memory desc\r\n    | extend Category=ApplicationName;\r\nFullList\r\n| join kind=inner(Top) on ApplicationName\r\n| project Application=coalesce(Category, '-'), CommandType, User, StartedOn, MemoryPeakMB=MemoryPeak/1024.0/1024.0\r\n| summarize MemoryPeakMB=sum(MemoryPeakMB) by Application, bin(StartedOn, 1h)\r\n| summarize sum(MemoryPeakMB) by bin(StartedOn, time(1h)),tostring(Application) | sort by StartedOn asc\r\n  ",
                    "size": 0,
                    "aggregation": 3,
                    "showAnalytics": true,
                    "title": "Total Memory by Application",
                    "timeContext": {
                      "durationMs": 604800000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.kusto/clusters",
                    "crossComponentResources": [
                      "{Resource}"
                    ],
                    "visualization": "timechart",
                    "chartSettings": {
                      "showLegend": true,
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 4,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true
                          }
                        }
                      }
                    }
                  },
                  "customWidth": "33",
                  "conditionalVisibility": {
                    "parameterName": "Usage",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "Total Memory by Application"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "letÂ system_databasesÂ =Â dynamic(['KustoMonitoringPersistentDatabase',Â '$systemdb']);Â \r\nletÂ system_usersÂ =Â dynamic(['AAD app id=b753584e-c468-4503-852a-374280ce7a62',Â 'KustoServiceBuiltInPrincipal']);Â //Â b753584e-c468-4503-852a-374280ce7a62Â isÂ Kusto Query Runner\r\nletÂ system_cluster_management_applicationsÂ =Â dynamic(['Kusto.WinSvc.CM.Svc']);Â //Â KustoÂ ClusterÂ Management\r\nlet CommandTable = ADXCommand | extend MemoryPeak = tolong(ResourceUtilization.MemoryPeak)\r\n|Â whereÂ StartedOnÂ {TimeRange}\r\n|Â whereÂ DatabaseNameÂ Â !inÂ (system_databases)Â andÂ UserÂ !inÂ (system_users)Â andÂ ApplicationNameÂ !inÂ (system_cluster_management_applications)\r\n|Â whereÂ (({include_system_operations}Â ==Â \"false\"Â andÂ ApplicationNameÂ !=Â 'Kusto.WinSvc.DM.Svc')Â orÂ {include_system_operations}Â ==Â \"true\")\r\n| parse _ResourceId with * \"providers/microsoft.kusto/clusters/\" cluster_name\r\n| project-away ResourceUtilization;\r\nlet QueryTable = ADXQuery\r\n|Â whereÂ StartedOnÂ {TimeRange}\r\n|Â whereÂ DatabaseNameÂ Â !inÂ (system_databases)Â andÂ UserÂ !inÂ (system_users)Â andÂ ApplicationNameÂ !inÂ (system_cluster_management_applications)\r\n|Â whereÂ (({include_system_operations}Â ==Â \"false\"Â andÂ ApplicationNameÂ !=Â 'Kusto.WinSvc.DM.Svc')Â orÂ {include_system_operations}Â ==Â \"true\")\r\n| extend MemoryPeak = tolong(MemoryPeak)\r\n| parse _ResourceId with * \"providers/microsoft.kusto/clusters/\" cluster_name\r\n| extend CommandType = 'Query';\r\nlet dataset_commands_queries = CommandTable | union (QueryTable)\r\n| extend ApplicationName = case(ApplicationName==\"Kusto.WinSvc.DM.Svc\", \"Kusto Data Management\", ApplicationName)\r\n| project CommandType, DatabaseName, StartedOn, LastUpdatedOn, Duration, State,\r\nFailureReason, RootActivityId, User, ApplicationName, Principal,TotalCPU,MemoryPeak,CorrelationId,cluster_name;\r\nlet dataset = dataset_commands_queries\r\n    | where cluster_name == '{Resource:name}';\r\nlet FullList = dataset | where CommandType != 'TableSetOrAppend'\r\n   | project ApplicationName, CommandType, User, StartedOn, TotalCPU\r\n;\r\nlet Top =\r\n    FullList\r\n    | summarize TotalCPU=sum(totimespan(TotalCPU)) by ApplicationName\r\n    | top 10 by TotalCPU desc\r\n    | extend Category=ApplicationName\r\n;\r\nFullList\r\n| join kind=inner(Top) on ApplicationName\r\n| project Application=coalesce(Category, '-'), CommandType, User, StartedOn, TotalCpuMinutes=totimespan(TotalCPU)/1m\r\n| summarize TotalCpuMinutes=sum(TotalCpuMinutes) by Application, bin(StartedOn, 1h)\r\n| summarize sum(TotalCpuMinutes) by bin(StartedOn, time(1h)),tostring(Application) | sort by StartedOn asc\r\n  ",
                    "size": 0,
                    "aggregation": 3,
                    "showAnalytics": true,
                    "title": "Total CPU by Application",
                    "timeContext": {
                      "durationMs": 604800000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.kusto/clusters",
                    "crossComponentResources": [
                      "{Resource}"
                    ],
                    "visualization": "timechart",
                    "chartSettings": {
                      "showLegend": true,
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 25,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true
                          }
                        }
                      }
                    }
                  },
                  "customWidth": "33",
                  "conditionalVisibility": {
                    "parameterName": "Usage",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "Total CPU by Application"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "Usage",
              "comparison": "isEqualTo",
              "value": "present"
            },
            "name": "By Application"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Count, Memory, and CPU By Type",
              "expandable": true,
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "letÂ system_databasesÂ =Â dynamic(['KustoMonitoringPersistentDatabase',Â '$systemdb']);Â \r\nletÂ system_usersÂ =Â dynamic(['AAD app id=b753584e-c468-4503-852a-374280ce7a62',Â 'KustoServiceBuiltInPrincipal']);Â //Â b753584e-c468-4503-852a-374280ce7a62Â isÂ Kusto Query Runner\r\nletÂ system_cluster_management_applicationsÂ =Â dynamic(['Kusto.WinSvc.CM.Svc']);Â //Â KustoÂ ClusterÂ Management\r\nlet CommandTable = ADXCommand | extend MemoryPeak = tolong(ResourceUtilization.MemoryPeak)\r\n|Â whereÂ StartedOnÂ {TimeRange}\r\n|Â whereÂ DatabaseNameÂ Â !inÂ (system_databases)Â andÂ UserÂ !inÂ (system_users)Â andÂ ApplicationNameÂ !inÂ (system_cluster_management_applications)\r\n|Â whereÂ (({include_system_operations}Â ==Â \"false\"Â andÂ ApplicationNameÂ !=Â 'Kusto.WinSvc.DM.Svc')Â orÂ {include_system_operations}Â ==Â \"true\")\r\n| parse _ResourceId with * \"providers/microsoft.kusto/clusters/\" cluster_name\r\n| project-away ResourceUtilization;\r\nlet QueryTable = ADXQuery\r\n|Â whereÂ StartedOnÂ {TimeRange}\r\n|Â whereÂ DatabaseNameÂ Â !inÂ (system_databases)Â andÂ UserÂ !inÂ (system_users)Â andÂ ApplicationNameÂ !inÂ (system_cluster_management_applications)\r\n|Â whereÂ (({include_system_operations}Â ==Â \"false\"Â andÂ ApplicationNameÂ !=Â 'Kusto.WinSvc.DM.Svc')Â orÂ {include_system_operations}Â ==Â \"true\")\r\n| extend MemoryPeak = tolong(MemoryPeak)\r\n| parse _ResourceId with * \"providers/microsoft.kusto/clusters/\" cluster_name\r\n| extend CommandType = 'Query';\r\nlet dataset_commands_queries = CommandTable | union (QueryTable)\r\n| project CommandType, DatabaseName, StartedOn, LastUpdatedOn, Duration, State,\r\nFailureReason, RootActivityId, User, ApplicationName, Principal,TotalCPU,MemoryPeak,CorrelationId,cluster_name;\r\nlet dataset = dataset_commands_queries\r\n    | where cluster_name == '{Resource:name}';\r\ndataset | where CommandType != 'TableSetOrAppend' \r\n| top-nested  of bin(StartedOn, time(1h)) by count(),top-nested 5 of CommandType by count_=count() desc | sort by StartedOn asc | project StartedOn,CommandType,count_\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Query and Command Count by Type",
                    "timeContext": {
                      "durationMs": 604800000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.kusto/clusters",
                    "crossComponentResources": [
                      "{Resource}"
                    ],
                    "visualization": "timechart",
                    "chartSettings": {
                      "showLegend": true
                    }
                  },
                  "customWidth": "33",
                  "conditionalVisibility": {
                    "parameterName": "Usage",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "Query and Commans Count by Type"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "letÂ system_databasesÂ =Â dynamic(['KustoMonitoringPersistentDatabase',Â '$systemdb']);Â \r\nletÂ system_usersÂ =Â dynamic(['AAD app id=b753584e-c468-4503-852a-374280ce7a62',Â 'KustoServiceBuiltInPrincipal']);Â //Â b753584e-c468-4503-852a-374280ce7a62Â isÂ Kusto Query Runner\r\nletÂ system_cluster_management_applicationsÂ =Â dynamic(['Kusto.WinSvc.CM.Svc']);Â //Â KustoÂ ClusterÂ Management\r\nlet CommandTable = ADXCommand | extend MemoryPeak = tolong(ResourceUtilization.MemoryPeak) \r\n|Â whereÂ StartedOnÂ {TimeRange}\r\n|Â whereÂ DatabaseNameÂ Â !inÂ (system_databases)Â andÂ UserÂ !inÂ (system_users)Â andÂ ApplicationNameÂ !inÂ (system_cluster_management_applications)\r\n|Â whereÂ (({include_system_operations}Â ==Â \"false\"Â andÂ ApplicationNameÂ !=Â 'Kusto.WinSvc.DM.Svc')Â orÂ {include_system_operations}Â ==Â \"true\")\r\n| parse _ResourceId with * \"providers/microsoft.kusto/clusters/\" cluster_name\r\n| project-away ResourceUtilization;\r\nlet QueryTable = ADXQuery\r\n|Â whereÂ StartedOnÂ {TimeRange}\r\n|Â whereÂ DatabaseNameÂ Â !inÂ (system_databases)Â andÂ UserÂ !inÂ (system_users)Â andÂ ApplicationNameÂ !inÂ (system_cluster_management_applications)\r\n|Â whereÂ (({include_system_operations}Â ==Â \"false\"Â andÂ ApplicationNameÂ !=Â 'Kusto.WinSvc.DM.Svc')Â orÂ {include_system_operations}Â ==Â \"true\")\r\n| extend MemoryPeak = tolong(MemoryPeak)\r\n| parse _ResourceId with * \"providers/microsoft.kusto/clusters/\" cluster_name\r\n| extend CommandType = 'Query';\r\nlet dataset_commands_queries = CommandTable | union (QueryTable)\r\n| project CommandType, DatabaseName, StartedOn, LastUpdatedOn, Duration, State,\r\nFailureReason, RootActivityId, User, ApplicationName, Principal,TotalCPU,MemoryPeak,CorrelationId,cluster_name;\r\nlet dataset = dataset_commands_queries\r\n| where cluster_name == '{Resource:name}';\r\ndataset | where CommandType != 'TableSetOrAppend' \r\n| extend MemoryPeakGB=MemoryPeak/1024.0/1024.0/1024.0\r\n| top-nested  of bin(StartedOn, time(1h)) by sum(MemoryPeakGB),top-nested 5 of CommandType with others=\"Other Values\" by sum_MemoryPeakGB=sum(MemoryPeakGB) desc | sort by StartedOn asc | project StartedOn,CommandType,sum_MemoryPeakGB\r\n",
                    "size": 0,
                    "aggregation": 3,
                    "showAnalytics": true,
                    "title": "Total Memory by Type",
                    "timeContext": {
                      "durationMs": 604800000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.kusto/clusters",
                    "crossComponentResources": [
                      "{Resource}"
                    ],
                    "visualization": "timechart",
                    "chartSettings": {
                      "showLegend": true,
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 5,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true
                          }
                        }
                      }
                    }
                  },
                  "customWidth": "33",
                  "conditionalVisibility": {
                    "parameterName": "Usage",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "Total Memory by Type"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "letÂ system_databasesÂ =Â dynamic(['KustoMonitoringPersistentDatabase',Â '$systemdb']);Â \r\nletÂ system_usersÂ =Â dynamic(['AAD app id=b753584e-c468-4503-852a-374280ce7a62',Â 'KustoServiceBuiltInPrincipal']);Â //Â b753584e-c468-4503-852a-374280ce7a62Â isÂ Kusto Query Runner\r\nletÂ system_cluster_management_applicationsÂ =Â dynamic(['Kusto.WinSvc.CM.Svc']);Â //Â KustoÂ ClusterÂ Management\r\nlet CommandTable = ADXCommand | extend MemoryPeak = tolong(ResourceUtilization.MemoryPeak) \r\n|Â whereÂ StartedOnÂ {TimeRange}\r\n|Â whereÂ DatabaseNameÂ Â !inÂ (system_databases)Â andÂ UserÂ !inÂ (system_users)Â andÂ ApplicationNameÂ !inÂ (system_cluster_management_applications)\r\n|Â whereÂ (({include_system_operations}Â ==Â \"false\"Â andÂ ApplicationNameÂ !=Â 'Kusto.WinSvc.DM.Svc')Â orÂ {include_system_operations}Â ==Â \"true\")\r\n| parse _ResourceId with * \"providers/microsoft.kusto/clusters/\" cluster_name\r\n| project-away ResourceUtilization;\r\nlet QueryTable = ADXQuery\r\n|Â whereÂ StartedOnÂ {TimeRange}\r\n|Â whereÂ DatabaseNameÂ Â !inÂ (system_databases)Â andÂ UserÂ !inÂ (system_users)Â andÂ ApplicationNameÂ !inÂ (system_cluster_management_applications)\r\n|Â whereÂ (({include_system_operations}Â ==Â \"false\"Â andÂ ApplicationNameÂ !=Â 'Kusto.WinSvc.DM.Svc')Â orÂ {include_system_operations}Â ==Â \"true\")\r\n| extend MemoryPeak = tolong(MemoryPeak)\r\n| parse _ResourceId with * \"providers/microsoft.kusto/clusters/\" cluster_name\r\n| extend CommandType = 'Query';\r\nlet dataset_commands_queries = CommandTable | union (QueryTable)\r\n| project CommandType, DatabaseName, StartedOn, LastUpdatedOn, Duration, State,\r\nFailureReason, RootActivityId, User, ApplicationName, Principal,TotalCPU,MemoryPeak,CorrelationId,cluster_name;\r\nlet dataset = dataset_commands_queries\r\n    | where cluster_name == '{Resource:name}';\r\ndataset | where CommandType != 'TableSetOrAppend' \r\n| extend TotalCpuMinutes = totimespan(TotalCPU)/1m\r\n| top-nested  of bin(StartedOn, time(1h)) by sum(TotalCpuMinutes),top-nested 5 of CommandType with others=\"Other Values\" by sum_TotalCpuMinutes=sum(TotalCpuMinutes) desc | sort by StartedOn asc | project StartedOn,CommandType,sum_TotalCpuMinutes\r\n",
                    "size": 0,
                    "aggregation": 3,
                    "showAnalytics": true,
                    "title": "Total CPU by Type",
                    "timeContext": {
                      "durationMs": 604800000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.kusto/clusters",
                    "crossComponentResources": [
                      "{Resource}"
                    ],
                    "visualization": "timechart",
                    "chartSettings": {
                      "showLegend": true,
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 25,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true
                          }
                        }
                      }
                    }
                  },
                  "customWidth": "33",
                  "conditionalVisibility": {
                    "parameterName": "Usage",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "Total CPU by Type"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "Usage",
              "comparison": "isEqualTo",
              "value": "present"
            },
            "name": "By Type"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "Additional monitoring coverage is based on platform logs (diagnostic logs).</br>This tab surfaces usage telemetry on your monitored clusters to help you identify usage anomalies.</br></br>To activate additional monitoring, you must enable the \"Command\" and \"Query\" diagnostic settings and send them to Log Analytics. [Learn more](https://docs.microsoft.com/en-us/azure/data-explorer/using-diagnostic-logs?tabs=commands-and-queries#set-up-diagnostic-logs-for-an-azure-data-explorer-cluster)",
                    "style": "upsell"
                  },
                  "customWidth": "60",
                  "name": "text - 2"
                },
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "paragraph",
                    "links": [
                      {
                        "id": "00f150d5-cec6-4cfc-98ae-8b19a4a1948c",
                        "cellValue": "{Resource}",
                        "linkTarget": "Resource",
                        "linkLabel": "Configure Logs for Monitoring >",
                        "subTarget": "diagnostics",
                        "style": "primary"
                      }
                    ]
                  },
                  "customWidth": "60",
                  "name": "links - 8"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "Usage",
              "comparison": "isEqualTo",
              "value": "not present"
            },
            "name": "Onboarding Message - Commands"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "tab",
        "comparison": "isEqualTo",
        "value": "Commands"
      },
      "name": "Commands"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Table Details (Coming Soon)",
        "items": []
      },
      "name": "TablesTabMainGroup"
    }
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}
