{
    "version": "Notebook/1.0",
    "items": [
      {
        "type": 9,
        "content": {
          "version": "KqlParameterItem/1.0",
          "parameters": [
            {
              "version": "KqlParameterItem/1.0",
              "name": "Resource",
              "label": "ADX-Cluster",
              "type": 5,
              "isRequired": true,
              "isHiddenWhenLocked": true,
              "typeSettings": {
                "resourceTypeFilter": {
                  "microsoft.kusto/clusters": true
                },
                "additionalResourceOptions": [
                  "value::1"
                ],
                "showDefault": false
              },
              "defaultValue": "value::1"
            },
            {
              "version": "KqlParameterItem/1.0",
              "name": "TimeRange",
              "label": "Time range",
              "type": 4,
              "isRequired": true,
              "value": {
                "durationMs": 604800000
              },
              "isHiddenWhenLocked": true,
              "typeSettings": {
                "selectableValues": [
                  {
                    "durationMs": 900000
                  },
                  {
                    "durationMs": 1800000
                  },
                  {
                    "durationMs": 3600000
                  },
                  {
                    "durationMs": 14400000
                  },
                  {
                    "durationMs": 43200000
                  },
                  {
                    "durationMs": 86400000
                  },
                  {
                    "durationMs": 172800000
                  },
                  {
                    "durationMs": 259200000
                  },
                  {
                    "durationMs": 604800000
                  }
                ],
                "allowCustom": false
              }
            }
          ],
          "style": "pills",
          "queryType": 0,
          "resourceType": "microsoft.kusto/clusters"
        },
        "name": "parameters - 0",
        "styleSettings": {
          "margin": "15px 0 0 0"
        }
      },
      {
        "type": 9,
        "content": {
          "version": "KqlParameterItem/1.0",
          "parameters": [
            {
              "version": "KqlParameterItem/1.0",
              "name": "TableLogs",
              "type": 1,
              "isRequired": true,
              "query": "let hasNonEmptyTable = (T:string) \r\n{ \r\n   toscalar( \r\n   union isfuzzy=true \r\n   ( table(T) | where TimeGenerated > ago(30d) | take 1 | count as Count ),\r\n   (print Count=0) \r\n   | summarize sum(Count) \r\n   ) > 0\r\n};\r\nlet TableName = 'AzureMetrics';\r\nprint  IsPresent=iif(hasNonEmptyTable(TableName), \"present\", \"not present\")",
              "crossComponentResources": [
                "{Resource}"
              ],
              "isHiddenWhenLocked": true,
              "queryType": 0,
              "resourceType": "microsoft.kusto/clusters"
            },
            {
              "version": "KqlParameterItem/1.0",
              "name": "Chosen",
              "type": 1,
              "isGlobal": true
            },
            {
              "version": "KqlParameterItem/1.0",
              "name": "CpuLowThreshold",
              "type": 1,
              "query": "print 50;",
              "queryType": 0,
              "resourceType": "microsoft.kusto/clusters"
            },
            {
              "version": "KqlParameterItem/1.0",
              "name": "CpuHighThreshold",
              "type": 1,
              "query": "print 85;",
              "queryType": 0,
              "resourceType": "microsoft.kusto/clusters"
            },
            {
              "version": "KqlParameterItem/1.0",
              "name": "IngestionHighThreshold",
              "type": 1,
              "query": "print 50;",
              "queryType": 0,
              "resourceType": "microsoft.kusto/clusters"
            },
            {
              "version": "KqlParameterItem/1.0",
              "name": "CacheUtilizationHighThreshold",
              "type": 1,
              "query": "print 80;",
              "queryType": 0,
              "resourceType": "microsoft.kusto/clusters"
            }
          ],
          "style": "above",
          "queryType": 0,
          "resourceType": "microsoft.kusto/clusters"
        },
        "conditionalVisibility": {
          "parameterName": "1",
          "comparison": "isEqualTo",
          "value": "2"
        },
        "name": "parameters - 4"
      },
      {
        "type": 12,
        "content": {
          "version": "NotebookGroup/1.0",
          "groupType": "editable",
          "items": [
            {
              "type": 1,
              "content": {
                "json": "Loading",
                "style": "info"
              },
              "conditionalVisibility": {
                "parameterName": "TableLogs",
                "comparison": "isEqualTo"
              },
              "name": "Message Group Loading"
            }
          ]
        },
        "conditionalVisibility": {
          "parameterName": "TableLogs",
          "comparison": "isEqualTo"
        },
        "name": "On Boarding Message Group-Tables - Copy"
      },
      {
        "type": 12,
        "content": {
          "version": "NotebookGroup/1.0",
          "groupType": "editable",
          "items": [
            {
              "type": 1,
              "content": {
                "json": "<span style=\"font-family: Open Sans; font-weight: 420; font-size: 14px;\">\r\nIn the following tab you can observe whether your cluster is bounded by data/CPU/ingestion. These boundaries and scores are taken into account in Azure Advisor when deciding on the optimal SKU and instances count recommendation for your cluster. The data is not affected by the time range parameter.\r\n</br>\r\n</br>\r\nðŸ’¡ Select one of the utilization tiles to get more details.\r\n</span>"
              },
              "name": "Utilization tiles description"
            },
            {
              "type": 3,
              "content": {
                "version": "KqlItem/1.0",
                "query": "let low_cpu_threshold = 50;\r\nlet high_cpu_threshold = 85;\r\nlet high_cpu_precentile = 80;\r\nlet low_cpu_precentile = 90;\r\nlet high_cpu_look_back = ago(1d);\r\nlet low_cpu_look_back = ago(7d);\r\nlet end=now();\r\nlet cpu_start_time = max_of(high_cpu_look_back, low_cpu_look_back);\r\nlet ingestion_capacity_precentile = 90;\r\nlet ingestion_capacity_threshold = {IngestionHighThreshold};\r\nlet ingestion_capacity_look_back = ago(5d);\r\nlet ingestion_capacity_bin = 1h;\r\nlet cache_utilization_look_back = ago(1d);\r\nlet cache_utilization_threshold = {CacheUtilizationHighThreshold};\r\nlet CpuUsage = materialize(AzureMetrics \r\n    | where MetricName == \"CPU\"\r\n    | where TimeGenerated between(cpu_start_time..end));\r\nlet CpuUsageSeries = toscalar(CpuUsage\r\n| make-series avg(Average) on TimeGenerated from cpu_start_time to end step 1h);\r\nlet LastDayPrecentile80 = toscalar(CpuUsage\r\n    | where TimeGenerated >= high_cpu_look_back\r\n    | summarize LastDayPrecentile80=percentile(Average, high_cpu_precentile)\r\n    | project LastDayPrecentile80);\r\n// Low CPU = median of 90 precentiles of each day of the last week < 50%\r\nlet LastWeekPercentile90Median = toscalar(CpuUsage\r\n    | where TimeGenerated >= low_cpu_look_back\r\n    // For each day, calculate 90 precentile\r\n    | summarize cpu_precentile_per_day=percentile(Average, low_cpu_precentile) by bin_at(TimeGenerated, 1d, low_cpu_look_back)\r\n    // Take median of 90 precentiles calculated for each day\r\n    | summarize LastWeekPercentile90Median = percentile(cpu_precentile_per_day, 50)\r\n    | project LastWeekPercentile90Median);\r\nlet CpuTable = print CpuLastDayPrecentile80=LastDayPrecentile80, CpuLastWeekPercentile90Median=LastWeekPercentile90Median, CpuTrend=CpuUsageSeries\r\n| extend Score=case(CpuLastDayPrecentile80 >= high_cpu_threshold, \"High\", CpuLastWeekPercentile90Median < low_cpu_threshold, \"Low\", \"Medium\")\r\n| project Name=\"CPU Utilization\", Score, CpuLastDayPrecentile80, CpuLastWeekPercentile90Median, Trend=CpuTrend;\r\nlet IngestionCapacity = materialize(AzureMetrics\r\n| where TimeGenerated > ingestion_capacity_look_back\r\n| where MetricName == \"IngestionUtilization\");\r\nlet IngestionCapacitySeries = toscalar(IngestionCapacity\r\n| make-series avg(Average) on TimeGenerated from ingestion_capacity_look_back to end step ingestion_capacity_bin);\r\nlet MaxPercentile90InLast5Days = toscalar(AzureMetrics\r\n| where TimeGenerated > ingestion_capacity_look_back\r\n| where MetricName == \"IngestionUtilization\"\r\n| summarize IngestionsCapacity=percentile(Average, ingestion_capacity_precentile) by bin_at(TimeGenerated, ingestion_capacity_bin, ingestion_capacity_look_back)\r\n| summarize IngestionsCapacity = max(IngestionsCapacity));\r\nlet IngestionTable = print IngestionUtilizationTrend=IngestionCapacitySeries, IngestionUtilizationMaxPercentile90InLast5Days=MaxPercentile90InLast5Days\r\n| extend Score=case(MaxPercentile90InLast5Days > ingestion_capacity_threshold, \"High\", MaxPercentile90InLast5Days == ingestion_capacity_threshold, \"Medium\", \"Low\")\r\n| project Name=\"Ingestion Utilization\", Score, IngestionUtilizationMaxPercentile90InLast5Days, Trend=IngestionUtilizationTrend;\r\nlet cacheUtilization = materialize (AzureMetrics\r\n| where MetricName == \"CacheUtilization\"\r\n| where TimeGenerated > cache_utilization_look_back);\r\nlet cacheUtilizationSeries = toscalar(cacheUtilization\r\n| make-series avg(Average) on TimeGenerated from cache_utilization_look_back to end step 1h);\r\nlet CurrentCacheUtilization = toscalar(cacheUtilization | summarize (TimeGenerated, Average) = arg_max(TimeGenerated, Average) | project Average);\r\nlet CacheTable = print CurrentCacheUtilization=CurrentCacheUtilization, Trend=cacheUtilizationSeries\r\n| extend Score = case(CurrentCacheUtilization > cache_utilization_threshold, \"High\", CurrentCacheUtilization == cache_utilization_threshold, \"Medium\", \"Low\")\r\n| project Name=\"Cache Utilization\", Score, CurrentCacheUtilization, Trend;\r\nCpuTable | union IngestionTable | union CacheTable\r\n",
                "size": 3,
                "exportFieldName": "Name",
                "exportParameterName": "Chosen",
                "exportDefaultValue": "CPU Utilization",
                "queryType": 0,
                "resourceType": "microsoft.kusto/clusters",
                "crossComponentResources": [
                  "{Resource}"
                ],
                "visualization": "tiles",
                "tileSettings": {
                  "titleContent": {
                    "columnMatch": "Name",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Ingestion Utilization",
                          "representation": "lightBlue",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Data Utilization",
                          "representation": "lightBlue",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "lightBlue",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  "subtitleContent": {
                    "columnMatch": "Score",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "High",
                          "representation": "failed",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Medium",
                          "representation": "2",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "success",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  "secondaryContent": {
                    "columnMatch": "Trend",
                    "formatter": 9,
                    "formatOptions": {
                      "palette": "blue"
                    },
                    "tooltipFormat": {
                      "tooltip": "Trend"
                    }
                  },
                  "showBorder": false
                }
              },
              "name": "Utilization tiles query",
              "styleSettings": {
                "margin": "-60px 0px 0px 0px"
              }
            },
            {
              "type": 12,
              "content": {
                "version": "NotebookGroup/1.0",
                "groupType": "editable",
                "items": [
                  {
                    "type": 1,
                    "content": {
                      "json": "<svg viewBox=\"0 0 18 18\" width=\"20\" class=\"fxt-escapeShadow\" role=\"presentation\" focusable=\"false\" xmlns:svg=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" aria-hidden=\"true\"><g><defs></defs><path d=\"M17.5 9.44a3.85 3.85 0 0 0-3.32-3.74A4.85 4.85 0 0 0 9.23 1a5 5 0 0 0-4.75 3.29 4.58 4.58 0 0 0-4 4.46 4.66 4.66 0 0 0 4.79 4.53 3 3 0 0 0 .42 0h7.75a.64.64 0 0 0 .2 0 3.9 3.9 0 0 0 3.86-3.84z\" fill=\"url(#9b4b971a-fb5a-4299-ab97-14581e9298eb)\"></path><path d=\"M14.53 15.14l-2 2.14a.26.26 0 0 1-.44-.14l-1.21-5.9A.26.26 0 0 1 11 11l1.32-.54a.26.26 0 0 1 .33.13l1.95 4.3a.24.24 0 0 1-.07.25z\" fill=\"#37c2b1\"></path><path d=\"M8 15.14l2 2.14a.26.26 0 0 0 .44-.14l1.21-5.9a.26.26 0 0 0-.15-.28l-1.32-.54a.26.26 0 0 0-.33.13l-1.95 4.3a.24.24 0 0 0 .1.29z\" fill=\"#42e8ca\"></path><path d=\"M11.58 6l.26-.22a.41.41 0 0 1 .57.05.37.37 0 0 1 .07.12l.12.32a.42.42 0 0 0 .45.26l.33-.06a.41.41 0 0 1 .47.33.33.33 0 0 1 0 .14l-.06.33a.42.42 0 0 0 .26.45l.32.11a.42.42 0 0 1 .24.53.75.75 0 0 1-.07.12l-.22.25a.42.42 0 0 0 0 .52l.22.26a.4.4 0 0 1-.06.57.41.41 0 0 1-.11.07l-.32.12a.4.4 0 0 0-.26.45l.06.33a.39.39 0 0 1-.33.46.33.33 0 0 1-.14 0h-.33a.4.4 0 0 0-.45.26l-.12.31a.4.4 0 0 1-.52.24.37.37 0 0 1-.12-.07l-.25-.25a.4.4 0 0 0-.52 0l-.26.21a.4.4 0 0 1-.57-.05.24.24 0 0 1-.07-.12l-.12-.31a.39.39 0 0 0-.45-.26l-.33.06a.41.41 0 0 1-.47-.34.29.29 0 0 1 0-.13l.06-.33a.4.4 0 0 0-.26-.45l-.31-.12a.42.42 0 0 1-.29-.5.75.75 0 0 1 .07-.12l.22-.26a.42.42 0 0 0 0-.52l-.22-.25a.41.41 0 0 1 .06-.58.23.23 0 0 1 .12-.06l.31-.12a.42.42 0 0 0 .26-.45L8.8 7a.41.41 0 0 1 .33-.47h.14l.33.06a.41.41 0 0 0 .45-.26l.12-.33a.41.41 0 0 1 .52-.24l.12.07.26.22a.41.41 0 0 0 .51-.05z\" fill=\"#005ba1\"></path><circle cx=\"11.33\" cy=\"9.02\" r=\"2.36\" fill=\"#ffca00\"></circle></g></svg> &nbsp;<span style=\"font-family: Open Sans; font-weight: 620; font-size: 14px;font-style: bold;margin:-10px -304px 0px 0px;position: relative;top:-5px;left:-4px\">SKU/size Advisor recommendations\r\n</span> "
                    },
                    "name": "Recommendations table description"
                  },
                  {
                    "type": 1,
                    "content": {
                      "json": "In the chart below you can see the recommended size for your cluster, based on the cluster usage (CPU, ingestion and cache utilization)"
                    },
                    "name": "Recommendations table description - Copy"
                  },
                  {
                    "type": 3,
                    "content": {
                      "version": "KqlItem/1.0",
                      "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Resource:subscription}/providers/Microsoft.Advisor/recommendations\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2017-04-19\"},{\"key\":\"$filter\",\"value\":\"ResourceId eq {Resource:value} and (RecommendationTypeGuid eq '4e13bb59-a859-45b5-ab5a-19363a34084e' or RecommendationTypeGuid eq 'da4d47d5-b48b-4308-93bc-29d954424e76')\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value[*]\",\"columns\":[{\"path\":\"$.properties.shortDescription.solution\",\"columnid\":\"Description\"},{\"path\":\"$.properties.category\",\"columnid\":\"Category\"}]}}]}",
                      "size": 4,
                      "noDataMessage": "Your cluster's size is optimal!",
                      "noDataMessageStyle": 3,
                      "queryType": 12,
                      "visualization": "table",
                      "gridSettings": {
                        "formatters": [
                          {
                            "columnMatch": "Description",
                            "formatter": 0,
                            "formatOptions": {
                              "customColumnWidthSetting": "70%"
                            }
                          },
                          {
                            "columnMatch": "Category",
                            "formatter": 0,
                            "formatOptions": {
                              "customColumnWidthSetting": "30%"
                            }
                          }
                        ]
                      }
                    },
                    "name": "Advisor Sku Recommendations Table"
                  },
                  {
                    "type": 11,
                    "content": {
                      "version": "LinkItem/1.0",
                      "style": "paragraph",
                      "links": [
                        {
                          "cellValue": "{Resource}",
                          "linkTarget": "Resource",
                          "linkLabel": "Advisor recommendations page >",
                          "subTarget": "resourceadvisor",
                          "preText": "",
                          "style": "link",
                          "linkIsContextBlade": true
                        }
                      ]
                    },
                    "customWidth": "40",
                    "name": "Advisor Link",
                    "styleSettings": {
                      "margin": "0px 0px 0px 20px"
                    }
                  }
                ]
              },
              "customWidth": "50",
              "name": "SKU/size advisor recommendations",
              "styleSettings": {
                "maxWidth": "50"
              }
            },
            {
              "type": 12,
              "content": {
                "version": "NotebookGroup/1.0",
                "groupType": "editable",
                "items": [
                  {
                    "type": 1,
                    "content": {
                      "json": "<span style=\"font-family: Open Sans; font-weight: 620; font-size: 14px;font-style: bold;margin:-10px -304px 0px 0px;position: relative;\">ðŸ“ˆ CPU Utilization\r\n</span> "
                    },
                    "name": "CPU utilization title"
                  },
                  {
                    "type": 12,
                    "content": {
                      "version": "NotebookGroup/1.0",
                      "groupType": "editable",
                      "items": [
                        {
                          "type": 1,
                          "content": {
                            "json": "<span style=\"font-family: Open Sans; font-weight: 620; font-size: 14px;font-style: bold;margin:-10px -304px 0px 0px;position: relative;\">Overview\r\n</span> \r\n"
                          },
                          "customWidth": "48",
                          "name": "CPU overview title",
                          "styleSettings": {
                            "margin": "0px 20px 0px 0px",
                            "maxWidth": "48"
                          }
                        },
                        {
                          "type": 1,
                          "content": {
                            "json": "The CPU score is decided as follows:\r\n</br>\r\n</br>\r\nðŸ”´ <strong>High</strong> - If the percentile 80 of the last day is higher than {CpuHighThreshold}%\r\n</br>\r\nðŸŸ¡ <strong>Medium</strong> - If the median of the percentile 90 of the last 7 days is higher than {CpuLowThreshold}%\r\n</br>\r\nðŸŸ¢ <strong>Low</strong> - Otherwise"
                          },
                          "name": "CPU overview text"
                        },
                        {
                          "type": 3,
                          "content": {
                            "version": "KqlItem/1.0",
                            "query": "let low_cpu_threshold = {CpuLowThreshold};\r\nlet high_cpu_threshold = {CpuHighThreshold};\r\nlet high_cpu_precentile = 80;\r\nlet low_cpu_precentile = 90;\r\nlet high_cpu_look_back = ago(1d);\r\nlet low_cpu_look_back = ago(7d);\r\nlet end=now();\r\nlet cpu_start_time = max_of(high_cpu_look_back, low_cpu_look_back);\r\nlet CpuUsage = materialize(AzureMetrics \r\n    | where MetricName == \"CPU\"\r\n    | where TimeGenerated between(cpu_start_time..end));\r\nlet CpuUsageSeries = toscalar(CpuUsage\r\n| make-series avg(Average) on TimeGenerated from cpu_start_time to end step 1h);\r\nlet LastDayPrecentile80 = toscalar(CpuUsage\r\n    | where TimeGenerated >= high_cpu_look_back\r\n    | summarize LastDayPrecentile80=percentile(Average, high_cpu_precentile)\r\n    | project LastDayPrecentile80);\r\n// Low CPU = median of 90 precentiles of each day of the last week < 50%\r\nlet LastWeekPercentile90Median = toscalar(CpuUsage\r\n    | where TimeGenerated >= low_cpu_look_back\r\n    // For each day, calculate 90 precentile\r\n    | summarize cpu_precentile_per_day=percentile(Average, low_cpu_precentile) by bin_at(TimeGenerated, 1d, low_cpu_look_back)\r\n    // Take median of 90 precentiles calculated for each day\r\n    | summarize LastWeekPercentile90Median = percentile(cpu_precentile_per_day, 50)\r\n    | project LastWeekPercentile90Median);\r\nprint LastDayPrecentile80=LastDayPrecentile80, LastWeekPercentile90Median=LastWeekPercentile90Median, Trend=CpuUsageSeries\r\n| extend Score=case(LastDayPrecentile80 >= high_cpu_threshold, \"High\", LastWeekPercentile90Median < low_cpu_threshold, \"Low\", \"Medium\")\r\n| project Score, LastWeekPercentile90Median, LastDayPrecentile80, Trend",
                            "size": 4,
                            "queryType": 0,
                            "resourceType": "microsoft.kusto/clusters",
                            "crossComponentResources": [
                              "{Resource}"
                            ],
                            "visualization": "table",
                            "gridSettings": {
                              "formatters": [
                                {
                                  "columnMatch": "Score",
                                  "formatter": 18,
                                  "formatOptions": {
                                    "thresholdsOptions": "icons",
                                    "thresholdsGrid": [
                                      {
                                        "operator": "==",
                                        "thresholdValue": "Medium",
                                        "representation": "2",
                                        "text": "{0}{1}"
                                      },
                                      {
                                        "operator": "==",
                                        "thresholdValue": "High",
                                        "representation": "4",
                                        "text": "{0}{1}"
                                      },
                                      {
                                        "operator": "Default",
                                        "thresholdValue": null,
                                        "representation": "success",
                                        "text": "{0}{1}"
                                      }
                                    ]
                                  }
                                },
                                {
                                  "columnMatch": "LastWeekPercentile90Median",
                                  "formatter": 18,
                                  "formatOptions": {
                                    "thresholdsOptions": "colors",
                                    "thresholdsGrid": [
                                      {
                                        "operator": "<=",
                                        "thresholdValue": "{CpuLowThreshold}",
                                        "representation": "green",
                                        "text": "{0}{1}"
                                      },
                                      {
                                        "operator": "Default",
                                        "thresholdValue": null,
                                        "representation": "yellow",
                                        "text": "{0}{1}"
                                      }
                                    ],
                                    "compositeBarSettings": {
                                      "labelText": "",
                                      "columnSettings": [
                                        {
                                          "columnName": "LastWeekPercentile90Median",
                                          "color": "redBright"
                                        },
                                        {
                                          "columnName": "CpuBelowLowThreshold",
                                          "color": "gray"
                                        }
                                      ]
                                    },
                                    "customColumnWidthSetting": "35ch"
                                  },
                                  "numberFormat": {
                                    "unit": 1,
                                    "options": {
                                      "style": "decimal",
                                      "useGrouping": false
                                    }
                                  }
                                },
                                {
                                  "columnMatch": "LastDayPrecentile80",
                                  "formatter": 18,
                                  "formatOptions": {
                                    "thresholdsOptions": "colors",
                                    "thresholdsGrid": [
                                      {
                                        "operator": "<=",
                                        "thresholdValue": "{CpuHighThreshold}",
                                        "representation": "green",
                                        "text": "{0}{1}"
                                      },
                                      {
                                        "operator": "Default",
                                        "thresholdValue": null,
                                        "representation": "redBright",
                                        "text": "{0}{1}"
                                      }
                                    ],
                                    "compositeBarSettings": {
                                      "labelText": "",
                                      "columnSettings": [
                                        {
                                          "columnName": "LastDayPrecentile80",
                                          "color": "redBright"
                                        },
                                        {
                                          "columnName": "CpuBelowHighThreshold",
                                          "color": "gray"
                                        }
                                      ]
                                    },
                                    "customColumnWidthSetting": "35ch"
                                  },
                                  "numberFormat": {
                                    "unit": 1,
                                    "options": {
                                      "style": "decimal",
                                      "useGrouping": false
                                    }
                                  }
                                },
                                {
                                  "columnMatch": "Trend",
                                  "formatter": 9,
                                  "formatOptions": {
                                    "min": 0,
                                    "max": 100,
                                    "palette": "blue"
                                  },
                                  "tooltipFormat": {
                                    "tooltip": "CPU Trend"
                                  }
                                }
                              ],
                              "labelSettings": [
                                {
                                  "columnId": "LastWeekPercentile90Median",
                                  "label": "Last 7 days Percentile 90 Median"
                                },
                                {
                                  "columnId": "LastDayPrecentile80",
                                  "label": "Last Day Percentile 80"
                                }
                              ]
                            },
                            "sortBy": []
                          },
                          "name": "CPU utilization overview table"
                        }
                      ]
                    },
                    "name": "Cpu overview"
                  },
                  {
                    "type": 1,
                    "content": {
                      "json": "<span style=\"font-family: Open Sans; font-weight: 620; font-size: 14px;font-style: bold;margin:-10px -304px 0px 0px;position: relative;top:-5px\">CPU Utilization + Forecasting\r\n</span> \r\n"
                    },
                    "customWidth": "48",
                    "name": "CPU Utilization + Forecasting title",
                    "styleSettings": {
                      "margin": "0px 20px 0px 0px",
                      "maxWidth": "48"
                    }
                  },
                  {
                    "type": 1,
                    "content": {
                      "json": "<span style=\"font-family: Open Sans; font-weight: 620; font-size: 14px;font-style: bold;margin:-10px -304px 0px 0px;position: relative;top:-5px\">CPU percentile 90 by day\r\n</span> \r\n"
                    },
                    "customWidth": "48",
                    "name": "CPU percentile 90 by day title",
                    "styleSettings": {
                      "margin": "0px",
                      "maxWidth": "48"
                    }
                  },
                  {
                    "type": 1,
                    "content": {
                      "json": "The dark blue line in the chart below presents the CPU utilization of your cluster in the last 15 days. The orange line presents the forecast for the CPU utilization - based on your past usage and assuming weekly seasonality. By looking at the difference between the lines you can observe the outliers of the CPU usage.\r\n</br>\r\n</br>\r\nðŸ’¡ You can zoom-in by selecting a specific time range."
                    },
                    "customWidth": "48",
                    "name": "CPU Utilization + Forecasting text",
                    "styleSettings": {
                      "margin": "0px 20px 0px 0px",
                      "maxWidth": "48"
                    }
                  },
                  {
                    "type": 1,
                    "content": {
                      "json": "The bar chart below shows the percentile 90 of the CPU utilization in the last 7 days. \r\n\r\n"
                    },
                    "customWidth": "48",
                    "name": "CPU percentile 90 by day text",
                    "styleSettings": {
                      "margin": "0px",
                      "maxWidth": "48"
                    }
                  },
                  {
                    "type": 3,
                    "content": {
                      "version": "KqlItem/1.0",
                      "query": "let dt = 1h;\r\nlet seasonality = toint(7d/dt);\r\nlet future = 1d;\r\nlet lookback = 15d;\r\nAzureMetrics\r\n| where MetricName == \"CPU\"\r\n| make-series CPU=avg(Average) on TimeGenerated from ago(lookback) to (now()+future) step dt\r\n| extend series_decompose_forecast(CPU, toint(future/dt), seasonality, 'avg')\r\n| project TimeGenerated, CPU, Forecast=series_decompose_CPU_baseline",
                      "size": 0,
                      "aggregation": 3,
                      "timeContext": {
                        "durationMs": 2592000000
                      },
                      "timeBrushParameterName": "CpuSelectedTime",
                      "timeBrushExportOnlyWhenBrushed": true,
                      "queryType": 0,
                      "resourceType": "microsoft.kusto/clusters",
                      "crossComponentResources": [
                        "{Resource}"
                      ],
                      "visualization": "timechart",
                      "chartSettings": {
                        "seriesLabelSettings": [
                          {
                            "seriesName": "CPU",
                            "color": "blueDark"
                          },
                          {
                            "seriesName": "Forecast",
                            "color": "orange"
                          }
                        ],
                        "ySettings": {
                          "numberFormatSettings": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        }
                      }
                    },
                    "customWidth": "48",
                    "name": "CPU utilization + forecasting chart",
                    "styleSettings": {
                      "margin": "0px 60px 0px 0px",
                      "maxWidth": "48"
                    }
                  },
                  {
                    "type": 3,
                    "content": {
                      "version": "KqlItem/1.0",
                      "query": "AzureMetrics\r\n| where MetricName == \"CPU\"\r\n| summarize CpuPercentile90=percentile(Average, 90) by bin(TimeGenerated, 1d)\r\n| extend level=case(CpuPercentile90 >= {CpuHighThreshold}, \"High\", CpuPercentile90 >= {CpuLowThreshold}, \"Medium\", \"Low\")\r\n",
                      "size": 0,
                      "aggregation": 3,
                      "timeContext": {
                        "durationMs": 604800000
                      },
                      "exportedParameters": [
                        {
                          "parameterType": 1
                        },
                        {
                          "fieldName": "x",
                          "parameterName": "SelectedTime",
                          "parameterType": 1
                        }
                      ],
                      "queryType": 0,
                      "resourceType": "microsoft.kusto/clusters",
                      "crossComponentResources": [
                        "{Resource}"
                      ],
                      "visualization": "unstackedbar",
                      "chartSettings": {
                        "seriesLabelSettings": [
                          {
                            "seriesName": "High",
                            "color": "redBright"
                          },
                          {
                            "seriesName": "Medium",
                            "color": "yellow"
                          },
                          {
                            "seriesName": "Low",
                            "color": "green"
                          }
                        ],
                        "ySettings": {
                          "numberFormatSettings": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        }
                      }
                    },
                    "customWidth": "48",
                    "name": "CPU percentile 90 by day chart",
                    "styleSettings": {
                      "margin": "0px",
                      "maxWidth": "48"
                    }
                  },
                  {
                    "type": 12,
                    "content": {
                      "version": "NotebookGroup/1.0",
                      "groupType": "editable",
                      "title": "CPU utilization by selected time",
                      "items": [
                        {
                          "type": 1,
                          "content": {
                            "json": "In the following chart you can inspect the aaverage CPU utilization of the selected time range (with 15-minute granularity).\r\n</br>\r\n</br>\r\n<span style=\"font-family: Open Sans; font-weight: 450; font-size: 14px;\">\r\nðŸ•‘ Selected time range: {CpuSelectedTime}"
                          },
                          "name": "CPU utilization by selected time text"
                        },
                        {
                          "type": 3,
                          "content": {
                            "version": "KqlItem/1.0",
                            "query": "let dt = 15m;\r\nlet lookback = 15d;\r\nAzureMetrics\r\n| where MetricName == \"CPU\"\r\n| where TimeGenerated {CpuSelectedTime}\r\n| summarize CPU=avg(Average) by bin(TimeGenerated, dt)",
                            "size": 0,
                            "aggregation": 3,
                            "color": "blueDark",
                            "queryType": 0,
                            "resourceType": "microsoft.kusto/clusters",
                            "crossComponentResources": [
                              "{Resource}"
                            ],
                            "visualization": "timechart",
                            "chartSettings": {
                              "ySettings": {
                                "numberFormatSettings": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": true
                                  }
                                }
                              }
                            }
                          },
                          "name": "CPU utilization by selected time chart"
                        }
                      ]
                    },
                    "conditionalVisibility": {
                      "parameterName": "CpuSelectedTime",
                      "comparison": "isNotEqualTo"
                    },
                    "name": "CPU utilization by selected time"
                  }
                ]
              },
              "conditionalVisibility": {
                "parameterName": "Chosen",
                "comparison": "isEqualTo",
                "value": "CPU Utilization"
              },
              "name": "CPU Utilization"
            },
            {
              "type": 12,
              "content": {
                "version": "NotebookGroup/1.0",
                "groupType": "editable",
                "items": [
                  {
                    "type": 1,
                    "content": {
                      "json": "<span style=\"font-family: Open Sans; font-weight: 620; font-size: 14px;font-style: bold;margin:-10px -304px 0px 0px;position: relative;\">ðŸ“ˆ Ingestion Utilization\r\n</span> "
                    },
                    "name": "Ingestion utilization title"
                  },
                  {
                    "type": 12,
                    "content": {
                      "version": "NotebookGroup/1.0",
                      "groupType": "editable",
                      "items": [
                        {
                          "type": 1,
                          "content": {
                            "json": "<span style=\"font-family: Open Sans; font-weight: 620; font-size: 14px;font-style: bold;margin:-10px -304px 0px 0px;position: relative;\">Overview\r\n</span> \r\n"
                          },
                          "customWidth": "48",
                          "name": "Ingestion overview title",
                          "styleSettings": {
                            "margin": "0px 20px 0px 0px",
                            "maxWidth": "48"
                          }
                        },
                        {
                          "type": 1,
                          "content": {
                            "json": "The ingestion score is decided as follows:\r\n</br>\r\n</br>\r\nðŸ”´ <strong>High</strong> - If the percentile 90 of the last 5 days is higher than {IngestionHighThreshold}%\r\n</br>\r\nðŸŸ¡ <strong>Medium</strong> - If the percentile 90 of the last 5 days equals to {IngestionHighThreshold}%\r\n</br>\r\nðŸŸ¢ <strong>Low</strong> - Otherwise"
                          },
                          "name": "ingestion overview text"
                        },
                        {
                          "type": 3,
                          "content": {
                            "version": "KqlItem/1.0",
                            "query": "let ingestion_capacity_precentile = 90;\r\nlet ingestion_capacity_threshold = {IngestionHighThreshold};\r\nlet ingestion_capacity_look_back = ago(5d);\r\nlet ingestion_capacity_bin = 1h;\r\nlet end = now();\r\nlet IngestionCapacity = materialize(AzureMetrics\r\n| where TimeGenerated > ingestion_capacity_look_back\r\n| where MetricName == \"IngestionUtilization\");\r\nlet IngestionCapacitySeries = toscalar(IngestionCapacity\r\n| make-series avg(Average) on TimeGenerated from ingestion_capacity_look_back to end step ingestion_capacity_bin);\r\nlet MaxPercentile90InLast5Days = toscalar(AzureMetrics\r\n| where TimeGenerated > ingestion_capacity_look_back\r\n| where MetricName == \"IngestionUtilization\"\r\n| summarize IngestionsCapacity=percentile(Average, ingestion_capacity_precentile) by bin_at(TimeGenerated, ingestion_capacity_bin, ingestion_capacity_look_back)\r\n| summarize IngestionsCapacity = max(IngestionsCapacity));\r\nprint Trend=IngestionCapacitySeries, MaxPercentile90InLast5Days=MaxPercentile90InLast5Days\r\n| extend Score=case(MaxPercentile90InLast5Days > ingestion_capacity_threshold, \"High\", MaxPercentile90InLast5Days == ingestion_capacity_threshold, \"Medium\", \"Low\")\r\n| project Score, MaxPercentile90InLast5Days, Trend",
                            "size": 4,
                            "queryType": 0,
                            "resourceType": "microsoft.kusto/clusters",
                            "crossComponentResources": [
                              "{Resource}"
                            ],
                            "visualization": "table",
                            "gridSettings": {
                              "formatters": [
                                {
                                  "columnMatch": "Score",
                                  "formatter": 18,
                                  "formatOptions": {
                                    "thresholdsOptions": "icons",
                                    "thresholdsGrid": [
                                      {
                                        "operator": "==",
                                        "thresholdValue": "High",
                                        "representation": "critical",
                                        "text": "{0}{1}"
                                      },
                                      {
                                        "operator": "==",
                                        "thresholdValue": "Medium",
                                        "representation": "2",
                                        "text": "{0}{1}"
                                      },
                                      {
                                        "operator": "Default",
                                        "thresholdValue": null,
                                        "representation": "success",
                                        "text": "{0}{1}"
                                      }
                                    ]
                                  }
                                },
                                {
                                  "columnMatch": "MaxPercentile90InLast5Days",
                                  "formatter": 18,
                                  "formatOptions": {
                                    "thresholdsOptions": "colors",
                                    "thresholdsGrid": [
                                      {
                                        "operator": "<",
                                        "thresholdValue": "{IngestionHighThreshold}",
                                        "representation": "green",
                                        "text": "{0}{1}"
                                      },
                                      {
                                        "operator": "==",
                                        "thresholdValue": "{IngestionHighThreshold}",
                                        "representation": "yellow",
                                        "text": "{0}{1}"
                                      },
                                      {
                                        "operator": "Default",
                                        "thresholdValue": null,
                                        "representation": "redBright",
                                        "text": "{0}{1}"
                                      }
                                    ],
                                    "compositeBarSettings": {
                                      "labelText": "",
                                      "columnSettings": [
                                        {
                                          "columnName": "MaxPercentile90InLast5Days",
                                          "color": "redBright"
                                        },
                                        {
                                          "columnName": "IngestionBelowThreshold",
                                          "color": "gray"
                                        }
                                      ]
                                    },
                                    "customColumnWidthSetting": "35ch"
                                  },
                                  "numberFormat": {
                                    "unit": 1,
                                    "options": {
                                      "style": "decimal",
                                      "useGrouping": false
                                    }
                                  }
                                },
                                {
                                  "columnMatch": "Trend",
                                  "formatter": 9,
                                  "formatOptions": {
                                    "min": 0,
                                    "max": 100,
                                    "palette": "blue"
                                  },
                                  "tooltipFormat": {
                                    "tooltip": "Ingestion Utilization Trend"
                                  }
                                },
                                {
                                  "columnMatch": "IngestionBelowThreshold",
                                  "formatter": 5
                                }
                              ],
                              "labelSettings": [
                                {
                                  "columnId": "Score"
                                },
                                {
                                  "columnId": "MaxPercentile90InLast5Days",
                                  "label": "Max Percentile 90 in Last 5 Days"
                                },
                                {
                                  "columnId": "Trend"
                                }
                              ]
                            },
                            "sortBy": []
                          },
                          "name": "Ingestion utilization overview chart"
                        }
                      ]
                    },
                    "name": "Ingestion utilization overview group"
                  },
                  {
                    "type": 1,
                    "content": {
                      "json": "<span style=\"font-family: Open Sans; font-weight: 620; font-size: 14px;font-style: bold;margin:-10px -304px 0px 0px;position: relative;top:-5px\">Ingestion Utilization + Forecasting\r\n</span> "
                    },
                    "customWidth": "48",
                    "name": "Ingestion Utilization + Forecasting title",
                    "styleSettings": {
                      "margin": "0px 20px 0px 0px",
                      "maxWidth": "48"
                    }
                  },
                  {
                    "type": 1,
                    "content": {
                      "json": "<span style=\"font-family: Open Sans; font-weight: 620; font-size: 14px;font-style: bold;margin:-10px -304px 0px 0px;position: relative;top:-5px\">Ingestion utilization percentile 90 by day\r\n</span> "
                    },
                    "customWidth": "48",
                    "name": "Ingestion utilization percentile 90 by day title",
                    "styleSettings": {
                      "margin": "0px",
                      "maxWidth": "48"
                    }
                  },
                  {
                    "type": 1,
                    "content": {
                      "json": "The blue line in the chart below presents the ingestion utilization of your cluster in the last 15 days. The orange line presents the forecast for the ingestion utilization - based on your past usage based on your past usage and assuming weekly seasonality. By looking at the difference between the lines you can observe the outliers of the ingestion usage.\r\n</br>\r\n</br>\r\nðŸ’¡ You can zoom-in by selecting a specific time range."
                    },
                    "customWidth": "48",
                    "name": "Ingestion Utilization + Forecasting text",
                    "styleSettings": {
                      "margin": "0px 20px 0px 0px",
                      "maxWidth": "48"
                    }
                  },
                  {
                    "type": 1,
                    "content": {
                      "json": "The bar chart below shows the percentile 90 of the ingestion utilization in the last 7 days."
                    },
                    "customWidth": "48",
                    "name": "Ingestion utilization percentile 90 by day text",
                    "styleSettings": {
                      "margin": "0px",
                      "maxWidth": "48"
                    }
                  },
                  {
                    "type": 3,
                    "content": {
                      "version": "KqlItem/1.0",
                      "query": "let dt = 1h;\r\nlet seasonality = toint(7d/dt);\r\nlet future = 1d;\r\nlet lookback = 15d;\r\nAzureMetrics\r\n| where MetricName == \"IngestionUtilization\"\r\n| make-series IngestionUtilization=avg(Average) on TimeGenerated from ago(lookback) to (now()+future) step dt\r\n| extend series_decompose_forecast(IngestionUtilization, toint(future/dt), seasonality, 'linefit')\r\n| project TimeGenerated, IngestionUtilization, Forecast=series_decompose_IngestionUtilization_baseline",
                      "size": 0,
                      "aggregation": 3,
                      "timeBrushParameterName": "IngestionSelectedTime",
                      "timeBrushExportOnlyWhenBrushed": true,
                      "queryType": 0,
                      "resourceType": "microsoft.kusto/clusters",
                      "crossComponentResources": [
                        "{Resource}"
                      ],
                      "visualization": "timechart",
                      "chartSettings": {
                        "seriesLabelSettings": [
                          {
                            "seriesName": "Forecast",
                            "color": "orange"
                          },
                          {
                            "seriesName": "IngestionUtilization",
                            "color": "blueDark"
                          }
                        ],
                        "ySettings": {
                          "numberFormatSettings": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        }
                      }
                    },
                    "customWidth": "48",
                    "name": "Ingestion Utilization + Forecasting",
                    "styleSettings": {
                      "margin": "0px 20px 0px 0px",
                      "maxWidth": "48"
                    }
                  },
                  {
                    "type": 3,
                    "content": {
                      "version": "KqlItem/1.0",
                      "query": "AzureMetrics\r\n| where MetricName == \"IngestionUtilization\"\r\n| summarize IngestionUtilizationPercentile90=percentile(Average, 90) by bin(TimeGenerated, 1d)\r\n| extend level=case(IngestionUtilizationPercentile90 > {IngestionHighThreshold}, \"High\", IngestionUtilizationPercentile90 == {IngestionHighThreshold}, \"Medium\", \"Low\")\r\n",
                      "size": 0,
                      "aggregation": 3,
                      "timeContext": {
                        "durationMs": 604800000
                      },
                      "queryType": 0,
                      "resourceType": "microsoft.kusto/clusters",
                      "crossComponentResources": [
                        "{Resource}"
                      ],
                      "visualization": "unstackedbar",
                      "chartSettings": {
                        "seriesLabelSettings": [
                          {
                            "seriesName": "High",
                            "color": "redBright"
                          },
                          {
                            "seriesName": "Low",
                            "label": "",
                            "color": "green"
                          },
                          {
                            "seriesName": "Medium",
                            "color": "yellow"
                          }
                        ],
                        "ySettings": {
                          "numberFormatSettings": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        }
                      }
                    },
                    "customWidth": "48",
                    "name": "Ingestion utilization percentile 90 by day chart",
                    "styleSettings": {
                      "margin": "37px 0px 0px 0px",
                      "maxWidth": "48"
                    }
                  },
                  {
                    "type": 12,
                    "content": {
                      "version": "NotebookGroup/1.0",
                      "groupType": "editable",
                      "title": "Ingestion utilization by selected time",
                      "items": [
                        {
                          "type": 1,
                          "content": {
                            "json": "In the following chart you can inspect the average ingestion utilization of the selected time range (with 15-minute granularity).\r\n</br>\r\n</br>\r\n<span style=\"font-family: Open Sans; font-weight: 450; font-size: 14px;\">\r\nðŸ•‘ Selected time range: {IngestionSelectedTime}"
                          },
                          "name": "Ingestion utilization by selected time text"
                        },
                        {
                          "type": 3,
                          "content": {
                            "version": "KqlItem/1.0",
                            "query": "let dt = 15m;\r\nlet lookback = 15d;\r\nAzureMetrics\r\n| where MetricName == \"IngestionUtilization\"\r\n| where TimeGenerated {IngestionSelectedTime}\r\n| summarize IngestionUtilization=avg(Average) by bin(TimeGenerated, dt)",
                            "size": 0,
                            "color": "blueDark",
                            "queryType": 0,
                            "resourceType": "microsoft.kusto/clusters",
                            "crossComponentResources": [
                              "{Resource}"
                            ],
                            "visualization": "timechart"
                          },
                          "name": "Ingestion utilization by selected time chart"
                        }
                      ]
                    },
                    "conditionalVisibility": {
                      "parameterName": "IngestionSelectedTime",
                      "comparison": "isNotEqualTo"
                    },
                    "name": "Ingestion utilization by selected time"
                  }
                ]
              },
              "conditionalVisibility": {
                "parameterName": "Chosen",
                "comparison": "isEqualTo",
                "value": "Ingestion Utilization"
              },
              "name": "Ingestion Utilization"
            },
            {
              "type": 12,
              "content": {
                "version": "NotebookGroup/1.0",
                "groupType": "editable",
                "items": [
                  {
                    "type": 1,
                    "content": {
                      "json": "<span style=\"font-family: Open Sans; font-weight: 620; font-size: 14px;font-style: bold;margin:-10px -304px 0px 0px;position: relative;\">ðŸ“ˆ Cache Utilization\r\n</span> "
                    },
                    "name": "Cache utilization title"
                  },
                  {
                    "type": 12,
                    "content": {
                      "version": "NotebookGroup/1.0",
                      "groupType": "editable",
                      "items": [
                        {
                          "type": 1,
                          "content": {
                            "json": "<span style=\"font-family: Open Sans; font-weight: 620; font-size: 14px;font-style: bold;margin:-10px -304px 0px 0px;position: relative;\">Overview\r\n</span> \r\n"
                          },
                          "customWidth": "48",
                          "name": "Cache overview title",
                          "styleSettings": {
                            "margin": "0px 20px 0px 0px",
                            "maxWidth": "48"
                          }
                        },
                        {
                          "type": 1,
                          "content": {
                            "json": "The cache utilization score is decided as follows:\r\n</br>\r\n</br>\r\nðŸ”´ <strong>High</strong> - If the cache utilization is higher than {CacheUtilizationHighThreshold}%\r\n</br>\r\nðŸŸ¡ <strong>Medium</strong> - If the cache utilization equals to {CacheUtilizationHighThreshold}%\r\n</br>\r\nðŸŸ¢ <strong>Low</strong> - Otherwise"
                          },
                          "name": "Cache utilization overview text"
                        },
                        {
                          "type": 3,
                          "content": {
                            "version": "KqlItem/1.0",
                            "query": "let cache_utilization_look_back = ago(1d);\r\nlet cache_utilization_threshold = {CacheUtilizationHighThreshold};\r\nlet end = now();\r\nlet cacheUtilization = materialize (AzureMetrics\r\n| where MetricName == \"CacheUtilization\"\r\n| where TimeGenerated > cache_utilization_look_back);\r\nlet cacheUtilizationSeries = toscalar(cacheUtilization\r\n| make-series avg(Average) on TimeGenerated from cache_utilization_look_back to end step 1h);\r\nlet CurrentCacheUtilization = toscalar(cacheUtilization | summarize (TimeGenerated, Average) = arg_max(TimeGenerated, Average) | project Average);\r\nprint CurrentCacheUtilization=CurrentCacheUtilization, Trend=cacheUtilizationSeries\r\n| extend Score = case(CurrentCacheUtilization > cache_utilization_threshold, \"High\", CurrentCacheUtilization == cache_utilization_threshold, \"Medium\", \"Low\")\r\n| project Score, CurrentCacheUtilization, Trend",
                            "size": 4,
                            "queryType": 0,
                            "resourceType": "microsoft.kusto/clusters",
                            "crossComponentResources": [
                              "{Resource}"
                            ],
                            "visualization": "table",
                            "gridSettings": {
                              "formatters": [
                                {
                                  "columnMatch": "Score",
                                  "formatter": 18,
                                  "formatOptions": {
                                    "thresholdsOptions": "icons",
                                    "thresholdsGrid": [
                                      {
                                        "operator": "==",
                                        "thresholdValue": "High",
                                        "representation": "4",
                                        "text": "{0}{1}"
                                      },
                                      {
                                        "operator": "==",
                                        "thresholdValue": "Medium",
                                        "representation": "2",
                                        "text": "{0}{1}"
                                      },
                                      {
                                        "operator": "Default",
                                        "thresholdValue": null,
                                        "representation": "success",
                                        "text": "{0}{1}"
                                      }
                                    ]
                                  }
                                },
                                {
                                  "columnMatch": "CurrentCacheUtilization",
                                  "formatter": 18,
                                  "formatOptions": {
                                    "thresholdsOptions": "colors",
                                    "thresholdsGrid": [
                                      {
                                        "operator": "<",
                                        "thresholdValue": "{CacheUtilizationHighThreshold}",
                                        "representation": "green",
                                        "text": "{0}{1}"
                                      },
                                      {
                                        "operator": "==",
                                        "thresholdValue": "{CacheUtilizationHighThreshold}",
                                        "representation": "yellow",
                                        "text": "{0}{1}"
                                      },
                                      {
                                        "operator": "Default",
                                        "thresholdValue": null,
                                        "representation": "redBright",
                                        "text": "{0}{1}"
                                      }
                                    ],
                                    "compositeBarSettings": {
                                      "labelText": "",
                                      "columnSettings": [
                                        {
                                          "columnName": "CurrentDataUtilization",
                                          "color": "redBright"
                                        },
                                        {
                                          "columnName": "DataBelowThreshold",
                                          "color": "gray"
                                        }
                                      ]
                                    },
                                    "customColumnWidthSetting": "35ch"
                                  },
                                  "numberFormat": {
                                    "unit": 1,
                                    "options": {
                                      "style": "decimal",
                                      "useGrouping": false
                                    }
                                  }
                                },
                                {
                                  "columnMatch": "Trend",
                                  "formatter": 9,
                                  "formatOptions": {
                                    "palette": "blue"
                                  },
                                  "tooltipFormat": {
                                    "tooltip": "Cache Utilization Trend"
                                  }
                                },
                                {
                                  "columnMatch": "DataBelowThreshold",
                                  "formatter": 5
                                }
                              ],
                              "labelSettings": [
                                {
                                  "columnId": "Score"
                                },
                                {
                                  "columnId": "CurrentCacheUtilization",
                                  "label": "Current Cache Utilization (Last)"
                                },
                                {
                                  "columnId": "Trend"
                                }
                              ]
                            },
                            "sortBy": []
                          },
                          "name": "Cache utilization overview table"
                        }
                      ]
                    },
                    "name": "Cache Utilization Overview"
                  },
                  {
                    "type": 1,
                    "content": {
                      "json": "<span style=\"font-family: Open Sans; font-weight: 620; font-size: 14px;font-style: bold;margin:-10px -304px 0px 0px;position: relative;top:-5px\">Cache Utilization by Day\r\n</span> "
                    },
                    "customWidth": "48",
                    "name": "Cache Utilization by Day title",
                    "styleSettings": {
                      "margin": "0px 20px 0px 0px",
                      "maxWidth": "48"
                    }
                  },
                  {
                    "type": 1,
                    "content": {
                      "json": "<span style=\"font-family: Open Sans; font-weight: 620; font-size: 14px;font-style: bold;margin:-10px -304px 0px 0px;position: relative;top:-5px\">Cache Utilization Change by Day\r\n</span> "
                    },
                    "customWidth": "48",
                    "name": "Cache Utilization Change by Day title",
                    "styleSettings": {
                      "margin": "0px",
                      "maxWidth": "48"
                    }
                  },
                  {
                    "type": 1,
                    "content": {
                      "json": "The chart below demonstrates the average cache utilization of each day in the last month"
                    },
                    "customWidth": "48",
                    "name": "Cache Utilization by Day text",
                    "styleSettings": {
                      "margin": "0px 20px 0px 0px",
                      "maxWidth": "48"
                    }
                  },
                  {
                    "type": 1,
                    "content": {
                      "json": "The chart below shows the increase / decrease of the cache utilization in each day of the last month"
                    },
                    "customWidth": "48",
                    "name": "Cache Utilization Change by Day text",
                    "styleSettings": {
                      "margin": "0px",
                      "maxWidth": "48"
                    }
                  },
                  {
                    "type": 3,
                    "content": {
                      "version": "KqlItem/1.0",
                      "query": "AzureMetrics\r\n| where MetricName == \"CacheUtilization\"\r\n| summarize CacheUtilization=avg(Average) by bin(TimeGenerated, 1d) \r\n| extend CacheUtilizationBar=case(CacheUtilization > {CacheUtilizationHighThreshold}, \"High\", CacheUtilization == {CacheUtilizationHighThreshold}, \"Medium\", \"Low\")\r\n",
                      "size": 0,
                      "aggregation": 5,
                      "timeContext": {
                        "durationMs": 2592000000
                      },
                      "queryType": 0,
                      "resourceType": "microsoft.kusto/clusters",
                      "visualization": "barchart",
                      "chartSettings": {
                        "seriesLabelSettings": [
                          {
                            "seriesName": "High",
                            "color": "redBright"
                          },
                          {
                            "seriesName": "Medium",
                            "color": "yellow"
                          },
                          {
                            "seriesName": "Low",
                            "color": "green"
                          }
                        ],
                        "ySettings": {
                          "numberFormatSettings": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        }
                      }
                    },
                    "customWidth": "48",
                    "name": "Cache Utilization by Day Chart",
                    "styleSettings": {
                      "margin": "0px 20px 0px 0px",
                      "maxWidth": "48"
                    }
                  },
                  {
                    "type": 3,
                    "content": {
                      "version": "KqlItem/1.0",
                      "query": "AzureMetrics\r\n| where MetricName == \"CacheUtilization\"\r\n| project TimeGenerated, CacheUtilization=Average\r\n| summarize CacheUtilization=avg(CacheUtilization) by bin(TimeGenerated, 1d)\r\n| sort by TimeGenerated asc \r\n| serialize \r\n| extend PrevCacheUtilization = prev(CacheUtilization,1)\r\n| extend CacheUtilizationDelta = CacheUtilization - PrevCacheUtilization\r\n| project TimeGenerated, CacheUtilizationDelta\r\n| extend change=iff(CacheUtilizationDelta >= 0, \"Positive\", \"Negative\")\r\n",
                      "size": 0,
                      "aggregation": 3,
                      "timeContext": {
                        "durationMs": 2592000000
                      },
                      "queryType": 0,
                      "resourceType": "microsoft.kusto/clusters",
                      "crossComponentResources": [
                        "{Resource}"
                      ],
                      "visualization": "barchart",
                      "chartSettings": {
                        "seriesLabelSettings": [
                          {
                            "seriesName": "Positive",
                            "color": "greenDark"
                          },
                          {
                            "seriesName": "Negative",
                            "color": "red"
                          }
                        ],
                        "ySettings": {
                          "numberFormatSettings": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": true
                            }
                          }
                        }
                      }
                    },
                    "customWidth": "48",
                    "name": "Cache utilization change by day chart",
                    "styleSettings": {
                      "maxWidth": "48"
                    }
                  }
                ]
              },
              "conditionalVisibility": {
                "parameterName": "Chosen",
                "comparison": "isEqualTo",
                "value": "Cache Utilization"
              },
              "name": "Cache Utilization"
            }
          ]
        },
        "conditionalVisibility": {
          "parameterName": "TableLogs",
          "comparison": "isEqualTo",
          "value": "present"
        },
        "name": "Cluster boundaries - all"
      },
      {
        "type": 12,
        "content": {
          "version": "NotebookGroup/1.0",
          "groupType": "editable",
          "items": [
            {
              "type": 1,
              "content": {
                "json": "This section provides additional monitoring coverage that is based on platform logs (diagnostic logs).</br></br>If you have not activated additional monitoring, you must enable the **AzureMetrics** platform logs and send them to a Log Analytics workspace. [Learn more](https://docs.microsoft.com/en-us/azure/data-explorer/using-diagnostic-logs?tabs=commands-and-queries#set-up-diagnostic-logs-for-an-azure-data-explorer-cluster)",
                "style": "upsell"
              },
              "customWidth": "60",
              "name": "text - 2"
            },
            {
              "type": 11,
              "content": {
                "version": "LinkItem/1.0",
                "style": "paragraph",
                "links": [
                  {
                    "cellValue": "{Resource}",
                    "linkTarget": "Resource",
                    "linkLabel": "Configure Logs for Monitoring >",
                    "subTarget": "diagnostics",
                    "style": "primary"
                  }
                ]
              },
              "customWidth": "60",
              "name": "links - 8"
            }
          ]
        },
        "conditionalVisibility": {
          "parameterName": "TableLogs",
          "comparison": "isEqualTo",
          "value": "not present"
        },
        "name": "Onboarding Message - Commands"
      },
      {
        "type": 1,
        "content": {
          "json": "<img src=\"https://raw.githubusercontent.com/microsoft/Application-Insights-Workbooks/master/Documentation/Images/ADXClusterBoundariesSample.png\" alt=\"Sample image is unavailable\" style=\"width:1250px;\"/>"
        },
        "conditionalVisibility": {
          "parameterName": "TableLogs",
          "comparison": "isEqualTo",
          "value": "not present"
        },
        "name": "sample image"
      }
    ],
    "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
  }
