{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "## Compliance Over Time (Preview)"
      },
      "name": "main header"
    },
    {
      "type": 1,
      "content": {
        "json": "<svg viewBox=\"0 0 19 19\" width=\"20\" class=\"fxt-escapeShadow\" role=\"presentation\" focusable=\"false\" xmlns:svg=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" aria-hidden=\"true\"><g><path fill=\"#1b93eb\" d=\"M16.82 8.886c0 4.81-5.752 8.574-7.006 9.411a.477.477 0 01-.523 0C8.036 17.565 2.18 13.7 2.18 8.886V3.135a.451.451 0 01.42-.419C7.2 2.612 6.154.625 9.5.625s2.3 1.987 6.8 2.091a.479.479 0 01.523.419z\"></path><path fill=\"url(#0024423711759027356)\" d=\"M16.192 8.99c0 4.392-5.333 7.947-6.483 8.575a.319.319 0 01-.418 0c-1.15-.732-6.483-4.183-6.483-8.575V3.762a.575.575 0 01.313-.523C7.2 3.135 6.258 1.357 9.4 1.357s2.2 1.882 6.274 1.882a.45.45 0 01.419.418z\"></path><path d=\"M9.219 5.378a.313.313 0 01.562 0l.875 1.772a.314.314 0 00.236.172l1.957.284a.314.314 0 01.174.535l-1.416 1.38a.312.312 0 00-.09.278l.334 1.949a.313.313 0 01-.455.33l-1.75-.92a.314.314 0 00-.292 0l-1.75.92a.313.313 0 01-.455-.33L7.483 9.8a.312.312 0 00-.09-.278L5.977 8.141a.314.314 0 01.174-.535l1.957-.284a.314.314 0 00.236-.172z\" class=\"msportalfx-svg-c01\"></path></g></svg>&nbsp;<span style=\"font-family: Open Sans; font-weight: 620; font-size: 14px;font-style: bold;margin:-10px 0px 0px 0px;position: relative;top:-3px;left:-4px;\"> Please take time to answer a quick survey,\r\n</span>[<span style=\"font-family: Open Sans; font-weight: 620; font-size: 14px;font-style: bold;margin:-10px 0px 0px 0px;position: relative;top:-3px;left:-4px;\"> click here. </span>](https://forms.office.com/Pages/ResponsePage.aspx?id=v4j5cvGGr0GRqy180BHbR5-vtbgsWaZMonXEayi7Oq1UOU5KNkE0WFRCWkI4TVpINzNJV1pUVVowRi4u)"
      },
      "name": "survey "
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "value::selected"
        ],
        "parameters": [
          {
            "id": "7f6612ea-3298-4ba3-965c-cd8b16eacb81",
            "version": "KqlParameterItem/1.0",
            "name": "Workspace",
            "type": 5,
            "description": "Select at least one workspace that contains continuous export data based on the selected subscriptions",
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "resources\r\n| where type == \"microsoft.security/automations\"\r\n| where name == \"ExportToWorkspace\"\r\n| extend workspace = tostring(properties.actions.[0].workspaceResourceId)\r\n| distinct workspace",
            "crossComponentResources": [
              "value::selected"
            ],
            "value": [],
            "typeSettings": {
              "resourceTypeFilter": {
                "microsoft.operationalinsights/workspaces": true
              },
              "additionalResourceOptions": [
                "value::all"
              ],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "febecfa4-b808-41e0-bdeb-1ec5d96b8f5c",
            "version": "KqlParameterItem/1.0",
            "name": "Subscription",
            "type": 6,
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "SecurityRegulatoryCompliance \r\n|where IsSnapshot == true \r\n| distinct RegulatoryComplianceSubscriptionId",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "value": [],
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 2592000000
            },
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "da1c295c-5f3c-4810-95db-94591697e3f1",
            "version": "KqlParameterItem/1.0",
            "name": "error",
            "type": 1,
            "query": "let MissingTable = view () { print isMissing=1 };\r\nunion isfuzzy=true MissingTable, (SecurityRegulatoryCompliance | getschema | summarize c=count() | project isMissing=iff(c > 0, 0, 1))\r\n| top 1 by isMissing asc",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "isHiddenWhenLocked": true,
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          }
        ],
        "style": "above",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources"
      },
      "name": "main parameters"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "parameters": [
                {
                  "id": "94b28f2b-3595-433c-ba83-efaceef3e8b4",
                  "version": "KqlParameterItem/1.0",
                  "name": "standard_name",
                  "label": "Standard name",
                  "type": 2,
                  "isRequired": true,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "securityresources\r\n| where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n| extend standardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n| distinct standardId",
                  "crossComponentResources": [
                    "{Subscription}"
                  ],
                  "value": [],
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "showDefault": false
                  },
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources"
                }
              ],
              "style": "above",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources"
            },
            "name": "parameters - 0"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "<svg viewBox=\"0 0 19 19\" width=\"20\" class=\"fxt-escapeShadow\" role=\"presentation\" focusable=\"false\" xmlns:svg=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" aria-hidden=\"true\"><g><path fill=\"#1b93eb\" d=\"M16.82 8.886c0 4.81-5.752 8.574-7.006 9.411a.477.477 0 01-.523 0C8.036 17.565 2.18 13.7 2.18 8.886V3.135a.451.451 0 01.42-.419C7.2 2.612 6.154.625 9.5.625s2.3 1.987 6.8 2.091a.479.479 0 01.523.419z\"></path><path fill=\"url(#0024423711759027356)\" d=\"M16.192 8.99c0 4.392-5.333 7.947-6.483 8.575a.319.319 0 01-.418 0c-1.15-.732-6.483-4.183-6.483-8.575V3.762a.575.575 0 01.313-.523C7.2 3.135 6.258 1.357 9.4 1.357s2.2 1.882 6.274 1.882a.45.45 0 01.419.418z\"></path><path d=\"M9.219 5.378a.313.313 0 01.562 0l.875 1.772a.314.314 0 00.236.172l1.957.284a.314.314 0 01.174.535l-1.416 1.38a.312.312 0 00-.09.278l.334 1.949a.313.313 0 01-.455.33l-1.75-.92a.314.314 0 00-.292 0l-1.75.92a.313.313 0 01-.455-.33L7.483 9.8a.312.312 0 00-.09-.278L5.977 8.141a.314.314 0 01.174-.535l1.957-.284a.314.314 0 00.236-.172z\" class=\"msportalfx-svg-c01\"></path></g></svg>&nbsp;<span style=\"font-family: Open Sans; font-weight: 620; font-size: 14px;font-style: bold;margin:-10px -304px 0px 0px;position: relative;top:-5px\"> Regulatory compliance overview\r\n</span>"
                  },
                  "customWidth": "50",
                  "name": "compliance overview title"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "<svg viewBox=\"0 0 19 19\" width=\"20\" class=\"fxt-escapeShadow\" role=\"presentation\" focusable=\"false\" xmlns:svg=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" aria-hidden=\"true\"><g><path fill=\"#1b93eb\" d=\"M16.82 8.886c0 4.81-5.752 8.574-7.006 9.411a.477.477 0 01-.523 0C8.036 17.565 2.18 13.7 2.18 8.886V3.135a.451.451 0 01.42-.419C7.2 2.612 6.154.625 9.5.625s2.3 1.987 6.8 2.091a.479.479 0 01.523.419z\"></path><path fill=\"url(#0024423711759027356)\" d=\"M16.192 8.99c0 4.392-5.333 7.947-6.483 8.575a.319.319 0 01-.418 0c-1.15-.732-6.483-4.183-6.483-8.575V3.762a.575.575 0 01.313-.523C7.2 3.135 6.258 1.357 9.4 1.357s2.2 1.882 6.274 1.882a.45.45 0 01.419.418z\"></path><path d=\"M9.219 5.378a.313.313 0 01.562 0l.875 1.772a.314.314 0 00.236.172l1.957.284a.314.314 0 01.174.535l-1.416 1.38a.312.312 0 00-.09.278l.334 1.949a.313.313 0 01-.455.33l-1.75-.92a.314.314 0 00-.292 0l-1.75.92a.313.313 0 01-.455-.33L7.483 9.8a.312.312 0 00-.09-.278L5.977 8.141a.314.314 0 01.174-.535l1.957-.284a.314.314 0 00.236-.172z\" class=\"msportalfx-svg-c01\"></path></g></svg>&nbsp;<span style=\"font-family: Open Sans; font-weight: 620; font-size: 14px;font-style: bold;margin:-10px 0px 0px 0px;position: relative;top:-3px;left:-4px;\"> Regulatory compliance passsed controls over time (weekly)\r\n</span>"
                  },
                  "customWidth": "50",
                  "name": "standards over time title"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "\r\nlet startOfToday = startofday(now()); \r\nlet offsetWeek = 6d; \r\nlet endTimeWeek = startOfToday - offsetWeek; \r\nlet offsetMonth = 29d;\r\nlet endTimeMonth = startOfToday - offsetMonth; \r\nlet snapShots = SecurityRegulatoryCompliance \r\n| where IsSnapshot == true \r\n| extend Day = startofday(TimeGenerated)\r\n| summarize day_snapshot = max(TimeGenerated), week_snapshot = maxif(TimeGenerated, TimeGenerated <=  endTimeWeek), month_snapshot = maxif(TimeGenerated, TimeGenerated <=  endTimeMonth) by RegulatoryComplianceSubscriptionId, ComplianceStandard;\r\n\r\n\r\nlet relevantStandard = SecurityRegulatoryCompliance \r\n| where  RegulatoryComplianceSubscriptionId in ({Subscription:subid})\r\n| extend standardName = replace('-', ' ',ComplianceStandard)\r\n| where standardName in~ ({standard_name})\r\n| extend Day = startofday(TimeGenerated)\r\n| join kind = leftouter (snapShots) on RegulatoryComplianceSubscriptionId, ComplianceStandard;\r\n\r\n// current image\r\nlet curr =  relevantStandard\r\n| where (IsSnapshot == true and Day == startofday(day_snapshot)) or (IsSnapshot == false and TimeGenerated > day_snapshot) \r\n| summarize arg_max(TimeGenerated, *) by ComplianceStandard, ComplianceControl, RecommendationId, RegulatoryComplianceSubscriptionId \r\n| summarize failed_ass = countif(State == \"Failed\"), skipped_ass = countif(State == \"Skipped\"), passed_ass = countif(State == \"Passed\") by ComplianceStandard, ComplianceControl \r\n| summarize passed = countif(failed_ass == 0 and (skipped_ass == 0 or (passed_ass > 0 and skipped_ass > 0))), total_controls_curr = count(), skipped = countif(failed_ass == 0 and skipped_ass > 0 and passed_ass == 0), failed = countif(failed_ass > 0) by ComplianceStandard \r\n| extend ratio_curr = (passed/todouble(total_controls_curr))*100; \r\n\r\n\r\n// last week image\r\nlet last_week = relevantStandard \r\n| where (IsSnapshot == true and Day == startofday(week_snapshot)) or (IsSnapshot == false and TimeGenerated > week_snapshot and Day <= endTimeWeek) \r\n| summarize arg_max(TimeGenerated, *) by ComplianceStandard, ComplianceControl, RecommendationId, RegulatoryComplianceSubscriptionId \r\n| summarize failed_ass = countif(State == \"Failed\"), skipped_ass = countif(State == \"Skipped\"), passed_ass = countif(State == \"Passed\") by ComplianceStandard, ComplianceControl \r\n| summarize passed = countif(failed_ass == 0 and (skipped_ass == 0 or (passed_ass > 0 and skipped_ass > 0))),total_controls_week = count(), skipped = countif(failed_ass == 0 and skipped_ass > 0 and passed_ass == 0), failed = countif(failed_ass > 0) by ComplianceStandard \r\n| extend ratio_week = (passed/todouble(total_controls_week))*100; \r\n\r\n// last month image\r\nlet last_month = relevantStandard \r\n| where (IsSnapshot == true and Day == startofday(month_snapshot)) or (IsSnapshot == false and TimeGenerated > month_snapshot and Day <= endTimeMonth) \r\n| summarize arg_max(TimeGenerated, *) by ComplianceStandard, ComplianceControl, RecommendationId, RegulatoryComplianceSubscriptionId \r\n| summarize failed_ass = countif(State == \"Failed\"), skipped_ass = countif(State == \"Skipped\"), passed_ass = countif(State == \"Passed\") by ComplianceStandard, ComplianceControl \r\n| summarize passed = countif(failed_ass == 0 and (skipped_ass == 0 or (passed_ass > 0 and skipped_ass > 0))),total_controls_month = count(), skipped = countif(failed_ass == 0 and skipped_ass > 0 and passed_ass == 0), failed = countif(failed_ass > 0) by ComplianceStandard \r\n| extend ratio_month = (passed/todouble(total_controls_month))*100; \r\n\r\ncurr\r\n|join kind = leftouter (last_week) on ComplianceStandard\r\n| join kind = leftouter (last_month) on ComplianceStandard\r\n| extend diffWeek = (ratio_curr - ratio_week)\r\n| extend diffMonth = (ratio_curr - ratio_month)\r\n| project ComplianceStandard, total_controls_curr, passed, skipped, failed, ratio_curr,  diffWeek, diffMonth\r\n| order by ratio_curr asc",
                    "size": 0,
                    "exportFieldName": "ComplianceStandard",
                    "exportParameterName": "ComplianceStandard",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "ComplianceStandard",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "total_controls_curr",
                          "formatter": 22,
                          "formatOptions": {
                            "compositeBarSettings": {
                              "labelText": "[\"passed\"]/[\"total_controls_curr\"]",
                              "columnSettings": [
                                {
                                  "columnName": "passed",
                                  "color": "green"
                                },
                                {
                                  "columnName": "skipped",
                                  "color": "gray"
                                },
                                {
                                  "columnName": "failed",
                                  "color": "redBright"
                                }
                              ]
                            },
                            "customColumnWidthSetting": "25ch"
                          },
                          "tooltipFormat": {
                            "tooltip": "sadsad"
                          }
                        },
                        {
                          "columnMatch": "passed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "skipped",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "failed",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "ratio_curr",
                          "formatter": 4,
                          "formatOptions": {
                            "min": 0,
                            "max": 100,
                            "palette": "redGreen",
                            "compositeBarSettings": {
                              "labelText": "",
                              "columnSettings": []
                            },
                            "customColumnWidthSetting": "25ch"
                          },
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 3
                            }
                          }
                        },
                        {
                          "columnMatch": "diffWeek",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "<",
                                "thresholdValue": "0",
                                "representation": "trenddown",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": ">",
                                "thresholdValue": "0",
                                "representation": "trendup",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "is Empty",
                                "representation": "more",
                                "text": "N/A"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "0",
                                "representation": "Blank",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Unknown",
                                "text": "{0}{1}"
                              }
                            ],
                            "customColumnWidthSetting": "20ch"
                          },
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumSignificantDigits": 2
                            }
                          },
                          "tooltipFormat": {
                            "tooltip": "diffrence in passed controls percentages between now and 7 days ago"
                          }
                        },
                        {
                          "columnMatch": "diffMonth",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "<",
                                "thresholdValue": "0",
                                "representation": "trenddown",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": ">",
                                "thresholdValue": "0",
                                "representation": "trendup",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "is Empty",
                                "representation": "more",
                                "text": "N/A"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "0",
                                "representation": "Blank",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "unknown",
                                "text": "{0}{1}"
                              }
                            ],
                            "customColumnWidthSetting": "20ch"
                          },
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "maximumSignificantDigits": 2
                            }
                          },
                          "tooltipFormat": {
                            "tooltip": "diffrence in passed controls percentages between now and 30 days ago"
                          }
                        },
                        {
                          "columnMatch": "ComplianceStandard1",
                          "formatter": 5,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "",
                            "bladeOpenContext": {
                              "bladeParameters": [
                                {
                                  "name": "",
                                  "source": "parameter",
                                  "value": ""
                                }
                              ]
                            }
                          }
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "ComplianceStandard",
                          "label": "Compliance regulatory standards​"
                        },
                        {
                          "columnId": "total_controls_curr",
                          "label": "Passed controls"
                        },
                        {
                          "columnId": "passed"
                        },
                        {
                          "columnId": "skipped"
                        },
                        {
                          "columnId": "failed"
                        },
                        {
                          "columnId": "ratio_curr",
                          "label": "Passed controls %"
                        },
                        {
                          "columnId": "diffWeek",
                          "label": "7-day change"
                        },
                        {
                          "columnId": "diffMonth",
                          "label": "30-day change"
                        }
                      ]
                    },
                    "sortBy": []
                  },
                  "customWidth": "50",
                  "name": "standards over time grid"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "//last snapshots from past weeks\r\nSecurityRegulatoryCompliance \r\n| where IsSnapshot == true\r\n| where RegulatoryComplianceSubscriptionId in ({Subscription:subid})\r\n| extend standardName = replace('-', ' ',ComplianceStandard )\r\n| where standardName in ({standard_name})\r\n| extend week = startofweek(TimeGenerated) \r\n| summarize arg_max(TimeGenerated, *) by ComplianceStandard, ComplianceControl, RecommendationId, RegulatoryComplianceSubscriptionId, week\r\n| summarize failed_ass = countif(State == \"Failed\"), skipped_ass = countif(State == \"Skipped\"), passed_ass = countif(State == \"Passed\") by ComplianceStandard, ComplianceControl, week\r\n| summarize passed_controls = countif(failed_ass == 0 and (skipped_ass == 0 or passed_ass > 0)), total_controls = count() by ComplianceStandard, week\r\n| extend ratio = (passed_controls/ todouble(total_controls))*100\r\n| project week, ComplianceStandard, ratio",
                    "size": 0,
                    "aggregation": 5,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "timechart",
                    "chartSettings": {
                      "xAxis": "week",
                      "showLegend": true,
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 1,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true,
                            "maximumSignificantDigits": 4
                          }
                        },
                        "min": 0,
                        "max": 100
                      }
                    }
                  },
                  "customWidth": "50",
                  "showPin": true,
                  "name": "standards over time graph"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "To view changes over time on a specific standard, please select any from the list above.",
                          "style": "info"
                        },
                        "customWidth": "100",
                        "conditionalVisibility": {
                          "parameterName": "ComplianceStandard",
                          "comparison": "isEqualTo"
                        },
                        "name": "standard drill down",
                        "styleSettings": {
                          "margin": "5px"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "securityresources\r\n| where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n| extend standardName = extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id)\r\n| where standardName == '{ComplianceStandard}'\r\n| extend dim = parse_json(properties)\r\n| extend description = dim[\"description\"]\r\n| extend nameAndDesc = strcat(name, \" - \", description)\r\n| distinct nameAndDesc, name",
                          "size": 0,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ]
                        },
                        "conditionalVisibilities": [
                          {
                            "parameterName": "ComplianceStandard",
                            "comparison": "isEqualTo"
                          },
                          {
                            "parameterName": "ComplianceStandard",
                            "comparison": "isNotEqualTo"
                          }
                        ],
                        "name": "controls names"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let mainControls = dynamic(\r\n{\r\n\"PCI-DSS-3.2.1\": {\r\n\"1\": \"Install and maintain a firewall configuration to protect cardholder data\",\r\n\"2\": \"Do not use vendor-supplied defaults for system passwords and other security parameters\",\r\n\"3\": \"Protect stored cardholder data\",\r\n\"4\": \"Encrypt transmission of cardholder data across open, public networks.\",\r\n\"5\": \"Protect all systems against malware and regularly update anti-virus software or programs.\",\r\n\"6\": \"Develop and maintain secure systems and applications\",\r\n\"7\": \"Restrict access to cardholder data by business need to know\",\r\n\"8\": \"Identify and authenticate access to system components\",\r\n\"9\": \"Restrict physical access to cardholder data\",\r\n\"10\": \"Track and monitor all access to network resources and cardholder data\",\r\n\"11\": \"Regularly test security systems and processes\",\r\n\"12\": \"Maintain a policy that addresses information security for all personnel\",\r\n\"A1\": \"Protect each entity's (that is, merchant, service provider, or other entity) hosted environment and data, per A1.1 through A1.4:\",\r\n\"A2\": \"Additional PCI DSS Requirements for Entities using SSL/Early TLS for Card-Present POS POI Terminal Connections\",\r\n\"A3\": \"Designated Entities Supplemental Validation (DESV).\"},\r\n\"ISO-27001\": {\r\n\"A5\": \"Information security policies\",\r\n\"A6\": \"Organization of information security\",\r\n\"A7\": \"Human resources security\",\r\n\"A8\": \"Asset management\",\r\n\"A9\": \"Access control\",\r\n\"A10\": \"Cryptography\",\r\n\"A11\": \"Physical and environmental security\",\r\n\"A12\": \"Operations security\",\r\n\"A13\": \"Communications security\",\r\n\"A14\": \"System acquisition, development and maintenance\",\r\n\"A15\": \"Supplier relationships\",\r\n\"A16\": \"Information security incident management\",\r\n\"A17\": \"Information security aspects of business continuity management\",\r\n\"A18\": \"Compliance\"},\r\n\"Azure-CIS-1.1.0\": {\r\n\"1\": \"Identity and Access Management\",\r\n\"2\": \"Security Center\",\r\n\"3\": \"Storage Accounts\",\r\n\"4\": \"Database Services\",\r\n\"5\": \"Logging and Monitoring\",\r\n\"6\": \"Networking\",\r\n\"7\": \"Virtual Machines\",\r\n\"8\": \"Other Security Considerations\",\r\n\"9\": \"AppService\"},\r\n\"SOC-TSP\": {\r\n\"CC1\": \"Common Criteria Related to Organization and Management\",\r\n\"CC2\": \"Common Criteria Related to Communications\",\r\n\"CC3\": \"Common Criteria Related to Risk Management and Design and Implementation of Controls\",\r\n\"CC4\": \"Common Criteria Related to Monitoring of Controls\",\r\n\"CC5\": \"Common Criteria Related to Logical and Physical Access Controls\",\r\n\"CC6\": \"Common Criteria Related to System Operations\",\r\n\"CC7\": \"Common Criteria Related to Change Management\",\r\n\"A1\": \"Additional Criteria for Availability\",\r\n\"C1\": \"Additional Criteria for Confidentiality\"},\r\n\"NIST-SP-800-53-R4\": {\r\n\"AC\": \"Access Control\",\r\n\"AT\": \"Awareness and Training\",\r\n\"AU\": \"Audit and Accountability\",\r\n\"CA\": \"Security Assessment and Authorization\",\r\n\"CM\": \"Configuration Management\",\r\n\"CP\": \"Contingency Planning\",\r\n\"IA\": \"Identification and Authentication\",\r\n\"IR\": \"Incident Response\",\r\n\"MA\": \"Maintenance\",\r\n\"MP\": \"Media Protection\",\r\n\"PE\": \"Physical and Environmental Protection\",\r\n\"PL\": \"Planning\",\r\n\"PS\": \"Personnel Security\",\r\n\"RA\": \"Risk Assessment\",\r\n\"SA\": \"System and Services Acquisition\",\r\n\"SC\": \"System and Communications Protection\",\r\n\"SI\": \"System and Information Integrity\"},\r\n\"Azure-Security-Benchmark\": {\r\n\"AM\": \"Asset Management\",\r\n\"BR\": \"Backup and Recovery\",\r\n\"DP\": \"Data Protection\",\r\n\"ES\": \"Endpoint Security\",\r\n\"GS\": \"Governance and Strategy\",\r\n\"IM\": \"Identity Management\",\r\n\"IR\": \"Incident Response\",\r\n\"LT\": \"Logging and Threat Detection\",\r\n\"NS\": \"Network Security\",\r\n\"PA\": \"Privileged Access\",\r\n\"PV\": \"Posture and Vulnerability Management\"},\r\n\"UKO and UK NHS\": {\r\n\"1\": \"Data in Transit Protection\",\r\n\"2\": \"Asset Protection and Resilience\",\r\n\"3\": \"Separation Between Users\",\r\n\"4\": \"Governance Framework\",\r\n\"5\": \"Operational Security\",\r\n\"6\": \"Personnel Security\",\r\n\"7\": \"Secure Development\",\r\n\"8\": \"Supply Chain Security\",\r\n\"9\": \"Secure User Management\",\r\n\"10\": \"End User Identity and Authentication\",\r\n\"11\": \"External Interface Protection \",\r\n\"12\": \"Secure Service Administration\",\r\n\"13\": \"Audit Information for Users\",\r\n\"14\": \"Secure Use of the Service\"},\r\n\"Canada-Federal-PBMM\": {\r\n\"AC\": \"Access control\",\r\n\"AT\": \"Awareness and training\",\r\n\"AU\": \"Audit & accountability\",\r\n\"CA\": \"Security assessment and authorization\",\r\n\"CM\": \"Configuration management\",\r\n\"CP\": \"Contingency planning\",\r\n\"IA\": \"Identification and authentication\",\r\n\"IR\": \"Incident response\",\r\n\"MA\": \"Maintenance\",\r\n\"PE\": \"Physical and environmental\",\r\n\"PL\": \"Planning\",\r\n\"PM\": \"Program management\",\r\n\"PS\": \"Personnel security\",\r\n\"RA\": \"Risk assessment\",\r\n\"SA\": \"System and services acquisition\",\r\n\"SC\": \"System and communications protection\",\r\n\"SI\": \"System and information integrity\"},\r\n\"SWIFT-CSP-CSCF-v2020\": {\r\n\"1\": \"Restrict Internet Access & Protect Critical Systems from General IT Environment\",\r\n\"2\": \"Reduce Attack Surface and Vulnerabilities\",\r\n\"3\": \"Physically Secure the Environment\",\r\n\"4\": \"Prevent Compromise of Credentials\",\r\n\"5\": \"Manage Identities and Segregate Privileges\",\r\n\"6\": \"Detect Anomalous Activity to Systems or Transaction Records\",\r\n\"7\": \"Plan for Incident Response and Information Sharing\"},\r\n\"AWS CIS 1.2.0\": {\r\n\"1\": \"Identity and Access Management\",\r\n\"2\": \"Logging\",\r\n\"3\": \"Monitoring\",\r\n\"4\": \"Networking\"},\r\n\"GCP CIS 1.1.0\": {\r\n\"1\": \"Identity and Access Management\",\r\n\"2\": \"Logging and Monitoring\",\r\n\"3\": \"Networking\",\r\n\"4\": \"Virtual Machines\",\r\n\"5\": \"Storage\",\r\n\"6\": \"Cloud SQL Database Services\",\r\n\"7\": \"BigQuery\"},\r\n\"NIST-SP-800-171-R2\": {\r\n\"3.1\": \"Access Control\",\r\n\"3.2\": \"Awareness and Training\",\r\n\"3.3\": \"Audit and Accountability\",\r\n\"3.4\": \"Configuration Management\",\r\n\"3.5\": \"Identification and Authentication\",\r\n\"3.6\": \"Incident Response\",\r\n\"3.7\": \"Maintenance\",\r\n\"3.8\": \"Media Protection\",\r\n\"3.9\": \"Personnel Security\",\r\n\"3.10\": \"Physical Protection\",\r\n\"3.11\": \"Risk Assessment\",\r\n\"3.12\": \"Security Assessment\",\r\n\"3.13\": \"System and Communications Protection\",\r\n\"3.14\": \"System and Information Integrity\"},\r\n\"AWS PCI DSS 3.2.1\": {\r\n\"1\": \"Install and maintain a firewall configuration to protect cardholder data\",\r\n\"2\": \"Do not use vendor-supplied defaults for system passwords and other security parameters\",\r\n\"3\": \"Protect stored cardholder data\",\r\n\"4\": \"Encrypt transmission of cardholder data across open, public networks.\",\r\n\"5\": \"Protect all systems against malware and regularly update anti-virus software or programs.\",\r\n\"6\": \"Develop and maintain secure systems and applications\",\r\n\"7\": \"Restrict access to cardholder data by business need to know\",\r\n\"8\": \"Identify and authenticate access to system components\",\r\n\"9\": \"Restrict physical access to cardholder data\",\r\n\"10\": \"Track and monitor all access to network resources and cardholder data\",\r\n\"11\": \"Regularly test security systems and processes\",\r\n\"12\": \"Maintain a policy that addresses information security for all personnel\",\r\n\"A1\": \"Protect each entity's (that is, merchant, service provider, or other entity) hosted environment and data, per A1.1 through A1.4:\",\r\n\"A2\": \"Additional PCI DSS Requirements for Entities using SSL/Early TLS for Card-Present POS POI Terminal Connections\",\r\n\"A3\": \"Designated Entities Supplemental Validation (DESV).\"},\r\n\"AWS Foundational Security Best Practices\": {},\r\n\"ISO 27001:2013\": {\r\n\"A.5\": \"Information security policies\",\r\n\"A.6\": \"Organization of information security\",\r\n\"A.7\": \"Human resource security\",\r\n\"A.8\": \"Asset management\",\r\n\"A.9\": \"Access control\",\r\n\"A.10\": \"Cryptography\",\r\n\"A.11\": \"Physical and environmental security\",\r\n\"A.12\": \"Operations security\",\r\n\"A.13\": \"Communications security\",\r\n\"A.14\": \"System acquisition, development and maintenance\",\r\n\"A.15\": \"Supplier relationships\",\r\n\"A.16\": \"Information security incident management\",\r\n\"A.17\": \"Information security aspects of business continuity management\",\r\n\"A.18\": \"Compliance\"},\r\n\"CMMC-Level-3\": {\r\n\"AC\": \"Access Control\",\r\n\"AM\": \"Asset Management\",\r\n\"AT\": \"Awareness and Training\",\r\n\"AU\": \"Audit and Accountability\",\r\n\"CA\": \"Security Assessment\",\r\n\"CM\": \"Configuration Management\",\r\n\"IA\": \"Identification and Authentication\",\r\n\"IR\": \"Incident Response\",\r\n\"MA\": \"Maintenance\",\r\n\"MP\": \"Media Protection\",\r\n\"PE\": \"Physical Protection\",\r\n\"PS\": \"Personnel Security\",\r\n\"RE\": \"Recovery\",\r\n\"RM\": \"Risk Assessment\",\r\n\"SA\": \"Situational Awareness\",\r\n\"SC\": \"System and Communications Protection\",\r\n\"SI\": \"System and Information Integrity\"},\r\n\"New-Zealand-ISM-Restricted\": {\r\n\"AC\": \"Access Control and Passwords\",\r\n\"AIS\": \"About information security\",\r\n\"CR\": \"Cryptography\",\r\n\"CSD\": \"Communications Systems and Devices\",\r\n\"DM\": \"Data management\",\r\n\"ES\": \"Email security\",\r\n\"ESS\": \"Enterprise systems security\",\r\n\"GS\": \"Gateway security\",\r\n\"INF\": \"Infrastructure\",\r\n\"ISD\": \"Information security documentation\",\r\n\"ISG\": \"Information security governance - roles and responsibilities\",\r\n\"ISI\": \"Information Security Incidents\",\r\n\"MDD\": \"Media and IT Equipment Management, Decommissioning and Disposal\",\r\n\"NS\": \"Network security\",\r\n\"PRS\": \"Product Security\",\r\n\"PS\": \"Physical Security\",\r\n\"PSS\": \"Personnel Security\",\r\n\"SCA\": \"System Certification and Accreditation\",\r\n\"SS\": \"Software security\",\r\n\"WO\": \"Working Off-Site\"},\r\n\"Azure-CIS-1.3.0\": {\r\n\"1\": \"Identity and Access Management\",\r\n\"2\": \"Security Center\",\r\n\"3\": \"Storage Accounts\",\r\n\"4\": \"Database Services\",\r\n\"5\": \"Logging and Monitoring\",\r\n\"6\": \"Networking\",\r\n\"7\": \"Virtual Machines\",\r\n\"8\": \"Other Security Considerations\",\r\n\"9\": \"App Service\"},\r\n\"HIPAA-HITRUST\": {\r\n\"00\": \"Information Security Management Program\",\r\n\"01\": \"Mobile Computing and Communications\",\r\n\"02\": \"Roles and Responsibilities\",\r\n\"03\": \"Performing Risk Assessments\",\r\n\"04\": \"Information Security Policy Document\",\r\n\"05\": \"Management Commitment to Information Security\",\r\n\"06\": \"Compliance with Security Policies and Standards\",\r\n\"07\": \"Inventory of Assets\",\r\n\"08\": \"Physical Entry Controls\",\r\n\"09\": \"Controls Against Malicious Code\",\r\n\"10\": \"Control of Operational Software\",\r\n\"11\": \"Reporting Information Security Events\",\r\n\"12\": \"Developing and Implementing Continuity Plans Including Information Security\"}});\r\n\r\nlet startOfToday = startofday(now()); \r\nlet offsetWeek = 6d; \r\nlet endTimeWeek = startOfToday - offsetWeek; \r\nlet offsetMonth = 29d;\r\nlet endTimeMonth = startOfToday - offsetMonth; \r\nlet snapShots = SecurityRegulatoryCompliance \r\n| where IsSnapshot == true \r\n| where ComplianceStandard == '{ComplianceStandard}'\r\n| extend Day = startofday(TimeGenerated)\r\n| summarize day_snapshot = max(TimeGenerated), week_snapshot = maxif(TimeGenerated, TimeGenerated <=  endTimeWeek), month_snapshot = maxif(TimeGenerated, TimeGenerated <=  endTimeMonth) by RegulatoryComplianceSubscriptionId;\r\n\r\nlet relevantStandards = SecurityRegulatoryCompliance \r\n| where  RegulatoryComplianceSubscriptionId in ({Subscription:subid})\r\n| where ComplianceStandard == '{ComplianceStandard}'\r\n| extend Day = startofday(TimeGenerated)\r\n| join kind = leftouter (snapShots) on RegulatoryComplianceSubscriptionId;\r\n\r\n// current image\r\nlet curr =  relevantStandards\r\n| where (IsSnapshot == true and Day == startofday(day_snapshot)) or (IsSnapshot == false and TimeGenerated >  day_snapshot)\r\n| summarize arg_max(TimeGenerated, *) by ComplianceStandard, ComplianceControl, RecommendationId, RegulatoryComplianceSubscriptionId\r\n| summarize failed_ass = countif(State == \"Failed\"), skipped_ass = countif(State == \"Skipped\"), passed_ass = countif(State == \"Passed\") by ComplianceStandard, ComplianceControl\r\n| extend parent_control = iff(ComplianceStandard == \"HIPAA-HITRUST\", extract(\"\\\\.(..).*\\\\.\", 1, ComplianceControl) , iff(ComplianceStandard == \"ISO-27001:2013\" or ComplianceStandard == \"NIST-SP-800-171-R2\", extract(\"^([^.]*.[^.]*)\", 1, ComplianceControl) , extract(\"^([^.]+).?\", 1, ComplianceControl)))\r\n| summarize passed = countif(failed_ass == 0 and (skipped_ass == 0 or (passed_ass > 0 and skipped_ass > 0))), total_controls_curr = count(), skipped = countif(failed_ass == 0 and skipped_ass > 0 and passed_ass == 0), failed = countif(failed_ass > 0) by parent_control\r\n| extend ratio_curr = (passed/todouble(total_controls_curr))*100;\r\n\r\n// last week image\r\nlet last_week =  relevantStandards\r\n| where (IsSnapshot == true and Day == startofday(week_snapshot)) or (IsSnapshot == false and TimeGenerated > week_snapshot and Day <= endTimeWeek)\r\n| summarize arg_max(TimeGenerated, *) by ComplianceStandard, ComplianceControl, RecommendationId, RegulatoryComplianceSubscriptionId\r\n| summarize failed_ass = countif(State == \"Failed\"), skipped_ass = countif(State == \"Skipped\"), passed_ass = countif(State == \"Passed\") by ComplianceStandard, ComplianceControl\r\n| extend parent_control = iff(ComplianceStandard == \"HIPAA-HITRUST\", extract(\"\\\\.(..).*\\\\.\", 1, ComplianceControl) , iff(ComplianceStandard == \"ISO-27001:2013\" or ComplianceStandard == \"NIST-SP-800-171-R2\", extract(\"^([^.]*.[^.]*)\", 1, ComplianceControl) , extract(\"^([^.]+).?\", 1, ComplianceControl)))\r\n| summarize passed = countif(failed_ass == 0 and (skipped_ass == 0 or (passed_ass > 0 and skipped_ass > 0))), total_controls_week = count(), skipped = countif(failed_ass == 0 and skipped_ass > 0 and passed_ass == 0), failed = countif(failed_ass > 0) by parent_control\r\n| extend ratio_week = (passed/todouble(total_controls_week))*100;\r\n\r\n// last month image\r\nlet last_month =  relevantStandards\r\n| where (IsSnapshot == true and Day == startofday(month_snapshot)) or (IsSnapshot == false and TimeGenerated > month_snapshot and Day <= endTimeMonth)\r\n| summarize arg_max(TimeGenerated, *) by ComplianceStandard, ComplianceControl, RecommendationId, RegulatoryComplianceSubscriptionId\r\n| summarize failed_ass = countif(State == \"Failed\"), skipped_ass = countif(State == \"Skipped\"), passed_ass = countif(State == \"Passed\") by ComplianceStandard, ComplianceControl\r\n| extend parent_control = iff(ComplianceStandard == \"HIPAA-HITRUST\", extract(\"\\\\.(..).*\\\\.\", 1, ComplianceControl) , iff(ComplianceStandard == \"ISO-27001:2013\" or ComplianceStandard == \"NIST-SP-800-171-R2\", extract(\"^([^.]*.[^.]*)\", 1, ComplianceControl) , extract(\"^([^.]+).?\", 1, ComplianceControl)))\r\n| summarize passed = countif(failed_ass == 0 and (skipped_ass == 0 or (passed_ass > 0 and skipped_ass > 0))), passed_controls_month = count(), skipped = countif(failed_ass == 0 and skipped_ass > 0 and passed_ass == 0), failed = countif(failed_ass > 0) by parent_control\r\n| extend ratio_month = (passed/todouble(passed_controls_month))*100;\r\n\r\ncurr\r\n|join kind = leftouter (last_week) on parent_control\r\n| join kind = leftouter (last_month) on parent_control\r\n| extend diffWeek = (ratio_curr - ratio_week)\r\n| extend diffMonth = (ratio_curr - ratio_month)\r\n| extend description = mainControls['{ComplianceStandard}'][parent_control]\r\n| extend main_control = iff(isnull(description), parent_control, strcat(parent_control, ' - ', description))\r\n| project parent_control, main_control, total_controls_curr, passed, skipped, failed, ratio_curr, diffWeek, diffMonth\r\n| order by ratio_curr asc",
                          "size": 0,
                          "title": "Changes for '{ComplianceStandard}'",
                          "noDataMessage": "No data available. Check your continuous export configuration for the selected workspaces.",
                          "exportFieldName": "parent_control",
                          "exportParameterName": "parent_control",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "parent_control",
                                "formatter": 5,
                                "formatOptions": {
                                  "linkTarget": "Url"
                                }
                              },
                              {
                                "columnMatch": "main_control",
                                "formatter": 1
                              },
                              {
                                "columnMatch": "total_controls_curr",
                                "formatter": 22,
                                "formatOptions": {
                                  "compositeBarSettings": {
                                    "labelText": "[\"passed\"]/[\"total_controls_curr\"]",
                                    "columnSettings": [
                                      {
                                        "columnName": "passed",
                                        "color": "green"
                                      },
                                      {
                                        "columnName": "skipped",
                                        "color": "gray"
                                      },
                                      {
                                        "columnName": "failed",
                                        "color": "redBright"
                                      }
                                    ]
                                  }
                                }
                              },
                              {
                                "columnMatch": "passed",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "skipped",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "failed",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "ratio_curr",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 0,
                                  "max": 100,
                                  "palette": "redGreen",
                                  "customColumnWidthSetting": "25ch"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": false,
                                    "maximumSignificantDigits": 4
                                  }
                                }
                              },
                              {
                                "columnMatch": "diffWeek",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "<",
                                      "thresholdValue": "0",
                                      "representation": "trenddown",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": ">",
                                      "thresholdValue": "0",
                                      "representation": "trendup",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "is Empty",
                                      "representation": "more",
                                      "text": "N/A"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "0",
                                      "representation": "Blank",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "unknown",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": false,
                                    "maximumSignificantDigits": 4
                                  }
                                },
                                "tooltipFormat": {
                                  "tooltip": "diffrence in passed controls percentages between now and 7 days ago"
                                }
                              },
                              {
                                "columnMatch": "diffMonth",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "<",
                                      "thresholdValue": "0",
                                      "representation": "trenddown",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": ">",
                                      "thresholdValue": "0",
                                      "representation": "trendup",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "is Empty",
                                      "representation": "more",
                                      "text": "N/A"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "0",
                                      "representation": "Blank",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "unknown",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": false,
                                    "maximumSignificantDigits": 4
                                  }
                                },
                                "tooltipFormat": {
                                  "tooltip": "diffrence in passed controls percentages between now and 30 days ago"
                                }
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "parent_control",
                                "label": "Main Control"
                              },
                              {
                                "columnId": "main_control",
                                "label": "Main Control"
                              },
                              {
                                "columnId": "total_controls_curr",
                                "label": "Passed controls"
                              },
                              {
                                "columnId": "passed"
                              },
                              {
                                "columnId": "skipped"
                              },
                              {
                                "columnId": "failed"
                              },
                              {
                                "columnId": "ratio_curr",
                                "label": "Passed Controls %"
                              },
                              {
                                "columnId": "diffWeek",
                                "label": "7-days change"
                              },
                              {
                                "columnId": "diffMonth",
                                "label": "30-days change"
                              }
                            ]
                          },
                          "sortBy": []
                        },
                        "customWidth": "100",
                        "conditionalVisibilities": [
                          {
                            "parameterName": "ComplianceStandard",
                            "comparison": "isNotEqualTo"
                          },
                          {
                            "parameterName": "ComplianceStandard",
                            "comparison": "isEqualTo"
                          }
                        ],
                        "name": "control over time grid",
                        "styleSettings": {
                          "margin": "5px"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"bbf86c61-1b8a-4dcc-bd65-a12d40810070\",\"mergeType\":\"leftouter\",\"leftTable\":\"control over time grid\",\"rightTable\":\"controls names\",\"leftColumn\":\"parent_control\",\"rightColumn\":\"name\"}],\"projectRename\":[{\"originalName\":\"[Added column]\",\"mergedName\":\"Added column\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"nameAndDesc\",\"operator\":\"==\",\"rightValType\":\"static\",\"rightVal\":\"null\",\"resultValType\":\"column\",\"resultVal\":\"Main Control1\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"column\",\"resultVal\":\"nameAndDesc\"}}]},{\"originalName\":\"[control over time grid].parent_control\",\"mergedName\":\"MainControl\",\"fromId\":\"bbf86c61-1b8a-4dcc-bd65-a12d40810070\"},{\"originalName\":\"[control over time grid].main_control\",\"mergedName\":\"Main Control1\",\"fromId\":\"bbf86c61-1b8a-4dcc-bd65-a12d40810070\"},{\"originalName\":\"[control over time grid].total_controls_curr\",\"mergedName\":\"Passed controls\",\"fromId\":\"bbf86c61-1b8a-4dcc-bd65-a12d40810070\"},{\"originalName\":\"[control over time grid].passed\",\"mergedName\":\"passed\",\"fromId\":\"bbf86c61-1b8a-4dcc-bd65-a12d40810070\"},{\"originalName\":\"[control over time grid].skipped\",\"mergedName\":\"skipped\",\"fromId\":\"bbf86c61-1b8a-4dcc-bd65-a12d40810070\"},{\"originalName\":\"[control over time grid].failed\",\"mergedName\":\"failed\",\"fromId\":\"bbf86c61-1b8a-4dcc-bd65-a12d40810070\"},{\"originalName\":\"[control over time grid].ratio_curr\",\"mergedName\":\"Passed Controls %\",\"fromId\":\"bbf86c61-1b8a-4dcc-bd65-a12d40810070\"},{\"originalName\":\"[control over time grid].diffWeek\",\"mergedName\":\"7-days change\",\"fromId\":\"bbf86c61-1b8a-4dcc-bd65-a12d40810070\"},{\"originalName\":\"[control over time grid].diffMonth\",\"mergedName\":\"30-days change\",\"fromId\":\"bbf86c61-1b8a-4dcc-bd65-a12d40810070\"},{\"originalName\":\"[controls names].nameAndDesc\",\"mergedName\":\"nameAndDesc\",\"fromId\":\"bbf86c61-1b8a-4dcc-bd65-a12d40810070\"},{\"originalName\":\"[controls names].name\",\"mergedName\":\"name\",\"fromId\":\"bbf86c61-1b8a-4dcc-bd65-a12d40810070\"}]}",
                          "size": 0,
                          "title": "Changes for '{ComplianceStandard}'",
                          "exportFieldName": "MainControl",
                          "exportParameterName": "parent_control",
                          "showExportToExcel": true,
                          "queryType": 7,
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Added column",
                                "formatter": 1
                              },
                              {
                                "columnMatch": "MainControl",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Main Control1",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Passed controls",
                                "formatter": 22,
                                "formatOptions": {
                                  "compositeBarSettings": {
                                    "labelText": "[\"passed\"]/[\"Passed controls\"]",
                                    "columnSettings": [
                                      {
                                        "columnName": "passed",
                                        "color": "green"
                                      },
                                      {
                                        "columnName": "skipped",
                                        "color": "gray"
                                      },
                                      {
                                        "columnName": "failed",
                                        "color": "redBright"
                                      }
                                    ]
                                  }
                                }
                              },
                              {
                                "columnMatch": "passed",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "skipped",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "failed",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Passed Controls %",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 0,
                                  "max": 100,
                                  "palette": "redGreen",
                                  "customColumnWidthSetting": "25ch"
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "maximumSignificantDigits": 4
                                  }
                                }
                              },
                              {
                                "columnMatch": "7-days change",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "<",
                                      "thresholdValue": "0",
                                      "representation": "trenddown",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": ">",
                                      "thresholdValue": "0",
                                      "representation": "trendup",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "is Empty",
                                      "representation": "more",
                                      "text": "N/A"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "0",
                                      "representation": "Blank",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Unknown",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "maximumSignificantDigits": 4
                                  },
                                  "emptyValCustomText": "diffrence in passed controls percentages between now and 7 days ago"
                                }
                              },
                              {
                                "columnMatch": "30-days change",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "<",
                                      "thresholdValue": "0",
                                      "representation": "trenddown",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": ">",
                                      "thresholdValue": "0",
                                      "representation": "trendup",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "is Empty",
                                      "representation": "more",
                                      "text": "N/A"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "0",
                                      "representation": "Blank",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Unknown",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                },
                                "numberFormat": {
                                  "unit": 1,
                                  "options": {
                                    "style": "decimal",
                                    "maximumSignificantDigits": 4
                                  },
                                  "emptyValCustomText": "diffrence in passed controls percentages between now and 30 days ago"
                                }
                              },
                              {
                                "columnMatch": "nameAndDesc",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "name",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Main Control",
                                "formatter": 5
                              }
                            ],
                            "sortBy": [
                              {
                                "itemKey": "$gen_bar_Passed Controls %_7",
                                "sortOrder": 1
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "Added column",
                                "label": "Main Control"
                              },
                              {
                                "columnId": "Main Control1"
                              },
                              {
                                "columnId": "Passed controls"
                              },
                              {
                                "columnId": "passed"
                              },
                              {
                                "columnId": "skipped"
                              },
                              {
                                "columnId": "failed"
                              },
                              {
                                "columnId": "Passed Controls %"
                              },
                              {
                                "columnId": "7-days change"
                              },
                              {
                                "columnId": "30-days change"
                              },
                              {
                                "columnId": "nameAndDesc"
                              },
                              {
                                "columnId": "name"
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "$gen_bar_Passed Controls %_7",
                              "sortOrder": 1
                            }
                          ]
                        },
                        "conditionalVisibility": {
                          "parameterName": "ComplianceStandard",
                          "comparison": "isNotEqualTo"
                        },
                        "showPin": false,
                        "name": "control over time grid merge"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "To view changs over time on a specific control. please select any from the list above.",
                          "style": "info"
                        },
                        "customWidth": "100",
                        "conditionalVisibilities": [
                          {
                            "parameterName": "parent_control",
                            "comparison": "isEqualTo"
                          },
                          {
                            "parameterName": "ComplianceStandard",
                            "comparison": "isNotEqualTo"
                          }
                        ],
                        "name": "control drill down",
                        "styleSettings": {
                          "margin": "5px"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "\r\nlet startOfToday = startofday(now()); \r\nlet offsetWeek = 6d; \r\nlet endTimeWeek = startOfToday - offsetWeek; \r\nlet offsetMonth = 29d;\r\nlet endTimeMonth = startOfToday - offsetMonth; \r\nlet snapShots = SecurityRegulatoryCompliance \r\n| where ComplianceStandard == '{ComplianceStandard}'\r\n| where IsSnapshot == true \r\n| extend Day = startofday(TimeGenerated)\r\n| summarize day_snapshot = max(TimeGenerated), week_snapshot = maxif(TimeGenerated, TimeGenerated <=  endTimeWeek), month_snapshot = maxif(TimeGenerated, TimeGenerated <=  endTimeMonth) by RegulatoryComplianceSubscriptionId;\r\n\r\nlet relevantStandard = SecurityRegulatoryCompliance \r\n| where RegulatoryComplianceSubscriptionId in ({Subscription:subid})\r\n| where ComplianceStandard == '{ComplianceStandard}'\r\n| extend tempControl = iff(ComplianceStandard == \"HIPAA-HITRUST\", extract(\"\\\\.(..).*\\\\.\", 1, ComplianceControl) , iff(ComplianceStandard == \"ISO-27001:2013\" or ComplianceStandard == \"NIST-SP-800-171-R2\", extract(\"^([^.]*.[^.]*)\", 1, ComplianceControl) , extract(\"^([^.]+).\", 1, ComplianceControl)))\r\n| where tempControl == '{parent_control}'\r\n| extend Day = startofday(TimeGenerated)\r\n| join kind = leftouter (snapShots) on RegulatoryComplianceSubscriptionId;\r\n\r\n// current image\r\nlet curr =  relevantStandard\r\n| where (IsSnapshot == true and Day == startofday(day_snapshot)) or (IsSnapshot == false and TimeGenerated >  day_snapshot)\r\n| summarize arg_max(TimeGenerated, *) by ComplianceControl, RecommendationId, RegulatoryComplianceSubscriptionId\r\n| distinct ComplianceControl, RecommendationId, State\r\n| summarize failed_ass_curr = countif(State == \"Failed\") by ComplianceControl;\r\n\r\n// last week image\r\nlet last_week = relevantStandard\r\n| where (IsSnapshot == true and Day == startofday(week_snapshot)) or (IsSnapshot == false and  TimeGenerated > week_snapshot and Day <= endTimeWeek)\r\n| summarize arg_max(TimeGenerated, *) by ComplianceControl, RecommendationId, RegulatoryComplianceSubscriptionId\r\n| distinct ComplianceControl, RecommendationId, State\r\n| summarize failed_ass_week = countif(State == \"Failed\") by ComplianceControl;\r\n\r\n// last month image\r\nlet last_month = relevantStandard\r\n| where (IsSnapshot == true and Day == startofday(month_snapshot)) or (IsSnapshot == false and TimeGenerated > month_snapshot and Day <= endTimeMonth)\r\n| summarize arg_max(TimeGenerated, *) by ComplianceControl, RecommendationId, RegulatoryComplianceSubscriptionId\r\n| distinct ComplianceControl, RecommendationId, State\r\n| summarize failed_ass_month = countif(State == \"Failed\") by ComplianceControl;\r\n\r\n\r\ncurr\r\n| join kind = leftouter (last_week) on ComplianceControl\r\n| join kind = leftouter (last_month) on ComplianceControl\r\n| project ComplianceControl, failed_ass_curr, failed_ass_week, failed_ass_month\r\n| order by failed_ass_curr desc",
                          "size": 0,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "sortBy": [
                              {
                                "itemKey": "ComplianceControl",
                                "sortOrder": 1
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "ComplianceControl",
                              "sortOrder": 1
                            }
                          ]
                        },
                        "conditionalVisibilities": [
                          {
                            "parameterName": "parent_control",
                            "comparison": "isEqualTo"
                          },
                          {
                            "parameterName": "parent_control",
                            "comparison": "isNotEqualTo"
                          }
                        ],
                        "name": "subcontrol query"
                      },
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "parameters": [
                            {
                              "id": "b92be924-e4dd-48e2-a84c-9f9c5de86a5d",
                              "version": "KqlParameterItem/1.0",
                              "name": "subcontrols_count",
                              "type": 1,
                              "query": "SecurityRegulatoryCompliance \r\n| where RegulatoryComplianceSubscriptionId in ({Subscription:subid})\r\n| where ComplianceStandard == '{ComplianceStandard}'\r\n| extend tempControl = iff(ComplianceStandard == \"HIPAA-HITRUST\", extract(\"\\\\.(..).*\\\\.\", 1, ComplianceControl) , extract(\"^([^.]+).\", 1, ComplianceControl))\r\n| where tempControl == '{parent_control}'\r\n| count\r\n\r\n",
                              "crossComponentResources": [
                                "{Workspace}"
                              ],
                              "isHiddenWhenLocked": true,
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces"
                            }
                          ],
                          "style": "above",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "parameters - 10"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"d4b60bfb-6287-471b-a44b-27fc637170b4\",\"mergeType\":\"leftouter\",\"leftTable\":\"subcontrol query\",\"rightTable\":\"controls names\",\"leftColumn\":\"ComplianceControl\",\"rightColumn\":\"name\"}],\"projectRename\":[{\"originalName\":\"[controls names].nameAndDesc\",\"mergedName\":\"nameAndDesc\",\"fromId\":\"unknown\"},{\"originalName\":\"[subcontrol query].passed_ass_week\",\"mergedName\":\"passed_ass_week\",\"fromId\":\"unknown\"},{\"originalName\":\"[subcontrol query].passed_ass_month\",\"mergedName\":\"passed_ass_month\",\"fromId\":\"unknown\"},{\"originalName\":\"[subcontrol query].failed_ass_curr\",\"mergedName\":\"failed_ass_curr\",\"fromId\":\"unknown\"},{\"originalName\":\"[subcontrol query].failed_ass_week\",\"mergedName\":\"failed_ass_week\",\"fromId\":\"unknown\"},{\"originalName\":\"[subcontrol query].failed_ass_month\",\"mergedName\":\"failed_ass_month\",\"fromId\":\"unknown\"},{\"originalName\":\"[subcontrol query].ComplianceControl\",\"mergedName\":\"ComplianceControl\",\"fromId\":\"d4b60bfb-6287-471b-a44b-27fc637170b4\"},{\"originalName\":\"[controls names].name\",\"mergedName\":\"name\",\"fromId\":\"d4b60bfb-6287-471b-a44b-27fc637170b4\"},{\"originalName\":\"[controls names].name\"}]}",
                          "size": 0,
                          "title": "'{parent_control}' sub controls",
                          "noDataMessage": "There are no subcontrols for the selected control",
                          "exportFieldName": "ComplianceControl",
                          "exportParameterName": "compliance_control",
                          "showExportToExcel": true,
                          "queryType": 7,
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "nameAndDesc",
                                "formatter": 1,
                                "formatOptions": {
                                  "customColumnWidthSetting": "70ch"
                                }
                              },
                              {
                                "columnMatch": "failed_ass_curr",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "red"
                                }
                              },
                              {
                                "columnMatch": "failed_ass_week",
                                "formatter": 0,
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": false
                                  },
                                  "emptyValCustomText": "N/A"
                                }
                              },
                              {
                                "columnMatch": "failed_ass_month",
                                "formatter": 0,
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal"
                                  },
                                  "emptyValCustomText": "N/A"
                                }
                              },
                              {
                                "columnMatch": "ComplianceControl",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "name",
                                "formatter": 5
                              }
                            ],
                            "sortBy": [
                              {
                                "itemKey": "$gen_number_failed_ass_month_3",
                                "sortOrder": 2
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "nameAndDesc",
                                "label": "Compliance control"
                              },
                              {
                                "columnId": "failed_ass_curr",
                                "label": "Current failing assessments"
                              },
                              {
                                "columnId": "failed_ass_week",
                                "label": "Failed assessments last week"
                              },
                              {
                                "columnId": "failed_ass_month",
                                "label": "Failed assessments last month"
                              },
                              {
                                "columnId": "ComplianceControl",
                                "label": "Compliance control"
                              },
                              {
                                "columnId": "name"
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "$gen_number_failed_ass_month_3",
                              "sortOrder": 2
                            }
                          ]
                        },
                        "customWidth": "100",
                        "conditionalVisibilities": [
                          {
                            "parameterName": "parent_control",
                            "comparison": "isNotEqualTo"
                          },
                          {
                            "parameterName": "subcontrols_count",
                            "comparison": "isNotEqualTo",
                            "value": ""
                          }
                        ],
                        "showPin": false,
                        "name": "sub controls over time grid",
                        "styleSettings": {
                          "margin": "5px"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "\r\nlet startOfToday = startofday(now()); \r\nlet offsetWeek = 6d; \r\nlet offsetMonth = 29d;\r\nlet weekAgo = startOfToday - offsetWeek; \r\nlet monthAgo = startOfToday - offsetMonth;\r\n\r\nlet revelantControl = SecurityRegulatoryCompliance\r\n| where ComplianceStandard == '{ComplianceStandard}'\r\n| where ComplianceControl == '{compliance_control}';\r\n\r\nlet lastControlSnapshot = revelantControl\r\n| where IsSnapshot == true\r\n| summarize arg_max(TimeGenerated, TimeGenerated) by ComplianceControl\r\n| project lastSnapshotDay = startofday(TimeGenerated);\r\n\r\nlet controlsRecommandations = revelantControl // all the control's reccomendation in last snapshot\r\n| where IsSnapshot == true\r\n| extend day = startofday(TimeGenerated)\r\n| where day in (lastControlSnapshot)\r\n| distinct RecommendationId;\r\n\r\nlet relevantRecommandations = revelantControl\r\n| where RegulatoryComplianceSubscriptionId in ({Subscription:subid})\r\n| where RecommendationId in (controlsRecommandations);\r\n\r\nlet curr = relevantRecommandations\r\n| summarize arg_max(TimeGenerated, *) by RecommendationId, RegulatoryComplianceSubscriptionId\r\n| summarize failedResourcesSumCurr = sum(FailedResources) by RecommendationId, RecommendationName;\r\n\r\nlet last_week = relevantRecommandations\r\n| where startofday(TimeGenerated) < weekAgo\r\n| summarize arg_max(TimeGenerated, *) by RecommendationId, RegulatoryComplianceSubscriptionId\r\n| summarize failedResourcesSumWeek = sum(FailedResources) by RecommendationId, RecommendationName;\r\n\r\nlet last_month = relevantRecommandations\r\n| where startofday(TimeGenerated) <= monthAgo\r\n| summarize arg_max(TimeGenerated, *) by RecommendationId, RegulatoryComplianceSubscriptionId\r\n| summarize failedResourcesSumMonth = sum(FailedResources) by RecommendationId, RecommendationName;\r\n\r\ncurr\r\n| join kind = leftouter (last_week) on RecommendationId\r\n| join kind = leftouter (last_month) on RecommendationId\r\n| project RecommendationName, RecommendationId, failedResourcesSumCurr, failedResourcesSumWeek, failedResourcesSumMonth\r\n| order by failedResourcesSumCurr desc",
                          "size": 0,
                          "title": "'{compliance_control}' assessments over time",
                          "exportedParameters": [
                            {
                              "fieldName": "RecommendationId",
                              "parameterName": "RecommendationId",
                              "parameterType": 1
                            },
                            {
                              "fieldName": "RecommendationName",
                              "parameterName": "RecommendationName",
                              "parameterType": 1
                            }
                          ],
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "RecommendationName",
                                "formatter": 1,
                                "formatOptions": {
                                  "customColumnWidthSetting": "65ch"
                                }
                              },
                              {
                                "columnMatch": "RecommendationId",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "failedResourcesSumCurr",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "red"
                                }
                              },
                              {
                                "columnMatch": "failedResourcesSumWeek",
                                "formatter": 0,
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal"
                                  },
                                  "emptyValCustomText": "N/A"
                                }
                              },
                              {
                                "columnMatch": "failedResourcesSumMonth",
                                "formatter": 0,
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": false
                                  },
                                  "emptyValCustomText": "N/A"
                                }
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "RecommendationName",
                                "label": "Recommendation name"
                              },
                              {
                                "columnId": "RecommendationId"
                              },
                              {
                                "columnId": "failedResourcesSumCurr",
                                "label": "Current failing resources"
                              },
                              {
                                "columnId": "failedResourcesSumWeek",
                                "label": "Failed resources last week"
                              },
                              {
                                "columnId": "failedResourcesSumMonth",
                                "label": "Failed resources last month"
                              }
                            ]
                          },
                          "sortBy": []
                        },
                        "customWidth": "100",
                        "conditionalVisibility": {
                          "parameterName": "compliance_control",
                          "comparison": "isNotEqualTo"
                        },
                        "name": "assessments over time grid",
                        "styleSettings": {
                          "margin": "5px"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "\r\nlet startOfToday = startofday(now()); \r\nlet offsetWeek = 6d; \r\nlet offsetMonth = 29d;\r\nlet weekAgo = startOfToday - offsetWeek; \r\nlet monthAgo = startOfToday - offsetMonth;\r\n\r\nlet revelantControl = SecurityRegulatoryCompliance\r\n| where ComplianceStandard == '{ComplianceStandard}'\r\n| where ComplianceControl == '{parent_control}';\r\n\r\nlet lastControlSnapshot = revelantControl\r\n| where IsSnapshot == true\r\n| summarize arg_max(TimeGenerated, TimeGenerated) by ComplianceControl\r\n| project lastSnapshotDay = startofday(TimeGenerated);\r\n\r\nlet controlsRecommandations = revelantControl // all the control's reccomendation in last snapshot\r\n| where IsSnapshot == true\r\n| extend day = startofday(TimeGenerated)\r\n| where day in (lastControlSnapshot)\r\n| distinct RecommendationId;\r\n\r\nlet relevantRecommandations = revelantControl\r\n| where  RegulatoryComplianceSubscriptionId in ({Subscription:subid})\r\n| where RecommendationId in (controlsRecommandations);\r\n\r\nlet curr = relevantRecommandations\r\n| summarize arg_max(TimeGenerated, *) by RecommendationId, RegulatoryComplianceSubscriptionId\r\n| summarize failedResourcesSumCurr = sum(FailedResources) by RecommendationId, RecommendationName;\r\n\r\nlet last_week = relevantRecommandations\r\n| where TimeGenerated < weekAgo\r\n| summarize arg_max(TimeGenerated, *) by RecommendationId, RegulatoryComplianceSubscriptionId\r\n| summarize failedResourcesSumWeek = sum(FailedResources) by RecommendationId, RecommendationName;\r\n\r\nlet last_month = relevantRecommandations\r\n| where TimeGenerated < monthAgo\r\n| summarize arg_max(TimeGenerated, *) by RecommendationId, RegulatoryComplianceSubscriptionId\r\n| summarize failedResourcesSumMonth = sum(FailedResources) by RecommendationId, RecommendationName;\r\n\r\ncurr\r\n| join kind = leftouter (last_week) on RecommendationId\r\n| join kind = leftouter (last_month) on RecommendationId\r\n| project RecommendationName, RecommendationId, failedResourcesSumCurr, failedResourcesSumWeek, failedResourcesSumMonth\r\n| order by failedResourcesSumCurr desc",
                          "size": 0,
                          "title": "'{parent_control}' assessments over time",
                          "exportedParameters": [
                            {
                              "fieldName": "RecommendationId",
                              "parameterName": "RecommendationId",
                              "parameterType": 1
                            },
                            {
                              "fieldName": "RecommendationName",
                              "parameterName": "RecommendationName",
                              "parameterType": 1
                            }
                          ],
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "RecommendationName",
                                "formatter": 1,
                                "formatOptions": {
                                  "customColumnWidthSetting": "65ch"
                                }
                              },
                              {
                                "columnMatch": "RecommendationId",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "failedResourcesSumCurr",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "red"
                                }
                              },
                              {
                                "columnMatch": "failedResourcesSumWeek",
                                "formatter": 0,
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal"
                                  },
                                  "emptyValCustomText": "N/A"
                                }
                              },
                              {
                                "columnMatch": "failedResourcesSumMonth",
                                "formatter": 0,
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": false
                                  },
                                  "emptyValCustomText": "N/A"
                                }
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "RecommendationName",
                                "label": "Recommendation name"
                              },
                              {
                                "columnId": "RecommendationId"
                              },
                              {
                                "columnId": "failedResourcesSumCurr",
                                "label": "Current failed resources"
                              },
                              {
                                "columnId": "failedResourcesSumWeek",
                                "label": "Failed resources last week"
                              },
                              {
                                "columnId": "failedResourcesSumMonth",
                                "label": "Failed resources last month"
                              }
                            ]
                          },
                          "sortBy": []
                        },
                        "customWidth": "100",
                        "conditionalVisibilities": [
                          {
                            "parameterName": "parent_control",
                            "comparison": "isNotEqualTo"
                          },
                          {
                            "parameterName": "subcontrols_count",
                            "comparison": "isEqualTo"
                          }
                        ],
                        "name": "assessments over time - Copy",
                        "styleSettings": {
                          "margin": "5px"
                        }
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "To view changs over time on a specific recommendation. please select any from the list above.",
                          "style": "info"
                        },
                        "customWidth": "100",
                        "conditionalVisibilities": [
                          {
                            "parameterName": "compliance_control",
                            "comparison": "isEqualTo"
                          },
                          {
                            "parameterName": "parent_control",
                            "comparison": "isNotEqualTo"
                          },
                          {
                            "parameterName": "ComplianceStandard",
                            "comparison": "isNotEqualTo"
                          }
                        ],
                        "name": "specific recommendation text",
                        "styleSettings": {
                          "margin": "5px"
                        }
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "To view changed per subscription for specific recommendation, please select any from the list above.",
                          "style": "info"
                        },
                        "customWidth": "100",
                        "conditionalVisibilities": [
                          {
                            "parameterName": "RecommendationId",
                            "comparison": "isEqualTo"
                          },
                          {
                            "parameterName": "compliance_control",
                            "comparison": "isNotEqualTo"
                          }
                        ],
                        "name": "recommendation drill down",
                        "styleSettings": {
                          "margin": "5px"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "\r\nlet startOfToday = startofday(now()); \r\nlet offsetWeek = 6d; \r\nlet offsetMonth = 29d;\r\nlet weekAgo = startOfToday - offsetWeek; \r\nlet monthAgo = startOfToday - offsetMonth;\r\n\r\nlet relevantRecommandation = SecurityRegulatoryCompliance\r\n| where  RegulatoryComplianceSubscriptionId in ({Subscription:subid})\r\n| where ComplianceStandard == '{ComplianceStandard}'\r\n| where ComplianceControl == '{compliance_control}'\r\n| where RecommendationId == '{RecommendationId}';\r\n\r\nlet curr = relevantRecommandation\r\n| summarize arg_max(TimeGenerated, *) by RecommendationId, RegulatoryComplianceSubscriptionId\r\n| project RegulatoryComplianceSubscriptionId, FailedResourcesCurr = FailedResources;\r\n\r\nlet last_week = relevantRecommandation\r\n| where startofday(TimeGenerated) <= weekAgo\r\n| summarize arg_max(TimeGenerated, *) by RecommendationId, RegulatoryComplianceSubscriptionId\r\n| project RegulatoryComplianceSubscriptionId, FailedResourcesWeek = FailedResources;\r\n\r\nlet last_month = relevantRecommandation\r\n| where startofday(TimeGenerated) <= monthAgo\r\n| summarize arg_max(TimeGenerated, *) by RecommendationId, RegulatoryComplianceSubscriptionId\r\n| project RegulatoryComplianceSubscriptionId, FailedResourcesMonth = FailedResources;\r\n\r\n\r\ncurr\r\n| join kind = leftouter (last_week) on RegulatoryComplianceSubscriptionId\r\n| join kind = leftouter (last_month) on RegulatoryComplianceSubscriptionId\r\n| project RegulatoryComplianceSubscriptionId, FailedResourcesCurr, FailedResourcesWeek, FailedResourcesMonth",
                          "size": 0,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "RegulatoryComplianceSubscriptionId",
                                "formatter": 15,
                                "formatOptions": {
                                  "linkTarget": null,
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "FailedResourcesCurr",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "red"
                                }
                              },
                              {
                                "columnMatch": "FailedResourcesWeek",
                                "formatter": 0,
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal"
                                  },
                                  "emptyValCustomText": "N/A"
                                }
                              },
                              {
                                "columnMatch": "FailedResourcesMonth",
                                "formatter": 0,
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal"
                                  },
                                  "emptyValCustomText": "N/A"
                                }
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "RegulatoryComplianceSubscriptionId",
                                "label": "Subscription name"
                              },
                              {
                                "columnId": "FailedResourcesCurr",
                                "label": "Current failing resources"
                              },
                              {
                                "columnId": "FailedResourcesWeek",
                                "label": "Failed resources last week"
                              },
                              {
                                "columnId": "FailedResourcesMonth",
                                "label": "Failed resources last month"
                              }
                            ]
                          }
                        },
                        "customWidth": "100",
                        "conditionalVisibilities": [
                          {
                            "parameterName": "RecommendationId",
                            "comparison": "isNotEqualTo"
                          },
                          {
                            "parameterName": "subcontrols_count",
                            "comparison": "isNotEqualTo"
                          }
                        ],
                        "name": "resources count per subscription",
                        "styleSettings": {
                          "margin": "5px"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "\r\nlet startOfToday = startofday(now()); \r\nlet offsetWeek = 6d; \r\nlet offsetMonth = 29d;\r\nlet weekAgo = startOfToday - offsetWeek; \r\nlet monthAgo = startOfToday - offsetMonth;\r\n\r\nlet relevantRecommandation = SecurityRegulatoryCompliance\r\n| where  RegulatoryComplianceSubscriptionId in ({Subscription:subid})\r\n| where ComplianceStandard == '{ComplianceStandard}'\r\n| where ComplianceControl == '{parent_control}'\r\n| where RecommendationId == '{RecommendationId}';\r\n\r\nlet curr = relevantRecommandation\r\n| summarize arg_max(TimeGenerated, *) by RecommendationId, RegulatoryComplianceSubscriptionId\r\n| project RegulatoryComplianceSubscriptionId, FailedResourcesCurr = FailedResources;\r\n\r\nlet last_week = relevantRecommandation\r\n| where TimeGenerated < weekAgo\r\n| summarize arg_max(TimeGenerated, *) by RecommendationId, RegulatoryComplianceSubscriptionId\r\n| project RegulatoryComplianceSubscriptionId, FailedResourcesWeek = FailedResources;\r\n\r\nlet last_month = relevantRecommandation\r\n| where TimeGenerated < monthAgo\r\n| summarize arg_max(TimeGenerated, *) by RecommendationId, RegulatoryComplianceSubscriptionId\r\n| project RegulatoryComplianceSubscriptionId, FailedResourcesMonth = FailedResources;\r\n\r\n\r\ncurr\r\n| join kind = leftouter (last_week) on RegulatoryComplianceSubscriptionId\r\n| join kind = leftouter (last_month) on RegulatoryComplianceSubscriptionId\r\n| project RegulatoryComplianceSubscriptionId, FailedResourcesCurr, FailedResourcesWeek, FailedResourcesMonth",
                          "size": 0,
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "RegulatoryComplianceSubscriptionId",
                                "formatter": 15,
                                "formatOptions": {
                                  "linkTarget": null,
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "FailedResourcesCurr",
                                "formatter": 8,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "red"
                                }
                              },
                              {
                                "columnMatch": "FailedResourcesWeek",
                                "formatter": 0,
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal"
                                  },
                                  "emptyValCustomText": "N/A"
                                }
                              },
                              {
                                "columnMatch": "FailedResourcesMonth",
                                "formatter": 0,
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal"
                                  },
                                  "emptyValCustomText": "N/A"
                                }
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "RegulatoryComplianceSubscriptionId",
                                "label": "Subscription name"
                              },
                              {
                                "columnId": "FailedResourcesCurr",
                                "label": "Current faling resources"
                              },
                              {
                                "columnId": "FailedResourcesWeek",
                                "label": "Failed resources last week"
                              },
                              {
                                "columnId": "FailedResourcesMonth",
                                "label": "Failed resources last month"
                              }
                            ]
                          }
                        },
                        "customWidth": "100",
                        "conditionalVisibilities": [
                          {
                            "parameterName": "RecommendationId",
                            "comparison": "isNotEqualTo"
                          },
                          {
                            "parameterName": "subcontrols_count",
                            "comparison": "isEqualTo"
                          }
                        ],
                        "name": "resources count per subscription - Copy",
                        "styleSettings": {
                          "margin": "5px"
                        }
                      }
                    ]
                  },
                  "name": "specific control overview"
                }
              ],
              "exportParameters": true
            },
            "conditionalVisibilities": [
              {
                "parameterName": "Workspace",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "error",
                "comparison": "isNotEqualTo",
                "value": "1"
              }
            ],
            "name": "standard over view"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "How to configure this workbook",
                    "style": "warning"
                  },
                  "name": "Title"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "To use this Compliance Over Time workbook, you'll need to configure **continuous export** to export data to a Log Analytics workspace:\r\n1. From Security Center's sidebar, select **Pricing & settings**.\r\n2. Select the specific subscription for which you want to configure the data export.\r\n3. From the sidebar of the settings page for that subscription, select **Continuous Export**.\r\n4. Set the export targed to **Log Analytics workspace**.\r\n5. Select the following data types: **Regulatory compliance (Preview)**.\r\n6. From the export frequency options, select **Streaming** and **Snapshots**.\r\n7. Select **Save**.\r\n\r\n[Learn more](https://docs.microsoft.com/en-us/azure/security-center/continuous-export?tabs=azure-portal#set-up-a-continuous-export)\r\n\r\n> **Notes**\r\n* To get full visibility, wait at least one week for the first snapshot to be exported.\r\n* To configure continuous export across your organization, use the supplied Azure Policy 'DeployIfNotExist' policies described [here](https://docs.microsoft.com/en-us/azure/security-center/continuous-export?tabs=azure-policy#set-up-a-continuous-export)."
                  },
                  "name": "text - 1"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "Workspace",
              "comparison": "isEqualTo"
            },
            "name": "configuration"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "There is no continuous export data in the selected Log Analytics workspace(s). [Learn more](https://docs.microsoft.com/en-us/azure/security-center/continuous-export?WT.mc_id=Portal-fx&tabs=azure-portal#information-about-exporting-to-a-log-analytics-workspace)",
                    "style": "error"
                  },
                  "name": "error title"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "How to configure this workbook",
                          "style": "warning"
                        },
                        "name": "Title"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "To use this Secure Score Over Time workbook, you'll need to configure **continuous export** to export data to a Log Analytics workspace:\r\n1. From Security Center's sidebar, select **Pricing & settings**.\r\n2. Select the specific subscription for which you want to configure the data export.\r\n3. From the sidebar of the settings page for that subscription, select **Continuous Export**.\r\n4. Set the export targed to **Log Analytics workspace**.\r\n5. Select the following data types: **Regulatory compliance (Preview)**.\r\n6. From the export frequency options, select **Streaming** and **Snapshots**.\r\n7. Select **Save**.\r\n\r\n[Learn more](https://docs.microsoft.com/en-us/azure/security-center/continuous-export?tabs=azure-portal#set-up-a-continuous-export)\r\n\r\n> **Notes**\r\n* To get full visibility, wait at least one week for the first snapshot to be exported.\r\n* To configure continuous export across your organization, use the supplied Azure Policy 'DeployIfNotExist' policies described [here](https://docs.microsoft.com/en-us/azure/security-center/continuous-export?tabs=azure-policy#set-up-a-continuous-export)."
                        },
                        "name": "text - 1"
                      }
                    ]
                  },
                  "name": "configuration - Copy"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "error",
              "comparison": "isEqualTo",
              "value": "1"
            },
            "name": "error group"
          }
        ],
        "exportParameters": true
      },
      "name": "Standard view"
    }
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}