{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "## Containers Security Mapping Dashboard \r\n\r\nThis workbook has been created to provide a security mappings for Microsoft Defender for Contianers plan and agentless container security posture in Defender Cloud Security Posture Management based on the resource telemetry in your own environment. Please note that these view based on  your Containers infrastructure.\r\n\r\n<svg viewBox=\"0 0 19 19\" width=\"20\" class=\"fxt-escapeShadow\" role=\"presentation\" focusable=\"false\" xmlns:svg=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" aria-hidden=\"true\"><g><path fill=\"#1b93eb\" d=\"M16.82 8.886c0 4.81-5.752 8.574-7.006 9.411a.477.477 0 01-.523 0C8.036 17.565 2.18 13.7 2.18 8.886V3.135a.451.451 0 01.42-.419C7.2 2.612 6.154.625 9.5.625s2.3 1.987 6.8 2.091a.479.479 0 01.523.419z\"></path><path fill=\"url(#0024423711759027356)\" d=\"M16.192 8.99c0 4.392-5.333 7.947-6.483 8.575a.319.319 0 01-.418 0c-1.15-.732-6.483-4.183-6.483-8.575V3.762a.575.575 0 01.313-.523C7.2 3.135 6.258 1.357 9.4 1.357s2.2 1.882 6.274 1.882a.45.45 0 01.419.418z\"></path><path d=\"M9.219 5.378a.313.313 0 01.562 0l.875 1.772a.314.314 0 00.236.172l1.957.284a.314.314 0 01.174.535l-1.416 1.38a.312.312 0 00-.09.278l.334 1.949a.313.313 0 01-.455.33l-1.75-.92a.314.314 0 00-.292 0l-1.75.92a.313.313 0 01-.455-.33L7.483 9.8a.312.312 0 00-.09-.278L5.977 8.141a.314.314 0 01.174-.535l1.957-.284a.314.314 0 00.236-.172z\" class=\"msportalfx-svg-c01\"></path></g></svg>&nbsp;<span style=\"font-family: Open Sans; font-weight: 620; font-size: 14px;font-style: bold;margin:-10px 0px 0px 0px;position: relative;top:-3px;left:-4px;\"> Please take the time to answer a quick survey. To submit your feedback,\r\n</span>[<span style=\"font-family: Open Sans; font-weight: 620; font-size: 14px;font-style: bold;margin:-10px 0px 0px 0px;position: relative;top:-3px;left:-4px;\"> click here. </span>](https://aka.ms/containersecuritymapping)\r\n"
      },
      "name": "Intro"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "{subscription}"
        ],
        "parameters": [
          {
            "id": "7767523e-f230-4562-b00c-bce5a7d38fe7",
            "version": "KqlParameterItem/1.0",
            "name": "subscription",
            "label": "Subscription",
            "type": 6,
            "description": "Please select one or several Subscription in your environment",
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "includeAll": true,
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "defaultValue": "value::all",
            "value": [
              "value::all"
            ]
          },
          {
            "id": "ae33cf4e-c36b-46ae-a298-2a424a913fff",
            "version": "KqlParameterItem/1.0",
            "name": "acrs",
            "label": "Azure Container Registry",
            "type": 5,
            "description": "Please select one or several Container Registry in your environment",
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "resources\r\n    | where type == \"microsoft.containerregistry/registries\"\r\n    | summarize Count= count() by id\r\n    | project id",
            "crossComponentResources": [
              "{subscription}"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "defaultValue": "value::all",
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "value": [
              "value::all"
            ]
          },
          {
            "id": "8a4343cc-c916-49a3-a759-313c2ac25ea9",
            "version": "KqlParameterItem/1.0",
            "name": "k8sarc",
            "label": "AKS and/or ARC Enabled",
            "type": 2,
            "description": "Please select either AKS or ARC enabled or both",
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "showDefault": false
            },
            "jsonData": "[\r\n    { \"value\": \"microsoft.containerservice/managedclusters\", \"label\": \"Azure Kubernetes Service\"},\r\n    { \"value\": \"microsoft.kubernetes/connectedclusters\", \"label\": \"Azure Arc Enabled Kubernetes\"}\r\n]",
            "timeContext": {
              "durationMs": 86400000
            },
            "defaultValue": "value::all"
          },
          {
            "id": "7757d94c-8713-4c19-b340-07b51b2370e7",
            "version": "KqlParameterItem/1.0",
            "name": "k8sclu",
            "label": "Kubernetes Cluster",
            "type": 5,
            "description": "Please select one or several Kubernetes clusters in your environment",
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "resources\r\n    |where type in~ ({k8sarc})\r\n    | summarize Count= count() by id\r\n    | project id",
            "crossComponentResources": [
              "{subscription}"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "showDefault": false
            },
            "defaultValue": "value::all",
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "value": [
              "value::all"
            ]
          },
          {
            "id": "2167db7e-96d3-4bc5-8a6b-ed78ea2c1566",
            "version": "KqlParameterItem/1.0",
            "name": "gcpconnector",
            "label": "GCP Connector",
            "type": 2,
            "description": "Select a GCP connector",
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "resources\r\n| where type == \"microsoft.security/securityconnectors\" and properties.environmentName == \"GCP\"\r\n|extend hierarchyIdentifier = properties.hierarchyIdentifier\r\n| project id, label =strcat(hierarchyIdentifier,\" (\",name,\")\")",
            "crossComponentResources": [
              "{subscription}"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "defaultValue": "value::all",
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "value": [
              "value::all"
            ]
          },
          {
            "id": "5d1613d9-1de1-42a4-9f47-1839ab9b8681",
            "version": "KqlParameterItem/1.0",
            "name": "awsconnectors",
            "label": "AWS Connectors",
            "type": 2,
            "description": "Select an AWS connector",
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "resources\r\n| where type == \"microsoft.security/securityconnectors\" and properties.environmentName == \"AWS\"\r\n|extend hierarchyIdentifier = properties.hierarchyIdentifier\r\n| project id, labelÂ =Â strcat(hierarchyIdentifier,\"Â (\",name,\")\")",
            "crossComponentResources": [
              "{subscription}"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "defaultValue": "value::all",
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "f38b2b18-3eda-4aeb-8155-b0e9b267864a",
            "version": "KqlParameterItem/1.0",
            "name": "severity",
            "label": "Alert Severity",
            "type": 2,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "showDefault": false
            },
            "jsonData": "[\r\n    {\"value\": \"High\", \"label\":\"High\"},\r\n    {\"value\": \"Medium\", \"label\":\"Medium\"},\r\n    {\"value\": \"Low\", \"label\":\"Low\"},\r\n    {\"value\": \"Informational\", \"label\":\"Informational\"}\r\n]\r\n    ",
            "timeContext": {
              "durationMs": 86400000
            },
            "defaultValue": "value::all",
            "value": [
              "value::all"
            ]
          }
        ],
        "style": "above",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources"
      },
      "name": "select_subscriptions"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "links": [
          {
            "id": "7b8f3245-20ab-43a8-8b15-7b60d449308e",
            "cellValue": "tab",
            "linkTarget": "parameter",
            "linkLabel": "ðŸ”Ž Overview",
            "subTarget": "overview",
            "preText": "Overview",
            "style": "link"
          },
          {
            "id": "5146da94-2a92-4d35-8c7b-a39d469129d1",
            "cellValue": "tab",
            "linkTarget": "parameter",
            "linkLabel": "Configuration",
            "subTarget": "config",
            "style": "link"
          },
          {
            "id": "7a273fe4-5d4f-4e5f-b29b-8b4a4a9b75cc",
            "cellValue": "tab",
            "linkTarget": "parameter",
            "linkLabel": "ðŸ”·Vulnerability Assessment - Registry ",
            "subTarget": "registrymdvm",
            "style": "link"
          },
          {
            "id": "7be52b57-e328-499b-b4fa-c3fd676ae76b",
            "cellValue": "tab",
            "linkTarget": "parameter",
            "linkLabel": "ðŸ”µVulnerability Assessement - Runtime ",
            "subTarget": "k8smdvm",
            "style": "link"
          },
          {
            "id": "c973a4aa-7315-4f9c-8b36-44ea4f6374dc",
            "cellValue": "tab",
            "linkTarget": "parameter",
            "linkLabel": "ðŸ”” Threat Detection - Alerts",
            "subTarget": "alerts",
            "style": "link"
          },
          {
            "id": "1a9a5044-2785-429a-8d69-2141d76a7370",
            "cellValue": "tab",
            "linkTarget": "parameter",
            "linkLabel": "ðŸ”µ Hardening - Recommendations",
            "subTarget": "Hareden",
            "style": "link"
          }
        ]
      },
      "name": "Tab_Menu"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "links": [
          {
            "id": "7f5331af-3944-4890-a86c-33cc177df5aa",
            "cellValue": "registryscanning",
            "linkTarget": "parameter",
            "linkLabel": "Azure",
            "subTarget": "acr",
            "preText": "test",
            "style": "link"
          },
          {
            "id": "cbe072dc-739a-4fae-9003-6993c96a6e34",
            "cellValue": "registryscanning",
            "linkTarget": "parameter",
            "linkLabel": "AWS",
            "subTarget": "ecr",
            "style": "link"
          },
          {
            "id": "39599ffb-46ef-4cc2-becd-72bfdb177e9b",
            "cellValue": "registryscanning",
            "linkTarget": "parameter",
            "linkLabel": "GCP",
            "subTarget": "gargcr",
            "style": "link"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "tab",
        "comparison": "isEqualTo",
        "value": "registrymdvm"
      },
      "name": "registrylinks"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "links": [
          {
            "id": "fadc711a-93e9-4a60-b2f2-afbc824ef447",
            "cellValue": "runtimecloud",
            "linkTarget": "parameter",
            "linkLabel": "Azure",
            "subTarget": "azure",
            "preText": "Azure",
            "style": "link"
          },
          {
            "id": "6222454f-a997-4fb1-bf2c-9b10289d2a78",
            "cellValue": "runtimecloud",
            "linkTarget": "parameter",
            "linkLabel": "AWS",
            "subTarget": "aws",
            "style": "link"
          },
          {
            "id": "10563e8e-874c-4d2a-a32e-71f5558727e3",
            "cellValue": "runtimecloud",
            "linkTarget": "parameter",
            "linkLabel": "GCP",
            "subTarget": "gcp",
            "style": "link"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "tab",
        "comparison": "isEqualTo",
        "value": "k8smdvm"
      },
      "name": "k8sruntimelinks "
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## Alerts Overview"
            },
            "name": "text - 2"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\r\n    | where type =~ \"microsoft.security/locations/alerts\"\r\n    | extend isAzure = tostring(properties.ResourceIdentifiers) matches regex '\"Type\"\\\\s*:\\\\s*\"AzureResource\"'\r\n    | extend IsIncident = properties.[\"IsIncident\"]\r\n    | extend AlertDisplayName = properties.[\"AlertDisplayName\"]\r\n    | extend SystemAlertId = properties.[\"SystemAlertId\"]\r\n    | extend Status = properties.[\"Status\"]\r\n    | extend Tactics = split(properties.[\"Intent\"],\",\")\r\n    | mv-expand Tactics\r\n    | extend Tactic = trim(\" \",tostring(Tactics))\r\n    | extend affectedResourceId = extract('\"AzureResourceId\"\\\\s*:\\\\s*\"([^\"]*)\"', 1, tostring(properties.ResourceIdentifiers))\r\n    | extend hostName = iff(isAzure, \"\", extract('\"HostName\"\\\\s*:\\\\s*\"([^\"]*)\"', 1, tostring(properties.Entities)))\r\n    | extend splitAffectedResourceId = split(affectedResourceId, \"/\")\r\n    | extend resourceNameIndex = iff(array_length(splitAffectedResourceId) > 1, array_length(splitAffectedResourceId) - 1, 0)\r\n    | extend affectedResourceName = iff(isAzure, splitAffectedResourceId[resourceNameIndex], iff(isempty(hostName), \"Non-Azure\", hostName))\r\n    | extend ResourceIdentifiers = properties.[\"ResourceIdentifiers\"]\r\n    | mv-expand ResourceIdentifiers\r\n    | extend ResourceId = parse_json(ResourceIdentifiers).[\"AzureResourceId\"]\r\n    | extend Resource = tolower(tostring(ResourceId))\r\n    | project-away resourceNameIndex, splitAffectedResourceId, hostName\r\n    | extend ResourceIdentifiers = properties.[\"ResourceIdentifiers\"]\r\n    | mv-expand ResourceIdentifiers\r\n    | extend ResourceId = parse_json(ResourceIdentifiers).[\"AzureResourceId\"]\r\n    | extend Resource = tolower(tostring(ResourceId))\r\n    | extend affectedResourceId = tolower(affectedResourceId)\r\n    | join kind=inner \r\n        (\r\n            resources\r\n                |where type =~ 'microsoft.containerservice/managedclusters' or type =~ 'microsoft.kubernetes/connectedclusters'\r\n                | project id = tolower(id)\r\n        ) on $left.affectedResourceId == $right.id\r\n    | extend ResourceGroup = tolower(resourceGroup)\r\n    | where Resource in~ ({k8sclu})\r\n    | where Status == \"Active\"\r\n    | extend ResourceGroup = iif(isempty(ResourceGroup), \" \", ResourceGroup)\r\n    | where AlertDisplayName !startswith ('[SAMPLE ALERT]')\r\n    | distinct ['id'], Tactic\r\n    | summarize count() by Tactic",
              "size": 4,
              "title": "Alerts by MITRE ATT&CK  Tactics",
              "noDataMessage": "No alerts found",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "visualization": "piechart",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "Tactic",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "count_",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto",
                    "compositeBarSettings": {
                      "labelText": "",
                      "columnSettings": []
                    }
                  }
                },
                "showBorder": false
              }
            },
            "customWidth": "35",
            "conditionalVisibility": {
              "parameterName": "tab",
              "comparison": "isEqualTo",
              "value": "overview"
            },
            "name": "Overview_Alert_Mitre"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\r\n    | where type =~ \"microsoft.security/locations/alerts\"\r\n    | extend isAzure = tostring(properties.ResourceIdentifiers) matches regex '\"Type\"\\\\s*:\\\\s*\"AzureResource\"'\r\n    | extend AlertDisplayName = properties.[\"AlertDisplayName\"]\r\n    | extend Severity = properties.[\"Severity\"]\r\n    | extend Status = properties.[\"Status\"]\r\n    | extend affectedResourceId = extract('\"AzureResourceId\"\\\\s*:\\\\s*\"([^\"]*)\"', 1, tostring(properties.ResourceIdentifiers))\r\n    | extend hostName = iff(isAzure, \"\", extract('\"HostName\"\\\\s*:\\\\s*\"([^\"]*)\"', 1, tostring(properties.Entities)))\r\n    | extend splitAffectedResourceId = split(affectedResourceId, \"/\")\r\n    | extend resourceNameIndex = iff(array_length(splitAffectedResourceId) > 1, array_length(splitAffectedResourceId) - 1, 0)\r\n    | extend affectedResourceName = iff(isAzure, splitAffectedResourceId[resourceNameIndex], iff(isempty(hostName), \"Non-Azure\", hostName))\r\n    | extend ResourceIdentifiers = properties.[\"ResourceIdentifiers\"]\r\n    | mv-expand ResourceIdentifiers\r\n    | extend ResourceId = parse_json(ResourceIdentifiers).[\"AzureResourceId\"]\r\n    | extend Resource = tolower(tostring(ResourceId))\r\n    | project-away resourceNameIndex, splitAffectedResourceId, hostName\r\n    | project\r\n            affectedResourceId = tolower(affectedResourceId),\r\n            tostring(Severity),\r\n            AlertDisplayName,\r\n            Status,\r\n            ResourceGroup = tolower(resourceGroup),\r\n            Resource\r\n    | join kind=inner\r\n        (\r\n            resources\r\n                |where type =~ 'microsoft.containerservice/managedclusters' or type =~ 'microsoft.kubernetes/connectedclusters'\r\n                | project id = tolower(id)\r\n        ) on $left.affectedResourceId == $right.id\r\n    | where Resource in~ ({k8sclu})\r\n    | where Status == \"Active\"\r\n    | extend ResourceGroup = iif(isempty(ResourceGroup), \" \", ResourceGroup)\r\n    | where AlertDisplayName !startswith ('[SAMPLE ALERT]')\r\n    | project (Severity)\r\n    | summarize count() by Severity",
              "size": 4,
              "title": "Alert Summary by Severity",
              "noDataMessage": "No alerts found",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "visualization": "piechart",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Severity",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "High",
                          "representation": "redBright",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "contains",
                          "thresholdValue": "Medium",
                          "representation": "orange",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "contains",
                          "thresholdValue": "Low",
                          "representation": "yellow",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "contains",
                          "thresholdValue": "Informational",
                          "representation": "gray",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "SystemAlertId",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "IsIncident",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "AlertURI",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "SubscriptionId",
                    "formatter": 15,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "Location",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "ResourceId",
                    "formatter": 5
                  }
                ],
                "sortBy": [
                  {
                    "itemKey": "Tactics",
                    "sortOrder": 2
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "AlertDisplayName",
                    "label": "Alert Name"
                  },
                  {
                    "columnId": "IsIncident",
                    "label": "Incident/alert"
                  },
                  {
                    "columnId": "ResourceGroup",
                    "label": "Resource Group"
                  },
                  {
                    "columnId": "Resource",
                    "label": "Kubernetes Cluster"
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "Tactics",
                  "sortOrder": 2
                }
              ],
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "Severity",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "count_",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "none"
                  }
                },
                "showBorder": false
              },
              "mapSettings": {
                "locInfo": "LatLong",
                "sizeSettings": "count_",
                "sizeAggregation": "Sum",
                "legendMetric": "count_",
                "legendAggregation": "Sum",
                "itemColorSettings": {
                  "type": "heatmap",
                  "colorAggregation": "Sum",
                  "nodeColorField": "count_",
                  "heatmapPalette": "greenRed"
                }
              },
              "textSettings": {
                "style": "bignumber"
              }
            },
            "customWidth": "35",
            "conditionalVisibility": {
              "parameterName": "tab",
              "comparison": "isEqualTo",
              "value": "overview"
            },
            "name": "Overview_Alerts"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "tab",
        "comparison": "isEqualTo",
        "value": "overview"
      },
      "name": "overviewalert"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## Vulnerability Findings Overview by Environment"
            },
            "conditionalVisibility": {
              "parameterName": "tab",
              "comparison": "isEqualTo",
              "value": "overview"
            },
            "name": "text - 31"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "tabs",
              "links": [
                {
                  "id": "75f0af11-fc96-4762-89ed-76e6b492f62b",
                  "cellValue": "cloudva",
                  "linkTarget": "parameter",
                  "linkLabel": "Azure",
                  "subTarget": "azureva",
                  "style": "link"
                },
                {
                  "id": "f63bacf3-f532-4e73-a9e0-d620ab5cd06d",
                  "cellValue": "cloudva",
                  "linkTarget": "parameter",
                  "linkLabel": "AWS",
                  "subTarget": "awsva",
                  "style": "link"
                },
                {
                  "id": "ae7b5b38-7a81-4416-836a-0a6920c0ea89",
                  "cellValue": "cloudva",
                  "linkTarget": "parameter",
                  "linkLabel": "GCP",
                  "subTarget": "gcpva",
                  "style": "link"
                }
              ]
            },
            "name": "links - 7"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\r\n    | where type == \"microsoft.security/assessments/subassessments\"\r\n    | extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n    | where assessmentKey == \"c0b7cfc6-3172-465a-b378-53c7ff2cc0d5\"\r\n    | project \r\n        Resource = tolower(extract(@'(?i)(.*?)/providers/Microsoft.Security/([^/]+)', 1, id)),\r\n        severity = tostring(properties.additionalData.vulnerabilityDetails.severity), \r\n        status = tostring(parse_json(properties).status.code), \r\n        VulnId = tostring(parse_json(properties).id) \r\n    | where status == 'Unhealthy'\r\n    | where Resource in~({acrs})\r\n    | distinct \r\n        VulnId, \r\n        severity\r\n    | summarize count() by severity",
              "size": 4,
              "title": "ACR - Container Vulnerabilities by Severity (MDVM)",
              "noDataMessage": "No unhealthy registries found",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "visualization": "piechart",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "ResourceGroup",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Resource",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "Total",
                    "formatter": 1,
                    "formatOptions": {
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "sevH",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Sev0",
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "sevM",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Sev1",
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "sevL",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Sev3",
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "patchAvailable",
                    "formatter": 1,
                    "formatOptions": {
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": []
                      },
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "CVEcount",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "15ch"
                    }
                  }
                ],
                "rowLimit": 1000
              },
              "sortBy": [],
              "tileSettings": {
                "showBorder": false
              },
              "chartSettings": {
                "seriesLabelSettings": [
                  {
                    "seriesName": "Medium",
                    "color": "yellow"
                  },
                  {
                    "seriesName": "High",
                    "color": "orange"
                  },
                  {
                    "seriesName": "Low",
                    "color": "blue"
                  },
                  {
                    "seriesName": "Critical",
                    "color": "redBright"
                  }
                ]
              }
            },
            "customWidth": "35",
            "conditionalVisibility": {
              "parameterName": "cloudva",
              "comparison": "isEqualTo",
              "value": "azureva"
            },
            "name": "Overview_Containers_Vulnerabilities_Severity - MDVM"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\r\n | where type == \"microsoft.security/assessments/subassessments\"\r\n | extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n | where assessmentKey == \"c609cf0f-71ab-41e9-a3c6-9a1f7fe1b8d5\"\r\n | project \r\n    Resource = tolower(extract(@'(?i)(.*?)/providers/Microsoft.Security/([^/]+)', 1, id)), \r\n    severity = tostring(properties.additionalData.vulnerabilityDetails.severity), \r\n    status = tostring(parse_json(properties).status.code), \r\n    VulnId = tostring(parse_json(properties).id)\r\n | where status == 'Unhealthy'\r\n | where Resource in~ ({k8sclu})\r\n | distinct VulnId, severity\r\n | summarize count() by severity\r\n ",
              "size": 4,
              "title": "AKS - Running Images Vulnerabilities by Severity (MDVM)",
              "noDataMessage": "No unhealthy Kubernetes found",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "visualization": "piechart",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "count_",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "ResourceGroup",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Resource",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "Total",
                    "formatter": 1,
                    "formatOptions": {
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "sevH",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "redBright",
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "sevM",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "yellow",
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "sevL",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "blueDark",
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "patchAvailable",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "pending",
                          "text": "{0}{1}"
                        }
                      ],
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": []
                      }
                    }
                  },
                  {
                    "columnMatch": "CVEcount",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "4",
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "15ch"
                    }
                  }
                ],
                "rowLimit": 1000,
                "filter": true
              },
              "sortBy": [],
              "chartSettings": {
                "seriesLabelSettings": [
                  {
                    "seriesName": "Medium",
                    "color": "yellow"
                  },
                  {
                    "seriesName": "Low",
                    "color": "blue"
                  },
                  {
                    "seriesName": "High",
                    "color": "orange"
                  },
                  {
                    "seriesName": "Critical",
                    "color": "redBright"
                  }
                ]
              }
            },
            "customWidth": "65",
            "conditionalVisibility": {
              "parameterName": "cloudva",
              "comparison": "isEqualTo",
              "value": "azureva"
            },
            "name": "Overview_K8s_Vulnerabilities_Severity - MDVM"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\r\n    | where type == \"microsoft.security/assessments/subassessments\"\r\n   | extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n   | where assessmentKey == \"5cc3a2c1-8397-456f-8792-fe9d0d4c9145\"\r\n  |extend connectorIdÂ =Â extract(\"(.*)/securityentitydata\",Â 1,Â id)\r\n|whereÂ connectorIdÂ in~({gcpconnector})\r\n   | project \r\n    ResourceName = tostring(properties.resourceDetails.resourceName),\r\n    ProjectId = tostring(properties.resourceDetails.projectId),\r\n     ResourceId = tostring(properties.resourceDetails.id),\r\n       severity = tostring(properties.additionalData.vulnerabilityDetails.severity), \r\n    status = tostring(parse_json(properties).status.code),\r\n    VulnId = tostring(parse_json(properties).id) \r\n    | where status == 'Unhealthy'\r\n    | distinct \r\n       VulnId, \r\n        severity\r\n    | summarize count() by severity",
              "size": 4,
              "title": "GCR - Container Vulnerabilities by Severity (MDVM)",
              "noDataMessage": "No unhealthy registries found",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "visualization": "piechart",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "ResourceGroup",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Resource",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "Total",
                    "formatter": 1,
                    "formatOptions": {
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "sevH",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Sev0",
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "sevM",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Sev1",
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "sevL",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Sev3",
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "patchAvailable",
                    "formatter": 1,
                    "formatOptions": {
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": []
                      },
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "CVEcount",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "15ch"
                    }
                  }
                ],
                "rowLimit": 1000
              },
              "sortBy": [],
              "tileSettings": {
                "showBorder": false
              },
              "chartSettings": {
                "seriesLabelSettings": [
                  {
                    "seriesName": "Medium",
                    "color": "yellow"
                  },
                  {
                    "seriesName": "High",
                    "color": "orange"
                  },
                  {
                    "seriesName": "Low",
                    "color": "blue"
                  },
                  {
                    "seriesName": "Critical",
                    "color": "redBright"
                  }
                ]
              }
            },
            "customWidth": "35",
            "conditionalVisibilities": [
              {
                "parameterName": "tab",
                "comparison": "isEqualTo",
                "value": "overview"
              },
              {
                "parameterName": "cloudva",
                "comparison": "isEqualTo",
                "value": "gcpva"
              }
            ],
            "name": "Overview_GCRContainers_Vulnerabilities_Severity - MDVM"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\r\n | where type == \"microsoft.security/assessments/subassessments\"\r\n | extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n | where assessmentKey == \"e538731a-80c8-4317-a119-13075e002516\"\r\n |extend connectorIdÂ =Â extract(\"(.*)/securityentitydata\",Â 1,Â id)\r\n|whereÂ connectorIdÂ in~({gcpconnector})\r\n | project \r\n    Resource = tolower(extract(@'(?i)(.*?)/providers/Microsoft.Security/([^/]+)', 1, id)), \r\n    severity = tostring(parse_json(properties).status.severity), \r\n    status = tostring(parse_json(properties).status.code), \r\n    VulnId = tostring(parse_json(properties).id)\r\n | where status == 'Unhealthy'\r\n// | where Resource in~ ({k8sclu})\r\n | distinct VulnId, severity\r\n | summarize count() by severity\r\n ",
              "size": 4,
              "title": "GKE - Running Images Vulnerabilities by Severity (MDVM)",
              "noDataMessage": "No unhealthy Kubernetes found",
              "exportToExcelOptions": "all",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "visualization": "piechart",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "count_",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "ResourceGroup",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Resource",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "Total",
                    "formatter": 1,
                    "formatOptions": {
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "sevH",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "redBright",
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "sevM",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "yellow",
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "sevL",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "blueDark",
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "patchAvailable",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "pending",
                          "text": "{0}{1}"
                        }
                      ],
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": []
                      }
                    }
                  },
                  {
                    "columnMatch": "CVEcount",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "4",
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "15ch"
                    }
                  }
                ],
                "rowLimit": 1000,
                "filter": true
              },
              "sortBy": [],
              "chartSettings": {
                "seriesLabelSettings": [
                  {
                    "seriesName": "Medium",
                    "color": "yellow"
                  },
                  {
                    "seriesName": "Low",
                    "color": "blue"
                  },
                  {
                    "seriesName": "High",
                    "color": "orange"
                  },
                  {
                    "seriesName": "Critical",
                    "color": "redBright"
                  }
                ]
              }
            },
            "customWidth": "35",
            "conditionalVisibility": {
              "parameterName": "cloudva",
              "comparison": "isEqualTo",
              "value": "gcpva"
            },
            "name": "Overview_GKE_Vulnerabilities_Severity_MDVM"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\r\n    | where type == \"microsoft.security/assessments/subassessments\"\r\n   | extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n   | where assessmentKey == \"c27441ae-775c-45be-8ffa-655de37362ce\"\r\n   |extend connectorIdÂ =Â extract(\"(.*)/securityentitydata\",Â 1,Â id)\r\n|whereÂ connectorIdÂ in~({awsconnectors})\r\n   | project \r\n    ResourceName = tostring(properties.resourceDetails.resourceName),\r\n    ProjectId = tostring(properties.resourceDetails.projectId),\r\n     ResourceId = tostring(properties.resourceDetails.id),\r\n       severity = tostring(properties.additionalData.vulnerabilityDetails.severity), \r\n    status = tostring(parse_json(properties).status.code),\r\n    VulnId = tostring(parse_json(properties).id) \r\n    | where status == 'Unhealthy'\r\n    | distinct \r\n       VulnId, \r\n        severity\r\n    | summarize count() by severity",
              "size": 4,
              "title": "ECR - Container Vulnerabilities by Severity (MDVM)",
              "noDataMessage": "No unhealthy registries found",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "visualization": "piechart",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "ResourceGroup",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Resource",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "Total",
                    "formatter": 1,
                    "formatOptions": {
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "sevH",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Sev0",
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "sevM",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Sev1",
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "sevL",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Sev3",
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "patchAvailable",
                    "formatter": 1,
                    "formatOptions": {
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": []
                      },
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "CVEcount",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "15ch"
                    }
                  }
                ],
                "rowLimit": 1000
              },
              "sortBy": [],
              "tileSettings": {
                "showBorder": false
              },
              "chartSettings": {
                "seriesLabelSettings": [
                  {
                    "seriesName": "Medium",
                    "color": "orange"
                  },
                  {
                    "seriesName": "High",
                    "color": "redBright"
                  },
                  {
                    "seriesName": "Low",
                    "color": "blue"
                  }
                ]
              }
            },
            "customWidth": "35",
            "conditionalVisibility": {
              "parameterName": "cloudva",
              "comparison": "isEqualTo",
              "value": "awsva"
            },
            "name": "Overview_ECRContainers_Vulnerabilities_Severity_MDVM"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\r\n | where type == \"microsoft.security/assessments/subassessments\"\r\n | extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n | where assessmentKey == \"682b2595-d045-4cff-b5aa-46624eb2dd8f\"\r\n |extend connectorIdÂ =Â extract(\"(.*)/securityentitydata\",Â 1,Â id)\r\n|whereÂ connectorIdÂ in~({awsconnectors})\r\n | project \r\n    Resource = tolower(extract(@'(?i)(.*?)/providers/Microsoft.Security/([^/]+)', 1, id)), \r\n    severity = tostring(parse_json(properties).status.severity), \r\n    status = tostring(parse_json(properties).status.code), \r\n    VulnId = tostring(parse_json(properties).id)\r\n | where status == 'Unhealthy'\r\n// | where Resource in~ ({k8sclu})\r\n | distinct VulnId, severity\r\n | summarize count() by severity\r\n ",
              "size": 4,
              "title": "EKS - Running Images Vulnerabilities by Severity (MDVM)",
              "noDataMessage": "No unhealthy Kubernetes found",
              "exportToExcelOptions": "all",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "visualization": "piechart",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "count_",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "ResourceGroup",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Resource",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "Total",
                    "formatter": 1,
                    "formatOptions": {
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "sevH",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "redBright",
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "sevM",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "yellow",
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "sevL",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "blueDark",
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "patchAvailable",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "pending",
                          "text": "{0}{1}"
                        }
                      ],
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": []
                      }
                    }
                  },
                  {
                    "columnMatch": "CVEcount",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "4",
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "15ch"
                    }
                  }
                ],
                "rowLimit": 1000,
                "filter": true
              },
              "sortBy": [],
              "chartSettings": {
                "seriesLabelSettings": [
                  {
                    "seriesName": "Medium",
                    "color": "yellow"
                  },
                  {
                    "seriesName": "Low",
                    "color": "blue"
                  },
                  {
                    "seriesName": "High",
                    "color": "orange"
                  },
                  {
                    "seriesName": "Critical",
                    "color": "redBright"
                  }
                ]
              }
            },
            "customWidth": "35",
            "conditionalVisibility": {
              "parameterName": "cloudva",
              "comparison": "isEqualTo",
              "value": "awsva"
            },
            "name": "Overview_EKS_Vulnerabilities_Severity_MDVM "
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "tab",
        "comparison": "isEqualTo",
        "value": "overview"
      },
      "name": "vulnerabilityoverview"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "links": [
          {
            "id": "8ec6c539-94c9-4a45-96b6-2b1928d364ca",
            "cellValue": "cloud",
            "linkTarget": "parameter",
            "linkLabel": "Azure and Azure Arc Enabled Kubernetes",
            "subTarget": "azurecloud",
            "preText": "Azure",
            "style": "link"
          },
          {
            "id": "fc86116b-7982-4624-a4c1-3d6f27fcc57a",
            "cellValue": "cloud",
            "linkTarget": "parameter",
            "linkLabel": "AWS",
            "subTarget": "awscloud",
            "preText": "AWS",
            "style": "link"
          },
          {
            "id": "ceeed79a-88b1-4b24-ad07-9550526ef660",
            "cellValue": "cloud",
            "linkTarget": "parameter",
            "linkLabel": "GCP",
            "subTarget": "gcpcloud",
            "preText": "GCP",
            "style": "link"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "tab",
        "comparison": "isEqualTo",
        "value": "config"
      },
      "name": "configoverview"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Configuration",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\r\n| where type == \"microsoft.security/pricings\"\r\n| where name in~(\"CloudPosture\",\"Containers\")\r\n| extend pricingTier = properties.pricingTier, subPlan = properties.subPlan\r\n| extend planSet = pack(name, level = case(isnotempty(subPlan),subPlan,pricingTier))\r\n| summarize defenderPlans = make_bag(planSet) by subscriptionId\r\n|Â project subscriptionId,\r\n    CloudPosture = defenderPlans.CloudPosture,\r\n    Containers = defenderPlans.Containers",
              "size": 1,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "subscriptionId",
                    "formatter": 15,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "CloudPosture",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Standard",
                          "representation": "green",
                          "text": "Enabled"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "redBright",
                          "text": "Disabled"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Containers",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Standard",
                          "representation": "green",
                          "text": "Enabled"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "redBright",
                          "text": "Disabled"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "VirtualMachines",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "P1",
                          "representation": "green",
                          "text": "Enabled"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "P2",
                          "representation": "green",
                          "text": "Enabled"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "redBright",
                          "text": "Disabled"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "SqlServers",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Standard",
                          "representation": "green",
                          "text": "Enabled"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "redBright",
                          "text": "Disabled"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "SqlServerVirtualMachines",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Standard",
                          "representation": "green",
                          "text": "Enabled"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "redBright",
                          "text": "Disabled"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "StorageAccounts",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "DefenderForStorageV2",
                          "representation": "green",
                          "text": "Enabled"
                        },
                        {
                          "operator": "!=",
                          "thresholdValue": "DefenderForStorageV2",
                          "representation": "orange",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "redBright",
                          "text": "Disabled"
                        }
                      ]
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true,
                "labelSettings": [
                  {
                    "columnId": "subscriptionId",
                    "label": "Subscription"
                  },
                  {
                    "columnId": "CloudPosture",
                    "label": "Defender CSPM"
                  },
                  {
                    "columnId": "Containers",
                    "label": "Defender for Containers"
                  }
                ]
              }
            },
            "name": "mdc_plans_enabled",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\r\n| where type == \"microsoft.security/pricings\"\r\n| where name in~(\"CloudPosture\", \"Containers\")\r\n| mv-expand extensions = properties.extensions\r\n| extend extensionName = tostring(extensions.name)\r\n| where extensionName in~(\"AgentlessDiscoveryForKubernetes\")\r\n| extend agentLessAKSDisc = iff(name in~ (\"CloudPosture\", \"Containers\") and extensionName == \"AgentlessDiscoveryForKubernetes\" and tostring(extensions.isEnabled) == \"True\", \"Enabled\", \"Should Enable\")\r\n| distinct   subscriptionId, agentLessAKSDisc",
              "size": 1,
              "title": "Agentless discovery for Kubernetes",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "subscriptionId",
                    "formatter": 15,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "agentLessAKSDisc",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Enabled",
                          "representation": "green",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "redBright",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true,
                "labelSettings": [
                  {
                    "columnId": "subscriptionId",
                    "label": "Subscription"
                  },
                  {
                    "columnId": "agentLessAKSDisc",
                    "label": "Status"
                  }
                ]
              }
            },
            "customWidth": "50",
            "name": "query - 19",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\r\n| where type == \"microsoft.security/pricings\"\r\n| where name in~(\"CloudPosture\", \"Containers\")\r\n| mv-expand extensions = properties.extensions\r\n| extend extensionName = tostring(extensions.name)\r\n| where extensionName in~(\"ContainerRegistriesVulnerabilityAssessments\")\r\n| extend agentLessContainerScan = iff(name in~ (\"CloudPosture\", \"Containers\") and extensionName == \"ContainerRegistriesVulnerabilityAssessments\" and tostring(extensions.isEnabled) == \"True\", \"Enabled\", \"Should Enable\")\r\n| distinct   subscriptionId, agentLessContainerScan",
              "size": 1,
              "title": "Container registries vulnerability assessment scanning",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "subscriptionId",
                    "formatter": 15,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "agentLessContainerScan",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Enabled",
                          "representation": "green",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "redBright",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true,
                "labelSettings": [
                  {
                    "columnId": "subscriptionId",
                    "label": "Subscriptions"
                  },
                  {
                    "columnId": "agentLessContainerScan",
                    "label": "Status"
                  }
                ]
              }
            },
            "customWidth": "50",
            "name": "query - 20",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources \r\nâ€¯â€¯â€¯â€¯|â€¯whereâ€¯typeâ€¯==â€¯\"microsoft.security/assessments\" \r\nâ€¯â€¯â€¯â€¯|â€¯extendâ€¯healthStateâ€¯=â€¯properties.status.code    \r\n    | extend url = strcat(\"https://\", properties.links.azurePortal)\r\n    | extend resource = tostring(properties.resourceDetails.Id)\r\n    | extend resourcesecblade = strcat(tostring(id), \"/security\")\r\n    | extend recommendation = tostring(properties.metadata.displayName)\r\n    | extend ResourceType = id \r\n    | extend AssessmentKey = name\r\n   | where healthState in ('Unhealthy')\r\n    | where recommendation contains ('should have Defender Profile enabled')\r\n    | project \r\n       subscriptionId,\r\n        resource,\r\n        resourceGroup",
              "size": 1,
              "title": "Clusters Missing the Defender Profile",
              "noDataMessage": "All clusters have the Defender Profile installed. ",
              "noDataMessageStyle": 3,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "$gen_group",
                    "formatter": 15,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "subscriptionId",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "resource",
                    "formatter": 13,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "resourceGroup",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "id",
                    "formatter": 5
                  }
                ],
                "rowLimit": 10000,
                "filter": true,
                "hierarchySettings": {
                  "treeType": 1,
                  "groupBy": [
                    "subscriptionId",
                    "resourceGroup"
                  ],
                  "expandTopLevel": false
                },
                "labelSettings": [
                  {
                    "columnId": "subscriptionId",
                    "label": "Subscription"
                  },
                  {
                    "columnId": "resource",
                    "label": "Cluster"
                  },
                  {
                    "columnId": "resourceGroup",
                    "label": "Resource Group"
                  }
                ]
              }
            },
            "customWidth": "50",
            "name": "missingdefenderprofile",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources \r\nâ€¯â€¯â€¯â€¯|â€¯whereâ€¯typeâ€¯==â€¯\"microsoft.security/assessments\" \r\nâ€¯â€¯â€¯â€¯|â€¯extendâ€¯healthStateâ€¯=â€¯properties.status.code    \r\n    | extend url = strcat(\"https://\", properties.links.azurePortal)\r\n    | extend resource = tostring(properties.resourceDetails.Id)\r\n    | extend resourcesecblade = strcat(tostring(id), \"/security\")\r\n    | extend recommendation = tostring(properties.metadata.displayName)\r\n    | extend ResourceType = id \r\n    | extend AssessmentKey = name\r\n   | where healthState in ('Unhealthy')\r\n    | where recommendation contains ('Policy add-on for Kubernetes installed')\r\n    | project \r\n       subscriptionId,\r\n        resource,\r\n        resourceGroup",
              "size": 1,
              "title": "Clusters Missing Azure Policy for Kubernetes",
              "noDataMessage": "All clusters have the Azure Policy Add on for Kubernetes installed.",
              "noDataMessageStyle": 3,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "$gen_group",
                    "formatter": 15,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "subscriptionId",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "resourceGroup",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "id",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "agentLessContainerScan",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Good",
                          "representation": "green",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "redBright",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true,
                "hierarchySettings": {
                  "treeType": 1,
                  "groupBy": [
                    "subscriptionId",
                    "resourceGroup"
                  ],
                  "expandTopLevel": false
                },
                "labelSettings": [
                  {
                    "columnId": "subscriptionId",
                    "label": "Subscription"
                  },
                  {
                    "columnId": "resource",
                    "label": "Cluster"
                  },
                  {
                    "columnId": "resourceGroup",
                    "label": "Resource Group"
                  }
                ]
              }
            },
            "customWidth": "50",
            "name": "missingpolicyaddon",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibilities": [
        {
          "parameterName": "tab",
          "comparison": "isEqualTo",
          "value": "config"
        },
        {
          "parameterName": "cloud",
          "comparison": "isEqualTo",
          "value": "azurecloud"
        }
      ],
      "name": "Configuration - Azure"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Configuration - AWS",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\r\n| where type == \"microsoft.security/securityconnectors\" and properties.environmentName == \"AWS\"\r\n| extend offerings = properties.offerings\r\n|extend hierarchyId = tostring(properties.hierarchyIdentifier)\r\n|where id in~({awsconnectors})\r\n| project id, label =strcat(hierarchyId,\" (\",name,\")\"),\r\n    CSPM = case(offerings has \"DefenderCspmAws\",\"on\",\"off\"),\r\n    Containers = case(offerings has \"DefenderForContainersAws\",\"on\",\"off\")",
              "size": 1,
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "id",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "CSPM",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "on",
                          "representation": "green",
                          "text": "Enabled"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "redBright",
                          "text": "Disabled"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Containers",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "on",
                          "representation": "green",
                          "text": "Enabled"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "redBright",
                          "text": "Disabled"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "accountId",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "subscriptionId",
                    "formatter": 15,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true,
                "labelSettings": [
                  {
                    "columnId": "id",
                    "label": "AWS Connector"
                  },
                  {
                    "columnId": "label",
                    "label": "AWS Account"
                  },
                  {
                    "columnId": "CSPM",
                    "label": "Defender CSPM"
                  },
                  {
                    "columnId": "Containers",
                    "label": "Defender for Containers"
                  }
                ]
              }
            },
            "name": "mdc_plans_enabled",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type == \"microsoft.security/securityconnectors\"\n|extend hierarchyId = tostring(properties.hierarchyIdentifier)\n| where properties[\"environmentName\"]=='AWS'\n| mv-expand offerings = todynamic(properties[\"offerings\"])\n//| where offerings[\"offeringType\"] == \"DefenderCspmAws\"\n| mv-expand extension = offerings\n| extend extensionName = tostring(bag_keys(extension)[0])\n| extend isEnabled = extension[extensionName][\"enabled\"]\n| extend isEnabled = iff(isnull(isEnabled), iff(extensionName == \"ciem\", true, isEnabled) , isEnabled)\n| where isnotnull(isEnabled)\n| extend planSet = pack (tostring(extensionName), tostring(isEnabled))\n| summarize extensions = make_bag(planSet) by ['id'] , ['hierarchyId'], ['name']\n//|where id in~({awsconnectors})\n| project ['id'], label =strcat(['hierarchyId'],\" (\",name,\")\"),\n    mdcContainersAgentlessDiscoveryK8s = iff(isnotnull(extensions.mdcContainersAgentlessDiscoveryK8s), extensions.mdcContainersAgentlessDiscoveryK8s, \"false\"),\n    mdcContainersImageAssessment = iff(isnotnull(extensions.mdcContainersImageAssessment), extensions.mdcContainersImageAssessment, \"false\")",
              "size": 3,
              "showAnalytics": true,
              "title": "Agentless coverage for AWS connectors ",
              "noDataMessage": "No AWS connector found",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "id",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "mdcContainersAgentlessDiscoveryK8s",
                    "formatter": 18,
                    "formatOptions": {
                      "linkColumn": "id",
                      "linkTarget": "OpenBlade",
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "True",
                          "representation": "yellow",
                          "text": "Enabled"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "redBright",
                          "text": "Disabled"
                        }
                      ],
                      "bladeOpenContext": {
                        "bladeName": "AwsAccountSettingsBlade",
                        "extensionName": "Microsoft_Azure_Security",
                        "bladeParameters": [
                          {
                            "name": "connectorId",
                            "source": "column",
                            "value": "id"
                          }
                        ]
                      }
                    }
                  },
                  {
                    "columnMatch": "mdcContainersImageAssessment",
                    "formatter": 18,
                    "formatOptions": {
                      "linkColumn": "id",
                      "linkTarget": "OpenBlade",
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "True",
                          "representation": "yellow",
                          "text": "Enabled"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "redBright",
                          "text": "Disabled"
                        }
                      ],
                      "bladeOpenContext": {
                        "bladeName": "AwsAccountSettingsBlade",
                        "extensionName": "Microsoft_Azure_Security",
                        "bladeParameters": [
                          {
                            "name": "connectorId",
                            "source": "column",
                            "value": "id"
                          }
                        ]
                      }
                    }
                  },
                  {
                    "columnMatch": "dataSensitivityDiscovery",
                    "formatter": 18,
                    "formatOptions": {
                      "linkColumn": "id",
                      "linkTarget": "OpenBlade",
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "True",
                          "representation": "yellow",
                          "text": "Enabled"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "redBright",
                          "text": "Disabled"
                        }
                      ],
                      "bladeOpenContext": {
                        "bladeName": "AwsAccountSettingsBlade",
                        "extensionName": "Microsoft_Azure_Security",
                        "bladeParameters": [
                          {
                            "name": "connectorId",
                            "source": "column",
                            "value": "id"
                          }
                        ]
                      }
                    }
                  },
                  {
                    "columnMatch": "vmScanners",
                    "formatter": 18,
                    "formatOptions": {
                      "linkColumn": "id",
                      "linkTarget": "OpenBlade",
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "True",
                          "representation": "yellow",
                          "text": "Enabled"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "redBright",
                          "text": "Disabled"
                        }
                      ],
                      "bladeOpenContext": {
                        "bladeName": "AwsAccountSettingsBlade",
                        "extensionName": "Microsoft_Azure_Security",
                        "bladeParameters": [
                          {
                            "name": "connectorId",
                            "source": "column",
                            "value": "id"
                          }
                        ]
                      }
                    }
                  },
                  {
                    "columnMatch": "databasesDspm",
                    "formatter": 18,
                    "formatOptions": {
                      "linkColumn": "id",
                      "linkTarget": "OpenBlade",
                      "linkIsContextBlade": false,
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "True",
                          "representation": "yellow",
                          "text": "Enabled"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "redBright",
                          "text": "Disabled"
                        }
                      ],
                      "bladeOpenContext": {
                        "bladeName": "AwsAccountSettingsBlade",
                        "extensionName": "Microsoft_Azure_Security",
                        "bladeParameters": [
                          {
                            "name": "connectorId",
                            "source": "column",
                            "value": "id"
                          }
                        ]
                      }
                    }
                  },
                  {
                    "columnMatch": "ciem",
                    "formatter": 18,
                    "formatOptions": {
                      "linkColumn": "id",
                      "linkTarget": "OpenBlade",
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "True",
                          "representation": "yellow",
                          "text": "Enabled"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "redBright",
                          "text": "Disabled"
                        }
                      ],
                      "bladeOpenContext": {
                        "bladeName": "AwsAccountSettingsBlade",
                        "extensionName": "Microsoft_Azure_Security",
                        "bladeParameters": [
                          {
                            "name": "connectorId",
                            "source": "column",
                            "value": "id"
                          }
                        ]
                      }
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true,
                "labelSettings": [
                  {
                    "columnId": "id",
                    "label": "Connector ID"
                  },
                  {
                    "columnId": "label",
                    "label": "AWS Account"
                  },
                  {
                    "columnId": "mdcContainersAgentlessDiscoveryK8s",
                    "label": "Agentless discovery for Kubernetes"
                  },
                  {
                    "columnId": "mdcContainersImageAssessment",
                    "label": "Container image scanning"
                  }
                ]
              },
              "sortBy": []
            },
            "customWidth": "50",
            "name": "queryAwsDetailedC"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type == \"microsoft.security/securityconnectors\"\n|where id in~({awsconnectors})\n|extend hierarchyId = tostring(properties.hierarchyIdentifier)\n| where properties[\"environmentName\"]=='AWS'\n| mv-expand offerings = todynamic(properties[\"offerings\"])\n| where offerings[\"offeringType\"] == \"DefenderForContainersAws\"\n|extend Sensor = offerings.enableDefenderAgentAutoProvisioning\n|extend Policy = offerings.enablePolicyAgentAutoProvisioning\n|project id, label =strcat(hierarchyId,\" (\",name,\")\"),Sensor, Policy",
              "size": 3,
              "showAnalytics": true,
              "title": "Agent Auto-provisioning coverage for AWS connectors (requires Defender for Containers)",
              "noDataMessage": "No AWS connector found with Defender for Containers enabled",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "id",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Sensor",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "true",
                          "representation": "yellow",
                          "text": "Enabled"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "redBright",
                          "text": "Disabled"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Policy",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "true",
                          "representation": "yellow",
                          "text": "Enabled"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "redBright",
                          "text": "Disabled"
                        }
                      ],
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": []
                      }
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true,
                "labelSettings": [
                  {
                    "columnId": "id",
                    "label": "Connector ID"
                  },
                  {
                    "columnId": "label",
                    "label": "AWS Account"
                  },
                  {
                    "columnId": "Sensor",
                    "label": "Sensor Auto Provisining"
                  },
                  {
                    "columnId": "Policy",
                    "label": "Azure Policy Add-on Auto Provisioning"
                  }
                ]
              },
              "sortBy": []
            },
            "customWidth": "50",
            "name": "queryAwsDetailedC - awsagent"
          }
        ]
      },
      "conditionalVisibilities": [
        {
          "parameterName": "tab",
          "comparison": "isEqualTo",
          "value": "config"
        },
        {
          "parameterName": "cloud",
          "comparison": "isEqualTo",
          "value": "awscloud"
        }
      ],
      "name": "Configuration - AWS"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Configuration - GCP",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\r\n| where type == \"microsoft.security/securityconnectors\" and properties.environmentName == \"GCP\"\r\n| extend offerings = properties.offerings\r\n|where id in~({gcpconnector})\r\n|extend hierarchyId = tostring(properties.hierarchyIdentifier)\r\n| project id, label =strcat(hierarchyId,\" (\",name,\")\"),\r\n    CSPM = case(offerings has \"DefenderCspmGcp\",\"on\",\"off\"),\r\n    Containers = case(offerings has \"DefenderForContainersGcp\",\"on\",\"off\")",
              "size": 1,
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "id",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "CSPM",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "on",
                          "representation": "green",
                          "text": "Enabled"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "redBright",
                          "text": "Disabled"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Containers",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "on",
                          "representation": "green",
                          "text": "Enabled"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "redBright",
                          "text": "Disabled"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "subscriptionId",
                    "formatter": 15,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true,
                "labelSettings": [
                  {
                    "columnId": "id",
                    "label": "Connector ID"
                  },
                  {
                    "columnId": "label",
                    "label": "GCP Project"
                  },
                  {
                    "columnId": "CSPM",
                    "label": "Defender CSPM"
                  },
                  {
                    "columnId": "Containers",
                    "label": "Defender for Containers"
                  }
                ]
              }
            },
            "name": "mdc_plans_enabled",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type == \"microsoft.security/securityconnectors\"\n| where properties[\"environmentName\"]=='GCP'\n|extend hierarchyId = tostring(properties.hierarchyIdentifier)\n|where id in~({gcpconnector})\n| mv-expand offerings = todynamic(properties[\"offerings\"])\n//| where offerings[\"offeringType\"] == \"DefenderCspmGcp\"\n| mv-expand extension = offerings\n| extend extensionName = tostring(bag_keys(extension)[0])\n| extend isEnabled = extension[extensionName][\"enabled\"]\n| extend isEnabled = iff(isnull(isEnabled), iff(extensionName == \"ciem\", true, isEnabled) , isEnabled)\n| where isnotnull(isEnabled)\n| extend planSet = pack (tostring(extensionName), tostring(isEnabled))\n| summarize extensions = make_bag(planSet) by ['id'], ['hierarchyId'], ['name']\n| project ['id'],label =strcat(hierarchyId,\" (\",name,\")\"),\n    mdcContainersAgentlessDiscoveryK8s = iff(isnotnull(extensions.mdcContainersAgentlessDiscoveryK8s), extensions.mdcContainersAgentlessDiscoveryK8s, \"false\"),\n    mdcContainersImageAssessment = iff(isnotnull(extensions.mdcContainersImageAssessment), extensions.mdcContainersImageAssessment, \"false\")",
              "size": 3,
              "showAnalytics": true,
              "title": "Agentless coverage for GCP connectors ",
              "noDataMessage": "No GCP connector found",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "id",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "mdcContainersAgentlessDiscoveryK8s",
                    "formatter": 18,
                    "formatOptions": {
                      "linkColumn": "id",
                      "linkTarget": "OpenBlade",
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "True",
                          "representation": "yellow",
                          "text": "Enabled"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "redBright",
                          "text": "Disabled"
                        }
                      ],
                      "bladeOpenContext": {
                        "bladeName": "AwsAccountSettingsBlade",
                        "extensionName": "Microsoft_Azure_Security",
                        "bladeParameters": [
                          {
                            "name": "connectorId",
                            "source": "column",
                            "value": "id"
                          }
                        ]
                      }
                    }
                  },
                  {
                    "columnMatch": "mdcContainersImageAssessment",
                    "formatter": 18,
                    "formatOptions": {
                      "linkColumn": "id",
                      "linkTarget": "OpenBlade",
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "True",
                          "representation": "yellow",
                          "text": "Enabled"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "redBright",
                          "text": "Disabled"
                        }
                      ],
                      "bladeOpenContext": {
                        "bladeName": "AwsAccountSettingsBlade",
                        "extensionName": "Microsoft_Azure_Security",
                        "bladeParameters": [
                          {
                            "name": "connectorId",
                            "source": "column",
                            "value": "id"
                          }
                        ]
                      }
                    }
                  },
                  {
                    "columnMatch": "dataSensitivityDiscovery",
                    "formatter": 18,
                    "formatOptions": {
                      "linkColumn": "id",
                      "linkTarget": "OpenBlade",
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "True",
                          "representation": "yellow",
                          "text": "Enabled"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "redBright",
                          "text": "Disabled"
                        }
                      ],
                      "bladeOpenContext": {
                        "bladeName": "AwsAccountSettingsBlade",
                        "extensionName": "Microsoft_Azure_Security",
                        "bladeParameters": [
                          {
                            "name": "connectorId",
                            "source": "column",
                            "value": "id"
                          }
                        ]
                      }
                    }
                  },
                  {
                    "columnMatch": "vmScanners",
                    "formatter": 18,
                    "formatOptions": {
                      "linkColumn": "id",
                      "linkTarget": "OpenBlade",
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "True",
                          "representation": "yellow",
                          "text": "Enabled"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "redBright",
                          "text": "Disabled"
                        }
                      ],
                      "bladeOpenContext": {
                        "bladeName": "AwsAccountSettingsBlade",
                        "extensionName": "Microsoft_Azure_Security",
                        "bladeParameters": [
                          {
                            "name": "connectorId",
                            "source": "column",
                            "value": "id"
                          }
                        ]
                      }
                    }
                  },
                  {
                    "columnMatch": "databasesDspm",
                    "formatter": 18,
                    "formatOptions": {
                      "linkColumn": "id",
                      "linkTarget": "OpenBlade",
                      "linkIsContextBlade": false,
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "True",
                          "representation": "yellow",
                          "text": "Enabled"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "redBright",
                          "text": "Disabled"
                        }
                      ],
                      "bladeOpenContext": {
                        "bladeName": "AwsAccountSettingsBlade",
                        "extensionName": "Microsoft_Azure_Security",
                        "bladeParameters": [
                          {
                            "name": "connectorId",
                            "source": "column",
                            "value": "id"
                          }
                        ]
                      }
                    }
                  },
                  {
                    "columnMatch": "ciem",
                    "formatter": 18,
                    "formatOptions": {
                      "linkColumn": "id",
                      "linkTarget": "OpenBlade",
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "True",
                          "representation": "yellow",
                          "text": "Enabled"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "redBright",
                          "text": "Disabled"
                        }
                      ],
                      "bladeOpenContext": {
                        "bladeName": "AwsAccountSettingsBlade",
                        "extensionName": "Microsoft_Azure_Security",
                        "bladeParameters": [
                          {
                            "name": "connectorId",
                            "source": "column",
                            "value": "id"
                          }
                        ]
                      }
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true,
                "labelSettings": [
                  {
                    "columnId": "id",
                    "label": "Connector ID"
                  },
                  {
                    "columnId": "label",
                    "label": "GCP Project"
                  },
                  {
                    "columnId": "mdcContainersAgentlessDiscoveryK8s",
                    "label": "Agentless discovery for Kubernetes"
                  },
                  {
                    "columnId": "mdcContainersImageAssessment",
                    "label": "Container image scanning"
                  }
                ]
              },
              "sortBy": []
            },
            "customWidth": "50",
            "name": "queryGcpDetailedC"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type == \"microsoft.security/securityconnectors\"\n|where id in~({gcpconnector})\n|extend hierarchyId = tostring(properties.hierarchyIdentifier)\n| where properties[\"environmentName\"]=='GCP'\n| mv-expand offerings = todynamic(properties[\"offerings\"])\n| where offerings[\"offeringType\"] == \"DefenderForContainersGcp\"\n|extend Sensor = offerings.enableDefenderAgentAutoProvisioning\n|extend Policy = offerings.enablePolicyAgentAutoProvisioning\n|project id, label =strcat(hierarchyId,\" (\",name,\")\"),Sensor, Policy",
              "size": 3,
              "showAnalytics": true,
              "title": "Agent Auto-provisioning coverage for GCP connectors (requires Defender for Containers)",
              "noDataMessage": "No GCP connector with Defender for Containers enabled.",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "id",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Sensor",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "true",
                          "representation": "yellow",
                          "text": "Enabled"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "redBright",
                          "text": "Disabled"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Policy",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "true",
                          "representation": "yellow",
                          "text": "Enabled"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "redBright",
                          "text": "Disabled"
                        }
                      ],
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": []
                      }
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true,
                "labelSettings": [
                  {
                    "columnId": "id",
                    "label": "Connector ID"
                  },
                  {
                    "columnId": "label",
                    "label": "GCP Project"
                  },
                  {
                    "columnId": "Sensor",
                    "label": "Sensor Auto Provisining"
                  },
                  {
                    "columnId": "Policy",
                    "label": "Azure Policy Add-on Auto Provisioning"
                  }
                ]
              },
              "sortBy": []
            },
            "customWidth": "50",
            "name": "queryGcpDetailedC - gcpagent"
          }
        ]
      },
      "conditionalVisibilities": [
        {
          "parameterName": "tab",
          "comparison": "isEqualTo",
          "value": "config"
        },
        {
          "parameterName": "cloud",
          "comparison": "isEqualTo",
          "value": "gcpcloud"
        }
      ],
      "name": "Configuration GCP"
    },
    {
      "type": 1,
      "content": {
        "json": "## Kubernetes Alerts"
      },
      "conditionalVisibility": {
        "parameterName": "tab",
        "comparison": "isEqualTo",
        "value": "alerts"
      },
      "name": "alerttitle"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "{subscription}"
        ],
        "parameters": [
          {
            "id": "1b0da6e0-7a43-4261-bfc0-ce4d708338d3",
            "version": "KqlParameterItem/1.0",
            "name": "effectedresource",
            "type": 1,
            "query": "securityresources\r\n    | where type =~ 'microsoft.security/locations/alerts'\r\n    | where properties.[\"AlertDisplayName\"] !startswith ('[SAMPLE ALERT]')\r\n    | where isnotempty(resourceGroup)\r\n    | extend affectedResourceId = extract('\"AzureResourceId\"\\\\s*:\\\\s*\"([^\"]*)\"', 1, tostring(properties.ResourceIdentifiers))\r\n    | project affectedResourceId = tolower(affectedResourceId), resourceGroup = tolower(resourceGroup)\r\n    | join kind=innerunique(\r\n        resources\r\n            |where type =~ 'microsoft.containerservice/managedclusters' or type =~ 'microsoft.kubernetes/connectedclusters'\r\n            | project id = tolower(id)\r\n    )\r\n    on $left.affectedResourceId == $right.id\r\n    | summarize affectedRes = tostring(dcount(affectedResourceId))",
            "crossComponentResources": [
              "{subscription}"
            ],
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.resourcegraph/resources"
      },
      "conditionalVisibility": {
        "parameterName": "tab",
        "comparison": "isEqualTo",
        "value": "false"
      },
      "name": "Alert_Effected_Resources"
    },
    {
      "type": 1,
      "content": {
        "json": "# No Alerts Found!",
        "style": "info"
      },
      "conditionalVisibilities": [
        {
          "parameterName": "effectedresource",
          "comparison": "isEqualTo",
          "value": "0"
        },
        {
          "parameterName": "tab",
          "comparison": "isEqualTo",
          "value": "alerts"
        }
      ],
      "name": "Alert_NoFoound"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "securityresources\r\n    | where type =~ \"microsoft.security/locations/alerts\"\r\n    | extend isAzure = tostring(properties.ResourceIdentifiers) matches regex '\"Type\"\\\\s*:\\\\s*\"AzureResource\"'\r\n    | extend AlertDisplayName = properties.[\"AlertDisplayName\"]\r\n    | extend Severity = properties.[\"Severity\"]\r\n    | extend Status = properties.[\"Status\"]\r\n    | extend affectedResourceId = extract('\"AzureResourceId\"\\\\s*:\\\\s*\"([^\"]*)\"', 1, tostring(properties.ResourceIdentifiers))\r\n    | extend hostName = iff(isAzure, \"\", extract('\"HostName\"\\\\s*:\\\\s*\"([^\"]*)\"', 1, tostring(properties.Entities)))\r\n    | extend splitAffectedResourceId = split(affectedResourceId, \"/\")\r\n    | extend resourceNameIndex = iff(array_length(splitAffectedResourceId) > 1, array_length(splitAffectedResourceId) - 1, 0)\r\n    | extend affectedResourceName = iff(isAzure, splitAffectedResourceId[resourceNameIndex], iff(isempty(hostName), \"Non-Azure\", hostName))\r\n    | extend ResourceIdentifiers = properties.[\"ResourceIdentifiers\"]\r\n    | mv-expand ResourceIdentifiers\r\n    | extend ResourceId = parse_json(ResourceIdentifiers).[\"AzureResourceId\"]\r\n    | extend Resource = tolower(tostring(ResourceId))\r\n    | project-away resourceNameIndex, splitAffectedResourceId, hostName\r\n    | project\r\n            affectedResourceId = tolower(affectedResourceId),\r\n            tostring(Severity),\r\n            AlertDisplayName,\r\n            Status,\r\n            ResourceGroup = tolower(resourceGroup),\r\n            Resource\r\n    | join kind=inner \r\n        (\r\n            resources\r\n                |where type in~ ({k8sarc})\r\n                | project id = tolower(id)\r\n        ) on $left.affectedResourceId == $right.id\r\n    | where Resource in~ ({k8sclu})\r\n    | where Severity in~ ({severity})\r\n    | where Status == \"Active\"\r\n    | where AlertDisplayName !startswith ('[SAMPLE ALERT]')\r\n    | project (Severity)\r\n    | summarize count() by Severity\r\n    | order by count_ desc",
        "size": 4,
        "title": "Alerts by Severity",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "{subscription}"
        ],
        "visualization": "tiles",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Severity",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": "contains",
                    "thresholdValue": "High",
                    "representation": "redBright",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "Medium",
                    "representation": "orange",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "Low",
                    "representation": "yellow",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "Informational",
                    "representation": "gray",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "text": "{0}{1}"
                  }
                ]
              }
            },
            {
              "columnMatch": "SystemAlertId",
              "formatter": 5
            },
            {
              "columnMatch": "IsIncident",
              "formatter": 1
            },
            {
              "columnMatch": "AlertURI",
              "formatter": 5
            },
            {
              "columnMatch": "SubscriptionId",
              "formatter": 15,
              "formatOptions": {
                "linkTarget": "Resource",
                "showIcon": true
              }
            },
            {
              "columnMatch": "Location",
              "formatter": 5
            },
            {
              "columnMatch": "ResourceId",
              "formatter": 5
            }
          ],
          "sortBy": [
            {
              "itemKey": "Tactics",
              "sortOrder": 2
            }
          ],
          "labelSettings": [
            {
              "columnId": "AlertDisplayName",
              "label": "Alert Name"
            },
            {
              "columnId": "IsIncident",
              "label": "Incident/alert"
            },
            {
              "columnId": "ResourceGroup",
              "label": "Resource Group"
            },
            {
              "columnId": "Resource",
              "label": "Kubernetes Cluster"
            }
          ]
        },
        "sortBy": [
          {
            "itemKey": "Tactics",
            "sortOrder": 2
          }
        ],
        "tileSettings": {
          "titleContent": {
            "columnMatch": "Severity",
            "formatter": 18,
            "formatOptions": {
              "thresholdsOptions": "icons",
              "thresholdsGrid": [
                {
                  "operator": "==",
                  "thresholdValue": "High",
                  "representation": "Sev0",
                  "text": "{0}{1}"
                },
                {
                  "operator": "==",
                  "thresholdValue": "Low",
                  "representation": "Sev2",
                  "text": "{0}{1}"
                },
                {
                  "operator": "==",
                  "thresholdValue": "Medium",
                  "representation": "Sev1",
                  "text": "{0}{1}"
                },
                {
                  "operator": "==",
                  "thresholdValue": "Informational",
                  "representation": "Sev3",
                  "text": "{0}{1}"
                },
                {
                  "operator": "Default",
                  "thresholdValue": null,
                  "representation": "unknown",
                  "text": "{0}{1}"
                }
              ],
              "compositeBarSettings": {
                "labelText": "",
                "columnSettings": [
                  {
                    "columnName": "Severity",
                    "color": "blue"
                  }
                ]
              }
            }
          },
          "leftContent": {
            "columnMatch": "count_",
            "formatter": 12,
            "formatOptions": {
              "palette": "none"
            }
          },
          "showBorder": true,
          "sortCriteriaField": "count_",
          "sortOrderField": 2
        },
        "mapSettings": {
          "locInfo": "LatLong",
          "sizeSettings": "count_",
          "sizeAggregation": "Sum",
          "legendMetric": "count_",
          "legendAggregation": "Sum",
          "itemColorSettings": {
            "type": "heatmap",
            "colorAggregation": "Sum",
            "nodeColorField": "count_",
            "heatmapPalette": "greenRed"
          }
        },
        "textSettings": {
          "style": "bignumber"
        }
      },
      "conditionalVisibilities": [
        {
          "parameterName": "tab",
          "comparison": "isEqualTo",
          "value": "alerts"
        },
        {
          "parameterName": "effectedresource",
          "comparison": "isNotEqualTo",
          "value": "0"
        }
      ],
      "name": "Alert_K8s_Alerts_Summary"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "securityresources\r\n    | where type =~ \"microsoft.security/locations/alerts\"\r\n    | extend isAzure = tostring(properties.ResourceIdentifiers) matches regex '\"Type\"\\\\s*:\\\\s*\"AzureResource\"'\r\n    | extend IsIncident = properties.[\"IsIncident\"]\r\n    | extend AlertDisplayName = properties.[\"AlertDisplayName\"]\r\n    | extend SystemAlertId = properties.[\"SystemAlertId\"]\r\n    | extend Severity = properties.[\"Severity\"]\r\n    | extend AlertUri = properties.[\"AlertUri\"]\r\n    | extend Status = properties.[\"Status\"]\r\n    | extend Tactics = properties.[\"Intent\"]\r\n    | extend affectedResourceId = extract('\"AzureResourceId\"\\\\s*:\\\\s*\"([^\"]*)\"', 1, tostring(properties.ResourceIdentifiers))\r\n    | extend hostName = iff(isAzure, \"\", extract('\"HostName\"\\\\s*:\\\\s*\"([^\"]*)\"', 1, tostring(properties.Entities)))\r\n    | extend splitAffectedResourceId = split(affectedResourceId, \"/\")\r\n    | extend resourceNameIndex = iff(array_length(splitAffectedResourceId) > 1, array_length(splitAffectedResourceId) - 1, 0)\r\n    | extend affectedResourceName = iff(isAzure, splitAffectedResourceId[resourceNameIndex], iff(isempty(hostName), \"Non-Azure\", hostName))\r\n    | extend ResourceIdentifiers = properties.[\"ResourceIdentifiers\"]\r\n    | mv-expand ResourceIdentifiers\r\n    | extend ResourceId = parse_json(ResourceIdentifiers).[\"AzureResourceId\"]\r\n    | extend Resource = tolower(tostring(ResourceId))\r\n    | parse AlertUri with * '/subscriptionId/'  SubscriptionId  '/' *\r\n    | parse AlertUri with * '/resourceGroup/'  ResourceGroup  '/' *\r\n    | parse AlertUri with * '/location/'  Location  \r\n    | project-away \r\n        resourceNameIndex, \r\n        splitAffectedResourceId, \r\n        hostName\r\n    | project\r\n        alertId = id,\r\n        subscriptionId,\r\n        alertProperties = properties,\r\n        affectedResourceId = tolower(affectedResourceId),\r\n        tostring(Severity),\r\n        SystemAlertId,\r\n        AlertDisplayName,\r\n        IsIncident = iif(IsIncident == \"true\", \"Incident\", \"Alert\"),\r\n        AlertUri,\r\n        Status,\r\n        Tactics,\r\n        SubscriptionId,\r\n        Location,\r\n        ResourceId,\r\n        ResourceIdentifier=properties.[\"ResourceIdentifiers\"],\r\n        Resource,\r\n        dateTime = format_datetime(todatetime(properties.[\"TimeGeneratedUtc\"]), 'MM/d/yyyy h:m:s tt')\r\n| join kind=inner \r\n    (\r\n        resources\r\n            |where type in~ ({k8sarc})\r\n            | project id = tolower(id)\r\n    ) on $left.affectedResourceId == $right.id\r\n| extend id = alertId, subscriptionId, properties = alertProperties\r\n| extend ResourceGroup = substring(id,Â 0,Â indexof(id,Â '/providers'))\r\n| where Resource in~ ({k8sclu})\r\n| where Severity in~ ({severity})\r\n| where Status == \"Active\"\r\n| where AlertDisplayName !startswith ('[SAMPLE ALERT]')\r\n| project\r\n    (Severity),\r\n    tostring(SystemAlertId),\r\n    tostring(AlertDisplayName),\r\n    IsIncident = iif(IsIncident == \"true\", \"Incident\", \"Alert\"),\r\n    AlertURI = tostring(AlertUri),\r\n    tostring(Status),\r\n    tostring(Tactics),\r\n    SubscriptionId,\r\n    ResourceGroup,\r\n    Location,\r\n    tostring(ResourceId),\r\n    Resource, dateTime\r\n| distinct\r\n    dateTime,\r\n    Severity,\r\n    SystemAlertId,\r\n    AlertDisplayName,\r\n    IsIncident,\r\n    Status,\r\n    Tactics,\r\n    SubscriptionId,\r\n    ResourceGroup,\r\n    Location,\r\n    ResourceId,\r\n    Resource,\r\n    AlertURI\r\n| order by dateTime desc",
        "size": 2,
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "{subscription}"
        ],
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "dateTime",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "Clock",
                    "text": "{0}{1}"
                  }
                ],
                "customColumnWidthSetting": "24ch"
              }
            },
            {
              "columnMatch": "Severity",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": "contains",
                    "thresholdValue": "High",
                    "representation": "redBright",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "Medium",
                    "representation": "orange",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "Low",
                    "representation": "yellow",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "Informational",
                    "representation": "blue",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "text": "{0}{1}"
                  }
                ],
                "customColumnWidthSetting": "15ch"
              }
            },
            {
              "columnMatch": "SystemAlertId",
              "formatter": 5
            },
            {
              "columnMatch": "IsIncident",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "Alert",
                    "representation": "error",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Incident",
                    "representation": "failed",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": null,
                    "text": "{0}{1}"
                  }
                ],
                "customColumnWidthSetting": "20ch"
              }
            },
            {
              "columnMatch": "Status",
              "formatter": 1
            },
            {
              "columnMatch": "Tactics",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "Persistence",
                    "representation": "Persistence",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Execution",
                    "representation": "Execution",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "InitialAccess",
                    "representation": "Initial_Access",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "PrivilegeEscalation",
                    "representation": "Privilege Escalation",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "DefenseEvasion",
                    "representation": "Defense Evasion",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "CredentialAccess",
                    "representation": "Credential Access",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Discovery",
                    "representation": "Discovery",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "LateralMovement",
                    "representation": "Lateral_Movement",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Impact",
                    "representation": "Impact",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "Cancelled",
                    "text": "{0}{1}"
                  }
                ]
              }
            },
            {
              "columnMatch": "SubscriptionId",
              "formatter": 15,
              "formatOptions": {
                "linkTarget": "Resource",
                "showIcon": true
              }
            },
            {
              "columnMatch": "ResourceGroup",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "38ch"
              }
            },
            {
              "columnMatch": "Location",
              "formatter": 5
            },
            {
              "columnMatch": "ResourceId",
              "formatter": 5
            },
            {
              "columnMatch": "Resource",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "50ch"
              }
            },
            {
              "columnMatch": "AlertURI",
              "formatter": 7,
              "formatOptions": {
                "linkColumn": "AlertURI",
                "linkTarget": "Url",
                "linkLabel": "Alert Url",
                "customColumnWidthSetting": "10ch"
              }
            }
          ],
          "rowLimit": 1000,
          "filter": true,
          "labelSettings": [
            {
              "columnId": "dateTime",
              "label": "Date and time"
            },
            {
              "columnId": "AlertDisplayName",
              "label": "Alert name"
            },
            {
              "columnId": "IsIncident",
              "label": "Incident/alert"
            },
            {
              "columnId": "SubscriptionId",
              "label": "Subscription"
            },
            {
              "columnId": "ResourceGroup",
              "label": "Resource group"
            },
            {
              "columnId": "Resource",
              "label": "Kubernetes cluster"
            },
            {
              "columnId": "AlertURI",
              "label": "URL"
            }
          ]
        },
        "sortBy": []
      },
      "conditionalVisibilities": [
        {
          "parameterName": "tab",
          "comparison": "isEqualTo",
          "value": "alerts"
        },
        {
          "parameterName": "effectedresource",
          "comparison": "isNotEqualTo",
          "value": "0"
        }
      ],
      "name": "Alert_K8s_Alerts_List"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "5dc6b0fd-3773-4d03-b9c7-1a72ca524b46",
            "version": "KqlParameterItem/1.0",
            "name": "k8srecommendation",
            "label": "Show recommendations",
            "type": 10,
            "isRequired": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[\r\n    {\"value\": \"Yes\", \"label\": \"Yes\"},\r\n    {\"value\": \"No\", \"label\": \"No\", \"selected\":true}\r\n]",
            "timeContext": {
              "durationMs": 86400000
            },
            "value": "Yes"
          }
        ],
        "style": "above",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "conditionalVisibility": {
        "parameterName": "tab",
        "comparison": "isEqualTo",
        "value": "Hareden"
      },
      "name": "k8s_Show_Security_Recommendations"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## Azure running containers - Vulnerabilities\r\nThis dashboard is powered by the recommendation [\"Azure running container images should have vulnerability findings resolved (powered by Microsoft Defender Vulnerability Management)\"](https://portal.azure.com/#view/Microsoft_Azure_Security_CloudNativeCompute/ContainersRuntimeRecommendationDetailsBlade/assessmentKey/c609cf0f-71ab-41e9-a3c6-9a1f7fe1b8d5). Click [here](https://learn.microsoft.com/en-us/azure/defender-for-cloud/agentless-vulnerability-assessment-azure) to learn more about how the scanning works. "
            },
            "conditionalVisibilities": [
              {
                "parameterName": "tab",
                "comparison": "isEqualTo",
                "value": "k8smdvm"
              },
              {
                "parameterName": "runtimecloud",
                "comparison": "isEqualTo",
                "value": "azure"
              }
            ],
            "name": "k8s_Vulnerability_Text -MDVM"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\r\n    | where type == \"microsoft.security/assessments/subassessments\"\r\n    | extend Resource = tolower(extract(@'(?i)(.*?)/providers/Microsoft.Security/([^/]+)', 1, id))\r\n    | extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id) \r\n    | extend ResourceType = strcat(tolower(split(id,\"/\").[6]), \"/\",tolower(split(id,\"/\").[7]))\r\n    | extend severity = tostring(properties.additionalData.vulnerabilityDetails.severity)\r\n    | extend Status = tostring(properties.status.code)\r\n    | extend ResourceGroup = tolower(trim_end(\"/\",extract(\".*resourceGroups/(.+?)/\",0,id)))\r\n    | extend vulId = tostring(properties.id)\r\n    | where assessmentKey == \"c609cf0f-71ab-41e9-a3c6-9a1f7fe1b8d5\" and Status == 'Unhealthy'\r\n    | where ResourceType in~ ({k8sarc}) \r\n    | where Resource in~ ({k8sclu})\r\n    | distinct \r\n        vulId, \r\n        severity\r\n    | summarize count() by tostring(severity)\r\n    | order by count_ desc",
              "size": 4,
              "title": "Vulnerabilities by Severity",
              "noDataMessage": "No vulnerabilities found",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "visualization": "piechart",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "Category",
                  "formatter": 1,
                  "numberFormat": {
                    "unit": 0,
                    "options": {
                      "style": "decimal"
                    },
                    "emptyValCustomText": "Other"
                  }
                },
                "leftContent": {
                  "columnMatch": "count_",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 2,
                      "maximumSignificantDigits": 3
                    }
                  }
                },
                "showBorder": true
              }
            },
            "customWidth": "50",
            "conditionalVisibility": {
              "parameterName": "tab",
              "comparison": "isEqualTo",
              "value": "k8smdvm"
            },
            "name": "K8s_Vulnerabilities_Seveirty_MDVM"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\r\n    | where type == \"microsoft.security/assessments/subassessments\"\r\n    | extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n    | where assessmentKey == \"c609cf0f-71ab-41e9-a3c6-9a1f7fe1b8d5\"\r\n   | extend Resource = tolower(extract(@'(?i)(.*?)/providers/Microsoft.Security/([^/]+)', 1, id))\r\n    | extend VulnId = tostring(parse_json(properties).id)\r\n    | extend Status = tostring(parse_json(properties).status.code)\r\n    | extend Severity=tostring(parse_json(properties).additionalData.vulnerabilityDetails.severity)\r\n    | extend Cluster = tolower(extract(@'(?i)(.*?)/providers/Microsoft.Security/([^/]+)', 1, id))\r\n    | where Resource in~ ({k8sclu})\r\n    | extend fixStatus = parse_json(properties.additionalData).softwareDetails.fixStatus\r\n        | extend Distro = tostring(properties.additionalData.softwareDetails.osDetails.osVersion), imageUri = properties.resourceDetails.id, CVSS3_0 = tostring(properties.additionalData.cvssV30Score), PackageName = tostring(properties.additionalData.softwareDetails.packageName),\r\n             Evidence = tostring(properties.additionalData.softwareDetails.evidence), VulnerabilityCategory = tostring(properties.additionalData.softwareDetails.category), \r\n             PackageVersion = tostring(properties.additionalData.softwareDetails.version), Published = tostring(properties.additionalData.vulnerabilityDetails.publishedDate),\r\n\t     FixedVersion = tostring(properties.additionalData.softwareDetails.fixedVersion), Description = tostring(properties.description), Remediation = tostring(properties.remediation)\r\n    |extend Vendor = tostring(parse_json(properties).additionalData.softwareDetails.vendor)\r\n    |extend OsDistribution = tostring(parse_json(properties).additionalData.softwareDetails.osDetails.osPlatform)\r\n   |mv-expand references = todynamic(parse_json(properties).[\"additionalData\"].[\"vulnerabilityDetails\"].[\"references\"])\r\n|extend referenceLink = references.link\r\n    |extend Tags =  tostring(properties.additionalData.artifactDetails.tags)\r\n    |extend Tags = replace(\"\\\\[|\\\\]|\\\"\", \"\", Tags)\r\n    | extend imageUri = properties.resourceDetails.id,\r\n    isExploitStepsPublished=iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.isPubliclyDisclosed==\"true\",\"Yes\",\"No\"),\r\n            isInExploitKit=iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.isInExploitKit==\"true\",\"Yes\",\"No\"),\r\n            isVerified= iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.isVerified==\"true\",\"Yes\",\"No\")\r\n | project       \r\n        Cluster,\r\n        imageUri,\r\n        VulnId, \r\n        Status,\r\n        Severity,\r\n        tostring(fixStatus),\r\n        isExploitStepsPublished,\r\n        isVerified,\r\n        isInExploitKit,\r\n        CVSS3_0,\r\n        Tags,\r\n        Distro,\r\n        Vendor,\r\n        OsDistribution,\r\n        VulnerabilityCategory,\r\n        Evidence,\r\n        PackageVersion,\r\n        FixedVersion,\r\n        Published,\r\n      Remediation,  \r\n       Description,\r\n        referenceLink\r\n    | where Status == 'Unhealthy'\r\n   | where isExploitStepsPublished == \"Yes\" or isInExploitKit == \"Yes\" or isVerified == \"Yes\"\r\n    | project-away Status ",
              "size": 1,
              "title": "Exploitable Vulnerablities",
              "noDataMessage": "No exploitable vulnerabilities found",
              "exportedParameters": [
                {
                  "fieldName": "RepositoryName",
                  "parameterName": "acrRepositoryName",
                  "defaultValue": "All"
                },
                {
                  "fieldName": "description",
                  "parameterName": "acrDescription",
                  "parameterType": 1
                },
                {
                  "fieldName": "remediation",
                  "parameterName": "acrRemediation",
                  "parameterType": 1
                },
                {
                  "fieldName": "Issue",
                  "parameterName": "acrIssue",
                  "parameterType": 1
                },
                {
                  "fieldName": "VulnId",
                  "parameterName": "acrVulnId",
                  "parameterType": 1
                },
                {
                  "fieldName": "Severity",
                  "parameterName": "acrSeverity",
                  "parameterType": 1
                },
                {
                  "fieldName": "PublishedDate",
                  "parameterName": "acrPublishedDate",
                  "parameterType": 1
                },
                {
                  "fieldName": "fixStatus",
                  "parameterName": "acrFixStatus",
                  "parameterType": 1
                },
                {
                  "fieldName": "itemSelected",
                  "parameterName": "acrItemSelected",
                  "parameterType": 1,
                  "defaultValue": "false"
                },
                {
                  "fieldName": "cvss20Vector",
                  "parameterName": "acrCvss20Vector",
                  "parameterType": 1
                },
                {
                  "fieldName": "cvss30Vector",
                  "parameterName": "acrCvss30Vector",
                  "parameterType": 1
                },
                {
                  "parameterType": 1
                },
                {
                  "fieldName": "isInExploitKit",
                  "parameterName": "acrExploitKit",
                  "parameterType": 1
                },
                {
                  "fieldName": "isVerified",
                  "parameterName": "acrVerified",
                  "parameterType": 1
                },
                {
                  "fieldName": "isExploitStepsPublished",
                  "parameterName": "acrVulnPublished",
                  "parameterType": 1
                },
                {
                  "fieldName": "referenceLinks",
                  "parameterName": "acrReferences",
                  "parameterType": 1
                }
              ],
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Severity",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Critical",
                          "representation": "redBright",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Medium",
                          "representation": "yellow",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Low",
                          "representation": "blue",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "High",
                          "representation": "orange",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "fixStatus",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "FixAvailable",
                          "representation": "success",
                          "text": "Fix Available"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Unknown",
                          "representation": "unknown",
                          "text": "Unknown"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "unknown",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "isExploitStepsPublished",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "2",
                          "text": "Yes"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "success",
                          "text": "No"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "success",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "isVerified",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "Yes"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "4",
                          "text": "No"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "success",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "isInExploitKit",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "warning",
                          "text": "Yes"
                        },
                        {
                          "operator": "==",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "Available",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "unknown",
                          "text": "{0}{1}"
                        }
                      ]
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "CVSS3_0",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "max": 10,
                      "palette": "greenRed",
                      "customColumnWidthSetting": "15ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "minimumFractionDigits": 1
                      }
                    }
                  },
                  {
                    "columnMatch": "Published",
                    "formatter": 6
                  },
                  {
                    "columnMatch": "Resource",
                    "formatter": 13,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true,
                      "customColumnWidthSetting": "30ch"
                    }
                  },
                  {
                    "columnMatch": "itemSelected",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "subscriptionId",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "PublishedDate",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "25ch"
                    }
                  },
                  {
                    "columnMatch": "cvss30score",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "palette": "greenRed",
                      "customColumnWidthSetting": "15ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "minimumFractionDigits": 1
                      }
                    }
                  },
                  {
                    "columnMatch": "cvss30Vector",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "description",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "remediation",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "referenceLinks",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "referenceTitle",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "link",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "category",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Issue",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "cvss20score",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "palette": "greenRed",
                      "customColumnWidthSetting": "15ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "maximumFractionDigits": 1
                      },
                      "emptyValCustomText": "N/A"
                    }
                  },
                  {
                    "columnMatch": "cvss20Vector",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "impact",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "PublishedTime",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "25ch"
                    }
                  },
                  {
                    "columnMatch": "Patchable",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "disabled",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "more",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "cveTitle",
                    "formatter": 1,
                    "formatOptions": {
                      "linkColumn": "cveURL",
                      "linkTarget": "Url"
                    }
                  },
                  {
                    "columnMatch": "cveURL",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "vendorReferencesTitle",
                    "formatter": 1,
                    "formatOptions": {
                      "linkColumn": "vendorReferencesURL",
                      "linkTarget": "Url"
                    }
                  },
                  {
                    "columnMatch": "vendorReferencesURL",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "timeGenerated",
                    "formatter": 6
                  }
                ],
                "rowLimit": 1000,
                "filter": true,
                "labelSettings": [
                  {
                    "columnId": "Cluster",
                    "label": "Cluster"
                  },
                  {
                    "columnId": "imageUri",
                    "label": "Image URI"
                  },
                  {
                    "columnId": "VulnId",
                    "label": "Vulnerability Id"
                  },
                  {
                    "columnId": "Severity",
                    "label": "Severity"
                  },
                  {
                    "columnId": "fixStatus",
                    "label": "Fix Status"
                  },
                  {
                    "columnId": "isExploitStepsPublished",
                    "label": "Exploit Steps Published"
                  },
                  {
                    "columnId": "isVerified",
                    "label": "Exploit Steps Verifiable"
                  },
                  {
                    "columnId": "isInExploitKit",
                    "label": "In Exploit Kit"
                  },
                  {
                    "columnId": "CVSS3_0",
                    "label": "CVSS Score"
                  },
                  {
                    "columnId": "Tags",
                    "label": "Tags"
                  },
                  {
                    "columnId": "Distro",
                    "label": "Distro"
                  },
                  {
                    "columnId": "Vendor",
                    "label": "Vendor"
                  },
                  {
                    "columnId": "OsDistribution",
                    "label": "OS Distribution"
                  },
                  {
                    "columnId": "VulnerabilityCategory",
                    "label": "Vulnerability Category"
                  },
                  {
                    "columnId": "Evidence",
                    "label": "Evidence (OS Packages only)"
                  },
                  {
                    "columnId": "PackageVersion",
                    "label": "Package Version"
                  },
                  {
                    "columnId": "FixedVersion",
                    "label": "Fixed Version"
                  },
                  {
                    "columnId": "Published",
                    "label": "Published Date"
                  },
                  {
                    "columnId": "Remediation",
                    "label": "Remediation"
                  },
                  {
                    "columnId": "Description",
                    "label": "Description"
                  },
                  {
                    "columnId": "referenceLink",
                    "label": "Reference Link"
                  }
                ]
              },
              "sortBy": []
            },
            "customWidth": "100",
            "conditionalVisibility": {
              "parameterName": "tab",
              "comparison": "isEqualTo",
              "value": "k8smdvm"
            },
            "name": "K8sExploitableMDVM"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\r\n    | where type == \"microsoft.security/assessments/subassessments\"\r\n    | extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n    | extend Resource = tolower(extract(@'(?i)(.*?)/providers/Microsoft.Security/([^/]+)', 1, id))\r\n    | extend ResourceGroup = tolower(trim_end(\"/\",extract(\".*resourceGroups/(.+?)/\",0,id)))\r\n    | extend ResourceType = strcat(tolower(split(id,\"/\").[6]), \"/\",tolower(split(id,\"/\").[7]))\r\n    | extend severity = tostring(parse_json(properties).additionalData.vulnerabilityDetails.severity)\r\n    | extend status = tostring(parse_json(properties).status.code)\r\n    | extend VulnId = tostring(parse_json(properties).id)\r\n    | extend description = tostring(parse_json(properties).displayName),patchable = tostring(parse_json(properties).additionalData.softwareDetails.patchable), cve = parse_json(properties.additionalData).cve\r\n    | where assessmentKey == \"c609cf0f-71ab-41e9-a3c6-9a1f7fe1b8d5\"\r\n    | where ResourceType in~ ({k8sarc})\r\n    | where Resource in~ ({k8sclu})\r\n    | project \r\n        Resource, \r\n        ResourceGroup, \r\n        ResourceType, \r\n        subscriptionId, \r\n        severity, \r\n        status, \r\n        VulnId, \r\n        description, \r\n        patchable, \r\n        cve\r\n    | where status == 'Unhealthy'\r\n    | summarize \r\n        dcount(VulnId) by ResourceGroup, \r\n        Resource, \r\n        severity, \r\n        VulnId, \r\n        description, \r\n        tostring(patchable), \r\n        tostring(cve)\r\n    | summarize \r\n        Total = count(dcount_VulnId), \r\n        sevC=countif(severity=='Critical'),\r\n        sevH=countif(severity=='High'), \r\n        sevM=countif(severity=='Medium'), \r\n        sevL=countif(severity=='Low'), \r\n        patchAvailable = countif(patchable=='true'), \r\n        CVEcount =countif(cve!='[]') by ResourceGroup, \r\n        Resource, \r\n        k8sselected = \"true\"\r\n    | order by sevH desc",
              "size": 1,
              "title": "Vulnerable Images |  Select a Cluster to view the list of vulnerabilities",
              "noDataMessage": "No unhealthy Kubernetes found",
              "exportedParameters": [
                {
                  "fieldName": "Resource",
                  "parameterName": "selectedk8s",
                  "defaultValue": "All"
                },
                {
                  "fieldName": "k8sselected",
                  "parameterName": "k8sselected",
                  "parameterType": 1,
                  "defaultValue": "false"
                }
              ],
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "$gen_group",
                    "formatter": 13,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "Resource group",
                    "formatter": 13,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "ResourceGroup",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Resource",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "k8sselected",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Total",
                    "formatter": 1,
                    "formatOptions": {
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "sevC",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Sev0",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "sevH",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Sev1",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "sevM",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Sev2",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "sevL",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Sev3",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "patchAvailable",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "pending",
                          "text": "{0}{1}"
                        }
                      ],
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": []
                      }
                    }
                  },
                  {
                    "columnMatch": "CVEcount",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "4",
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "fixAvailable",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "uninitialized",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  }
                ],
                "rowLimit": 1000,
                "filter": true,
                "hierarchySettings": {
                  "treeType": 1,
                  "groupBy": [
                    "ResourceGroup"
                  ],
                  "expandTopLevel": true,
                  "finalBy": "Resource"
                },
                "labelSettings": [
                  {
                    "columnId": "ResourceGroup",
                    "label": "Resource group"
                  },
                  {
                    "columnId": "sevC",
                    "label": "Critical"
                  },
                  {
                    "columnId": "sevH",
                    "label": "High"
                  },
                  {
                    "columnId": "sevM",
                    "label": "Medium"
                  },
                  {
                    "columnId": "sevL",
                    "label": "Low"
                  },
                  {
                    "columnId": "patchAvailable",
                    "label": "Patch Available"
                  },
                  {
                    "columnId": "CVEcount",
                    "label": "CVEs"
                  }
                ]
              },
              "sortBy": []
            },
            "conditionalVisibility": {
              "parameterName": "tab",
              "comparison": "isEqualTo",
              "value": "k8smdvm"
            },
            "name": "k8s_Running_Images_VulnerabilitiesbyCluster_MDVM"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources \r\n    | where type =~ \"microsoft.security/assessments/subassessments\"\r\n    | extend assessmentKey=extract(@\"(?i)providers/Microsoft.Security/assessments/([^/]*)\", 1, id)\r\n    | extend subAssessmentId=tostring(properties.id)\r\n    | extend parentResourceId= extract(\"(.+)/providers/Microsoft.Security\", 1, id)\r\n    | extend resourceId = tostring(properties.resourceDetails.id)\r\n    | extend cluster = tolower(extract(@'(?i)(.*?)/providers/Microsoft.Security/([^/]+)', 1, id))\r\n    | extend selectedVulnerability=\"true\"\r\n    | extend subAssessmentName=tostring(properties.displayName)\r\n    | extend subAssessmentDescription=tostring(properties.description)\r\n    | extend subAssessmentRemediation=tostring(properties.remediation)\r\n    | extend subAssessmentCategory=tostring(properties.additionalData.softwareDetails.vendor)\r\n    | extend subAssessmentImpact=tostring(properties.impact)\r\n    | extend severity=tostring(parse_json(properties).additionalData.vulnerabilityDetails.severity)\r\n    | extend status=tostring(properties.status.code)\r\n    | extend cause=tostring(properties.status.cause)\r\n    | extend statusDescription=tostring(properties.status.description)\r\n    | extend additionalData=tostring(properties.additionalData)\r\n    | extend isPubliclyDisclosed=iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.isPubliclyDisclosed==\"true\",\"Yes\",\"No\"),\r\n            isInExploitKit=iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.isInExploitKit==\"true\",\"Yes\",\"No\"),\r\n            isVerified= iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.isVerified==\"true\",\"Yes\",\"No\")\r\n    | extend cluster = tolower(extract(@'(?i)(.*?)/providers/Microsoft.Security/([^/]+)', 1, id))\r\n    | where assessmentKey == \"c609cf0f-71ab-41e9-a3c6-9a1f7fe1b8d5\"\r\n    | where status == \"Unhealthy\"\r\n    | where '{selectedk8s}' == 'All' or cluster ==  '{selectedk8s}'\r\n    | summarize \r\n        numOfResources=strcat(dcount(resourceId), \" \", \"Containers\"), \r\n       timeGenerated=arg_max(todatetime(properties.status.firstEvaulationDate), additionalData) by assessmentKey, \r\n        ['cluster'],\r\n        subAssessmentId, \r\n        subAssessmentName, \r\n        //subAssessmentCategory,\r\n        severity,\r\n        patchable = iff(tostring(properties.additionalData.[\"softwareDetails\"].[\"patchable\"])==\"true\",\"Yes\", \"No\"),\r\n        selectedVulnerability\r\n    | project-away \r\n        assessmentKey, \r\n        additionalData\r\n    | order by ['subAssessmentId'] asc",
              "size": 0,
              "title": "Kubernetes Vulenrabilities | Select a Vulnerability to see effected Contianers",
              "noDataMessage": "No vulnerabilities found",
              "exportedParameters": [
                {
                  "fieldName": "subAssessmentId",
                  "parameterName": "selectedAssessmentId",
                  "defaultValue": "All"
                },
                {
                  "fieldName": "selectedVulnerability",
                  "parameterName": "k8sSelectedVulnerability",
                  "parameterType": 1,
                  "defaultValue": "false"
                }
              ],
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "subAssessmentName",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "150ch"
                    }
                  },
                  {
                    "columnMatch": "severity",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "High",
                          "representation": "orange",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Medium",
                          "representation": "yellow",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Low",
                          "representation": "blue",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Critical",
                          "representation": "redBright",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "blue",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "patchable",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "disabled",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "more",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "selectedVulnerability",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "timeGenerated",
                    "formatter": 5
                  }
                ],
                "rowLimit": 10000,
                "filter": true,
                "labelSettings": [
                  {
                    "columnId": "cluster",
                    "label": "Cluster"
                  },
                  {
                    "columnId": "subAssessmentId",
                    "label": "CVE ID"
                  },
                  {
                    "columnId": "subAssessmentName",
                    "label": "Security check"
                  },
                  {
                    "columnId": "severity",
                    "label": "Severity"
                  },
                  {
                    "columnId": "patchable",
                    "label": "Patch"
                  },
                  {
                    "columnId": "numOfResources",
                    "label": "Applies to"
                  },
                  {
                    "columnId": "timeGenerated",
                    "label": "Time generated"
                  }
                ]
              }
            },
            "conditionalVisibilities": [
              {
                "parameterName": "tab",
                "comparison": "isEqualTo",
                "value": "k8smdvm"
              },
              {
                "parameterName": "k8sselected",
                "comparison": "isEqualTo",
                "value": "true"
              }
            ],
            "name": "K8s_Running_Images_Vulnerabilities_Full_ClusterView- MDVM"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources \r\n    | where type =~ \"microsoft.security/assessments/subassessments\"\r\n    | extend assessmentKey=extract(@\"(?i)providers/Microsoft.Security/assessments/([^/]*)\", 1, id)\r\n    | extend subAssessmentId=tostring(properties.id)\r\n    | extend parentResourceId= extract(\"(.+)/providers/Microsoft.Security\", 1, id)\r\n    | extend resourceId = extract(@'(?i)(.*?)@([^/]+)', 1,tostring(properties.resourceDetails.id))\r\n    | extend selectedContainer=\"true\"\r\n    | extend subAssessmentName=tostring(properties.displayName)\r\n    | extend subAssessmentDescription=tostring(properties.description)\r\n    | extend subAssessmentRemediation=tostring(properties.remediation)\r\n    | extend subAssessmentCategory=tostring(properties.category)\r\n    | extend subAssessmentImpact=tostring(properties.impact)\r\n    | extend severity=tostring(parse_json(properties).additionalData.vulnerabilityDetails.severity)\r\n    | extend status=tostring(properties.status.code)\r\n    | extend cause=tostring(properties.status.cause)\r\n    | extend statusDescription=tostring(properties.status.description)\r\n    | extend additionalData=tostring(properties.additionalData)\r\n    | extend isPubliclyDisclosed=iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.isPubliclyDisclosed==\"true\",\"Yes\",\"No\"),\r\n            isInExploitKit=iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.isInExploitKit==\"true\",\"Yes\",\"No\"),\r\n            isVerified= iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.isVerified==\"true\",\"Yes\",\"No\")\r\n    | extend cluster = tolower(extract(@'(?i)(.*?)/providers/Microsoft.Security/([^/]+)', 1, id))\r\n    | extend imageUri = properties.resourceDetails.id\r\n    | where assessmentKey == \"c609cf0f-71ab-41e9-a3c6-9a1f7fe1b8d5\"\r\n    | where status == \"Unhealthy\"\r\n    | where subAssessmentId == '{selectedAssessmentId}'\r\n    |extend vendor = tostring(parse_json(properties).additionalData.softwareDetails.vendor)\r\n    |extend osDistribution = tostring(parse_json(properties).additionalData.softwareDetails.osDetails.osPlatform)\r\n    |extend tags = tostring(properties.additionalData.artifactDetails.tags)\r\n    |extend tags = replace(\"\\\\[|\\\\]|\\\"\", \"\", tags)\r\n     |mv-expand references = todynamic(parse_json(properties).[\"additionalData\"].[\"vulnerabilityDetails\"].[\"references\"])\r\n   | extend referenceLink = references.link\r\n    | summarize referenceLinks = make_list(strcat(referenceLink, \"\\n\")) by \r\n        ['cluster'], \r\n        subAssessmentId, \r\n        resourceId, \r\n        tostring(imageUri),\r\n        subAssessmentName, \r\n        tags,\r\n        severity, \r\n        vendor,\r\n        osDistribution,\r\n        subAssessmentDescription, \r\n        subAssessmentRemediation, \r\n        subAssessmentImpact, \r\n        isPubliclyDisclosed,\r\n        isVerified,\r\n        isInExploitKit,\r\n        patchable = iff(tostring(properties.additionalData.[\"softwareDetails\"].[\"patchable\"])==\"true\",\"Yes\", \"No\"), \r\n        published = format_datetime(todatetime(properties.additionalData.[\"vulnerabilityDetails\"].[\"publishedDate\"]), 'MM/d/yyyy h:m:s tt'), \r\n        selectedContainer",
              "size": 3,
              "title": "Containers Affected by the Vulnerability | Select a Container to see more details",
              "noDataMessage": "No vulnerable containers found",
              "exportedParameters": [
                {
                  "fieldName": "subAssessmentDescription",
                  "parameterName": "k8sSubAssessmentDescription",
                  "parameterType": 1
                },
                {
                  "fieldName": "subAssessmentRemediation",
                  "parameterName": "k8sSubAssessmentRemediation",
                  "parameterType": 1
                },
                {
                  "fieldName": "subAssessmentImpact",
                  "parameterName": "k8sSubAssessmentImpact",
                  "parameterType": 1
                },
                {
                  "fieldName": "subAssessmentId",
                  "parameterName": "k8sId",
                  "parameterType": 1
                },
                {
                  "fieldName": "severity",
                  "parameterName": "k8sSeverity",
                  "parameterType": 1
                },
                {
                  "fieldName": "patchable",
                  "parameterName": "k8sPatchable",
                  "parameterType": 1
                },
                {
                  "fieldName": "published",
                  "parameterName": "k8sPublished",
                  "parameterType": 1
                },
                {
                  "fieldName": "cveurl",
                  "parameterName": "k8sCveUrl",
                  "parameterType": 1
                },
                {
                  "fieldName": "cveid",
                  "parameterName": "k8sCveId",
                  "parameterType": 1
                },
                {
                  "fieldName": "selectedContainer",
                  "parameterName": "k8sSelectedContainer",
                  "parameterType": 1,
                  "defaultValue": "false"
                },
                {
                  "fieldName": "isPubliclyDisclosed",
                  "parameterName": "k8sPubliclyDisclosed",
                  "parameterType": 1
                },
                {
                  "fieldName": "isVerified",
                  "parameterName": "k8sVerified",
                  "parameterType": 1
                },
                {
                  "fieldName": "isInExploitKit",
                  "parameterName": "k8sExploitKit",
                  "parameterType": 1
                },
                {
                  "fieldName": "referenceLinks",
                  "parameterName": "k8sReferences",
                  "parameterType": 1
                }
              ],
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "resourceId",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "subAssessmentName",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "severity",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Critical",
                          "representation": "redBright",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Medium",
                          "representation": "yellow",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Low",
                          "representation": "blue",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "High",
                          "representation": "orange",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "cvss30score",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "palette": "greenRed",
                      "customColumnWidthSetting": "15ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "maximumFractionDigits": 1
                      }
                    }
                  },
                  {
                    "columnMatch": "cvss30Vector",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "fixStatus",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "FixAvailable",
                          "representation": "success",
                          "text": "Fix Available"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "unknown",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "subAssessmentDescription",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "subAssessmentRemediation",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "subAssessmentImpact",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "isPubliclyDisclosed",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "2",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "success",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "unknown",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "isVerified",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "4",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "unknown",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "isInExploitKit",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "2",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "success",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "unknown",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "patchable",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "published",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "selectedContainer",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "referenceLinks",
                    "formatter": 5
                  }
                ],
                "rowLimit": 10000,
                "labelSettings": [
                  {
                    "columnId": "cluster",
                    "label": "Cluster"
                  },
                  {
                    "columnId": "subAssessmentId",
                    "label": "ID"
                  },
                  {
                    "columnId": "resourceId",
                    "label": "Image "
                  },
                  {
                    "columnId": "imageUri",
                    "label": "Image URI"
                  },
                  {
                    "columnId": "subAssessmentName",
                    "label": "Security check"
                  },
                  {
                    "columnId": "tags",
                    "label": "Tags"
                  },
                  {
                    "columnId": "severity",
                    "label": "Severity"
                  },
                  {
                    "columnId": "vendor",
                    "label": "Vendor"
                  },
                  {
                    "columnId": "osDistribution",
                    "label": "OS Distrubution"
                  },
                  {
                    "columnId": "isPubliclyDisclosed",
                    "label": "Exploit Steps Published"
                  },
                  {
                    "columnId": "isVerified",
                    "label": "Exploit Steps Verified"
                  },
                  {
                    "columnId": "isInExploitKit",
                    "label": "In Exploit Kit"
                  }
                ]
              }
            },
            "conditionalVisibilities": [
              {
                "parameterName": "tab",
                "comparison": "isEqualTo",
                "value": "k8smdvm"
              },
              {
                "parameterName": "k8sSelectedVulnerability",
                "comparison": "isEqualTo",
                "value": "true"
              }
            ],
            "name": "K8s_Containers_Affected_By_Vulnerability-MDVM"
          },
          {
            "type": 1,
            "content": {
              "json": "### Description \r\n{k8sSubAssessmentDescription}\r\n\r\n### Remediation\r\n{k8sSubAssessmentRemediation}\r\n### General Information\r\n<table style=\"width:100%\">\r\n  <tr>\r\n    <th>ID</th>\r\n    <th>Severity</th>\r\n    <th>Patchable</th>\r\n\t<th>Published</th>\r\n  </tr>\r\n    <tr>\r\n    <td>{k8sId}</td>\r\n    <td>{k8sSeverity}</td>\r\n    <td>{k8sPatchable}</td>\r\n\t<td>{k8sPublished}</td>\r\n  </tr>\r\n  </table>\r\n\r\n  ### Exploitability Information\r\n<table style=\"width:100%\">\r\n  <tr>\r\n    <th>In Exploit Kit</th>\r\n\t<th>Publicly Disclosed</th>\r\n\t<th>Verified</th>\r\n  </tr>\r\n    <tr>\r\n    <td>{k8sExploitKit}</td>\r\n    <td>{k8sPubliclyDisclosed}</td>\r\n\t<td>{k8sVerified}</td>\r\n  </tr>\r\n  </table>\r\n\r\n### Reference Information\r\n{k8sReferences} <br>\r\n <br> <br>\r\n\r\n\r\n\r\n",
              "style": "info"
            },
            "conditionalVisibilities": [
              {
                "parameterName": "tab",
                "comparison": "isEqualTo",
                "value": "k8smdvm"
              },
              {
                "parameterName": "k8sSelectedContainer",
                "comparison": "isEqualTo",
                "value": "true"
              }
            ],
            "name": "k8s_Vulnerability_Card-MDVM"
          }
        ],
        "exportParameters": true
      },
      "conditionalVisibilities": [
        {
          "parameterName": "tab",
          "comparison": "isEqualTo",
          "value": "k8smdvm"
        },
        {
          "parameterName": "runtimecloud",
          "comparison": "isEqualTo",
          "value": "azure"
        }
      ],
      "name": "k8smdvm"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## AWS running containers - Vulnerabilities\r\nThis dashboard is powered by the recommendation [\"AWS running container images should have vulnerability findings resolved\"](https://portal.azure.com/#view/Microsoft_Azure_Security_CloudNativeCompute/ContainersRuntimeRecommendationDetailsBlade/assessmentKey/682b2595-d045-4cff-b5aa-46624eb2dd8f). Click [here](https://learn.microsoft.com/en-us/azure/defender-for-cloud/agentless-vulnerability-assessment-aws) to learn more about how the scanning works. "
            },
            "name": "k8s_Vulnerability_Text -MDVM"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\r\n    | where type == \"microsoft.security/assessments/subassessments\"\r\n    | extend Resource = tolower(extract(@'(?i)(.*?)/providers/Microsoft.Security/([^/]+)', 1, id))\r\n    | extend connectorIdÂ =Â extract(\"(.*)/securityentitydata\",Â 1,Â id)\r\n    |whereÂ connectorIdÂ in~({awsconnectors})\r\n    | extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id) \r\n    | extend ResourceType = strcat(tolower(split(id,\"/\").[6]), \"/\",tolower(split(id,\"/\").[7]))\r\n    | extend severity = tostring(properties.additionalData.vulnerabilityDetails.severity)\r\n    | extend Status = tostring(properties.status.code)\r\n    | extend ResourceGroup = tolower(trim_end(\"/\",extract(\".*resourceGroups/(.+?)/\",0,id)))\r\n    | extend vulId = tostring(properties.id)\r\n    | where assessmentKey == \"682b2595-d045-4cff-b5aa-46624eb2dd8f\" and Status == 'Unhealthy'\r\n   // | where ResourceType in~ ({k8sarc}) \r\n    //| where Resource in~ ({k8sclu})\r\n    | distinct \r\n        vulId, \r\n        severity\r\n    | summarize count() by tostring(severity)\r\n    | order by count_ desc",
              "size": 4,
              "title": "Vulnerabilities by Severity",
              "noDataMessage": "No vulnerabilities found",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "visualization": "piechart",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "Category",
                  "formatter": 1,
                  "numberFormat": {
                    "unit": 0,
                    "options": {
                      "style": "decimal"
                    },
                    "emptyValCustomText": "Other"
                  }
                },
                "leftContent": {
                  "columnMatch": "count_",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 2,
                      "maximumSignificantDigits": 3
                    }
                  }
                },
                "showBorder": true
              }
            },
            "customWidth": "50",
            "name": "K8s_Vulnerabilities_Seveirty_MDVM"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\r\n    | where type == \"microsoft.security/assessments/subassessments\"\r\n    | extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n    | where assessmentKey == \"682b2595-d045-4cff-b5aa-46624eb2dd8f\"\r\n    |extend connectorIdÂ =Â extract(\"(.*)/securityentitydata\",Â 1,Â id)\r\n    |where connectorId in~({awsconnectors})\r\n  // | extend Resource = tolower(extract(@'(?i)(.*?)/providers/Microsoft.Security/([^/]+)', 1, id))\r\n  |extend Resource = tostring(properties.resourcedetails.resourceName)\r\n  |extend Cluster = tostring(properties.resourceDetails.resourceName)\r\n  |extend ProjectId = tostring(properties.resourceDetails.hierarchyId)\r\n    | extend VulnId = tostring(parse_json(properties).id)\r\n    | extend Status = tostring(parse_json(properties).status.code)\r\n    | extend Severity=tostring(parse_json(properties).additionalData.vulnerabilityDetails.severity)\r\n    //| extend Cluster = tolower(extract(@'(?i)(.*?)/providers/Microsoft.Security/([^/]+)', 1, id))\r\n    //| where Resource in~ ({k8sclu})\r\n    | extend fixStatus = parse_json(properties.additionalData).softwareDetails.fixStatus\r\n        | extend Distro = tostring(properties.additionalData.softwareDetails.osDetails.osVersion), imageUri = properties.resourceDetails.id, CVSS3_0 = tostring(properties.additionalData.cvssV30Score), PackageName = tostring(properties.additionalData.softwareDetails.packageName),\r\n             Evidence = tostring(properties.additionalData.softwareDetails.evidence), VulnerabilityCategory = tostring(properties.additionalData.softwareDetails.category), \r\n             PackageVersion = tostring(properties.additionalData.softwareDetails.version), Published = tostring(properties.additionalData.vulnerabilityDetails.publishedDate),\r\n\t     FixedVersion = tostring(properties.additionalData.softwareDetails.fixedVersion), Description = tostring(properties.description), Remediation = tostring(properties.remediation)\r\n    |extend Vendor = tostring(parse_json(properties).additionalData.softwareDetails.vendor)\r\n    |extend OsDistribution = tostring(parse_json(properties).additionalData.softwareDetails.osDetails.osPlatform)\r\n   |mv-expand references = todynamic(parse_json(properties).[\"additionalData\"].[\"vulnerabilityDetails\"].[\"references\"])\r\n|extend referenceLink = references.link\r\n    |extend Tags =  tostring(properties.additionalData.artifactDetails.tags)\r\n    |extend Tags = replace(\"\\\\[|\\\\]|\\\"\", \"\", Tags)\r\n    | extend imageUri = properties.resourceDetails.id,\r\n    isExploitStepsPublished=iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.isPubliclyDisclosed==\"true\",\"Yes\",\"No\"),\r\n            isInExploitKit=iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.isInExploitKit==\"true\",\"Yes\",\"No\"),\r\n            isVerified= iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.isVerified==\"true\",\"Yes\",\"No\")\r\n | project   \r\n        ProjectId,    \r\n        Cluster,\r\n        imageUri,\r\n        VulnId, \r\n        Status,\r\n        Severity,\r\n        tostring(fixStatus),\r\n        isExploitStepsPublished,\r\n        isVerified,\r\n        isInExploitKit,\r\n        CVSS3_0,\r\n        Tags,\r\n        Distro,\r\n        Vendor,\r\n        OsDistribution,\r\n        VulnerabilityCategory,\r\n        Evidence,\r\n        PackageVersion,\r\n        FixedVersion,\r\n        Published,\r\n      Remediation,  \r\n       Description,\r\n        referenceLink\r\n    | where Status == 'Unhealthy'\r\n  | where isExploitStepsPublished == \"Yes\" or isInExploitKit == \"Yes\" or isVerified == \"Yes\"\r\n    | project-away Status ",
              "size": 1,
              "title": "Exploitable Vulnerablities",
              "noDataMessage": "No exploitable vulnerabilities found",
              "exportedParameters": [
                {
                  "fieldName": "RepositoryName",
                  "parameterName": "acrRepositoryName",
                  "defaultValue": "All"
                },
                {
                  "fieldName": "description",
                  "parameterName": "ecrDescription",
                  "parameterType": 1
                },
                {
                  "fieldName": "remediation",
                  "parameterName": "ecrRemediation",
                  "parameterType": 1
                },
                {
                  "fieldName": "Issue",
                  "parameterName": "ecrIssue",
                  "parameterType": 1
                },
                {
                  "fieldName": "VulnId",
                  "parameterName": "ecrVulnId",
                  "parameterType": 1
                },
                {
                  "fieldName": "Severity",
                  "parameterName": "ecrSeverity",
                  "parameterType": 1
                },
                {
                  "fieldName": "PublishedDate",
                  "parameterName": "ecrPublishedDate",
                  "parameterType": 1
                },
                {
                  "fieldName": "fixStatus",
                  "parameterName": "ecrFixStatus",
                  "parameterType": 1
                },
                {
                  "fieldName": "itemSelected",
                  "parameterName": "ecrItemSelected",
                  "parameterType": 1,
                  "defaultValue": "false"
                },
                {
                  "fieldName": "cvss20Vector",
                  "parameterName": "ecrCvss20Vector",
                  "parameterType": 1
                },
                {
                  "fieldName": "cvss30Vector",
                  "parameterName": "ecrCvss30Vector",
                  "parameterType": 1
                },
                {
                  "parameterType": 1
                },
                {
                  "fieldName": "isInExploitKit",
                  "parameterName": "ecrExploitKit",
                  "parameterType": 1
                },
                {
                  "fieldName": "isVerified",
                  "parameterName": "ecrVerified",
                  "parameterType": 1
                },
                {
                  "fieldName": "isExploitStepsPublished",
                  "parameterName": "ecrVulnPublished",
                  "parameterType": 1
                },
                {
                  "fieldName": "referenceLinks",
                  "parameterName": "ecrReferences",
                  "parameterType": 1
                }
              ],
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Severity",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Critical",
                          "representation": "redBright",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Medium",
                          "representation": "yellow",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Low",
                          "representation": "blue",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "High",
                          "representation": "orange",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "fixStatus",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "FixAvailable",
                          "representation": "success",
                          "text": "Fix Available"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Unknown",
                          "representation": "unknown",
                          "text": "Unknown"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "unknown",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "isExploitStepsPublished",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "2",
                          "text": "Yes"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "success",
                          "text": "No"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "success",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "isVerified",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "Yes"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "4",
                          "text": "No"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "success",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "isInExploitKit",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "warning",
                          "text": "Yes"
                        },
                        {
                          "operator": "==",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "Available",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "unknown",
                          "text": "{0}{1}"
                        }
                      ]
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "CVSS3_0",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "max": 10,
                      "palette": "greenRed",
                      "customColumnWidthSetting": "15ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "minimumFractionDigits": 1
                      }
                    }
                  },
                  {
                    "columnMatch": "Published",
                    "formatter": 6
                  },
                  {
                    "columnMatch": "Resource",
                    "formatter": 13,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true,
                      "customColumnWidthSetting": "30ch"
                    }
                  },
                  {
                    "columnMatch": "itemSelected",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "subscriptionId",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "PublishedDate",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "25ch"
                    }
                  },
                  {
                    "columnMatch": "cvss30score",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "palette": "greenRed",
                      "customColumnWidthSetting": "15ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "minimumFractionDigits": 1
                      }
                    }
                  },
                  {
                    "columnMatch": "cvss30Vector",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "description",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "remediation",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "referenceLinks",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "referenceTitle",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "link",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "category",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Issue",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "cvss20score",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "palette": "greenRed",
                      "customColumnWidthSetting": "15ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "maximumFractionDigits": 1
                      },
                      "emptyValCustomText": "N/A"
                    }
                  },
                  {
                    "columnMatch": "cvss20Vector",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "impact",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "PublishedTime",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "25ch"
                    }
                  },
                  {
                    "columnMatch": "Patchable",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "disabled",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "more",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "cveTitle",
                    "formatter": 1,
                    "formatOptions": {
                      "linkColumn": "cveURL",
                      "linkTarget": "Url"
                    }
                  },
                  {
                    "columnMatch": "cveURL",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "vendorReferencesTitle",
                    "formatter": 1,
                    "formatOptions": {
                      "linkColumn": "vendorReferencesURL",
                      "linkTarget": "Url"
                    }
                  },
                  {
                    "columnMatch": "vendorReferencesURL",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "timeGenerated",
                    "formatter": 6
                  }
                ],
                "rowLimit": 1000,
                "filter": true,
                "labelSettings": [
                  {
                    "columnId": "ProjectId",
                    "label": "Account Id"
                  },
                  {
                    "columnId": "Cluster",
                    "label": "Cluster"
                  },
                  {
                    "columnId": "imageUri",
                    "label": "Image URI"
                  },
                  {
                    "columnId": "VulnId",
                    "label": "Vulnerability Id"
                  },
                  {
                    "columnId": "Severity",
                    "label": "Severity"
                  },
                  {
                    "columnId": "fixStatus",
                    "label": "Fix Status"
                  },
                  {
                    "columnId": "isExploitStepsPublished",
                    "label": "Exploit Steps Published"
                  },
                  {
                    "columnId": "isVerified",
                    "label": "Exploit Steps Verifiable"
                  },
                  {
                    "columnId": "isInExploitKit",
                    "label": "In Exploit Kit"
                  },
                  {
                    "columnId": "CVSS3_0",
                    "label": "CVSS Score"
                  },
                  {
                    "columnId": "Tags",
                    "label": "Tags"
                  },
                  {
                    "columnId": "Distro",
                    "label": "Distro"
                  },
                  {
                    "columnId": "Vendor",
                    "label": "Vendor"
                  },
                  {
                    "columnId": "OsDistribution",
                    "label": "OS Distribution"
                  },
                  {
                    "columnId": "VulnerabilityCategory",
                    "label": "Vulnerability Category"
                  },
                  {
                    "columnId": "Evidence",
                    "label": "Evidence (OS Packages only)"
                  },
                  {
                    "columnId": "PackageVersion",
                    "label": "Package Version"
                  },
                  {
                    "columnId": "FixedVersion",
                    "label": "Fixed Version"
                  },
                  {
                    "columnId": "Published",
                    "label": "Published Date"
                  },
                  {
                    "columnId": "Remediation",
                    "label": "Remediation"
                  },
                  {
                    "columnId": "Description",
                    "label": "Description"
                  },
                  {
                    "columnId": "referenceLink",
                    "label": "Reference Link"
                  }
                ]
              },
              "sortBy": []
            },
            "customWidth": "100",
            "name": "EKSExploitableMDVM"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\r\n    | where type == \"microsoft.security/assessments/subassessments\"\r\n    | extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n  //  | extend Resource = tolower(extract(@'(?i)(.*?)/providers/Microsoft.Security/([^/]+)', 1, id))\r\n    |extend ProjectId = tostring(properties.resourceDetails.hierarchyId)\r\n    |extend Resource = tostring(properties.resourceDetails.resourceName)\r\n    //| extend ResourceGroup = tolower(trim_end(\"/\",extract(\".*resourceGroups/(.+?)/\",0,id)))\r\n    | extend ResourceType = strcat(tolower(split(id,\"/\").[6]), \"/\",tolower(split(id,\"/\").[7]))\r\n    | extend severity = tostring(parse_json(properties).additionalData.vulnerabilityDetails.severity)\r\n    | extend status = tostring(parse_json(properties).status.code)\r\n    | extend VulnId = tostring(parse_json(properties).id)\r\n    | extend description = tostring(parse_json(properties).displayName),patchable = tostring(parse_json(properties).additionalData.softwareDetails.patchable), cve = parse_json(properties.additionalData).cve\r\n    | where assessmentKey == \"682b2595-d045-4cff-b5aa-46624eb2dd8f\"\r\n    | project \r\n        connectorId = extract(\"(.*)/securityentitydata\", 1, id),\r\n        ProjectId,\r\n        Resource,\r\n        ResourceType, \r\n        subscriptionId, \r\n        severity, \r\n        status, \r\n        VulnId, \r\n        description, \r\n        patchable, \r\n        cve\r\n    | where status == 'Unhealthy'\r\n    |where connectorId in~({awsconnectors})\r\n    | summarize \r\n        dcount(VulnId) by ProjectId,\r\n        Resource, \r\n        severity, \r\n        VulnId, \r\n        description, \r\n        tostring(patchable), \r\n        tostring(cve)\r\n    | summarize \r\n        Total = count(dcount_VulnId), \r\n        sevC=countif(severity=='Critical'),\r\n        sevH=countif(severity=='High'), \r\n        sevM=countif(severity=='Medium'), \r\n        sevL=countif(severity=='Low'), \r\n        patchAvailable = countif(patchable=='true'), \r\n        CVEcount =countif(cve!='[]') by ProjectId,\r\n        Resource, \r\n        k8sselected = \"true\"\r\n    | order by sevH desc",
              "size": 1,
              "title": "Vulnerable Images |  Select a Cluster to view the list of vulnerabilities",
              "noDataMessage": "No unhealthy Kubernetes found",
              "exportedParameters": [
                {
                  "fieldName": "Resource",
                  "parameterName": "selectedk8s",
                  "defaultValue": "All"
                },
                {
                  "fieldName": "k8sselected",
                  "parameterName": "k8sselected",
                  "parameterType": 1,
                  "defaultValue": "false"
                }
              ],
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "$gen_group",
                    "formatter": 13,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "ProjectId",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "k8sselected",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Total",
                    "formatter": 1,
                    "formatOptions": {
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "sevC",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Sev0",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "sevH",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Sev1",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "sevM",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Sev2",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "sevL",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Sev3",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "patchAvailable",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "pending",
                          "text": "{0}{1}"
                        }
                      ],
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": []
                      }
                    }
                  },
                  {
                    "columnMatch": "CVEcount",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "4",
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "Resource group",
                    "formatter": 13,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "ResourceGroup",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "fixAvailable",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "uninitialized",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  }
                ],
                "rowLimit": 1000,
                "filter": true,
                "hierarchySettings": {
                  "treeType": 1,
                  "groupBy": [
                    "ProjectId"
                  ]
                },
                "labelSettings": [
                  {
                    "columnId": "ProjectId",
                    "label": "Account Id"
                  },
                  {
                    "columnId": "Resource",
                    "label": "Cluster"
                  },
                  {
                    "columnId": "k8sselected",
                    "label": "k8sselected"
                  },
                  {
                    "columnId": "Total",
                    "label": "Total"
                  },
                  {
                    "columnId": "sevC",
                    "label": "Critical"
                  },
                  {
                    "columnId": "sevH",
                    "label": "High"
                  },
                  {
                    "columnId": "sevM",
                    "label": "Medium"
                  },
                  {
                    "columnId": "sevL",
                    "label": "Low"
                  },
                  {
                    "columnId": "patchAvailable",
                    "label": "Fix Available"
                  },
                  {
                    "columnId": "CVEcount",
                    "label": "CVE Count"
                  }
                ]
              },
              "sortBy": []
            },
            "name": "EKS_Running_Images_VulnerabilitiesbyCluster_MDVM"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources \r\n    | where type =~ \"microsoft.security/assessments/subassessments\"\r\n    | extend assessmentKey=extract(@\"(?i)providers/Microsoft.Security/assessments/([^/]*)\", 1, id)\r\n    | extend subAssessmentId=tostring(properties.id)\r\n    | extend parentResourceId= extract(\"(.+)/providers/Microsoft.Security\", 1, id)\r\n    | extend resourceId = tostring(properties.resourceDetails.id)\r\n    | extend cluster = tostring(properties.resourceDetails.resourceName)\r\n    | extend selectedVulnerability=\"true\"\r\n    | extend subAssessmentName=tostring(properties.displayName)\r\n    | extend subAssessmentDescription=tostring(properties.description)\r\n    | extend subAssessmentRemediation=tostring(properties.remediation)\r\n    | extend subAssessmentCategory=tostring(properties.additionalData.softwareDetails.vendor)\r\n   // | extend subAssessmentImpact=tostring(properties.impact)\r\n    | extend severity=tostring(parse_json(properties).additionalData.vulnerabilityDetails.severity)\r\n    | extend status=tostring(properties.status.code)\r\n    | extend cause=tostring(properties.status.cause)\r\n    | extend statusDescription=tostring(properties.status.description)\r\n    | extend additionalData=tostring(properties.additionalData)\r\n    | extend isPubliclyDisclosed=iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.isPubliclyDisclosed==\"true\",\"Yes\",\"No\"),\r\n            isInExploitKit=iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.isInExploitKit==\"true\",\"Yes\",\"No\"),\r\n            isVerified= iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.isVerified==\"true\",\"Yes\",\"No\")\r\n    //| extend cluster = tolower(extract(@'(?i)(.*?)/providers/Microsoft.Security/([^/]+)', 1, id))\r\n    | where assessmentKey == \"682b2595-d045-4cff-b5aa-46624eb2dd8f\"\r\n    | where status == \"Unhealthy\"\r\n    |where '{selectedk8s}' == 'All' or cluster ==  '{selectedk8s}'\r\n    | summarize \r\n        numOfResources=strcat(dcount(resourceId), \" \", \"Containers\"), \r\n       timeGenerated=arg_max(todatetime(properties.status.firstEvaulationDate), additionalData) by assessmentKey, \r\n        ['cluster'],\r\n        subAssessmentId, \r\n        subAssessmentName, \r\n        //subAssessmentCategory,\r\n        severity,\r\n        patchable = iff(tostring(properties.additionalData.[\"softwareDetails\"].[\"patchable\"])==\"true\",\"Yes\", \"No\"),\r\n        selectedVulnerability\r\n    | project-away \r\n        assessmentKey, \r\n        additionalData\r\n    | order by ['subAssessmentId'] asc",
              "size": 0,
              "title": "Kubernetes Vulenrabilities | Select a Vulnerability to see effected Contianers",
              "noDataMessage": "No vulnerabilities found",
              "exportedParameters": [
                {
                  "fieldName": "subAssessmentId",
                  "parameterName": "selectedAssessmentId",
                  "defaultValue": "All"
                },
                {
                  "fieldName": "selectedVulnerability",
                  "parameterName": "k8sSelectedVulnerability",
                  "parameterType": 1,
                  "defaultValue": "false"
                }
              ],
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "cluster",
                    "formatter": 13,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "subAssessmentName",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "150ch"
                    }
                  },
                  {
                    "columnMatch": "severity",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "High",
                          "representation": "orange",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Medium",
                          "representation": "yellow",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Low",
                          "representation": "blue",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Critical",
                          "representation": "redBright",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "blue",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "patchable",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "disabled",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "more",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "selectedVulnerability",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "timeGenerated",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "resource",
                    "formatter": 13,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true,
                "labelSettings": [
                  {
                    "columnId": "cluster",
                    "label": "Cluster"
                  },
                  {
                    "columnId": "subAssessmentId",
                    "label": "CVE ID"
                  },
                  {
                    "columnId": "subAssessmentName",
                    "label": "Security check"
                  },
                  {
                    "columnId": "severity",
                    "label": "Severity"
                  },
                  {
                    "columnId": "patchable",
                    "label": "Fix Available"
                  },
                  {
                    "columnId": "selectedVulnerability",
                    "label": "selectedVulnerability"
                  },
                  {
                    "columnId": "numOfResources",
                    "label": "Applies To"
                  },
                  {
                    "columnId": "timeGenerated",
                    "label": "Time Generated"
                  }
                ]
              }
            },
            "conditionalVisibility": {
              "parameterName": "k8sselected",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "K8s_Running_Images_Vulnerabilities_Full_ClusterView- MDVM"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources \r\n    | where type =~ \"microsoft.security/assessments/subassessments\"\r\n    | extend assessmentKey=extract(@\"(?i)providers/Microsoft.Security/assessments/([^/]*)\", 1, id)\r\n    | extend subAssessmentId=tostring(properties.id)\r\n    | extend parentResourceId= extract(\"(.+)/providers/Microsoft.Security\", 1, id)\r\n    | extend resourceId = extract(@'(?i)(.*?)@([^/]+)', 1,tostring(properties.resourceDetails.id))\r\n    | extend selectedContainer=\"true\"\r\n    | extend subAssessmentName=tostring(properties.displayName)\r\n    | extend subAssessmentDescription=tostring(properties.description)\r\n    | extend subAssessmentRemediation=tostring(properties.remediation)\r\n    | extend subAssessmentCategory=tostring(properties.category)\r\n    | extend subAssessmentImpact=tostring(properties.impact)\r\n    | extend severity=tostring(parse_json(properties).additionalData.vulnerabilityDetails.severity)\r\n    | extend status=tostring(properties.status.code)\r\n    | extend cause=tostring(properties.status.cause)\r\n    | extend statusDescription=tostring(properties.status.description)\r\n    | extend additionalData=tostring(properties.additionalData)\r\n    | extend isPubliclyDisclosed=iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.isPubliclyDisclosed==\"true\",\"Yes\",\"No\"),\r\n            isInExploitKit=iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.isInExploitKit==\"true\",\"Yes\",\"No\"),\r\n            isVerified= iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.isVerified==\"true\",\"Yes\",\"No\")\r\n    | extend cluster = tostring(properties.resourceDetails.resourceName)\r\n    | extend imageUri = properties.resourceDetails.id\r\n    | where assessmentKey == \"682b2595-d045-4cff-b5aa-46624eb2dd8f\"\r\n    | where status == \"Unhealthy\"\r\n    | where subAssessmentId == '{selectedAssessmentId}'\r\n    |extend vendor = tostring(parse_json(properties).additionalData.softwareDetails.vendor)\r\n    |extend osDistribution = tostring(parse_json(properties).additionalData.softwareDetails.osDetails.osPlatform)\r\n    |extend tags = tostring(properties.additionalData.artifactDetails.tags)\r\n    |extend tags = replace(\"\\\\[|\\\\]|\\\"\", \"\", tags)\r\n     |mv-expand references = todynamic(parse_json(properties).[\"additionalData\"].[\"vulnerabilityDetails\"].[\"references\"])\r\n   | extend referenceLink = references.link\r\n    | summarize referenceLinks = make_list(strcat(referenceLink, \"\\n\")) by \r\n        ['cluster'], \r\n        subAssessmentId, \r\n        resourceId, \r\n        tostring(imageUri),\r\n        subAssessmentName, \r\n        tags,\r\n        severity, \r\n        vendor,\r\n        osDistribution,\r\n        subAssessmentDescription, \r\n        subAssessmentRemediation, \r\n        subAssessmentImpact, \r\n        isPubliclyDisclosed,\r\n        isVerified,\r\n        isInExploitKit,\r\n        patchable = iff(tostring(properties.additionalData.[\"softwareDetails\"].[\"patchable\"])==\"true\",\"Yes\", \"No\"), \r\n        published = format_datetime(todatetime(properties.additionalData.[\"vulnerabilityDetails\"].[\"publishedDate\"]), 'MM/d/yyyy h:m:s tt'), \r\n        selectedContainer",
              "size": 3,
              "title": "Containers Affected by the Vulnerability | Select a Container to see more details",
              "noDataMessage": "No vulnerable containers found",
              "exportedParameters": [
                {
                  "fieldName": "subAssessmentDescription",
                  "parameterName": "k8sSubAssessmentDescription",
                  "parameterType": 1
                },
                {
                  "fieldName": "subAssessmentRemediation",
                  "parameterName": "k8sSubAssessmentRemediation",
                  "parameterType": 1
                },
                {
                  "fieldName": "subAssessmentImpact",
                  "parameterName": "k8sSubAssessmentImpact",
                  "parameterType": 1
                },
                {
                  "fieldName": "subAssessmentId",
                  "parameterName": "k8sId",
                  "parameterType": 1
                },
                {
                  "fieldName": "severity",
                  "parameterName": "k8sSeverity",
                  "parameterType": 1
                },
                {
                  "fieldName": "patchable",
                  "parameterName": "k8sPatchable",
                  "parameterType": 1
                },
                {
                  "fieldName": "published",
                  "parameterName": "k8sPublished",
                  "parameterType": 1
                },
                {
                  "fieldName": "cveurl",
                  "parameterName": "k8sCveUrl",
                  "parameterType": 1
                },
                {
                  "fieldName": "cveid",
                  "parameterName": "k8sCveId",
                  "parameterType": 1
                },
                {
                  "fieldName": "selectedContainer",
                  "parameterName": "k8sSelectedContainer",
                  "parameterType": 1,
                  "defaultValue": "false"
                },
                {
                  "fieldName": "isPubliclyDisclosed",
                  "parameterName": "k8sPubliclyDisclosed",
                  "parameterType": 1
                },
                {
                  "fieldName": "isVerified",
                  "parameterName": "k8sVerified",
                  "parameterType": 1
                },
                {
                  "fieldName": "isInExploitKit",
                  "parameterName": "k8sExploitKit",
                  "parameterType": 1
                },
                {
                  "fieldName": "referenceLinks",
                  "parameterName": "k8sReferences",
                  "parameterType": 1
                }
              ],
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "resourceId",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "subAssessmentName",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "severity",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Critical",
                          "representation": "redBright",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Medium",
                          "representation": "yellow",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Low",
                          "representation": "blue",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "High",
                          "representation": "orange",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "cvss30score",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "palette": "greenRed",
                      "customColumnWidthSetting": "15ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "maximumFractionDigits": 1
                      }
                    }
                  },
                  {
                    "columnMatch": "cvss30Vector",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "fixStatus",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "FixAvailable",
                          "representation": "success",
                          "text": "Fix Available"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "unknown",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "subAssessmentDescription",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "subAssessmentRemediation",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "subAssessmentImpact",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "isPubliclyDisclosed",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "2",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "success",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "unknown",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "isVerified",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "4",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "unknown",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "isInExploitKit",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "2",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "success",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "unknown",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "patchable",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "published",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "selectedContainer",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "referenceLinks",
                    "formatter": 5
                  }
                ],
                "rowLimit": 10000,
                "labelSettings": [
                  {
                    "columnId": "cluster",
                    "label": "Cluster"
                  },
                  {
                    "columnId": "subAssessmentId",
                    "label": "ID"
                  },
                  {
                    "columnId": "resourceId",
                    "label": "Image "
                  },
                  {
                    "columnId": "imageUri",
                    "label": "Image URI"
                  },
                  {
                    "columnId": "subAssessmentName",
                    "label": "Security check"
                  },
                  {
                    "columnId": "tags",
                    "label": "Tags"
                  },
                  {
                    "columnId": "severity",
                    "label": "Severity"
                  },
                  {
                    "columnId": "vendor",
                    "label": "Vendor"
                  },
                  {
                    "columnId": "osDistribution",
                    "label": "OS Distrubution"
                  },
                  {
                    "columnId": "isPubliclyDisclosed",
                    "label": "Exploit Steps Published"
                  },
                  {
                    "columnId": "isVerified",
                    "label": "Exploit Steps Verified"
                  },
                  {
                    "columnId": "isInExploitKit",
                    "label": "In Exploit Kit"
                  }
                ]
              }
            },
            "conditionalVisibility": {
              "parameterName": "k8sSelectedVulnerability",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "K8s_Containers_Affected_By_Vulnerability-MDVM"
          },
          {
            "type": 1,
            "content": {
              "json": "### Description \r\n{k8sSubAssessmentDescription}\r\n\r\n### Remediation\r\n{k8sSubAssessmentRemediation}\r\n### General Information\r\n<table style=\"width:100%\">\r\n  <tr>\r\n    <th>ID</th>\r\n    <th>Severity</th>\r\n    <th>Patchable</th>\r\n\t<th>Published</th>\r\n  </tr>\r\n    <tr>\r\n    <td>{k8sId}</td>\r\n    <td>{k8sSeverity}</td>\r\n    <td>{k8sPatchable}</td>\r\n\t<td>{k8sPublished}</td>\r\n  </tr>\r\n  </table>\r\n\r\n  ### Exploitability Information\r\n<table style=\"width:100%\">\r\n  <tr>\r\n    <th>In Exploit Kit</th>\r\n\t<th>Publicly Disclosed</th>\r\n\t<th>Verified</th>\r\n  </tr>\r\n    <tr>\r\n    <td>{k8sExploitKit}</td>\r\n    <td>{k8sPubliclyDisclosed}</td>\r\n\t<td>{k8sVerified}</td>\r\n  </tr>\r\n  </table>\r\n\r\n### Reference Information\r\n{k8sReferences} <br>\r\n <br> <br>\r\n\r\n\r\n\r\n",
              "style": "info"
            },
            "conditionalVisibility": {
              "parameterName": "k8sSelectedContainer",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "k8s_Vulnerability_Card-MDVM"
          }
        ],
        "exportParameters": true
      },
      "conditionalVisibilities": [
        {
          "parameterName": "tab",
          "comparison": "isEqualTo",
          "value": "k8smdvm"
        },
        {
          "parameterName": "runtimecloud",
          "comparison": "isEqualTo",
          "value": "aws"
        }
      ],
      "name": "eksmdvm "
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## GCP running containers - Vulnerabilities\r\nThis dashboard is powered by the recommendation [\"GCP running container images should have vulnerability findings resolved\"](https://portal.azure.com/#view/Microsoft_Azure_Security_CloudNativeCompute/ContainersRuntimeRecommendationDetailsBlade/assessmentKey/e538731a-80c8-4317-a119-13075e002516). Click [here](https://learn.microsoft.com/en-us/azure/defender-for-cloud/agentless-vulnerability-assessment-gcp) to learn more about how the scanning works. "
            },
            "name": "GKE_Vulnerability_Text -MDVM"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\r\n    | where type == \"microsoft.security/assessments/subassessments\"\r\n    | extend Resource = tolower(extract(@'(?i)(.*?)/providers/Microsoft.Security/([^/]+)', 1, id))\r\n    | extend connectorIdÂ =Â extract(\"(.*)/securityentitydata\",Â 1,Â id)\r\n    |whereÂ connectorIdÂ in~({gcpconnector})\r\n    | extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id) \r\n    | extend ResourceType = strcat(tolower(split(id,\"/\").[6]), \"/\",tolower(split(id,\"/\").[7]))\r\n    | extend severity = tostring(properties.additionalData.vulnerabilityDetails.severity)\r\n    | extend Status = tostring(properties.status.code)\r\n    | extend ResourceGroup = tolower(trim_end(\"/\",extract(\".*resourceGroups/(.+?)/\",0,id)))\r\n    | extend vulId = tostring(properties.id)\r\n    | where assessmentKey == \"e538731a-80c8-4317-a119-13075e002516\" and Status == 'Unhealthy'\r\n   // | where ResourceType in~ ({k8sarc}) \r\n    //| where Resource in~ ({k8sclu})\r\n    | distinct \r\n        vulId, \r\n        severity\r\n    | summarize count() by tostring(severity)\r\n    | order by count_ desc",
              "size": 4,
              "title": "Vulnerabilities by Severity",
              "noDataMessage": "No vulnerabilities found",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "visualization": "piechart",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "Category",
                  "formatter": 1,
                  "numberFormat": {
                    "unit": 0,
                    "options": {
                      "style": "decimal"
                    },
                    "emptyValCustomText": "Other"
                  }
                },
                "leftContent": {
                  "columnMatch": "count_",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 2,
                      "maximumSignificantDigits": 3
                    }
                  }
                },
                "showBorder": true
              }
            },
            "customWidth": "50",
            "name": "GKE_Vulnerabilities_Seveirty_MDVM"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\r\n    | where type == \"microsoft.security/assessments/subassessments\"\r\n    | extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n    | where assessmentKey == \"e538731a-80c8-4317-a119-13075e002516\"\r\n    | extend connectorIdÂ =Â extract(\"(.*)/securityentitydata\",Â 1,Â id)\r\n    |whereÂ connectorIdÂ in~({gcpconnector})\r\n  // | extend Resource = tolower(extract(@'(?i)(.*?)/providers/Microsoft.Security/([^/]+)', 1, id))\r\n  |extend Resource = tostring(properties.resourcedetails.resourceName)\r\n  |extend Cluster = tostring(properties.resourceDetails.resourceName)\r\n  |extend ProjectId = tostring(properties.resourceDetails.hierarchyId)\r\n    | extend VulnId = tostring(parse_json(properties).id)\r\n    | extend Status = tostring(parse_json(properties).status.code)\r\n    | extend Severity=tostring(parse_json(properties).additionalData.vulnerabilityDetails.severity)\r\n    //| extend Cluster = tolower(extract(@'(?i)(.*?)/providers/Microsoft.Security/([^/]+)', 1, id))\r\n    //| where Resource in~ ({k8sclu})\r\n    | extend fixStatus = parse_json(properties.additionalData).softwareDetails.fixStatus\r\n        | extend Distro = tostring(properties.additionalData.softwareDetails.osDetails.osVersion), imageUri = properties.resourceDetails.id, CVSS3_0 = tostring(properties.additionalData.cvssV30Score), PackageName = tostring(properties.additionalData.softwareDetails.packageName),\r\n             Evidence = tostring(properties.additionalData.softwareDetails.evidence), VulnerabilityCategory = tostring(properties.additionalData.softwareDetails.category), \r\n             PackageVersion = tostring(properties.additionalData.softwareDetails.version), Published = tostring(properties.additionalData.vulnerabilityDetails.publishedDate),\r\n\t     FixedVersion = tostring(properties.additionalData.softwareDetails.fixedVersion), Description = tostring(properties.description), Remediation = tostring(properties.remediation)\r\n    |extend Vendor = tostring(parse_json(properties).additionalData.softwareDetails.vendor)\r\n    |extend OsDistribution = tostring(parse_json(properties).additionalData.softwareDetails.osDetails.osPlatform)\r\n   |mv-expand references = todynamic(parse_json(properties).[\"additionalData\"].[\"vulnerabilityDetails\"].[\"references\"])\r\n|extend referenceLink = references.link\r\n    |extend Tags =  tostring(properties.additionalData.artifactDetails.tags)\r\n    |extend Tags = replace(\"\\\\[|\\\\]|\\\"\", \"\", Tags)\r\n    | extend imageUri = properties.resourceDetails.id,\r\n    isExploitStepsPublished=iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.isPubliclyDisclosed==\"true\",\"Yes\",\"No\"),\r\n            isInExploitKit=iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.isInExploitKit==\"true\",\"Yes\",\"No\"),\r\n            isVerified= iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.isVerified==\"true\",\"Yes\",\"No\")\r\n | project   \r\n        ProjectId,    \r\n        Cluster,\r\n        imageUri,\r\n        VulnId, \r\n        Status,\r\n        Severity,\r\n        tostring(fixStatus),\r\n        isExploitStepsPublished,\r\n        isVerified,\r\n        isInExploitKit,\r\n        CVSS3_0,\r\n        Tags,\r\n        Distro,\r\n        Vendor,\r\n        OsDistribution,\r\n        VulnerabilityCategory,\r\n        Evidence,\r\n        PackageVersion,\r\n        FixedVersion,\r\n        Published,\r\n      Remediation,  \r\n       Description,\r\n        referenceLink\r\n    | where Status == 'Unhealthy'\r\n  | where isExploitStepsPublished == \"Yes\" or isInExploitKit == \"Yes\" or isVerified == \"Yes\"\r\n    | project-away Status ",
              "size": 1,
              "title": "Exploitable Vulnerablities",
              "noDataMessage": "No exploitable vulnerabilities found",
              "exportedParameters": [
                {
                  "fieldName": "RepositoryName",
                  "parameterName": "acrRepositoryName",
                  "defaultValue": "All"
                },
                {
                  "fieldName": "description",
                  "parameterName": "ecrDescription",
                  "parameterType": 1
                },
                {
                  "fieldName": "remediation",
                  "parameterName": "ecrRemediation",
                  "parameterType": 1
                },
                {
                  "fieldName": "Issue",
                  "parameterName": "ecrIssue",
                  "parameterType": 1
                },
                {
                  "fieldName": "VulnId",
                  "parameterName": "ecrVulnId",
                  "parameterType": 1
                },
                {
                  "fieldName": "Severity",
                  "parameterName": "ecrSeverity",
                  "parameterType": 1
                },
                {
                  "fieldName": "PublishedDate",
                  "parameterName": "ecrPublishedDate",
                  "parameterType": 1
                },
                {
                  "fieldName": "fixStatus",
                  "parameterName": "ecrFixStatus",
                  "parameterType": 1
                },
                {
                  "fieldName": "itemSelected",
                  "parameterName": "ecrItemSelected",
                  "parameterType": 1,
                  "defaultValue": "false"
                },
                {
                  "fieldName": "cvss20Vector",
                  "parameterName": "ecrCvss20Vector",
                  "parameterType": 1
                },
                {
                  "fieldName": "cvss30Vector",
                  "parameterName": "ecrCvss30Vector",
                  "parameterType": 1
                },
                {
                  "parameterType": 1
                },
                {
                  "fieldName": "isInExploitKit",
                  "parameterName": "ecrExploitKit",
                  "parameterType": 1
                },
                {
                  "fieldName": "isVerified",
                  "parameterName": "ecrVerified",
                  "parameterType": 1
                },
                {
                  "fieldName": "isExploitStepsPublished",
                  "parameterName": "ecrVulnPublished",
                  "parameterType": 1
                },
                {
                  "fieldName": "referenceLinks",
                  "parameterName": "ecrReferences",
                  "parameterType": 1
                }
              ],
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Severity",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Critical",
                          "representation": "redBright",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Medium",
                          "representation": "yellow",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Low",
                          "representation": "blue",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "High",
                          "representation": "orange",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "fixStatus",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "FixAvailable",
                          "representation": "success",
                          "text": "Fix Available"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Unknown",
                          "representation": "unknown",
                          "text": "Unknown"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "unknown",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "isExploitStepsPublished",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "2",
                          "text": "Yes"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "success",
                          "text": "No"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "success",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "isVerified",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "Yes"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "4",
                          "text": "No"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "success",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "isInExploitKit",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "warning",
                          "text": "Yes"
                        },
                        {
                          "operator": "==",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "Available",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "unknown",
                          "text": "{0}{1}"
                        }
                      ]
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "CVSS3_0",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "max": 10,
                      "palette": "greenRed",
                      "customColumnWidthSetting": "15ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "minimumFractionDigits": 1
                      }
                    }
                  },
                  {
                    "columnMatch": "Published",
                    "formatter": 6
                  },
                  {
                    "columnMatch": "Resource",
                    "formatter": 13,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true,
                      "customColumnWidthSetting": "30ch"
                    }
                  },
                  {
                    "columnMatch": "itemSelected",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "subscriptionId",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "PublishedDate",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "25ch"
                    }
                  },
                  {
                    "columnMatch": "cvss30score",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "palette": "greenRed",
                      "customColumnWidthSetting": "15ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "minimumFractionDigits": 1
                      }
                    }
                  },
                  {
                    "columnMatch": "cvss30Vector",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "description",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "remediation",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "referenceLinks",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "referenceTitle",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "link",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "category",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Issue",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "cvss20score",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "palette": "greenRed",
                      "customColumnWidthSetting": "15ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "maximumFractionDigits": 1
                      },
                      "emptyValCustomText": "N/A"
                    }
                  },
                  {
                    "columnMatch": "cvss20Vector",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "impact",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "PublishedTime",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "25ch"
                    }
                  },
                  {
                    "columnMatch": "Patchable",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "disabled",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "more",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "cveTitle",
                    "formatter": 1,
                    "formatOptions": {
                      "linkColumn": "cveURL",
                      "linkTarget": "Url"
                    }
                  },
                  {
                    "columnMatch": "cveURL",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "vendorReferencesTitle",
                    "formatter": 1,
                    "formatOptions": {
                      "linkColumn": "vendorReferencesURL",
                      "linkTarget": "Url"
                    }
                  },
                  {
                    "columnMatch": "vendorReferencesURL",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "timeGenerated",
                    "formatter": 6
                  }
                ],
                "rowLimit": 1000,
                "filter": true,
                "labelSettings": [
                  {
                    "columnId": "ProjectId",
                    "label": "Project Id"
                  },
                  {
                    "columnId": "Cluster",
                    "label": "Cluster"
                  },
                  {
                    "columnId": "imageUri",
                    "label": "Image URI"
                  },
                  {
                    "columnId": "VulnId",
                    "label": "Vulnerability Id"
                  },
                  {
                    "columnId": "Severity",
                    "label": "Severity"
                  },
                  {
                    "columnId": "fixStatus",
                    "label": "Fix Status"
                  },
                  {
                    "columnId": "isExploitStepsPublished",
                    "label": "Exploit Steps Published"
                  },
                  {
                    "columnId": "isVerified",
                    "label": "Exploit Steps Verifiable"
                  },
                  {
                    "columnId": "isInExploitKit",
                    "label": "In Exploit Kit"
                  },
                  {
                    "columnId": "CVSS3_0",
                    "label": "CVSS Score"
                  },
                  {
                    "columnId": "Tags",
                    "label": "Tags"
                  },
                  {
                    "columnId": "Distro",
                    "label": "Distro"
                  },
                  {
                    "columnId": "Vendor",
                    "label": "Vendor"
                  },
                  {
                    "columnId": "OsDistribution",
                    "label": "OS Distribution"
                  },
                  {
                    "columnId": "VulnerabilityCategory",
                    "label": "Vulnerability Category"
                  },
                  {
                    "columnId": "Evidence",
                    "label": "Evidence (OS Packages only)"
                  },
                  {
                    "columnId": "PackageVersion",
                    "label": "Package Version"
                  },
                  {
                    "columnId": "FixedVersion",
                    "label": "Fixed Version"
                  },
                  {
                    "columnId": "Published",
                    "label": "Published Date"
                  },
                  {
                    "columnId": "Remediation",
                    "label": "Remediation"
                  },
                  {
                    "columnId": "Description",
                    "label": "Description"
                  },
                  {
                    "columnId": "referenceLink",
                    "label": "Reference Link"
                  }
                ]
              },
              "sortBy": []
            },
            "customWidth": "100",
            "name": "GKEExploitableMDVM"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\r\n    | where type == \"microsoft.security/assessments/subassessments\"\r\n    | extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n  //  | extend Resource = tolower(extract(@'(?i)(.*?)/providers/Microsoft.Security/([^/]+)', 1, id))\r\n    |extend ProjectId = tostring(properties.resourceDetails.hierarchyId)\r\n    |extend Resource = tostring(properties.resourceDetails.resourceName)\r\n    | extend connectorIdÂ =Â extract(\"(.*)/securityentitydata\",Â 1,Â id)\r\n    |whereÂ connectorIdÂ in~({gcpconnector})\r\n    //| extend ResourceGroup = tolower(trim_end(\"/\",extract(\".*resourceGroups/(.+?)/\",0,id)))\r\n    | extend ResourceType = strcat(tolower(split(id,\"/\").[6]), \"/\",tolower(split(id,\"/\").[7]))\r\n    | extend severity = tostring(parse_json(properties).additionalData.vulnerabilityDetails.severity)\r\n    | extend status = tostring(parse_json(properties).status.code)\r\n    | extend VulnId = tostring(parse_json(properties).id)\r\n    | extend description = tostring(parse_json(properties).displayName),patchable = tostring(parse_json(properties).additionalData.softwareDetails.patchable), cve = parse_json(properties.additionalData).cve\r\n    | where assessmentKey == \"e538731a-80c8-4317-a119-13075e002516\"\r\n    | project \r\n        ProjectId,\r\n        Resource,\r\n        ResourceType, \r\n        subscriptionId, \r\n        severity, \r\n        status, \r\n        VulnId, \r\n        description, \r\n        patchable, \r\n        cve\r\n    | where status == 'Unhealthy'\r\n    | summarize \r\n        dcount(VulnId) by ProjectId,\r\n        Resource, \r\n        severity, \r\n        VulnId, \r\n        description, \r\n        tostring(patchable), \r\n        tostring(cve)\r\n    | summarize \r\n        Total = count(dcount_VulnId), \r\n        sevC=countif(severity=='Critical'),\r\n        sevH=countif(severity=='High'), \r\n        sevM=countif(severity=='Medium'), \r\n        sevL=countif(severity=='Low'), \r\n        patchAvailable = countif(patchable=='true'), \r\n        CVEcount =countif(cve!='[]') by ProjectId,\r\n        Resource, \r\n        k8sselected = \"true\"\r\n    | order by sevH desc",
              "size": 1,
              "title": "Vulnerable Images |  Select a Cluster to view the list of vulnerabilities",
              "noDataMessage": "No unhealthy Kubernetes found",
              "exportedParameters": [
                {
                  "fieldName": "Resource",
                  "parameterName": "selectedk8s",
                  "defaultValue": "All"
                },
                {
                  "fieldName": "k8sselected",
                  "parameterName": "k8sselected",
                  "parameterType": 1,
                  "defaultValue": "false"
                }
              ],
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "$gen_group",
                    "formatter": 13,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "ProjectId",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "k8sselected",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Total",
                    "formatter": 1,
                    "formatOptions": {
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "sevC",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Sev0",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "sevH",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Sev1",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "sevM",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Sev2",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "sevL",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Sev3",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "patchAvailable",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "pending",
                          "text": "{0}{1}"
                        }
                      ],
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": []
                      }
                    }
                  },
                  {
                    "columnMatch": "CVEcount",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "4",
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "Resource group",
                    "formatter": 13,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "ResourceGroup",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "fixAvailable",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "uninitialized",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  }
                ],
                "rowLimit": 1000,
                "filter": true,
                "hierarchySettings": {
                  "treeType": 1,
                  "groupBy": [
                    "ProjectId"
                  ]
                },
                "labelSettings": [
                  {
                    "columnId": "ProjectId",
                    "label": "Project Id"
                  },
                  {
                    "columnId": "Resource",
                    "label": "Cluster"
                  },
                  {
                    "columnId": "k8sselected",
                    "label": "Critical"
                  },
                  {
                    "columnId": "Total",
                    "label": "Total"
                  },
                  {
                    "columnId": "sevC",
                    "label": "Critical"
                  },
                  {
                    "columnId": "sevH",
                    "label": "High"
                  },
                  {
                    "columnId": "sevM",
                    "label": "Medium"
                  },
                  {
                    "columnId": "sevL",
                    "label": "Low"
                  },
                  {
                    "columnId": "patchAvailable",
                    "label": "Fix Available"
                  },
                  {
                    "columnId": "CVEcount",
                    "label": "CVE Count"
                  }
                ]
              },
              "sortBy": []
            },
            "name": "GKE_Running_Images_VulnerabilitiesbyCluster_MDVM"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources \r\n    | where type =~ \"microsoft.security/assessments/subassessments\"\r\n    | extend assessmentKey=extract(@\"(?i)providers/Microsoft.Security/assessments/([^/]*)\", 1, id)\r\n    | extend subAssessmentId=tostring(properties.id)\r\n    | extend parentResourceId= extract(\"(.+)/providers/Microsoft.Security\", 1, id)\r\n    | extend resourceId = tostring(properties.resourceDetails.id)\r\n    | extend cluster = tostring(properties.resourceDetails.resourceName)\r\n    | extend selectedVulnerability=\"true\"\r\n    | extend subAssessmentName=tostring(properties.displayName)\r\n    | extend subAssessmentDescription=tostring(properties.description)\r\n    | extend subAssessmentRemediation=tostring(properties.remediation)\r\n    | extend subAssessmentCategory=tostring(properties.additionalData.softwareDetails.vendor)\r\n    | extend subAssessmentImpact=tostring(properties.impact)\r\n    | extend severity=tostring(parse_json(properties).additionalData.vulnerabilityDetails.severity)\r\n    | extend status=tostring(properties.status.code)\r\n    | extend cause=tostring(properties.status.cause)\r\n    | extend statusDescription=tostring(properties.status.description)\r\n    | extend additionalData=tostring(properties.additionalData)\r\n    | extend isPubliclyDisclosed=iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.isPubliclyDisclosed==\"true\",\"Yes\",\"No\"),\r\n            isInExploitKit=iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.isInExploitKit==\"true\",\"Yes\",\"No\"),\r\n            isVerified= iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.isVerified==\"true\",\"Yes\",\"No\")\r\n    //| extend cluster = tolower(extract(@'(?i)(.*?)/providers/Microsoft.Security/([^/]+)', 1, id))\r\n    | where assessmentKey == \"e538731a-80c8-4317-a119-13075e002516\"\r\n    | where status == \"Unhealthy\"\r\n   | where '{selectedk8s}' == 'All' or cluster ==  '{selectedk8s}'\r\n    | summarize \r\n        numOfResources=strcat(dcount(resourceId), \" \", \"Containers\"), \r\n       timeGenerated=arg_max(todatetime(properties.status.firstEvaulationDate), additionalData) by assessmentKey, \r\n        ['cluster'],\r\n        //resource,\r\n        subAssessmentId, \r\n        subAssessmentName, \r\n        //subAssessmentCategory,\r\n        severity,\r\n        patchable = iff(tostring(properties.additionalData.[\"softwareDetails\"].[\"patchable\"])==\"true\",\"Yes\", \"No\"),\r\n        selectedVulnerability\r\n    | project-away \r\n        assessmentKey, \r\n        additionalData\r\n    | order by ['subAssessmentId'] asc",
              "size": 0,
              "title": "Kubernetes Vulenrabilities | Select a Vulnerability to see effected Contianers",
              "noDataMessage": "No vulnerabilities found",
              "exportedParameters": [
                {
                  "fieldName": "subAssessmentId",
                  "parameterName": "selectedAssessmentId",
                  "defaultValue": "All"
                },
                {
                  "fieldName": "selectedVulnerability",
                  "parameterName": "k8sSelectedVulnerability",
                  "parameterType": 1,
                  "defaultValue": "false"
                }
              ],
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "subAssessmentName",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "150ch"
                    }
                  },
                  {
                    "columnMatch": "severity",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "High",
                          "representation": "orange",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Medium",
                          "representation": "yellow",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Low",
                          "representation": "blue",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Critical",
                          "representation": "redBright",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "blue",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "patchable",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "disabled",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "more",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "selectedVulnerability",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "timeGenerated",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "resource",
                    "formatter": 13,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true,
                "labelSettings": [
                  {
                    "columnId": "cluster",
                    "label": "Cluster"
                  },
                  {
                    "columnId": "subAssessmentId",
                    "label": "CVE ID"
                  },
                  {
                    "columnId": "subAssessmentName",
                    "label": "Security check"
                  },
                  {
                    "columnId": "severity",
                    "label": "Severity"
                  },
                  {
                    "columnId": "patchable",
                    "label": "Fix Available"
                  },
                  {
                    "columnId": "selectedVulnerability",
                    "label": "selectedVulnerability"
                  },
                  {
                    "columnId": "numOfResources",
                    "label": "Applies To"
                  },
                  {
                    "columnId": "timeGenerated",
                    "label": "Time Generated"
                  }
                ]
              }
            },
            "conditionalVisibility": {
              "parameterName": "k8sselected",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "GKE_Running_Images_Vulnerabilities_Full_ClusterView- MDVM"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources \r\n    | where type =~ \"microsoft.security/assessments/subassessments\"\r\n    | extend assessmentKey=extract(@\"(?i)providers/Microsoft.Security/assessments/([^/]*)\", 1, id)\r\n    | extend subAssessmentId=tostring(properties.id)\r\n   // | extend parentResourceId= extract(\"(.+)/providers/Microsoft.Security\", 1, id)\r\n    //| extend resourceId = extract(@'(?i)(.*?)@([^/]+)', 1,tostring(properties.resourceDetails.id))\r\n    | extend selectedContainer=\"true\"\r\n    | extend subAssessmentName=tostring(properties.displayName)\r\n    | extend subAssessmentDescription=tostring(properties.description)\r\n    | extend subAssessmentRemediation=tostring(properties.remediation)\r\n    | extend subAssessmentCategory=tostring(properties.category)\r\n    | extend subAssessmentImpact=tostring(properties.impact)\r\n    | extend severity=tostring(parse_json(properties).additionalData.vulnerabilityDetails.severity)\r\n    | extend status=tostring(properties.status.code)\r\n    | extend cause=tostring(properties.status.cause)\r\n    | extend statusDescription=tostring(properties.status.description)\r\n    | extend additionalData=tostring(properties.additionalData)\r\n    | extend isPubliclyDisclosed=iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.isPubliclyDisclosed==\"true\",\"Yes\",\"No\"),\r\n            isInExploitKit=iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.isInExploitKit==\"true\",\"Yes\",\"No\"),\r\n            isVerified= iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.isVerified==\"true\",\"Yes\",\"No\")\r\n    | extend cluster = tostring(properties.resourceDetails.resourceName)\r\n    | extend imageUri = properties.resourceDetails.id\r\n    | where assessmentKey == \"e538731a-80c8-4317-a119-13075e002516\"\r\n    | where status == \"Unhealthy\"\r\n    | where subAssessmentId == '{selectedAssessmentId}'\r\n    |extend vendor = tostring(parse_json(properties).additionalData.softwareDetails.vendor)\r\n    |extend osDistribution = tostring(parse_json(properties).additionalData.softwareDetails.osDetails.osPlatform)\r\n    |extend tags = tostring(properties.additionalData.artifactDetails.tags)\r\n    |extend tags = replace(\"\\\\[|\\\\]|\\\"\", \"\", tags)\r\n     |mv-expand references = todynamic(parse_json(properties).[\"additionalData\"].[\"vulnerabilityDetails\"].[\"references\"])\r\n   | extend referenceLink = references.link\r\n    | summarize referenceLinks = make_list(strcat(referenceLink, \"\\n\")) by \r\n        ['cluster'], \r\n        subAssessmentId, \r\n        //resourceId, \r\n        tostring(imageUri),\r\n        subAssessmentName, \r\n        tags,\r\n        severity, \r\n        vendor,\r\n        osDistribution,\r\n        subAssessmentDescription, \r\n        subAssessmentRemediation, \r\n        subAssessmentImpact, \r\n        isPubliclyDisclosed,\r\n        isVerified,\r\n        isInExploitKit,\r\n        patchable = iff(tostring(properties.additionalData.[\"softwareDetails\"].[\"patchable\"])==\"true\",\"Yes\", \"No\"), \r\n        published = format_datetime(todatetime(properties.additionalData.[\"vulnerabilityDetails\"].[\"publishedDate\"]), 'MM/d/yyyy h:m:s tt'), \r\n        selectedContainer",
              "size": 3,
              "title": "Containers Affected by the Vulnerability | Select a Container to see more details",
              "noDataMessage": "No vulnerable containers found",
              "exportedParameters": [
                {
                  "fieldName": "subAssessmentDescription",
                  "parameterName": "k8sSubAssessmentDescription",
                  "parameterType": 1
                },
                {
                  "fieldName": "subAssessmentRemediation",
                  "parameterName": "k8sSubAssessmentRemediation",
                  "parameterType": 1
                },
                {
                  "fieldName": "subAssessmentImpact",
                  "parameterName": "k8sSubAssessmentImpact",
                  "parameterType": 1
                },
                {
                  "fieldName": "subAssessmentId",
                  "parameterName": "k8sId",
                  "parameterType": 1
                },
                {
                  "fieldName": "severity",
                  "parameterName": "k8sSeverity",
                  "parameterType": 1
                },
                {
                  "fieldName": "patchable",
                  "parameterName": "k8sPatchable",
                  "parameterType": 1
                },
                {
                  "fieldName": "published",
                  "parameterName": "k8sPublished",
                  "parameterType": 1
                },
                {
                  "fieldName": "cveurl",
                  "parameterName": "k8sCveUrl",
                  "parameterType": 1
                },
                {
                  "fieldName": "cveid",
                  "parameterName": "k8sCveId",
                  "parameterType": 1
                },
                {
                  "fieldName": "selectedContainer",
                  "parameterName": "k8sSelectedContainer",
                  "parameterType": 1,
                  "defaultValue": "false"
                },
                {
                  "fieldName": "isPubliclyDisclosed",
                  "parameterName": "k8sPubliclyDisclosed",
                  "parameterType": 1
                },
                {
                  "fieldName": "isVerified",
                  "parameterName": "k8sVerified",
                  "parameterType": 1
                },
                {
                  "fieldName": "isInExploitKit",
                  "parameterName": "k8sExploitKit",
                  "parameterType": 1
                },
                {
                  "fieldName": "referenceLinks",
                  "parameterName": "k8sReferences",
                  "parameterType": 1
                }
              ],
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "resourceId",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "subAssessmentName",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "severity",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Critical",
                          "representation": "redBright",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Medium",
                          "representation": "yellow",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Low",
                          "representation": "blue",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "High",
                          "representation": "orange",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "cvss30score",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "palette": "greenRed",
                      "customColumnWidthSetting": "15ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "maximumFractionDigits": 1
                      }
                    }
                  },
                  {
                    "columnMatch": "cvss30Vector",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "fixStatus",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "FixAvailable",
                          "representation": "success",
                          "text": "Fix Available"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "unknown",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "subAssessmentDescription",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "subAssessmentRemediation",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "subAssessmentImpact",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "isPubliclyDisclosed",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "2",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "success",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "unknown",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "isVerified",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "4",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "unknown",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "isInExploitKit",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "2",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "success",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "unknown",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "patchable",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "published",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "selectedContainer",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "referenceLinks",
                    "formatter": 5
                  }
                ],
                "rowLimit": 10000,
                "labelSettings": [
                  {
                    "columnId": "cluster",
                    "label": "Cluster"
                  },
                  {
                    "columnId": "subAssessmentId",
                    "label": "ID"
                  },
                  {
                    "columnId": "imageUri",
                    "label": "Image URI"
                  },
                  {
                    "columnId": "subAssessmentName",
                    "label": "Security check"
                  },
                  {
                    "columnId": "tags",
                    "label": "Tags"
                  },
                  {
                    "columnId": "severity",
                    "label": "Severity"
                  },
                  {
                    "columnId": "vendor",
                    "label": "Vendor"
                  },
                  {
                    "columnId": "osDistribution",
                    "label": "OS Distrubution"
                  },
                  {
                    "columnId": "isPubliclyDisclosed",
                    "label": "Exploit Steps Published"
                  },
                  {
                    "columnId": "isVerified",
                    "label": "Exploit Steps Verified"
                  },
                  {
                    "columnId": "isInExploitKit",
                    "label": "In Exploit Kit"
                  }
                ]
              }
            },
            "conditionalVisibility": {
              "parameterName": "k8sSelectedVulnerability",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "GKE_Containers_Affected_By_Vulnerability-MDVM"
          },
          {
            "type": 1,
            "content": {
              "json": "### Description \r\n{k8sSubAssessmentDescription}\r\n\r\n### Remediation\r\n{k8sSubAssessmentRemediation}\r\n### General Information\r\n<table style=\"width:100%\">\r\n  <tr>\r\n    <th>ID</th>\r\n    <th>Severity</th>\r\n    <th>Patchable</th>\r\n\t<th>Published</th>\r\n  </tr>\r\n    <tr>\r\n    <td>{k8sId}</td>\r\n    <td>{k8sSeverity}</td>\r\n    <td>{k8sPatchable}</td>\r\n\t<td>{k8sPublished}</td>\r\n  </tr>\r\n  </table>\r\n\r\n  ### Exploitability Information\r\n<table style=\"width:100%\">\r\n  <tr>\r\n    <th>In Exploit Kit</th>\r\n\t<th>Publicly Disclosed</th>\r\n\t<th>Verified</th>\r\n  </tr>\r\n    <tr>\r\n    <td>{k8sExploitKit}</td>\r\n    <td>{k8sPubliclyDisclosed}</td>\r\n\t<td>{k8sVerified}</td>\r\n  </tr>\r\n  </table>\r\n\r\n### Reference Information\r\n{k8sReferences} <br>\r\n <br> <br>\r\n\r\n\r\n\r\n",
              "style": "info"
            },
            "conditionalVisibility": {
              "parameterName": "k8sSelectedContainer",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "GKE_Vulnerability_Card-MDVM"
          }
        ],
        "exportParameters": true
      },
      "conditionalVisibilities": [
        {
          "parameterName": "tab",
          "comparison": "isEqualTo",
          "value": "k8smdvm"
        },
        {
          "parameterName": "runtimecloud",
          "comparison": "isEqualTo",
          "value": "gcp"
        }
      ],
      "name": "gkemdvm  "
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources \nâ€¯â€¯â€¯â€¯|â€¯whereâ€¯typeâ€¯==â€¯\"microsoft.security/assessments\" \nâ€¯â€¯â€¯â€¯|â€¯extendâ€¯healthStateâ€¯=â€¯properties.status.code    \n    | extend url = strcat(\"https://\", properties.links.azurePortal)\n    | extend resource = tostring(properties.resourceDetails.Id)\n    | extend resourcesecblade = strcat(tostring(id), \"/security\")\n    | extend recommendation = tostring(properties.metadata.displayName)\n    | extend ResourceType = id \n    | extend AssessmentKey = name\n    | where healthState in ('Unhealthy')\n    | where recommendation contains ('Policy add-on for Kubernetes installed')\n    | project \n        resource,\n        recommendation, \n        AssessmentKey\n    | order by recommendation desc\n    | take 5",
              "size": 1,
              "title": "Missing Azure Policy add-on for Kubernetes",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "value::all"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "recommendation",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "110ch"
                    }
                  },
                  {
                    "columnMatch": "AssessmentKey",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "OpenBlade",
                      "linkLabel": "Recommendation Link",
                      "bladeOpenContext": {
                        "bladeName": "RecommendationsBlade",
                        "extensionName": "Microsoft_Azure_Security",
                        "bladeParameters": [
                          {
                            "name": "assessmentKey",
                            "source": "column",
                            "value": "AssessmentKey"
                          }
                        ]
                      }
                    }
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "resource",
                    "label": "Resource"
                  },
                  {
                    "columnId": "recommendation",
                    "label": "Recommendation"
                  },
                  {
                    "columnId": "AssessmentKey",
                    "label": "Link "
                  }
                ]
              }
            },
            "name": "Recommendations"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources \r\nâ€¯â€¯â€¯â€¯|â€¯whereâ€¯typeâ€¯==â€¯\"microsoft.security/assessments\" \r\nâ€¯â€¯â€¯â€¯|â€¯extendâ€¯healthStateâ€¯=â€¯properties.status.code    \r\n    | extend url = strcat(\"https://\", properties.links.azurePortal)\r\n    | extend resource = tostring(properties.resourceDetails.Id)\r\n    | extend recommendation = tostring(properties.metadata.displayName)\r\n    | extend recommendationID = tostring(properties.links.azurePortal)\r\n    | extend ResourceType = tolower(split(id,\"/\").[6])\r\n    | extend AssessmentKey = name\r\n    | where healthState in ('Unhealthy')\r\n    | where recommendationID contains ('405c9ae6-49f9-46c4-8873-a86690f27818') or recommendationID contains ('8d244d29-fa00-4332-b935-c3a51d525417') or recommendationID contains ('11c95609-3553-430d-b788-fd41cde8b2db') or recommendationID contains ('86f91051-9d6a-47c3-a07f-bd14cb214b45') or recommendationID contains ('add45209-73f6-4fa5-a5a5-74a451b07fbe') or recommendationID contains ('ebc68898-5c0f-4353-a426-4a5f1e737b12') or recommendationID contains ('f0debc84-981c-4a0d-924d-aa4bd7d55fef') or recommendationID contains ('43dc2a2e-ce69-4d42-923e-ab7d136f2cfe') or recommendationID contains ('802c0637-5a8c-4c98-abd7-7c96d89d6010') or recommendationID contains ('27d6f0e9-b4d5-468b-ae7e-03d5473fd864') or  recommendationID contains ('c6d87087-9ebe-b31f-b452-0bf3bbbaccd2') or recommendationID contains  ('32060ac3-f17f-4848-db8e-e7cf2c9a53eb') or recommendationID contains ('ff87e0b4-17df-d338-5b19-80e71e0dcc9d') or recommendationID contains ('aba14f78-27c5-af84-848e-9105d18dfd92') or recommendationID contains ('5d90913f-a1c5-4429-ad54-2c6c17fb3c73') or recommendationID contains ('9b795646-9130-41a4-90b7-df9eae2437c8') or recommendationID contains ('111cb068-89df-48bd-9493-2e6773444af8')\r\n\r\n    | project \r\n        resource, \r\n        recommendation,\r\n        AssessmentKey\r\n        \r\n    | order by recommendation desc\r\n    ",
              "size": 2,
              "title": "Data plan recommendations",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "$gen_group",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "120ch"
                    }
                  },
                  {
                    "columnMatch": "resource",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "50ch"
                    }
                  },
                  {
                    "columnMatch": "recommendation",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "AssessmentKey",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "OpenBlade",
                      "linkLabel": "Recommendation Link",
                      "bladeOpenContext": {
                        "bladeName": "RecommendationsBlade",
                        "extensionName": "Microsoft_Azure_Security",
                        "bladeParameters": [
                          {
                            "name": "assessmentKey",
                            "source": "column",
                            "value": "AssessmentKey"
                          }
                        ]
                      }
                    }
                  },
                  {
                    "columnMatch": "$gen_group",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "120ch"
                    }
                  },
                  {
                    "columnMatch": "url",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "Url"
                    }
                  }
                ],
                "hierarchySettings": {
                  "treeType": 1,
                  "groupBy": [
                    "recommendation"
                  ],
                  "expandTopLevel": false
                },
                "labelSettings": [
                  {
                    "columnId": "resource",
                    "label": "Resource "
                  },
                  {
                    "columnId": "recommendation",
                    "label": "Recommendation"
                  },
                  {
                    "columnId": "AssessmentKey",
                    "label": "Link"
                  }
                ]
              },
              "tileSettings": {
                "showBorder": false
              },
              "graphSettings": {
                "type": 0
              }
            },
            "conditionalVisibilities": [
              {
                "parameterName": "k8srecommendation",
                "comparison": "isEqualTo",
                "value": "Yes"
              },
              {
                "parameterName": "tab",
                "comparison": "isEqualTo",
                "value": "Hareden"
              }
            ],
            "name": "query - 30"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources \r\nâ€¯â€¯â€¯â€¯|â€¯whereâ€¯typeâ€¯==â€¯\"microsoft.security/assessments\" \r\nâ€¯â€¯â€¯â€¯|â€¯extendâ€¯healthStateâ€¯=â€¯properties.status.code    \r\n    | extend url = strcat(\"https://\", properties.links.azurePortal)\r\n    | extend resource = tostring(properties.resourceDetails.Id)\r\n    | extend recommendation = tostring(properties.metadata.displayName)\r\n    | extend recommendationID = tostring(properties.links.azurePortal)\r\n    | extend ResourceType = tolower(split(id,\"/\").[6])\r\n    | extend AssessmentKey = name\r\n    | where healthState in ('Unhealthy')\r\n    | where recommendationID contains ('e599a9fe-30e3-47c6-a173-8b4b6d9d3255') or recommendationID contains ('56a83a6e-c417-42ec-b567-1e6fcb3d09a9') or recommendationID contains ('3ef9848c-c2c8-4ff3-8b9c-4c8eb8ddfce6') or recommendationID contains ('08e628db-e2ed-4793-bc91-d13e684401c3') or recommendationID contains ('0642d770-b189-42ef-a2ce-9dcc3ec6c169') or recommendationID contains ('b0fdc63a-38e7-4bab-a7c4-2c2665abbaa9') or  recommendationID contains ('1a2b5b4c-f80d-46e7-ac81-b51a9fb363de') or recommendationID contains  ('32060ac3-f17f-4848-db8e-e7cf2c9a53eb') or recommendationID contains ('ff87e0b4-17df-d338-5b19-80e71e0dcc9d') or recommendationID contains ('aba14f78-27c5-af84-848e-9105d18dfd92') or recommendationID contains ('bb318338-de6a-42ff-8428-8274c897d564') \r\n    | project \r\n        resource, \r\n        recommendation,\r\n        AssessmentKey\r\n        \r\n    | order by recommendation desc\r\n    ",
              "size": 2,
              "title": "Control plan recommendations",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "$gen_group",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "120ch"
                    }
                  },
                  {
                    "columnMatch": "recommendation",
                    "formatter": 5,
                    "formatOptions": {
                      "aggregation": "Count"
                    }
                  },
                  {
                    "columnMatch": "AssessmentKey",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "OpenBlade",
                      "linkLabel": "Recommendation Link",
                      "bladeOpenContext": {
                        "bladeName": "RecommendationsBlade",
                        "extensionName": "Microsoft_Azure_Security",
                        "bladeParameters": [
                          {
                            "name": "assessmentKey",
                            "source": "column",
                            "value": "AssessmentKey"
                          }
                        ]
                      }
                    }
                  },
                  {
                    "columnMatch": "$gen_group",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "120ch"
                    }
                  }
                ],
                "hierarchySettings": {
                  "treeType": 1,
                  "groupBy": [
                    "recommendation"
                  ]
                },
                "labelSettings": [
                  {
                    "columnId": "resource",
                    "label": "Resource"
                  },
                  {
                    "columnId": "recommendation",
                    "label": "Recommendation"
                  },
                  {
                    "columnId": "AssessmentKey",
                    "label": "Link"
                  }
                ]
              }
            },
            "conditionalVisibilities": [
              {
                "parameterName": "k8srecommendation",
                "comparison": "isEqualTo",
                "value": "Yes"
              },
              {
                "parameterName": "tab",
                "comparison": "isEqualTo",
                "value": "Hareden"
              }
            ],
            "name": "query - 2"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "tab",
        "comparison": "isEqualTo",
        "value": "Hareden"
      },
      "name": "HaredenGroup"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## Azure Container Registry - Vulnerabilities\r\n\r\nThis dashboard is powered by the recommendation: [Azure registry images should have vulnerability findings resolved (powered by Microsoft Defender Vulnerability Management)](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/c0b7cfc6-3172-465a-b378-53c7ff2cc0d5).\r\nClick [here](https://learn.microsoft.com/en-us/azure/defender-for-cloud/agentless-vulnerability-assessment-azure) to learn more about how the scanning works. "
            },
            "name": "Acr_Vulnerabilities_Text_MDVM"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\r\n    | where type == \"microsoft.security/assessments/subassessments\"\r\n    | extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n    | extend severity = tostring(properties.additionalData.vulnerabilityDetails.severity), Status = tostring(properties.status.code)\r\n    | extend status = tostring(parse_json(properties).status.code)\r\n    | extend vulId=tostring((properties).id)\r\n    | extend Resource = tolower(extract(@'(?i)(.*?)/providers/Microsoft.Security/([^/]+)', 1, id))\r\n    | where assessmentKey == \"c0b7cfc6-3172-465a-b378-53c7ff2cc0d5\"\r\n    | where Resource in~({acrs})\r\n    | where status == 'Unhealthy' \r\n    | distinct \r\n        vulId, \r\n        severity\r\n    | summarize count=count() by tostring(severity)",
              "size": 4,
              "title": "Vulnerabilities by severity",
              "noDataMessage": "No vulnerabilities found",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "visualization": "piechart",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "Category",
                  "formatter": 1,
                  "numberFormat": {
                    "unit": 0,
                    "options": {
                      "style": "decimal"
                    },
                    "emptyValCustomText": "Other"
                  }
                },
                "leftContent": {
                  "columnMatch": "count",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 2,
                      "maximumSignificantDigits": 3
                    },
                    "emptyValCustomText": "Unkown"
                  }
                },
                "showBorder": true,
                "sortCriteriaField": "count",
                "sortOrderField": 2
              },
              "graphSettings": {
                "type": 0,
                "topContent": {
                  "columnMatch": "severity",
                  "formatter": 1
                },
                "centerContent": {
                  "columnMatch": "count",
                  "formatter": 1,
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              }
            },
            "customWidth": "50",
            "name": "Acr_Vulnerability_Severity_MDVM"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\r\n    | where type == \"microsoft.security/assessments/subassessments\"\r\n    | extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n    | where assessmentKey == \"c0b7cfc6-3172-465a-b378-53c7ff2cc0d5\"\r\n   | extend Resource = tolower(extract(@'(?i)(.*?)/providers/Microsoft.Security/([^/]+)', 1, id))\r\n    | where Resource in~({acrs})\r\n    | extend VulnId = tostring(parse_json(properties).id)\r\n    | extend Status = tostring(parse_json(properties).status.code)\r\n    | extend Severity=tostring(parse_json(properties).additionalData.vulnerabilityDetails.severity)\r\n    | extend fixStatus = parse_json(properties.additionalData).softwareDetails.fixStatus\r\n    | extend Distro = tostring(properties.additionalData.softwareDetails.osDetails.osVersion), imageUri = properties.resourceDetails.id, CVSS3_0 = tostring(properties.additionalData.cvssV30Score), PackageName = tostring(properties.additionalData.softwareDetails.packageName),\r\n             Evidence = tostring(properties.additionalData.softwareDetails.evidence), VulnerabilityCategory = tostring(properties.additionalData.softwareDetails.category), \r\n             PackageVersion = tostring(properties.additionalData.softwareDetails.version), Published = tostring(properties.additionalData.vulnerabilityDetails.publishedDate),\r\n\t     FixedVersion = tostring(properties.additionalData.softwareDetails.fixedVersion), Description = tostring(properties.description), Remediation = tostring(properties.remediation)\r\n    |extend Vendor = tostring(parse_json(properties).additionalData.softwareDetails.vendor)\r\n    |extend OsDistribution = tostring(parse_json(properties).additionalData.softwareDetails.osDetails.osPlatform)\r\n   |mv-expand references = todynamic(parse_json(properties).[\"additionalData\"].[\"vulnerabilityDetails\"].[\"references\"])\r\n|extend referenceLink = references.link\r\n    |extend Tags =  tostring(properties.additionalData.artifactDetails.tags)\r\n    |extend Tags = replace(\"\\\\[|\\\\]|\\\"\", \"\", Tags),\r\n    isExploitStepsPublished=iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.exploitStepsPublished==\"true\",\"Yes\",\"No\"),\r\n            isInExploitKit=iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.isInExploitKit==\"true\",\"Yes\",\"No\"),\r\n            isVerified= iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.exploitSetpsVerified==\"true\",\"Yes\",\"No\")\r\n | project \r\n        Resource, \r\n        imageUri,\r\n        VulnId, \r\n        Status,\r\n        Severity,\r\n        tostring(fixStatus),\r\n        isExploitStepsPublished,\r\n        isVerified,\r\n        isInExploitKit,\r\n        CVSS3_0,\r\n        Tags,\r\n        Distro,\r\n        Vendor,\r\n        OsDistribution,\r\n        VulnerabilityCategory,\r\n        Evidence,\r\n        PackageVersion,\r\n        FixedVersion,\r\n        Published,\r\n      Remediation,  \r\n       Description,\r\n        referenceLink\r\n    | where Status == 'Unhealthy'\r\n    | where isExploitStepsPublished == \"Yes\" or isInExploitKit == \"Yes\" or isVerified == \"Yes\"\r\n    | project-away Status ",
              "size": 1,
              "title": "Exploitable Vulnerablities",
              "noDataMessage": "No exploitable vulnerabilities found",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Resource",
                    "formatter": 13,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true,
                      "customColumnWidthSetting": "30ch"
                    }
                  },
                  {
                    "columnMatch": "Severity",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Critical",
                          "representation": "redBright",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Medium",
                          "representation": "yellow",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Low",
                          "representation": "blue",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "High",
                          "representation": "orange",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "fixStatus",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "FixAvailable",
                          "representation": "success",
                          "text": "Fix Available"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Unknown",
                          "representation": "unknown",
                          "text": "Unknown"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "unknown",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "isExploitStepsPublished",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "2",
                          "text": "Yes"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "success",
                          "text": "No"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "success",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "isVerified",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "Yes"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "4",
                          "text": "No"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "success",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "isInExploitKit",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "warning",
                          "text": "Yes"
                        },
                        {
                          "operator": "==",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "Available",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "unknown",
                          "text": "{0}{1}"
                        }
                      ]
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "CVSS3_0",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "max": 10,
                      "palette": "greenRed",
                      "customColumnWidthSetting": "15ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "minimumFractionDigits": 1
                      }
                    }
                  },
                  {
                    "columnMatch": "Distro",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Published",
                    "formatter": 6
                  },
                  {
                    "columnMatch": "Remediation",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "Description",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "remediation",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "description",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "itemSelected",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "subscriptionId",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "PublishedDate",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "25ch"
                    }
                  },
                  {
                    "columnMatch": "cvss30score",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "palette": "greenRed",
                      "customColumnWidthSetting": "15ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "minimumFractionDigits": 1
                      }
                    }
                  },
                  {
                    "columnMatch": "cvss30Vector",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "referenceLinks",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "referenceTitle",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "link",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "category",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Issue",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "cvss20score",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "palette": "greenRed",
                      "customColumnWidthSetting": "15ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "maximumFractionDigits": 1
                      },
                      "emptyValCustomText": "N/A"
                    }
                  },
                  {
                    "columnMatch": "cvss20Vector",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "impact",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "PublishedTime",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "25ch"
                    }
                  },
                  {
                    "columnMatch": "Patchable",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "disabled",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "more",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "cveTitle",
                    "formatter": 1,
                    "formatOptions": {
                      "linkColumn": "cveURL",
                      "linkTarget": "Url"
                    }
                  },
                  {
                    "columnMatch": "cveURL",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "vendorReferencesTitle",
                    "formatter": 1,
                    "formatOptions": {
                      "linkColumn": "vendorReferencesURL",
                      "linkTarget": "Url"
                    }
                  },
                  {
                    "columnMatch": "vendorReferencesURL",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "timeGenerated",
                    "formatter": 6
                  }
                ],
                "rowLimit": 1000,
                "filter": true,
                "labelSettings": [
                  {
                    "columnId": "Resource",
                    "label": "Image URI"
                  },
                  {
                    "columnId": "imageUri",
                    "label": "Image URI"
                  },
                  {
                    "columnId": "VulnId",
                    "label": "Vulnerability ID"
                  },
                  {
                    "columnId": "Severity",
                    "label": "Severity"
                  },
                  {
                    "columnId": "fixStatus",
                    "label": "Fix Status"
                  },
                  {
                    "columnId": "isExploitStepsPublished",
                    "label": "Exploit Steps Published"
                  },
                  {
                    "columnId": "isVerified",
                    "label": "Exploit Steps Verifiable",
                    "comment": ""
                  },
                  {
                    "columnId": "isInExploitKit",
                    "label": "In Exploit Kit"
                  },
                  {
                    "columnId": "CVSS3_0",
                    "label": "CVSS Score"
                  },
                  {
                    "columnId": "Tags",
                    "label": "Tags",
                    "comment": ""
                  },
                  {
                    "columnId": "Distro",
                    "label": "Distro"
                  },
                  {
                    "columnId": "Vendor",
                    "label": "Vendor"
                  },
                  {
                    "columnId": "OsDistribution",
                    "label": "OS Distribution"
                  },
                  {
                    "columnId": "VulnerabilityCategory",
                    "label": "Vulnerability Category"
                  },
                  {
                    "columnId": "Evidence",
                    "label": "Evidence (OS Packages only)",
                    "comment": "Evidence is only available for OS packages"
                  },
                  {
                    "columnId": "PackageVersion",
                    "label": "Package Version"
                  },
                  {
                    "columnId": "FixedVersion",
                    "label": "Fixed Version"
                  },
                  {
                    "columnId": "Published",
                    "label": "Published Date"
                  },
                  {
                    "columnId": "Remediation",
                    "label": "Remediation"
                  },
                  {
                    "columnId": "Description",
                    "label": "Description"
                  },
                  {
                    "columnId": "referenceLink",
                    "label": "Reference Link"
                  }
                ]
              },
              "sortBy": []
            },
            "customWidth": "100",
            "name": "ACRExploitable_MDVM"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\r\n    | where type == \"microsoft.security/assessments/subassessments\"\r\n    | extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n    | where assessmentKey == \"c0b7cfc6-3172-465a-b378-53c7ff2cc0d5\"\r\n    | project \r\n        Resource = tolower(extract(@'(?i)(.*?)/providers/Microsoft.Security/([^/]+)', 1, id)), \r\n        ResourceGroup = trim_end(\"/\",extract(\".*resourceGroups/(.+?)/\",0,id)),\r\n        ResourceType = tolower(split(id,\"/\").[6]), \r\n        subscriptionId, severity = tostring(parse_json(properties).additionalData.vulnerabilityDetails.severity), \r\n        status = tostring(parse_json(properties).status.code), \r\n        VulnId = tostring(parse_json(properties).id), \r\n        description = tostring(parse_json(properties).displayName), \r\n        fixStatus = tostring(parse_json(properties).additionalData.softwareDetails.fixStatus), \r\n        cve = parse_json(properties.additionalData).cve\r\n    | where Resource in~({acrs})\r\n    | where status == 'Unhealthy'\r\n    | summarize \r\n        dcount(VulnId) by ResourceGroup, \r\n        Resource, \r\n        severity, \r\n        VulnId, \r\n        description, \r\n        tostring(fixStatus), \r\n        tostring(cve)\r\n    | summarize \r\n        Total = count(dcount_VulnId), \r\n        sevC=countif(severity=='Critical'),\r\n        sevH=countif(severity=='High'), \r\n        sevM=countif(severity=='Medium'), \r\n        sevL=countif(severity=='Low'), \r\n        fixAvailable = countif(fixStatus=='FixAvailable'), \r\n        CVEcount =countif(cve!='[]') by ResourceGroup, \r\n        Resource, \r\n        acrSelected = \"true\"\r\n    | order by sevH desc",
              "size": 1,
              "title": "Vulnerable container registries |  Select a container registry to view the list of vulnerable containers and the security recommendation for the registry ",
              "noDataMessage": "No unhealthy registries found",
              "exportedParameters": [
                {
                  "fieldName": "Resource",
                  "parameterName": "selectedACR",
                  "parameterType": 5,
                  "defaultValue": "All"
                },
                {
                  "fieldName": "acrSelected",
                  "parameterName": "acrSelected",
                  "parameterType": 1,
                  "defaultValue": "false"
                }
              ],
              "showExportToExcel": true,
              "exportToExcelOptions": "all",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "$gen_group",
                    "formatter": 13,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "Resource group",
                    "formatter": 13,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "ResourceGroup",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Resource",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "acrSelected",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Total",
                    "formatter": 1,
                    "formatOptions": {
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "sevC",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Sev0",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "sevH",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Sev1",
                          "text": "{0}{1}"
                        }
                      ],
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": []
                      }
                    }
                  },
                  {
                    "columnMatch": "sevM",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Sev2",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "sevL",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Sev3",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "fixAvailable",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "uninitialized",
                          "text": "{0}{1}"
                        }
                      ]
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "CVEcount",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "4",
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "patchAvailable",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "pending",
                          "text": "{0}{1}"
                        }
                      ],
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": []
                      }
                    }
                  }
                ],
                "rowLimit": 1000,
                "filter": true,
                "hierarchySettings": {
                  "treeType": 1,
                  "groupBy": [
                    "ResourceGroup"
                  ],
                  "expandTopLevel": true,
                  "finalBy": "Resource"
                },
                "labelSettings": [
                  {
                    "columnId": "ResourceGroup",
                    "label": "Resource group"
                  },
                  {
                    "columnId": "sevC",
                    "label": "Critical"
                  },
                  {
                    "columnId": "sevH",
                    "label": "High"
                  },
                  {
                    "columnId": "sevM",
                    "label": "Medium"
                  },
                  {
                    "columnId": "sevL",
                    "label": "Low"
                  },
                  {
                    "columnId": "fixAvailable",
                    "label": "Fix Available"
                  },
                  {
                    "columnId": "CVEcount",
                    "label": "CVEs"
                  }
                ]
              },
              "sortBy": []
            },
            "name": "Acr_Vulnerabilities_List - MDVM"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources \r\nâ€¯â€¯â€¯â€¯|â€¯whereâ€¯typeâ€¯==â€¯\"microsoft.security/assessments\" \r\nâ€¯â€¯â€¯â€¯|â€¯extendâ€¯healthStateâ€¯=â€¯properties.status.code \r\n    | extend url = strcat(\"https://\", properties.links.azurePortal)\r\n    | extend resource = tostring(properties.resourceDetails.Id)\r\n    | extend recommendation = tostring(properties.metadata.displayName)\r\n    | extend ResourceType = tolower(split(id,\"/\").[6])\r\n    | where resource == ('{selectedACR}') \r\n    | where healthState in ('Unhealthy') and ResourceType == \"microsoft.containerregistry\"\r\n    | project \r\n        resource, \r\n        recommendation, \r\n        url\r\n    | order by recommendation asc",
              "size": 1,
              "title": "Azure Container Registry Security Recommendations",
              "noDataMessage": "No security recommendations found",
              "showExportToExcel": true,
              "exportToExcelOptions": "all",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "resource",
                    "formatter": 13,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "recommendation",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "150ch"
                    }
                  },
                  {
                    "columnMatch": "url",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "Url",
                      "linkLabel": "URL"
                    }
                  },
                  {
                    "columnMatch": "healthState",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "properties_metadata_displayName",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "properties_resourceDetails_Id",
                    "formatter": 13,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "value",
                    "formatter": 1
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "resource",
                    "label": "Resource"
                  },
                  {
                    "columnId": "recommendation",
                    "label": "Security Recommendation"
                  },
                  {
                    "columnId": "url",
                    "label": "URL"
                  }
                ]
              }
            },
            "conditionalVisibilities": [
              {
                "parameterName": "acrSelected",
                "comparison": "isEqualTo",
                "value": "true"
              },
              {
                "parameterName": "acrrecommendation",
                "comparison": "isEqualTo",
                "value": "Yes"
              }
            ],
            "name": "ACR_Recommendations"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\r\n    | where type == \"microsoft.security/assessments/subassessments\"\r\n    | extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n    | where assessmentKey == \"c0b7cfc6-3172-465a-b378-53c7ff2cc0d5\"\r\n    | project \r\n        Resource = tolower(extract(@'(?i)(.*?)/providers/Microsoft.Security/([^/]+)', 1, id)), \r\n        ResourceType = tolower(split(id,\"/\").[6]), \r\n        subscriptionId, \r\n        severity = tostring(parse_json(properties).additionalData.vulnerabilityDetails.severity), \r\n        status = tostring(parse_json(properties).status.code), \r\n        VulnId = tostring(parse_json(properties).id), \r\n        description = tostring(parse_json(properties).displayName), \r\n        fixStatus = parse_json(properties.additionalData).softwareDetails.fixStatus, \r\n        cve = parse_json(properties.additionalData).cve, \r\n        Repo = tostring(parse_json(properties).additionalData.artifactDetails.repositoryName), \r\n        imageUri = tostring(parse_json(properties.resourceDetails).id)\r\n    | where status == 'Unhealthy' \r\n    | where Resource == '{selectedACR}'\r\n    | summarize \r\n        dcount(VulnId) by Resource, \r\n        severity, \r\n        VulnId, \r\n        description, \r\n        tostring(fixStatus), \r\n        tostring(cve), \r\n        Repo, \r\n        imageUri\r\n    | summarize \r\n        Total = count(dcount_VulnId), \r\n        sevC=countif(severity=='Critical'),\r\n        sevH=countif(severity=='High'), \r\n        sevM=countif(severity=='Medium'), \r\n        sevL=countif(severity=='Low'), \r\n        fixAvailable = countif(fixStatus=='FixAvailable'), \r\n        CVEcount =countif(cve!='[]') by Resource, \r\n        Repo, \r\n        imageUri, \r\n        repoSelected=\"true\"\r\n    | order by sevH desc",
              "size": 3,
              "title": "Vulnerable images | Select an Image to see the vulnerabilities",
              "noDataMessage": "No vulnerable images found",
              "exportedParameters": [
                {
                  "fieldName": "Repo",
                  "parameterName": "SelectedRepo",
                  "defaultValue": "All"
                },
                {
                  "fieldName": "repoSelected",
                  "parameterName": "acrRepoSelected",
                  "parameterType": 1,
                  "defaultValue": "false"
                }
              ],
              "showExportToExcel": true,
              "exportToExcelOptions": "all",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Resource",
                    "formatter": 13,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "Repo",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "repoSelected",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Total",
                    "formatter": 1,
                    "formatOptions": {
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "sevC",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "redBright",
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "sevH",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "orange",
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "sevM",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "yellow",
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "sevL",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "blueDark",
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "fixAvailable",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "uninitialized",
                          "text": "{0}{1}"
                        }
                      ]
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "CVEcount",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "4",
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "imageDigest",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "80ch"
                    }
                  },
                  {
                    "columnMatch": "patchAvailable",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "pending",
                          "text": "{0}{1}"
                        }
                      ],
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": []
                      },
                      "customColumnWidthSetting": "15ch"
                    }
                  }
                ],
                "rowLimit": 1000,
                "filter": true,
                "labelSettings": [
                  {
                    "columnId": "Repo",
                    "label": "Repository"
                  },
                  {
                    "columnId": "imageUri",
                    "label": "Image URI "
                  },
                  {
                    "columnId": "sevC",
                    "label": "Critical"
                  },
                  {
                    "columnId": "sevH",
                    "label": "High"
                  },
                  {
                    "columnId": "sevM",
                    "label": "Medium"
                  },
                  {
                    "columnId": "sevL",
                    "label": "Low"
                  },
                  {
                    "columnId": "fixAvailable",
                    "label": "Fix Available"
                  },
                  {
                    "columnId": "CVEcount",
                    "label": "CVEs"
                  }
                ]
              },
              "sortBy": []
            },
            "conditionalVisibility": {
              "parameterName": "acrSelected",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "Acr_Image_Vilnerabilty_ListbyRegistry_MDVM"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\r\n    | where type == \"microsoft.security/assessments/subassessments\"\r\n    | extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n    | where assessmentKey == \"c0b7cfc6-3172-465a-b378-53c7ff2cc0d5\"\r\n    | extend itemSelected=\"true\"\r\n    | extend cvss30score=properties.[\"additionalData\"].[\"vulnerabilityDetails\"].[\"cvss\"].[\"3.0\"].[\"base\"]\r\n    | extend cvss30Vector=properties.[\"additionalData\"].[\"vulnerabilityDetails\"].[\"cvss\"].[\"3.0\"].[\"cvssVectorString\"]\r\n    | extend description=properties.[\"description\"]\r\n    | extend remediation=properties.[\"remediation\"]\r\n   | extend Resource = tolower(extract(@'(?i)(.*?)/providers/Microsoft.Security/([^/]+)', 1, id))\r\n    | where Resource in~({acrs})\r\n    | extend RepositoryName=tostring(parse_json(properties).additionalData.artifactDetails.repositoryName)\r\n    | extend VulnId = tostring(parse_json(properties).id)\r\n    | extend PublishedDate=format_datetime(todatetime(properties.[\"additionalData\"].[\"vulnerabilityDetails\"].[\"publishedDate\"]), 'MM/d/yyyy h:m:s tt')\r\n    | extend TimeGenerated=format_datetime(todatetime(properties.timeGenerated), 'MM/d/yyyy h:m:s tt')\r\n    | extend Status = tostring(parse_json(properties).status.code)\r\n    | extend Severity=tostring(parse_json(properties).additionalData.vulnerabilityDetails.severity)\r\n    | extend fixStatus = parse_json(properties.additionalData).softwareDetails.fixStatus\r\n    | extend imageUri = properties.resourceDetails.id,\r\n    isExploitStepsPublished=iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.exploitStepsPublished==\"true\",\"Yes\",\"No\"),\r\n            isInExploitKit=iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.isInExploitKit==\"true\",\"Yes\",\"No\"),\r\n            isVerified= iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.exploitSetpsVerified==\"true\",\"Yes\",\"No\")\r\n   |mv-expand references = todynamic(parse_json(properties).[\"additionalData\"].[\"vulnerabilityDetails\"].[\"references\"])\r\n   | extend referenceLink = references.link\r\n    |extend vendor = tostring(parse_json(properties).additionalData.softwareDetails.vendor)\r\n    |extend osDistribution = tostring(parse_json(properties).additionalData.softwareDetails.osDetails.osPlatform),  Distro = tostring(properties.additionalData.softwareDetails.osDetails.osVersion)\r\n    |extend tags =  tostring(properties.additionalData.artifactDetails.tags)\r\n    |extend tags = replace(\"\\\\[|\\\\]|\\\"\", \"\", tags) \r\n    | summarize referenceLinks = make_list(strcat(referenceLink, \"\\n\")) by \r\n    itemSelected,\r\n    subscriptionId,\r\n    Resource, \r\n    RepositoryName, \r\n    VulnId, \r\n    PublishedDate,\r\n    TimeGenerated,\r\n    Status,\r\n    Severity,\r\n    tostring(fixStatus),\r\n    tostring(imageUri),\r\n    tags,\r\n    tostring(cvss30score),\r\n    tostring(cvss30Vector),\r\n    tostring(description),\r\n    tostring(remediation),\r\n    vendor,\r\n    osDistribution,\r\n    Distro,\r\n    isExploitStepsPublished,\r\n    isVerified,\r\n    isInExploitKit\r\n    | where Status == 'Unhealthy'\r\n     | where RepositoryName == '{SelectedRepo}'\r\n    | project-away Status ",
              "size": 1,
              "title": "Vulnerabilities | Select Vulnerability to see more details",
              "noDataMessage": "No vulnerability found",
              "exportedParameters": [
                {
                  "fieldName": "RepositoryName",
                  "parameterName": "acrRepositoryName",
                  "defaultValue": "All"
                },
                {
                  "fieldName": "description",
                  "parameterName": "acrDescription",
                  "parameterType": 1
                },
                {
                  "fieldName": "remediation",
                  "parameterName": "acrRemediation",
                  "parameterType": 1
                },
                {
                  "fieldName": "Issue",
                  "parameterName": "acrIssue",
                  "parameterType": 1
                },
                {
                  "fieldName": "VulnId",
                  "parameterName": "acrVulnId",
                  "parameterType": 1
                },
                {
                  "fieldName": "Severity",
                  "parameterName": "acrSeverity",
                  "parameterType": 1
                },
                {
                  "fieldName": "PublishedDate",
                  "parameterName": "acrPublishedDate",
                  "parameterType": 1
                },
                {
                  "fieldName": "fixStatus",
                  "parameterName": "acrFixStatus",
                  "parameterType": 1
                },
                {
                  "fieldName": "itemSelected",
                  "parameterName": "acrItemSelected",
                  "parameterType": 1,
                  "defaultValue": "false"
                },
                {
                  "fieldName": "cvss30Vector",
                  "parameterName": "acrCvss30Vector",
                  "parameterType": 1
                },
                {
                  "parameterType": 1
                },
                {
                  "fieldName": "isInExploitKit",
                  "parameterName": "acrExploitKit",
                  "parameterType": 1
                },
                {
                  "fieldName": "isVerified",
                  "parameterName": "acrVerified",
                  "parameterType": 1
                },
                {
                  "fieldName": "isExploitStepsPublished",
                  "parameterName": "acrVulnPublished",
                  "parameterType": 1
                },
                {
                  "fieldName": "referenceLinks",
                  "parameterName": "acrReferences",
                  "parameterType": 1
                }
              ],
              "showExportToExcel": true,
              "exportToExcelOptions": "all",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "itemSelected",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "subscriptionId",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Resource",
                    "formatter": 13,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true,
                      "customColumnWidthSetting": "30ch"
                    }
                  },
                  {
                    "columnMatch": "PublishedDate",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "25ch"
                    }
                  },
                  {
                    "columnMatch": "Severity",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Critical",
                          "representation": "redBright",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Medium",
                          "representation": "yellow",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Low",
                          "representation": "blue",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "High",
                          "representation": "orange",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "fixStatus",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "FixAvailable",
                          "representation": "success",
                          "text": "Fix Available"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Unknown",
                          "representation": "unknown",
                          "text": "Unknown"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "unknown",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "cvss30score",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "palette": "greenRed",
                      "customColumnWidthSetting": "15ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "minimumFractionDigits": 1
                      }
                    }
                  },
                  {
                    "columnMatch": "cvss30Vector",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "description",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "remediation",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "isExploitStepsPublished",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "2",
                          "text": "Yes"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "success",
                          "text": "No"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "success",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "isVerified",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "Yes"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "4",
                          "text": "No"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "success",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "isInExploitKit",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "warning",
                          "text": "Yes"
                        },
                        {
                          "operator": "==",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "Available",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "unknown",
                          "text": "{0}{1}"
                        }
                      ]
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "referenceLinks",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "referenceTitle",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "link",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "category",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Issue",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "cvss20score",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "palette": "greenRed",
                      "customColumnWidthSetting": "15ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "maximumFractionDigits": 1
                      },
                      "emptyValCustomText": "N/A"
                    }
                  },
                  {
                    "columnMatch": "cvss20Vector",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "impact",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "PublishedTime",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "25ch"
                    }
                  },
                  {
                    "columnMatch": "Patchable",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "disabled",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "more",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "cveTitle",
                    "formatter": 1,
                    "formatOptions": {
                      "linkColumn": "cveURL",
                      "linkTarget": "Url"
                    }
                  },
                  {
                    "columnMatch": "cveURL",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "vendorReferencesTitle",
                    "formatter": 1,
                    "formatOptions": {
                      "linkColumn": "vendorReferencesURL",
                      "linkTarget": "Url"
                    }
                  },
                  {
                    "columnMatch": "vendorReferencesURL",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "timeGenerated",
                    "formatter": 6
                  }
                ],
                "rowLimit": 1000,
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "$gen_thresholds_fixStatus_8",
                    "sortOrder": 1
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "subscriptionId",
                    "label": "Subscription name"
                  },
                  {
                    "columnId": "RepositoryName",
                    "label": "Repository name"
                  },
                  {
                    "columnId": "VulnId",
                    "label": "Vulnerability ID"
                  },
                  {
                    "columnId": "TimeGenerated",
                    "label": "Time generated"
                  },
                  {
                    "columnId": "fixStatus",
                    "label": "Fix Status"
                  },
                  {
                    "columnId": "imageUri",
                    "label": "Image URI"
                  },
                  {
                    "columnId": "tags",
                    "label": "Tags"
                  },
                  {
                    "columnId": "cvss30score",
                    "label": "CVSS Score"
                  },
                  {
                    "columnId": "cvss30Vector",
                    "label": "Threat vector"
                  },
                  {
                    "columnId": "vendor",
                    "label": "Vendor"
                  },
                  {
                    "columnId": "osDistribution",
                    "label": "OS Distribution"
                  },
                  {
                    "columnId": "isExploitStepsPublished",
                    "label": "Exploit Steps Published"
                  },
                  {
                    "columnId": "isVerified",
                    "label": "Exploit Steps Verified"
                  },
                  {
                    "columnId": "isInExploitKit",
                    "label": "In Exploit Kit"
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "$gen_thresholds_fixStatus_8",
                  "sortOrder": 1
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "acrRepoSelected",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "Acr_Image_Vulnerabilities_Full_ListbyRepo_MDVM"
          },
          {
            "type": 1,
            "content": {
              "json": "### Description for {acrRepositoryName} vulnerability\r\n{acrDescription} <br>\r\n <br> <br>\r\nCVSS 3.0 Threat Vectors\" {acrCvss30Vector}\r\n\r\n### Remediation\r\n{acrRemediation}\r\n### General Information\r\n<table style=\"width:100%\">\r\n  <tr>\r\n    <th>ID</th>\r\n    <th>Severity</th>\r\n\t<th>Fix Status</th>\r\n\t<th>Published</th>\r\n  </tr>\r\n    <tr>\r\n    <td>{acrVulnId}</td>\r\n    <td>{acrSeverity}</td>\r\n\t<td>{acrFixStatus}</td>\r\n\t<td>{acrPublishedDate}</td>\r\n  </tr>\r\n  </table>\r\n\r\n  ### Exploitability Information\r\n<table style=\"width:100%\">\r\n  <tr>\r\n\t<th>Exploit Steps Published</th>\r\n\t<th>Exploit Steps Verified</th>\r\n\t<th>In Exploit Kit</th>\r\n  </tr>\r\n    <tr>\r\n    <td>{acrVulnPublished}</td>\r\n\t<td>{acrVerified}</td>\r\n\t <td>{acrExploitKit}</td>\r\n  </tr>\r\n  </table>\r\n\r\n  ### Reference Information\r\n{acrReferences} <br>\r\n <br> <br>\r\n\r\n\r\n",
              "style": "info"
            },
            "conditionalVisibility": {
              "parameterName": "acrItemSelected",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "Acr_Vulnerability_card_MDVM"
          }
        ]
      },
      "conditionalVisibilities": [
        {
          "parameterName": "tab",
          "comparison": "isEqualTo",
          "value": "registrymdvm"
        },
        {
          "parameterName": "registryscanning",
          "comparison": "isEqualTo",
          "value": "acr"
        }
      ],
      "name": "acr-mdvm-group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## GCP Registries - Vulnerabilities\r\n\r\nThis dashboard is powered by the recommendation: [GCP registry images should have vulnerability findings resolved (powered by Microsoft Defender Vulnerability Management)](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/5cc3a2c1-8397-456f-8792-fe9d0d4c9145).\r\nClick [here](https://learn.microsoft.com/en-us/azure/defender-for-cloud/agentless-vulnerability-assessment-gcp) to learn more about how the scanning works. "
            },
            "name": "GCP_Vulnerabilities_Text_MDVM"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\r\n    | where type == \"microsoft.security/assessments/subassessments\"\r\n    | extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n    | extend severity = tostring(properties.additionalData.vulnerabilityDetails.severity), Status = tostring(properties.status.code)\r\n    | extend status = tostring(parse_json(properties).status.code)\r\n    | extend vulId=tostring((properties).id)\r\n    | extend Resource = tolower(extract(@'(?i)(.*?)/providers/Microsoft.Security/([^/]+)', 1, id))\r\n    |extend connectorId = extract(\"(.*)/securityentitydata\", 1, id)\r\n    |where connectorId in~({gcpconnector})\r\n    | where assessmentKey == \"5cc3a2c1-8397-456f-8792-fe9d0d4c9145\"\r\n   |extend ResourceName = tostring(properties.additionalData.artifactDetails.repositoryName)\r\n   |extend ResourceName = tostring(properties.resourceDetails.resourceName)\r\n    | where status == 'Unhealthy' \r\n    | distinct \r\n        vulId, \r\n        severity\r\n    | summarize count=count() by tostring(severity)",
              "size": 4,
              "title": "Vulnerabilities by severity",
              "noDataMessage": "No vulnerabilities found",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "visualization": "piechart",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "Category",
                  "formatter": 1,
                  "numberFormat": {
                    "unit": 0,
                    "options": {
                      "style": "decimal"
                    },
                    "emptyValCustomText": "Other"
                  }
                },
                "leftContent": {
                  "columnMatch": "count",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 2,
                      "maximumSignificantDigits": 3
                    },
                    "emptyValCustomText": "Unkown"
                  }
                },
                "showBorder": true,
                "sortCriteriaField": "count",
                "sortOrderField": 2
              },
              "graphSettings": {
                "type": 0,
                "topContent": {
                  "columnMatch": "severity",
                  "formatter": 1
                },
                "centerContent": {
                  "columnMatch": "count",
                  "formatter": 1,
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              }
            },
            "customWidth": "50",
            "name": "GCP_Vulnerability_Severity_MDVM"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\r\n    | where type == \"microsoft.security/assessments/subassessments\"\r\n    | extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n    | where assessmentKey == \"5cc3a2c1-8397-456f-8792-fe9d0d4c9145\"\r\n   //| extend Resource = tolower(extract(@'(?i)(.*?)/providers/Microsoft.Security/([^/]+)', 1, id))\r\n   |extend Resource= properties.resourceDetails.resourceName\r\n    | extend VulnId = tostring(parse_json(properties).id)\r\n    | extend Status = tostring(parse_json(properties).status.code)\r\n    | extend Severity=tostring(parse_json(properties).additionalData.vulnerabilityDetails.severity)\r\n    | extend fixStatus = parse_json(properties.additionalData).softwareDetails.fixStatus\r\n    | extend Distro = tostring(properties.additionalData.softwareDetails.osDetails.osVersion), imageUri = properties.resourceDetails.id, CVSS3_0 = tostring(properties.additionalData.cvssV30Score), PackageName = tostring(properties.additionalData.softwareDetails.packageName),\r\n             Evidence = tostring(properties.additionalData.softwareDetails.evidence), VulnerabilityCategory = tostring(properties.additionalData.softwareDetails.category), \r\n             PackageVersion = tostring(properties.additionalData.softwareDetails.version), Published = tostring(properties.additionalData.vulnerabilityDetails.publishedDate),\r\n\t     FixedVersion = tostring(properties.additionalData.softwareDetails.fixedVersion), Description = tostring(properties.description), Remediation = tostring(properties.remediation)\r\n    |extend Vendor = tostring(parse_json(properties).additionalData.softwareDetails.vendor)\r\n    |extend OsDistribution = tostring(parse_json(properties).additionalData.softwareDetails.osDetails.osPlatform)\r\n   |mv-expand references = todynamic(parse_json(properties).[\"additionalData\"].[\"vulnerabilityDetails\"].[\"references\"])\r\n|extend referenceLink = references.link\r\n    |extend Tags =  tostring(properties.additionalData.artifactDetails.tags)\r\n    |extend Tags = replace(\"\\\\[|\\\\]|\\\"\", \"\", Tags),\r\n    isExploitStepsPublished=iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.exploitStepsPublished==\"true\",\"Yes\",\"No\"),\r\n            isInExploitKit=iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.isInExploitKit==\"true\",\"Yes\",\"No\"),\r\n            isVerified= iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.exploitSetpsVerified==\"true\",\"Yes\",\"No\")\r\n | project \r\n        connectorId = extract(\"(.*)/securityentitydata\", 1, id),\r\n        ProjectId = tostring(properties.resourceDetails.hierarchyId),\r\n        Resource, \r\n        imageUri,\r\n        VulnId, \r\n        Status,\r\n        Severity,\r\n        tostring(fixStatus),\r\n        isExploitStepsPublished,\r\n        isVerified,\r\n        isInExploitKit,\r\n        CVSS3_0,\r\n        Tags,\r\n        Vendor,\r\n        OsDistribution,\r\n        Distro,\r\n        VulnerabilityCategory,\r\n        Evidence,\r\n        PackageVersion,\r\n        FixedVersion,\r\n        Published,\r\n      Remediation,  \r\n       Description,\r\n        referenceLink\r\n    | where Status == 'Unhealthy'\r\n    | where connectorId in~({gcpconnector})\r\n    | where isExploitStepsPublished == \"Yes\" or isInExploitKit == \"Yes\" or isVerified == \"Yes\"\r\n    | project-away Status ",
              "size": 1,
              "title": "Exploitable Vulnerablities",
              "noDataMessage": "No exploitable vulnerabilities found",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "connectorId",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Resource",
                    "formatter": 13,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true,
                      "customColumnWidthSetting": "30ch"
                    }
                  },
                  {
                    "columnMatch": "Severity",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Critical",
                          "representation": "redBright",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Medium",
                          "representation": "yellow",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Low",
                          "representation": "blue",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "High",
                          "representation": "orange",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "fixStatus",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "FixAvailable",
                          "representation": "success",
                          "text": "Fix Available"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Unknown",
                          "representation": "unknown",
                          "text": "Unknown"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "unknown",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "isExploitStepsPublished",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "2",
                          "text": "Yes"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "success",
                          "text": "No"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "success",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "isVerified",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "Yes"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "4",
                          "text": "No"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "success",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "isInExploitKit",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "warning",
                          "text": "Yes"
                        },
                        {
                          "operator": "==",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "Available",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "unknown",
                          "text": "{0}{1}"
                        }
                      ]
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "CVSS3_0",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "max": 10,
                      "palette": "greenRed",
                      "customColumnWidthSetting": "15ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "minimumFractionDigits": 1
                      }
                    }
                  },
                  {
                    "columnMatch": "Distro",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "Published",
                    "formatter": 6
                  },
                  {
                    "columnMatch": "Remediation",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "Description",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "remediation",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "description",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "itemSelected",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "subscriptionId",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "PublishedDate",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "25ch"
                    }
                  },
                  {
                    "columnMatch": "cvss30score",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "palette": "greenRed",
                      "customColumnWidthSetting": "15ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "minimumFractionDigits": 1
                      }
                    }
                  },
                  {
                    "columnMatch": "cvss30Vector",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "referenceLinks",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "referenceTitle",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "link",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "category",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Issue",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "cvss20score",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "palette": "greenRed",
                      "customColumnWidthSetting": "15ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "maximumFractionDigits": 1
                      },
                      "emptyValCustomText": "N/A"
                    }
                  },
                  {
                    "columnMatch": "cvss20Vector",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "impact",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "PublishedTime",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "25ch"
                    }
                  },
                  {
                    "columnMatch": "Patchable",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "disabled",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "more",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "cveTitle",
                    "formatter": 1,
                    "formatOptions": {
                      "linkColumn": "cveURL",
                      "linkTarget": "Url"
                    }
                  },
                  {
                    "columnMatch": "cveURL",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "vendorReferencesTitle",
                    "formatter": 1,
                    "formatOptions": {
                      "linkColumn": "vendorReferencesURL",
                      "linkTarget": "Url"
                    }
                  },
                  {
                    "columnMatch": "vendorReferencesURL",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "timeGenerated",
                    "formatter": 6
                  }
                ],
                "rowLimit": 1000,
                "filter": true,
                "labelSettings": [
                  {
                    "columnId": "connectorId",
                    "label": "Connector Id"
                  },
                  {
                    "columnId": "ProjectId",
                    "label": "Project Id"
                  },
                  {
                    "columnId": "Resource",
                    "label": "Resource"
                  },
                  {
                    "columnId": "imageUri",
                    "label": "Image URI"
                  },
                  {
                    "columnId": "VulnId",
                    "label": "Vulnerability ID"
                  },
                  {
                    "columnId": "Severity",
                    "label": "Severity"
                  },
                  {
                    "columnId": "fixStatus",
                    "label": "Fix Status"
                  },
                  {
                    "columnId": "isExploitStepsPublished",
                    "label": "Exploit Steps Published"
                  },
                  {
                    "columnId": "isVerified",
                    "label": "Exploit Steps Verifiable",
                    "comment": ""
                  },
                  {
                    "columnId": "isInExploitKit",
                    "label": "In Exploit Kit"
                  },
                  {
                    "columnId": "CVSS3_0",
                    "label": "CVSS Score"
                  },
                  {
                    "columnId": "Tags",
                    "label": "Tags",
                    "comment": ""
                  },
                  {
                    "columnId": "Vendor",
                    "label": "Vendor"
                  },
                  {
                    "columnId": "OsDistribution",
                    "label": "OS Distribution"
                  },
                  {
                    "columnId": "Distro",
                    "label": "Distro"
                  },
                  {
                    "columnId": "VulnerabilityCategory",
                    "label": "Vulnerability Category"
                  },
                  {
                    "columnId": "Evidence",
                    "label": "Evidence (OS Packages only)",
                    "comment": "Evidence is only available for OS packages"
                  },
                  {
                    "columnId": "PackageVersion",
                    "label": "Package Version"
                  },
                  {
                    "columnId": "FixedVersion",
                    "label": "Fixed Version"
                  },
                  {
                    "columnId": "Published",
                    "label": "Published Date"
                  },
                  {
                    "columnId": "Remediation",
                    "label": "Remediation"
                  },
                  {
                    "columnId": "Description",
                    "label": "Description"
                  },
                  {
                    "columnId": "referenceLink",
                    "label": "Reference Link"
                  }
                ]
              },
              "sortBy": []
            },
            "customWidth": "100",
            "name": "GCPExploitable_MDVM"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\r\n    | where type == \"microsoft.security/assessments/subassessments\"\r\n    | extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n    | where assessmentKey == \"5cc3a2c1-8397-456f-8792-fe9d0d4c9145\"\r\n    | project \r\n        //Resource = tolower(extract(@'(?i)(.*?)/providers/Microsoft.Security/([^/]+)', 1, id)), \r\n        connectorId = extract(\"(.*)/securityentitydata\", 1, id),\r\n        Resource = tostring(properties.resourceDetails.resourceName),\r\n        ProjectId = tostring(properties.resourceDetails.hierarchyId),\r\n        ResourceType = tolower(split(id,\"/\").[6]), \r\n        subscriptionId, severity = tostring(parse_json(properties).additionalData.vulnerabilityDetails.severity), \r\n        status = tostring(parse_json(properties).status.code), \r\n        VulnId = tostring(parse_json(properties).id), \r\n        description = tostring(parse_json(properties).displayName), \r\n        fixStatus = tostring(parse_json(properties).additionalData.softwareDetails.fixStatus), \r\n        cve = parse_json(properties.additionalData).cve\r\n    | where status == 'Unhealthy'\r\n    | where connectorId in~({gcpconnector})\r\n    | summarize \r\n        dcount(VulnId) by ProjectId, \r\n       Resource, \r\n        severity, \r\n        VulnId, \r\n        description, \r\n        tostring(fixStatus), \r\n        tostring(cve)\r\n    | summarize \r\n        Total = count(dcount_VulnId), \r\n        sevC=countif(severity=='Critical'),\r\n        sevH=countif(severity=='High'), \r\n        sevM=countif(severity=='Medium'), \r\n        sevL=countif(severity=='Low'), \r\n        fixAvailable = countif(fixStatus=='FixAvailable'), \r\n        CVEcount =countif(cve!='[]') by ProjectId,\r\n       Resource,\r\n       gcpSelected = \"true\"\r\n    | order by sevH desc",
              "size": 1,
              "title": "Vulnerable container registries |  Select a container registry to view the list of vulnerable containers and the security recommendation for the registry ",
              "noDataMessage": "No unhealthy registries found",
              "exportedParameters": [
                {
                  "fieldName": "gcpSelected",
                  "parameterName": "gcpSelected",
                  "parameterType": 1,
                  "defaultValue": "false"
                },
                {
                  "fieldName": "Resource",
                  "parameterName": "selectedGCP",
                  "parameterType": 5
                }
              ],
              "showExportToExcel": true,
              "exportToExcelOptions": "all",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "ProjectId",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "gcpSelected",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Total",
                    "formatter": 1,
                    "formatOptions": {
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "sevC",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Sev0",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "sevH",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Sev1",
                          "text": "{0}{1}"
                        }
                      ],
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": []
                      }
                    }
                  },
                  {
                    "columnMatch": "sevM",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Sev2",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "sevL",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Sev3",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "fixAvailable",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "uninitialized",
                          "text": "{0}{1}"
                        }
                      ]
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "CVEcount",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "4",
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "Resource group",
                    "formatter": 13,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "ResourceGroup",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "acrSelected",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "patchAvailable",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "pending",
                          "text": "{0}{1}"
                        }
                      ],
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": []
                      }
                    }
                  }
                ],
                "rowLimit": 1000,
                "filter": true,
                "hierarchySettings": {
                  "treeType": 1,
                  "groupBy": [
                    "ProjectId"
                  ]
                },
                "labelSettings": [
                  {
                    "columnId": "ProjectId",
                    "label": "Project Id"
                  },
                  {
                    "columnId": "Resource",
                    "label": "Resource"
                  },
                  {
                    "columnId": "gcpSelected",
                    "label": "gcpSelected"
                  },
                  {
                    "columnId": "Total",
                    "label": "Total"
                  },
                  {
                    "columnId": "sevC",
                    "label": "Critical"
                  },
                  {
                    "columnId": "sevH",
                    "label": "High"
                  },
                  {
                    "columnId": "sevM",
                    "label": "Medium"
                  },
                  {
                    "columnId": "sevL",
                    "label": "Low"
                  },
                  {
                    "columnId": "fixAvailable",
                    "label": "Fix Available"
                  },
                  {
                    "columnId": "CVEcount",
                    "label": "CVEs"
                  }
                ]
              },
              "sortBy": []
            },
            "conditionalVisibility": {
              "parameterName": "tab",
              "comparison": "isEqualTo",
              "value": "0"
            },
            "name": "GCP_Vulnerabilities_List - MDVM"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources \r\nâ€¯â€¯â€¯â€¯|â€¯whereâ€¯typeâ€¯==â€¯\"microsoft.security/assessments\" \r\nâ€¯â€¯â€¯â€¯|â€¯extendâ€¯healthStateâ€¯=â€¯properties.status.code \r\n    | extend url = strcat(\"https://\", properties.links.azurePortal)\r\n    | extend resource = tostring(properties.resourceDetails.Id)\r\n    | extend recommendation = tostring(properties.metadata.displayName)\r\n    | extend ResourceType = tolower(split(id,\"/\").[6])\r\n    | where resource == ('{selectedACR}') \r\n    | where healthState in ('Unhealthy') and ResourceType == \"microsoft.containerregistry\"\r\n    | project \r\n        resource, \r\n        recommendation, \r\n        url\r\n    | order by recommendation asc",
              "size": 1,
              "title": "Azure Container Registry Security Recommendations",
              "noDataMessage": "No security recommendations found",
              "showExportToExcel": true,
              "exportToExcelOptions": "all",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "resource",
                    "formatter": 13,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "recommendation",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "150ch"
                    }
                  },
                  {
                    "columnMatch": "url",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "Url",
                      "linkLabel": "URL"
                    }
                  },
                  {
                    "columnMatch": "healthState",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "properties_metadata_displayName",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "properties_resourceDetails_Id",
                    "formatter": 13,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "value",
                    "formatter": 1
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "resource",
                    "label": "Resource"
                  },
                  {
                    "columnId": "recommendation",
                    "label": "Security Recommendation"
                  },
                  {
                    "columnId": "url",
                    "label": "URL"
                  }
                ]
              }
            },
            "conditionalVisibilities": [
              {
                "parameterName": "acrSelected",
                "comparison": "isEqualTo",
                "value": "true"
              },
              {
                "parameterName": "acrrecommendation",
                "comparison": "isEqualTo",
                "value": "Yes"
              }
            ],
            "name": "ACR_Recommendations"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\r\n    | where type == \"microsoft.security/assessments/subassessments\"\r\n    | extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n    | where assessmentKey == \"5cc3a2c1-8397-456f-8792-fe9d0d4c9145\"\r\n    | project \r\n       // Resource = tolower(extract(@'(?i)(.*?)/providers/Microsoft.Security/([^/]+)', 1, id)), \r\n       ProjectId = tostring(properties.resourceDetails.hierarchyId),\r\n        Resource = tostring(properties.resourceDetails.resourceName),\r\n        ResourceType = tolower(split(id,\"/\").[6]), \r\n        subscriptionId, \r\n        severity = tostring(parse_json(properties).additionalData.vulnerabilityDetails.severity), \r\n        status = tostring(parse_json(properties).status.code), \r\n        VulnId = tostring(parse_json(properties).id), \r\n        description = tostring(parse_json(properties).displayName), \r\n        fixStatus = parse_json(properties.additionalData).softwareDetails.fixStatus, \r\n        cve = parse_json(properties.additionalData).cve, \r\n        Repo = tostring(parse_json(properties).additionalData.artifactDetails.repositoryName), \r\n        imageUri = tostring(parse_json(properties.resourceDetails).id)\r\n    | where status == 'Unhealthy' \r\n    | summarize \r\n        dcount(VulnId) by Resource, ProjectId,\r\n        severity, \r\n        VulnId, \r\n        description, \r\n        tostring(fixStatus), \r\n        tostring(cve), \r\n        Repo, \r\n        imageUri\r\n    | summarize \r\n        Total = count(dcount_VulnId), \r\n        sevC=countif(severity=='Critical'),\r\n        sevH=countif(severity=='High'), \r\n        sevM=countif(severity=='Medium'), \r\n        sevL=countif(severity=='Low'), \r\n        fixAvailable = countif(fixStatus=='FixAvailable'), \r\n        CVEcount =countif(cve!='[]') by Resource, ProjectId,\r\n        Repo, \r\n        imageUri, \r\n        repoSelected=\"true\"\r\n    | order by sevH desc",
              "size": 3,
              "title": "Vulnerable images | Select an Image to see the vulnerabilities",
              "noDataMessage": "No vulnerable images found",
              "exportedParameters": [
                {
                  "fieldName": "Repo",
                  "parameterName": "SelectedRepo",
                  "defaultValue": "All"
                },
                {
                  "fieldName": "repoSelected",
                  "parameterName": "gcpRepoSelected",
                  "parameterType": 1,
                  "defaultValue": "false"
                }
              ],
              "showExportToExcel": true,
              "exportToExcelOptions": "all",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Resource",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "ProjectId",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "repoSelected",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Total",
                    "formatter": 1,
                    "formatOptions": {
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "sevC",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "redBright",
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "sevH",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "orange",
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "sevM",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "yellow",
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "sevL",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "blueDark",
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "fixAvailable",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "uninitialized",
                          "text": "{0}{1}"
                        }
                      ]
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "CVEcount",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "4",
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "imageDigest",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "80ch"
                    }
                  },
                  {
                    "columnMatch": "patchAvailable",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "pending",
                          "text": "{0}{1}"
                        }
                      ],
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": []
                      },
                      "customColumnWidthSetting": "15ch"
                    }
                  }
                ],
                "rowLimit": 1000,
                "filter": true,
                "hierarchySettings": {
                  "treeType": 1,
                  "groupBy": [
                    "ProjectId"
                  ]
                },
                "labelSettings": [
                  {
                    "columnId": "Resource",
                    "label": "Resource"
                  },
                  {
                    "columnId": "ProjectId",
                    "label": "Project Id"
                  },
                  {
                    "columnId": "Repo",
                    "label": "Resource"
                  },
                  {
                    "columnId": "imageUri",
                    "label": "Image URI"
                  },
                  {
                    "columnId": "repoSelected",
                    "label": "repoSelected"
                  },
                  {
                    "columnId": "Total",
                    "label": "Total"
                  },
                  {
                    "columnId": "sevC",
                    "label": "Critical"
                  },
                  {
                    "columnId": "sevH",
                    "label": "High"
                  },
                  {
                    "columnId": "sevM",
                    "label": "Medium"
                  },
                  {
                    "columnId": "sevL",
                    "label": "Low"
                  },
                  {
                    "columnId": "fixAvailable",
                    "label": "Fix Available"
                  },
                  {
                    "columnId": "CVEcount",
                    "label": "CveCount"
                  }
                ]
              },
              "sortBy": []
            },
            "name": "GCP_Image_Vilnerabilty_ListbyRegistry_MDVM"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\r\n    | where type == \"microsoft.security/assessments/subassessments\"\r\n    | extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n    | where assessmentKey == \"5cc3a2c1-8397-456f-8792-fe9d0d4c9145\"\r\n    | extend itemSelected=\"true\"\r\n    | extend cvss30score=properties.[\"additionalData\"].[\"vulnerabilityDetails\"].[\"cvss\"].[\"3.0\"].[\"base\"]\r\n    | extend cvss30Vector=properties.[\"additionalData\"].[\"vulnerabilityDetails\"].[\"cvss\"].[\"3.0\"].[\"cvssVectorString\"]\r\n    | extend description=properties.[\"description\"]\r\n    | extend remediation=properties.[\"remediation\"]\r\n  // | extend Resource = tolower(extract(@'(?i)(.*?)/providers/Microsoft.Security/([^/]+)', 1, id))\r\n   | extend Resource = tostring(properties.resourceDetails.resourceName)\r\n    | extend RepositoryName=tostring(parse_json(properties).additionalData.artifactDetails.repositoryName)\r\n    | extend VulnId = tostring(parse_json(properties).id)\r\n    | extend PublishedDate=format_datetime(todatetime(properties.[\"additionalData\"].[\"vulnerabilityDetails\"].[\"publishedDate\"]), 'MM/d/yyyy h:m:s tt')\r\n    | extend TimeGenerated=format_datetime(todatetime(properties.timeGenerated), 'MM/d/yyyy h:m:s tt')\r\n    | extend Status = tostring(parse_json(properties).status.code)\r\n    | extend Severity=tostring(parse_json(properties).additionalData.vulnerabilityDetails.severity)\r\n    | extend fixStatus = parse_json(properties.additionalData).softwareDetails.fixStatus\r\n    | extend imageUri = properties.resourceDetails.id,\r\n    isExploitStepsPublished=iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.exploitStepsPublished==\"true\",\"Yes\",\"No\"),\r\n            isInExploitKit=iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.isInExploitKit==\"true\",\"Yes\",\"No\"),\r\n            isVerified= iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.exploitSetpsVerified==\"true\",\"Yes\",\"No\")\r\n   |mv-expand references = todynamic(parse_json(properties).[\"additionalData\"].[\"vulnerabilityDetails\"].[\"references\"])\r\n   | extend referenceLink = references.link\r\n    |extend vendor = tostring(parse_json(properties).additionalData.softwareDetails.vendor)\r\n    |extend osDistribution = tostring(parse_json(properties).additionalData.softwareDetails.osDetails.osPlatform),  Distro = tostring(properties.additionalData.softwareDetails.osDetails.osVersion)\r\n    |extend tags =  tostring(properties.additionalData.artifactDetails.tags)\r\n    |extend tags = replace(\"\\\\[|\\\\]|\\\"\", \"\", tags) \r\n    | summarize referenceLinks = make_list(strcat(referenceLink, \"\\n\")) by \r\n    itemSelected,\r\n    subscriptionId,\r\n    Resource, \r\n    RepositoryName, \r\n    VulnId, \r\n    PublishedDate,\r\n    TimeGenerated,\r\n    Status,\r\n    Severity,\r\n    tostring(fixStatus),\r\n    tostring(imageUri),\r\n    tags,\r\n    tostring(cvss30score),\r\n    tostring(cvss30Vector),\r\n    tostring(description),\r\n    tostring(remediation),\r\n    vendor,\r\n    osDistribution,\r\n    Distro,\r\n    isExploitStepsPublished,\r\n    isVerified,\r\n    isInExploitKit\r\n    | where Status == 'Unhealthy'\r\n     | where RepositoryName == '{SelectedRepo}'\r\n    | project-away Status ",
              "size": 1,
              "title": "Vulnerabilities | Select Vulnerability to see more details",
              "noDataMessage": "No vulnerability found",
              "exportedParameters": [
                {
                  "fieldName": "RepositoryName",
                  "parameterName": "gcpRepositoryName",
                  "defaultValue": "All"
                },
                {
                  "fieldName": "description",
                  "parameterName": "gcpDescription",
                  "parameterType": 1
                },
                {
                  "fieldName": "remediation",
                  "parameterName": "gcpRemediation",
                  "parameterType": 1
                },
                {
                  "fieldName": "Issue",
                  "parameterName": "gcpIssue",
                  "parameterType": 1
                },
                {
                  "fieldName": "VulnId",
                  "parameterName": "gcpVulnId",
                  "parameterType": 1
                },
                {
                  "fieldName": "Severity",
                  "parameterName": "gcpSeverity",
                  "parameterType": 1
                },
                {
                  "fieldName": "PublishedDate",
                  "parameterName": "gcpPublishedDate",
                  "parameterType": 1
                },
                {
                  "fieldName": "fixStatus",
                  "parameterName": "gcpFixStatus",
                  "parameterType": 1
                },
                {
                  "fieldName": "itemSelected",
                  "parameterName": "gcpItemSelected",
                  "parameterType": 1,
                  "defaultValue": "false"
                },
                {
                  "fieldName": "cvss30Vector",
                  "parameterName": "gcpCvss30Vector",
                  "parameterType": 1
                },
                {
                  "parameterType": 1
                },
                {
                  "fieldName": "isInExploitKit",
                  "parameterName": "gcpExploitKit",
                  "parameterType": 1
                },
                {
                  "fieldName": "isVerified",
                  "parameterName": "gcpVerified",
                  "parameterType": 1
                },
                {
                  "fieldName": "isExploitStepsPublished",
                  "parameterName": "gcpVulnPublished",
                  "parameterType": 1
                },
                {
                  "fieldName": "referenceLinks",
                  "parameterName": "gcpReferences",
                  "parameterType": 1
                }
              ],
              "showExportToExcel": true,
              "exportToExcelOptions": "all",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "itemSelected",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "subscriptionId",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Resource",
                    "formatter": 13,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true,
                      "customColumnWidthSetting": "30ch"
                    }
                  },
                  {
                    "columnMatch": "PublishedDate",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "25ch"
                    }
                  },
                  {
                    "columnMatch": "Severity",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Critical",
                          "representation": "redBright",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Medium",
                          "representation": "yellow",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Low",
                          "representation": "blue",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "High",
                          "representation": "orange",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "fixStatus",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "FixAvailable",
                          "representation": "success",
                          "text": "Fix Available"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Unknown",
                          "representation": "unknown",
                          "text": "Unknown"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "unknown",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "cvss30score",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "palette": "greenRed",
                      "customColumnWidthSetting": "15ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "minimumFractionDigits": 1
                      }
                    }
                  },
                  {
                    "columnMatch": "cvss30Vector",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "description",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "remediation",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "isExploitStepsPublished",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "2",
                          "text": "Yes"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "success",
                          "text": "No"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "success",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "isVerified",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "Yes"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "4",
                          "text": "No"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "success",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "isInExploitKit",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "warning",
                          "text": "Yes"
                        },
                        {
                          "operator": "==",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "Available",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "unknown",
                          "text": "{0}{1}"
                        }
                      ]
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "referenceLinks",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "referenceTitle",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "link",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "category",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Issue",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "cvss20score",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "palette": "greenRed",
                      "customColumnWidthSetting": "15ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "maximumFractionDigits": 1
                      },
                      "emptyValCustomText": "N/A"
                    }
                  },
                  {
                    "columnMatch": "cvss20Vector",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "impact",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "PublishedTime",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "25ch"
                    }
                  },
                  {
                    "columnMatch": "Patchable",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "disabled",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "more",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "cveTitle",
                    "formatter": 1,
                    "formatOptions": {
                      "linkColumn": "cveURL",
                      "linkTarget": "Url"
                    }
                  },
                  {
                    "columnMatch": "cveURL",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "vendorReferencesTitle",
                    "formatter": 1,
                    "formatOptions": {
                      "linkColumn": "vendorReferencesURL",
                      "linkTarget": "Url"
                    }
                  },
                  {
                    "columnMatch": "vendorReferencesURL",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "timeGenerated",
                    "formatter": 6
                  }
                ],
                "rowLimit": 1000,
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "$gen_thresholds_fixStatus_8",
                    "sortOrder": 1
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "subscriptionId",
                    "label": "Subscription name"
                  },
                  {
                    "columnId": "RepositoryName",
                    "label": "Repository name"
                  },
                  {
                    "columnId": "VulnId",
                    "label": "Vulnerability ID"
                  },
                  {
                    "columnId": "TimeGenerated",
                    "label": "Time generated"
                  },
                  {
                    "columnId": "fixStatus",
                    "label": "Fix Status"
                  },
                  {
                    "columnId": "imageUri",
                    "label": "Image URI"
                  },
                  {
                    "columnId": "tags",
                    "label": "Tags"
                  },
                  {
                    "columnId": "cvss30score",
                    "label": "CVSS Score"
                  },
                  {
                    "columnId": "cvss30Vector",
                    "label": "Threat vector"
                  },
                  {
                    "columnId": "vendor",
                    "label": "Vendor"
                  },
                  {
                    "columnId": "osDistribution",
                    "label": "OS Distribution"
                  },
                  {
                    "columnId": "isExploitStepsPublished",
                    "label": "Exploit Steps Published"
                  },
                  {
                    "columnId": "isVerified",
                    "label": "Exploit Steps Verified"
                  },
                  {
                    "columnId": "isInExploitKit",
                    "label": "In Exploit Kit"
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "$gen_thresholds_fixStatus_8",
                  "sortOrder": 1
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "gcpRepoSelected",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "GCP_Image_Vulnerabilities_Full_ListbyRepo_MDVM"
          },
          {
            "type": 1,
            "content": {
              "json": "### Description for {gcpRepositoryName} vulnerability\r\n{gcpDescription} <br>\r\n <br> <br>\r\nCVSS 3.0 Threat Vectors\" {gcpCvss30Vector}\r\n\r\n### Remediation\r\n{gcpRemediation}\r\n### General Information\r\n<table style=\"width:100%\">\r\n  <tr>\r\n    <th>ID</th>\r\n    <th>Severity</th>\r\n\t<th>Fix Status</th>\r\n\t<th>Published</th>\r\n  </tr>\r\n    <tr>\r\n    <td>{gcpVulnId}</td>\r\n    <td>{gcpSeverity}</td>\r\n\t<td>{gcpFixStatus}</td>\r\n\t<td>{gcpPublishedDate}</td>\r\n  </tr>\r\n  </table>\r\n\r\n  ### Exploitability Information\r\n<table style=\"width:100%\">\r\n  <tr>\r\n\t<th>Exploit Steps Published</th>\r\n\t<th>Exploit Steps Verified</th>\r\n\t<th>In Exploit Kit</th>\r\n  </tr>\r\n    <tr>\r\n    <td>{gcpVulnPublished}</td>\r\n\t<td>{gcpVerified}</td>\r\n\t <td>{gcpExploitKit}</td>\r\n  </tr>\r\n  </table>\r\n\r\n  ### Reference Information\r\n{gcpReferences} <br>\r\n <br> <br>\r\n\r\n\r\n",
              "style": "info"
            },
            "conditionalVisibility": {
              "parameterName": "gcpItemSelected",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "GCP_Vulnerability_card_MDVM"
          }
        ]
      },
      "conditionalVisibilities": [
        {
          "parameterName": "tab",
          "comparison": "isEqualTo",
          "value": "registrymdvm"
        },
        {
          "parameterName": "registryscanning",
          "comparison": "isEqualTo",
          "value": "gargcr"
        }
      ],
      "name": "gar-gcr--mdvm-group "
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## ECR - Vulnerabilities\r\n\r\nThis dashboard is powered by the recommendation: [AWS registry container images should have vulnerability findings resolved (powered by Microsoft Defender Vulnerability Management)](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/c27441ae-775c-45be-8ffa-655de37362ce).\r\nClick [here](https://learn.microsoft.com/en-us/azure/defender-for-cloud/agentless-vulnerability-assessment-aws) to learn more about how the scanning works. "
            },
            "name": "GCP_Vulnerabilities_Text_MDVM"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\r\n    | where type == \"microsoft.security/assessments/subassessments\"\r\n    | extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n    | extend severity = tostring(properties.additionalData.vulnerabilityDetails.severity), Status = tostring(properties.status.code)\r\n    | extend status = tostring(parse_json(properties).status.code)\r\n    | extend vulId=tostring((properties).id)\r\n    | extend Resource = tolower(extract(@'(?i)(.*?)/providers/Microsoft.Security/([^/]+)', 1, id))\r\n    | where assessmentKey == \"c27441ae-775c-45be-8ffa-655de37362ce\"\r\n   |extend ResourceName = tostring(properties.additionalData.artifactDetails.repositoryName)\r\n   |extend ResourceName = tostring(properties.resourceDetails.resourceName)\r\n    | where status == 'Unhealthy' \r\n    | distinct \r\n        vulId, \r\n        severity\r\n    | summarize count=count() by tostring(severity)",
              "size": 4,
              "title": "Vulnerabilities by severity",
              "noDataMessage": "No vulnerabilities found",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "visualization": "piechart",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "Category",
                  "formatter": 1,
                  "numberFormat": {
                    "unit": 0,
                    "options": {
                      "style": "decimal"
                    },
                    "emptyValCustomText": "Other"
                  }
                },
                "leftContent": {
                  "columnMatch": "count",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 2,
                      "maximumSignificantDigits": 3
                    },
                    "emptyValCustomText": "Unkown"
                  }
                },
                "showBorder": true,
                "sortCriteriaField": "count",
                "sortOrderField": 2
              },
              "graphSettings": {
                "type": 0,
                "topContent": {
                  "columnMatch": "severity",
                  "formatter": 1
                },
                "centerContent": {
                  "columnMatch": "count",
                  "formatter": 1,
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              }
            },
            "customWidth": "50",
            "name": "ECR_Vulnerability_Severity_MDVM"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\r\n    | where type == \"microsoft.security/assessments/subassessments\"\r\n    | extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n    | where assessmentKey == \"c27441ae-775c-45be-8ffa-655de37362ce\"\r\n   | extend Resource = tolower(extract(@'(?i)(.*?)/providers/Microsoft.Security/([^/]+)', 1, id))\r\n   |extend Resource= properties.resourceDetails.resourceName\r\n    | extend VulnId = tostring(parse_json(properties).id)\r\n    | extend Status = tostring(parse_json(properties).status.code)\r\n    | extend Severity=tostring(parse_json(properties).additionalData.vulnerabilityDetails.severity)\r\n    | extend fixStatus = parse_json(properties.additionalData).softwareDetails.fixStatus\r\n    | extend Distro = tostring(properties.additionalData.softwareDetails.osDetails.osVersion), imageUri = properties.resourceDetails.id, CVSS3_0 = tostring(properties.additionalData.cvssV30Score), PackageName = tostring(properties.additionalData.softwareDetails.packageName),\r\n             Evidence = tostring(properties.additionalData.softwareDetails.evidence), VulnerabilityCategory = tostring(properties.additionalData.softwareDetails.category), \r\n             PackageVersion = tostring(properties.additionalData.softwareDetails.version), Published = tostring(properties.additionalData.vulnerabilityDetails.publishedDate),\r\n\t     FixedVersion = tostring(properties.additionalData.softwareDetails.fixedVersion), Description = tostring(properties.description), Remediation = tostring(properties.remediation)\r\n    |extend Vendor = tostring(parse_json(properties).additionalData.softwareDetails.vendor)\r\n    |extend OsDistribution = tostring(parse_json(properties).additionalData.softwareDetails.osDetails.osPlatform)\r\n   |mv-expand references = todynamic(parse_json(properties).[\"additionalData\"].[\"vulnerabilityDetails\"].[\"references\"])\r\n|extend referenceLink = references.link\r\n    |extend Tags =  tostring(properties.additionalData.artifactDetails.tags)\r\n    |extend Tags = replace(\"\\\\[|\\\\]|\\\"\", \"\", Tags),\r\n    isExploitStepsPublished=iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.exploitStepsPublished==\"true\",\"Yes\",\"No\"),\r\n            isInExploitKit=iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.isInExploitKit==\"true\",\"Yes\",\"No\"),\r\n            isVerified= iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.exploitSetpsVerified==\"true\",\"Yes\",\"No\")\r\n | project \r\n        Resource, \r\n        imageUri,\r\n        VulnId, \r\n        Status,\r\n        Severity,\r\n        tostring(fixStatus),\r\n        isExploitStepsPublished,\r\n        isVerified,\r\n        isInExploitKit,\r\n        CVSS3_0,\r\n        Tags,\r\n        Vendor,\r\n        OsDistribution,\r\n        Distro,\r\n        VulnerabilityCategory,\r\n        Evidence,\r\n        PackageVersion,\r\n        FixedVersion,\r\n        Published,\r\n      Remediation,  \r\n       Description,\r\n        referenceLink\r\n    | where Status == 'Unhealthy'\r\n    | where isExploitStepsPublished == \"Yes\" or isInExploitKit == \"Yes\" or isVerified == \"Yes\"\r\n    | project-away Status ",
              "size": 1,
              "title": "Exploitable Vulnerablities",
              "noDataMessage": "No exploitable vulnerabilities found",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Resource",
                    "formatter": 13,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true,
                      "customColumnWidthSetting": "30ch"
                    }
                  },
                  {
                    "columnMatch": "Severity",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Critical",
                          "representation": "redBright",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Medium",
                          "representation": "yellow",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Low",
                          "representation": "blue",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "High",
                          "representation": "orange",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "fixStatus",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "FixAvailable",
                          "representation": "success",
                          "text": "Fix Available"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Unknown",
                          "representation": "unknown",
                          "text": "Unknown"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "unknown",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "isExploitStepsPublished",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "2",
                          "text": "Yes"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "success",
                          "text": "No"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "success",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "isVerified",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "Yes"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "4",
                          "text": "No"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "success",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "isInExploitKit",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "warning",
                          "text": "Yes"
                        },
                        {
                          "operator": "==",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "Available",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "unknown",
                          "text": "{0}{1}"
                        }
                      ]
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "CVSS3_0",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "max": 10,
                      "palette": "greenRed",
                      "customColumnWidthSetting": "15ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "minimumFractionDigits": 1
                      }
                    }
                  },
                  {
                    "columnMatch": "Distro",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "Published",
                    "formatter": 6
                  },
                  {
                    "columnMatch": "Remediation",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "Description",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "remediation",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "description",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "itemSelected",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "subscriptionId",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "PublishedDate",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "25ch"
                    }
                  },
                  {
                    "columnMatch": "cvss30score",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "palette": "greenRed",
                      "customColumnWidthSetting": "15ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "minimumFractionDigits": 1
                      }
                    }
                  },
                  {
                    "columnMatch": "cvss30Vector",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "referenceLinks",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "referenceTitle",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "link",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "category",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Issue",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "cvss20score",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "palette": "greenRed",
                      "customColumnWidthSetting": "15ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "maximumFractionDigits": 1
                      },
                      "emptyValCustomText": "N/A"
                    }
                  },
                  {
                    "columnMatch": "cvss20Vector",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "impact",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "PublishedTime",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "25ch"
                    }
                  },
                  {
                    "columnMatch": "Patchable",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "disabled",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "more",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "cveTitle",
                    "formatter": 1,
                    "formatOptions": {
                      "linkColumn": "cveURL",
                      "linkTarget": "Url"
                    }
                  },
                  {
                    "columnMatch": "cveURL",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "vendorReferencesTitle",
                    "formatter": 1,
                    "formatOptions": {
                      "linkColumn": "vendorReferencesURL",
                      "linkTarget": "Url"
                    }
                  },
                  {
                    "columnMatch": "vendorReferencesURL",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "timeGenerated",
                    "formatter": 6
                  }
                ],
                "rowLimit": 1000,
                "filter": true,
                "labelSettings": [
                  {
                    "columnId": "Resource",
                    "label": "Resource"
                  },
                  {
                    "columnId": "imageUri",
                    "label": "Image URI"
                  },
                  {
                    "columnId": "VulnId",
                    "label": "Vulnerability ID"
                  },
                  {
                    "columnId": "Severity",
                    "label": "Severity"
                  },
                  {
                    "columnId": "fixStatus",
                    "label": "Fix Status"
                  },
                  {
                    "columnId": "isExploitStepsPublished",
                    "label": "Exploit Steps Published"
                  },
                  {
                    "columnId": "isVerified",
                    "label": "Exploit Steps Verifiable",
                    "comment": ""
                  },
                  {
                    "columnId": "isInExploitKit",
                    "label": "In Exploit Kit"
                  },
                  {
                    "columnId": "CVSS3_0",
                    "label": "CVSS Score"
                  },
                  {
                    "columnId": "Tags",
                    "label": "Tags",
                    "comment": ""
                  },
                  {
                    "columnId": "Vendor",
                    "label": "Vendor"
                  },
                  {
                    "columnId": "OsDistribution",
                    "label": "OS Distribution"
                  },
                  {
                    "columnId": "Distro",
                    "label": "Distro"
                  },
                  {
                    "columnId": "VulnerabilityCategory",
                    "label": "Vulnerability Category"
                  },
                  {
                    "columnId": "Evidence",
                    "label": "Evidence (OS Packages only)",
                    "comment": "Evidence is only available for OS packages"
                  },
                  {
                    "columnId": "PackageVersion",
                    "label": "Package Version"
                  },
                  {
                    "columnId": "FixedVersion",
                    "label": "Fixed Version"
                  },
                  {
                    "columnId": "Published",
                    "label": "Published Date"
                  },
                  {
                    "columnId": "Remediation",
                    "label": "Remediation"
                  },
                  {
                    "columnId": "Description",
                    "label": "Description"
                  },
                  {
                    "columnId": "referenceLink",
                    "label": "Reference Link"
                  }
                ]
              },
              "sortBy": []
            },
            "customWidth": "100",
            "name": "ECRExploitable_MDVM"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\r\n    | where type == \"microsoft.security/assessments/subassessments\"\r\n    | extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n    | where assessmentKey == \"c27441ae-775c-45be-8ffa-655de37362ce\"\r\n    | project \r\n        //subassessmentLink = tolower(extract(@'(?i)(.*?)/providers/Microsoft.Security/([^/]+)', 1, id)), \r\n        connectorId = extract(\"(.*)/securityentitydata\", 1, id),\r\n        Resource = tostring(properties.resourceDetails.resourceName),\r\n        Region = tostring(properties.resourceDetails.region),\r\n        Repo = tostring(properties.additionalData.artifactDetails.repositoryName), \r\n        ProjectId = properties.resourceDetails.hierarchyId,\r\n        ResourceType = tolower(split(id,\"/\").[6]), \r\n        subscriptionId, severity = tostring(parse_json(properties).additionalData.vulnerabilityDetails.severity), \r\n        status = tostring(parse_json(properties).status.code), \r\n        VulnId = tostring(parse_json(properties).id), \r\n        description = tostring(parse_json(properties).displayName), \r\n        fixStatus = tostring(parse_json(properties).additionalData.softwareDetails.fixStatus), \r\n        cve = parse_json(properties.additionalData).cve\r\n    | where status == 'Unhealthy'\r\n    |where connectorId in~({awsconnectors})\r\n    | summarize \r\n        dcount(VulnId) by tostring(ProjectId), \r\n        Resource, \r\n        Repo,\r\n        Region,\r\n        severity, \r\n        VulnId, \r\n        description, \r\n        tostring(fixStatus), \r\n        tostring(cve)\r\n    | summarize \r\n        Total = count(dcount_VulnId), \r\n        sevC=countif(severity=='Critical'),\r\n        sevH=countif(severity=='High'), \r\n        sevM=countif(severity=='Medium'), \r\n        sevL=countif(severity=='Low'), \r\n        fixAvailable = countif(fixStatus=='FixAvailable'), \r\n        CVEcount =countif(cve!='[]') by tostring(ProjectId),\r\n       Resource, Repo, Region,\r\n       ecrSelected = \"true\"\r\n    | order by sevH desc",
              "size": 1,
              "title": "Vulnerable container registries |  Select a container registry to view the list of vulnerable containers and the security recommendation for the registry ",
              "noDataMessage": "No unhealthy registries found",
              "exportedParameters": [
                {
                  "fieldName": "ecrSelected",
                  "parameterName": "ecrSelected",
                  "parameterType": 1,
                  "defaultValue": "false"
                },
                {
                  "fieldName": "Resource",
                  "parameterName": "selectedECR",
                  "parameterType": 5
                }
              ],
              "showExportToExcel": true,
              "exportToExcelOptions": "all",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "ProjectId",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Repo",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "ecrSelected",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Total",
                    "formatter": 1,
                    "formatOptions": {
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "sevC",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Sev0",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "sevH",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Sev1",
                          "text": "{0}{1}"
                        }
                      ],
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": []
                      }
                    }
                  },
                  {
                    "columnMatch": "sevM",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Sev2",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "sevL",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Sev3",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "fixAvailable",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "uninitialized",
                          "text": "{0}{1}"
                        }
                      ]
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "CVEcount",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "4",
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "Resource group",
                    "formatter": 13,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "ResourceGroup",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "acrSelected",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "patchAvailable",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "pending",
                          "text": "{0}{1}"
                        }
                      ],
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": []
                      }
                    }
                  }
                ],
                "rowLimit": 1000,
                "filter": true,
                "hierarchySettings": {
                  "treeType": 1,
                  "groupBy": [
                    "ProjectId"
                  ]
                },
                "sortBy": [
                  {
                    "itemKey": "Resource",
                    "sortOrder": 1
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "ProjectId",
                    "label": "Account ID"
                  },
                  {
                    "columnId": "Resource",
                    "label": "Resource"
                  },
                  {
                    "columnId": "ecrSelected",
                    "label": "Total"
                  },
                  {
                    "columnId": "Total",
                    "label": "Total"
                  },
                  {
                    "columnId": "sevC",
                    "label": "Critical"
                  },
                  {
                    "columnId": "sevH",
                    "label": "High"
                  },
                  {
                    "columnId": "sevM",
                    "label": "Medium"
                  },
                  {
                    "columnId": "sevL",
                    "label": "Low"
                  },
                  {
                    "columnId": "fixAvailable",
                    "label": "Fix Available"
                  },
                  {
                    "columnId": "CVEcount",
                    "label": "CVEs"
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "Resource",
                  "sortOrder": 1
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "tab",
              "comparison": "isEqualTo",
              "value": "0"
            },
            "name": "ECR_Vulnerabilities_List - MDVM"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources \r\nâ€¯â€¯â€¯â€¯|â€¯whereâ€¯typeâ€¯==â€¯\"microsoft.security/assessments\" \r\nâ€¯â€¯â€¯â€¯|â€¯extendâ€¯healthStateâ€¯=â€¯properties.status.code \r\n    | extend url = strcat(\"https://\", properties.links.azurePortal)\r\n    | extend resource = tostring(properties.resourceDetails.Id)\r\n    | extend recommendation = tostring(properties.metadata.displayName)\r\n    | extend ResourceType = tolower(split(id,\"/\").[6])\r\n    | where resource == ('{selectedACR}') \r\n    | where healthState in ('Unhealthy') and ResourceType == \"microsoft.containerregistry\"\r\n    | project \r\n        resource, \r\n        recommendation, \r\n        url\r\n    | order by recommendation asc",
              "size": 1,
              "title": "Azure Container Registry Security Recommendations",
              "noDataMessage": "No security recommendations found",
              "showExportToExcel": true,
              "exportToExcelOptions": "all",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "resource",
                    "formatter": 13,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "recommendation",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "150ch"
                    }
                  },
                  {
                    "columnMatch": "url",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "Url",
                      "linkLabel": "URL"
                    }
                  },
                  {
                    "columnMatch": "healthState",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "properties_metadata_displayName",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "properties_resourceDetails_Id",
                    "formatter": 13,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "value",
                    "formatter": 1
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "resource",
                    "label": "Resource"
                  },
                  {
                    "columnId": "recommendation",
                    "label": "Security Recommendation"
                  },
                  {
                    "columnId": "url",
                    "label": "URL"
                  }
                ]
              }
            },
            "conditionalVisibilities": [
              {
                "parameterName": "acrSelected",
                "comparison": "isEqualTo",
                "value": "true"
              },
              {
                "parameterName": "acrrecommendation",
                "comparison": "isEqualTo",
                "value": "Yes"
              }
            ],
            "name": "ACR_Recommendations"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\r\n    | where type == \"microsoft.security/assessments/subassessments\"\r\n    | extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n    | where assessmentKey == \"c27441ae-775c-45be-8ffa-655de37362ce\"\r\n    | project \r\n       // Resource = tolower(extract(@'(?i)(.*?)/providers/Microsoft.Security/([^/]+)', 1, id)), \r\n       connectorId = extract(\"(.*)/securityentitydata\", 1, id),\r\n       ProjectId = tostring(properties.resourceDetails.hierarchyId),\r\n        Resource = tostring(properties.resourceDetails.resourceName),\r\n        ResourceType = tolower(split(id,\"/\").[6]), \r\n        subscriptionId, \r\n        severity = tostring(parse_json(properties).additionalData.vulnerabilityDetails.severity), \r\n        status = tostring(parse_json(properties).status.code), \r\n        VulnId = tostring(parse_json(properties).id), \r\n        description = tostring(parse_json(properties).displayName), \r\n        fixStatus = parse_json(properties.additionalData).softwareDetails.fixStatus, \r\n        cve = parse_json(properties.additionalData).cve, \r\n        Repo = tostring(parse_json(properties).additionalData.artifactDetails.repositoryName), \r\n        imageUri = tostring(parse_json(properties.resourceDetails).id)\r\n    | where status == 'Unhealthy' \r\n    |where connectorId in~({awsconnectors})\r\n    | summarize \r\n        dcount(VulnId) by Resource, \r\n        severity, \r\n        VulnId, \r\n        description, \r\n        tostring(fixStatus), \r\n        tostring(cve), \r\n        Repo, \r\n        ProjectId,\r\n        imageUri\r\n    | summarize \r\n        Total = count(dcount_VulnId), \r\n        sevC=countif(severity=='Critical'),\r\n        sevH=countif(severity=='High'), \r\n        sevM=countif(severity=='Medium'), \r\n        sevL=countif(severity=='Low'), \r\n        fixAvailable = countif(fixStatus=='FixAvailable'), \r\n        CVEcount =countif(cve!='[]') by Resource, \r\n        ProjectId,\r\n        Repo, \r\n        imageUri, \r\n        repoSelected=\"true\"\r\n    | order by sevH desc",
              "size": 3,
              "title": "Vulnerable images | Select an Image to see the vulnerabilities",
              "noDataMessage": "No vulnerable images found",
              "exportedParameters": [
                {
                  "fieldName": "Repo",
                  "parameterName": "SelectedRepo",
                  "defaultValue": "All"
                },
                {
                  "fieldName": "repoSelected",
                  "parameterName": "ecrRepoSelected",
                  "parameterType": 1,
                  "defaultValue": "false"
                }
              ],
              "showExportToExcel": true,
              "exportToExcelOptions": "all",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Resource",
                    "formatter": 13,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "ProjectId",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Repo",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "repoSelected",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Total",
                    "formatter": 1,
                    "formatOptions": {
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "sevC",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "redBright",
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "sevH",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "orange",
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "sevM",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "yellow",
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "sevL",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "blueDark",
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "fixAvailable",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "uninitialized",
                          "text": "{0}{1}"
                        }
                      ]
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "CVEcount",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "4",
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "imageDigest",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "80ch"
                    }
                  },
                  {
                    "columnMatch": "patchAvailable",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "pending",
                          "text": "{0}{1}"
                        }
                      ],
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": []
                      },
                      "customColumnWidthSetting": "15ch"
                    }
                  }
                ],
                "rowLimit": 1000,
                "filter": true,
                "hierarchySettings": {
                  "treeType": 1,
                  "groupBy": [
                    "ProjectId"
                  ]
                },
                "labelSettings": [
                  {
                    "columnId": "Resource",
                    "label": "Resource"
                  },
                  {
                    "columnId": "ProjectId",
                    "label": "Account ID"
                  },
                  {
                    "columnId": "Repo",
                    "label": "Repository"
                  },
                  {
                    "columnId": "imageUri",
                    "label": "Image URI"
                  },
                  {
                    "columnId": "repoSelected",
                    "label": "repoSelected"
                  },
                  {
                    "columnId": "Total",
                    "label": "Total"
                  },
                  {
                    "columnId": "sevC",
                    "label": "Critical"
                  },
                  {
                    "columnId": "sevH",
                    "label": "High"
                  },
                  {
                    "columnId": "sevM",
                    "label": "Medium"
                  },
                  {
                    "columnId": "sevL",
                    "label": "Low"
                  },
                  {
                    "columnId": "fixAvailable",
                    "label": "Fix Available"
                  },
                  {
                    "columnId": "CVEcount",
                    "label": "CVEs"
                  }
                ]
              },
              "sortBy": []
            },
            "name": "ECR_Image_Vilnerabilty_ListbyRegistry_MDVM"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\r\n    | where type == \"microsoft.security/assessments/subassessments\"\r\n    | extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n    | where assessmentKey == \"c27441ae-775c-45be-8ffa-655de37362ce\"\r\n    | extend itemSelected=\"true\"\r\n    | extend cvss30score=properties.[\"additionalData\"].[\"vulnerabilityDetails\"].[\"cvss\"].[\"3.0\"].[\"base\"]\r\n    | extend cvss30Vector=properties.[\"additionalData\"].[\"vulnerabilityDetails\"].[\"cvss\"].[\"3.0\"].[\"cvssVectorString\"]\r\n    | extend description=properties.[\"description\"]\r\n    | extend remediation=properties.[\"remediation\"]\r\n  // | extend Resource = tolower(extract(@'(?i)(.*?)/providers/Microsoft.Security/([^/]+)', 1, id))\r\n   | extend Resource = tostring(properties.resourceDetails.resourceName)\r\n    | extend RepositoryName=tostring(parse_json(properties).additionalData.artifactDetails.repositoryName)\r\n    | extend VulnId = tostring(parse_json(properties).id)\r\n    | extend PublishedDate=format_datetime(todatetime(properties.[\"additionalData\"].[\"vulnerabilityDetails\"].[\"publishedDate\"]), 'MM/d/yyyy h:m:s tt')\r\n    | extend TimeGenerated=format_datetime(todatetime(properties.timeGenerated), 'MM/d/yyyy h:m:s tt')\r\n    | extend Status = tostring(parse_json(properties).status.code)\r\n    | extend Severity=tostring(parse_json(properties).additionalData.vulnerabilityDetails.severity)\r\n    | extend fixStatus = parse_json(properties.additionalData).softwareDetails.fixStatus\r\n    | extend imageUri = properties.resourceDetails.id,\r\n    isExploitStepsPublished=iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.exploitStepsPublished==\"true\",\"Yes\",\"No\"),\r\n            isInExploitKit=iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.isInExploitKit==\"true\",\"Yes\",\"No\"),\r\n            isVerified= iff(parse_json(properties).additionalData.vulnerabilityDetails.exploitabilityAssessment.exploitSetpsVerified==\"true\",\"Yes\",\"No\")\r\n   |mv-expand references = todynamic(parse_json(properties).[\"additionalData\"].[\"vulnerabilityDetails\"].[\"references\"])\r\n   | extend referenceLink = references.link\r\n    |extend vendor = tostring(parse_json(properties).additionalData.softwareDetails.vendor)\r\n    |extend osDistribution = tostring(parse_json(properties).additionalData.softwareDetails.osDetails.osPlatform),  Distro = tostring(properties.additionalData.softwareDetails.osDetails.osVersion)\r\n    |extend tags =  tostring(properties.additionalData.artifactDetails.tags)\r\n    |extend tags = replace(\"\\\\[|\\\\]|\\\"\", \"\", tags) \r\n    | summarize referenceLinks = make_list(strcat(referenceLink, \"\\n\")) by \r\n    itemSelected,\r\n    subscriptionId,\r\n    Resource, \r\n    RepositoryName, \r\n    VulnId, \r\n    PublishedDate,\r\n    TimeGenerated,\r\n    Status,\r\n    Severity,\r\n    tostring(fixStatus),\r\n    tostring(imageUri),\r\n    tags,\r\n    tostring(cvss30score),\r\n    tostring(cvss30Vector),\r\n    tostring(description),\r\n    tostring(remediation),\r\n    vendor,\r\n    osDistribution,\r\n    Distro,\r\n    isExploitStepsPublished,\r\n    isVerified,\r\n    isInExploitKit\r\n    | where Status == 'Unhealthy'\r\n     | where RepositoryName == '{SelectedRepo}'\r\n    | project-away Status ",
              "size": 1,
              "title": "Vulnerabilities | Select Vulnerability to see more details",
              "noDataMessage": "No vulnerability found",
              "exportedParameters": [
                {
                  "fieldName": "RepositoryName",
                  "parameterName": "ecrRepositoryName",
                  "defaultValue": "All"
                },
                {
                  "fieldName": "description",
                  "parameterName": "ecrDescription",
                  "parameterType": 1
                },
                {
                  "fieldName": "remediation",
                  "parameterName": "ecrRemediation",
                  "parameterType": 1
                },
                {
                  "fieldName": "Issue",
                  "parameterName": "ecrIssue",
                  "parameterType": 1
                },
                {
                  "fieldName": "VulnId",
                  "parameterName": "ecrVulnId",
                  "parameterType": 1
                },
                {
                  "fieldName": "Severity",
                  "parameterName": "ecrSeverity",
                  "parameterType": 1
                },
                {
                  "fieldName": "PublishedDate",
                  "parameterName": "ecrPublishedDate",
                  "parameterType": 1
                },
                {
                  "fieldName": "fixStatus",
                  "parameterName": "ecrFixStatus",
                  "parameterType": 1
                },
                {
                  "fieldName": "itemSelected",
                  "parameterName": "ecrItemSelected",
                  "parameterType": 1,
                  "defaultValue": "false"
                },
                {
                  "fieldName": "cvss30Vector",
                  "parameterName": "ecrCvss30Vector",
                  "parameterType": 1
                },
                {
                  "parameterType": 1
                },
                {
                  "fieldName": "isInExploitKit",
                  "parameterName": "ecrExploitKit",
                  "parameterType": 1
                },
                {
                  "fieldName": "isVerified",
                  "parameterName": "ecrVerified",
                  "parameterType": 1
                },
                {
                  "fieldName": "isExploitStepsPublished",
                  "parameterName": "ecrVulnPublished",
                  "parameterType": 1
                },
                {
                  "fieldName": "referenceLinks",
                  "parameterName": "ecrReferences",
                  "parameterType": 1
                }
              ],
              "showExportToExcel": true,
              "exportToExcelOptions": "all",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscription}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "itemSelected",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "subscriptionId",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Resource",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "30ch"
                    }
                  },
                  {
                    "columnMatch": "PublishedDate",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "25ch"
                    }
                  },
                  {
                    "columnMatch": "Severity",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Critical",
                          "representation": "redBright",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Medium",
                          "representation": "yellow",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Low",
                          "representation": "blue",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "High",
                          "representation": "orange",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "fixStatus",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "FixAvailable",
                          "representation": "success",
                          "text": "Fix Available"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Unknown",
                          "representation": "unknown",
                          "text": "Unknown"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "unknown",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "cvss30score",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "palette": "greenRed",
                      "customColumnWidthSetting": "15ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "minimumFractionDigits": 1
                      }
                    }
                  },
                  {
                    "columnMatch": "cvss30Vector",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "description",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "remediation",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "isExploitStepsPublished",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "2",
                          "text": "Yes"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "success",
                          "text": "No"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "success",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "isVerified",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "Yes"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "4",
                          "text": "No"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "success",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "isInExploitKit",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "warning",
                          "text": "Yes"
                        },
                        {
                          "operator": "==",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "Available",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "unknown",
                          "text": "{0}{1}"
                        }
                      ]
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "referenceLinks",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "referenceTitle",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "link",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "category",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Issue",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "cvss20score",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "palette": "greenRed",
                      "customColumnWidthSetting": "15ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "maximumFractionDigits": 1
                      },
                      "emptyValCustomText": "N/A"
                    }
                  },
                  {
                    "columnMatch": "cvss20Vector",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "impact",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "PublishedTime",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "25ch"
                    }
                  },
                  {
                    "columnMatch": "Patchable",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "No",
                          "representation": "disabled",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "more",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "cveTitle",
                    "formatter": 1,
                    "formatOptions": {
                      "linkColumn": "cveURL",
                      "linkTarget": "Url"
                    }
                  },
                  {
                    "columnMatch": "cveURL",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "vendorReferencesTitle",
                    "formatter": 1,
                    "formatOptions": {
                      "linkColumn": "vendorReferencesURL",
                      "linkTarget": "Url"
                    }
                  },
                  {
                    "columnMatch": "vendorReferencesURL",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "timeGenerated",
                    "formatter": 6
                  }
                ],
                "rowLimit": 1000,
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "$gen_thresholds_fixStatus_8",
                    "sortOrder": 1
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "subscriptionId",
                    "label": "Subscription name"
                  },
                  {
                    "columnId": "RepositoryName",
                    "label": "Repository name"
                  },
                  {
                    "columnId": "VulnId",
                    "label": "Vulnerability ID"
                  },
                  {
                    "columnId": "TimeGenerated",
                    "label": "Time generated"
                  },
                  {
                    "columnId": "fixStatus",
                    "label": "Fix Status"
                  },
                  {
                    "columnId": "imageUri",
                    "label": "Image URI"
                  },
                  {
                    "columnId": "tags",
                    "label": "Tags"
                  },
                  {
                    "columnId": "cvss30score",
                    "label": "CVSS Score"
                  },
                  {
                    "columnId": "cvss30Vector",
                    "label": "Threat vector"
                  },
                  {
                    "columnId": "vendor",
                    "label": "Vendor"
                  },
                  {
                    "columnId": "osDistribution",
                    "label": "OS Distribution"
                  },
                  {
                    "columnId": "isExploitStepsPublished",
                    "label": "Exploit Steps Published"
                  },
                  {
                    "columnId": "isVerified",
                    "label": "Exploit Steps Verified"
                  },
                  {
                    "columnId": "isInExploitKit",
                    "label": "In Exploit Kit"
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "$gen_thresholds_fixStatus_8",
                  "sortOrder": 1
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "ecrRepoSelected",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "ECR_Image_Vulnerabilities_Full_ListbyRepo_MDVM"
          },
          {
            "type": 1,
            "content": {
              "json": "### Description for {ecrRepositoryName} vulnerability\r\n{ecrDescription} <br>\r\n <br> <br>\r\nCVSS 3.0 Threat Vectors\" {ecrCvss30Vector}\r\n\r\n### Remediation\r\n{ecrRemediation}\r\n### General Information\r\n<table style=\"width:100%\">\r\n  <tr>\r\n    <th>ID</th>\r\n    <th>Severity</th>\r\n\t<th>Fix Status</th>\r\n\t<th>Published</th>\r\n  </tr>\r\n    <tr>\r\n    <td>{ecrVulnId}</td>\r\n    <td>{ecrSeverity}</td>\r\n\t<td>{ecrFixStatus}</td>\r\n\t<td>{ecrPublishedDate}</td>\r\n  </tr>\r\n  </table>\r\n\r\n  ### Exploitability Information\r\n<table style=\"width:100%\">\r\n  <tr>\r\n\t<th>Exploit Steps Published</th>\r\n\t<th>Exploit Steps Verified</th>\r\n\t<th>In Exploit Kit</th>\r\n  </tr>\r\n    <tr>\r\n    <td>{ecrVulnPublished}</td>\r\n\t<td>{ecrVerified}</td>\r\n\t <td>{ecrExploitKit}</td>\r\n  </tr>\r\n  </table>\r\n\r\n  ### Reference Information\r\n{ecrReferences} <br>\r\n <br> <br>\r\n\r\n\r\n",
              "style": "info"
            },
            "conditionalVisibility": {
              "parameterName": "ecrItemSelected",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "ECR_Vulnerability_card_MDVM"
          }
        ]
      },
      "conditionalVisibilities": [
        {
          "parameterName": "tab",
          "comparison": "isEqualTo",
          "value": "registrymdvm"
        },
        {
          "parameterName": "registryscanning",
          "comparison": "isEqualTo",
          "value": "ecr"
        }
      ],
      "name": "ecr-mdvm-group - - Copy"
    }
  ],
  "fallbackResourceIds": [
    "Azure Security Center"
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}
