{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "##  DevOps Security\r\n\r\n"
      },
      "customWidth": "50",
      "name": "text - 1"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "c88e6e5a-d64e-4065-98a0-63772188ff5e",
            "version": "KqlParameterItem/1.0",
            "name": "Help",
            "label": "Show Help",
            "type": 10,
            "description": "Show insturctions for using this workbook",
            "isRequired": true,
            "typeSettings": {
              "additionalResourceOptions": []
            },
            "jsonData": "[\r\n { \"value\": \"Yes\", \"label\": \"Yes\"},\r\n {\"value\": \"No\", \"label\": \"No\", \"selected\":true }\r\n]",
            "timeContext": {
              "durationMs": 86400000
            }
          }
        ],
        "style": "above",
        "queryType": 12
      },
      "name": "HelpParameter"
    },
    {
      "type": 1,
      "content": {
        "json": "#### Navigate\r\nClick on one of the tabs below to explore each area:\r\n* Overview - Summary view of code, secrets, OSS vulnerabilities, and posture scan results\r\n* Secrets - View of exposed secrets in repositories\r\n* Code - View of code scanning results in repositories\r\n* OSS Vulnerabilities - View of OSS vulnerabilities in repositories\r\n* Infrastructure as Code - View of IaC misconfigurations in repositories\r\n* Posture - Consolidated view of security posture across connected DevOps environments\r\n* Threats & Tactics - Summarized view of attack exposure across connected DevOps environments",
        "style": "info"
      },
      "conditionalVisibility": {
        "parameterName": "Help",
        "comparison": "isEqualTo",
        "value": "Yes"
      },
      "name": "NavInstructions"
    },
    {
      "type": 1,
      "content": {
        "json": "#### Welcome to DevOps assessment findings workbook\r\nThis workbook is based on the following recommendations provided by Defender for Cloud:\r\n* [Azure DevOps repositories should have code scanning findings resolved](http://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/99232bb2-9b21-4bbb-8e3c-763673b9923d)\r\n* [Azure DevOps repositories should have secret scanning findings resolved](http://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/b5ef903f-8655-473b-9784-4f749eeb25c6)\r\n* [Azure DevOps repositories should have dependency vulnerability scanning findings resolved](http://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/2ea72208-8558-4011-8dcd-d93375a4003d)\r\n* [Azure DevOps repositories should have infrastructure as code scanning findings resolved](http://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/6588c4d4-fbbb-4fb8-be45-7c2de7dc1b3b)\r\n* [GitHub repositories should have code scanning findings resolved](http://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/18aa4e75-776a-4296-97f0-fe1cf10d679c)\r\n* [GitHub repositories should have secret scanning findings resolved](http://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/dd98425c-1407-40cc-8a2c-da5d0a2f80da)\r\n* [GitHub repositories should have dependency vulnerability scanning findings resolved](http://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/945f7b1c-8def-4ab3-a44d-1416060104b3)\r\n* [GitHub repositories should have infrastructure as code scanning findings resolved](http://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/d9be0ff8-3eb0-4348-82f6-c1e735f85983)\r\n* [GitHub repositories should have code scanning enabled](http://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/5a2b692f-9ccc-4519-b6bd-47125dd51884)\r\n* [GitHub repositories should have secret scanning enabled](http://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/b6ad173c-0cc6-4d44-b954-8217c8837a8e)\r\n* [GitHub repositories should have Dependabot scanning enabled](http://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/c64e7cfb-6d64-4227-8c23-b4fa5c72957b)",
        "style": "info"
      },
      "conditionalVisibility": {
        "parameterName": "Help",
        "comparison": "isEqualTo",
        "value": "Yes"
      },
      "name": "text - 12"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "links": [
          {
            "id": "28d59a80-f8b1-4a7f-a53e-0342585e1468",
            "cellValue": "SelectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Overview",
            "subTarget": "OverviewTab",
            "style": "link"
          },
          {
            "id": "e9b65feb-9f81-4b66-80df-c9d409a4a404",
            "cellValue": "SelectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Secrets",
            "subTarget": "SecretsTab",
            "style": "link"
          },
          {
            "id": "8bd0e53b-a116-4be3-8fc8-dda761cdf784",
            "cellValue": "SelectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Code",
            "subTarget": "CodeTab",
            "style": "link"
          },
          {
            "id": "456aa2a6-cfb0-4ebd-b615-a7fc9088081d",
            "cellValue": "SelectedTab",
            "linkTarget": "parameter",
            "linkLabel": "OSS Vulnerabilities",
            "subTarget": "OSSTab",
            "style": "link"
          },
          {
            "id": "74d23e32-f683-468d-a517-1e542f466a55",
            "cellValue": "SelectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Infrastructure as Code",
            "subTarget": "IaCTab",
            "style": "link"
          },
          {
            "id": "b6712143-8444-41a3-8669-064143c52e62",
            "cellValue": "SelectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Posture",
            "subTarget": "PostureTab",
            "style": "link"
          },
          {
            "id": "7059f3ed-1f5b-412f-aeef-5c06da8acdf9",
            "cellValue": "SelectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Threats & Tactics",
            "subTarget": "ThreatsTab",
            "style": "link"
          }
        ]
      },
      "name": "Tabs"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "securityresources\r\n| where type == \"microsoft.security/assessments/subassessments\"\r\n| extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n| where assessmentKey == \"b5ef903f-8655-473b-9784-4f749eeb25c6\" or assessmentKey == \"dd98425c-1407-40cc-8a2c-da5d0a2f80da\"\r\n| extend VulId = tostring(properties.id), Severity = tostring(properties.status.severity), Status = tostring(properties.status.code)\r\n| where Status == 'Unhealthy'\r\n| summarize Count = dcount(VulId) by Severity",
        "size": 4,
        "title": "Exposed secrets",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "value::all"
        ],
        "visualization": "tiles",
        "tileSettings": {
          "titleContent": {
            "columnMatch": "Severity",
            "formatter": 4,
            "formatOptions": {
              "palette": "redBright"
            },
            "numberFormat": {
              "unit": 0,
              "options": {
                "style": "decimal"
              }
            }
          },
          "leftContent": {
            "columnMatch": "Count",
            "formatter": 12,
            "formatOptions": {
              "palette": "redGreen"
            },
            "numberFormat": {
              "unit": 17,
              "options": {
                "style": "decimal",
                "maximumFractionDigits": 2,
                "maximumSignificantDigits": 3
              }
            }
          },
          "showBorder": true,
          "sortCriteriaField": "Severity"
        },
        "chartSettings": {
          "seriesLabelSettings": [
            {
              "seriesName": "High",
              "color": "redBright"
            },
            {
              "seriesName": "Medium",
              "color": "yellow"
            },
            {
              "seriesName": "Unknown",
              "color": "blueDark"
            }
          ]
        }
      },
      "conditionalVisibility": {
        "parameterName": "SelectedTab",
        "comparison": "isEqualTo",
        "value": "OverviewTab"
      },
      "customWidth": "20",
      "name": "SecretsExposed"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "securityresources\r\n| where type == \"microsoft.security/assessments/subassessments\"\r\n| extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n| where assessmentKey == \"99232bb2-9b21-4bbb-8e3c-763673b9923d\" or assessmentKey == \"18aa4e75-776a-4296-97f0-fe1cf10d679c\"\r\n| extend VulId = tostring(properties.id), Severity = tostring(properties.status.severity), Status = tostring(properties.status.code)\r\n| where Status == 'Unhealthy'\r\n| summarize Count = dcount(VulId) by Severity",
        "size": 1,
        "title": "Code security",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "value::all"
        ],
        "visualization": "piechart",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Resource",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "22ch"
              }
            },
            {
              "columnMatch": "sevH",
              "formatter": 4,
              "formatOptions": {
                "min": 0,
                "palette": "redBright",
                "compositeBarSettings": {
                  "labelText": "",
                  "columnSettings": []
                },
                "customColumnWidthSetting": "15ch"
              }
            },
            {
              "columnMatch": "sevM",
              "formatter": 4,
              "formatOptions": {
                "min": 0,
                "palette": "yellow",
                "customColumnWidthSetting": "15ch"
              }
            },
            {
              "columnMatch": "sevL",
              "formatter": 4,
              "formatOptions": {
                "min": 0,
                "palette": "blueDark",
                "customColumnWidthSetting": "15ch"
              }
            }
          ]
        },
        "chartSettings": {
          "seriesLabelSettings": [
            {
              "seriesName": "Medium",
              "color": "yellow"
            },
            {
              "seriesName": "High",
              "color": "redBright"
            },
            {
              "seriesName": "Low",
              "color": "blueDark"
            }
          ]
        }
      },
      "conditionalVisibility": {
        "parameterName": "SelectedTab",
        "comparison": "isEqualTo",
        "value": "OverviewTab"
      },
      "customWidth": "40",
      "name": "CodeScanningBySeverity"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "securityresources\r\n| where type == \"microsoft.security/assessments\"\r\n| where name == \"b6ad173c-0cc6-4d44-b954-8217c8837a8e\" \r\n                or name == \"5a2b692f-9ccc-4519-b6bd-47125dd51884\" \r\n                or name == \"c64e7cfb-6d64-4227-8c23-b4fa5c72957b\" \r\n                or name == \"b5ef903f-8655-473b-9784-4f749eeb25c6\" \r\n                or name == \"99232bb2-9b21-4bbb-8e3c-763673b9923d\" \r\n                or name == \"6588c4d4-fbbb-4fb8-be45-7c2de7dc1b3b\"\r\n                or name == \"2ea72208-8558-4011-8dcd-d93375a4003d\"\r\n                or name == \"dd98425c-1407-40cc-8a2c-da5d0a2f80da\" \r\n                or name == \"18aa4e75-776a-4296-97f0-fe1cf10d679c\" \r\n                or name == \"d9be0ff8-3eb0-4348-82f6-c1e735f85983\"\r\n                or name == \"945f7b1c-8def-4ab3-a44d-1416060104b3\"\r\n| extend Status = tostring(properties.status.code)\r\n| where Status == 'Unhealthy'\r\n| project assessmentKey=name, parse_json(properties)\r\n| where properties.metadata.severity in ('Low','Medium','High')\r\n| extend SeverityRank = case(\r\n    properties.metadata.severity == 'High', 3,\r\n    properties.metadata.severity == 'Medium', 2,\r\n    properties.metadata.severity == 'Low', 1,\r\n    0)\r\n| project-away SeverityRank\r\n| extend Severity = properties.metadata.severity\r\n| project Severity = tostring(Severity)\r\n| summarize Count = count() by Severity",
        "size": 1,
        "title": "DevOps security",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "value::all"
        ],
        "visualization": "piechart",
        "chartSettings": {
          "seriesLabelSettings": [
            {
              "seriesName": "Medium",
              "color": "yellow"
            },
            {
              "seriesName": "High",
              "color": "redBright"
            },
            {
              "seriesName": "Low",
              "color": "blueDark"
            }
          ]
        }
      },
      "conditionalVisibility": {
        "parameterName": "SelectedTab",
        "comparison": "isEqualTo",
        "value": "OverviewTab"
      },
      "customWidth": "40",
      "name": "DevOpsAssessmentsBySeverity"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "securityresources\r\n| where type == \"microsoft.security/assessments/subassessments\"\r\n| extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n| where assessmentKey == \"b5ef903f-8655-473b-9784-4f749eeb25c6\" or assessmentKey == \"dd98425c-1407-40cc-8a2c-da5d0a2f80da\"\r\n| extend Repository = split(id, '/')[12]\r\n| extend VulId = tostring(properties.id), Severity = tostring(properties.status.severity), Status = tostring(properties.status.code)\r\n| where Status == 'Unhealthy'\r\n| project Repository",
        "size": 1,
        "title": "Exposed secrets by repo",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "value::all"
        ],
        "visualization": "table",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Repository",
              "formatter": 1
            }
          ]
        },
        "tileSettings": {
          "titleContent": {
            "columnMatch": "RepoName",
            "formatter": 3,
            "formatOptions": {
              "palette": "coldHot"
            }
          },
          "showBorder": true,
          "size": "auto"
        }
      },
      "conditionalVisibility": {
        "parameterName": "SelectedTab",
        "comparison": "isEqualTo",
        "value": "OverviewTab"
      },
      "customWidth": "20",
      "name": "ReposWithSecrets"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "securityresources\r\n| where type == \"microsoft.security/assessments/subassessments\"\r\n| extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n| where assessmentKey == \"99232bb2-9b21-4bbb-8e3c-763673b9923d\" or assessmentKey == \"18aa4e75-776a-4296-97f0-fe1cf10d679c\"\r\n| project Resource = tostring(split(id, '/')[12]), subscriptionId, Severity = tostring(properties.status.severity), Status = tostring(properties.status.code), VulnId = tostring(properties.id), id\r\n| where Status == 'Unhealthy'\r\n| summarize dcount(VulnId) by Resource, Severity, VulnId\r\n| summarize Total=count(Severity), High=countif(Severity=='High'), Medium=countif(Severity=='Medium'), Low=countif(Severity=='Low') by Resource\r\n| sort by Total desc\r\n| limit 10",
        "size": 0,
        "title": "Code vulnerabilities by repo",
        "noDataMessage": "No unhealthy repositories found",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "value::all"
        ],
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Resource",
              "formatter": 13,
              "formatOptions": {
                "linkTarget": null,
                "showIcon": true
              }
            },
            {
              "columnMatch": "High",
              "formatter": 4,
              "formatOptions": {
                "palette": "redBright"
              }
            },
            {
              "columnMatch": "Medium",
              "formatter": 4,
              "formatOptions": {
                "palette": "yellow"
              }
            },
            {
              "columnMatch": "Low",
              "formatter": 4,
              "formatOptions": {
                "palette": "blueDark"
              }
            }
          ]
        },
        "sortBy": []
      },
      "conditionalVisibility": {
        "parameterName": "SelectedTab",
        "comparison": "isEqualTo",
        "value": "OverviewTab"
      },
      "customWidth": "40",
      "name": "CodeVulnsBySeverity"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "securityresources\r\n| where type == \"microsoft.security/assessments/subassessments\"\r\n| extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n| where assessmentKey == \"b5ef903f-8655-473b-9784-4f749eeb25c6\" or assessmentKey == \"99232bb2-9b21-4bbb-8e3c-763673b9923d\" or assessmentKey == \"6588c4d4-fbbb-4fb8-be45-7c2de7dc1b3b\" or assessmentKey == \"2ea72208-8558-4011-8dcd-d93375a4003d\" or assessmentKey == \"dd98425c-1407-40cc-8a2c-da5d0a2f80da\" or assessmentKey == \"18aa4e75-776a-4296-97f0-fe1cf10d679c\" or assessmentKey == \"d9be0ff8-3eb0-4348-82f6-c1e735f85983\" or assessmentKey == \"945f7b1c-8def-4ab3-a44d-1416060104b3\" or assessmentKey == \"b6ad173c-0cc6-4d44-b954-8217c8837a8e\" or assessmentKey == \"c64e7cfb-6d64-4227-8c23-b4fa5c72957b\" or assessmentKey == \"5a2b692f-9ccc-4519-b6bd-47125dd51884\"\r\n| project Resource = tostring(split(id, '/')[12]), subscriptionId, Severity = tostring(properties.status.severity), Status = tostring(properties.status.code), VulnId = tostring(properties.id)\r\n| where Status == 'Unhealthy'\r\n| summarize dcount(VulnId) by Resource, Severity, VulnId\r\n| summarize Total=count(Severity), High=countif(Severity=='High'), Medium=countif(Severity=='Medium'), Low=countif(Severity=='Low') by Resource\r\n| sort by Total desc\r\n| limit 10",
        "size": 0,
        "title": "DevOps vulnerabilities by repo",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "value::all"
        ],
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Resource",
              "formatter": 13,
              "formatOptions": {
                "linkTarget": null,
                "showIcon": true
              }
            },
            {
              "columnMatch": "High",
              "formatter": 4,
              "formatOptions": {
                "palette": "redBright"
              }
            },
            {
              "columnMatch": "Medium",
              "formatter": 4,
              "formatOptions": {
                "palette": "yellow"
              }
            },
            {
              "columnMatch": "Low",
              "formatter": 4,
              "formatOptions": {
                "palette": "blueDark"
              }
            }
          ]
        },
        "sortBy": []
      },
      "conditionalVisibility": {
        "parameterName": "SelectedTab",
        "comparison": "isEqualTo",
        "value": "OverviewTab"
      },
      "customWidth": "40",
      "name": "DevOpsVulnsBySeverity"
    },
    {
      "type": 1,
      "content": {
        "json": "---"
      },
      "name": "text - 11"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "securityresources\r\n| where type == \"microsoft.security/assessments/subassessments\"\r\n| extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n| where assessmentKey == \"b5ef903f-8655-473b-9784-4f749eeb25c6\" or assessmentKey == \"dd98425c-1407-40cc-8a2c-da5d0a2f80da\"\r\n| extend Repository = tostring(split(id, '/')[12]),\r\n    Secret = tostring(properties.status.description)\r\n| summarize count(Repository) by Secret",
        "size": 0,
        "title": "Count by secret type",
        "queryType": 1,
        "resourceType": "microsoft.resources/tenants",
        "crossComponentResources": [
          "value::tenant"
        ],
        "visualization": "piechart"
      },
      "conditionalVisibility": {
        "parameterName": "SelectedTab",
        "comparison": "isEqualTo",
        "value": "SecretsTab"
      },
      "name": "SecretsChart"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "securityresources\r\n| where type == \"microsoft.security/assessments/subassessments\"\r\n| extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n| where assessmentKey == \"b5ef903f-8655-473b-9784-4f749eeb25c6\" or assessmentKey == \"dd98425c-1407-40cc-8a2c-da5d0a2f80da\"\r\n| extend Repository = split(id, '/')[12],\r\n    VulId = tostring(properties.id), Severity = tostring(properties.status.severity), Status = tostring(properties.status.code),\r\n    Secret = properties.status.description,\r\n    Details = \"info\"\r\n| project Repository, Status, Severity, Secret, properties, Details",
        "size": 0,
        "title": "Secret scanning",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "value::all"
        ],
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Repository",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "resource",
                    "text": "{0}{1}"
                  }
                ]
              }
            },
            {
              "columnMatch": "Status",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "Healthy",
                    "representation": "success",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Unhealthy",
                    "representation": "2",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "NotApplicable",
                    "representation": "1",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "success",
                    "text": "{0}{1}"
                  }
                ]
              }
            },
            {
              "columnMatch": "Severity",
              "formatter": 1
            },
            {
              "columnMatch": "Secret",
              "formatter": 1
            },
            {
              "columnMatch": "properties",
              "formatter": 5
            },
            {
              "columnMatch": "Details",
              "formatter": 11,
              "formatOptions": {
                "linkTarget": "GenericDetails",
                "linkIsContextBlade": true
              }
            }
          ]
        }
      },
      "conditionalVisibility": {
        "parameterName": "SelectedTab",
        "comparison": "isEqualTo",
        "value": "SecretsTab"
      },
      "name": "SecretResults"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "securityresources\r\n| where type == \"microsoft.security/assessments/subassessments\"\r\n| extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n| where assessmentKey == \"99232bb2-9b21-4bbb-8e3c-763673b9923d\" or assessmentKey == \"18aa4e75-776a-4296-97f0-fe1cf10d679c\"\r\n| extend Repository = split(id, '/')[12],\r\n    Finding = tostring(properties.status.description),\r\n    Tool = case(tostring(properties.additionalData.data.Tool_name) == \"\",\"Unknown\", properties.additionalData.data.Tool_name)\r\n| summarize count(Finding) by Tool",
        "size": 0,
        "title": "Count findings by tool",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "value::all"
        ],
        "visualization": "piechart",
        "tileSettings": {
          "showBorder": false,
          "titleContent": {
            "columnMatch": "Tool",
            "formatter": 1
          },
          "leftContent": {
            "columnMatch": "count_Finding",
            "formatter": 12,
            "formatOptions": {
              "palette": "auto"
            },
            "numberFormat": {
              "unit": 17,
              "options": {
                "maximumSignificantDigits": 3,
                "maximumFractionDigits": 2
              }
            }
          }
        },
        "graphSettings": {
          "type": 0,
          "topContent": {
            "columnMatch": "Tool",
            "formatter": 1
          },
          "centerContent": {
            "columnMatch": "count_Finding",
            "formatter": 1,
            "numberFormat": {
              "unit": 17,
              "options": {
                "maximumSignificantDigits": 3,
                "maximumFractionDigits": 2
              }
            }
          }
        },
        "chartSettings": {
          "showMetrics": false,
          "showLegend": true,
          "seriesLabelSettings": [
            {
              "seriesName": "Unknown",
              "label": "Unknown"
            }
          ]
        }
      },
      "conditionalVisibility": {
        "parameterName": "SelectedTab",
        "comparison": "isEqualTo",
        "value": "CodeTab"
      },
      "customWidth": "33",
      "name": "CodeScanningGraph"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "securityresources\r\n| where type == \"microsoft.security/assessments/subassessments\"\r\n| extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n| where assessmentKey == \"99232bb2-9b21-4bbb-8e3c-763673b9923d\" or assessmentKey == \"18aa4e75-776a-4296-97f0-fe1cf10d679c\"\r\n| extend Repository = tostring(split(id, '/')[12]),\r\n    Finding = tostring(properties.status.description),\r\n    Tool = tostring(properties.additionalData.data.Tool_name),\r\n    TimeGenerated = todatetime(properties.timeGenerated)\r\n| summarize count(Finding) by Repository, TimeGenerated, Tool",
        "size": 0,
        "title": "Count findings by repository",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "value::all"
        ],
        "visualization": "barchart",
        "chartSettings": {
          "showLegend": true,
          "customThresholdLine": "10",
          "customThresholdLineStyle": 2
        }
      },
      "conditionalVisibility": {
        "parameterName": "SelectedTab",
        "comparison": "isEqualTo",
        "value": "CodeTab"
      },
      "customWidth": "66",
      "name": "CodeScanningChart"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "securityresources\r\n| where type == \"microsoft.security/assessments/subassessments\"\r\n| extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n| where assessmentKey == \"99232bb2-9b21-4bbb-8e3c-763673b9923d\" or assessmentKey == \"18aa4e75-776a-4296-97f0-fe1cf10d679c\"\r\n| extend Repository = split(id, '/')[12],\r\n    Finding = tostring(properties.status.description),\r\n    Status = tostring(properties.status.code),\r\n    Severity = tostring(properties.status.severity),\r\n    Tool = tostring(properties.additionalData.data.Tool_name),\r\n    RuleID = tostring(properties.additionalData.data.Rule_id),\r\n    Branch = tostring(properties.additionalData.data.Branch),\r\n    Details = \"info\"\r\n| project Repository, RuleID, Branch, Severity, Status, Finding, Tool, properties, Details",
        "size": 0,
        "title": "Code scanning by severity",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "value::all"
        ],
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Repository",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "resource",
                    "text": "{0}{1}"
                  }
                ]
              }
            },
            {
              "columnMatch": "Status",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "Healthy",
                    "representation": "success",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Unhealthy",
                    "representation": "2",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "NotApplicable",
                    "representation": "1",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "success",
                    "text": "{0}{1}"
                  }
                ]
              }
            },
            {
              "columnMatch": "properties",
              "formatter": 5
            },
            {
              "columnMatch": "Details",
              "formatter": 11,
              "formatOptions": {
                "linkTarget": "GenericDetails",
                "linkIsContextBlade": true
              }
            }
          ],
          "rowLimit": 300,
          "hierarchySettings": {
            "treeType": 1,
            "groupBy": [
              "Repository",
              "Severity"
            ]
          }
        }
      },
      "conditionalVisibility": {
        "parameterName": "SelectedTab",
        "comparison": "isEqualTo",
        "value": "CodeTab"
      },
      "name": "CodeScanningResults"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "securityresources\r\n| where type == \"microsoft.security/assessments/subassessments\"\r\n| extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n| where assessmentKey == \"2ea72208-8558-4011-8dcd-d93375a4003d\" or assessmentKey == \"945f7b1c-8def-4ab3-a44d-1416060104b3\"\r\n| extend VulId = tostring(properties.id), Severity = tostring(properties.status.severity), Status = tostring(properties.status.code)\r\n| where Status == 'Unhealthy'\r\n| summarize Count = dcount(VulId) by Severity",
        "size": 0,
        "title": "OSS vulnerabilities by severity",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "value::all"
        ],
        "visualization": "piechart",
        "chartSettings": {
          "seriesLabelSettings": [
            {
              "seriesName": "High",
              "color": "redBright"
            },
            {
              "seriesName": "Medium",
              "color": "yellow"
            },
            {
              "seriesName": "Low",
              "color": "blueDark"
            }
          ]
        }
      },
      "conditionalVisibility": {
        "parameterName": "SelectedTab",
        "comparison": "isEqualTo",
        "value": "OSSTab"
      },
      "customWidth": "33",
      "name": "OSSVulnerabilitiesGraph"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "securityresources\r\n| where type == \"microsoft.security/assessments/subassessments\"\r\n| extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n| where assessmentKey == \"2ea72208-8558-4011-8dcd-d93375a4003d\" or assessmentKey == \"945f7b1c-8def-4ab3-a44d-1416060104b3\"\r\n| extend Repository = tostring(split(id, '/')[12]),\r\n    Finding = tostring(properties.status.description),\r\n    Tool = tostring(properties.additionalData.data.Tool_name),\r\n    TimeGenerated = todatetime(properties.timeGenerated)\r\n| summarize count(Finding) by Repository, TimeGenerated, Tool",
        "size": 0,
        "title": "Count findings by repository",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "value::all"
        ],
        "visualization": "barchart",
        "chartSettings": {
          "customThresholdLine": "5",
          "customThresholdLineStyle": 2
        }
      },
      "conditionalVisibility": {
        "parameterName": "SelectedTab",
        "comparison": "isEqualTo",
        "value": "OSSTab"
      },
      "customWidth": "66",
      "name": "OSSVulnChart"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "securityresources\r\n| where type == \"microsoft.security/assessments/subassessments\"\r\n| extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n| where assessmentKey == \"2ea72208-8558-4011-8dcd-d93375a4003d\" or assessmentKey == \"945f7b1c-8def-4ab3-a44d-1416060104b3\"\r\n| extend Repository = split(id, '/')[12],\r\n    Finding = tostring(properties.status.description),\r\n    Status = tostring(properties.status.code),\r\n    Severity = tostring(properties.status.severity),\r\n    Package = tostring(properties.additionalData.data.securityVulnerability__package__ecosystem),\r\n    Summary = tostring(properties.additionalData.data.securityAdvisory__summary),\r\n    Details = \"info\"\r\n| project Repository, Severity,  Status, Summary, Package, Finding, properties, Details",
        "size": 0,
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "value::all"
        ],
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Repository",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "resource",
                    "text": "{0}{1}"
                  }
                ]
              }
            },
            {
              "columnMatch": "Severity",
              "formatter": 1
            },
            {
              "columnMatch": "Status",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "Healthy",
                    "representation": "success",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Unhealthy",
                    "representation": "2",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "NotApplicable",
                    "representation": "1",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "success",
                    "text": "{0}{1}"
                  }
                ]
              }
            },
            {
              "columnMatch": "Summary",
              "formatter": 1
            },
            {
              "columnMatch": "Package",
              "formatter": 1
            },
            {
              "columnMatch": "Finding",
              "formatter": 1
            },
            {
              "columnMatch": "properties",
              "formatter": 5
            },
            {
              "columnMatch": "Details",
              "formatter": 11,
              "formatOptions": {
                "linkTarget": "GenericDetails",
                "linkIsContextBlade": true
              }
            }
          ],
          "hierarchySettings": {
            "treeType": 1,
            "groupBy": [
              "Repository"
            ]
          }
        }
      },
      "conditionalVisibility": {
        "parameterName": "SelectedTab",
        "comparison": "isEqualTo",
        "value": "OSSTab"
      },
      "name": "OSSVulnerabilitiesResults"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "securityresources\r\n| where type == \"microsoft.security/assessments/subassessments\"\r\n| extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n| where assessmentKey == \"6588c4d4-fbbb-4fb8-be45-7c2de7dc1b3b\" or assessmentKey == \"d9be0ff8-3eb0-4348-82f6-c1e735f85983\"\r\n| extend Repository = split(id, '/')[12],\r\n    Finding = tostring(properties.status.description),\r\n    Tool = case(tostring(properties.additionalData.data.Tool_name) == \"\",\"Unknown\", properties.additionalData.data.Tool_name)\r\n| summarize count(Finding) by Tool",
        "size": 0,
        "title": "Findings by tool",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "value::all"
        ],
        "visualization": "piechart"
      },
      "conditionalVisibility": {
        "parameterName": "SelectedTab",
        "comparison": "isEqualTo",
        "value": "IaCTab"
      },
      "customWidth": "33",
      "name": "IaCSummaryResults"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "securityresources\r\n| where type == \"microsoft.security/assessments/subassessments\"\r\n| extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n| where assessmentKey == \"6588c4d4-fbbb-4fb8-be45-7c2de7dc1b3b\" or assessmentKey == \"d9be0ff8-3eb0-4348-82f6-c1e735f85983\"\r\n| extend Repository = tostring(split(id, '/')[12]),\r\n    Finding = tostring(properties.status.description),\r\n    Tool = tostring(properties.additionalData.data.Tool_name),\r\n    TimeGenerated = todatetime(properties.timeGenerated)\r\n| summarize count(Finding) by Repository, TimeGenerated, Tool",
        "size": 0,
        "title": "Count findings by repository",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "value::all"
        ],
        "visualization": "barchart",
        "chartSettings": {
          "customThresholdLine": "10",
          "customThresholdLineStyle": 2
        }
      },
      "conditionalVisibility": {
        "parameterName": "SelectedTab",
        "comparison": "isEqualTo",
        "value": "IaCTab"
      },
      "customWidth": "66",
      "name": "IaCChart"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "securityresources\r\n| where type == \"microsoft.security/assessments/subassessments\"\r\n| extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n| where assessmentKey == \"6588c4d4-fbbb-4fb8-be45-7c2de7dc1b3b\" or assessmentKey == \"d9be0ff8-3eb0-4348-82f6-c1e735f85983\"\r\n| extend Repository = split(id, '/')[12],\r\n    Finding = tostring(properties.status.description),\r\n    Status = tostring(properties.status.code),\r\n    Severity = tostring(properties.status.severity),\r\n    Package = tostring(properties.additionalData.data.securityVulnerability__package__ecosystem),\r\n    Summary = tostring(properties.additionalData.data.securityAdvisory__summary),\r\n    Details = \"info\"\r\n| project Repository, Severity,  Status, Summary, Package, Finding, properties, Details",
        "size": 0,
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "value::all"
        ],
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "properties",
              "formatter": 5
            },
            {
              "columnMatch": "Details",
              "formatter": 11,
              "formatOptions": {
                "linkTarget": "GenericDetails",
                "linkIsContextBlade": true
              }
            }
          ],
          "hierarchySettings": {
            "treeType": 1,
            "groupBy": [
              "Repository"
            ]
          }
        }
      },
      "conditionalVisibility": {
        "parameterName": "SelectedTab",
        "comparison": "isEqualTo",
        "value": "IaCTab"
      },
      "name": "IaCResults"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "securityresources\r\n| where type == \"microsoft.security/assessments\"\r\n| where name == \"b6ad173c-0cc6-4d44-b954-8217c8837a8e\" \r\n                or name == \"5a2b692f-9ccc-4519-b6bd-47125dd51884\" \r\n                or name == \"c64e7cfb-6d64-4227-8c23-b4fa5c72957b\" \r\n                or name == \"b5ef903f-8655-473b-9784-4f749eeb25c6\" \r\n                or name == \"99232bb2-9b21-4bbb-8e3c-763673b9923d\" \r\n                or name == \"6588c4d4-fbbb-4fb8-be45-7c2de7dc1b3b\"\r\n                or name == \"2ea72208-8558-4011-8dcd-d93375a4003d\"\r\n                or name == \"dd98425c-1407-40cc-8a2c-da5d0a2f80da\" \r\n                or name == \"18aa4e75-776a-4296-97f0-fe1cf10d679c\" \r\n                or name == \"d9be0ff8-3eb0-4348-82f6-c1e735f85983\"\r\n                or name == \"945f7b1c-8def-4ab3-a44d-1416060104b3\"\r\n| extend Status = tostring(properties.status.code)\r\n| where Status == 'Unhealthy'\r\n| project assessmentKey=name, parse_json(properties)\r\n| where properties.metadata.severity in ('Low','Medium','High')\r\n| extend SeverityRank = case(\r\n    properties.metadata.severity == 'High', 3,\r\n    properties.metadata.severity == 'Medium', 2,\r\n    properties.metadata.severity == 'Low', 1,\r\n    0)\r\n| project-away SeverityRank\r\n| extend Severity = properties.metadata.severity\r\n| project Severity = tostring(Severity)\r\n| summarize Count = count() by Severity",
        "size": 0,
        "title": "Security posture by severity",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "value::all"
        ],
        "visualization": "piechart",
        "chartSettings": {
          "seriesLabelSettings": [
            {
              "seriesName": "High",
              "color": "redBright"
            },
            {
              "seriesName": "Medium",
              "color": "yellow"
            },
            {
              "seriesName": "Low",
              "color": "blueDark"
            }
          ]
        }
      },
      "conditionalVisibility": {
        "parameterName": "SelectedTab",
        "comparison": "isEqualTo",
        "value": "PostureTab"
      },
      "customWidth": "33",
      "name": "SecurityPostureGraph"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "securityresources\r\n| where type == \"microsoft.security/assessments\"\r\n| extend assessmentKey = extract(\".*assessments/(.+?)/.*\",1,  id)\r\n| extend Repository = tostring(split(properties.resourceDetails.Id,\"/\",12))\r\n| extend Status = tostring(properties.status.code)\r\n| extend TimeGenerated = todatetime(properties.timeGenerated)\r\n| where Status == 'Unhealthy'\r\n| where name == \"b6ad173c-0cc6-4d44-b954-8217c8837a8e\" \r\n                or name == \"5a2b692f-9ccc-4519-b6bd-47125dd51884\" \r\n                or name == \"c64e7cfb-6d64-4227-8c23-b4fa5c72957b\" \r\n                or name == \"b5ef903f-8655-473b-9784-4f749eeb25c6\" \r\n                or name == \"99232bb2-9b21-4bbb-8e3c-763673b9923d\" \r\n                or name == \"6588c4d4-fbbb-4fb8-be45-7c2de7dc1b3b\"\r\n                or name == \"2ea72208-8558-4011-8dcd-d93375a4003d\"\r\n                or name == \"dd98425c-1407-40cc-8a2c-da5d0a2f80da\" \r\n                or name == \"18aa4e75-776a-4296-97f0-fe1cf10d679c\" \r\n                or name == \"d9be0ff8-3eb0-4348-82f6-c1e735f85983\"\r\n                or name == \"945f7b1c-8def-4ab3-a44d-1416060104b3\"\r\n| summarize count(name) by trim(@'^\\[\"|\"]$',Repository)",
        "size": 0,
        "title": "Posture assessments by repository",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "value::all"
        ],
        "visualization": "barchart"
      },
      "conditionalVisibility": {
        "parameterName": "SelectedTab",
        "comparison": "isEqualTo",
        "value": "PostureTab"
      },
      "customWidth": "66",
      "name": "PostureChart"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "securityresources\r\n| where type == \"microsoft.security/assessments\"\r\n| extend assessmentKey = name\r\n| where assessmentKey == \"b6ad173c-0cc6-4d44-b954-8217c8837a8e\" or assessmentKey == \"c64e7cfb-6d64-4227-8c23-b4fa5c72957b\" or assessmentKey == \"5a2b692f-9ccc-4519-b6bd-47125dd51884\"\r\n| extend Repository = split(id, '/')[12],\r\n    Description = tostring(properties.status.description),\r\n    Status = tostring(properties.status.code),\r\n    Severity = tostring(properties.metadata.severity),\r\n    Details = \"info\",\r\n    Visibility = case(properties.additionalData.private == 'True', 'Private', \r\n                      properties.additionalData.private == 'False', 'Public', \r\n                      'Unknown')\r\n| project Repository, Visibility, Description, Status, Severity, properties, Details",
        "size": 0,
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "value::all"
        ],
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Repository",
              "formatter": 1
            },
            {
              "columnMatch": "Description",
              "formatter": 1
            },
            {
              "columnMatch": "Status",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "Healthy",
                    "representation": "success",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Unhealthy",
                    "representation": "2",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "NotApplicable",
                    "representation": "1",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "success",
                    "text": "{0}{1}"
                  }
                ]
              }
            },
            {
              "columnMatch": "Severity",
              "formatter": 1
            },
            {
              "columnMatch": "properties",
              "formatter": 5
            },
            {
              "columnMatch": "Details",
              "formatter": 11,
              "formatOptions": {
                "linkTarget": "GenericDetails",
                "linkIsContextBlade": true
              }
            },
            {
              "columnMatch": "Environment",
              "formatter": 1
            }
          ],
          "hierarchySettings": {
            "treeType": 1,
            "groupBy": [
              "Repository",
              "Severity"
            ]
          }
        }
      },
      "conditionalVisibility": {
        "parameterName": "SelectedTab",
        "comparison": "isEqualTo",
        "value": "PostureTab"
      },
      "name": "SecurityPosture"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "securityresources\r\n| where type == \"microsoft.security/assessments\"\r\n| where name == \"b6ad173c-0cc6-4d44-b954-8217c8837a8e\" \r\n                or name == \"5a2b692f-9ccc-4519-b6bd-47125dd51884\" \r\n                or name == \"c64e7cfb-6d64-4227-8c23-b4fa5c72957b\" \r\n                or name == \"b5ef903f-8655-473b-9784-4f749eeb25c6\" \r\n                or name == \"99232bb2-9b21-4bbb-8e3c-763673b9923d\" \r\n                or name == \"6588c4d4-fbbb-4fb8-be45-7c2de7dc1b3b\"\r\n                or name == \"2ea72208-8558-4011-8dcd-d93375a4003d\"\r\n                or name == \"dd98425c-1407-40cc-8a2c-da5d0a2f80da\" \r\n                or name == \"18aa4e75-776a-4296-97f0-fe1cf10d679c\" \r\n                or name == \"d9be0ff8-3eb0-4348-82f6-c1e735f85983\"\r\n                or name == \"945f7b1c-8def-4ab3-a44d-1416060104b3\"\r\n| extend Repository = tostring(split(id, '/')[12]), \r\n    Threats = tostring(strcat_array(properties.metadata.threats,\",\")), \r\n    Tactics = tostring(strcat_array(properties.metadata.tactics,\",\")),\r\n        Status = tostring(properties.status.code)\r\n| where Status == \"Unhealthy\"\r\n| project Repository, Threats, Tactics\r\n| summarize count() by Threats",
        "size": 0,
        "title": "Threats & tactics",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "value::all"
        ],
        "visualization": "piechart"
      },
      "conditionalVisibility": {
        "parameterName": "SelectedTab",
        "comparison": "isEqualTo",
        "value": "ThreatsTab"
      },
      "customWidth": "33",
      "name": "ThreatsandTacticsGraph"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "securityresources\r\n| where type == \"microsoft.security/assessments\"\r\n| where name == \"b6ad173c-0cc6-4d44-b954-8217c8837a8e\" \r\n                or name == \"5a2b692f-9ccc-4519-b6bd-47125dd51884\" \r\n                or name == \"c64e7cfb-6d64-4227-8c23-b4fa5c72957b\" \r\n                or name == \"b5ef903f-8655-473b-9784-4f749eeb25c6\" \r\n                or name == \"99232bb2-9b21-4bbb-8e3c-763673b9923d\" \r\n                or name == \"6588c4d4-fbbb-4fb8-be45-7c2de7dc1b3b\"\r\n                or name == \"2ea72208-8558-4011-8dcd-d93375a4003d\"\r\n                or name == \"dd98425c-1407-40cc-8a2c-da5d0a2f80da\" \r\n                or name == \"18aa4e75-776a-4296-97f0-fe1cf10d679c\" \r\n                or name == \"d9be0ff8-3eb0-4348-82f6-c1e735f85983\"\r\n                or name == \"945f7b1c-8def-4ab3-a44d-1416060104b3\"\r\n| extend Repository = tostring(split(id, '/')[12]), \r\n    Threats = tostring(strcat_array(properties.metadata.threats,\",\")), \r\n    Tactics = tostring(strcat_array(properties.metadata.tactics,\",\")),\r\n    Status = tostring(properties.status.code)\r\n| where Status == \"Unhealthy\"\r\n| project Repository, Threats, Tactics\r\n| summarize count(Threats) by Repository",
        "size": 0,
        "title": " Threats & tactics by repository",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "value::all"
        ],
        "visualization": "barchart",
        "chartSettings": {
          "showMetrics": false,
          "showLegend": true,
          "customThresholdLine": "5",
          "customThresholdLineStyle": 1
        }
      },
      "conditionalVisibility": {
        "parameterName": "SelectedTab",
        "comparison": "isEqualTo",
        "value": "ThreatsTab"
      },
      "customWidth": "66",
      "name": "ThreatandTacticsChart"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "securityresources\r\n| where type == \"microsoft.security/assessments\"\r\n| where name == \"b6ad173c-0cc6-4d44-b954-8217c8837a8e\" \r\n                or name == \"5a2b692f-9ccc-4519-b6bd-47125dd51884\" \r\n                or name == \"c64e7cfb-6d64-4227-8c23-b4fa5c72957b\" \r\n                or name == \"b5ef903f-8655-473b-9784-4f749eeb25c6\" \r\n                or name == \"99232bb2-9b21-4bbb-8e3c-763673b9923d\" \r\n                or name == \"6588c4d4-fbbb-4fb8-be45-7c2de7dc1b3b\"\r\n                or name == \"2ea72208-8558-4011-8dcd-d93375a4003d\"\r\n                or name == \"dd98425c-1407-40cc-8a2c-da5d0a2f80da\" \r\n                or name == \"18aa4e75-776a-4296-97f0-fe1cf10d679c\" \r\n                or name == \"d9be0ff8-3eb0-4348-82f6-c1e735f85983\"\r\n                or name == \"945f7b1c-8def-4ab3-a44d-1416060104b3\"\r\n| extend Status = tostring(properties.status.code)\r\n| where Status == 'Unhealthy'\r\n| extend Repository = tostring(split(id, '/')[12]), \r\n        Threats = tostring(strcat_array(properties.metadata.threats,\",\")), \r\n        Tactics = tostring(strcat_array(properties.metadata.tactics,\",\")), \r\n        Techniques = tostring(strcat_array(properties.metadata.techniques,\",\")),\r\n        Details = \"info\"\r\n| project Repository, Threats, Tactics, Techniques, properties, Details",
        "size": 0,
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "value::all"
        ],
        "visualization": "table",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Threats",
              "formatter": 1
            },
            {
              "columnMatch": "Tactics",
              "formatter": 1
            },
            {
              "columnMatch": "properties",
              "formatter": 5
            },
            {
              "columnMatch": "Details",
              "formatter": 11,
              "formatOptions": {
                "linkTarget": "GenericDetails",
                "linkIsContextBlade": true
              }
            }
          ],
          "hierarchySettings": {
            "treeType": 1,
            "groupBy": [
              "Repository"
            ]
          }
        },
        "sortBy": [],
        "tileSettings": {
          "showBorder": false,
          "titleContent": {
            "columnMatch": "Threats",
            "formatter": 1
          },
          "leftContent": {
            "columnMatch": "count_",
            "formatter": 12,
            "formatOptions": {
              "palette": "auto"
            },
            "numberFormat": {
              "unit": 17,
              "options": {
                "maximumSignificantDigits": 3,
                "maximumFractionDigits": 2
              }
            }
          }
        },
        "graphSettings": {
          "type": 0,
          "topContent": {
            "columnMatch": "Threats",
            "formatter": 1
          },
          "centerContent": {
            "columnMatch": "count_",
            "formatter": 1,
            "numberFormat": {
              "unit": 17,
              "options": {
                "maximumSignificantDigits": 3,
                "maximumFractionDigits": 2
              }
            }
          }
        },
        "chartSettings": {
          "seriesLabelSettings": [
            {
              "seriesName": "[\"MissingCoverage\",\"ThreatResistance\"]",
              "color": "blue"
            },
            {
              "seriesName": "[\"AccountBreach\"]",
              "color": "magenta"
            },
            {
              "color": "purple"
            }
          ]
        },
        "mapSettings": {
          "locInfo": "LatLong",
          "sizeSettings": "count_",
          "sizeAggregation": "Sum",
          "legendMetric": "count_",
          "legendAggregation": "Sum",
          "itemColorSettings": {
            "type": "heatmap",
            "colorAggregation": "Sum",
            "nodeColorField": "count_",
            "heatmapPalette": "greenRed"
          }
        }
      },
      "conditionalVisibility": {
        "parameterName": "SelectedTab",
        "comparison": "isEqualTo",
        "value": "ThreatsTab"
      },
      "name": "ThreatsAndTactics"
    }
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}
