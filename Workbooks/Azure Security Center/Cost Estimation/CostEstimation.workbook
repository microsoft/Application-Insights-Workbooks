{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "## Cost estimation workbook\r\nThis workbook has been created to provide a consolidated price estimation for Microsoft Defender for Cloud plans based on the resource telemetry in your own environment. Please note that these numbers can only be estimates based on retail prices and do not provide actual billing data."
      },
      "name": "main text"
    },
    {
      "type": 1,
      "content": {
        "json": "<svg viewBox=\"0 0 19 19\" width=\"20\" class=\"fxt-escapeShadow\" role=\"presentation\" focusable=\"false\" xmlns:svg=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" aria-hidden=\"true\"><g><path fill=\"#1b93eb\" d=\"M16.82 8.886c0 4.81-5.752 8.574-7.006 9.411a.477.477 0 01-.523 0C8.036 17.565 2.18 13.7 2.18 8.886V3.135a.451.451 0 01.42-.419C7.2 2.612 6.154.625 9.5.625s2.3 1.987 6.8 2.091a.479.479 0 01.523.419z\"></path><path fill=\"url(#0024423711759027356)\" d=\"M16.192 8.99c0 4.392-5.333 7.947-6.483 8.575a.319.319 0 01-.418 0c-1.15-.732-6.483-4.183-6.483-8.575V3.762a.575.575 0 01.313-.523C7.2 3.135 6.258 1.357 9.4 1.357s2.2 1.882 6.274 1.882a.45.45 0 01.419.418z\"></path><path d=\"M9.219 5.378a.313.313 0 01.562 0l.875 1.772a.314.314 0 00.236.172l1.957.284a.314.314 0 01.174.535l-1.416 1.38a.312.312 0 00-.09.278l.334 1.949a.313.313 0 01-.455.33l-1.75-.92a.314.314 0 00-.292 0l-1.75.92a.313.313 0 01-.455-.33L7.483 9.8a.312.312 0 00-.09-.278L5.977 8.141a.314.314 0 01.174-.535l1.957-.284a.314.314 0 00.236-.172z\" class=\"msportalfx-svg-c01\"></path></g></svg>&nbsp;<span style=\"font-family: Open Sans; font-weight: 620; font-size: 14px;font-style: bold;margin:-10px 0px 0px 0px;position: relative;top:-3px;left:-4px;\"> Please take the time to answer a quick survey. To submit your feedback,\r\n</span>[<span style=\"font-family: Open Sans; font-weight: 620; font-size: 14px;font-style: bold;margin:-10px 0px 0px 0px;position: relative;top:-3px;left:-4px;\"> click here. </span>](https://aka.ms/MDCCostEstimation)"
      },
      "name": "survey"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "value::selected"
        ],
        "parameters": [
          {
            "id": "c9ee86da-fe9b-4f75-8a03-a750de4d62d5",
            "version": "KqlParameterItem/1.0",
            "name": "numberofsubscriptions",
            "type": 1,
            "query": "resourcecontainers\r\n| where type == \"microsoft.resources/subscriptions\"\r\n| summarize count()",
            "crossComponentResources": [
              "value::selected"
            ],
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "9bd2ea6c-e396-44b7-9fc2-a088240d473e",
            "version": "KqlParameterItem/1.0",
            "name": "istenantlevel",
            "type": 1,
            "isHiddenWhenLocked": true,
            "criteriaData": [
              {
                "criteriaContext": {
                  "leftOperand": "numberofsubscriptions",
                  "operator": ">",
                  "rightValType": "static",
                  "rightVal": "3000",
                  "resultValType": "static",
                  "resultVal": "1"
                }
              },
              {
                "criteriaContext": {
                  "operator": "Default",
                  "resultValType": "static",
                  "resultVal": "0"
                }
              }
            ],
            "timeContext": {
              "durationMs": 86400000
            }
          }
        ],
        "style": "pills",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources"
      },
      "conditionalVisibility": {
        "parameterName": "x",
        "comparison": "isNotEqualTo"
      },
      "name": "globalParams"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "ce3d9c88-c6ee-4d6f-87fa-7bf3d86d029a",
                  "version": "KqlParameterItem/1.0",
                  "name": "Subscriptions",
                  "type": 6,
                  "description": "Please select one or several subscriptions to allow the workbook to calculate Defender for Cloud cost.",
                  "isRequired": true,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "includeAll": false,
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "defaultValue": "value::all",
                  "value": [
                    "value::all"
                  ]
                },
                {
                  "id": "a4d387c3-f0f6-4512-95f4-3e976851d69a",
                  "version": "KqlParameterItem/1.0",
                  "name": "plans",
                  "label": "Defenders plan",
                  "type": 2,
                  "description": "Please select one or several plans to allow the workbook to calculate Defender for Cloud cost.",
                  "isRequired": true,
                  "multiSelect": true,
                  "quote": "",
                  "delimiter": ",",
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "showDefault": false
                  },
                  "jsonData": "[\r\n{ \"value\": \"microsoft.compute/virtualmachines, microsoft.compute/virtualmachinescalesets, microsoft.hybridcompute/machines, microsoft.classiccompute/virtualmachines\", \"label\": \"Servers\"},\r\n { \"value\": \"microsoft.web/serverfarms\", \"label\": \"App Services\"},\r\n { \"value\": \"microsoft.sql/servers, microsoft.sql/managedinstances\", \"label\": \"SQL Databases\"},\r\n {\"value\": \"microsoft.dbforpostgresql/servers, microsoft.dbformysql/servers, microsoft.dbformariadb/servers\", \"label\": \"OSS DBs\"},\r\n  { \"value\": \"microsoft.containerservice/managedclusters\", \"label\": \"Containers\"},\r\n  { \"value\": \"microsoft.storage/storageaccounts - storageenabled\", \"label\": \"Storage\"},\r\n  { \"value\": \"microsoft.compute/virtualmachines, microsoft.classiccompute/virtualmachines, microsoft.compute/virtualmachinescalesets, microsoft.sql/servers, microsoft.hybridcompute/machines, microsoft.dbforpostgresql/servers, microsoft.dbformysql/servers, microsoft.sql/managedinstances, microsoft.dbformariadb/servers, Microsoft.synapse/workspaces, microsoft.storage/storageaccounts\", \"label\": \"DefenderCSPM\"},\r\n  {\"value\": \"microsoft.resources/subscriptions\", \"label\": \"Defender for ARM\"},\r\n  {\"value\": \"microsoft.keyvault/vaults\", \"label\": \"Defender for Key Vault\"}\r\n]",
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "value": [
                    "value::all"
                  ]
                },
                {
                  "id": "3c915b1e-0c56-47d3-8eb7-b9c1f7276f2f",
                  "version": "KqlParameterItem/1.0",
                  "name": "subInfo",
                  "label": "Additional information",
                  "type": 10,
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\r\n { \"value\": 1, \"label\": \"On\", \"selected\": true},\r\n { \"value\": 0, \"label\": \"Off\"}\r\n]"
                },
                {
                  "id": "305b0ead-34c1-48fb-b633-f6b7a261b438",
                  "version": "KqlParameterItem/1.0",
                  "name": "subinfoRes",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "resultValType": "expression",
                        "resultVal": "{subInfo}"
                      }
                    }
                  ]
                }
              ],
              "style": "above",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "conditionalVisibility": {
              "parameterName": "istenantlevel",
              "comparison": "isEqualTo",
              "value": "0"
            },
            "name": "subscriptionPicker"
          },
          {
            "type": 1,
            "content": {
              "json": "* ###### The costs displayed are estimated and might be different from the actual costs seen in the invoice.  \r\n\r\n* ###### The estimated costs displayed are monthly estimated costs per subscription. \r\n\r\n* ###### To estimate the costs for a subscription, you must be assigned with at least Reader role at the subscription level. \r\n\r\n* ###### This workbook displays the cost for Defender for Storage based on a per-storage account calculation, but accounts with an exceptionally high transaction volume incur an overage charge that won’t be seen in this workbook. For more information on Defender for Storage cost estimation calculations, please visit our [GitHub page](https://github.com/Azure/Microsoft-Defender-for-Cloud/tree/main/Workbooks/Microsoft%20Defender%20for%20Storage%20Price%20Estimation).\r\n\r\n* ###### Defender for Cosmos DB plan currently can’t be estimated, we are working to include it in the future.\r\n\r\n* ###### The cost estimation is based on the retail prices of Defender plans; Learn more about [Defender plans’ retail price](https://azure.microsoft.com/pricing/details/defender-for-cloud/).\r\n\r\n* ###### Microsoft Defender CSPM protects across all your multicloud workloads, but billing only applies for Servers, Databases and Storage accounts at $5/billable resource/month. Please visit [Defender CSPM documentation page](https://learn.microsoft.com/en-us/azure/defender-for-cloud/concept-cloud-security-posture-management) for more information.",
              "style": "info"
            },
            "customWidth": "50",
            "conditionalVisibilities": [
              {
                "parameterName": "istenantlevel",
                "comparison": "isEqualTo",
                "value": "0"
              },
              {
                "parameterName": "subinfoRes",
                "comparison": "isEqualTo",
                "value": "1"
              }
            ],
            "name": "text - 6"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "f1fa88f6-f96a-46b7-a706-dcbb58a41b21",
                  "version": "KqlParameterItem/1.0",
                  "name": "P1P2",
                  "type": 1,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "plans",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "microsoft.compute/virtualmachines, microsoft.compute/virtualmachinescalesets, microsoft.hybridcompute/machines, microsoft.classiccompute/virtualmachines",
                        "resultValType": "static",
                        "resultVal": "1"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "resultValType": "static",
                        "resultVal": "0"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "conditionalVisibility": {
              "parameterName": "x",
              "comparison": "isNotEqualTo"
            },
            "name": "parameters - 8"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "0e210f10-f123-4083-9f28-78dc38d1f2ba",
                  "version": "KqlParameterItem/1.0",
                  "name": "serversPlanVal",
                  "label": "Servers Plan",
                  "type": 10,
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\r\n { \"value\": 5, \"label\": \"Defender for Servers Plan 1\", \"selected\": true},\r\n { \"value\": 15, \"label\": \"Defender for Servers Plan 2\"}\r\n]",
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "value": "15"
                }
              ],
              "style": "above",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "conditionalVisibilities": [
              {
                "parameterName": "P1P2",
                "comparison": "isEqualTo",
                "value": "1"
              },
              {
                "parameterName": "istenantlevel",
                "comparison": "isEqualTo",
                "value": "0"
              }
            ],
            "name": "serversplan"
          },
          {
            "type": 1,
            "content": {
              "json": "{plans}\r\n\r\n"
            },
            "conditionalVisibility": {
              "parameterName": "x",
              "comparison": "isNotEqualTo"
            },
            "name": "selectedPlansDropDown"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "66f1094b-dc23-47e3-a766-02f0afaa90ea",
                  "version": "KqlParameterItem/1.0",
                  "name": "isServersP1",
                  "type": 1,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "P1P2",
                        "operator": "==",
                        "rightValType": "static",
                        "rightVal": "1",
                        "resultValType": "expression",
                        "resultVal": "{serversPlanVal} == 5"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "resultValType": "static",
                        "resultVal": "0"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "32c324b2-7f01-48d7-861e-6a3dcabdec3c",
                  "version": "KqlParameterItem/1.0",
                  "name": "isServersP2",
                  "type": 1,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "P1P2",
                        "operator": "==",
                        "rightValType": "static",
                        "rightVal": "1",
                        "resultValType": "expression",
                        "resultVal": "{serversPlanVal} == 15"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "resultValType": "expression",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "370c0f82-f1fb-4c7f-babe-4122ae51ec15",
                  "version": "KqlParameterItem/1.0",
                  "name": "isStorage",
                  "type": 1,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "plans",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "microsoft.storage/storageaccounts - storageenabled",
                        "resultValType": "expression",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "resultValType": "expression",
                        "resultVal": "false"
                      }
                    }
                  ]
                },
                {
                  "id": "3870e5a7-9114-426e-a6e4-55ec453f58a1",
                  "version": "KqlParameterItem/1.0",
                  "name": "isDcspm",
                  "type": 1,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "plans",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "microsoft.compute/virtualmachines, microsoft.classiccompute/virtualmachines, microsoft.compute/virtualmachinescalesets, microsoft.sql/servers, microsoft.hybridcompute/machines, microsoft.dbforpostgresql/servers, microsoft.dbformysql/servers, microsoft.sql/managedinstances, microsoft.dbformariadb/servers, Microsoft.synapse/workspaces, microsoft.storage/storageaccounts",
                        "resultValType": "expression",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "resultValType": "expression",
                        "resultVal": "false"
                      }
                    }
                  ]
                },
                {
                  "id": "44b6df94-4023-4d48-a101-18e2b30f73b8",
                  "version": "KqlParameterItem/1.0",
                  "name": "isOss",
                  "type": 1,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "plans",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "microsoft.dbforpostgresql/servers, microsoft.dbformysql/servers, microsoft.dbformariadb/servers",
                        "resultValType": "expression",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "resultValType": "expression",
                        "resultVal": "false"
                      }
                    }
                  ]
                },
                {
                  "id": "4f792148-ca81-4732-9d83-d9c2759b72fb",
                  "version": "KqlParameterItem/1.0",
                  "name": "isSql",
                  "type": 1,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "plans",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "microsoft.sql/servers, microsoft.sql/managedinstances",
                        "resultValType": "expression",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "resultValType": "expression",
                        "resultVal": "false"
                      }
                    }
                  ]
                },
                {
                  "id": "cee4ac08-adf1-4fe5-b3a7-e1d2d11f74a6",
                  "version": "KqlParameterItem/1.0",
                  "name": "isServersSelected",
                  "type": 1,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "plans",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "microsoft.compute/virtualmachines, microsoft.compute/virtualmachinescalesets, microsoft.hybridcompute/machines, microsoft.classiccompute/virtualmachines",
                        "resultValType": "expression",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "resultValType": "expression",
                        "resultVal": "false"
                      }
                    }
                  ]
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "conditionalVisibility": {
              "parameterName": "x",
              "comparison": "isNotEqualTo"
            },
            "name": "subscriptionconditions"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\r\n        | extend selectedPlans = tolower('{plans}')\r\n        | extend type = tolower(type) \r\n        | where selectedPlans has type \r\n    | extend managedClustersCount = iff(type == \"microsoft.containerservice/managedclusters\" and isnotempty(sku) and tolower(sku.tier) != \"consumption\", toint(properties.numberOfWorkers), 0)\r\n    | where tostring(properties.powerState.code) =~ 'Running'\r\n    | mv-expand properties.agentPoolProfiles\r\n    | extend sku = tostring(properties_agentPoolProfiles.vmSize)\r\n    | parse kind=regex sku with '(.*?)_([A-Za-z]*)' coresInSku: int '([A-Za-z]*)_(.*?)'\r\n    | project subscriptionId, resourceGroup, managedClustersCount = toint(properties_agentPoolProfiles['count']) * coresInSku//, sku\r\n    | summarize sum(managedClustersCount) by subscriptionId, resourceGroup//, tostring(tags[\"provider\"])\r\n    | extend sum_appServiceCount = 0, sum_serversCount = 0, sum_storageAccountCount = 0, sum_ossDatabaseCount = 0, sum_cosmosDbCount = 0, sum_sqlServersCount = 0, sum_containerRegistryCount = 0\r\n    | where sum_managedClustersCount > 0\r\n    | extend Dummy = 1 \r\n| join  kind=inner \r\n    ( \r\n    resources\r\n        | extend selectedPlans = tolower('{plans}')\r\n        | extend type = tolower(type) \r\n        | where selectedPlans has type \r\n    | extend managedClustersCount = iff(type == \"microsoft.containerservice/managedclusters\" and isnotempty(sku) and tolower(sku.tier) != \"consumption\", toint(properties.numberOfWorkers), 0)\r\n    | where tostring(properties.powerState.code) =~ 'Running'\r\n    | mv-expand properties.agentPoolProfiles\r\n    | extend sku = tostring(properties_agentPoolProfiles.vmSize)\r\n    | parse kind=regex sku with '(.*?)_([A-Za-z]*)' coresInSku: int '([A-Za-z]*)_(.*?)'\r\n    | project subscriptionId, resourceGroup, managedClustersCountTotal = toint(properties_agentPoolProfiles['count']) * coresInSku, sku\r\n    | summarize sum(managedClustersCountTotal) by subscriptionId\r\n    | extend sum_appServiceCountTotal = 0, sum_serversCountTotal = 0, sum_storageAccountCountTotal = 0, sum_ossDatabaseCountTotal = 0, sum_cosmosDbCountTotal = 0, sum_sqlServersCountTotal = 0, sum_containerRegistryTotal = 0\r\n    | where sum_managedClustersCountTotal > 0\r\n    | extend Dummy = 1\r\n    ) on  subscriptionId\r\n| union \r\n(\r\n    resources\r\n        | extend selectedPlans = tolower('{plans}')\r\n        | extend serverAndContainersEnabled = selectedPlans has \"microsoft.compute/virtualmachines\" and selectedPlans has \"microsoft.containerservice/managedclusters\"\r\n        | extend type = tolower(type) \r\n        | where selectedPlans has type \r\n        | extend appServiceCount = iff(type == \"microsoft.web/serverfarms\" and isnotempty(sku) and tolower(sku.tier) != \"consumption\", toint(properties.numberOfWorkers), 0)\r\n        | extend vmCount = iff(type in (\"microsoft.compute/virtualmachines\",\"microsoft.hybridcompute/machines\", \"microsoft.classiccompute/virtualmachines\") and (not(serverAndContainersEnabled) or name !startswith(\"aks-\")), 1 , 0)\r\n        | extend vmCountForCspm = iff(type in (\"microsoft.compute/virtualmachines\",\"microsoft.classiccompute/virtualmachines\"), 1 , 0)\r\n        | extend vmssCount = iff(type == \"microsoft.compute/virtualmachinescalesets\" and (not(serverAndContainersEnabled) or name !startswith(\"aks-\")) and sku != \"\" and sku.capacity != \"\", toint(sku.capacity), 0)\r\n        | extend vmssCountForCspm = iff(type == \"microsoft.compute/virtualmachinescalesets\" and sku != \"\" and sku.capacity != \"\", toint(sku.capacity), 0)\r\n        | extend serversCount = vmCount + vmssCount\r\n        | extend storageAccountCount = iff(type == \"microsoft.storage/storageaccounts\", 1 , 0)\r\n        | extend ossDatabaseCount = iff(type in(\"microsoft.dbforpostgresql/servers\", \"microsoft.dbformysql/servers\", \"microsoft.dbformariadb/servers\") and sku.tier !contains(\"basic\"), 1, 0)\r\n        | extend cosmosDbCount = iff(type == \"microsoft.documentdb/databaseaccounts\", 1 , 0)\r\n        | extend sqlServersCount = iff((type =~ \"microsoft.sql/servers\" and kind !contains(\"analytics\")) or type =~ \"microsoft.sql/managedinstances\", 1 , 0)\r\n        | extend synapseServersCount = iff(type =~ \"microsoft.synapse/workspaces \", 1 , 0)\r\n        | extend cspmCount = vmCountForCspm + vmssCountForCspm + storageAccountCount + ossDatabaseCount + sqlServersCount + synapseServersCount \r\n        | extend containerRegistryCount = iff(type == \"microsoft.containerregistry/registries\", 1 , 0)\r\n        | summarize sum(appServiceCount), sum(serversCount),sum(storageAccountCount), sum(containerRegistryCount), sum(ossDatabaseCount), sum(cosmosDbCount), sum(sqlServersCount), sum(cspmCount) by subscriptionId, resourceGroup//, tostring(tags[\"provider\"])\r\n        | where sum_appServiceCount > 0 or sum_serversCount > 0 or sum_storageAccountCount > 0 or sum_ossDatabaseCount > 0 or sum_cosmosDbCount > 0 or sum_sqlServersCount > 0 or sum_containerRegistryCount > 0 or sum_cspmCount > 0 \r\n        | extend sum_managedClustersCount = 0\r\n        | extend Dummy = 1 \r\n    | join  kind=inner \r\n            ( \r\n            resources\r\n            | extend selectedPlans = tolower('{plans}')\r\n            | extend serverAndContainersEnabled = selectedPlans has \"microsoft.compute/virtualmachines\" and selectedPlans has \"microsoft.containerservice/managedclusters\"\r\n            | extend type = tolower(type) \r\n            | where selectedPlans has type \r\n            | extend appServiceCountTotal = iff(type == \"microsoft.web/serverfarms\" and isnotempty(sku) and tolower(sku.tier) != \"consumption\", toint(properties.numberOfWorkers), 0)\r\n            | extend vmCountTotal = iff(type in (\"microsoft.compute/virtualmachines\",\"microsoft.hybridcompute/machines\", \"microsoft.classiccompute/virtualmachines\") and (not(serverAndContainersEnabled) or name !startswith(\"aks-\")), 1 , 0)\r\n            | extend vmCountForCspmTotal = iff(type in (\"microsoft.compute/virtualmachines \", \"microsoft.classiccompute/virtualmachines\"), 1 , 0)\r\n            | extend vmssCountTotal = iff(type == \"microsoft.compute/virtualmachinescalesets\" and (not(serverAndContainersEnabled) or name !startswith(\"aks-\")) and sku != \"\" and sku.capacity != \"\", toint(sku.capacity), 0)\r\n            | extend vmssCountForCspmTotal = iff(type == \"microsoft.compute/virtualmachinescalesets\" and sku != \"\" and sku.capacity != \"\", toint(sku.capacity), 0)\r\n            | extend serversCountTotal = vmCountTotal + vmssCountTotal\r\n            | extend storageAccountCountTotal = iff(type == \"microsoft.storage/storageaccounts\", 1 , 0)\r\n            | extend ossDatabaseCountTotal = iff(type in(\"microsoft.dbforpostgresql/servers\", \"microsoft.dbformysql/servers\", \"microsoft.dbformariadb/servers\") and sku.tier !contains(\"basic\"), 1, 0)\r\n            | extend cosmosDbCountTotal = iff(type == \"microsoft.documentdb/databaseaccounts\", 1 , 0)\r\n            | extend sqlServersCountTotal = iff((type =~ \"microsoft.sql/servers\" and kind !contains(\"analytics\")) or type =~ \"microsoft.sql/managedinstances\", 1 , 0)\r\n            | extend synapseServersCountTotal = iff(type =~ \"microsoft.synapse/workspaces \", 1 , 0)\r\n            | extend cspmCountTotal = vmCountForCspmTotal + vmssCountForCspmTotal + storageAccountCountTotal + ossDatabaseCountTotal + sqlServersCountTotal + synapseServersCountTotal \r\n            | extend containerRegistryTotal = iff(type == \"microsoft.containerregistry/registries\", 1 , 0)\r\n            | summarize sum(serversCountTotal), sum(storageAccountCountTotal), sum(appServiceCountTotal), sum(containerRegistryTotal), sum(ossDatabaseCountTotal), sum(cosmosDbCountTotal), sum(sqlServersCountTotal), sum(cspmCountTotal) by subscriptionId\r\n            | where sum_appServiceCountTotal > 0 or sum_serversCountTotal > 0 or sum_storageAccountCountTotal > 0 or sum_containerRegistryTotal  > 0 or sum_ossDatabaseCountTotal > 0 or sum_cosmosDbCountTotal > 0 or sum_sqlServersCountTotal > 0 or sum_cspmCountTotal > 0\r\n            | extend sum_managedClustersCountTotal = 0\r\n            | extend Dummy = 1\r\n            ) on  subscriptionId\r\n)\r\n| union \r\n(\r\n    resources\r\n    | extend selectedPlans = tolower('{plans}')\r\n    | extend type = tolower(type) \r\n    | where selectedPlans has type \r\n    | extend akvCountCount = iff(type == \"microsoft.keyvault/vaults\", 1 , 0)\r\n    | summarize sum(akvCountCount) by subscriptionId, resourceGroup\r\n    | where sum_akvCountCount > 0\r\n)\r\n| extend ServersRatio = case(sum_serversCountTotal == 0, 0.0, todouble(sum_serversCount) / todouble(sum_serversCountTotal))\r\n| extend AppServicesRatio = case(sum_appServiceCountTotal == 0, 0.0, todouble(sum_appServiceCount) / todouble(sum_appServiceCountTotal))\r\n| extend StorageRatio = case(sum_storageAccountCountTotal == 0, 0.0, todouble(sum_storageAccountCount) / todouble(sum_storageAccountCountTotal))\r\n//| extend ContainerRegistriesRatio = case(sum_containerRegistryTotal == 0, 0.0, todouble(sum_containerRegistryCount) / todouble(sum_containerRegistryTotal))\r\n| extend OpenSourceRelationalDatabasesRatio = case(sum_ossDatabaseCountTotal == 0, 0.0, todouble(sum_ossDatabaseCount) / todouble(sum_ossDatabaseCountTotal))\r\n//| extend CosmosDBsRatio = case(sum_cosmosDbCountTotal == 0, 0.0, todouble(sum_cosmosDbCount) / todouble(sum_cosmosDbCountTotal))\r\n| extend SqlServersRatio = case(sum_sqlServersCountTotal == 0, 0.0, todouble(sum_sqlServersCount) / todouble(sum_sqlServersCountTotal))\r\n| extend ContainersRatio = case(sum_managedClustersCountTotal == 0, 0.0, todouble(sum_managedClustersCount) / todouble(sum_managedClustersCountTotal))\r\n| extend CspmRatio = case(sum_cspmCountTotal == 0, 0.0, todouble(sum_cspmCount) / todouble(sum_cspmCountTotal))\r\n| project \r\n    subscriptionId, resourceGroup,// tags_provider, \r\n    AppServicesInRg = sum_appServiceCount, TotalAppServicesInSub = sum_appServiceCountTotal, AppServicesRatio = round(AppServicesRatio, 4), AppServicesPricing = 15,\r\n    ServersInRg = sum_serversCount, TotalServersInSub = sum_serversCountTotal, ServersRatio = round(ServersRatio, 4), ServersPricingP1 = 5, ServersPricingP2 = 15,\r\n    StorageAccountsInRg = sum_storageAccountCount, TotalStorageAccountsInSub = sum_storageAccountCountTotal, StorageAccountsRatio = round(ServersRatio, 4), StorageAccountsPricing = 10, \r\n    //ContainerRegistriesAccountsInRg = sum_containerRegistryCount, TotalContainerRegistriesInSub = sum_containerRegistryTotal, ContainerRegistriesAccountsPricing = \"$0.29 per image\",//ContainerRegistriesRatio = round(ContainerRegistriesRatio , 4),\r\n    OpenSourceRelationalDatabasesInRg = sum_ossDatabaseCount, TotalOpenSourceRelationalDatabasesInSub = sum_ossDatabaseCountTotal, OpenSourceRelationalDatabasesRatio = round(OpenSourceRelationalDatabasesRatio , 4), OpenSourceRelationalDatabasesPricing = 15,\r\n    CosmosDBsInRg = sum_cosmosDbCount, TotalCosmosDBsInSub = sum_cosmosDbCountTotal, CosmosDBsPricing = \"$0.0012/100RU/s per hour\", //CosmosDBsRatio = round(CosmosDBsRatio , 4),\r\n    SqlServersInRg = sum_sqlServersCount, TotalSqlServersInSub = sum_sqlServersCountTotal, SqlServersRatio = round(SqlServersRatio , 4), SqlServersPricing = 15,\r\n    ContainersInRg = sum_managedClustersCount, TotalContainersInSub = sum_managedClustersCountTotal, ContainersRatio = round(ContainersRatio , 4),ContainersPricing = 7, ContainersDiscountPercentage = 0, ImageScansIncluded = iff(sum_containerRegistryCount > 0, sum_managedClustersCount * 20, 0),\r\n    CspmInRg = sum_cspmCount, TotalCspmInSub = sum_cspmCountTotal, CspmRatio = round(CspmRatio, 4), CspmPricingFull = 5, akvInRg = sum_akvCountCount\r\n| extend \r\n    akvEstimatedPrice = akvInRg * 0.25,\r\n    AppServicesEstimatedPrice = AppServicesPricing * AppServicesInRg,\r\n    ServersEstimatedPrice = ServersInRg ,\r\n    ServersEstimatedPriceP2 = ServersInRg ,\r\n    StorageAccountsEstimatedPrice = StorageAccountsPricing * StorageAccountsInRg,\r\n    OpenSourceRelationalDatabasesEstimatedPrice = iff(tolower('{isOss}') contains \"true\", OpenSourceRelationalDatabasesPricing * OpenSourceRelationalDatabasesInRg, 0),\r\n    SqlServersEstimatedPrice = iff(tolower('{isSql}') contains \"true\", SqlServersPricing * SqlServersInRg,0),\r\n    ContainersEstimatedPrice = ContainersPricing * ContainersInRg,\r\n    CspmEstimatedPriceFull = iff(tolower('{isDcspm}') contains \"true\", CspmPricingFull * CspmInRg, 0)\r\n| summarize CspmEstimatedPriceFull = sum(CspmEstimatedPriceFull), AppServicesEstimatedPrice = sum(AppServicesEstimatedPrice), SqlServersEstimatedPrice = sum(SqlServersEstimatedPrice)\r\n, OpenSourceRelationalDatabasesEstimatedPrice = sum(OpenSourceRelationalDatabasesEstimatedPrice), StorageAccountsEstimatedPrice = iff({isStorage} == 'true',sum(StorageAccountsEstimatedPrice),0),\r\nContainersEstimatedPrice = sum(ContainersEstimatedPrice), CspmInRg = sum(CspmInRg), ContainersInRg = sum(ContainersInRg), SqlServersInRg = sum(SqlServersInRg),OpenSourceRelationalDatabasesInRg = sum(OpenSourceRelationalDatabasesInRg) , StorageAccountsInRg = sum(StorageAccountsInRg),\r\nServersInRg = sum(ServersInRg), AppServicesInRg = sum(AppServicesInRg), AkvInRg = sum(akvInRg), akvEstimatedPrice = sum(akvEstimatedPrice)  by Subscription = subscriptionId\r\n| join kind=fullouter\r\n(\r\n    resourcecontainers\r\n    | where type == \"microsoft.resources/subscriptions\"\r\n    | extend type = tolower(type) \r\n    | extend selectedPlans = tolower('{plans}')\r\n    | where selectedPlans has type \r\n    | project Subscription = subscriptionId, defenderForArmCost = iff(selectedPlans contains type, 5, 0)\r\n) on Subscription\r\n| extend Subscription = iif(isempty(Subscription), Subscription1, Subscription)",
              "size": 1,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "gridSettings": {
                "rowLimit": 10000,
                "filter": true
              },
              "sortBy": []
            },
            "conditionalVisibilities": [
              {
                "parameterName": "plans",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "x",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "istenantlevel",
                "comparison": "isEqualTo",
                "value": "0"
              }
            ],
            "name": "pricing grid"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\",\"mergeType\":\"table\",\"leftTable\":\"pricing grid\"}],\"projectRename\":[{\"originalName\":\"[Added column]\",\"mergedName\":\"Defender CSPM\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"CspmInRg\",\"operator\":\"!=\",\"rightValType\":\"static\",\"rightVal\":\"0\",\"resultValType\":\"column\",\"resultVal\":\"CspmEstimatedPriceFull\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"static\",\"resultVal\":\"0\"}}]},{\"originalName\":\"[pricing grid].Subscription\",\"mergedName\":\"Subscription\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[pricing grid].defenderForArmCost\",\"mergedName\":\"defenderForArmCost\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].akvEstimatedPrice\",\"mergedName\":\"akvEstimatedPrice\",\"fromId\":\"unknown\"},{\"originalName\":\"[Added column]\",\"mergedName\":\"Servers\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"ServersInRg\",\"operator\":\"!=\",\"rightValType\":\"static\",\"rightVal\":\"0\",\"resultValType\":\"expression\",\"resultVal\":\" [\\\"ServersInRg\\\"] * {serversPlanVal} *{isServersSelected}\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"static\",\"resultVal\":\"0\"}}]},{\"originalName\":\"[pricing grid].AppServicesEstimatedPrice\",\"mergedName\":\"App Services\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[pricing grid].SqlServersEstimatedPrice\",\"mergedName\":\"SQL Databases\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[pricing grid].OpenSourceRelationalDatabasesEstimatedPrice\",\"mergedName\":\"OSS DBs\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[pricing grid].StorageAccountsEstimatedPrice\",\"mergedName\":\"Storage\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[pricing grid].ContainersEstimatedPrice\",\"mergedName\":\"Containers\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[pricing grid].ContainersInRg\",\"mergedName\":\"ContainersInRg\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[pricing grid].SqlServersInRg\",\"mergedName\":\"SqlServersInRg\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[pricing grid].OpenSourceRelationalDatabasesInRg\",\"mergedName\":\"OpenSourceRelationalDatabasesInRg\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[pricing grid].StorageAccountsInRg\",\"mergedName\":\"StorageAccountsInRg\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[pricing grid].ServersInRg\",\"mergedName\":\"ServersInRg\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[pricing grid].AppServicesInRg\",\"mergedName\":\"AppServicesInRg\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[Added column]\",\"mergedName\":\"dummy\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"static\",\"resultVal\":\"1\"}}]},{\"originalName\":\"[pricing grid].CspmEstimatedPriceFull\",\"mergedName\":\"CspmEstimatedPriceFull\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].CspmInRg\",\"mergedName\":\"CspmInRg\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].cspmDiscount\",\"mergedName\":\"cspmDiscount\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].subscriptionId\",\"mergedName\":\"subscriptionId\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].resourceGroup\",\"mergedName\":\"resourceGroup\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].TotalAppServicesInSub\",\"mergedName\":\"TotalAppServicesInSub\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].AppServicesRatio\",\"mergedName\":\"AppServicesRatio\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].AppServicesPricing\",\"mergedName\":\"AppServicesPricing\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].TotalServersInSub\",\"mergedName\":\"TotalServersInSub\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].ServersRatio\",\"mergedName\":\"ServersRatio\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].ServersPricingP1\",\"mergedName\":\"ServersPricingP1\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].ServersPricingP2\",\"mergedName\":\"ServersPricingP2\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].TotalStorageAccountsInSub\",\"mergedName\":\"TotalStorageAccountsInSub\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].StorageAccountsRatio\",\"mergedName\":\"StorageAccountsRatio\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].StorageAccountsPricing\",\"mergedName\":\"StorageAccountsPricing\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].TotalOpenSourceRelationalDatabasesInSub\",\"mergedName\":\"TotalOpenSourceRelationalDatabasesInSub\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].OpenSourceRelationalDatabasesRatio\",\"mergedName\":\"OpenSourceRelationalDatabasesRatio\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].OpenSourceRelationalDatabasesPricing\",\"mergedName\":\"OpenSourceRelationalDatabasesPricing\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].CosmosDBsInRg\",\"mergedName\":\"CosmosDBsInRg\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].TotalCosmosDBsInSub\",\"mergedName\":\"TotalCosmosDBsInSub\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].CosmosDBsPricing\",\"mergedName\":\"CosmosDBsPricing\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].TotalSqlServersInSub\",\"mergedName\":\"TotalSqlServersInSub\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].SqlServersRatio\",\"mergedName\":\"SqlServersRatio\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].SqlServersPricing\",\"mergedName\":\"SqlServersPricing\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].TotalContainersInSub\",\"mergedName\":\"TotalContainersInSub\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].ContainersRatio\",\"mergedName\":\"ContainersRatio\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].ContainersPricing\",\"mergedName\":\"ContainersPricing\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].ContainersDiscountPercentage\",\"mergedName\":\"ContainersDiscountPercentage\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].ImageScansIncluded\",\"mergedName\":\"ImageScansIncluded\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].TotalCspmInSub\",\"mergedName\":\"TotalCspmInSub\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].CspmRatio\",\"mergedName\":\"CspmRatio\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].CspmPricingFull\",\"mergedName\":\"CspmPricingFull\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].CspmPricingDiscount5\",\"mergedName\":\"CspmPricingDiscount5\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].CspmPricingDiscount10\",\"mergedName\":\"CspmPricingDiscount10\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].CspmPricingDiscount25\",\"mergedName\":\"CspmPricingDiscount25\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].ServersEstimatedPrice\",\"mergedName\":\"ServersEstimatedPrice\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].ServersEstimatedPriceP2\",\"mergedName\":\"ServersEstimatedPriceP2\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].Column1\",\"mergedName\":\"Column1\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].Subscription1\",\"mergedName\":\"Subscription1\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].Count\",\"mergedName\":\"Count\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].AkvInRg\",\"mergedName\":\"AkvInRg\",\"fromId\":\"unknown\"},{\"originalName\":\"[Added column]\",\"mergedName\":\"Grand total\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"[\\\"Defender CSPM\\\"] + [\\\"defenderForArmCost\\\"]+[\\\"akvEstimatedPrice\\\"]+[\\\"Servers\\\"] +[\\\"App Services\\\"] +[\\\"SQL Databases\\\"] +[\\\"OSS DBs\\\"] +[\\\"Storage\\\"] +[\\\"Containers\\\"]\"}}]}]}",
              "size": 4,
              "title": "Grand total",
              "exportFieldName": "Subscription",
              "exportParameterName": "Subscription",
              "queryType": 7,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "$gen_group",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Defender CSPM",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "text": ""
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0}{1}"
                        }
                      ],
                      "aggregation": "Sum"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "currency": "usd",
                        "style": "currency",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "Subscription",
                    "formatter": 5,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "customColumnWidthSetting": "60ch"
                    }
                  },
                  {
                    "columnMatch": "defenderForArmCost",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "text": ""
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0}{1}"
                        }
                      ],
                      "aggregation": "Sum",
                      "customColumnWidthSetting": "22ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "currency": "usd",
                        "style": "currency",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "akvEstimatedPrice",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "text": ""
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0}{1}"
                        }
                      ],
                      "aggregation": "Sum",
                      "customColumnWidthSetting": "26ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "currency": "usd",
                        "style": "currency",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "Servers",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "text": ""
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0}{1}"
                        }
                      ],
                      "aggregation": "Sum",
                      "customColumnWidthSetting": "21ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "currency": "USD",
                        "style": "currency",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "App Services",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "text": ""
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0}{1}"
                        }
                      ],
                      "aggregation": "Sum",
                      "customColumnWidthSetting": "21ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "currency": "USD",
                        "style": "currency",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "SQL Databases",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "text": ""
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0}{1}"
                        }
                      ],
                      "aggregation": "Sum",
                      "customColumnWidthSetting": "24ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "currency": "USD",
                        "style": "currency",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "OSS DBs",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "text": ""
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0}{1}"
                        }
                      ],
                      "aggregation": "Sum",
                      "customColumnWidthSetting": "24ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "currency": "USD",
                        "style": "currency",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "Storage",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "text": ""
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0}{1}"
                        }
                      ],
                      "aggregation": "Sum",
                      "customColumnWidthSetting": "26ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "currency": "USD",
                        "style": "currency",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "Containers",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "text": ""
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0}{1}"
                        }
                      ],
                      "aggregation": "Sum",
                      "customColumnWidthSetting": "26ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "currency": "USD",
                        "style": "currency",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "ContainersInRg",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "SqlServersInRg",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "OpenSourceRelationalDatabasesInRg",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "StorageAccountsInRg",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "ServersInRg",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "AppServicesInRg",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "dummy",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "CspmEstimatedPriceFull",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "CspmInRg",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "AkvInRg",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Grand total",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "representation": "Subtract",
                          "text": ""
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0}{1}"
                        }
                      ],
                      "aggregation": "Sum",
                      "customColumnWidthSetting": "20ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "currency": "USD",
                        "style": "currency",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "D-CSPM",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "text": ""
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0}{1}"
                        }
                      ],
                      "aggregation": "Sum",
                      "customColumnWidthSetting": "34ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "currency": "usd",
                        "style": "currency",
                        "maximumFractionDigits": 2
                      }
                    }
                  }
                ],
                "rowLimit": 10000,
                "hierarchySettings": {
                  "treeType": 1,
                  "groupBy": [
                    "dummy"
                  ]
                },
                "labelSettings": [
                  {
                    "columnId": "defenderForArmCost",
                    "label": "Defender for ARM"
                  },
                  {
                    "columnId": "akvEstimatedPrice",
                    "label": "Defender for Key Vault"
                  }
                ]
              },
              "sortBy": []
            },
            "conditionalVisibilities": [
              {
                "parameterName": "plans",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "istenantlevel",
                "comparison": "isEqualTo",
                "value": "0"
              }
            ],
            "name": "Grand total",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\",\"mergeType\":\"table\",\"leftTable\":\"pricing grid\"}],\"projectRename\":[{\"originalName\":\"[pricing grid].Subscription\",\"mergedName\":\"Subscription\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[pricing grid].CspmEstimatedPriceFull\",\"mergedName\":\"Defender CSPM\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].defenderForArmCost\",\"mergedName\":\"defenderForArmCost\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].akvEstimatedPrice\",\"mergedName\":\"akvEstimatedPrice\",\"fromId\":\"unknown\"},{\"originalName\":\"[Added column]\",\"mergedName\":\"Servers\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"ServersInRg\",\"operator\":\"!=\",\"rightValType\":\"static\",\"rightVal\":\"0\",\"resultValType\":\"expression\",\"resultVal\":\" [\\\"ServersInRg\\\"] * {serversPlanVal} *{isServersSelected}\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"static\",\"resultVal\":\"0\"}}]},{\"originalName\":\"[pricing grid].ServersInRg\",\"mergedName\":\"ServersInRg\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[pricing grid].AppServicesEstimatedPrice\",\"mergedName\":\"App Services\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[pricing grid].AppServicesInRg\",\"mergedName\":\"AppServicesInRg\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[pricing grid].SqlServersEstimatedPrice\",\"mergedName\":\"SQL Databases\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[pricing grid].SqlServersInRg\",\"mergedName\":\"SqlServersInRg\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[pricing grid].OpenSourceRelationalDatabasesEstimatedPrice\",\"mergedName\":\"OSS DBs\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[pricing grid].OpenSourceRelationalDatabasesInRg\",\"mergedName\":\"OpenSourceRelationalDatabasesInRg\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[pricing grid].StorageAccountsEstimatedPrice\",\"mergedName\":\"Storage\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[pricing grid].StorageAccountsInRg\",\"mergedName\":\"StorageAccountsInRg\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[pricing grid].ContainersEstimatedPrice\",\"mergedName\":\"Containers\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[pricing grid].ContainersInRg\",\"mergedName\":\"ContainersInRg\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[Added column]\",\"mergedName\":\"Total for subscription\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"[\\\"Defender CSPM\\\"] + [\\\"defenderForArmCost\\\"] + [\\\"akvEstimatedPrice\\\"]+[\\\"Servers\\\"] +[\\\"App Services\\\"] +[\\\"SQL Databases\\\"] +[\\\"OSS DBs\\\"] +[\\\"Storage\\\"] +[\\\"Containers\\\"]\"}}]},{\"originalName\":\"[pricing grid].CspmInRg\",\"mergedName\":\"CspmInRg\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].cspmDiscount\",\"mergedName\":\"cspmDiscount\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].subscriptionId\",\"mergedName\":\"subscriptionId\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].resourceGroup\",\"mergedName\":\"resourceGroup\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].TotalAppServicesInSub\",\"mergedName\":\"TotalAppServicesInSub\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].AppServicesRatio\",\"mergedName\":\"AppServicesRatio\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].AppServicesPricing\",\"mergedName\":\"AppServicesPricing\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].TotalServersInSub\",\"mergedName\":\"TotalServersInSub\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].ServersRatio\",\"mergedName\":\"ServersRatio\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].ServersPricingP1\",\"mergedName\":\"ServersPricingP1\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].ServersPricingP2\",\"mergedName\":\"ServersPricingP2\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].TotalStorageAccountsInSub\",\"mergedName\":\"TotalStorageAccountsInSub\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].StorageAccountsRatio\",\"mergedName\":\"StorageAccountsRatio\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].StorageAccountsPricing\",\"mergedName\":\"StorageAccountsPricing\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].TotalOpenSourceRelationalDatabasesInSub\",\"mergedName\":\"TotalOpenSourceRelationalDatabasesInSub\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].OpenSourceRelationalDatabasesRatio\",\"mergedName\":\"OpenSourceRelationalDatabasesRatio\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].OpenSourceRelationalDatabasesPricing\",\"mergedName\":\"OpenSourceRelationalDatabasesPricing\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].CosmosDBsInRg\",\"mergedName\":\"CosmosDBsInRg\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].TotalCosmosDBsInSub\",\"mergedName\":\"TotalCosmosDBsInSub\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].CosmosDBsPricing\",\"mergedName\":\"CosmosDBsPricing\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].TotalSqlServersInSub\",\"mergedName\":\"TotalSqlServersInSub\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].SqlServersRatio\",\"mergedName\":\"SqlServersRatio\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].SqlServersPricing\",\"mergedName\":\"SqlServersPricing\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].TotalContainersInSub\",\"mergedName\":\"TotalContainersInSub\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].ContainersRatio\",\"mergedName\":\"ContainersRatio\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].ContainersPricing\",\"mergedName\":\"ContainersPricing\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].ContainersDiscountPercentage\",\"mergedName\":\"ContainersDiscountPercentage\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].ImageScansIncluded\",\"mergedName\":\"ImageScansIncluded\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].TotalCspmInSub\",\"mergedName\":\"TotalCspmInSub\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].CspmRatio\",\"mergedName\":\"CspmRatio\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].CspmPricingFull\",\"mergedName\":\"CspmPricingFull\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].CspmPricingDiscount5\",\"mergedName\":\"CspmPricingDiscount5\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].CspmPricingDiscount10\",\"mergedName\":\"CspmPricingDiscount10\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].CspmPricingDiscount25\",\"mergedName\":\"CspmPricingDiscount25\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].ServersEstimatedPrice\",\"mergedName\":\"ServersEstimatedPrice\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].ServersEstimatedPriceP2\",\"mergedName\":\"ServersEstimatedPriceP2\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].Column1\",\"mergedName\":\"Column1\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].Count\",\"mergedName\":\"Count\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].AkvInRg\",\"mergedName\":\"AkvInRg\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid].Subscription1\"}]}",
              "size": 2,
              "exportFieldName": "Subscription",
              "exportParameterName": "Subscription",
              "showExportToExcel": true,
              "exportToExcelOptions": "all",
              "queryType": 7,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Subscription",
                    "formatter": 15,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "showIcon": true,
                      "customColumnWidthSetting": "26ch"
                    }
                  },
                  {
                    "columnMatch": "Defender CSPM",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "text": ""
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0} ([\"CspmInRg\"] billable resources)"
                        }
                      ],
                      "customColumnWidthSetting": "33ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "currency": "usd",
                        "style": "currency",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "defenderForArmCost",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "<=",
                          "thresholdValue": "0",
                          "text": ""
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "25ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "currency": "usd",
                        "style": "currency",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "akvEstimatedPrice",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "text": ""
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0} ([\"AkvInRg\"] Key Vaults)"
                        }
                      ],
                      "customColumnWidthSetting": "25ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "currency": "usd",
                        "style": "currency",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "Servers",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "representation": "Blank",
                          "text": ""
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0} ([\"ServersInRg\"] servers)"
                        }
                      ],
                      "customColumnWidthSetting": "25ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "currency": "USD",
                        "style": "currency",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "ServersInRg",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "App Services",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "representation": "Blank",
                          "text": ""
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0} ([\"AppServicesInRg\"] instances)"
                        }
                      ],
                      "customColumnWidthSetting": "25ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "currency": "USD",
                        "style": "currency",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "AppServicesInRg",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "SQL Databases",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "representation": "Blank",
                          "text": ""
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0} ([\"SqlServersInRg\"] SQL Databases)"
                        }
                      ],
                      "customColumnWidthSetting": "26ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "currency": "USD",
                        "style": "currency",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "SqlServersInRg",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "OSS DBs",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "representation": "Blank",
                          "text": ""
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0} ([\"OpenSourceRelationalDatabasesInRg\"] OSS Databases)"
                        }
                      ],
                      "customColumnWidthSetting": "26ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "currency": "USD",
                        "style": "currency",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "OpenSourceRelationalDatabasesInRg",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Storage",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "representation": "Blank",
                          "text": ""
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0} ([\"StorageAccountsInRg\"] storage accounts)"
                        }
                      ],
                      "customColumnWidthSetting": "30ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "currency": "USD",
                        "style": "currency",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "StorageAccountsInRg",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Containers",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "representation": "Blank",
                          "text": ""
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0} ([\"ContainersInRg\"] VM cores)"
                        }
                      ],
                      "customColumnWidthSetting": "38ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "currency": "USD",
                        "style": "currency",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "ContainersInRg",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Total for subscription",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "representation": "Subtract",
                          "text": ""
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0}{1}"
                        }
                      ]
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "currency": "USD",
                        "style": "currency",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "CspmInRg",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "AkvInRg",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "DCSPM",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "text": ""
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0} ([\"CspmInRg\"] biling units)"
                        }
                      ],
                      "customColumnWidthSetting": "32ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "currency": "usd",
                        "style": "currency",
                        "maximumFractionDigits": 2
                      }
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "$gen_thresholds_defenderForArmCost_2",
                    "sortOrder": 2
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "defenderForArmCost",
                    "label": "Defender for ARM"
                  },
                  {
                    "columnId": "akvEstimatedPrice",
                    "label": "Defender for Key Vault"
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "$gen_thresholds_defenderForArmCost_2",
                  "sortOrder": 2
                }
              ]
            },
            "customWidth": "100",
            "conditionalVisibilities": [
              {
                "parameterName": "plans",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "istenantlevel",
                "comparison": "isEqualTo",
                "value": "0"
              }
            ],
            "name": "pricing grid with total hidden"
          }
        ]
      },
      "name": "subscriptionGroup"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "7e75b4e4-c8c8-4800-98da-edef70c49ccb",
                  "version": "KqlParameterItem/1.0",
                  "name": "tenantPlans",
                  "label": "Defenders plan",
                  "type": 2,
                  "description": "Please select one or several plans to allow the workbook to calculate Defender for Cloud cost.",
                  "isRequired": true,
                  "multiSelect": true,
                  "quote": "",
                  "delimiter": ",",
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "showDefault": false
                  },
                  "jsonData": "[\r\n{ \"value\": \"microsoft.compute/virtualmachines, microsoft.compute/virtualmachinescalesets, microsoft.hybridcompute/machines, microsoft.classiccompute/virtualmachines\", \"label\": \"Servers\"},\r\n { \"value\": \"microsoft.web/serverfarms\", \"label\": \"App Services\"},\r\n { \"value\": \"microsoft.sql/servers, microsoft.sql/managedinstances\", \"label\": \"SQL Databases\"},\r\n {\"value\": \"microsoft.dbforpostgresql/servers, microsoft.dbformysql/servers, microsoft.dbformariadb/servers\", \"label\": \"OSS DBs\"},\r\n  { \"value\": \"microsoft.containerservice/managedclusters\", \"label\": \"Containers\"},\r\n  { \"value\": \"microsoft.storage/storageaccounts - storageenabled\", \"label\": \"Storage\"},\r\n  { \"value\": \"microsoft.compute/virtualmachines, microsoft.classiccompute/virtualmachines, microsoft.compute/virtualmachinescalesets, microsoft.sql/servers, microsoft.hybridcompute/machines, microsoft.dbforpostgresql/servers, microsoft.dbformysql/servers, microsoft.sql/managedinstances, microsoft.dbformariadb/servers, Microsoft.synapse/workspaces, microsoft.storage/storageaccounts\", \"label\": \"DefenderCSPM\"},\r\n  {\"value\": \"microsoft.resources/subscriptions\", \"label\": \"Defender for ARM\"},\r\n  {\"value\": \"microsoft.keyvault/vaults\", \"label\": \"Defender for Key Vault\"}\r\n]",
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "value": [
                    "value::all"
                  ]
                },
                {
                  "id": "56dd02c1-e73c-4fc4-a480-1d93165297f8",
                  "version": "KqlParameterItem/1.0",
                  "name": "tenantInfo",
                  "label": "Additional information",
                  "type": 10,
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\r\n { \"value\": 1, \"label\": \"On\", \"selected\": true},\r\n { \"value\": 0, \"label\": \"Off\"}\r\n]"
                },
                {
                  "id": "70a8a248-e441-4601-a0cc-2484930eda44",
                  "version": "KqlParameterItem/1.0",
                  "name": "tenantInfoRes",
                  "type": 1,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "resultValType": "expression",
                        "resultVal": "{tenantInfo}"
                      }
                    }
                  ]
                }
              ],
              "style": "above",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "conditionalVisibility": {
              "parameterName": "istenantlevel",
              "comparison": "isEqualTo",
              "value": "1"
            },
            "name": "Plan Picker"
          },
          {
            "type": 1,
            "content": {
              "json": "* ###### The costs displayed are estimated and might be different from the actual costs seen in the invoice.  \r\n\r\n* ###### The estimated costs displayed are monthly estimated costs per subscription. \r\n\r\n* ###### To estimate the costs for a subscription, you must be assigned with at least Reader role at the subscription level. \r\n\r\n* ###### This workbook displays the cost for Defender for Storage based on a per-storage account calculation, but accounts with an exceptionally high transaction volume incur an overage charge that won’t be seen in this workbook. For more information on Defender for Storage cost estimation calculations, please visit our [GitHub page](https://github.com/Azure/Microsoft-Defender-for-Cloud/tree/main/Workbooks/Microsoft%20Defender%20for%20Storage%20Price%20Estimation).\r\n\r\n* ###### Defender for Cosmos DB plan currently can’t be estimated, we are working to include it in the future.\r\n\r\n* ###### The cost estimation is based on the retail prices of Defender plans; Learn more about [Defender plans’ retail price](https://azure.microsoft.com/pricing/details/defender-for-cloud/).\r\n\r\n* ###### Microsoft Defender CSPM protects across all your multicloud workloads, but billing only applies for Servers, Databases and Storage accounts at $5/billable resource/month. Please visit [Defender CSPM documentation page](https://learn.microsoft.com/en-us/azure/defender-for-cloud/concept-cloud-security-posture-management) for more information.",
              "style": "info"
            },
            "customWidth": "50",
            "conditionalVisibilities": [
              {
                "parameterName": "istenantlevel",
                "comparison": "isEqualTo",
                "value": "1"
              },
              {
                "parameterName": "tenantInfoRes",
                "comparison": "isEqualTo",
                "value": "1"
              }
            ],
            "name": "text - 6 - Copy"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "af54d179-7a17-4c2d-a2c8-b8fe9e6f5ab2",
                  "version": "KqlParameterItem/1.0",
                  "name": "P1P2tenant",
                  "type": 1,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "tenantPlans",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "microsoft.compute/virtualmachines, microsoft.compute/virtualmachinescalesets, microsoft.hybridcompute/machines, microsoft.classiccompute/virtualmachines",
                        "resultValType": "static",
                        "resultVal": "1"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "resultValType": "static",
                        "resultVal": "0"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "conditionalVisibility": {
              "parameterName": "x",
              "comparison": "isNotEqualTo"
            },
            "name": "parameters - 8 - Copy"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "07d3c894-c589-49cd-aabc-26e6deec02ce",
                  "version": "KqlParameterItem/1.0",
                  "name": "serversPlanValTenant",
                  "label": "Servers Plan",
                  "type": 10,
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\r\n { \"value\": 5, \"label\": \"Defender for Servers Plan 1\", \"selected\": true},\r\n { \"value\": 15, \"label\": \"Defender for Servers Plan 2\"}\r\n]",
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "value": "15"
                }
              ],
              "style": "above",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "conditionalVisibilities": [
              {
                "parameterName": "P1P2tenant",
                "comparison": "isEqualTo",
                "value": "1"
              },
              {
                "parameterName": "istenantlevel",
                "comparison": "isEqualTo",
                "value": "1"
              }
            ],
            "name": "serversplanTenant"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "8722131e-5864-4b1b-bfc5-13bdf685ae71",
                  "version": "KqlParameterItem/1.0",
                  "name": "isServersP1",
                  "type": 1,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "P1P2tenant",
                        "operator": "==",
                        "rightValType": "static",
                        "rightVal": "1",
                        "resultValType": "expression",
                        "resultVal": "{serversPlanValTenant} == 5"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "resultValType": "static",
                        "resultVal": "0"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "2fab4bde-3d8c-47c5-8485-871450f3336f",
                  "version": "KqlParameterItem/1.0",
                  "name": "isServersP2",
                  "type": 1,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "P1P2tenant",
                        "operator": "==",
                        "rightValType": "static",
                        "rightVal": "1",
                        "resultValType": "expression",
                        "resultVal": "{serversPlanValTenant} == 15"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "resultValType": "expression",
                        "resultVal": "false"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "a96ccf43-0888-4594-ab51-27c855885067",
                  "version": "KqlParameterItem/1.0",
                  "name": "isStorage",
                  "type": 1,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "tenantPlans",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "microsoft.storage/storageaccounts - storageenabled",
                        "resultValType": "expression",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "resultValType": "expression",
                        "resultVal": "false"
                      }
                    }
                  ]
                },
                {
                  "id": "65f089b8-ee99-4955-b64e-e76349df2223",
                  "version": "KqlParameterItem/1.0",
                  "name": "isDcspm",
                  "type": 1,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "tenantPlans",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "microsoft.compute/virtualmachines, microsoft.classiccompute/virtualmachines, microsoft.compute/virtualmachinescalesets, microsoft.sql/servers, microsoft.hybridcompute/machines, microsoft.dbforpostgresql/servers, microsoft.dbformysql/servers, microsoft.sql/managedinstances, microsoft.dbformariadb/servers, Microsoft.synapse/workspaces, microsoft.storage/storageaccounts",
                        "resultValType": "expression",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "resultValType": "expression",
                        "resultVal": "false"
                      }
                    }
                  ]
                },
                {
                  "id": "12d2c065-d0ef-402e-ac03-c4790d89953d",
                  "version": "KqlParameterItem/1.0",
                  "name": "isOss",
                  "type": 1,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "tenantPlans",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "microsoft.dbforpostgresql/servers, microsoft.dbformysql/servers, microsoft.dbformariadb/servers",
                        "resultValType": "expression",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "resultValType": "expression",
                        "resultVal": "false"
                      }
                    }
                  ]
                },
                {
                  "id": "6cebe002-d524-4257-8ce2-fa034f350055",
                  "version": "KqlParameterItem/1.0",
                  "name": "isSql",
                  "type": 1,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "tenantPlans",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "microsoft.sql/servers, microsoft.sql/managedinstances",
                        "resultValType": "expression",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "resultValType": "expression",
                        "resultVal": "false"
                      }
                    }
                  ]
                },
                {
                  "id": "2fd6f7c1-405f-4091-91f4-470222827e59",
                  "version": "KqlParameterItem/1.0",
                  "name": "isServersSelected",
                  "type": 1,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "tenantPlans",
                        "operator": "contains",
                        "rightValType": "static",
                        "rightVal": "microsoft.compute/virtualmachines, microsoft.compute/virtualmachinescalesets, microsoft.hybridcompute/machines, microsoft.classiccompute/virtualmachines",
                        "resultValType": "expression",
                        "resultVal": "true"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "resultValType": "expression",
                        "resultVal": "false"
                      }
                    }
                  ]
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "conditionalVisibility": {
              "parameterName": "x",
              "comparison": "isNotEqualTo"
            },
            "name": "tenantConditions"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\r\n        | extend selectedPlans = tolower('{tenantPlans}')\r\n        | extend type = tolower(type) \r\n        | where selectedPlans has type \r\n    | extend managedClustersCount = iff(type == \"microsoft.containerservice/managedclusters\" and isnotempty(sku) and tolower(sku.tier) != \"consumption\", toint(properties.numberOfWorkers), 0)\r\n    | where tostring(properties.powerState.code) =~ 'Running'\r\n    | mv-expand properties.agentPoolProfiles\r\n    | extend sku = tostring(properties_agentPoolProfiles.vmSize)\r\n    | parse kind=regex sku with '(.*?)_([A-Za-z]*)' coresInSku: int '([A-Za-z]*)_(.*?)'\r\n    | project subscriptionId, resourceGroup, managedClustersCount = toint(properties_agentPoolProfiles['count']) * coresInSku//, sku\r\n    | summarize sum(managedClustersCount) by subscriptionId, resourceGroup//, tostring(tags[\"provider\"])\r\n    | extend sum_appServiceCount = 0, sum_serversCount = 0, sum_storageAccountCount = 0, sum_ossDatabaseCount = 0, sum_cosmosDbCount = 0, sum_sqlServersCount = 0, sum_containerRegistryCount = 0\r\n    | where sum_managedClustersCount > 0\r\n    | extend Dummy = 1 \r\n| join  kind=inner \r\n    ( \r\n    resources\r\n        | extend selectedPlans = tolower('{tenantPlans}')\r\n        | extend type = tolower(type) \r\n        | where selectedPlans has type \r\n    | extend managedClustersCount = iff(type == \"microsoft.containerservice/managedclusters\" and isnotempty(sku) and tolower(sku.tier) != \"consumption\", toint(properties.numberOfWorkers), 0)\r\n    | where tostring(properties.powerState.code) =~ 'Running'\r\n    | mv-expand properties.agentPoolProfiles\r\n    | extend sku = tostring(properties_agentPoolProfiles.vmSize)\r\n    | parse kind=regex sku with '(.*?)_([A-Za-z]*)' coresInSku: int '([A-Za-z]*)_(.*?)'\r\n    | project subscriptionId, resourceGroup, managedClustersCountTotal = toint(properties_agentPoolProfiles['count']) * coresInSku, sku\r\n    | summarize sum(managedClustersCountTotal) by subscriptionId\r\n    | extend sum_appServiceCountTotal = 0, sum_serversCountTotal = 0, sum_storageAccountCountTotal = 0, sum_ossDatabaseCountTotal = 0, sum_cosmosDbCountTotal = 0, sum_sqlServersCountTotal = 0, sum_containerRegistryTotal = 0\r\n    | where sum_managedClustersCountTotal > 0\r\n    | extend Dummy = 1\r\n    ) on  subscriptionId\r\n| union \r\n(\r\n    resources\r\n        | extend selectedPlans = tolower('{tenantPlans}')\r\n        | extend serverAndContainersEnabled = selectedPlans has \"microsoft.compute/virtualmachines\" and selectedPlans has \"microsoft.containerservice/managedclusters\"\r\n        | extend type = tolower(type) \r\n        | where selectedPlans has type \r\n        | extend appServiceCount = iff(type == \"microsoft.web/serverfarms\" and isnotempty(sku) and tolower(sku.tier) != \"consumption\", toint(properties.numberOfWorkers), 0)\r\n        | extend vmCount = iff(type in (\"microsoft.compute/virtualmachines\",\"microsoft.hybridcompute/machines\", \"microsoft.classiccompute/virtualmachines\") and (not(serverAndContainersEnabled) or name !startswith(\"aks-\")), 1 , 0)\r\n        | extend vmCountForCspm = iff(type in (\"microsoft.compute/virtualmachines\",\"microsoft.classiccompute/virtualmachines\"), 1 , 0)\r\n        | extend vmssCount = iff(type == \"microsoft.compute/virtualmachinescalesets\" and (not(serverAndContainersEnabled) or name !startswith(\"aks-\")) and sku != \"\" and sku.capacity != \"\", toint(sku.capacity), 0)\r\n        | extend vmssCountForCspm = iff(type == \"microsoft.compute/virtualmachinescalesets\" and sku != \"\" and sku.capacity != \"\", toint(sku.capacity), 0)\r\n        | extend serversCount = vmCount + vmssCount\r\n        | extend storageAccountCount = iff(type == \"microsoft.storage/storageaccounts\", 1 , 0)\r\n        | extend ossDatabaseCount = iff(type in(\"microsoft.dbforpostgresql/servers\", \"microsoft.dbformysql/servers\", \"microsoft.dbformariadb/servers\") and sku.tier !contains(\"basic\"), 1, 0)\r\n        | extend cosmosDbCount = iff(type == \"microsoft.documentdb/databaseaccounts\", 1 , 0)\r\n        | extend sqlServersCount = iff((type =~ \"microsoft.sql/servers\" and kind !contains(\"analytics\")) or type =~ \"microsoft.sql/managedinstances\", 1 , 0)\r\n        | extend synapseServersCount = iff(type =~ \"microsoft.synapse/workspaces \", 1 , 0)\r\n        | extend cspmCount = vmCountForCspm + vmssCountForCspm + storageAccountCount + ossDatabaseCount + sqlServersCount + synapseServersCount \r\n        | extend containerRegistryCount = iff(type == \"microsoft.containerregistry/registries\", 1 , 0)\r\n        | summarize sum(appServiceCount), sum(serversCount),sum(storageAccountCount), sum(containerRegistryCount), sum(ossDatabaseCount), sum(cosmosDbCount), sum(sqlServersCount), sum(cspmCount) by subscriptionId, resourceGroup//, tostring(tags[\"provider\"])\r\n        | where sum_appServiceCount > 0 or sum_serversCount > 0 or sum_storageAccountCount > 0 or sum_ossDatabaseCount > 0 or sum_cosmosDbCount > 0 or sum_sqlServersCount > 0 or sum_containerRegistryCount > 0 or sum_cspmCount > 0\r\n        | extend sum_managedClustersCount = 0\r\n        | extend Dummy = 1 \r\n    | join  kind=inner \r\n            ( \r\n            resources\r\n            | extend selectedPlans = tolower('{tenantPlans}')\r\n            | extend serverAndContainersEnabled = selectedPlans has \"microsoft.compute/virtualmachines\" and selectedPlans has \"microsoft.containerservice/managedclusters\"\r\n            | extend type = tolower(type) \r\n            | where selectedPlans has type \r\n            | extend appServiceCountTotal = iff(type == \"microsoft.web/serverfarms\" and isnotempty(sku) and tolower(sku.tier) != \"consumption\", toint(properties.numberOfWorkers), 0)\r\n            | extend vmCountTotal = iff(type in (\"microsoft.compute/virtualmachines\",\"microsoft.hybridcompute/machines\", \"microsoft.classiccompute/virtualmachines\") and (not(serverAndContainersEnabled) or name !startswith(\"aks-\")), 1 , 0)\r\n            | extend vmCountForCspmTotal = iff(type in (\"microsoft.compute/virtualmachines \", \"microsoft.classiccompute/virtualmachines\"), 1 , 0)\r\n            | extend vmssCountTotal = iff(type == \"microsoft.compute/virtualmachinescalesets\" and (not(serverAndContainersEnabled) or name !startswith(\"aks-\")) and sku != \"\" and sku.capacity != \"\", toint(sku.capacity), 0)\r\n            | extend vmssCountForCspmTotal = iff(type == \"microsoft.compute/virtualmachinescalesets\" and sku != \"\" and sku.capacity != \"\", toint(sku.capacity), 0)\r\n            | extend serversCountTotal = vmCountTotal + vmssCountTotal\r\n            | extend storageAccountCountTotal = iff(type == \"microsoft.storage/storageaccounts\", 1 , 0)\r\n            | extend ossDatabaseCountTotal = iff(type in(\"microsoft.dbforpostgresql/servers\", \"microsoft.dbformysql/servers\", \"microsoft.dbformariadb/servers\") and sku.tier !contains(\"basic\"), 1, 0)\r\n            | extend cosmosDbCountTotal = iff(type == \"microsoft.documentdb/databaseaccounts\", 1 , 0)\r\n            | extend sqlServersCountTotal = iff((type =~ \"microsoft.sql/servers\" and kind !contains(\"analytics\")) or type =~ \"microsoft.sql/managedinstances\", 1 , 0)\r\n            | extend synapseServersCountTotal = iff(type =~ \"microsoft.synapse/workspaces \", 1 , 0)\r\n            | extend cspmCountTotal = vmCountForCspmTotal + vmssCountForCspmTotal + storageAccountCountTotal + ossDatabaseCountTotal + sqlServersCountTotal + synapseServersCountTotal \r\n            | extend containerRegistryTotal = iff(type == \"microsoft.containerregistry/registries\", 1 , 0)\r\n            | summarize sum(serversCountTotal), sum(storageAccountCountTotal), sum(appServiceCountTotal), sum(containerRegistryTotal), sum(ossDatabaseCountTotal), sum(cosmosDbCountTotal), sum(sqlServersCountTotal), sum(cspmCountTotal) by subscriptionId\r\n            | where sum_appServiceCountTotal > 0 or sum_serversCountTotal > 0 or sum_storageAccountCountTotal > 0 or sum_containerRegistryTotal  > 0 or sum_ossDatabaseCountTotal > 0 or sum_cosmosDbCountTotal > 0 or sum_sqlServersCountTotal > 0 or sum_cspmCountTotal > 0\r\n            | extend sum_managedClustersCountTotal = 0\r\n            | extend Dummy = 1\r\n            ) on  subscriptionId\r\n)\r\n| union \r\n(\r\n    resources\r\n    | extend selectedPlans = tolower('{tenantPlans}')\r\n    | extend type = tolower(type) \r\n    | where selectedPlans has type \r\n    | extend akvCountCount = iff(type == \"microsoft.keyvault/vaults\", 1 , 0)\r\n    | summarize sum(akvCountCount) by subscriptionId, resourceGroup\r\n    | where sum_akvCountCount > 0\r\n)\r\n| extend ServersRatio = case(sum_serversCountTotal == 0, 0.0, todouble(sum_serversCount) / todouble(sum_serversCountTotal))\r\n| extend AppServicesRatio = case(sum_appServiceCountTotal == 0, 0.0, todouble(sum_appServiceCount) / todouble(sum_appServiceCountTotal))\r\n| extend StorageRatio = case(sum_storageAccountCountTotal == 0, 0.0, todouble(sum_storageAccountCount) / todouble(sum_storageAccountCountTotal))\r\n//| extend ContainerRegistriesRatio = case(sum_containerRegistryTotal == 0, 0.0, todouble(sum_containerRegistryCount) / todouble(sum_containerRegistryTotal))\r\n| extend OpenSourceRelationalDatabasesRatio = case(sum_ossDatabaseCountTotal == 0, 0.0, todouble(sum_ossDatabaseCount) / todouble(sum_ossDatabaseCountTotal))\r\n//| extend CosmosDBsRatio = case(sum_cosmosDbCountTotal == 0, 0.0, todouble(sum_cosmosDbCount) / todouble(sum_cosmosDbCountTotal))\r\n| extend SqlServersRatio = case(sum_sqlServersCountTotal == 0, 0.0, todouble(sum_sqlServersCount) / todouble(sum_sqlServersCountTotal))\r\n| extend ContainersRatio = case(sum_managedClustersCountTotal == 0, 0.0, todouble(sum_managedClustersCount) / todouble(sum_managedClustersCountTotal))\r\n| extend CspmRatio = case(sum_cspmCountTotal == 0, 0.0, todouble(sum_cspmCount) / todouble(sum_cspmCountTotal))\r\n| project \r\n    subscriptionId, resourceGroup,// tags_provider, \r\n    AppServicesInRg = sum_appServiceCount, TotalAppServicesInSub = sum_appServiceCountTotal, AppServicesRatio = round(AppServicesRatio, 4), AppServicesPricing = 15,\r\n    ServersInRg = sum_serversCount, TotalServersInSub = sum_serversCountTotal, ServersRatio = round(ServersRatio, 4), ServersPricingP1 = 5, ServersPricingP2 = 15,\r\n    StorageAccountsInRg = sum_storageAccountCount, TotalStorageAccountsInSub = sum_storageAccountCountTotal, StorageAccountsRatio = round(ServersRatio, 4), StorageAccountsPricing = 10, \r\n    //ContainerRegistriesAccountsInRg = sum_containerRegistryCount, TotalContainerRegistriesInSub = sum_containerRegistryTotal, ContainerRegistriesAccountsPricing = \"$0.29 per image\",//ContainerRegistriesRatio = round(ContainerRegistriesRatio , 4),\r\n    OpenSourceRelationalDatabasesInRg = sum_ossDatabaseCount, TotalOpenSourceRelationalDatabasesInSub = sum_ossDatabaseCountTotal, OpenSourceRelationalDatabasesRatio = round(OpenSourceRelationalDatabasesRatio , 4), OpenSourceRelationalDatabasesPricing = 15,\r\n    CosmosDBsInRg = sum_cosmosDbCount, TotalCosmosDBsInSub = sum_cosmosDbCountTotal, CosmosDBsPricing = \"$0.0012/100RU/s per hour\", //CosmosDBsRatio = round(CosmosDBsRatio , 4),\r\n    SqlServersInRg = sum_sqlServersCount, TotalSqlServersInSub = sum_sqlServersCountTotal, SqlServersRatio = round(SqlServersRatio , 4), SqlServersPricing = 15,\r\n    ContainersInRg = sum_managedClustersCount, TotalContainersInSub = sum_managedClustersCountTotal, ContainersRatio = round(ContainersRatio , 4),ContainersPricing = 7, ContainersDiscountPercentage = 0, ImageScansIncluded = iff(sum_containerRegistryCount > 0, sum_managedClustersCount * 20, 0),\r\n    CspmInRg = sum_cspmCount, TotalCspmInSub = sum_cspmCountTotal, CspmRatio = round(CspmRatio, 4), CspmPricingFull = 5, akvInRg = sum_akvCountCount\r\n| extend \r\n    akvEstimatedPrice = akvInRg * 0.25,\r\n    AppServicesEstimatedPrice = AppServicesPricing * AppServicesInRg,\r\n    ServersEstimatedPrice = ServersInRg ,\r\n    ServersEstimatedPriceP2 = ServersInRg ,\r\n    StorageAccountsEstimatedPrice = StorageAccountsPricing * StorageAccountsInRg,\r\n    OpenSourceRelationalDatabasesEstimatedPrice = iff(tolower('{isOss}') contains \"true\", OpenSourceRelationalDatabasesPricing * OpenSourceRelationalDatabasesInRg, 0),\r\n    SqlServersEstimatedPrice = iff(tolower('{isSql}') contains \"true\", SqlServersPricing * SqlServersInRg,0),\r\n    ContainersEstimatedPrice = ContainersPricing * ContainersInRg,\r\n    CspmEstimatedPriceFull = iff(tolower('{isDcspm}') contains \"true\", CspmPricingFull * CspmInRg, 0)\r\n| summarize CspmEstimatedPriceFull = sum(CspmEstimatedPriceFull), AppServicesEstimatedPrice = sum(AppServicesEstimatedPrice), SqlServersEstimatedPrice = sum(SqlServersEstimatedPrice)\r\n, OpenSourceRelationalDatabasesEstimatedPrice = sum(OpenSourceRelationalDatabasesEstimatedPrice), StorageAccountsEstimatedPrice = iff({isStorage} == 'true',sum(StorageAccountsEstimatedPrice),0),\r\nContainersEstimatedPrice = sum(ContainersEstimatedPrice), CspmInRg = sum(CspmInRg), ContainersInRg = sum(ContainersInRg), SqlServersInRg = sum(SqlServersInRg),OpenSourceRelationalDatabasesInRg = sum(OpenSourceRelationalDatabasesInRg) , StorageAccountsInRg = sum(StorageAccountsInRg),\r\nServersInRg = sum(ServersInRg), AppServicesInRg = sum(AppServicesInRg), AkvInRg = sum(akvInRg), akvEstimatedPrice = sum(akvEstimatedPrice)  by Subscription = subscriptionId\r\n| join kind=fullouter\r\n(\r\n    resourcecontainers\r\n    | where type == \"microsoft.resources/subscriptions\"\r\n    | extend type = tolower(type) \r\n    | extend selectedPlans = tolower('{tenantPlans}')\r\n    | where selectedPlans has type \r\n    | project Subscription = subscriptionId, defenderForArmCost = iff(selectedPlans contains type, 5, 0)\r\n) on Subscription\r\n| extend Subscription = iif(isempty(Subscription), Subscription1, Subscription)\r\n",
              "size": 1,
              "queryType": 1,
              "resourceType": "microsoft.resources/tenants",
              "crossComponentResources": [
                "value::tenant"
              ],
              "gridSettings": {
                "rowLimit": 10000,
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "defenderForArmCost",
                    "sortOrder": 2
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "AppServicesEstimatedPrice",
                    "label": "App Services"
                  },
                  {
                    "columnId": "SqlServersEstimatedPrice",
                    "label": "SQL Databases"
                  },
                  {
                    "columnId": "OpenSourceRelationalDatabasesEstimatedPrice",
                    "label": "OSS DBs"
                  },
                  {
                    "columnId": "StorageAccountsEstimatedPrice",
                    "label": "Storage"
                  },
                  {
                    "columnId": "ContainersEstimatedPrice",
                    "label": "Containers"
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "defenderForArmCost",
                  "sortOrder": 2
                }
              ]
            },
            "conditionalVisibilities": [
              {
                "parameterName": "istenantlevel",
                "comparison": "isEqualTo",
                "value": "1"
              },
              {
                "parameterName": "x",
                "comparison": "isNotEqualTo"
              }
            ],
            "name": "pricing grid - tenant"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\",\"mergeType\":\"table\",\"leftTable\":\"pricing grid - tenant\"}],\"projectRename\":[{\"originalName\":\"[Added column]\",\"mergedName\":\"Defender CSPM\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"CspmInRg\",\"operator\":\"!=\",\"rightValType\":\"static\",\"rightVal\":\"0\",\"resultValType\":\"column\",\"resultVal\":\"CspmEstimatedPriceFull\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"0\"}}]},{\"originalName\":\"[pricing grid - tenant].defenderForArmCost\",\"mergedName\":\"defenderForArmCost\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid - tenant].akvEstimatedPrice\",\"mergedName\":\"akvEstimatedPrice\",\"fromId\":\"unknown\"},{\"originalName\":\"[Added column]\",\"mergedName\":\"Servers\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"ServersInRg\",\"operator\":\"!=\",\"rightValType\":\"static\",\"rightVal\":\"0\",\"resultValType\":\"expression\",\"resultVal\":\" [\\\"ServersInRg\\\"] * {serversPlanValTenant}*{isServersSelected}\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"static\",\"resultVal\":\"0\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"dummy\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"static\",\"resultVal\":\"1\"}}]},{\"originalName\":\"[pricing grid - tenant].Subscription\",\"mergedName\":\"Subscription\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[pricing grid - tenant].AppServicesEstimatedPrice\",\"mergedName\":\"App Services\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[pricing grid - tenant].SqlServersEstimatedPrice\",\"mergedName\":\"SQL Databases\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[pricing grid - tenant].OpenSourceRelationalDatabasesEstimatedPrice\",\"mergedName\":\"OSS DBs\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[pricing grid - tenant].StorageAccountsEstimatedPrice\",\"mergedName\":\"Storage\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[pricing grid - tenant].ContainersEstimatedPrice\",\"mergedName\":\"Containers\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[pricing grid - tenant].ContainersInRg\",\"mergedName\":\"ContainersInRg\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[pricing grid - tenant].SqlServersInRg\",\"mergedName\":\"SqlServersInRg\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[pricing grid - tenant].OpenSourceRelationalDatabasesInRg\",\"mergedName\":\"OpenSourceRelationalDatabasesInRg\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[pricing grid - tenant].StorageAccountsInRg\",\"mergedName\":\"StorageAccountsInRg\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[pricing grid - tenant].ServersInRg\",\"mergedName\":\"ServersInRg\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[pricing grid - tenant].AppServicesInRg\",\"mergedName\":\"AppServicesInRg\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[Added column]\",\"mergedName\":\"Grand total\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"[\\\"Defender CSPM\\\"] + [\\\"defenderForArmCost\\\"] + [\\\"akvEstimatedPrice\\\"]+[\\\"Servers\\\"] +[\\\"App Services\\\"] +[\\\"SQL Databases\\\"] +[\\\"OSS DBs\\\"] +[\\\"Storage\\\"] +[\\\"Containers\\\"]\"}}]},{\"originalName\":\"[pricing grid - tenant].CspmEstimatedPriceFull\",\"mergedName\":\"CspmEstimatedPriceFull\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid - tenant].CspmInRg\",\"mergedName\":\"CspmInRg\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid - tenant].AkvInRg\",\"mergedName\":\"AkvInRg\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid - tenant].Subscription1\",\"mergedName\":\"Subscription1\",\"fromId\":\"unknown\"}]}",
              "size": 4,
              "title": "Grand total",
              "exportFieldName": "Subscription",
              "exportParameterName": "Subscription",
              "queryType": 7,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "$gen_group",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Defender CSPM",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "text": ""
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0}{1}"
                        }
                      ],
                      "aggregation": "Sum",
                      "customColumnWidthSetting": "34ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "currency": "usd",
                        "style": "currency",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "defenderForArmCost",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "text": ""
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0}{1}"
                        }
                      ],
                      "aggregation": "Sum",
                      "customColumnWidthSetting": "22ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "currency": "usd",
                        "style": "currency",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "akvEstimatedPrice",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "text": ""
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0}{1}"
                        }
                      ],
                      "aggregation": "Sum",
                      "customColumnWidthSetting": "26ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "currency": "usd",
                        "style": "currency",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "Servers",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "text": ""
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0}{1}"
                        }
                      ],
                      "aggregation": "Sum",
                      "customColumnWidthSetting": "21ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "currency": "USD",
                        "style": "currency",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "dummy",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Subscription",
                    "formatter": 5,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "customColumnWidthSetting": "60ch"
                    }
                  },
                  {
                    "columnMatch": "App Services",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "text": ""
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0}{1}"
                        }
                      ],
                      "aggregation": "Sum",
                      "customColumnWidthSetting": "21ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "currency": "USD",
                        "style": "currency",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "SQL Databases",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "text": ""
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0}{1}"
                        }
                      ],
                      "aggregation": "Sum",
                      "customColumnWidthSetting": "24ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "currency": "USD",
                        "style": "currency",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "OSS DBs",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "text": ""
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0}{1}"
                        }
                      ],
                      "aggregation": "Sum",
                      "customColumnWidthSetting": "24ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "currency": "USD",
                        "style": "currency",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "Storage",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "text": ""
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0}{1}"
                        }
                      ],
                      "aggregation": "Sum",
                      "customColumnWidthSetting": "26ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "currency": "USD",
                        "style": "currency",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "Containers",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "text": ""
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0}{1}"
                        }
                      ],
                      "aggregation": "Sum",
                      "customColumnWidthSetting": "26ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "currency": "USD",
                        "style": "currency",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "ContainersInRg",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "SqlServersInRg",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "OpenSourceRelationalDatabasesInRg",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "StorageAccountsInRg",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "ServersInRg",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "AppServicesInRg",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Grand total",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "representation": "Subtract",
                          "text": ""
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0}{1}"
                        }
                      ],
                      "aggregation": "Sum",
                      "customColumnWidthSetting": "20ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "currency": "USD",
                        "style": "currency",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "CspmEstimatedPriceFull",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "CspmInRg",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "AkvInRg",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "D-CSPM",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "text": ""
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0}{1}"
                        }
                      ],
                      "aggregation": "Sum",
                      "customColumnWidthSetting": "34ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "currency": "usd",
                        "style": "currency",
                        "maximumFractionDigits": 2
                      }
                    }
                  }
                ],
                "rowLimit": 10000,
                "hierarchySettings": {
                  "treeType": 1,
                  "groupBy": [
                    "dummy"
                  ]
                },
                "labelSettings": [
                  {
                    "columnId": "defenderForArmCost",
                    "label": "Defender for ARM"
                  },
                  {
                    "columnId": "akvEstimatedPrice",
                    "label": "Defender for Key Vault"
                  }
                ]
              },
              "sortBy": []
            },
            "conditionalVisibilities": [
              {
                "parameterName": "tenantPlans",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "istenantlevel",
                "comparison": "isEqualTo",
                "value": "1"
              }
            ],
            "name": "Grand total tenant",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\",\"mergeType\":\"table\",\"leftTable\":\"pricing grid - tenant\"}],\"projectRename\":[{\"originalName\":\"[pricing grid - tenant].Subscription\",\"mergedName\":\"Subscription\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[pricing grid - tenant].CspmEstimatedPriceFull\",\"mergedName\":\"Defender CSPM\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid - tenant].defenderForArmCost\",\"mergedName\":\"defenderForArmCost\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid - tenant].akvEstimatedPrice\",\"mergedName\":\"akvEstimatedPrice\",\"fromId\":\"unknown\"},{\"originalName\":\"[Added column]\",\"mergedName\":\"Servers\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"ServersInRg\",\"operator\":\"!=\",\"rightValType\":\"static\",\"rightVal\":\"0\",\"resultValType\":\"expression\",\"resultVal\":\" [\\\"ServersInRg\\\"] * {serversPlanValTenant} *{isServersSelected}\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"static\",\"resultVal\":\"0\"}}]},{\"originalName\":\"[pricing grid - tenant].ServersInRg\",\"mergedName\":\"ServersInRg\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[pricing grid - tenant].AppServicesEstimatedPrice\",\"mergedName\":\"App Services\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[pricing grid - tenant].AppServicesInRg\",\"mergedName\":\"AppServicesInRg\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[pricing grid - tenant].SqlServersEstimatedPrice\",\"mergedName\":\"SQL Databases\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[pricing grid - tenant].SqlServersInRg\",\"mergedName\":\"SqlServersInRg\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[pricing grid - tenant].OpenSourceRelationalDatabasesEstimatedPrice\",\"mergedName\":\"OSS DBs\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[pricing grid - tenant].OpenSourceRelationalDatabasesInRg\",\"mergedName\":\"OpenSourceRelationalDatabasesInRg\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[pricing grid - tenant].StorageAccountsEstimatedPrice\",\"mergedName\":\"Storage\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[pricing grid - tenant].StorageAccountsInRg\",\"mergedName\":\"StorageAccountsInRg\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[pricing grid - tenant].ContainersEstimatedPrice\",\"mergedName\":\"Containers\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[pricing grid - tenant].ContainersInRg\",\"mergedName\":\"ContainersInRg\",\"fromId\":\"10276fd5-4d9f-419d-9064-863d1e3810f2\"},{\"originalName\":\"[Added column]\",\"mergedName\":\"Total for subscription\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"[\\\"Defender CSPM\\\"]+ [\\\"defenderForArmCost\\\"] + [\\\"akvEstimatedPrice\\\"]+[\\\"Servers\\\"] +[\\\"App Services\\\"] +[\\\"SQL Databases\\\"] +[\\\"OSS DBs\\\"] +[\\\"Storage\\\"] +[\\\"Containers\\\"]\"}}]},{\"originalName\":\"[pricing grid - tenant].CspmInRg\",\"mergedName\":\"CspmInRg\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid - tenant].AkvInRg\",\"mergedName\":\"AkvInRg\",\"fromId\":\"unknown\"},{\"originalName\":\"[pricing grid - tenant].Subscription1\"}]}",
              "size": 2,
              "showExportToExcel": true,
              "exportToExcelOptions": "all",
              "queryType": 7,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Subscription",
                    "formatter": 15,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "showIcon": true,
                      "customColumnWidthSetting": "30ch"
                    }
                  },
                  {
                    "columnMatch": "Defender CSPM",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "text": ""
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0} ([\"CspmInRg\"] billable resources)"
                        }
                      ],
                      "customColumnWidthSetting": "27ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "currency": "usd",
                        "style": "currency",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "defenderForArmCost",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "text": ""
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "26ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "currency": "usd",
                        "style": "currency",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "akvEstimatedPrice",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "text": ""
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0} ([\"AkvInRg\"] Key Vaults)"
                        }
                      ],
                      "customColumnWidthSetting": "26ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "currency": "usd",
                        "style": "currency",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "Servers",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "representation": "Blank",
                          "text": ""
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0} ([\"ServersInRg\"] servers)"
                        }
                      ],
                      "customColumnWidthSetting": "26ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "currency": "USD",
                        "style": "currency",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "ServersInRg",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "App Services",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "representation": "Blank",
                          "text": ""
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0} ([\"AppServicesInRg\"] instances)"
                        }
                      ],
                      "customColumnWidthSetting": "26ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "currency": "USD",
                        "style": "currency",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "AppServicesInRg",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "SQL Databases",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "representation": "Blank",
                          "text": ""
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0} ([\"SqlServersInRg\"] SQL Databases)"
                        }
                      ],
                      "customColumnWidthSetting": "30ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "currency": "USD",
                        "style": "currency",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "SqlServersInRg",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "OSS DBs",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "representation": "Blank",
                          "text": ""
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0} ([\"OpenSourceRelationalDatabasesInRg\"] OSS Databases)"
                        }
                      ],
                      "customColumnWidthSetting": "30ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "currency": "USD",
                        "style": "currency",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "OpenSourceRelationalDatabasesInRg",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Storage",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "representation": "Blank",
                          "text": ""
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0} ([\"StorageAccountsInRg\"] storage accounts)"
                        }
                      ],
                      "customColumnWidthSetting": "30ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "currency": "USD",
                        "style": "currency",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "StorageAccountsInRg",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Containers",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "representation": "Blank",
                          "text": ""
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0} ([\"ContainersInRg\"] VM cores)"
                        }
                      ],
                      "customColumnWidthSetting": "30ch"
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "currency": "USD",
                        "style": "currency",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "ContainersInRg",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Total for subscription",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "representation": "Subtract",
                          "text": ""
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0}{1}"
                        }
                      ]
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "currency": "USD",
                        "style": "currency",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "CspmInRg",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "AkvInRg",
                    "formatter": 5
                  }
                ],
                "rowLimit": 10000,
                "filter": true,
                "labelSettings": [
                  {
                    "columnId": "defenderForArmCost",
                    "label": "Defender for ARM"
                  },
                  {
                    "columnId": "akvEstimatedPrice",
                    "label": "Defender for Key Vault"
                  },
                  {
                    "columnId": "ServersInRg",
                    "label": "#Servers"
                  },
                  {
                    "columnId": "AppServicesInRg",
                    "label": "#Instances"
                  },
                  {
                    "columnId": "SqlServersInRg",
                    "label": "#SQLDatabases"
                  },
                  {
                    "columnId": "OpenSourceRelationalDatabasesInRg",
                    "label": "#OSSDatabases"
                  },
                  {
                    "columnId": "StorageAccountsInRg",
                    "label": "#StorageAccounts"
                  },
                  {
                    "columnId": "ContainersInRg",
                    "label": "#VMcores"
                  }
                ]
              },
              "sortBy": []
            },
            "conditionalVisibilities": [
              {
                "parameterName": "tenantPlans",
                "comparison": "isNotEqualTo"
              },
              {
                "parameterName": "istenantlevel",
                "comparison": "isEqualTo",
                "value": "1"
              }
            ],
            "name": "pricing grid with total - tenant"
          }
        ]
      },
      "name": "tenantGroup"
    }
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}