{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "2ace3f26-4030-490f-a8b2-1e3b87b6d9e9",
            "version": "KqlParameterItem/1.0",
            "name": "Workspace",
            "type": 5,
            "description": "Select at least one workspace that contains continuous export data based on the selected subscriptions",
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "resources\r\n| where type =~ 'microsoft.operationalinsights/workspaces'\r\n| project id",
            "crossComponentResources": [
              "value::all"
            ],
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "value": [
            ]
          },
          {
            "id": "72b64611-41db-4766-832b-3b5f17f1b296",
            "version": "KqlParameterItem/1.0",
            "name": "TimeRange",
            "label": "Time Range",
            "type": 4,
            "description": "Filter the data of this report to one of these predefined time ranges",
            "isRequired": true,
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 259200000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 1209600000
                },
                {
                  "durationMs": 2419200000
                },
                {
                  "durationMs": 2592000000
                }
              ],
              "allowCustom": true
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "value": {
              "durationMs": 2592000000
            }
          },
          {
            "id": "36ef1547-64ad-46ed-9244-7c0afdf22bbe",
            "version": "KqlParameterItem/1.0",
            "name": "ErrorHandle",
            "type": 1,
            "query": "let MissingTable = view () { print isMissing=1 };\r\nunion isfuzzy=true MissingTable, (SecureScores | getschema | summarize c=count() | project isMissing=iff(c > 0, 0, 1))\r\n| top 1 by isMissing asc",
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 0,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "372fb7aa-8c01-4ac9-9f39-1da6b087875f",
            "version": "KqlParameterItem/1.0",
            "name": "info",
            "label": "Additional information",
            "type": 10,
            "description": "Select to display information about this wotkbook and its parts",
            "isRequired": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[\r\n { \"value\": \"On\", \"label\": \"On\"},\r\n { \"value\": \"Off\", \"label\": \"Off\"}\r\n]",
            "value": "Off"
          }
        ],
        "style": "above",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "parameters"
    },
    {
      "type": 1,
      "content": {
        "json": "How to configure this workbook\r\n\r\nTo use this Attack Path Over Time workbook, you'll need to configure **continuous export** to export data to a Log Analytics workspace:\r\n1. From Defender for Cloud sidebar, select **Environment settings**.\r\n2. Select the specific subscription for which you want to configure the data export.\r\n3. From the sidebar of the settings page for that subscription, select **Continuous export**.\r\n4. Set the export target to **Log Analytics workspace**.\r\n5. Select the following data type: **Security attack paths** with **All risk levels selected**.\r\n6. From the export frequency options, select **Streaming updates** and **Snapshots**.\r\n7. From export configuration, select the Azure Resource Group where the export configuration will be stored. \r\n8. From export target, select the Azure Subscription and the target Log Analytics workspace.\r\n9. Select **Save**.\r\n\r\n[Learn more](https://docs.microsoft.com/en-us/azure/defender-for-cloud/continuous-export?tabs=azure-portal#set-up-a-continuous-export)\r\n\r\n> **Notes**\r\n* To get full visibility, wait at least one week for the first snapshot to be exported.\r\n* To configure continuous export across your organization, use the supplied Azure Policy 'DeployIfNotExist' policies described [here](https://docs.microsoft.com/en-us/azure/defender-for-cloud/continuous-export?tabs=azure-policy#set-up-a-continuous-export).",
        "style": "info"
      },
      "name": "title"
    },
    {
      "type": 1,
      "content": {
        "json": "<div style=\"font-size: medium; padding-left: 5px;\">\r\nThis Workbook offers a view into the dynamics of attack paths over time within your organization's environments managed by Defender for Cloud. Its designed layout provides an array of insights, ranging from the distribution of latest versus previous attack paths, risk level trends over time, to the analysis of attack vectors by risk factors, targeted resources, and entry points. Additionally, the dashboard delves into strategic assessments through the distribution of Mitre Tactics, Techniques, and Procedures (TTPs), enabling security teams to tailor their defenses against prevalent attack methodologies. With features such as the visualization of active versus resolved attack paths and the integration of the Mean Time to Remediation (MTTR) metric, the dashboard underscores the effectiveness and urgency of the response mechanisms in place.\r\n</div>\r\n\r\n## Release notes\r\n\r\n|Version|Description|Date|\r\n|---|---|---|\r\n| v1.0 | initial release | April 1, 2024 |\r\n"
      },
      "conditionalVisibility": {
        "parameterName": "info",
        "comparison": "isEqualTo",
        "value": "On"
      },
      "name": "info-text-a"
    },
    {
      "type": 1,
      "content": {
        "json": " <div style=\"font-size: medium; padding-left: 5px;\">\r\n <ol>\r\n <li>\r\n**Latest vs. Previous Attack Path Distribution**<br>\r\n   **Content**: This section differentiates between newly identified attack paths and those that have been observed previously.<br>\r\n   **Interpretation**: A higher number of latest attack paths may indicate an uptick in attacker activity or the emergence of new threats. Prioritize these for immediate investigation to prevent potential breaches.<br><br>\r\n</li>\r\n<li>\r\n**Risk Level Distribution Over Time** <br>\r\n   **Content**: Visualizes how attack paths fluctuate across critical, high, and medium risk levels over time.<br>\r\n   **Interpretation**: Trends in this visualization can help you assess the effectiveness of your security measures. A decrease in high-risk paths over time might suggest successful mitigation efforts, whereas an increase could signal the need for strategy adjustments.\r\n</li>\r\n</ol>\r\n</div>"
      },
      "conditionalVisibility": {
        "parameterName": "info",
        "comparison": "isEqualTo",
        "value": "On"
      },
      "name": "info-text-b"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "SecurityAttackPathData\r\n| extend Category = iff(TimeGenerated >= ago(1d), \"Latest Attack Paths\", \"Previous Attack Paths\")\r\n| summarize Count = dcount(AttackPathId) by Category",
        "size": 1,
        "title": "Attack Path - Ditribution of the Attack (Previous vs Latest)",
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "piechart",
        "chartSettings": {
          "seriesLabelSettings": [
            {
              "seriesName": "Previous Attack Paths",
              "color": "blue"
            },
            {
              "seriesName": "Latest Attack Paths",
              "color": "green"
            }
          ]
        }
      },
      "customWidth": "30",
      "name": "ap-previous-latest"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "SecurityAttackPathData\r\n| summarize DailyUniqueAttackPaths = dcount(AttackPathId) by bin(TimeGenerated, 1d), RiskLevel\r\n| summarize Count=max(DailyUniqueAttackPaths) by bin(TimeGenerated, 1d), RiskLevel\r\n| order by TimeGenerated asc",
        "size": 1,
        "title": "Attack Path - Ditribution of the Attack x Risk Level Over Time",
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "barchart",
        "chartSettings": {
          "showMetrics": false,
          "showLegend": true,
          "seriesLabelSettings": [
            {
              "seriesName": "High",
              "color": "orangeDark"
            },
            {
              "seriesName": "Critical",
              "color": "redBright"
            },
            {
              "seriesName": "Medium",
              "color": "orange"
            }
          ]
        }
      },
      "customWidth": "70",
      "name": "ap-by-risk-over-time"
    },
    {
      "type": 1,
      "content": {
        "json": " <div style=\"font-size: medium; padding-left: 5px;\">\r\n**Overall Number of Attack Paths Over Time**<br>\r\n   **Content**: Provides a chronological tally of all detected attack paths.<br>\r\n   **Interpretation**: Identifying patterns, peaks, or troughs in attack frequency can help anticipate potential threats and adjust defenses accordingly.<br>\r\n</div>"
      },
      "conditionalVisibility": {
        "parameterName": "info",
        "comparison": "isEqualTo",
        "value": "On"
      },
      "name": "info-text-c"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "SecurityAttackPathData\r\n| extend Date = format_datetime(TimeGenerated, 'yyyy-MM-dd') // Extract date in YYYY-MM-DD format for daily aggregation\r\n| summarize UniqueAttackPaths=dcount(AttackPathId) by Date\r\n| order by Date asc",
        "size": 0,
        "title": "Attack Path - Ditribution of the Attack Over Time",
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "timechart",
        "chartSettings": {
          "group": null,
          "createOtherGroup": 0,
          "showMetrics": false,
          "showLegend": true,
          "seriesLabelSettings": [
            {
              "seriesName": "UniqueAttackPaths",
              "label": "Attack Paths",
              "color": "redBright"
            }
          ]
        }
      },
      "name": "ap-over-time"
    },
    {
      "type": 1,
      "content": {
        "json": " <div style=\"font-size: medium; padding-left: 5px;\">\r\n**Active vs. Resolved Attack Paths**<br>\r\n   **Content**: Categorizes attack paths as active or resolved, including their duration and whether they are newly identified.<br>\r\n   **Interpretation**: The ratio of active to resolved paths and the introduction of MTTR metrics offer insights into the response efficiency. A high number of active paths or a long MTTR might indicate bottlenecks in the resolution process.<br>\r\n</div>"
      },
      "conditionalVisibility": {
        "parameterName": "info",
        "comparison": "isEqualTo",
        "value": "On"
      },
      "name": "info-text-d"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "SecurityAttackPathData\r\n| where TimeGenerated >= {TimeRange:start} and TimeGenerated < {TimeRange:end}\r\n| extend AttackPathActualId = tostring(split(AttackPathId, \"/attackPaths/\")[1])\r\n| summarize FirstSeen=min(TimeGenerated), LastActive=max(TimeGenerated) by AttackPathActualId, DisplayName, RiskLevel\r\n| extend ActiveDurationDays = datetime_diff('day', LastActive, FirstSeen) + 1\r\n// For IsResolved, comparing LastActive with the start of the day before {TimeRange:end}\r\n| extend LastFullDay = startofday(datetime_add('day', -1, {TimeRange:end}))\r\n| extend IsResolved = iff(LastActive < LastFullDay, \"Yes\", \"No\")\r\n// For IsNew, checking if FirstSeen is within the last day of the selected range\r\n| extend IsNew = iff(FirstSeen >= startofday(datetime_add('day', -1, {TimeRange:end})), \"Yes\", \"No\")\r\n// Introducing color based on ActiveDurationDays and IsResolved\r\n| extend AttentionLevel = case(\r\n    ActiveDurationDays >= 20 and IsResolved == \"No\", \"Critical\",\r\n    ActiveDurationDays >= 15 and IsResolved == \"No\", \"High\",\r\n    ActiveDurationDays >= 5 and IsResolved == \"No\", \"Medium\",\r\n    ActiveDurationDays < 5 and IsResolved == \"No\", \"Low\",\r\n    \"Remediated\" // Fallback color condition\r\n)\r\n| project AttackPathActualId, DisplayName, RiskLevel, FirstSeen, LastActive, ActiveDurationDays, IsResolved,  AttentionLevel, IsNew\r\n| order by FirstSeen asc\r\n\r\n",
        "size": 2,
        "title": "Attack Path - MTTR - Active vs Resolved",
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "table",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "AttackPathActualId",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "25ch"
              }
            },
            {
              "columnMatch": "RiskLevel",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "contains",
                    "thresholdValue": "High",
                    "representation": "Sev1",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "Critical",
                    "representation": "Sev0",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "Medium",
                    "representation": "Sev2",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "Sev3",
                    "text": "{0}{1}"
                  }
                ]
              }
            },
            {
              "columnMatch": "IsResolved",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "contains",
                    "thresholdValue": "No",
                    "representation": "error",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "success",
                    "text": "{0}{1}"
                  }
                ]
              }
            },
            {
              "columnMatch": "AttentionLevel",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": "contains",
                    "thresholdValue": "Low",
                    "representation": "yellow",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "Critical",
                    "representation": "redBright",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "Medium",
                    "representation": "orange",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "High",
                    "representation": "orangeDark",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "green",
                    "text": "{0}{1}"
                  }
                ]
              }
            },
            {
              "columnMatch": "IsNew",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "contains",
                    "thresholdValue": "Yes",
                    "representation": "up",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "right",
                    "text": "{0}{1}"
                  }
                ]
              }
            }
          ],
          "labelSettings": [
            {
              "columnId": "AttackPathActualId",
              "label": "Attack Path Id"
            },
            {
              "columnId": "DisplayName",
              "label": "Attack Path Name"
            },
            {
              "columnId": "RiskLevel",
              "label": "Risk Level"
            },
            {
              "columnId": "FirstSeen",
              "label": "First Seen"
            },
            {
              "columnId": "LastActive",
              "label": "Last Active"
            },
            {
              "columnId": "ActiveDurationDays",
              "label": "Active Days"
            },
            {
              "columnId": "IsResolved",
              "label": "Resolved"
            },
            {
              "columnId": "AttentionLevel",
              "label": "Attention Level"
            },
            {
              "columnId": "IsNew",
              "label": "New"
            }
          ]
        }
      },
      "name": "ap-mttr-grid - Copy"
    },
    {
      "type": 1,
      "content": {
        "json": "<div style=\"font-size: medium; padding-left: 5px;\">\r\n<strong>Advanced Metrics</strong><br>\r\n   Beyond the basic insights, understanding Percentiles for Time to Remediation, Count of Attack Paths by Remediation Time Brackets, and MTTR adds depth to your security analysis:<br><br>\r\n <ol>\r\n<li>\r\n<strong>Percentiles for Time to Remediation</strong><br>\r\n   50th and 90th Percentiles: Show remediation time distribution. A lower 50th percentile indicates quick median response times, while a high 90th percentile points to potential bottlenecks in resolving security vulnerabilities.<br><br>\r\n</li>\r\n<li>\r\n<strong>Count of Attack Paths by Remediation Time Brackets</strong><br>\r\n   Time Bracket Analysis: High counts in shorter brackets suggest effective response efforts, whereas significant counts in longer brackets highlight areas needing improvement.<br><br>\r\n</li>\r\n<li>\r\n<strong>Mean Time to Remediation (MTTR)</strong><br>\r\n   Average Remediation Time: A crucial metric indicating the overall efficiency of incident resolution processes. Lower MTTR values suggest prompt remediation, whereas higher values may indicate inefficiencies.\r\n</li>\r\n</ol>\r\n</div>"
      },
      "conditionalVisibility": {
        "parameterName": "info",
        "comparison": "isEqualTo",
        "value": "On"
      },
      "name": "info-text-e"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "SecurityAttackPathData\r\n| where TimeGenerated >= {TimeRange:start} and TimeGenerated < {TimeRange:end}\r\n| extend AttackPathActualId = tostring(split(AttackPathId, \"/attackPaths/\")[1])\r\n| summarize FirstSeen=min(TimeGenerated), LastActive=max(TimeGenerated) by AttackPathActualId, DisplayName, RiskLevel\r\n| extend RemediationTimeDays = datetime_diff('day', LastActive, FirstSeen) + 1\r\n| extend LastFullDay = startofday(datetime_add('day', -1, {TimeRange:end}))\r\n| where LastActive < LastFullDay // Focus on resolved attack paths\r\n| summarize TotalRemediationTimeDays = sum(RemediationTimeDays), CountResolved = count() \r\n| extend MTTR = TotalRemediationTimeDays / CountResolved\r\n| project MTTR\r\n\r\n",
        "size": 4,
        "title": "Attack Path - MTTR - Score: MTTR provides the average time taken to remediate resolved attack paths within the selected timeframe. How to Interpret:      A lower MTTR indicates an overall efficient and quick remediation process, suggesting that, on average, security incidents are being resolved promptly.     A higher MTTR might point to potential inefficiencies in the remediation process, possibly due to complex incidents requiring more time, a lack of resources, or other procedural delays.",
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "table",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "AttackPathActualId",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "25ch"
              }
            },
            {
              "columnMatch": "RiskLevel",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "contains",
                    "thresholdValue": "High",
                    "representation": "Sev1",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "Critical",
                    "representation": "Sev0",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "Medium",
                    "representation": "Sev2",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "Sev3",
                    "text": "{0}{1}"
                  }
                ]
              }
            },
            {
              "columnMatch": "IsResolved",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "contains",
                    "thresholdValue": "No",
                    "representation": "error",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "success",
                    "text": "{0}{1}"
                  }
                ]
              }
            },
            {
              "columnMatch": "AttentionLevel",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": "contains",
                    "thresholdValue": "Low",
                    "representation": "yellow",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "Critical",
                    "representation": "redBright",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "Medium",
                    "representation": "orange",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "High",
                    "representation": "orangeDark",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "green",
                    "text": "{0}{1}"
                  }
                ]
              }
            },
            {
              "columnMatch": "IsNew",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "contains",
                    "thresholdValue": "Yes",
                    "representation": "up",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "right",
                    "text": "{0}{1}"
                  }
                ]
              }
            }
          ]
        }
      },
      "customWidth": "33",
      "name": "ap-mttr-score"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "SecurityAttackPathData\r\n| where TimeGenerated >= {TimeRange:start} and TimeGenerated < {TimeRange:end}\r\n| extend AttackPathActualId = tostring(split(AttackPathId, \"/attackPaths/\")[1])\r\n| summarize FirstSeen=min(TimeGenerated), LastActive=max(TimeGenerated) by AttackPathActualId, DisplayName\r\n| extend RemediationTimeDays = datetime_diff('day', LastActive, FirstSeen) + 1\r\n| extend LastFullDay = startofday(datetime_add('day', -1, {TimeRange:end}))\r\n| where LastActive < LastFullDay // Considering only resolved paths\r\n| summarize Percentile50=percentile(RemediationTimeDays, 50), Percentile90=percentile(RemediationTimeDays, 90)\r\n",
        "size": 4,
        "title": "Attack Path - MTTR - Percentiles: Percentiles, such as the 50th (median) and 90th, show the distribution of remediation times across all resolved attack paths. The 50th percentile (median) indicates that half of the attack paths were remediated within this time frame, while the 90th percentile shows the time within which 90% of attack paths were resolved, providing insight into the longer-tail of remediation efforts.",
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "table",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "AttackPathActualId",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "25ch"
              }
            },
            {
              "columnMatch": "RiskLevel",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "contains",
                    "thresholdValue": "High",
                    "representation": "Sev1",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "Critical",
                    "representation": "Sev0",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "Medium",
                    "representation": "Sev2",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "Sev3",
                    "text": "{0}{1}"
                  }
                ]
              }
            },
            {
              "columnMatch": "IsResolved",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "contains",
                    "thresholdValue": "No",
                    "representation": "error",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "success",
                    "text": "{0}{1}"
                  }
                ]
              }
            },
            {
              "columnMatch": "AttentionLevel",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": "contains",
                    "thresholdValue": "Low",
                    "representation": "yellow",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "Critical",
                    "representation": "redBright",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "Medium",
                    "representation": "orange",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "High",
                    "representation": "orangeDark",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "green",
                    "text": "{0}{1}"
                  }
                ]
              }
            },
            {
              "columnMatch": "IsNew",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "contains",
                    "thresholdValue": "Yes",
                    "representation": "up",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "right",
                    "text": "{0}{1}"
                  }
                ]
              }
            }
          ]
        }
      },
      "customWidth": "33",
      "name": "ap-mttr-percentiles"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "SecurityAttackPathData\r\n| where TimeGenerated >= {TimeRange:start} and TimeGenerated < {TimeRange:end}\r\n| extend AttackPathActualId = tostring(split(AttackPathId, \"/attackPaths/\")[1])\r\n| summarize FirstSeen=min(TimeGenerated), LastActive=max(TimeGenerated) by AttackPathActualId, DisplayName\r\n| extend RemediationTimeDays = datetime_diff('day', LastActive, FirstSeen) + 1\r\n| extend LastFullDay = startofday(datetime_add('day', -1, {TimeRange:end}))\r\n| where LastActive < LastFullDay // Considering only resolved paths\r\n| extend TimeBracket = case(\r\n    RemediationTimeDays <= 7, \"0-7 days\",\r\n    RemediationTimeDays > 7 and RemediationTimeDays <= 30, \"8-30 days\",\r\n    RemediationTimeDays > 30 and RemediationTimeDays <= 60, \"31-60 days\",\r\n    \"Over 60 days\"\r\n)\r\n| summarize Count = count() by TimeBracket\r\n| order by TimeBracket\r\n",
        "size": 4,
        "title": "Attack Path - MTTR -Remediation Time Brackets: This metric segments resolved attack paths into time brackets (e.g., 0-7 days, 8-30 days) and counts how many fall into each bracket.     High counts in shorter brackets (e.g., 0-7 days) are indicative of a fast and effective response for many incidents.     Substantial counts in longer brackets signal areas where improvements may be needed, as these represent delays in addressing certain types of attack paths.",
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "table",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "AttackPathActualId",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "25ch"
              }
            },
            {
              "columnMatch": "RiskLevel",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "contains",
                    "thresholdValue": "High",
                    "representation": "Sev1",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "Critical",
                    "representation": "Sev0",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "Medium",
                    "representation": "Sev2",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "Sev3",
                    "text": "{0}{1}"
                  }
                ]
              }
            },
            {
              "columnMatch": "IsResolved",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "contains",
                    "thresholdValue": "No",
                    "representation": "error",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "success",
                    "text": "{0}{1}"
                  }
                ]
              }
            },
            {
              "columnMatch": "AttentionLevel",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": "contains",
                    "thresholdValue": "Low",
                    "representation": "yellow",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "Critical",
                    "representation": "redBright",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "Medium",
                    "representation": "orange",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "High",
                    "representation": "orangeDark",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "green",
                    "text": "{0}{1}"
                  }
                ]
              }
            },
            {
              "columnMatch": "IsNew",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "contains",
                    "thresholdValue": "Yes",
                    "representation": "up",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "right",
                    "text": "{0}{1}"
                  }
                ]
              }
            }
          ],
          "labelSettings": [
            {
              "columnId": "TimeBracket",
              "label": "Time Bracket"
            }
          ]
        }
      },
      "customWidth": "33",
      "name": "ap-mttr-time-bracket"
    },
    {
      "type": 1,
      "content": {
        "json": "<div style=\"font-size: medium; padding-left: 5px;\">\r\n<strong>Time Chart Distribution: Active vs. Resolved</strong><br>\r\n   <strong>Content</strong>: A comparative visual representation between active and resolved attack paths over time.<br>\r\n   <strong>Interpretation</strong>: This chart provides a narrative of the security team’s progress and challenges, highlighting the effectiveness of ongoing security efforts.\r\n</div>"
      },
      "conditionalVisibility": {
        "parameterName": "info",
        "comparison": "isEqualTo",
        "value": "On"
      },
      "name": "info-text-f"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "// Query to fetch and process Attack Path data using workbook time range parameters\r\nSecurityAttackPathData\r\n| where TimeGenerated >= {TimeRange:start} and TimeGenerated < {TimeRange:end}\r\n| extend AttackPathActualId = tostring(split(AttackPathId, \"/attackPaths/\")[1])\r\n| summarize FirstSeen=min(TimeGenerated), LastSeen=max(TimeGenerated) by AttackPathActualId, DisplayName\r\n| extend IsResolved = iff(LastSeen < startofday({TimeRange:end}), \"Yes\", \"No\")\r\n| extend IsNew = iff(FirstSeen >= startofday(datetime_add('day', -1, {TimeRange:end})), \"Yes\", \"No\")\r\n// Count the occurrences of resolved, unresolved, and new statuses for each day\r\n| summarize CountResolved = countif(IsResolved == \"Yes\"), CountUnresolved = countif(IsResolved == \"No\"), CountNew = countif(IsNew == \"Yes\") by bin(FirstSeen, 1d)\r\n// Plot the counts over time\r\n| render timechart \r\n",
        "size": 0,
        "title": "Attack Path - MTTR - Active vs Resolved Time Chart",
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "chartSettings": {
          "showMetrics": false,
          "showLegend": true,
          "seriesLabelSettings": [
            {
              "seriesName": "CountResolved",
              "label": "Resolved",
              "color": "green"
            },
            {
              "seriesName": "CountUnresolved",
              "label": "Active",
              "color": "redBright"
            },
            {
              "seriesName": "CountNew",
              "label": "New",
              "color": "blue"
            }
          ]
        }
      },
      "name": "ap-mttr-time-chart"
    },
    {
      "type": 1,
      "content": {
        "json": "<div style=\"font-size: medium; padding-left: 5px;\">\r\n<strong>Risk Factor, Target, and Entry Point Distribution</strong><br>\r\n   <strong>Content</strong>: Analyzes attack paths by risk factors, targeted resources, and entry points.<br>\r\n   <strong>Interpretation</strong>: Understanding which resources are most frequently targeted can guide the fortification of those areas, while analysis of entry points can help in tightening access controls.<br><br>\r\n<strong>Mitre TTPs Distribution</strong><br>\r\n   <strong>Content</strong>: Offers a strategic view of common attack methodologies through the lens of Mitre TTPs.<br>\r\n   <strong>Interpretation</strong>: Tailoring defenses against the most prevalent tactics and techniques can significantly enhance protective measures.\r\n</div>"
      },
      "conditionalVisibility": {
        "parameterName": "info",
        "comparison": "isEqualTo",
        "value": "On"
      },
      "name": "info-text-f - Copy"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "SecurityAttackPathData\r\n| mv-expand RiskFactors = RiskFactors\r\n| summarize Count = dcount(AttackPathId) by tostring(RiskFactors)\r\n| order by Count desc",
        "size": 0,
        "title": "Attack Path - Ditribution of the Attack Risk Factors",
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "piechart",
        "tileSettings": {
          "showBorder": false,
          "titleContent": {
            "columnMatch": "RiskFactors",
            "formatter": 1
          },
          "leftContent": {
            "columnMatch": "Count",
            "formatter": 12,
            "formatOptions": {
              "palette": "auto"
            },
            "numberFormat": {
              "unit": 17,
              "options": {
                "maximumSignificantDigits": 3,
                "maximumFractionDigits": 2
              }
            }
          }
        },
        "graphSettings": {
          "type": 2,
          "topContent": {
            "columnMatch": "RiskFactors",
            "formatter": 1
          },
          "centerContent": {
            "columnMatch": "Count",
            "formatter": 1,
            "numberFormat": {
              "unit": 17,
              "options": {
                "maximumSignificantDigits": 3,
                "maximumFractionDigits": 2
              }
            }
          },
          "nodeIdField": "RiskFactors",
          "graphOrientation": 3,
          "showOrientationToggles": false,
          "nodeSize": null,
          "staticNodeSize": 100,
          "colorSettings": {
            "nodeColorField": "Count",
            "type": 4,
            "heatmapPalette": "coldHot",
            "heatmapMin": null,
            "heatmapMax": null
          },
          "hivesMargin": 5,
          "edgeColorSettings": null
        },
        "mapSettings": {
          "locInfo": "LatLong",
          "sizeSettings": "Count",
          "sizeAggregation": "Sum",
          "legendMetric": "Count",
          "legendAggregation": "Sum",
          "itemColorSettings": {
            "type": "heatmap",
            "colorAggregation": "Sum",
            "nodeColorField": "Count",
            "heatmapPalette": "greenRed"
          }
        }
      },
      "customWidth": "33",
      "name": "ap-risk-factors"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "SecurityAttackPathData\r\n| extend PathObject = parse_json(Path) // Parse the 'Path' column which contains JSON data\r\n| mv-expand Node = PathObject.nodes // Expand the nodes array to access each node\r\n| where Node.mapIdentifier == TargetId // Filter nodes where mapIdentifier matches TargetId\r\n| extend Target = tostring(Node.displayName) // Extract the displayName of the matching node\r\n| summarize UniqueAttackPaths = dcount(AttackPathId) by Target // Count unique AttackPathId for each Target\r\n| order by UniqueAttackPaths desc // Order by the number of unique attack paths",
        "size": 0,
        "title": "Attack Path - Ditribution of the Attack Target Resources",
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "piechart",
        "graphSettings": {
          "type": 2,
          "topContent": {
            "columnMatch": "Target",
            "formatter": 1
          },
          "centerContent": {
            "columnMatch": "UniqueAttackPaths",
            "formatter": 1,
            "numberFormat": {
              "unit": 17,
              "options": {
                "maximumSignificantDigits": 3,
                "maximumFractionDigits": 2
              }
            }
          },
          "nodeIdField": "Target",
          "graphOrientation": 3,
          "showOrientationToggles": false,
          "nodeSize": null,
          "staticNodeSize": 100,
          "colorSettings": {
            "nodeColorField": "UniqueAttackPaths",
            "type": 4,
            "heatmapPalette": "categorical",
            "heatmapMin": null,
            "heatmapMax": null
          },
          "hivesMargin": 5,
          "edgeColorSettings": null
        }
      },
      "customWidth": "33",
      "name": "ap-target-resources"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "SecurityAttackPathData\r\n| extend PathObject = parse_json(Path) // Parse the 'Path' column which contains JSON data\r\n| mv-expand Node = PathObject.nodes // Expand the nodes array to access each node\r\n| where Node.mapIdentifier == EntrypointId // Filter nodes where mapIdentifier matches EntrypointId\r\n| extend Entrypoint = tostring(Node.displayName) // Extract the displayName of the matching node\r\n| summarize UniqueAttackPaths = dcount(AttackPathId) by Entrypoint // Count unique AttackPathId for each Entrypoint \r\n| order by UniqueAttackPaths desc // Order by the number of unique attack paths",
        "size": 0,
        "title": "Attack Path - Ditribution of the Attack Entry point Resources",
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "piechart",
        "graphSettings": {
          "type": 2,
          "topContent": {
            "columnMatch": "Entrypoint",
            "formatter": 1
          },
          "centerContent": {
            "columnMatch": "UniqueAttackPaths",
            "formatter": 1,
            "numberFormat": {
              "unit": 17,
              "options": {
                "maximumSignificantDigits": 3,
                "maximumFractionDigits": 2
              }
            }
          },
          "nodeIdField": "Entrypoint",
          "graphOrientation": 3,
          "showOrientationToggles": false,
          "nodeSize": null,
          "staticNodeSize": 100,
          "colorSettings": {
            "nodeColorField": "UniqueAttackPaths",
            "type": 4,
            "heatmapPalette": "categorical",
            "heatmapMin": null,
            "heatmapMax": null
          },
          "hivesMargin": 5,
          "edgeColorSettings": null
        }
      },
      "customWidth": "33",
      "name": "ap-entry-point-resources"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "let Tactics = SecurityAttackPathData\r\n| extend MitreObject = parse_json(Mitre)\r\n| mv-expand MitreTactics = MitreObject.tactics\r\n| summarize UniqueAttackPaths_Tactics = dcount(AttackPathId) by tostring(MitreTactics)\r\n| extend Type = \"Tactic\";\r\nlet Techniques = SecurityAttackPathData\r\n| extend MitreObject = parse_json(Mitre)\r\n| mv-expand MitreTechniques = MitreObject.techniques\r\n| summarize UniqueAttackPaths_Techniques = dcount(AttackPathId) by tostring(MitreTechniques)\r\n| extend Type = \"Technique\";\r\nunion Tactics, Techniques\r\n| project MitreItem = coalesce(MitreTactics, MitreTechniques), UniqueAttackPaths = coalesce(UniqueAttackPaths_Tactics, UniqueAttackPaths_Techniques), Type\r\n| order by UniqueAttackPaths desc\r\n",
        "size": 2,
        "title": "Attack Path - Ditribution of the Attack x Mitre TTPS",
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "graph",
        "graphSettings": {
          "type": 2,
          "topContent": {
            "columnMatch": "MitreItem",
            "formatter": 1
          },
          "centerContent": {
            "columnMatch": "UniqueAttackPaths",
            "formatter": 1,
            "numberFormat": {
              "unit": 17,
              "options": {
                "maximumSignificantDigits": 3,
                "maximumFractionDigits": 2
              }
            }
          },
          "hivesContent": {
            "columnMatch": "Type",
            "formatter": 1
          },
          "nodeIdField": "MitreItem",
          "graphOrientation": 3,
          "showOrientationToggles": false,
          "nodeSize": null,
          "staticNodeSize": 100,
          "colorSettings": {
            "nodeColorField": "UniqueAttackPaths",
            "type": 4,
            "heatmapPalette": "categorical",
            "heatmapMin": null,
            "heatmapMax": null
          },
          "groupByField": "Type",
          "hivesMargin": 5,
          "edgeColorSettings": null
        }
      },
      "name": "ap-mitre"
    }
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}