{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "# Conditional Access insights and reporting\n"
      },
      "customWidth": "60",
      "name": "text - 5"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "dc99b5b7-d991-4269-8694-c4f8675b03ee",
            "version": "KqlParameterItem/1.0",
            "name": "Workspace",
            "type": 5,
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "value": [
              "value::all"
            ],
            "typeSettings": {
              "resourceTypeFilter": {
                "microsoft.operationalinsights/workspaces": true
              },
              "additionalResourceOptions": [
                "value::all"
              ]
            },
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "TimeRange"
          },
          {
            "id": "47fd452d-caed-4c60-9f58-001b2a8f4e24",
            "version": "KqlParameterItem/1.0",
            "name": "Guide",
            "type": 10,
            "isRequired": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[\r\n    {\"value\": \"On\", \"label\": \"On\", \"selected\":true},\r\n    {\"value\": \"Off\", \"label\": \"Off\"}\r\n]"
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "customWidth": "40",
      "name": "parameters - 24"
    },
    {
      "type": 1,
      "content": {
        "json": "Organizations use Azure AD Conditional Access to determine who should have access to what resources under the right cicumstances. This workbook was designed to help admins understand the impact of their Conditional Access policies by aggregating sign-in results and highlighting users bypassing your Conditional Access policies. [Learn more](https://aka.ms/cainsights).\r\n\r\n### Steps to deploy a new Conditional Access policy using this workbook\r\n1. Read about [commonly applied Conditional Access policies](https://docs.microsoft.com/azure/active-directory/conditional-access/overview#commonly-applied-policies).\r\n2. Create a new Conditional Access policy in [report-only mode](https://docs.microsoft.com/azure/active-directory/conditional-access/concept-conditional-access-report-only).\r\n3. In this report, select the policy from the Conditional Access policy parameter to see its impact summary. \r\n4. Click on a result tile to filter the report by success, failure, user action required, or not applied sign-ins. \r\n5. Verify whether the policy is acting as intended by looking at the breakdown per condition and sign-in status. \r\n6. Edit your policy if necessary, or switch the state of the policy from report-only to on. \r\n7. In this report, view the impact of all enabled policies by selecting \"All enabled policies\" from the Conditional Access policy parameter. \r\n"
      },
      "conditionalVisibility": {
        "parameterName": "Guide",
        "comparison": "isEqualTo",
        "value": "On"
      },
      "name": "Getting started"
    },
    {
      "type": 1,
      "content": {
        "json": "For tenants with high volume of sign-ins, this workbook may not support filtering by time ranges longer than 24 hours. Microsoft recommends using the [Conditional Access overview](https://aka.ms/ca_overview) dashboard instead.",
        "style": "info"
      },
      "name": "text - 14"
    },
    {	
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "links": [
          {
            "id": "54488ef3-321b-4eee-9670-f57303cb4265",
            "cellValue": "identityType",
            "linkTarget": "parameter",
            "linkLabel": "User sign-ins",
            "subTarget": "user",
            "preText": "User sign-ins",
            "style": "link"
          },
          {
            "id": "08b8034b-b2f0-4ed2-8c28-dc6d79af1c3b",
            "cellValue": "identityType",
            "linkTarget": "parameter",
            "linkLabel": "Service principal sign-ins",
            "subTarget": "servicePrincipal",
            "style": "link"
          }
        ]
      },
      "name": "links - 29"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "5441273f-af1c-49f3-ac63-2e56253ecd45",
            "version": "KqlParameterItem/1.0",
            "name": "SigninLogs",
            "type": 1,
            "query": "SigninLogs | take 1",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "dfade4d2-db09-451b-9fcc-0774a6999289",
            "version": "KqlParameterItem/1.0",
            "name": "AADServicePrincipalSignInLogs",
            "type": 1,
            "query": "AADServicePrincipalSignInLogs | take 1",
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "parameters - 12"
    },
    {
      "type": 1,
      "content": {
        "json": "In order to view user sign-ins, ensure that Diagnostic Settings are configured to send SignInLogs to your log analytics workspace. [Learn more](https://docs.microsoft.com/azure/active-directory/reports-monitoring/howto-integrate-activity-logs-with-log-analytics). ",
        "style": "warning"
      },
      "conditionalVisibility": {
        "parameterName": "SigninLogs",
        "comparison": "isEqualTo"
      },
      "name": "text - 11"
    },
    {
      "type": 1,
      "content": {
        "json": "In order to view service prinicpal sign-ins, ensure that Diagnostic Settings are configured to send ServicePrincipalSignInLogs to your log analytics workspace. [Learn more](https://docs.microsoft.com/azure/active-directory/reports-monitoring/howto-integrate-activity-logs-with-log-analytics). ",
        "style": "warning"
      },
      "conditionalVisibility": {
        "parameterName": "AADServicePrincipalSignInLogs",
        "comparison": "isEqualTo"
      },
      "name": "text - 11 - Copy"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "{\"version\":\"1.0.0\",\"content\":\"[\\r\\n   {\\r\\n      \\\"id\\\":\\\"All\\\",\\r\\n      \\\"name\\\":\\\"All enabled policies\\\",\\r\\n\\t\\t\\\"group\\\": \\\"Select all enabled policies\\\"\\r\\n   }\\r\\n]\",\"transformers\":null}",
        "size": 4,
        "queryType": 8
      },
      "conditionalVisibility": {
        "parameterName": "1",
        "comparison": "isEqualTo",
        "value": "2"
      },
      "name": "Static all enabled policies"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "{\"version\":\"MsGraphEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GETARRAY\",\"path\":\"/beta/identity/conditionalAccess/policies?$filter=state eq 'enabled'\",\"urlParams\":[],\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"columns\":[{\"path\":\"$.id\",\"columnid\":\"id\"},{\"path\":\"$.displayName\",\"columnid\":\"name\"},{\"path\":\"$.id\",\"columnid\":\"group\",\"columnType\":\"string\",\"substringRegexMatch\":\".*\",\"substringReplace\":\"Select individual enabled policy\"}]}}]}",
        "size": 4,
        "queryType": 14
      },
      "conditionalVisibility": {
        "parameterName": "1",
        "comparison": "isEqualTo",
        "value": "2"
      },
      "name": "Graph call enabled"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "{\"version\":\"MsGraphEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GETARRAY\",\"path\":\"/beta/identity/conditionalAccess/policies?$filter=state eq 'enabledForReportingButNotEnforced'\",\"urlParams\":[],\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"columns\":[{\"path\":\"$.id\",\"columnid\":\"id\"},{\"path\":\"$.displayName\",\"columnid\":\"name\"},{\"path\":\"$.id\",\"columnid\":\"group\",\"columnType\":\"string\",\"substringRegexMatch\":\".*\",\"substringReplace\":\"Select individual report-only policy\"}]}}]}",
        "size": 4,
        "queryType": 14
      },
      "conditionalVisibility": {
        "parameterName": "1",
        "comparison": "isEqualTo",
        "value": "2"
      },
      "name": "Graph call report-only"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "4f68d9a1-025d-42c5-b54f-3c67f4d9e678",
            "version": "KqlParameterItem/1.0",
            "name": "policy",
            "label": "Conditional Access policy",
            "type": 2,
            "isRequired": true,
            "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"5550361f-24c8-4874-9984-366e29434071\",\"mergeType\":\"union\",\"leftTable\":\"Static all enabled policies\",\"rightTable\":\"Graph call enabled\"},{\"id\":\"5550361f-24c8-4874-9984-366e29434072\",\"mergeType\":\"union\",\"leftTable\":\"Graph call enabled\",\"rightTable\":\"Graph call report-only\"}],\"projectRename\":[{\"originalName\":\"id\",\"mergedName\":\"id\",\"fromId\":\"unknown\"},{\"originalName\":\"name\",\"mergedName\":\"name\",\"fromId\":\"unknown\"},{\"originalName\":\"group\",\"mergedName\":\"group\",\"fromId\":\"unknown\"},{\"originalName\":\"[Static all enabled policies].id\",\"mergedName\":\"id1\",\"fromId\":\"5550361f-24c8-4874-9984-366e29434071\"},{\"originalName\":\"[Static all enabled policies].name\",\"mergedName\":\"name1\",\"fromId\":\"5550361f-24c8-4874-9984-366e29434071\"},{\"originalName\":\"[Static all enabled policies].group\",\"mergedName\":\"group1\",\"fromId\":\"5550361f-24c8-4874-9984-366e29434071\"}]}",
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "queryType": 7
          },
          {
            "id": "17196e4b-f291-46a5-9e00-0b5e0d8943e8",
            "version": "KqlParameterItem/1.0",
            "name": "TimeRange",
            "label": "Time range",
            "type": 4,
            "isRequired": true,
            "value": {
              "durationMs": 86400000
            },
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 1800000
                },
                {
                  "durationMs": 3600000
                },
                {
                  "durationMs": 14400000
                },
                {
                  "durationMs": 43200000
                },
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 172800000
                },
                {
                  "durationMs": 259200000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 1209600000
                },
                {
                  "durationMs": 2419200000
                },
                {
                  "durationMs": 2592000000
                },
                {
                  "durationMs": 5184000000
                },
                {
                  "durationMs": 7776000000
                }
              ],
              "allowCustom": true
            }
          },
          {
            "id": "93cfc5e1-92f3-43a3-aad5-dc7fc507eb57",
            "version": "KqlParameterItem/1.0",
            "name": "User",
            "type": 1,
            "description": "Exact match on full user principal name (e.g. user@domain.com). Default value is \"All users\"",
            "value": "All users",
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "TimeRange"
          },
          {
            "id": "60a4d33d-0d73-47e8-a32d-6798d0f5730e",
            "version": "KqlParameterItem/1.0",
            "name": "App",
            "type": 1,
            "description": "Exact match on app display name. Default value is \"All apps\"",
            "value": "All apps",
            "timeContext": {
              "durationMs": 86400000
            },
            "timeContextFromParameter": "TimeRange"
          },
          {
            "id": "db042271-d62d-45ee-ab7f-56fef70dc459",
            "version": "KqlParameterItem/1.0",
            "name": "unit",
            "label": "Data view",
            "type": 2,
            "description": "Display results by number of users or number of sign-ins",
            "isRequired": true,
            "query": "let unit = datatable(label:string,units:string)\r\n[\"users\", \"|\",\r\n \"sign-ins\",\"//\"];\r\nunit \r\n| project Value = units, Label = label",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "value": "|",
            "typeSettings": {
              "additionalResourceOptions": []
            },
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "conditionalVisibility": {
        "parameterName": "identityType",
        "comparison": "isEqualTo",
        "value": "user"
      },
      "name": "parameters - 1"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## Impact summary\r\nðŸ’¡ *Click on the tiles below to filter the report by the selected Conditional Access result.*"
            },
            "name": "text - 21"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "// Total\r\nSigninLogs\r\n| where TimeGenerated {TimeRange:value}\r\n| project UserPrincipalName, AppDisplayName\r\n| where \"{User:escape}\" == \"All users\" or UserPrincipalName has \"{User:escape}\"\r\n| where \"{App:escape}\" == \"All apps\" or AppDisplayName has \"{App:escape}\"\r\n| project-away AppDisplayName\r\n{unit} summarize count() by UserPrincipalName\r\n| summarize count()\r\n| extend resultName = \"Total\", unit = case(\"{unit}\" == \"//\", \"sign-ins\",\"users\"), statusCode = 1\r\n//\r\n//\r\n// Number of success/failure/user action required/not applied\r\n| union (\r\nSigninLogs\r\n| where TimeGenerated {TimeRange:value}\r\n| project ConditionalAccessStatus, UserPrincipalName, AppDisplayName\r\n| where \"{User:escape}\" == \"All users\" or UserPrincipalName has \"{User:escape}\"\r\n| where \"{App:escape}\" == \"All apps\" or AppDisplayName has \"{App:escape}\"\r\n| project-away AppDisplayName\r\n| extend resultName = case(ConditionalAccessStatus == \"success\", \"Success\", ConditionalAccessStatus == \"failure\", \"Failure\", \"Not applied\")\r\n| extend statusCode = case(ConditionalAccessStatus == \"success\", 2, ConditionalAccessStatus == \"failure\", 3, 4)\r\n{unit} summarize count() by resultName, UserPrincipalName, statusCode\r\n| summarize count() by resultName, statusCode\r\n| extend unit = case(\"{unit}\" == \"//\", \"sign-ins\",\"users\")\r\n)\r\n//\r\n// Case if result count is 0\r\n| join kind = fullouter (\r\n    datatable (resultName:string,statusCode1:string)\r\n    [\"Total\", 1,\r\n     \"Success\", 2,\r\n     \"Failure\", 3,\r\n     \"Not applied\", 4]\r\n) on resultName\r\n| extend resultName = iff(resultName == '', resultName1, resultName), count_ = iff(resultName == '', 0, count_), unit = \"{unit:label}\", statusCode1\r\n| project-away resultName1\r\n| sort by statusCode1 asc",
              "size": 4,
              "timeContext": {
                "durationMs": 86400000
              },
              "timeContextFromParameter": "TimeRange",
              "exportFieldName": "resultName",
              "exportParameterName": "resultName",
              "exportDefaultValue": "Total",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "resultName",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "count_",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 2,
                      "maximumSignificantDigits": 3
                    }
                  }
                },
                "secondaryContent": {
                  "columnMatch": "unit",
                  "formatter": 1
                },
                "showBorder": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "policy",
              "comparison": "isEqualTo",
              "value": "All"
            },
            "name": "All Policies Summary"
          },
          {
            "type": 1,
            "content": {
              "json": "**Total**: Number of {unit:label} in the {TimeRange}</br>\r\n**Success**: Number of {unit:label} where the selected polic(ies) granted access and the required controls were satisifed</br>\r\n**Failure**: Number of {unit:label} where the selected polic(ies) denied access and the required controls were not satisfied</br>\r\n**User action required**: Number of {unit:label} where the selected report-only policy applied but user action (e.g. MFA or Terms of Use) would be required if the policy were enabled.</br>\r\n**Not applied**: Number of {unit:label} that are bypassing the selected polic(ies) because the sign-in did not match at least one of the assignments or conditions. "
            },
            "conditionalVisibility": {
              "parameterName": "Guide",
              "comparison": "isEqualTo",
              "value": "On"
            },
            "name": "Instructions 1"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "// Total\r\nSigninLogs\r\n| where TimeGenerated {TimeRange:value}\r\n| project ConditionalAccessPolicies, UserPrincipalName, AppDisplayName\r\n| where ConditionalAccessPolicies != \"[]\"\r\n| where \"{User:escape}\" == \"All users\" or UserPrincipalName has \"{User:escape}\"\r\n| where \"{App:escape}\" == \"All apps\" or AppDisplayName has \"{App:escape}\"\r\n| project-away AppDisplayName\r\n| mv-expand ConditionalAccessPolicies\r\n| where ConditionalAccessPolicies[\"id\"] == \"{policy:escape}\"\r\n| project-away ConditionalAccessPolicies\r\n{unit} summarize count() by UserPrincipalName\r\n| summarize count()\r\n| extend resultName = \"Total\", unit = case(\"{unit}\" == \"//\", \"sign-ins\",\"users\"), statusCode = 1\r\n//\r\n//\r\n// Number of success/failure/user action required/not applied\r\n| union (\r\nSigninLogs\r\n| where TimeGenerated {TimeRange:value}\r\n| project ConditionalAccessPolicies, UserPrincipalName, AppDisplayName\r\n| where ConditionalAccessPolicies != \"[]\"\r\n| where \"{User:escape}\" == \"All users\" or UserPrincipalName has \"{User:escape}\"\r\n| where \"{App:escape}\" == \"All apps\" or AppDisplayName has \"{App:escape}\"\r\n| project-away AppDisplayName\r\n| mv-expand ConditionalAccessPolicies\r\n| where ConditionalAccessPolicies[\"id\"] == \"{policy:escape}\"\r\n| extend result = ConditionalAccessPolicies[\"result\"]\r\n| project-away ConditionalAccessPolicies\r\n| extend resultName = case(result == \"success\" or result == \"reportOnlySuccess\", \"Success\", result == \"failure\" or result == \"reportOnlyFailure\", \"Failure\", result == \"interrupt\" or result == \"reportOnlyInterrupted\", \"User action required\", \"Not applied\")\r\n| extend statusCode = case(resultName == \"Success\", 2, resultName == \"Failure\", 3, resultName == \"User action required\", 4, 5)\r\n{unit} summarize count() by resultName, UserPrincipalName, statusCode\r\n| summarize count() by resultName, statusCode\r\n| extend unit = case(\"{unit}\" == \"//\", \"sign-ins\",\"users\")\r\n)\r\n//\r\n// Case if result count is 0\r\n| join kind = fullouter (\r\n    datatable (resultName:string,statusCode1:string)\r\n    [\"Total\", 1,\r\n     \"Success\", 2,\r\n     \"Failure\", 3,\r\n     \"User action required\", 4,\r\n     \"Not applied\", 5]\r\n) on resultName\r\n| extend resultName = iff(resultName == '', resultName1, resultName), count_ = iff(resultName == '', 0, count_), unit = \"{unit:label}\", statusCode1\r\n| project-away resultName1\r\n| sort by statusCode1 asc",
              "size": 3,
              "showAnalytics": true,
              "timeContext": {
                "durationMs": 86400000
              },
              "timeContextFromParameter": "TimeRange",
              "exportFieldName": "resultName",
              "exportParameterName": "resultName",
              "exportDefaultValue": "Total",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "resultName",
                  "formatter": 1,
                  "formatOptions": {
                    "showIcon": true
                  }
                },
                "leftContent": {
                  "columnMatch": "count_",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto",
                    "showIcon": true
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                },
                "secondaryContent": {
                  "columnMatch": "unit",
                  "formatter": 1,
                  "formatOptions": {
                    "showIcon": true
                  }
                },
                "showBorder": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "policy",
              "comparison": "isNotEqualTo",
              "value": "All"
            },
            "name": "Individual Policies Summary"
          },
          {
            "type": 1,
            "content": {
              "json": "__________________________________________\r\n## Breakdown per condition and sign-in status"
            },
            "conditionalVisibility": {
              "parameterName": "statusCode",
              "comparison": "isNotEqualTo",
              "value": "0"
            },
            "name": "text - 14"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SigninLogs\r\n| where TimeGenerated {TimeRange:value}\r\n| project ConditionalAccessPolicies, UserPrincipalName, AppDisplayName, DeviceDetail\r\n| where ConditionalAccessPolicies != \"[]\"\r\n| where \"{User:escape}\" == \"All users\" or UserPrincipalName has \"{User:escape}\"\r\n| where \"{App:escape}\" == \"All apps\" or AppDisplayName has \"{App:escape}\"\r\n| project-away AppDisplayName\r\n| mv-expand ConditionalAccessPolicies\r\n| where ConditionalAccessPolicies[\"id\"] == \"{policy:escape}\"\r\n| extend result = ConditionalAccessPolicies[\"result\"]\r\n| project-away ConditionalAccessPolicies\r\n// filter by the result type selected\r\n// Total = any result type (the result type will contain the empty string \"\")\r\n// Success = result types containing \"uccess\" (includes \"success\" and \"reportOnlySuccess\")\r\n// Failure = result types containing \"ailure\" (includes \"failure\" and \"reportOnlyFailure\")\r\n// User action required = result types containing \"nterrupt\" (includes \"interrupt\" and \"reportOnlyInterrupted\")\r\n// Not applied = result types containing \"ot\" (includes \"notApplied\", \"reportOnlyNotApplied\", and \"notEnabled\")\r\n| extend filterResult = case(\"{resultName}\" == \"Total\",\"\", \"{resultName}\" == \"Success\", \"uccess\", \"{resultName}\" == \"Failure\", \"ailure\", \"{resultName}\" == \"User action required\", \"nterrupted\",\"ot\")\r\n| where result contains filterResult\r\n| extend deviceState = case(DeviceDetail[\"trustType\"] == \"\", \"Unmanaged\", DeviceDetail[\"trustType\"])\r\n{unit} summarize count() by UserPrincipalName, deviceState\r\n| summarize count() by deviceState\r\n\r\n",
              "size": 3,
              "showAnalytics": true,
              "title": "Device State - {resultName}",
              "timeContext": {
                "durationMs": 86400000
              },
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "piechart",
              "tileSettings": {
                "showBorder": false,
                "titleContent": {
                  "columnMatch": "deviceState",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "count_",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              }
            },
            "customWidth": "33",
            "conditionalVisibility": {
              "parameterName": "policy",
              "comparison": "isNotEqualTo",
              "value": "All"
            },
            "name": "Device state - individual policies"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SigninLogs\r\n| where TimeGenerated {TimeRange:value}\r\n| project ConditionalAccessStatus, UserPrincipalName, AppDisplayName, DeviceDetail\r\n| where \"{User:escape}\" == \"All users\" or UserPrincipalName has \"{User:escape}\"\r\n| where \"{App:escape}\" == \"All apps\" or AppDisplayName has \"{App:escape}\"\r\n| project-away AppDisplayName\r\n| extend filterResult = case(\"{resultName}\" == \"Total\",\"\", \"{resultName}\" == \"Success\", \"success\", \"{resultName}\" == \"Failure\", \"failure\", \"notApplied\")\r\n| where ConditionalAccessStatus contains filterResult\r\n| extend deviceState = case(DeviceDetail[\"trustType\"] == \"\", \"Unmanaged\", DeviceDetail[\"trustType\"])\r\n{unit} summarize count() by UserPrincipalName, deviceState\r\n| summarize count() by deviceState\r\n\r\n",
              "size": 3,
              "showAnalytics": true,
              "title": "Device State - {resultName}",
              "timeContext": {
                "durationMs": 86400000
              },
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "piechart",
              "tileSettings": {
                "showBorder": false,
                "titleContent": {
                  "columnMatch": "deviceState",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "count_",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              }
            },
            "customWidth": "33",
            "conditionalVisibility": {
              "parameterName": "policy",
              "comparison": "isEqualTo",
              "value": "All"
            },
            "name": "Device state - all enabled policies"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SigninLogs\r\n| where TimeGenerated {TimeRange:value}\r\n| project ConditionalAccessPolicies, UserPrincipalName, AppDisplayName, DeviceDetail\r\n| where ConditionalAccessPolicies != \"[]\"\r\n| where \"{User:escape}\" == \"All users\" or UserPrincipalName has \"{User:escape}\"\r\n| where \"{App:escape}\" == \"All apps\" or AppDisplayName has \"{App:escape}\"\r\n| project-away AppDisplayName\r\n| mv-expand ConditionalAccessPolicies\r\n| where ConditionalAccessPolicies[\"id\"] == \"{policy:escape}\"\r\n| extend result = ConditionalAccessPolicies[\"result\"]\r\n| project-away ConditionalAccessPolicies\r\n// filter by the result type selected\r\n// Total = any result type (the result type will contain the empty string \"\")\r\n// Success = result types containing \"uccess\" (includes \"success\" and \"reportOnlySuccess\")\r\n// Failure = result types containing \"ailure\" (includes \"failure\" and \"reportOnlyFailure\")\r\n// User action required = result types containing \"nterrupt\" (includes \"interrupt\" and \"reportOnlyInterrupted\")\r\n// Not applied = result types containing \"ot\" (includes \"notApplied\", \"reportOnlyNotApplied\", and \"notEnabled\")\r\n| extend filterResult = case(\"{resultName}\" == \"Total\",\"\", \"{resultName}\" == \"Success\", \"uccess\", \"{resultName}\" == \"Failure\", \"ailure\", \"{resultName}\" == \"User action required\", \"nterrupted\",\"ot\")\r\n| where result contains filterResult\r\n| extend device = tostring(DeviceDetail[\"operatingSystem\"])\r\n{unit} summarize count() by UserPrincipalName, device\r\n| summarize count() by device\r\n\r\n\r\n",
              "size": 3,
              "showAnalytics": true,
              "title": "Device platform - {resultName}",
              "timeContext": {
                "durationMs": 86400000
              },
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "piechart",
              "tileSettings": {
                "showBorder": false,
                "titleContent": {
                  "columnMatch": "deviceState",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "count_",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              }
            },
            "customWidth": "33",
            "conditionalVisibility": {
              "parameterName": "policy",
              "comparison": "isNotEqualTo",
              "value": "All"
            },
            "name": "Device platform - individual policy"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SigninLogs\r\n| where TimeGenerated {TimeRange:value}\r\n| project ConditionalAccessStatus, UserPrincipalName, AppDisplayName, DeviceDetail\r\n| where \"{User:escape}\" == \"All users\" or UserPrincipalName has \"{User:escape}\"\r\n| where \"{App:escape}\" == \"All apps\" or AppDisplayName has \"{App:escape}\"\r\n| project-away AppDisplayName\r\n| extend filterResult = case(\"{resultName}\" == \"Total\",\"\", \"{resultName}\" == \"Success\", \"success\", \"{resultName}\" == \"Failure\", \"failure\", \"notApplied\")\r\n| where ConditionalAccessStatus contains filterResult\r\n| extend device = tostring(DeviceDetail[\"operatingSystem\"])\r\n{unit} summarize count() by UserPrincipalName, device\r\n| summarize count() by device\r\n\r\n\r\n",
              "size": 3,
              "showAnalytics": true,
              "title": "Device platform - {resultName}",
              "timeContext": {
                "durationMs": 86400000
              },
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "piechart",
              "tileSettings": {
                "showBorder": false,
                "titleContent": {
                  "columnMatch": "deviceState",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "count_",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              }
            },
            "customWidth": "33",
            "conditionalVisibility": {
              "parameterName": "policy",
              "comparison": "isEqualTo",
              "value": "All"
            },
            "name": "Device platform - all enabled policies"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SigninLogs\r\n| where TimeGenerated {TimeRange:value}\r\n| project ConditionalAccessPolicies, UserPrincipalName, AppDisplayName, ClientAppUsed\r\n| where ConditionalAccessPolicies != \"[]\"\r\n| where \"{User:escape}\" == \"All users\" or UserPrincipalName has \"{User:escape}\"\r\n| where \"{App:escape}\" == \"All apps\" or AppDisplayName has \"{App:escape}\"\r\n| project-away AppDisplayName\r\n| mv-expand ConditionalAccessPolicies\r\n| where ConditionalAccessPolicies[\"id\"] == \"{policy:escape}\"\r\n| extend result = ConditionalAccessPolicies[\"result\"]\r\n| project-away ConditionalAccessPolicies\r\n// filter by the result type selected\r\n// Total = any result type (the result type will contain the empty string \"\")\r\n// Success = result types containing \"uccess\" (includes \"success\" and \"reportOnlySuccess\")\r\n// Failure = result types containing \"ailure\" (includes \"failure\" and \"reportOnlyFailure\")\r\n// User action required = result types containing \"nterrupt\" (includes \"interrupt\" and \"reportOnlyInterrupted\")\r\n// Not applied = result types containing \"ot\" (includes \"notApplied\", \"reportOnlyNotApplied\", and \"notEnabled\")\r\n| extend filterResult = case(\"{resultName}\" == \"Total\",\"\", \"{resultName}\" == \"Success\", \"uccess\", \"{resultName}\" == \"Failure\", \"ailure\", \"{resultName}\" == \"User action required\", \"nterrupted\",\"ot\")\r\n| where result contains filterResult\r\n{unit} summarize count() by UserPrincipalName, ClientAppUsed\r\n| summarize count() by ClientAppUsed",
              "size": 3,
              "showAnalytics": true,
              "title": "Client app - {resultName}",
              "timeContext": {
                "durationMs": 86400000
              },
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "piechart",
              "tileSettings": {
                "showBorder": false,
                "titleContent": {
                  "columnMatch": "deviceState",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "count_",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              }
            },
            "customWidth": "33",
            "conditionalVisibility": {
              "parameterName": "policy",
              "comparison": "isNotEqualTo",
              "value": "All"
            },
            "name": "Client app - individual policy"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SigninLogs\r\n| where TimeGenerated {TimeRange:value}\r\n| project ConditionalAccessStatus, UserPrincipalName, AppDisplayName, ClientAppUsed\r\n| where \"{User:escape}\" == \"All users\" or UserPrincipalName has \"{User:escape}\"\r\n| where \"{App:escape}\" == \"All apps\" or AppDisplayName has \"{App:escape}\"\r\n| project-away AppDisplayName\r\n| extend filterResult = case(\"{resultName}\" == \"Total\",\"\", \"{resultName}\" == \"Success\", \"success\", \"{resultName}\" == \"Failure\", \"failure\", \"notApplied\")\r\n| where ConditionalAccessStatus contains filterResult\r\n{unit} summarize count() by UserPrincipalName, ClientAppUsed\r\n| summarize count() by ClientAppUsed",
              "size": 3,
              "showAnalytics": true,
              "title": "Client app - {resultName}",
              "timeContext": {
                "durationMs": 86400000
              },
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "piechart",
              "tileSettings": {
                "showBorder": false,
                "titleContent": {
                  "columnMatch": "deviceState",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "count_",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              }
            },
            "customWidth": "33",
            "conditionalVisibility": {
              "parameterName": "policy",
              "comparison": "isEqualTo",
              "value": "All"
            },
            "name": "Client app - all enabled policies"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SigninLogs\r\n| where TimeGenerated {TimeRange:value}\r\n| project ConditionalAccessPolicies, UserPrincipalName, AppDisplayName, RiskLevelDuringSignIn\r\n| where ConditionalAccessPolicies != \"[]\"\r\n| where \"{User:escape}\" == \"All users\" or UserPrincipalName has \"{User:escape}\"\r\n| where \"{App:escape}\" == \"All apps\" or AppDisplayName has \"{App:escape}\"\r\n| project-away AppDisplayName\r\n| mv-expand ConditionalAccessPolicies\r\n| where ConditionalAccessPolicies[\"id\"] == \"{policy:escape}\"\r\n| extend result = ConditionalAccessPolicies[\"result\"]\r\n| project-away ConditionalAccessPolicies\r\n// filter by the result type selected\r\n// Total = any result type (the result type will contain the empty string \"\")\r\n// Success = result types containing \"uccess\" (includes \"success\" and \"reportOnlySuccess\")\r\n// Failure = result types containing \"ailure\" (includes \"failure\" and \"reportOnlyFailure\")\r\n// User action required = result types containing \"nterrupt\" (includes \"interrupt\" and \"reportOnlyInterrupted\")\r\n// Not applied = result types containing \"ot\" (includes \"notApplied\", \"reportOnlyNotApplied\", and \"notEnabled\")\r\n| extend filterResult = case(\"{resultName}\" == \"Total\",\"\", \"{resultName}\" == \"Success\", \"uccess\", \"{resultName}\" == \"Failure\", \"ailure\", \"{resultName}\" == \"User action required\", \"nterrupted\",\"ot\")\r\n| where result contains filterResult\r\n{unit} summarize count() by UserPrincipalName, RiskLevelDuringSignIn\r\n| summarize count() by RiskLevelDuringSignIn",
              "size": 3,
              "showAnalytics": true,
              "title": "Sign-in risk - {resultName}",
              "timeContext": {
                "durationMs": 86400000
              },
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "piechart",
              "tileSettings": {
                "showBorder": false,
                "titleContent": {
                  "columnMatch": "deviceState",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "count_",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              }
            },
            "customWidth": "33",
            "conditionalVisibility": {
              "parameterName": "policy",
              "comparison": "isNotEqualTo",
              "value": "All"
            },
            "name": "Sign-in risk - individual policy"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SigninLogs\r\n| where TimeGenerated {TimeRange:value}\r\n| project ConditionalAccessStatus, UserPrincipalName, AppDisplayName, RiskLevelDuringSignIn\r\n| where \"{User:escape}\" == \"All users\" or UserPrincipalName has \"{User:escape}\"\r\n| where \"{App:escape}\" == \"All apps\" or AppDisplayName has \"{App:escape}\"\r\n| project-away AppDisplayName\r\n| extend filterResult = case(\"{resultName}\" == \"Total\",\"\", \"{resultName}\" == \"Success\", \"success\", \"{resultName}\" == \"Failure\", \"failure\", \"notApplied\")\r\n| where ConditionalAccessStatus contains filterResult\r\n{unit} summarize count() by UserPrincipalName, RiskLevelDuringSignIn\r\n| summarize count() by RiskLevelDuringSignIn",
              "size": 3,
              "showAnalytics": true,
              "title": "Sign-in risk - {resultName}",
              "timeContext": {
                "durationMs": 86400000
              },
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "piechart",
              "tileSettings": {
                "showBorder": false,
                "titleContent": {
                  "columnMatch": "deviceState",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "count_",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              }
            },
            "customWidth": "33",
            "conditionalVisibility": {
              "parameterName": "policy",
              "comparison": "isEqualTo",
              "value": "All"
            },
            "name": "Sign-in risk - all enabed policies"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SigninLogs\r\n| where TimeGenerated {TimeRange:value}\r\n| project ConditionalAccessPolicies, UserPrincipalName, AppDisplayName, location = tostring(LocationDetails.countryOrRegion)\r\n| where ConditionalAccessPolicies != \"[]\"\r\n| where \"{User:escape}\" == \"All users\" or UserPrincipalName has \"{User:escape}\"\r\n| where \"{App:escape}\" == \"All apps\" or AppDisplayName has \"{App:escape}\"\r\n| project-away AppDisplayName\r\n| mv-expand ConditionalAccessPolicies\r\n| where ConditionalAccessPolicies[\"id\"] == \"{policy:escape}\"\r\n| extend result = ConditionalAccessPolicies[\"result\"]\r\n| project-away ConditionalAccessPolicies\r\n// filter by the result type selected\r\n// Total = any result type (the result type will contain the empty string \"\")\r\n// Success = result types containing \"uccess\" (includes \"success\" and \"reportOnlySuccess\")\r\n// Failure = result types containing \"ailure\" (includes \"failure\" and \"reportOnlyFailure\")\r\n// User action required = result types containing \"nterrupt\" (includes \"interrupt\" and \"reportOnlyInterrupted\")\r\n// Not applied = result types containing \"ot\" (includes \"notApplied\", \"reportOnlyNotApplied\", and \"notEnabled\")\r\n| extend filterResult = case(\"{resultName}\" == \"Total\",\"\", \"{resultName}\" == \"Success\", \"uccess\", \"{resultName}\" == \"Failure\", \"ailure\", \"{resultName}\" == \"User action required\", \"nterrupted\",\"ot\")\r\n| where result contains filterResult\r\n{unit} summarize count() by UserPrincipalName, location\r\n| summarize Count = count() by location\r\n| sort by Count desc",
              "size": 0,
              "showAnalytics": true,
              "title": "Location - {resultName}",
              "timeContext": {
                "durationMs": 86400000
              },
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "map",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "location",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "green",
                      "showIcon": true,
                      "aggregation": "Count"
                    }
                  },
                  {
                    "columnMatch": "Count",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "blue",
                      "showIcon": true,
                      "aggregation": "Max"
                    }
                  },
                  {
                    "columnMatch": "-- Group By --",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "green",
                      "showIcon": true
                    }
                  }
                ]
              },
              "mapSettings": {
                "locInfo": "CountryRegion",
                "locInfoColumn": "location",
                "sizeSettings": "Count",
                "sizeAggregation": "Sum",
                "labelSettings": "location",
                "legendMetric": "Count",
                "numberOfMetrics": 10,
                "legendAggregation": "Sum",
                "itemColorSettings": {
                  "nodeColorField": "Count",
                  "colorAggregation": "Sum",
                  "type": "heatmap",
                  "heatmapPalette": "greenRed"
                }
              }
            },
            "customWidth": "33",
            "conditionalVisibility": {
              "parameterName": "policy",
              "comparison": "isNotEqualTo",
              "value": "All"
            },
            "name": "Location - individual policies"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SigninLogs\r\n| where TimeGenerated {TimeRange:value}\r\n| project ConditionalAccessStatus, UserPrincipalName, AppDisplayName, location = tostring(LocationDetails.countryOrRegion)\r\n| where \"{User:escape}\" == \"All users\" or UserPrincipalName has \"{User:escape}\"\r\n| where \"{App:escape}\" == \"All apps\" or AppDisplayName has \"{App:escape}\"\r\n| project-away AppDisplayName\r\n| extend filterResult = case(\"{resultName}\" == \"Total\",\"\", \"{resultName}\" == \"Success\", \"success\", \"{resultName}\" == \"Failure\", \"failure\", \"notApplied\")\r\n| where ConditionalAccessStatus contains filterResult\r\n{unit} summarize count() by UserPrincipalName, location\r\n| summarize Count = count() by location\r\n| sort by Count desc",
              "size": 0,
              "showAnalytics": true,
              "title": "Location - {resultName}",
              "timeContext": {
                "durationMs": 86400000
              },
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "map",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "location",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "green",
                      "showIcon": true,
                      "aggregation": "Count"
                    }
                  },
                  {
                    "columnMatch": "Count",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "blue",
                      "showIcon": true,
                      "aggregation": "Max"
                    }
                  },
                  {
                    "columnMatch": "-- Group By --",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "green",
                      "showIcon": true
                    }
                  }
                ]
              },
              "mapSettings": {
                "locInfo": "CountryRegion",
                "locInfoColumn": "location",
                "sizeSettings": "Count",
                "sizeAggregation": "Sum",
                "labelSettings": "location",
                "legendMetric": "Count",
                "legendAggregation": "Sum",
                "itemColorSettings": {
                  "nodeColorField": "Count",
                  "colorAggregation": "Sum",
                  "type": "heatmap",
                  "heatmapPalette": "greenRed"
                }
              }
            },
            "customWidth": "33",
            "conditionalVisibility": {
              "parameterName": "policy",
              "comparison": "isEqualTo",
              "value": "All"
            },
            "name": "Location - all enabled policies"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SigninLogs\r\n| where TimeGenerated {TimeRange:value}\r\n| project ConditionalAccessPolicies, UserPrincipalName, AppDisplayName\r\n| where ConditionalAccessPolicies != \"[]\"\r\n| where \"{User:escape}\" == \"All users\" or UserPrincipalName has \"{User:escape}\"\r\n| where \"{App:escape}\" == \"All apps\" or AppDisplayName has \"{App:escape}\"\r\n| mv-expand ConditionalAccessPolicies\r\n| where ConditionalAccessPolicies[\"id\"] == \"{policy:escape}\"\r\n| extend result = ConditionalAccessPolicies[\"result\"]\r\n| project-away ConditionalAccessPolicies\r\n// filter by the result type selected\r\n// Total = any result type (the result type will contain the empty string \"\")\r\n// Success = result types containing \"uccess\" (includes \"success\" and \"reportOnlySuccess\")\r\n// Failure = result types containing \"ailure\" (includes \"failure\" and \"reportOnlyFailure\")\r\n// User action required = result types containing \"nterrupt\" (includes \"interrupt\" and \"reportOnlyInterrupted\")\r\n// Not applied = result types containing \"ot\" (includes \"notApplied\", \"reportOnlyNotApplied\", and \"notEnabled\")\r\n| extend filterResult = case(\"{resultName}\" == \"Total\",\"\", \"{resultName}\" == \"Success\", \"uccess\", \"{resultName}\" == \"Failure\", \"ailure\", \"{resultName}\" == \"User action required\", \"nterrupted\",\"ot\")\r\n| where result contains filterResult\r\n{unit} summarize count() by UserPrincipalName, AppDisplayName\r\n| summarize Count = count() by AppDisplayName\r\n| sort by Count desc",
              "size": 1,
              "showAnalytics": true,
              "title": "Applications - {resultName}",
              "timeContext": {
                "durationMs": 86400000
              },
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "location",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "green",
                      "showIcon": true,
                      "aggregation": "Count"
                    }
                  },
                  {
                    "columnMatch": "Count",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "blue",
                      "showIcon": true,
                      "aggregation": "Max"
                    }
                  },
                  {
                    "columnMatch": "-- Group By --",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "green",
                      "showIcon": true
                    }
                  }
                ]
              }
            },
            "customWidth": "33",
            "conditionalVisibility": {
              "parameterName": "policy",
              "comparison": "isNotEqualTo",
              "value": "All"
            },
            "name": "Application - individual policies"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SigninLogs\r\n| where TimeGenerated {TimeRange:value}\r\n| project ConditionalAccessStatus, UserPrincipalName, AppDisplayName\r\n| where \"{User:escape}\" == \"All users\" or UserPrincipalName has \"{User:escape}\"\r\n| where \"{App:escape}\" == \"All apps\" or AppDisplayName has \"{App:escape}\"\r\n| extend filterResult = case(\"{resultName}\" == \"Total\",\"\", \"{resultName}\" == \"Success\", \"success\", \"{resultName}\" == \"Failure\", \"failure\", \"notApplied\")\r\n| where ConditionalAccessStatus contains filterResult\r\n{unit} summarize count() by UserPrincipalName, AppDisplayName\r\n| summarize Count = count() by AppDisplayName\r\n| sort by Count desc",
              "size": 1,
              "showAnalytics": true,
              "title": "Applications - {resultName}",
              "timeContext": {
                "durationMs": 86400000
              },
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "location",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "green",
                      "showIcon": true,
                      "aggregation": "Count"
                    }
                  },
                  {
                    "columnMatch": "Count",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "blue",
                      "showIcon": true,
                      "aggregation": "Max"
                    }
                  },
                  {
                    "columnMatch": "-- Group By --",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "green",
                      "showIcon": true
                    }
                  }
                ]
              }
            },
            "customWidth": "33",
            "conditionalVisibility": {
              "parameterName": "policy",
              "comparison": "isEqualTo",
              "value": "All"
            },
            "name": "Applications - all enabled policies"
          },
          {
            "type": 1,
            "content": {
              "json": "____________________________________________\r\n## Sign-in details\r\nðŸ’¡ _To investigate sign-in details of a specific user, filter by user principal name (UPN) at the top of the workbook_"
            },
            "conditionalVisibility": {
              "parameterName": "statusCode",
              "comparison": "isNotEqualTo",
              "value": "0"
            },
            "name": "Instructions 2"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SigninLogs\r\n| where TimeGenerated {TimeRange:value}\r\n| project ConditionalAccessPolicies, UserPrincipalName, AppDisplayName\r\n| where ConditionalAccessPolicies != \"[]\"\r\n| where \"{User:escape}\" == \"All users\" or UserPrincipalName has \"{User:escape}\"\r\n| where \"{App:escape}\" == \"All apps\" or AppDisplayName has \"{App:escape}\"\r\n| project-away AppDisplayName\r\n| mv-expand ConditionalAccessPolicies\r\n| where ConditionalAccessPolicies[\"id\"] == \"{policy:escape}\"\r\n| extend result = ConditionalAccessPolicies[\"result\"]\r\n| project-away ConditionalAccessPolicies\r\n// filter by the result type selected\r\n// Total = any result type (the result type will contain the empty string \"\")\r\n// Success = result types containing \"uccess\" (includes \"success\" and \"reportOnlySuccess\")\r\n// Failure = result types containing \"ailure\" (includes \"failure\" and \"reportOnlyFailure\")\r\n// User action required = result types containing \"nterrupt\" (includes \"interrupt\" and \"reportOnlyInterrupted\")\r\n// Not applied = result types containing \"ot\" (includes \"notApplied\", \"reportOnlyNotApplied\", and \"notEnabled\")\r\n| extend filterResult = case(\"{resultName}\" == \"Total\",\"\", \"{resultName}\" == \"Success\", \"uccess\", \"{resultName}\" == \"Failure\", \"ailure\", \"{resultName}\" == \"User action required\", \"nterrupted\",\"ot\")\r\n| where result contains filterResult\r\n| summarize Count = count() by UserPrincipalName\r\n| sort by Count desc",
              "size": 0,
              "showAnalytics": true,
              "title": "User sign-in count - {resultName}",
              "timeContext": {
                "durationMs": 86400000
              },
              "timeContextFromParameter": "TimeRange",
              "exportFieldName": "UserPrincipalName",
              "exportParameterName": "user",
              "exportDefaultValue": "*",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Count",
                    "formatter": 8,
                    "formatOptions": {
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "Signins",
                    "formatter": 8,
                    "formatOptions": {
                      "showIcon": true
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              }
            },
            "customWidth": "30",
            "conditionalVisibility": {
              "parameterName": "policy",
              "comparison": "isNotEqualTo",
              "value": "All"
            },
            "name": "User sign-in - individual policies"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SigninLogs\r\n| where TimeGenerated {TimeRange:value}\r\n| project ConditionalAccessStatus, UserPrincipalName, AppDisplayName\r\n| where \"{User:escape}\" == \"All users\" or UserPrincipalName has \"{User:escape}\"\r\n| where \"{App:escape}\" == \"All apps\" or AppDisplayName has \"{App:escape}\"\r\n| project-away AppDisplayName\r\n| extend filterResult = case(\"{resultName}\" == \"Total\",\"\", \"{resultName}\" == \"Success\", \"success\", \"{resultName}\" == \"Failure\", \"failure\", \"notApplied\")\r\n| where ConditionalAccessStatus contains filterResult\r\n| summarize Count = count() by UserPrincipalName\r\n| sort by Count desc",
              "size": 0,
              "showAnalytics": true,
              "title": "User sign-in count - {resultName}",
              "timeContext": {
                "durationMs": 86400000
              },
              "timeContextFromParameter": "TimeRange",
              "exportFieldName": "UserPrincipalName",
              "exportParameterName": "user",
              "exportDefaultValue": "*",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Count",
                    "formatter": 8,
                    "formatOptions": {
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "Signins",
                    "formatter": 8,
                    "formatOptions": {
                      "showIcon": true
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              }
            },
            "customWidth": "30",
            "conditionalVisibility": {
              "parameterName": "policy",
              "comparison": "isEqualTo",
              "value": "All"
            },
            "name": "User sign-in count - all enabled policies"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SigninLogs\r\n| where TimeGenerated {TimeRange:value}\r\n| project ConditionalAccessPolicies, TimeGenerated, UserPrincipalName, AppDisplayName, CorrelationId, Status\r\n| where ConditionalAccessPolicies != \"[]\"\r\n| where '{user:escape}' == '*' or '{user:escape}' == UserPrincipalName\r\n| where \"{User:escape}\" == \"All users\" or UserPrincipalName has \"{User:escape}\"\r\n| where \"{App:escape}\" == \"All apps\" or AppDisplayName has \"{App:escape}\"\r\n| mv-expand ConditionalAccessPolicies\r\n| where ConditionalAccessPolicies[\"id\"] == \"{policy:escape}\"\r\n| extend result = ConditionalAccessPolicies[\"result\"], failureReason = tostring(Status[\"failureReason\"])\r\n| project-away ConditionalAccessPolicies\r\n// filter by the result type selected\r\n// Total = any result type (the result type will contain the empty string \"\")\r\n// Success = result types containing \"uccess\" (includes \"success\" and \"reportOnlySuccess\")\r\n// Failure = result types containing \"ailure\" (includes \"failure\" and \"reportOnlyFailure\")\r\n// User action required = result types containing \"nterrupt\" (includes \"interrupt\" and \"reportOnlyInterrupted\")\r\n// Not applied = result types containing \"ot\" (includes \"notApplied\", \"reportOnlyNotApplied\", and \"notEnabled\")\r\n| extend filterResult = case(\"{resultName}\" == \"Total\",\"\", \"{resultName}\" == \"Success\", \"uccess\", \"{resultName}\" == \"Failure\", \"ailure\", \"{resultName}\" == \"User action required\", \"nterrupted\",\"ot\")\r\n| where result contains filterResult\r\n| project TimeGenerated, UserPrincipalName, AppDisplayName, result, CorrelationId\r\n| sort by TimeGenerated desc",
              "size": 0,
              "showAnalytics": true,
              "title": "Sign-in events - {resultName}",
              "timeContext": {
                "durationMs": 86400000
              },
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Signins",
                    "formatter": 0,
                    "formatOptions": {
                      "showIcon": true,
                      "aggregation": "Count"
                    }
                  },
                  {
                    "columnMatch": "combinedResult",
                    "formatter": 0,
                    "formatOptions": {
                      "showIcon": true,
                      "aggregation": "Count"
                    }
                  }
                ],
                "rowLimit": 1000,
                "filter": true
              }
            },
            "customWidth": "70",
            "conditionalVisibility": {
              "parameterName": "policy",
              "comparison": "isNotEqualTo",
              "value": "All"
            },
            "name": "Sign-in details - individual policies"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SigninLogs\r\n| where TimeGenerated {TimeRange:value}\r\n| project ConditionalAccessStatus, TimeGenerated, UserPrincipalName, AppDisplayName, CorrelationId, Status\r\n| where '{user:escape}' == '*' or '{user:escape}' == UserPrincipalName\r\n| where \"{User:escape}\" == \"All users\" or UserPrincipalName has \"{User:escape}\"\r\n| where \"{App:escape}\" == \"All apps\" or AppDisplayName has \"{App:escape}\"\r\n| extend filterResult = case(\"{resultName}\" == \"Total\",\"\", \"{resultName}\" == \"Success\", \"success\", \"{resultName}\" == \"Failure\", \"failure\", \"notApplied\")\r\n| where ConditionalAccessStatus contains filterResult\r\n| project TimeGenerated, UserPrincipalName, AppDisplayName, ConditionalAccessStatus, CorrelationId\r\n| sort by TimeGenerated desc",
              "size": 0,
              "showAnalytics": true,
              "title": "Sign-in events - {resultName}",
              "timeContext": {
                "durationMs": 86400000
              },
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Signins",
                    "formatter": 0,
                    "formatOptions": {
                      "showIcon": true,
                      "aggregation": "Count"
                    }
                  },
                  {
                    "columnMatch": "combinedResult",
                    "formatter": 0,
                    "formatOptions": {
                      "showIcon": true,
                      "aggregation": "Count"
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              }
            },
            "customWidth": "70",
            "conditionalVisibility": {
              "parameterName": "policy",
              "comparison": "isEqualTo",
              "value": "All"
            },
            "name": "Sign-in details - all enabled policies"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "identityType",
        "comparison": "isEqualTo",
        "value": "user"
      },
      "name": "User sign-ins tab"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "a51f7613-7f1e-4f77-835f-b5390b13a4f3",
            "version": "KqlParameterItem/1.0",
            "name": "policy",
            "label": "Conditional Access policy",
            "type": 2,
            "description": "Show result for all enabled policies. Cannot select individual policies that apply to service principals.",
            "isRequired": true,
            "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"579accbb-074e-44de-91ec-13a63f39508b\",\"mergeType\":\"union\",\"leftTable\":\"Static all enabled policies\",\"rightTable\":\"Graph call enabled\"},{\"id\":\"579accbb-074e-44de-91ec-13a63f39508c\",\"mergeType\":\"union\",\"leftTable\":\"Graph call enabled\",\"rightTable\":\"Graph call report-only\"}],\"projectRename\":[{\"originalName\":\"id\",\"mergedName\":\"id\",\"fromId\":\"unknown\"},{\"originalName\":\"name\",\"mergedName\":\"name\",\"fromId\":\"unknown\"},{\"originalName\":\"group\",\"mergedName\":\"group\",\"fromId\":\"unknown\"},{\"originalName\":\"[Static all enabled policies].id\",\"mergedName\":\"id1\",\"fromId\":\"579accbb-074e-44de-91ec-13a63f39508b\"},{\"originalName\":\"[Static all enabled policies].name\",\"mergedName\":\"name1\",\"fromId\":\"579accbb-074e-44de-91ec-13a63f39508b\"},{\"originalName\":\"[Static all enabled policies].group\",\"mergedName\":\"group1\",\"fromId\":\"579accbb-074e-44de-91ec-13a63f39508b\"}]}",
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "queryType": 7
          },
          {
            "id": "dfa8db4a-0f30-479b-9f11-70ad8d619a1e",
            "version": "KqlParameterItem/1.0",
            "name": "TimeRange",
            "label": "Time range",
            "type": 4,
            "isRequired": true,
            "value": {
              "durationMs": 86400000
            },
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 1800000
                },
                {
                  "durationMs": 3600000
                },
                {
                  "durationMs": 14400000
                },
                {
                  "durationMs": 43200000
                },
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 172800000
                },
                {
                  "durationMs": 259200000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 1209600000
                },
                {
                  "durationMs": 2419200000
                },
                {
                  "durationMs": 2592000000
                },
                {
                  "durationMs": 5184000000
                },
                {
                  "durationMs": 7776000000
                }
              ],
              "allowCustom": true
            }
          },
          {
            "id": "e3b79b8a-9866-40aa-9261-ed6aab1f76b2",
            "version": "KqlParameterItem/1.0",
            "name": "spid",
            "label": "Service Prinicpal ID",
            "type": 1,
            "description": "Exact match on service principal ID. Default value is \"All service principals\"",
            "value": "All service principals",
            "timeContext": {
              "durationMs": 86400000
            },
            "timeContextFromParameter": "TimeRange"
          },
          {
            "id": "dc9f0dd1-cbfe-4610-a8c7-414da5856a60",
            "version": "KqlParameterItem/1.0",
            "name": "App",
            "label": "Resource",
            "type": 1,
            "description": "Exact match on resource display name. Default value is \"All apps\"",
            "value": "All apps",
            "timeContext": {
              "durationMs": 86400000
            },
            "timeContextFromParameter": "TimeRange"
          },
          {
            "id": "3b0b16aa-ce0a-4940-813c-ec722560223a",
            "version": "KqlParameterItem/1.0",
            "name": "unit",
            "label": "Data view",
            "type": 2,
            "description": "Display results by number of service principals or number of sign-ins",
            "isRequired": true,
            "query": "let unit = datatable(label:string,units:string)\r\n[\"service principals\", \"|\",\r\n \"sign-ins\",\"//\"];\r\nunit \r\n| project Value = units, Label = label",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "value": "|",
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          }
        ],
        "style": "pills",
        "queryType": 7,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "conditionalVisibility": {
        "parameterName": "identityType",
        "comparison": "isEqualTo",
        "value": "servicePrincipal"
      },
      "name": "parameters - 1 - Copy"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## Impact summary\r\nðŸ’¡ *Click on the tiles below to filter the report by the selected Conditional Access result.*"
            },
            "name": "text - 21"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "// Total\r\nAADServicePrincipalSignInLogs\r\n| where TimeGenerated {TimeRange:value}\r\n| project ServicePrincipalId, ResourceDisplayName\r\n| where \"{spid:escape}\" == \"All service principals\" or ServicePrincipalId has \"{spid:escape}\"\r\n| where \"{App:escape}\" == \"All apps\" or ResourceDisplayName has \"{App:escape}\"\r\n| project-away ResourceDisplayName\r\n{unit} summarize count() by ServicePrincipalId\r\n| summarize count()\r\n| extend resultName = \"Total\", unit = case(\"{unit}\" == \"//\", \"sign-ins\",\"users\"), statusCode = 1\r\n//\r\n//\r\n// Number of success/failure/user action required/not applied\r\n| union (\r\nAADServicePrincipalSignInLogs\r\n| where TimeGenerated {TimeRange:value}\r\n| project ConditionalAccessStatus, ServicePrincipalId, ResourceDisplayName\r\n| where \"{spid:escape}\" == \"All service principals\" or ServicePrincipalId has \"{spid:escape}\"\r\n| where \"{App:escape}\" == \"All apps\" or ResourceDisplayName has \"{App:escape}\"\r\n| project-away ResourceDisplayName\r\n| extend resultName = case(ConditionalAccessStatus == \"success\", \"Success\", ConditionalAccessStatus == \"failure\", \"Failure\", \"Not applied\")\r\n| extend statusCode = case(ConditionalAccessStatus == \"success\", 2, ConditionalAccessStatus == \"failure\", 3, 4)\r\n{unit} summarize count() by resultName, ServicePrincipalId, statusCode\r\n| summarize count() by resultName, statusCode\r\n| extend unit = case(\"{unit}\" == \"//\", \"sign-ins\",\"users\")\r\n)\r\n//\r\n// Case if result count is 0\r\n| join kind = fullouter (\r\n    datatable (resultName:string,statusCode1:string)\r\n    [\"Total\", 1,\r\n     \"Success\", 2,\r\n     \"Failure\", 3,\r\n     \"Not applied\", 4]\r\n) on resultName\r\n| extend resultName = iff(resultName == '', resultName1, resultName), count_ = iff(resultName == '', 0, count_), unit = \"{unit:label}\", statusCode1\r\n| project-away resultName1\r\n| sort by statusCode1 asc",
              "size": 4,
              "showAnalytics": true,
              "timeContext": {
                "durationMs": 86400000
              },
              "timeContextFromParameter": "TimeRange",
              "exportFieldName": "resultName",
              "exportParameterName": "resultName",
              "exportDefaultValue": "Total",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "resultName",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "count_",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 2,
                      "maximumSignificantDigits": 3
                    }
                  }
                },
                "secondaryContent": {
                  "columnMatch": "unit",
                  "formatter": 1
                },
                "showBorder": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "policy",
              "comparison": "isEqualTo",
              "value": "All"
            },
            "name": "SPs - All Policies Summary"
          },
          {
            "type": 1,
            "content": {
              "json": "**Total**: Number of {unit:label} in the {TimeRange}</br>\r\n**Success**: Number of {unit:label} where the selected polic(ies) granted access and the required controls were satisifed</br>\r\n**Failure**: Number of {unit:label} where the selected polic(ies) denied access and the required controls were not satisfied</br>\r\n**Not applied**: Number of {unit:label} that are bypassing the selected polic(ies) because the sign-in did not match at least one of the assignments or conditions. "
            },
            "conditionalVisibility": {
              "parameterName": "Guide",
              "comparison": "isEqualTo",
              "value": "On"
            },
            "name": "Instructions 3"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "// Total\r\nAADServicePrincipalSignInLogs\r\n| where TimeGenerated {TimeRange:value}\r\n| project ConditionalAccessPolicies, ServicePrincipalId, ResourceDisplayName\r\n| where ConditionalAccessPolicies != \"[]\"\r\n| where \"{spid:escape}\" == \"All service principals\" or ServicePrincipalId has \"{spid:escape}\"\r\n| where \"{App:escape}\" == \"All apps\" or ResourceDisplayName has \"{App:escape}\"\r\n| project-away ResourceDisplayName\r\n| extend test15 = parse_json(ConditionalAccessPolicies)\r\n| mv-expand test15\r\n| where test15[\"id\"] == \"{policy:escape}\"\r\n| project-away test15\r\n{unit} summarize count() by ServicePrincipalId\r\n| summarize count()\r\n| extend resultName = \"Total\", unit = case(\"{unit}\" == \"//\", \"sign-ins\",\"Service Principals\"), statusCode = 1\r\n//\r\n//\r\n// Number of success/failure/user action required/not applied\r\n| union (\r\nAADServicePrincipalSignInLogs\r\n| where TimeGenerated {TimeRange:value}\r\n| project ConditionalAccessPolicies, ServicePrincipalId, ResourceDisplayName\r\n| where ConditionalAccessPolicies != \"[]\"\r\n| where \"{spid:escape}\" == \"All service principals\" or ServicePrincipalId has \"{spid:escape}\"\r\n| where \"{App:escape}\" == \"All apps\" or ResourceDisplayName has \"{App:escape}\"\r\n| project-away ResourceDisplayName\r\n| extend test15 = parse_json(ConditionalAccessPolicies)\r\n| mv-expand test15\r\n| where test15[\"id\"] == \"{policy:escape}\"\r\n| extend result = test15[\"result\"]\r\n| project-away test15\r\n| extend resultName = case(result == \"success\" or result == \"reportOnlySuccess\", \"Success\", result == \"failure\" or result == \"reportOnlyFailure\", \"Failure\", \"Not applied\")\r\n| extend statusCode = case(resultName == \"Success\", 2, resultName == \"Failure\", 3, 4)\r\n{unit} summarize count() by resultName, ServicePrincipalId, statusCode\r\n| summarize count() by resultName, statusCode\r\n| extend unit = case(\"{unit}\" == \"//\", \"sign-ins\",\"Service Principals\")\r\n)\r\n//\r\n// Case if result count is 0\r\n| join kind = fullouter (\r\n    datatable (resultName:string,statusCode1:string)\r\n    [\"Total\", 1,\r\n     \"Success\", 2,\r\n     \"Failure\", 3,\r\n     \"Not applied\", 4]\r\n) on resultName\r\n| extend resultName = iff(resultName == '', resultName1, resultName), count_ = iff(resultName == '', 0, count_), unit = \"{unit:label}\", statusCode1\r\n| project-away resultName1\r\n| sort by statusCode1 asc",
              "size": 3,
              "showAnalytics": true,
              "timeContext": {
                "durationMs": 86400000
              },
              "timeContextFromParameter": "TimeRange",
              "exportFieldName": "resultName",
              "exportParameterName": "resultName",
              "exportDefaultValue": "Total",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "resultName",
                  "formatter": 1,
                  "formatOptions": {
                    "showIcon": true
                  }
                },
                "leftContent": {
                  "columnMatch": "count_",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto",
                    "showIcon": true
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                },
                "secondaryContent": {
                  "columnMatch": "unit",
                  "formatter": 1,
                  "formatOptions": {
                    "showIcon": true
                  }
                },
                "showBorder": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "policy",
              "comparison": "isNotEqualTo",
              "value": "All"
            },
            "name": "SPs - Individual Policy Summary"
          },
          {
            "type": 1,
            "content": {
              "json": "__________________________________________\r\n## Breakdown per condition and sign-in status"
            },
            "conditionalVisibility": {
              "parameterName": "statusCode",
              "comparison": "isNotEqualTo",
              "value": "0"
            },
            "name": "text - 14"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "AADServicePrincipalSignInLogs\r\n| where TimeGenerated {TimeRange:value}\r\n| project ConditionalAccessPolicies, ServicePrincipalId, ResourceDisplayName, Location\r\n| where ConditionalAccessPolicies != \"\"\r\n| where \"{spid:escape}\" == \"All service principals\" or ServicePrincipalId has \"{spid:escape}\"\r\n| where \"{App:escape}\" == \"All apps\" or ResourceDisplayName has \"{App:escape}\"\r\n| project-away ResourceDisplayName\r\n| extend test15 = parse_json(ConditionalAccessPolicies)\r\n| mv-expand test15\r\n| where test15[\"id\"] == \"{policy:escape}\"\r\n| extend result = test15[\"result\"]\r\n| project-away test15\r\n// filter by the result type selected\r\n// Total = any result type (the result type will contain the empty string \"\")\r\n// Success = result types containing \"uccess\" (includes \"success\" and \"reportOnlySuccess\")\r\n// Failure = result types containing \"ailure\" (includes \"failure\" and \"reportOnlyFailure\")\r\n// User action required = result types containing \"nterrupt\" (includes \"interrupt\" and \"reportOnlyInterrupted\")\r\n// Not applied = result types containing \"ot\" (includes \"notApplied\", \"reportOnlyNotApplied\", and \"notEnabled\")\r\n| extend filterResult = case(\"{resultName}\" == \"Total\",\"\", \"{resultName}\" == \"Success\", \"uccess\", \"{resultName}\" == \"Failure\", \"ailure\", \"{resultName}\" == \"User action required\", \"nterrupted\",\"ot\")\r\n| where result contains filterResult\r\n{unit} summarize count() by ServicePrincipalId, Location\r\n| summarize Count = count() by Location\r\n| sort by Count desc",
              "size": 0,
              "showAnalytics": true,
              "title": "Location - {resultName}",
              "timeContext": {
                "durationMs": 86400000
              },
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "map",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "location",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "green",
                      "showIcon": true,
                      "aggregation": "Count"
                    }
                  },
                  {
                    "columnMatch": "Count",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "blue",
                      "showIcon": true,
                      "aggregation": "Max"
                    }
                  },
                  {
                    "columnMatch": "-- Group By --",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "green",
                      "showIcon": true
                    }
                  }
                ]
              },
              "mapSettings": {
                "locInfo": "CountryRegion",
                "locInfoColumn": "location",
                "sizeSettings": "Count",
                "sizeAggregation": "Sum",
                "labelSettings": "location",
                "legendMetric": "Count",
                "numberOfMetrics": 10,
                "legendAggregation": "Sum",
                "itemColorSettings": {
                  "nodeColorField": "Count",
                  "colorAggregation": "Sum",
                  "type": "heatmap",
                  "heatmapPalette": "greenRed"
                }
              }
            },
            "customWidth": "33",
            "conditionalVisibility": {
              "parameterName": "policy",
              "comparison": "isNotEqualTo",
              "value": "All"
            },
            "name": "Location - individual policies"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "AADServicePrincipalSignInLogs\r\n| where TimeGenerated {TimeRange:value}\r\n| project ConditionalAccessStatus, ServicePrincipalId, ResourceDisplayName, location = Location\r\n| where \"{spid:escape}\" == \"All service principals\" or ServicePrincipalId has \"{spid:escape}\"\r\n| where \"{App:escape}\" == \"All apps\" or ResourceDisplayName has \"{App:escape}\"\r\n| project-away ResourceDisplayName\r\n| extend filterResult = case(\"{resultName}\" == \"Total\",\"\", \"{resultName}\" == \"Success\", \"success\", \"{resultName}\" == \"Failure\", \"failure\", \"notApplied\")\r\n| where ConditionalAccessStatus contains filterResult\r\n{unit} summarize count() by ServicePrincipalId, location\r\n| summarize Count = count() by location\r\n| sort by Count desc",
              "size": 0,
              "showAnalytics": true,
              "title": "Location - {resultName}",
              "timeContext": {
                "durationMs": 86400000
              },
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "map",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "location",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "green",
                      "showIcon": true,
                      "aggregation": "Count"
                    }
                  },
                  {
                    "columnMatch": "Count",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "blue",
                      "showIcon": true,
                      "aggregation": "Max"
                    }
                  },
                  {
                    "columnMatch": "-- Group By --",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "green",
                      "showIcon": true
                    }
                  }
                ]
              },
              "mapSettings": {
                "locInfo": "CountryRegion",
                "locInfoColumn": "location",
                "sizeSettings": "Count",
                "sizeAggregation": "Sum",
                "labelSettings": "location",
                "legendMetric": "Count",
                "legendAggregation": "Sum",
                "itemColorSettings": {
                  "nodeColorField": "Count",
                  "colorAggregation": "Sum",
                  "type": "heatmap",
                  "heatmapPalette": "greenRed"
                }
              }
            },
            "customWidth": "33",
            "conditionalVisibility": {
              "parameterName": "policy",
              "comparison": "isEqualTo",
              "value": "All"
            },
            "name": "Location - all enabled policies"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "AADServicePrincipalSignInLogs\r\n| where TimeGenerated {TimeRange:value}\r\n| project ConditionalAccessPolicies, ServicePrincipalId, ResourceDisplayName\r\n| where ConditionalAccessPolicies != \"[]\"\r\n| where \"{spid:escape}\" == \"All service principals\" or ServicePrincipalId has \"{spid:escape}\"\r\n| where \"{App:escape}\" == \"All apps\" or ResourceDisplayName has \"{App:escape}\"\r\n| extend test15 = parse_json(ConditionalAccessPolicies)\r\n| mv-expand test15\r\n| where test15[\"id\"] == \"{policy:escape}\"\r\n| extend result = test15[\"result\"]\r\n| project-away test15\r\n// filter by the result type selected\r\n// Total = any result type (the result type will contain the empty string \"\")\r\n// Success = result types containing \"uccess\" (includes \"success\" and \"reportOnlySuccess\")\r\n// Failure = result types containing \"ailure\" (includes \"failure\" and \"reportOnlyFailure\")\r\n// User action required = result types containing \"nterrupt\" (includes \"interrupt\" and \"reportOnlyInterrupted\")\r\n// Not applied = result types containing \"ot\" (includes \"notApplied\", \"reportOnlyNotApplied\", and \"notEnabled\")\r\n| extend filterResult = case(\"{resultName}\" == \"Total\",\"\", \"{resultName}\" == \"Success\", \"uccess\", \"{resultName}\" == \"Failure\", \"ailure\", \"{resultName}\" == \"User action required\", \"nterrupted\",\"ot\")\r\n| where result contains filterResult\r\n{unit} summarize count() by ServicePrincipalId, ResourceDisplayName\r\n| summarize Count = count() by ResourceDisplayName\r\n| sort by Count desc",
              "size": 1,
              "showAnalytics": true,
              "title": "Resources - {resultName}",
              "timeContext": {
                "durationMs": 86400000
              },
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "location",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "green",
                      "showIcon": true,
                      "aggregation": "Count"
                    }
                  },
                  {
                    "columnMatch": "Count",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "blue",
                      "showIcon": true,
                      "aggregation": "Max"
                    }
                  },
                  {
                    "columnMatch": "-- Group By --",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "green",
                      "showIcon": true
                    }
                  }
                ]
              }
            },
            "customWidth": "33",
            "conditionalVisibility": {
              "parameterName": "policy",
              "comparison": "isNotEqualTo",
              "value": "All"
            },
            "name": "Application - individual policies"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "AADServicePrincipalSignInLogs\r\n| where TimeGenerated {TimeRange:value}\r\n| project ConditionalAccessStatus, ServicePrincipalId   , ResourceDisplayName\r\n| where \"{spid:escape}\" == \"All service principals\" or ServicePrincipalId has \"{spid:escape}\"\r\n| where \"{App:escape}\" == \"All apps\" or ResourceDisplayName has \"{App:escape}\"\r\n| extend filterResult = case(\"{resultName}\" == \"Total\",\"\", \"{resultName}\" == \"Success\", \"success\", \"{resultName}\" == \"Failure\", \"failure\", \"notApplied\")\r\n| where ConditionalAccessStatus contains filterResult\r\n{unit} summarize count() by ServicePrincipalId, ResourceDisplayName\r\n| summarize Count = count() by ResourceDisplayName\r\n| sort by Count desc",
              "size": 1,
              "showAnalytics": true,
              "title": "Resources - {resultName}",
              "timeContext": {
                "durationMs": 86400000
              },
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "location",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "green",
                      "showIcon": true,
                      "aggregation": "Count"
                    }
                  },
                  {
                    "columnMatch": "Count",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "blue",
                      "showIcon": true,
                      "aggregation": "Max"
                    }
                  },
                  {
                    "columnMatch": "-- Group By --",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "green",
                      "showIcon": true
                    }
                  }
                ]
              }
            },
            "customWidth": "33",
            "conditionalVisibility": {
              "parameterName": "policy",
              "comparison": "isEqualTo",
              "value": "All"
            },
            "name": "Applications - all enabled policies"
          },
          {
            "type": 1,
            "content": {
              "json": "____________________________________________\r\n## Sign-in details\r\nðŸ’¡ _To investigate sign-in details of a specific service principal, filter by service principal ID at the top of the workbook_"
            },
            "conditionalVisibility": {
              "parameterName": "statusCode",
              "comparison": "isNotEqualTo",
              "value": "0"
            },
            "name": "Instructions 4"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "AADServicePrincipalSignInLogs\r\n| where TimeGenerated {TimeRange:value}\r\n| project ConditionalAccessPolicies, ServicePrincipalId, ResourceDisplayName\r\n| where ConditionalAccessPolicies != \"[]\"\r\n| where \"{spid:escape}\" == \"All service principals\" or ServicePrincipalId has \"{spid:escape}\"\r\n| where \"{App:escape}\" == \"All apps\" or ResourceDisplayName has \"{App:escape}\"\r\n| project-away ResourceDisplayName\r\n| extend test15 = parse_json(ConditionalAccessPolicies)\r\n| mv-expand test15\r\n| where test15[\"id\"] == \"{policy:escape}\"\r\n| extend result = test15[\"result\"]\r\n| project-away test15\r\n// filter by the result type selected\r\n// Total = any result type (the result type will contain the empty string \"\")\r\n// Success = result types containing \"uccess\" (includes \"success\" and \"reportOnlySuccess\")\r\n// Failure = result types containing \"ailure\" (includes \"failure\" and \"reportOnlyFailure\")\r\n// User action required = result types containing \"nterrupt\" (includes \"interrupt\" and \"reportOnlyInterrupted\")\r\n// Not applied = result types containing \"ot\" (includes \"notApplied\", \"reportOnlyNotApplied\", and \"notEnabled\")\r\n| extend filterResult = case(\"{resultName}\" == \"Total\",\"\", \"{resultName}\" == \"Success\", \"uccess\", \"{resultName}\" == \"Failure\", \"ailure\", \"{resultName}\" == \"User action required\", \"nterrupted\",\"ot\")\r\n| where result contains filterResult\r\n| summarize Count = count() by ServicePrincipalId\r\n| sort by Count desc",
              "size": 0,
              "showAnalytics": true,
              "title": "Service Principal sign-in count - {resultName}",
              "timeContext": {
                "durationMs": 86400000
              },
              "timeContextFromParameter": "TimeRange",
              "exportFieldName": "UserPrincipalName",
              "exportParameterName": "user",
              "exportDefaultValue": "*",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Count",
                    "formatter": 8,
                    "formatOptions": {
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "Signins",
                    "formatter": 8,
                    "formatOptions": {
                      "showIcon": true
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              }
            },
            "customWidth": "30",
            "conditionalVisibility": {
              "parameterName": "policy",
              "comparison": "isNotEqualTo",
              "value": "All"
            },
            "name": "User sign-in - individual policies"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "AADServicePrincipalSignInLogs\r\n| where TimeGenerated {TimeRange:value}\r\n| project ConditionalAccessStatus, ServicePrincipalId, ResourceDisplayName\r\n| where \"{spid:escape}\" == \"All service principals\" or ServicePrincipalId has \"{spid:escape}\"\r\n| where \"{App:escape}\" == \"All apps\" or ResourceDisplayName has \"{App:escape}\"\r\n| project-away ResourceDisplayName\r\n| extend filterResult = case(\"{resultName}\" == \"Total\",\"\", \"{resultName}\" == \"Success\", \"success\", \"{resultName}\" == \"Failure\", \"failure\", \"notApplied\")\r\n| where ConditionalAccessStatus contains filterResult\r\n| summarize Count = count() by ServicePrincipalId\r\n| sort by Count desc",
              "size": 0,
              "showAnalytics": true,
              "title": "Service principal sign-in count - {resultName}",
              "timeContext": {
                "durationMs": 86400000
              },
              "timeContextFromParameter": "TimeRange",
              "exportFieldName": "ServicePrincipalId",
              "exportParameterName": "sp",
              "exportDefaultValue": "*",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Count",
                    "formatter": 8,
                    "formatOptions": {
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "Signins",
                    "formatter": 8,
                    "formatOptions": {
                      "showIcon": true
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              }
            },
            "customWidth": "30",
            "conditionalVisibility": {
              "parameterName": "policy",
              "comparison": "isEqualTo",
              "value": "All"
            },
            "name": "User sign-in count - all enabled policies"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "AADServicePrincipalSignInLogs\r\n| where TimeGenerated {TimeRange:value}\r\n| project ConditionalAccessPolicies, TimeGenerated, ServicePrincipalId, ResourceDisplayName, CorrelationId\r\n| where ConditionalAccessPolicies != \"[]\"\r\n| where \"{spid:escape}\" == \"All service principals\" or ServicePrincipalId has \"{spid:escape}\"\r\n| where \"{App:escape}\" == \"All apps\" or ResourceDisplayName has \"{App:escape}\"\r\n| extend test15 = parse_json(ConditionalAccessPolicies)\r\n| mv-expand test15\r\n| where test15[\"id\"] == \"{policy:escape}\"\r\n| extend result = test15[\"result\"]//, failureReason = tostring(Status[\"failureReason\"])\r\n| project-away test15\r\n| extend filterResult = case(\"{resultName}\" == \"Total\",\"\", \"{resultName}\" == \"Success\", \"success\", \"{resultName}\" == \"Failure\", \"failure\", \"notApplied\")\r\n| where result contains filterResult\r\n| project TimeGenerated, ServicePrincipalId, ResourceDisplayName, result, CorrelationId\r\n| sort by TimeGenerated desc",
              "size": 0,
              "showAnalytics": true,
              "title": "Sign-in events - {resultName}",
              "timeContext": {
                "durationMs": 86400000
              },
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Signins",
                    "formatter": 0,
                    "formatOptions": {
                      "showIcon": true,
                      "aggregation": "Count"
                    }
                  },
                  {
                    "columnMatch": "combinedResult",
                    "formatter": 0,
                    "formatOptions": {
                      "showIcon": true,
                      "aggregation": "Count"
                    }
                  }
                ],
                "rowLimit": 1000,
                "filter": true
              }
            },
            "customWidth": "70",
            "conditionalVisibility": {
              "parameterName": "policy",
              "comparison": "isNotEqualTo",
              "value": "All"
            },
            "name": "Sign-in details - individual policies"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "AADServicePrincipalSignInLogs\r\n| where TimeGenerated {TimeRange:value}\r\n| project ConditionalAccessStatus, TimeGenerated, ServicePrincipalId, ResourceDisplayName, CorrelationId\r\n| where '{sp:escape}' == '*' or '{sp:escape}' == ServicePrincipalId\r\n| where \"{spid:escape}\" == \"All service principals\" or ServicePrincipalId has \"{spid:escape}\"\r\n| where \"{App:escape}\" == \"All apps\" or ResourceDisplayName has \"{App:escape}\"\r\n| extend filterResult = case(\"{resultName}\" == \"Total\",\"\", \"{resultName}\" == \"Success\", \"success\", \"{resultName}\" == \"Failure\", \"failure\", \"notApplied\")\r\n| where ConditionalAccessStatus contains filterResult\r\n| project TimeGenerated, ServicePrincipalId, ResourceDisplayName, ConditionalAccessStatus, CorrelationId\r\n| sort by TimeGenerated desc",
              "size": 0,
              "showAnalytics": true,
              "title": "Sign-in events - {resultName}",
              "timeContext": {
                "durationMs": 86400000
              },
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Signins",
                    "formatter": 0,
                    "formatOptions": {
                      "showIcon": true,
                      "aggregation": "Count"
                    }
                  },
                  {
                    "columnMatch": "combinedResult",
                    "formatter": 0,
                    "formatOptions": {
                      "showIcon": true,
                      "aggregation": "Count"
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              }
            },
            "customWidth": "70",
            "conditionalVisibility": {
              "parameterName": "policy",
              "comparison": "isEqualTo",
              "value": "All"
            },
            "name": "Sign-in details - all enabled policies"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "identityType",
        "comparison": "isEqualTo",
        "value": "servicePrincipal"
      },
      "name": "Service principal sign-ins tab"
    }
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}
