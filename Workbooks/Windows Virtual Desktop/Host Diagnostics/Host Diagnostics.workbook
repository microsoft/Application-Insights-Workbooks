{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "b859a03f-2283-43dd-8536-42714bbfced6",
            "version": "KqlParameterItem/1.0",
            "name": "Subscription",
            "type": 6,
            "isRequired": true,
            "query": "summarize Count = count() by subscriptionId\r\n| project value = strcat('/subscriptions/', subscriptionId), label = subscriptionId, Selected = Count >= 0",
            "crossComponentResources": [
              "value::selected"
            ],
            "typeSettings": {
              "additionalResourceOptions": []
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "2e3dfd9b-2d0f-4feb-94e8-107f220c4e28",
            "version": "KqlParameterItem/1.0",
            "name": "ResourceGroup",
            "type": 5,
            "isRequired": true,
            "query": "resources\r\n| where type contains  \"desktopvirtualization\"\r\n| summarize Count = count() by resourceGroup\r\n| project Label = resourceGroup, Id = resourceGroup, Selected = Count >= 0",
            "crossComponentResources": [
              "{Subscription}"
            ],
            "typeSettings": {
              "additionalResourceOptions": []
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "951b5870-e216-45c6-b159-34150868a46e",
            "version": "KqlParameterItem/1.0",
            "name": "HostPool",
            "type": 5,
            "isRequired": true,
            "query": "resources\r\n| where type == \"microsoft.desktopvirtualization/hostpools\" and resourceGroup == \"{ResourceGroup}\"\r\n",
            "crossComponentResources": [
              "{Subscription}"
            ],
            "typeSettings": {
              "additionalResourceOptions": []
            },
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "966a75f4-f4a4-4404-b649-67da45ddf636",
            "version": "KqlParameterItem/1.0",
            "name": "WVDHosts",
            "type": 5,
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourcegroups/{ResourceGroup}/providers/Microsoft.DesktopVirtualization/hostpools/{HostPool:label}/sessionhosts?api-version=2019-01-23-preview\",\"urlParams\":[],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"$.name\",\"columnid\":\"Name\"}]}}]}",
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ]
            },
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "TimeRange",
            "defaultValue": "value::all",
            "queryType": 12,
            "value": [
              "value::all"
            ]
          },
          {
            "id": "04a8ead2-1fb2-4666-a7b0-6d92e3c29b46",
            "version": "KqlParameterItem/1.0",
            "name": "TimeRange",
            "type": 4,
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 1800000
                },
                {
                  "durationMs": 3600000
                },
                {
                  "durationMs": 14400000
                },
                {
                  "durationMs": 43200000
                },
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 172800000
                },
                {
                  "durationMs": 259200000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 1209600000
                },
                {
                  "durationMs": 2592000000
                },
                {
                  "durationMs": 5184000000
                },
                {
                  "durationMs": 7776000000
                }
              ],
              "allowCustom": true
            },
            "value": {
              "durationMs": 172800000
            },
            "label": "Time range"
          },
          {
            "id": "ff8c2838-aaf0-40f6-a604-d4bfe72fc92f",
            "version": "KqlParameterItem/1.0",
            "name": "poolla",
            "type": 5,
            "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/{HostPool}/providers/microsoft.insights/diagnosticSettings?api-version=2021-05-01-preview\",\"urlParams\":[],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"$.properties.workspaceId\",\"columnid\":\"id\"},{\"path\":\"$.id\",\"columnid\":\"selected\"}]}}]}",
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 12
          },
          {
            "id": "08f46c2a-f080-40c5-b36f-acd0e80c6259",
            "version": "KqlParameterItem/1.0",
            "name": "WorkspaceId",
            "type": 1,
            "query": "resources\r\n| where type =~ \"Microsoft.Compute/virtualMachines/extensions\"and properties.type == \"MicrosoftMonitoringAgent\"\r\n| where id contains extract(\"/(.*?)[.]\",1,\"{WVDHosts}\")\r\n| project Value = parse_json(properties.settings).workspaceId, selected=true\r\n| limit 1",
            "crossComponentResources": [
              "{Subscription}"
            ],
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "29c8282b-4c11-409c-b4e9-1049edbaf67a",
            "version": "KqlParameterItem/1.0",
            "name": "Workspace",
            "type": 5,
            "query": "resources\r\n| where type == \"microsoft.operationalinsights/workspaces\"\r\n| where properties.customerId == \"{WorkspaceId}\"",
            "crossComponentResources": [
              "value::selected"
            ],
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": []
            },
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "6c8ec0d1-d1e2-4324-8b1d-e01e3c53d789",
            "version": "KqlParameterItem/1.0",
            "name": "hostnames",
            "type": 5,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "let WVDHosts = dynamic([{WVDHosts}]);\r\nlet hostPool = \"{HostPool:label}\";\r\ndatatable (hosts:dynamic)[dynamic([{WVDHosts}])]\r\n| mv-expand hosts\r\n| project hosts=split(hosts,\"/\")[1]\r\n| project hosts=split(hosts,\".\")[0], selected=1\r\n",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": []
            },
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 0,
            "resourceType": "microsoft.insights/components"
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "parameters_general"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "b25ad595-1722-4ed6-ab15-17d45003785d",
                  "version": "KqlParameterItem/1.0",
                  "name": "showall",
                  "label": "Show All Computers",
                  "type": 10,
                  "isRequired": true,
                  "isHiddenWhenLocked": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[{\"value\":\" | where 1==1 \", \"label\":\"yes\", \"selected\":false },\r\n{\"value\":\"| extend Computername = strcat(hostPool, '/', Computer)| where Computername in~ (WVDHosts)\", \"label\":\"no\" , \"selected\":true }]",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters_allcomputers"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "parameters": [
                {
                  "id": "a7ee9b2b-2d75-46ec-b1c4-579396d2305b",
                  "version": "KqlParameterItem/1.0",
                  "name": "EventsToInclude",
                  "label": "Events to include",
                  "type": 2,
                  "description": "Option to allow for testing the agent message, if no agent messages exist in the data set",
                  "isRequired": true,
                  "isHiddenWhenLocked": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\r\n    {\r\n        \"value\": \"and Source == \\\"WVD-Agent\\\"\",\r\n        \"label\": \"WVD Agent events only\",\r\n        \"selected\": \"true\"\r\n    },\r\n    {\r\n        \"value\": \"and 1==1\",\r\n        \"label\": \"All events (DEBUG)\"\r\n    }\r\n]",
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange"
                },
                {
                  "id": "4c0874af-922a-463b-8a4f-ad008e5a7259",
                  "version": "KqlParameterItem/1.0",
                  "name": "EventLevelName",
                  "type": 10,
                  "description": "This allows for more natural phrasing in the message. If all agent events are only error or only warning, it will print the corresponding level. Otherwise, it will say \"Error and/or Warning\"",
                  "isRequired": true,
                  "query": "let WVDHosts = dynamic([{WVDHosts}]);\r\nEvent\r\n| where WVDHosts contains Computer and EventLog == \"Application\" and EventLevel in (1,2) {EventsToInclude}\r\n| distinct EventLevelName\r\n| summarize value=coalesce(strcat_array(array_sort_asc(make_set(EventLevelName)), \", \"), \"N/A\")\r\n| extend label=value, selected=1",
                  "crossComponentResources": [
                    "{Workspace}"
                  ],
                  "isHiddenWhenLocked": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "2c92bb79-c53d-46d4-85bb-a92bb32c9994",
                  "version": "KqlParameterItem/1.0",
                  "name": "MessageFormatting",
                  "type": 10,
                  "description": "Find the highest agent message level, to format the warning text accordingly. Error formatting takes precedence over warnings.",
                  "isRequired": true,
                  "query": "// Find the highest agent message level, to format the warning text accordingly. Error formatting takes precedence over warnings.\r\nprint value=case(\"{EventLevelName}\" contains \"Error\", 5, \"{EventLevelName}\" contains \"Warning\", 4, 0)\r\n| extend label=value, selected=1",
                  "crossComponentResources": [
                    "{Workspace}"
                  ],
                  "isHiddenWhenLocked": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "eb4901b0-bd91-4722-83a3-895a4e72b4c0",
                  "version": "KqlParameterItem/1.0",
                  "name": "HostsWithAgentEvents",
                  "type": 10,
                  "description": "The count of hosts with agents that are writing messages to the event log",
                  "isRequired": true,
                  "query": "// The count of hosts with agents that are writing messages to the event log\r\nlet WVDHosts = dynamic([{WVDHosts}]);\r\nEvent\r\n| where WVDHosts contains Computer and EventLog == \"Application\" and EventLevel in (1,2) {EventsToInclude}\r\n| summarize value=dcount(_ResourceId)+0\r\n| extend label=value, selected=1",
                  "crossComponentResources": [
                    "{Workspace}"
                  ],
                  "isHiddenWhenLocked": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "fe2e42fd-4029-4231-b90d-6b3ccf3bc24e",
                  "version": "KqlParameterItem/1.0",
                  "name": "TotalEventInstances",
                  "type": 10,
                  "description": "The count of messages written to the event log",
                  "isRequired": true,
                  "query": "// The count of messages written to the event log\r\nlet WVDHosts = dynamic([{WVDHosts}]);\r\nEvent\r\n| where WVDHosts contains Computer and EventLog == \"Application\" and EventLevel in (1,2) {EventsToInclude}\r\n| summarize value=count()\r\n| extend label=value, selected=1",
                  "crossComponentResources": [
                    "{Workspace}"
                  ],
                  "isHiddenWhenLocked": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "6daa5288-82ec-43d3-b9df-bc8485c314f4",
                  "version": "KqlParameterItem/1.0",
                  "name": "DistinctEventCount",
                  "type": 10,
                  "description": "The count of distinct messages written to the event log",
                  "isRequired": true,
                  "query": "// The count of distinct messages written to the event log\r\nlet WVDHosts = dynamic([{WVDHosts}]);\r\nEvent\r\n| where WVDHosts contains Computer and EventLog == \"Application\" and EventLevel in (1,2) {EventsToInclude}\r\n| summarize value=dcount(RenderedDescription)+0\r\n| extend label=value, selected=1",
                  "crossComponentResources": [
                    "{Workspace}"
                  ],
                  "isHiddenWhenLocked": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "WvdAgentParameters"
          },
          {
            "type": 1,
            "content": {
              "json": "There are no AVD host agents reporting errors or warnings to the event log in the selected time range.",
              "style": "success"
            },
            "conditionalVisibility": {
              "parameterName": "TotalEventInstances",
              "comparison": "isEqualTo",
              "value": "0"
            },
            "name": "WVD Agent Event Text For No Events",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 1,
            "content": {
              "json": "One or more AVD hosts are reporting issues to the event log. See the **AVD agent events** table below to learn more about these issues. Observed issue levels: **{EventLevelName}**, number of hosts affected: **{HostsWithAgentEvents}**, distinct issue types: **{DistinctEventCount}**, total instances of issues: **{TotalEventInstances}**",
              "style": "{MessageFormatting}"
            },
            "customWidth": "100",
            "conditionalVisibility": {
              "parameterName": "TotalEventInstances",
              "comparison": "isNotEqualTo",
              "value": "0"
            },
            "name": "WVD Agent Event Text",
            "styleSettings": {
              "margin": "10px",
              "maxWidth": "1200px",
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let WVDHosts = dynamic([{WVDHosts}]);\r\nEvent\r\n| where WVDHosts contains Computer and EventLog == \"Application\" and EventLevel in (1,2) {EventsToInclude}\r\n| summarize HostCount=dcount(_ResourceId), EventCount=count(), LastSeen=max(TimeGenerated) by EventLevel, EventLevelName, EventID, RenderedDescription\r\n| sort by EventLevel desc, EventCount desc",
                    "size": 1,
                    "title": "AVD agent events by description",
                    "timeContextFromParameter": "TimeRange",
                    "exportFieldName": "EventID",
                    "exportParameterName": "SelectedWvdAgentEvent",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "EventLevel",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "EventLevelName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Information",
                                "representation": "1",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Warning",
                                "representation": "2",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Error",
                                "representation": "3",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Critical",
                                "representation": "critical",
                                "text": "{0}{1}"
                              },
                              {
                                "thresholdValue": "Success",
                                "representation": "success",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ],
                            "customColumnWidthSetting": "15ch"
                          }
                        },
                        {
                          "columnMatch": "EventID",
                          "formatter": 1,
                          "formatOptions": {
                            "customColumnWidthSetting": "14ch"
                          }
                        },
                        {
                          "columnMatch": "RenderedDescription",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "GenericDetails",
                            "linkIsContextBlade": true,
                            "customColumnWidthSetting": "72ch"
                          }
                        },
                        {
                          "columnMatch": "HostCount",
                          "formatter": 4,
                          "formatOptions": {
                            "min": 0,
                            "palette": "magenta",
                            "compositeBarSettings": {
                              "labelText": "",
                              "columnSettings": [
                                {
                                  "columnName": "HostCount",
                                  "color": "magenta"
                                },
                                {
                                  "columnName": "EventCount",
                                  "color": "blue"
                                }
                              ]
                            },
                            "customColumnWidthSetting": "76px"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "EventCount",
                          "formatter": 4,
                          "formatOptions": {
                            "min": 0,
                            "palette": "blue",
                            "customColumnWidthSetting": "82px"
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "LastSeen",
                          "formatter": 6,
                          "formatOptions": {
                            "customColumnWidthSetting": "24ch"
                          }
                        }
                      ],
                      "rowLimit": 5000,
                      "sortBy": [
                        {
                          "itemKey": "$gen_bar_HostCount_4",
                          "sortOrder": 2
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "EventLevelName",
                          "label": "Event level"
                        },
                        {
                          "columnId": "EventID",
                          "label": "Event ID"
                        },
                        {
                          "columnId": "RenderedDescription",
                          "label": "Description"
                        },
                        {
                          "columnId": "HostCount",
                          "label": "Hosts"
                        },
                        {
                          "columnId": "EventCount",
                          "label": "Events"
                        },
                        {
                          "columnId": "LastSeen",
                          "label": "Last seen"
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_bar_HostCount_4",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "customWidth": "65",
                  "conditionalVisibility": {
                    "parameterName": "TotalEventInstances",
                    "comparison": "isNotEqualTo",
                    "value": "0"
                  },
                  "showPin": false,
                  "name": "WVD agent event summary",
                  "styleSettings": {
                    "padding": "10px",
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let WVDHosts = dynamic([{WVDHosts}]);\r\nEvent\r\n| where WVDHosts contains Computer and EventLog == \"Application\" and EventLevel in (1,2) and EventID == \"{SelectedWvdAgentEvent}\" {EventsToInclude}\r\n| as SourceData\r\n| summarize Events=count() by _ResourceId\r\n| join kind=inner\r\n(\r\n    SourceData\r\n    | make-series OverTime=count() on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by _ResourceId    \r\n) on _ResourceId\r\n| project _ResourceId, Events, OverTime",
                    "size": 1,
                    "title": "Events per host",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "_ResourceId",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "22.857ch"
                          }
                        },
                        {
                          "columnMatch": "Events",
                          "formatter": 4,
                          "formatOptions": {
                            "min": 0,
                            "palette": "blue",
                            "customColumnWidthSetting": "95px"
                          }
                        },
                        {
                          "columnMatch": "OverTime",
                          "formatter": 21,
                          "formatOptions": {
                            "palette": "blue",
                            "customColumnWidthSetting": "210px"
                          }
                        }
                      ],
                      "rowLimit": 5000,
                      "sortBy": [
                        {
                          "itemKey": "$gen_link__ResourceId_0",
                          "sortOrder": 1
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "_ResourceId",
                          "label": "Host"
                        },
                        {
                          "columnId": "OverTime",
                          "label": "Over time"
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_link__ResourceId_0",
                        "sortOrder": 1
                      }
                    ]
                  },
                  "customWidth": "35",
                  "conditionalVisibility": {
                    "parameterName": "SelectedWvdAgentEvent",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "WVD agent events per host",
                  "styleSettings": {
                    "padding": "10px",
                    "showBorder": true
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "Select an event on the left side to see more details.",
                    "style": "info"
                  },
                  "customWidth": "35",
                  "conditionalVisibility": {
                    "parameterName": "SelectedWvdAgentEvent",
                    "comparison": "isEqualTo"
                  },
                  "name": "SelectedWvdAgentEventGuidance",
                  "styleSettings": {
                    "padding": "10px"
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "TotalEventInstances",
              "comparison": "isNotEqualTo",
              "value": "0"
            },
            "name": "WVD Agent Events Group"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "template",
              "title": "Host pool details",
              "loadFromTemplateId": "community-Workbooks/Windows Virtual Desktop/shared/Host Pool Overview",
              "items": []
            },
            "name": "SessionHostDetailsGroup",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Performance counters",
              "items": [
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "parameters": [
                      {
                        "id": "c3cfc2ba-dcc6-43ba-9988-f972f0bdfd24",
                        "version": "KqlParameterItem/1.0",
                        "name": "CPUThreshold",
                        "label": "CPU threshold %",
                        "type": 1,
                        "value": "60",
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      },
                      {
                        "id": "60ccdcb0-b0b8-4674-85dd-a6288eb10a5a",
                        "version": "KqlParameterItem/1.0",
                        "name": "FreeDiskSpace",
                        "label": "Free disk space",
                        "type": 1,
                        "value": "20",
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      },
                      {
                        "id": "b8a6b1fb-b2b3-4afa-b4d9-acd72bcec99f",
                        "version": "KqlParameterItem/1.0",
                        "name": "InputDelay",
                        "label": "Input delay",
                        "type": 1,
                        "value": "500",
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      },
                      {
                        "id": "15684ce2-a2a7-4e2c-9e14-7ed8bda18be9",
                        "version": "KqlParameterItem/1.0",
                        "name": "AvailableMBytes",
                        "label": "Available MBytes",
                        "type": 1,
                        "value": "2000",
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      },
                      {
                        "id": "00a44e6b-a872-4ffe-b3a6-addf716f852c",
                        "version": "KqlParameterItem/1.0",
                        "name": "PageFaultssec",
                        "label": "Page faults/sec",
                        "type": 1,
                        "value": "10000"
                      },
                      {
                        "id": "bc19009c-e60f-4d4b-adf1-2312e5449045",
                        "version": "KqlParameterItem/1.0",
                        "name": "numberofvms",
                        "type": 1,
                        "query": "let WVDHosts = dynamic([{WVDHosts}]);\r\nlet hostPool = \"{HostPool:label}\";\r\nHeartbeat\r\n| where TimeGenerated {TimeRange:query}\r\n{showall}\r\n| distinct Computer\r\n| summarize count()",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "isHiddenWhenLocked": true,
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      },
                      {
                        "id": "2f779c70-a4af-4e80-8445-23f73e363ebf",
                        "version": "KqlParameterItem/1.0",
                        "name": "Period",
                        "label": "Threshold duration (min)",
                        "type": 1,
                        "description": "This the time the performance value needs to hit the threshold for it to be flagged.",
                        "value": "5"
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "name": "parameters_perfcounters"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let WVDHosts = dynamic([{WVDHosts}]);\r\nlet hostPool = \"{HostPool:label}\";\r\nlet GetPerfSummary = (object:string, countername:string, instance:string, name:string, threshold:real, gt:bool)\r\n{\r\nlet myfilter = repeat(1,{Period});\r\nlet TotalTime = tolong(\r\ntoscalar(\r\n  Perf\r\n    | where TimeGenerated {TimeRange:query}\r\n    {showall}\r\n    | where ObjectName =~ object and CounterName =~ countername and (isempty(instance) or InstanceName=~  instance)\r\n    | project TimeGenerated\r\n    | summarize period = ((max(TimeGenerated)-min(TimeGenerated))/1s)\r\n)\r\n);\r\nPerf\r\n    | where TimeGenerated {TimeRange:query}\r\n    {showall}\r\n    | where ObjectName =~ object and CounterName =~ countername and (isempty(instance) or InstanceName=~  instance)\r\n    | make-series val=iff(iff(gt,avg(CounterValue) > threshold, avg(CounterValue) < threshold),1,0)  on TimeGenerated step 1m by Computer\r\n    | extend MovingAvg=series_fir(val, myfilter, true)\r\n    | project Computer, TimeGenerated, MovingAvg\r\n    | mv-expand  TimeGenerated, MovingAvg\r\n    | extend val= iif(round(todouble(MovingAvg),1) ==1, 1, 0)\r\n    | where val==1\r\n    | summarize Machine=dcount(Computer)\r\n| extend Instance=instance, Name=name, ObjectName=object, CounterName=countername, GT=gt, Threshold=threshold\r\n};\r\nGetPerfSummary(\"Processor Information\", \"% Processor Time\", \"\" ,\"CPU Utilization\" ,{CPUThreshold}, true)\r\n| union GetPerfSummary(\"LogicalDisk\", \"% Free Space\",  \"\", \"C: Disk Space\" , {FreeDiskSpace}, false)\r\n| union GetPerfSummary(\"Memory\", \"Available MBytes\",  \"\", \"Available MBytes\" , {AvailableMBytes}, false)\r\n| union GetPerfSummary(\"Memory\", \"Page Faults/sec\",  \"\", \"Page Faults/sec\" , {PageFaultssec}, true)\r\n| union GetPerfSummary(\"User Input Delay per Session\", \"Max Input Delay\",  \"Max\", \"Input Delay per Session\" , {InputDelay}, true)\r\n| extend Subtitle=\"Hosts\"\r\n\r\n\r\n",
                    "size": 1,
                    "showAnalytics": true,
                    "exportedParameters": [
                      {
                        "fieldName": "ObjectName",
                        "parameterName": "ObjectName",
                        "parameterType": 1
                      },
                      {
                        "fieldName": "Instance",
                        "parameterName": "Instance",
                        "parameterType": 1
                      },
                      {
                        "fieldName": "CounterName",
                        "parameterName": "CounterName",
                        "parameterType": 1
                      },
                      {
                        "fieldName": "GT",
                        "parameterName": "GT",
                        "parameterType": 1
                      },
                      {
                        "fieldName": "Threshold",
                        "parameterName": "Threshold",
                        "parameterType": 1
                      },
                      {
                        "fieldName": "Name",
                        "parameterName": "PerfName",
                        "parameterType": 1
                      }
                    ],
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "Name",
                        "formatter": 1
                      },
                      "subtitleContent": {
                        "columnMatch": "Subtitle"
                      },
                      "leftContent": {
                        "columnMatch": "Machine",
                        "formatter": 12,
                        "formatOptions": {
                          "min": 0,
                          "max": 1,
                          "palette": "greenRed"
                        },
                        "tooltipFormat": {
                          "tooltip": "Number of session hosts"
                        }
                      },
                      "rightContent": {
                        "columnMatch": "Value",
                        "formatter": 12,
                        "formatOptions": {
                          "min": 0,
                          "max": 100,
                          "palette": "blue"
                        },
                        "numberFormat": {
                          "unit": 1,
                          "options": {
                            "style": "decimal",
                            "useGrouping": false,
                            "minimumFractionDigits": 1,
                            "maximumFractionDigits": 1
                          }
                        },
                        "tooltipFormat": {
                          "tooltip": "Percentage of thresholds hit during the time window"
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "name": "CountersSummary"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let WVDHosts = dynamic([{WVDHosts}]);\r\nlet hostPool = \"{HostPool:label}\";\r\nlet GetPerfSummary = (object:string, countername:string, instance:string, threshold:real, gt:bool)\r\n{\r\nlet myfilter = repeat(1,{Period});\r\nlet TotalTime = tolong(toscalar(\r\nPerf\r\n    | where TimeGenerated {TimeRange:query}\r\n    {showall}\r\n    | where ObjectName =~ object and CounterName =~ countername and (isempty(instance) or InstanceName=~  instance)\r\n    | project TimeGenerated\r\n    | summarize period = (max(TimeGenerated)-min(TimeGenerated))/1s\r\n    ));\r\nPerf\r\n    | where TimeGenerated {TimeRange:query}\r\n    {showall}\r\n    | where ObjectName =~ object and CounterName =~ countername and (isempty(instance) or InstanceName=~  instance)\r\n    | make-series val=iff(iff(gt,avg(CounterValue) > threshold, avg(CounterValue) < threshold),1,0)  on TimeGenerated step 1m by Computer, _ResourceId\r\n    | extend MovingAvg=series_fir(val, myfilter, true), Total= array_length(TimeGenerated)\r\n    | project Computer, _ResourceId, TimeGenerated, MovingAvg, Total\r\n    | mv-expand  TimeGenerated, MovingAvg\r\n    | extend val= iif(round(todouble(MovingAvg),1) ==1, 1, 0)\r\n    | where val==1\r\n    | summarize Start=min(todatetime(TimeGenerated)), End=max(todatetime(TimeGenerated)), Average=avg(todouble(val)),P95th=percentile(todouble(val),95), TimePercent = 100*count()/todouble(max(Total)) by Computer, _ResourceId\r\n    | extend ShortComputerName = trim_end(@'\\..*', Computer)\r\n};\r\nGetPerfSummary(\"{ObjectName}\", \"{CounterName}\" , \"{Instance}\" ,{Threshold}, {GT})\r\n\r\n\r\n",
                          "size": 0,
                          "exportedParameters": [
                            {
                              "fieldName": "Computer",
                              "parameterName": "SelectedComputer",
                              "parameterType": 1
                            },
                            {
                              "fieldName": "Computer",
                              "parameterName": "Computer",
                              "parameterType": 1
                            },
                            {
                              "fieldName": "Start",
                              "parameterName": "TimeStart",
                              "parameterType": 1
                            },
                            {
                              "fieldName": "End",
                              "parameterName": "TimeEnd",
                              "parameterType": 1
                            },
                            {
                              "fieldName": "ShortComputerName",
                              "parameterName": "ShortComputerName",
                              "parameterType": 1
                            }
                          ],
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Computer",
                                "formatter": 5,
                                "formatOptions": {
                                  "customColumnWidthSetting": "40.2857ch"
                                }
                              },
                              {
                                "columnMatch": "_ResourceId",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "22.8571ch"
                                }
                              },
                              {
                                "columnMatch": "Start",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "20.8571ch"
                                }
                              },
                              {
                                "columnMatch": "End",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "22ch"
                                }
                              },
                              {
                                "columnMatch": "Average",
                                "formatter": 4,
                                "formatOptions": {
                                  "palette": "greenRed",
                                  "compositeBarSettings": {
                                    "labelText": "",
                                    "columnSettings": [
                                      {
                                        "columnName": "Average",
                                        "color": "blue"
                                      }
                                    ]
                                  },
                                  "customColumnWidthSetting": "89px"
                                },
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": false,
                                    "minimumFractionDigits": 1,
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "P95th",
                                "formatter": 4,
                                "formatOptions": {
                                  "palette": "greenRed",
                                  "customColumnWidthSetting": "78px"
                                },
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal",
                                    "minimumFractionDigits": 1,
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "TimePercent",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 0,
                                  "max": 100,
                                  "palette": "blue",
                                  "customColumnWidthSetting": "78px"
                                },
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": false,
                                    "minimumFractionDigits": 1,
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "P50th",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 1,
                                  "max": 1,
                                  "palette": "blue"
                                }
                              }
                            ],
                            "rowLimit": 1000,
                            "labelSettings": [
                              {
                                "columnId": "_ResourceId",
                                "label": "Host"
                              },
                              {
                                "columnId": "TimePercent",
                                "label": "Time %"
                              }
                            ]
                          },
                          "sortBy": [],
                          "chartSettings": {
                            "xAxis": "TimeGenerated",
                            "yAxis": [
                              "Average"
                            ],
                            "group": "Computer",
                            "createOtherGroup": null,
                            "showMetrics": false,
                            "showLegend": true
                          }
                        },
                        "customWidth": "50",
                        "name": "PerfTablebyHost"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let GetPerfSummary = (object:string, countername:string, instance:string, threshold:real, gt:bool)\r\n{\r\nlet start = todatetime(\"{TimeStart}\");\r\nlet end = todatetime(\"{TimeEnd}\");\r\nlet totalmins=(end-start)/1m;\r\nlet rangeAdd = iff(totalmins < 5, 5m, 0m);//(end-start)/10;\r\nlet chartStart = start - rangeAdd;\r\nlet chardEnd = end + rangeAdd;\r\nlet grain = iff( (chardEnd-chartStart)/1m > 1000,(chardEnd-chartStart)/1000,1m);\r\nPerf \r\n| where TimeGenerated >= (start) and TimeGenerated <= (end) \r\n| where ObjectName =~ object and CounterName =~ countername and (isempty(instance) or InstanceName=~\r\ninstance) and Computer == \"{SelectedComputer}\"\r\n| project TimeGenerated, CounterValue\r\n| make-series Val=avg(CounterValue) on TimeGenerated step totimespan(grain)\r\n| extend threshold = repeat({Threshold},array_length(Val))\r\n};\r\nGetPerfSummary(\"{ObjectName}\", \"{CounterName}\" , \"{Instance}\" ,{CPUThreshold}, true)\r\n| render timechart\r\n\r\n",
                          "size": 0,
                          "aggregation": 3,
                          "title": "{ShortComputerName} - {PerfName}",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "timechart",
                          "gridSettings": {
                            "hierarchySettings": {
                              "treeType": 1,
                              "groupBy": [
                                "Computer"
                              ]
                            }
                          },
                          "chartSettings": {
                            "ySettings": {
                              "min": 0
                            }
                          }
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "SelectedComputer",
                          "comparison": "isNotEqualTo"
                        },
                        "name": "PerfGraph"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "Select host on left for performance graph",
                          "style": "info"
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "SelectedComputer",
                          "comparison": "isEqualTo"
                        },
                        "name": "HostNotSelected_Instructions"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "ObjectName",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "PerfDrillDown"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "Select one of the above metrics for further details",
                    "style": "info"
                  },
                  "conditionalVisibility": {
                    "parameterName": "ObjectName",
                    "comparison": "isEqualTo"
                  },
                  "name": "ObjectNameNotSelected_Instruction"
                }
              ]
            },
            "name": "PerfGroup",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Events",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let WVDHosts = dynamic([{WVDHosts}]);\r\nlet hostPool = \"{HostPool:label}\";\r\nEvent\r\n| where TimeGenerated {TimeRange:query}\r\n{showall}\r\n| where Source == \"Microsoft-FSLogix-Apps\" and EventLevel < 4\r\n| summarize Value=count(), Machines = dcount(Computer)\r\n| extend Name=\"FSLogix Warnings and Errors\", level=5\r\n| union (Event\r\n| where TimeGenerated {TimeRange:query}\r\n{showall} \r\n| where Source == \"Service Control Manager\"\r\n| where EventID == 7000\r\n| extend param = parse_xml(EventData).DataItem.EventData.Data[0][\"#text\"]\r\n| where param == \"frxsvc\"\r\n| summarize Value=count(), Machines = dcount(Computer)\r\n| extend Name=\"FSLogix Fail to Start\", level=1)\r\n| union (Event\r\n| where TimeGenerated {TimeRange:query}\r\n{showall}\r\n      | where EventLog == \"System\"\r\n      | where (EventID == 41 and Source  == \"Microsoft-Windows-Kernel-Power\") or (Source == \"Microsoft-Windows-WER-SystemErrorReporting\" and EventID ==1001)\r\n      | summarize Value=count(), Machines = dcount(Computer)\r\n      | extend Name=\"Unexpected Reboots\", level=0)\r\n| union (Event\r\n| where TimeGenerated {TimeRange:query}\r\n{showall}\r\n| where Source == \"Microsoft-Windows-Winlogon\"\r\n| where  EventID == 6005\r\n| extend Parameters = parse_xml(EventData).DataItem.EventData.Data[0]\r\n| where Parameters == \"frxsvc\"\r\n| summarize Value=count(), Machines = dcount(Computer)\r\n| extend Name=\"Fslogix logon timeout\", level=1)\r\n| extend Subtitle=\"Hosts/Instances\"\r\n| order by Machines desc ,level asc\r\n\r\n\r\n\r\n\r\n\r\n",
                    "size": 1,
                    "showAnalytics": true,
                    "exportFieldName": "Name",
                    "exportParameterName": "EventDrill",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "Name",
                        "formatter": 1
                      },
                      "subtitleContent": {
                        "columnMatch": "Subtitle"
                      },
                      "leftContent": {
                        "columnMatch": "Machines",
                        "formatter": 12,
                        "formatOptions": {
                          "min": 0,
                          "max": 1,
                          "palette": "greenRed"
                        },
                        "tooltipFormat": {
                          "tooltip": "Number of session hosts"
                        }
                      },
                      "rightContent": {
                        "columnMatch": "Value",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "blue"
                        },
                        "tooltipFormat": {
                          "tooltip": "Number of instances"
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "name": "EventsSummary"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "Select one of the above event types for further details",
                          "style": "info"
                        },
                        "conditionalVisibility": {
                          "parameterName": "EventDrill",
                          "comparison": "isEqualTo"
                        },
                        "name": "EventDrill_NotSelected"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let WVDHosts = dynamic([{WVDHosts}]);\r\nlet hostPool = \"{HostPool:label}\";\r\nEvent\r\n| where TimeGenerated {TimeRange:query}\r\n{showall}\r\n| where Source == \"Microsoft-FSLogix-Apps\" and EventLevel < 4\r\n| project _ResourceId, TimeGenerated, EventID, EventLevelName, RenderedDescription",
                          "size": 1,
                          "noDataMessage": "No Events",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "_ResourceId",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "22.8571ch"
                                }
                              },
                              {
                                "columnMatch": "RenderedDescription",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "GenericDetails",
                                  "linkIsContextBlade": true
                                }
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "_ResourceId",
                                "label": "Host"
                              },
                              {
                                "columnId": "TimeGenerated",
                                "label": "Time generated"
                              },
                              {
                                "columnId": "EventID",
                                "label": "Event ID"
                              },
                              {
                                "columnId": "EventLevelName",
                                "label": "Event level"
                              },
                              {
                                "columnId": "RenderedDescription",
                                "label": "Description"
                              }
                            ]
                          }
                        },
                        "conditionalVisibility": {
                          "parameterName": "EventDrill",
                          "comparison": "isEqualTo",
                          "value": "FSLogix Warnings and Errors"
                        },
                        "name": "FSLogixWarnigsDrillDown"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let WVDHosts = dynamic([{WVDHosts}]);\r\nlet hostPool = \"{HostPool:label}\";\r\nEvent\r\n| where TimeGenerated {TimeRange:query}\r\n{showall} \r\n| where Source == \"Service Control Manager\"\r\n| where EventID == 7000\r\n| extend param = parse_xml(EventData).DataItem.EventData.Data[0][\"#text\"]\r\n| where param == \"frxsvc\"\r\n| project _ResourceId,  TimeGenerated, EventID, EventLevelName, RenderedDescription",
                          "size": 1,
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "labelSettings": [
                              {
                                "columnId": "_ResourceId",
                                "label": "Host"
                              },
                              {
                                "columnId": "TimeGenerated",
                                "label": "Time generated"
                              },
                              {
                                "columnId": "EventID",
                                "label": "Event ID"
                              },
                              {
                                "columnId": "EventLevelName",
                                "label": "Event level"
                              },
                              {
                                "columnId": "RenderedDescription",
                                "label": "Description"
                              }
                            ]
                          }
                        },
                        "conditionalVisibility": {
                          "parameterName": "EventDrill",
                          "comparison": "isEqualTo",
                          "value": "FSLogix Fail to Start"
                        },
                        "name": "FSLFailToStartDrillDown"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let WVDHosts = dynamic([{WVDHosts}]);\r\nlet hostPool = \"{HostPool:label}\";\r\nEvent\r\n| where TimeGenerated {TimeRange:query}\r\n{showall}\r\n      | where EventLog == \"System\"\r\n      | where (EventID == 41 and Source  == \"Microsoft-Windows-Kernel-Power\") or (Source == \"Microsoft-Windows-WER-SystemErrorReporting\" and EventID ==1001)\r\n      | project _ResourceId, TimeGenerated, EventID, EventLevelName, RenderedDescription",
                          "size": 1,
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "_ResourceId",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "21.8571ch"
                                }
                              },
                              {
                                "columnMatch": "TimeGenerated",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "23.2857ch"
                                }
                              },
                              {
                                "columnMatch": "EventID",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "13ch"
                                }
                              },
                              {
                                "columnMatch": "EventLevelName",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "20ch"
                                }
                              },
                              {
                                "columnMatch": "RenderedDescription",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "GenericDetails",
                                  "linkIsContextBlade": true,
                                  "customColumnWidthSetting": "85.1429ch"
                                }
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "_ResourceId",
                                "label": "Host"
                              },
                              {
                                "columnId": "TimeGenerated",
                                "label": "Time generated"
                              },
                              {
                                "columnId": "EventID",
                                "label": "Event ID"
                              },
                              {
                                "columnId": "EventLevelName",
                                "label": "Event level"
                              },
                              {
                                "columnId": "RenderedDescription",
                                "label": "Description"
                              }
                            ]
                          }
                        },
                        "conditionalVisibility": {
                          "parameterName": "EventDrill",
                          "comparison": "isEqualTo",
                          "value": "Unexpected Reboots"
                        },
                        "showPin": false,
                        "name": "RobootDrillDown"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let WVDHosts = dynamic([{WVDHosts}]);\r\nlet hostPool = \"{HostPool:label}\";\r\nEvent\r\n| where TimeGenerated {TimeRange:query}\r\n{showall}\r\n| where Source == \"Microsoft-Windows-Winlogon\"\r\n| where  EventID == 6005\r\n| extend Parameters = parse_xml(EventData).DataItem.EventData.Data[0]\r\n| where Parameters == \"frxsvc\"\r\n| project _ResourceId, TimeGenerated, EventID, EventLevelName, RenderedDescription\r\n",
                          "size": 1,
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "_ResourceId",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "22.8571ch"
                                }
                              },
                              {
                                "columnMatch": "TimeGenerated",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "22.2857ch"
                                }
                              },
                              {
                                "columnMatch": "EventID",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "12.1429ch"
                                }
                              },
                              {
                                "columnMatch": "EventLevelName",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "19.1429ch"
                                }
                              },
                              {
                                "columnMatch": "RenderedDescription",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "GenericDetails",
                                  "linkIsContextBlade": true,
                                  "customColumnWidthSetting": "78ch"
                                }
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "_ResourceId",
                                "label": "Host"
                              },
                              {
                                "columnId": "TimeGenerated",
                                "label": "Time generated"
                              },
                              {
                                "columnId": "EventID",
                                "label": "Event ID"
                              },
                              {
                                "columnId": "EventLevelName",
                                "label": "Event level"
                              },
                              {
                                "columnId": "RenderedDescription",
                                "label": "Description"
                              }
                            ]
                          }
                        },
                        "conditionalVisibility": {
                          "parameterName": "EventDrill",
                          "comparison": "isEqualTo",
                          "value": "Fslogix logon timeout"
                        },
                        "name": "Fslogixtimeout"
                      }
                    ]
                  },
                  "name": "EventDrillDownGroup"
                }
              ]
            },
            "name": "EventGroup",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let WVDHosts = dynamic([{WVDHosts}]);\r\nlet hostPool = \"{HostPool:label}\";\r\nlet maxResultCount = 100;\r\nlet processInfo = Perf\r\n| where TimeGenerated {TimeRange:query}\r\n{showall}\r\n| where ObjectName == \"Processor Information\" and CounterName == \"% Processor Time\"\r\n| summarize hint.shufflekey = Computer Average = avg(CounterValue), percentiles(CounterValue, 95) by Computer\r\n| project Computer, ProcessAverage=Average, ProcessP95th = percentile_CounterValue_95\r\n| limit maxResultCount;\r\nlet diskInfo = Perf\r\n| where TimeGenerated {TimeRange:query}\r\n{showall}\r\n| where ObjectName == 'LogicalDisk' and InstanceName =~ 'c:' and CounterName in ('% Free Space')\r\n| summarize hint.shufflekey = Computer Average = avg(CounterValue), percentiles(CounterValue, 95) by Computer\r\n| project Computer, FreeSpaceAverage=Average, FreeSpaceP95th = percentile_CounterValue_95\r\n| limit maxResultCount;\r\nlet trend = Perf\r\n| where TimeGenerated {TimeRange:query}\r\n{showall}\r\n| where (ObjectName == \"Processor Information\" and CounterName == \"% Processor Time\") or \r\n        (ObjectName == 'LogicalDisk' and InstanceName =~ 'c:' and CounterName in ('% Free Space'))          \r\n| make-series ProcessTrend =round(avgif(CounterValue, CounterName == \"% Processor Time\"), 2), FreeSpaceTrend = round(avgif(CounterValue, CounterName ==  '% Free Space'),2) \r\n                default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by Computer\r\n| project Computer, ProcessTrend, FreeSpaceTrend;\r\nprocessInfo\r\n| join kind=leftouter diskInfo on Computer\r\n| join kind=leftouter trend on Computer\r\n| project Computer, ProcessAverage, ProcessP95th, FreeSpaceAverage, FreeSpaceP95th, ProcessTrend, FreeSpaceTrend, sortField=max_of(ProcessAverage, 100-FreeSpaceAverage)\r\n| sort by sortField desc\r\n| limit maxResultCount",
              "size": 1,
              "showAnalytics": true,
              "title": "Host performance overview",
              "noDataMessage": "No performance counters to display. Please confirm that you have enabled the performance counter collection in your Log Analytics workspace",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "ProcessAverage",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": ">=",
                          "thresholdValue": "70",
                          "representation": "yellow",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": ">=",
                          "thresholdValue": "85",
                          "representation": "redBright",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": null,
                          "text": "{0}{1}"
                        }
                      ]
                    },
                    "numberFormat": {
                      "unit": 1,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "ProcessP95th",
                    "formatter": 0,
                    "numberFormat": {
                      "unit": 1,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false,
                        "minimumFractionDigits": 1,
                        "maximumFractionDigits": 1
                      }
                    }
                  },
                  {
                    "columnMatch": "FreeSpaceAverage",
                    "formatter": 4,
                    "formatOptions": {
                      "min": 0,
                      "max": 100,
                      "palette": "blue"
                    }
                  },
                  {
                    "columnMatch": "ProcessTrend",
                    "formatter": 9,
                    "formatOptions": {
                      "palette": "blue"
                    }
                  },
                  {
                    "columnMatch": "FreeSpaceTrend",
                    "formatter": 10,
                    "formatOptions": {
                      "palette": "blue"
                    }
                  },
                  {
                    "columnMatch": "sortField",
                    "formatter": 5
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "ProcessAverage",
                    "label": "Process Average"
                  },
                  {
                    "columnId": "FreeSpaceAverage",
                    "label": "Free Disk  Space"
                  }
                ]
              }
            },
            "conditionalVisibility": {
              "parameterName": "Alternate",
              "comparison": "isEqualTo",
              "value": "no"
            },
            "name": "hostperfoverview"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Host browser",
              "items": [
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "parameters": [
                      {
                        "id": "280b8061-881a-4dc7-80db-a31161bce7a9",
                        "version": "KqlParameterItem/1.0",
                        "name": "Computer",
                        "label": "Host",
                        "type": 2,
                        "isRequired": true,
                        "query": "let WVDHosts = dynamic([{WVDHosts}]);\r\nlet hostPool = \"{HostPool:label}\";\r\nHeartbeat\r\n| where TimeGenerated {TimeRange:query}\r\n{showall}\r\n| distinct Computer\r\n| order by Computer asc\r\n| project value = Computer, label = trim_end(@'\\..*', Computer), selected = (1 == row_number())",
                        "crossComponentResources": [
                          "{Workspace}"
                        ],
                        "typeSettings": {
                          "additionalResourceOptions": []
                        },
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "name": "parameters_hostbrowser"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "parameters": [
                            {
                              "id": "25e43a1a-f3d1-4684-8dca-c36a7a766bfd",
                              "version": "KqlParameterItem/1.0",
                              "name": "Object",
                              "type": 2,
                              "query": "Perf\r\n| where TimeGenerated {TimeRange:query}\r\n| where Computer == \"{Computer:value}\"\r\n| distinct ObjectName\r\n",
                              "crossComponentResources": [
                                "{Workspace}"
                              ],
                              "value": "Processor Information",
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces"
                            },
                            {
                              "id": "e2155896-4bea-43a8-9688-779c96c9b67f",
                              "version": "KqlParameterItem/1.0",
                              "name": "CounterName",
                              "label": "Counter Name",
                              "type": 2,
                              "query": "Perf\r\n| where TimeGenerated {TimeRange:query}\r\n| where Computer == \"{Computer:value}\" and ObjectName == \"{Object}\"\r\n| distinct CounterName\r\n",
                              "crossComponentResources": [
                                "{Workspace}"
                              ],
                              "value": "% Processor Time",
                              "typeSettings": {
                                "additionalResourceOptions": []
                              },
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "parameters1"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let Trend=Perf\r\n| where TimeGenerated {TimeRange:query} and Computer == \"{Computer:name}\" and ObjectName == \"{Object}\" and CounterName == \"{CounterName}\"\r\n| project _ResourceId, CounterName, InstanceName, TimeGenerated, CounterValue\r\n| make-series Trend =round(avg(CounterValue), 2) default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by CounterName, InstanceName\r\n| project Trend, InstanceName;\r\nPerf\r\n| where TimeGenerated {TimeRange:query} and Computer == \"{Computer:name}\"  and ObjectName == \"{Object}\" and CounterName == \"{CounterName}\"\r\n| project _ResourceId, CounterName, InstanceName, TimeGenerated,CounterValue\r\n| summarize Average = avg(CounterValue), P95th = percentiles(CounterValue, 95), P5th= percentiles(CounterValue, 5), TimeGenerated= min(TimeGenerated) by CounterName, InstanceName\r\n| join Trend on InstanceName\r\n| project InstanceName, Average, P5th, P95th, TimeGenerated, Trend\r\n| order by Average desc",
                          "size": 1,
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Average",
                                "formatter": 0,
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal",
                                    "minimumFractionDigits": 1,
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "P5th",
                                "formatter": 0,
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal",
                                    "minimumFractionDigits": 1,
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "P95th",
                                "formatter": 0,
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": false,
                                    "minimumFractionDigits": 1,
                                    "maximumFractionDigits": 1
                                  }
                                }
                              },
                              {
                                "columnMatch": "Trend",
                                "formatter": 9,
                                "formatOptions": {
                                  "palette": "blue",
                                  "customColumnWidthSetting": "210px"
                                }
                              }
                            ],
                            "rowLimit": 1000,
                            "labelSettings": [
                              {
                                "columnId": "InstanceName",
                                "label": "Instance name"
                              },
                              {
                                "columnId": "P5th",
                                "label": "p5"
                              },
                              {
                                "columnId": "P95th",
                                "label": "p95"
                              },
                              {
                                "columnId": "TimeGenerated",
                                "label": "Time generated"
                              }
                            ]
                          }
                        },
                        "name": "PerfSelectedObject"
                      }
                    ]
                  },
                  "name": "Perf by object",
                  "styleSettings": {
                    "margin": "3px",
                    "showBorder": true
                  }
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "parameters": [
                            {
                              "id": "44ebe45b-1f47-4b62-bcfb-4a43ea59dca3",
                              "version": "KqlParameterItem/1.0",
                              "name": "MinLevel",
                              "label": " Minimum Level",
                              "type": 2,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n{\"value\":\"0\", \"label\":\"Critical\"},\r\n{\"value\":\"1\", \"label\":\"Error\", \"selected\":true},\r\n{\"value\":\"2\", \"label\":\"Warning\"},\r\n{\"value\":\"4\", \"label\":\"Information\"}\r\n]"
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "parameters_eventlog"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "Event\r\n| where TimeGenerated {TimeRange:query} and Computer == \"{Computer:name}\" and EventLevel <= {MinLevel}\r\n| summarize Total=count(), DistinctSources=dcount(Source), Success=countif(EventLevel==0), Error=countif(EventLevel==1) by EventLog",
                          "size": 1,
                          "exportFieldName": "EventLog",
                          "exportParameterName": "SelectedEventLog",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "Total",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "gray"
                                },
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": true
                                  }
                                }
                              },
                              {
                                "columnMatch": "DistinctSources",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "blue"
                                },
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": true
                                  }
                                }
                              },
                              {
                                "columnMatch": "Success",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "green"
                                },
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": true
                                  }
                                }
                              },
                              {
                                "columnMatch": "Error",
                                "formatter": 4,
                                "formatOptions": {
                                  "min": 0,
                                  "palette": "redBright"
                                },
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "style": "decimal",
                                    "useGrouping": true
                                  }
                                }
                              }
                            ],
                            "sortBy": [
                              {
                                "itemKey": "EventLog",
                                "sortOrder": 1
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "EventLog",
                                "label": "Event log"
                              },
                              {
                                "columnId": "DistinctSources",
                                "label": "Distinct sources"
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "EventLog",
                              "sortOrder": 1
                            }
                          ]
                        },
                        "name": "EventLogsSummary"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "Select an Event Log above for further details",
                          "style": "info"
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "SelectedEventLog",
                          "comparison": "isEqualTo"
                        },
                        "name": "SelectedEventLog_NotSelected"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "Event\r\n| where TimeGenerated {TimeRange:query} and Computer == \"{Computer:name}\" and EventLog == \"{SelectedEventLog}\" and EventLevel <= {MinLevel}\r\n| summarize Count=count() by Source, EventLevel,EventLevelName\r\n",
                          "size": 0,
                          "exportFieldName": "Source",
                          "exportParameterName": "SelectedSource",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "EventLevel",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "EventLevelName",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Information",
                                      "representation": "1",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Warning",
                                      "representation": "2",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Error",
                                      "representation": "error",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Success",
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "thresholdValue": "Critical",
                                      "representation": "4",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              }
                            ],
                            "sortBy": [
                              {
                                "itemKey": "Source",
                                "sortOrder": 1
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "EventLevelName",
                                "label": "Level"
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "Source",
                              "sortOrder": 1
                            }
                          ]
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "SelectedEventLog",
                          "comparison": "isNotEqualTo"
                        },
                        "name": "SelectedEventLogTable",
                        "styleSettings": {
                          "margin": "3px",
                          "showBorder": true
                        }
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "Select a source for further details",
                          "style": "info"
                        },
                        "customWidth": "50",
                        "conditionalVisibilities": [
                          {
                            "parameterName": "SelectedSource",
                            "comparison": "isEqualTo"
                          },
                          {
                            "parameterName": "SelectedEventLog",
                            "comparison": "isNotEqualTo"
                          }
                        ],
                        "name": "SelectedSource_NotSelected"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "Event\r\n| where TimeGenerated {TimeRange:query} and Computer == \"{Computer:name}\" and EventLog == \"{SelectedEventLog}\" and EventLevel <= {MinLevel} and Source == \"{SelectedSource}\"\r\n| project TimeGenerated, EventLevel, EventLevelName, EventID, RenderedDescription\r\n| top 2000 by TimeGenerated desc",
                          "size": 0,
                          "exportFieldName": "TimeGenerated",
                          "exportParameterName": "TimeGenerated",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Workspace}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "EventLevel",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "EventLevelName",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Information",
                                      "representation": "1",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Warning",
                                      "representation": "2",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Error",
                                      "representation": "3",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "Critical",
                                      "representation": "critical",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "thresholdValue": "Success",
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "EventID",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "8ch"
                                }
                              },
                              {
                                "columnMatch": "RenderedDescription",
                                "formatter": 7,
                                "formatOptions": {
                                  "linkTarget": "CellDetails",
                                  "linkIsContextBlade": true,
                                  "customColumnWidthSetting": "69.5714ch"
                                }
                              }
                            ],
                            "rowLimit": 2000,
                            "sortBy": [
                              {
                                "itemKey": "EventID",
                                "sortOrder": 1
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "EventLevelName",
                                "label": "Level"
                              },
                              {
                                "columnId": "EventID",
                                "label": "Id"
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "EventID",
                              "sortOrder": 1
                            }
                          ]
                        },
                        "customWidth": "50",
                        "conditionalVisibility": {
                          "parameterName": "SelectedSource",
                          "comparison": "isNotEqualTo"
                        },
                        "name": "SelectedSourceTable",
                        "styleSettings": {
                          "margin": "3px",
                          "showBorder": true
                        }
                      }
                    ]
                  },
                  "name": "EventsBrowser",
                  "styleSettings": {
                    "margin": "3px",
                    "showBorder": true
                  }
                }
              ]
            },
            "name": "ComputerBrowserGroup",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let WVDHosts = dynamic([{WVDHosts}]);\r\nlet hostPool = \"{HostPool:label}\";\r\nlet maxResultCount = 100;\r\nlet processInfo = Perf\r\n| where TimeGenerated {TimeRange:query}\r\n{showall}\r\n| where ObjectName == \"Processor Information\" and CounterName == \"% Processor Time\"\r\n| summarize hint.shufflekey = Computer Average = avg(CounterValue), percentiles(CounterValue, 95) by Computer\r\n| project Computer, ProcessAverage=Average, ProcessP95th = percentile_CounterValue_95\r\n| limit maxResultCount;\r\nlet trend = Perf\r\n| where TimeGenerated {TimeRange:query}\r\n{showall}\r\n| where (ObjectName == \"Processor Information\" and CounterName == \"% Processor Time\")         \r\n| make-series ProcessTrend =round(avg(CounterValue), 2) default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by Computer\r\n| project Computer, ProcessTrend;\r\nprocessInfo\r\n| join kind=leftouter trend on Computer\r\n| project Computer=trim_end(@'\\..*', Computer), ProcessAverage, ProcessP95th , ProcessTrend\r\n| sort by ProcessAverage desc\r\n| limit maxResultCount",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "CPU usage",
                    "noDataMessage": "No performance counters to display. Please confirm that you have enabled the performance counter collection in your Log Analytics workspace",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Computer",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "22.8571ch"
                          }
                        },
                        {
                          "columnMatch": "ProcessAverage",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": ">=",
                                "thresholdValue": "70",
                                "representation": "2",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": ">=",
                                "thresholdValue": "85",
                                "representation": "4",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ],
                            "customColumnWidthSetting": "12.8571ch"
                          },
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "ProcessP95th",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "10.7143ch"
                          },
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "minimumFractionDigits": 1,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "ProcessTrend",
                          "formatter": 9,
                          "formatOptions": {
                            "min": 0,
                            "max": 100,
                            "palette": "greenRed",
                            "customColumnWidthSetting": "210px"
                          }
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "Computer",
                          "label": "Host"
                        },
                        {
                          "columnId": "ProcessAverage",
                          "label": "Average"
                        },
                        {
                          "columnId": "ProcessP95th",
                          "label": "p95"
                        },
                        {
                          "columnId": "ProcessTrend",
                          "label": "Trend"
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "cpu usage",
                  "styleSettings": {
                    "margin": "5px",
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let WVDHosts = dynamic([{WVDHosts}]);\r\nlet hostPool = \"{HostPool:label}\";\r\nlet maxResultCount = 100;\r\nlet diskInfo = Perf\r\n| where TimeGenerated {TimeRange:query}\r\n{showall}\r\n| where ObjectName == 'Memory'  and CounterName =~ \"Available MBytes\"\r\n| summarize hint.shufflekey = Computer Average = avg(CounterValue), percentiles(CounterValue, 5) by Computer\r\n| project Computer, Average, P5th = percentile_CounterValue_5\r\n| limit maxResultCount;\r\nlet trend = Perf\r\n| where TimeGenerated {TimeRange:query}\r\n{showall}\r\n| where ObjectName == 'Memory'  and CounterName =~ \"Available MBytes\"          \r\n| make-series  Trend = round(avg(CounterValue),1) \r\n                default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by Computer\r\n| project Computer, Trend;\r\ndiskInfo\r\n| join kind=leftouter trend on Computer\r\n| project Computer = trim_end(@'\\..*', Computer),  Average, P5th, Trend\r\n| sort by Average asc\r\n| limit maxResultCount",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Available memory",
                    "noDataMessage": "No performance counters to display. Please confirm that you have enabled the performance counter collection in your Log Analytics workspace",
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Computer",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "22.8571ch"
                          }
                        },
                        {
                          "columnMatch": "Average",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Available",
                                "text": "{0} {1}"
                              },
                              {
                                "operator": "<=",
                                "thresholdValue": "15",
                                "representation": "2",
                                "text": "{0} {1}"
                              },
                              {
                                "operator": "<=",
                                "thresholdValue": "10",
                                "representation": "critical",
                                "text": "{0} {1}"
                              }
                            ],
                            "customColumnWidthSetting": "14.2857ch"
                          },
                          "numberFormat": {
                            "unit": 4,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "P5th",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "11.5714ch"
                          },
                          "numberFormat": {
                            "unit": 4,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false
                            }
                          }
                        },
                        {
                          "columnMatch": "Trend",
                          "formatter": 9,
                          "formatOptions": {
                            "min": 0,
                            "palette": "redGreen",
                            "customColumnWidthSetting": "220px"
                          }
                        }
                      ],
                      "sortBy": [
                        {
                          "itemKey": "$gen_thresholds_Average_1",
                          "sortOrder": 1
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "Computer",
                          "label": "Host"
                        },
                        {
                          "columnId": "P5th",
                          "label": "p5"
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_thresholds_Average_1",
                        "sortOrder": 1
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "Available Memory",
                  "styleSettings": {
                    "margin": "5px",
                    "showBorder": true
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "CPU usage categorized as below or equal to 70% as green, and equal or above 85% red critical.\r\nAvailable memory is categorized as green above or equal to 15MB, and equal or below 10MB as red critical.",
                    "style": "info"
                  },
                  "name": "CPU and Memory Usage Description"
                }
              ]
            },
            "name": "cpu + disk space"
          }
        ]
      },
      "name": "HostDiagnostics"
    }
  ],
  "fallbackResourceIds": [
    "Azure Monitor"
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}
