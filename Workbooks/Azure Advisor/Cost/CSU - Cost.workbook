{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "## Cost Assessment Workbook\r\n### Change Log\r\n\r\n|Version|Date|Description|\r\n|---|---|---|\r\n|v1.0| 08/11/2022 | Initial Release\r\n"
      },
      "conditionalVisibility": {
        "parameterName": "isVisible",
        "comparison": "isEqualTo",
        "value": "Never"
      },
      "name": "text - 12"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "links": [
          {
            "id": "e17a49a1-9c0c-4933-b375-339ee7004fc0",
            "cellValue": "SelectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Welcome",
            "subTarget": "Welcome",
            "style": "link"
          },
          {
            "id": "ca40468d-4518-43bf-ac6e-0a11d7331e12",
            "cellValue": "SelectedTab",
            "linkTarget": "parameter",
            "linkLabel": "General",
            "subTarget": "General",
            "style": "link"
          },
          {
            "id": "d1c2c47b-b131-4096-9880-397a59ce1eae",
            "cellValue": "SelectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Azure Advisor",
            "subTarget": "Advisor",
            "style": "link"
          },
          {
            "id": "96d6402c-ff6c-4cf8-961d-8fbe5c98be60",
            "cellValue": "SelectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Compute",
            "subTarget": "Compute",
            "preText": "VirtualMachines",
            "style": "link"
          },
          {
            "id": "4afd48de-0d0c-4151-8339-7dca50018c56",
            "cellValue": "SelectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Data",
            "subTarget": "Data",
            "preText": "AppServices",
            "style": "link"
          },
          {
            "id": "4f4786a7-c2df-4788-b5b6-63057bc0c24a",
            "cellValue": "SelectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Storage",
            "subTarget": "Storage",
            "style": "link"
          },
          {
            "id": "69dfc3f7-5937-49ba-9851-d6d2973a0c69",
            "cellValue": "SelectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Networking",
            "subTarget": "Networking",
            "style": "link"
          },
          {
            "id": "feefdffe-9b9b-4480-a0dd-3a2751cab365",
            "cellValue": "SelectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Cost Information",
            "subTarget": "CostInformation",
            "style": "link"
          }
        ]
      },
      "name": "links - 4"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "51aa3a9b-14e0-4c22-a60d-abdbf8813f00",
            "version": "KqlParameterItem/1.0",
            "name": "Subscription",
            "type": 6,
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "includeAll": true,
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "defaultValue": "value::all"
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "conditionalVisibilities": [
        {
          "parameterName": "SelectedTab",
          "comparison": "isNotEqualTo",
          "value": "CostInformation"
        },
        {
          "parameterName": "SelectedTab",
          "comparison": "isNotEqualTo",
          "value": "Welcome"
        }
      ],
      "name": "parameters - 0"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "4b846956-4fa8-4d35-b396-74a87200f819",
            "version": "KqlParameterItem/1.0",
            "name": "RG_Filter",
            "label": "Filter By",
            "type": 2,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[\r\n    { \"value\":\"Resource Group\",\"selected\":\"true\"},\r\n    { \"value\":\"Tags\" }\r\n]",
            "timeContext": {
              "durationMs": 86400000
            }
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "conditionalVisibilities": [
        {
          "parameterName": "SelectedTab",
          "comparison": "isNotEqualTo",
          "value": "General"
        },
        {
          "parameterName": "SelectedTab",
          "comparison": "isNotEqualTo",
          "value": "CostInformation"
        },
        {
          "parameterName": "SelectedTab",
          "comparison": "isNotEqualTo",
          "value": "Welcome"
        },
        {
          "parameterName": "SelectedTab",
          "comparison": "isNotEqualTo",
          "value": "Advisor"
        }
      ],
      "name": "parameters - 2"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "{Subscription}"
        ],
        "parameters": [
          {
            "id": "6cb303fd-4812-4097-a468-a177d8782913",
            "version": "KqlParameterItem/1.0",
            "name": "ResourceGroup",
            "label": "Resource Group",
            "type": 2,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "resourceContainers | where type == 'microsoft.resources/subscriptions/resourcegroups'\r\n| project resourceGroup\r\n| sort by resourceGroup asc",
            "crossComponentResources": [
              "{Subscription}"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "defaultValue": "value::all",
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          }
        ],
        "style": "pills",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources"
      },
      "conditionalVisibilities": [
        {
          "parameterName": "RG_Filter",
          "comparison": "isEqualTo",
          "value": "Resource Group"
        },
        {
          "parameterName": "SelectedTab",
          "comparison": "isNotEqualTo",
          "value": "General"
        },
        {
          "parameterName": "SelectedTab",
          "comparison": "isNotEqualTo",
          "value": "CostInformation"
        },
        {
          "parameterName": "SelectedTab",
          "comparison": "isNotEqualTo",
          "value": "Welcome"
        },
        {
          "parameterName": "SelectedTab",
          "comparison": "isNotEqualTo",
          "value": "Advisor"
        }
      ],
      "name": "parameters - 2"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "{Subscription}"
        ],
        "parameters": [
          {
            "id": "df2a5339-2dd6-478a-a2b1-2dce7651ed0a",
            "version": "KqlParameterItem/1.0",
            "name": "TagName",
            "label": "Tag Name",
            "type": 2,
            "isRequired": true,
            "query": "Resources\r\n| where tags != '' and tags != '[]'\r\n| mvexpand tags\r\n| extend tagName = tostring(bag_keys(tags)[0])\r\n| distinct tagName\r\n| sort by tagName asc",
            "crossComponentResources": [
              "{Subscription}"
            ],
            "value": "env",
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          }
        ],
        "style": "pills",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources"
      },
      "conditionalVisibilities": [
        {
          "parameterName": "RG_Filter",
          "comparison": "isEqualTo",
          "value": "Tags"
        },
        {
          "parameterName": "SelectedTab",
          "comparison": "isNotEqualTo",
          "value": "General"
        }
      ],
      "customWidth": "20",
      "name": "parameters - 3"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "{Subscription}"
        ],
        "parameters": [
          {
            "id": "d28a3428-b806-4716-a4c5-9f9816224aef",
            "version": "KqlParameterItem/1.0",
            "name": "TagValue",
            "type": 2,
            "isRequired": true,
            "query": "Resources\r\n| mvexpand tags\r\n| extend tagName = tostring(bag_keys(tags)[0])\r\n| extend tagValue = tostring(tags[tagName])\r\n| where tags != '' and tags != '[]' and tostring(bag_keys(tags)[0]) == '{TagName}'\r\n| distinct tagValue\r\n| sort by tagValue asc",
            "crossComponentResources": [
              "{Subscription}"
            ],
            "value": "prod",
            "typeSettings": {
              "additionalResourceOptions": []
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          }
        ],
        "style": "pills",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources"
      },
      "conditionalVisibilities": [
        {
          "parameterName": "SelectedTab",
          "comparison": "isNotEqualTo",
          "value": "General"
        },
        {
          "parameterName": "RG_Filter",
          "comparison": "isEqualTo",
          "value": "Tags"
        },
        {
          "parameterName": "TagName",
          "comparison": "isNotEqualTo"
        }
      ],
      "customWidth": "20",
      "name": "parameters - 13"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Networking Group",
        "items": [
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "advisorresources\r\n| where type == \"microsoft.advisor/recommendations\"\r\n| where tostring (properties.category) has \"Cost\"\r\n| where properties.impactedField has \"Network\"\r\n| project AffectedResource=tostring(properties.resourceMetadata.resourceId),Impact=properties.impact,resourceGroup,AdditionaInfo=properties.extendedProperties,subscriptionId,Recommendation=tostring(properties.shortDescription.problem),name\r\n| where resourceGroup in ({ResourceGroup})",
                    "size": 0,
                    "title": "Azure advisor recommendations - Networking",
                    "noDataMessage": "You are following all of our cost recommendations for Networking",
                    "noDataMessageStyle": 3,
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "Recommendation"
                        ],
                        "expandTopLevel": true
                      }
                    }
                  },
                  "name": "query - 12"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "# Recommendations for Application Gateways\r\nReview Application Gateways which include backend pools with no targets. Resources listed with 2 red signs are considered idle.",
                    "style": "upsell"
                  },
                  "name": "text - 0"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| where type =~ 'Microsoft.Network/applicationGateways' and resourceGroup in ({ResourceGroup})\r\n| extend backendPoolsCount = array_length(properties.backendAddressPools),SKUName= tostring(properties.sku.name), SKUTier= tostring(properties.sku.tier),SKUCapacity=properties.sku.capacity,backendPools=properties.backendAddressPools , AppGwId = tostring(id)\r\n| project AppGwId, name, SKUName, SKUTier, SKUCapacity\r\n| join (\r\n    resources\r\n    | where type =~ 'Microsoft.Network/applicationGateways' and resourceGroup in ({ResourceGroup})\r\n    | mvexpand backendPools = properties.backendAddressPools\r\n    | extend backendIPCount = array_length(backendPools.properties.backendIPConfigurations)\r\n    | extend backendAddressesCount = array_length(backendPools.properties.backendAddresses)\r\n    | extend backendPoolName  = backendPools.properties.backendAddressPools.name\r\n    | extend AppGwId = tostring(id)\r\n    | summarize backendIPCount = sum(backendIPCount) ,backendAddressesCount=sum(backendAddressesCount) by AppGwId\r\n) on AppGwId\r\n| project-away AppGwId1\r\n| where  (backendIPCount == 0 or isempty(backendIPCount)) and (backendAddressesCount==0 or isempty(backendAddressesCount))\r\n| order by AppGwId asc",
                    "size": 0,
                    "title": "Application gateways with empty backend pools",
                    "noDataMessage": "You don't have any Application Gateways with empty backendpools",
                    "noDataMessageStyle": 3,
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "SKUCapacity",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "backendIPCount",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "0",
                                "representation": "disabled",
                                "text": ""
                              },
                              {
                                "operator": ">",
                                "thresholdValue": "0",
                                "representation": "success",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "backendAddressesCount",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "0",
                                "representation": "disabled",
                                "text": ""
                              },
                              {
                                "operator": ">",
                                "thresholdValue": "0",
                                "representation": "success",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "No Backend targets",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "green",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "backendPoolIPTarget",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": ">",
                                "thresholdValue": "0",
                                "representation": "success",
                                "text": ""
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "0",
                                "representation": "disabled",
                                "text": ""
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "backendPoolVMTarget",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "is Empty",
                                "representation": "disabled",
                                "text": ""
                              },
                              {
                                "operator": ">",
                                "thresholdValue": "0",
                                "representation": "success",
                                "text": ""
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Recommednation",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "No Backend targets",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "green",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ]
                    }
                  },
                  "name": "query - 1"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "# Recommendations for Load Balancers\r\nReview Load balancers with no backend pools, and remove them if not needed.",
                    "style": "upsell"
                  },
                  "name": "text - 23"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources \r\n| where resourceGroup in ({ResourceGroup})\r\n| where type =~ 'microsoft.network/loadbalancers' and tostring(properties.backendAddressPools) == '[]' \r\n| extend loadBalancerId=id,LBRG=resourceGroup, LoadBalancerName=name, SKU=sku, LBLocation=location, Backendpool=tostring(properties.backendAddressPools)\r\n| order by loadBalancerId asc\r\n| project loadBalancerId,LoadBalancerName, SKU.name,SKU.tier, Backendpool, LBLocation,LBRG, subscriptionId\r\n",
                    "size": 0,
                    "title": "Load Balancers with empty backend pools",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Backendpool",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "subscriptionId",
                          "formatter": 15,
                          "formatOptions": {
                            "linkTarget": null,
                            "showIcon": true
                          }
                        }
                      ]
                    }
                  },
                  "name": "query - 3"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "# Recommendations for Public IP Addresses\r\nReview unattached Public IP addresses, as they may represent additional cost.\r\n<br>This query will also show Public IPs attached to Idle network cards.\r\n",
                    "style": "upsell"
                  },
                  "name": "text - 4"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources \r\n| where resourceGroup in ({ResourceGroup})\r\n| where type =~ 'Microsoft.Network/publicIPAddresses' and isempty(properties.ipConfiguration) and isempty(properties.natGateway) \r\n| extend PublicIpId=id, IPName=name, AllocationMethod=tostring(properties.publicIPAllocationMethod), SKUName=sku.name, Location=location \r\n| project PublicIpId,IPName, SKUName, resourceGroup, Location, AllocationMethod, subscriptionId\r\n| union (\r\n Resources \r\n | where type =~ 'microsoft.network/networkinterfaces' and isempty(properties.virtualMachine) and isnull(properties.privateEndpoint) and isnotempty(properties.ipConfigurations) \r\n | extend IPconfig = properties.ipConfigurations \r\n | mv-expand IPconfig \r\n | extend PublicIpId= tostring(IPconfig.properties.publicIPAddress.id)\r\n | project PublicIpId\r\n | join ( \r\n    resources \r\n    | where type =~ 'Microsoft.Network/publicIPAddresses'\r\n    | extend PublicIpId=id, IPName=name, AllocationMethod=tostring(properties.publicIPAllocationMethod), SKUName=sku.name, resourceGroup, Location=location \r\n ) on PublicIpId\r\n | project PublicIpId,IPName, SKUName, resourceGroup, Location, AllocationMethod, subscriptionId\r\n)\r\n",
                    "size": 0,
                    "title": "Unattached Public IPs",
                    "noDataMessage": "You have no unattached Public IPs",
                    "noDataMessageStyle": 3,
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "IPName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "subscriptionId",
                          "formatter": 15,
                          "formatOptions": {
                            "linkTarget": null,
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "PublicIPAssigned",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "2",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ]
                    }
                  },
                  "name": "query - 5"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "# Recommendations for Azure Firewall\r\nReview Azure Firewall without network traffic. These resources are billed hourly, consider reconfiguring or deleting them if they are not in use.\r\n\r\n\r\n",
                    "style": "upsell"
                  },
                  "name": "text - 6"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "parameters": [
                      {
                        "id": "c5002ea2-7587-4816-99f5-1a2c37bb6160",
                        "version": "KqlParameterItem/1.0",
                        "name": "Firewall",
                        "label": "Azure Firewall",
                        "type": 5,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "resources\r\n| where type == \"microsoft.network/azurefirewalls\" and resourceGroup in ({ResourceGroup})\r\n| project id",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::all"
                          ],
                          "showDefault": false
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "defaultValue": "value::all",
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      {
                        "id": "d6c92c8d-762c-4a63-88d0-830719b008cd",
                        "version": "KqlParameterItem/1.0",
                        "name": "TimeRangeFirewall",
                        "label": "Time range",
                        "type": 4,
                        "value": {
                          "durationMs": 5184000000
                        },
                        "typeSettings": {
                          "selectableValues": [
                            {
                              "durationMs": 604800000
                            },
                            {
                              "durationMs": 1209600000
                            },
                            {
                              "durationMs": 2419200000
                            },
                            {
                              "durationMs": 2592000000
                            },
                            {
                              "durationMs": 5184000000
                            },
                            {
                              "durationMs": 7776000000
                            }
                          ],
                          "allowCustom": false
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.resourcegraph/resources"
                  },
                  "name": "parameters - 8"
                },
                {
                  "type": 10,
                  "content": {
                    "chartId": "workbookc9b8f2a1-5ab7-4815-8ea2-474bcfca994b",
                    "version": "MetricsItem/2.0",
                    "size": 0,
                    "chartType": 0,
                    "resourceType": "microsoft.network/azurefirewalls",
                    "metricScope": 0,
                    "resourceParameter": "Firewall",
                    "resourceIds": [
                      "{Firewall}"
                    ],
                    "timeContextFromParameter": "TimeRangeFirewall",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "metrics": [
                      {
                        "namespace": "microsoft.network/azurefirewalls",
                        "metric": "microsoft.network/azurefirewalls--DataProcessed",
                        "aggregation": 1
                      },
                      {
                        "namespace": "microsoft.network/azurefirewalls",
                        "metric": "microsoft.network/azurefirewalls--Throughput",
                        "aggregation": 4
                      }
                    ],
                    "title": "Azure Firewalls",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Subscription",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Name",
                          "formatter": 13,
                          "formatOptions": {
                            "linkTarget": "Resource",
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "microsoft.network/azurefirewalls--DataProcessed",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "is Empty",
                                "representation": "redDark",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "text": "{0}{1}"
                              }
                            ]
                          },
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal"
                            },
                            "emptyValCustomText": "0"
                          }
                        },
                        {
                          "columnMatch": "microsoft.network/azurefirewalls--DataProcessed Timeline",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "microsoft.network/azurefirewalls--Throughput",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "is Empty",
                                "representation": "redDark",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "text": "{0}{1}"
                              }
                            ]
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal"
                            },
                            "emptyValCustomText": "0"
                          }
                        },
                        {
                          "columnMatch": "microsoft.network/azurefirewalls--Throughput Timeline",
                          "formatter": 5
                        }
                      ],
                      "rowLimit": 10000,
                      "labelSettings": [
                        {
                          "columnId": "microsoft.network/azurefirewalls--DataProcessed",
                          "label": "Data processed (Sum)"
                        },
                        {
                          "columnId": "microsoft.network/azurefirewalls--DataProcessed Timeline",
                          "label": "Data processed Timeline"
                        },
                        {
                          "columnId": "microsoft.network/azurefirewalls--Throughput",
                          "label": "Throughput (Average)"
                        },
                        {
                          "columnId": "microsoft.network/azurefirewalls--Throughput Timeline",
                          "label": "Throughput Timeline"
                        }
                      ]
                    }
                  },
                  "name": "metric - 7"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "# Recommendations for VPN Gateways\r\nReview VPN Gateways without network traffic. These gateways are billed hourly, consider reconfiguring or deleting them if they are not in use.",
                    "style": "upsell"
                  },
                  "name": "text - 9"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "parameters": [
                      {
                        "id": "abd9fd4f-3b1e-4d70-80d2-6948bfcf3a2f",
                        "version": "KqlParameterItem/1.0",
                        "name": "VPNGatewaySubscription",
                        "label": "Virtual network gateways",
                        "type": 5,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "Resources \r\n| where type =~ \"microsoft.network/virtualnetworkgateways\" and properties.gatewayType == \"Vpn\" and resourceGroup in ({ResourceGroup})\r\n| project id",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::all"
                          ],
                          "showDefault": false
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "defaultValue": "value::all",
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      {
                        "id": "28f5f184-3c04-4c0e-8715-30686f64263e",
                        "version": "KqlParameterItem/1.0",
                        "name": "TimeRangeVPN",
                        "label": "Time Range",
                        "type": 4,
                        "value": {
                          "durationMs": 1209600000
                        },
                        "typeSettings": {
                          "selectableValues": [
                            {
                              "durationMs": 604800000
                            },
                            {
                              "durationMs": 1209600000
                            },
                            {
                              "durationMs": 2419200000
                            },
                            {
                              "durationMs": 2592000000
                            },
                            {
                              "durationMs": 5184000000
                            },
                            {
                              "durationMs": 7776000000
                            }
                          ]
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      }
                    ],
                    "style": "pills",
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources"
                  },
                  "name": "parameters - 10"
                },
                {
                  "type": 10,
                  "content": {
                    "chartId": "workbooka9ea46a6-d16a-43b9-a30d-81475a76a12a",
                    "version": "MetricsItem/2.0",
                    "size": 0,
                    "chartType": 0,
                    "resourceType": "microsoft.network/virtualnetworkgateways",
                    "metricScope": 0,
                    "resourceParameter": "VPNGatewaySubscription",
                    "resourceIds": [
                      "{VPNGatewaySubscription}"
                    ],
                    "timeContextFromParameter": "TimeRangeVPN",
                    "timeContext": {
                      "durationMs": 1209600000
                    },
                    "metrics": [
                      {
                        "namespace": "microsoft.network/virtualnetworkgateways",
                        "metric": "microsoft.network/virtualnetworkgateways-Traffic-TunnelTotalFlowCount",
                        "aggregation": 7
                      },
                      {
                        "namespace": "microsoft.network/virtualnetworkgateways",
                        "metric": "microsoft.network/virtualnetworkgateways-Traffic-TunnelAverageBandwidth",
                        "aggregation": 3
                      },
                      {
                        "namespace": "microsoft.network/virtualnetworkgateways",
                        "metric": "microsoft.network/virtualnetworkgateways-Traffic-P2SBandwidth",
                        "aggregation": 3
                      },
                      {
                        "namespace": "microsoft.network/virtualnetworkgateways",
                        "metric": "microsoft.network/virtualnetworkgateways-Traffic-AverageBandwidth",
                        "aggregation": 3
                      },
                      {
                        "namespace": "microsoft.network/virtualnetworkgateways",
                        "metric": "microsoft.network/virtualnetworkgateways-Traffic-P2SConnectionCount",
                        "aggregation": 7
                      }
                    ],
                    "title": "Virtual network gateways",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Subscription",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Name",
                          "formatter": 13,
                          "formatOptions": {
                            "linkTarget": "Resource"
                          }
                        },
                        {
                          "columnMatch": "microsoft.network/virtualnetworkgateways-Traffic-TunnelTotalFlowCount Timeline",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "microsoft.network/virtualnetworkgateways-Traffic-TunnelTotalFlowCount",
                          "formatter": 1,
                          "numberFormat": {
                            "unit": 0,
                            "options": null
                          }
                        },
                        {
                          "columnMatch": "microsoft.network/virtualnetworkgateways-Traffic-TunnelAverageBandwidth Timeline",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "microsoft.network/virtualnetworkgateways-Traffic-TunnelAverageBandwidth",
                          "formatter": 1,
                          "numberFormat": {
                            "unit": 11,
                            "options": null
                          }
                        },
                        {
                          "columnMatch": "microsoft.network/virtualnetworkgateways-Traffic-P2SConnectionCount Timeline",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "microsoft.network/virtualnetworkgateways-Traffic-P2SConnectionCount",
                          "formatter": 1,
                          "numberFormat": {
                            "unit": 0,
                            "options": null
                          }
                        },
                        {
                          "columnMatch": "microsoft.network/virtualnetworkgateways-Traffic-P2SBandwidth Timeline",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "microsoft.network/virtualnetworkgateways-Traffic-P2SBandwidth",
                          "formatter": 1,
                          "numberFormat": {
                            "unit": 11,
                            "options": null
                          }
                        },
                        {
                          "columnMatch": "microsoft.network/virtualnetworkgateways-Traffic-AverageBandwidth Timeline",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "microsoft.network/virtualnetworkgateways-Traffic-AverageBandwidth",
                          "formatter": 1,
                          "numberFormat": {
                            "unit": 11,
                            "options": null
                          }
                        },
                        {
                          "columnMatch": "Metric",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Aggregation",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Value",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Timeline",
                          "formatter": 9
                        },
                        {
                          "columnMatch": "microsoft.network/virtualnetworkgateways-Performance-ExpressRouteGatewayPacketsPerSecond",
                          "formatter": 1,
                          "numberFormat": {
                            "unit": 31,
                            "options": null
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "labelSettings": [
                        {
                          "columnId": "microsoft.network/virtualnetworkgateways-Traffic-TunnelTotalFlowCount",
                          "label": "Tunnel Total Flow Count (Count)"
                        },
                        {
                          "columnId": "microsoft.network/virtualnetworkgateways-Traffic-TunnelTotalFlowCount Timeline",
                          "label": "Tunnel Total Flow Count Timeline"
                        },
                        {
                          "columnId": "microsoft.network/virtualnetworkgateways-Traffic-TunnelAverageBandwidth",
                          "label": "Tunnel Bandwidth (Average)"
                        },
                        {
                          "columnId": "microsoft.network/virtualnetworkgateways-Traffic-TunnelAverageBandwidth Timeline",
                          "label": "Tunnel Bandwidth Timeline"
                        },
                        {
                          "columnId": "microsoft.network/virtualnetworkgateways-Traffic-P2SBandwidth",
                          "label": "Gateway P2S Bandwidth (Average)"
                        },
                        {
                          "columnId": "microsoft.network/virtualnetworkgateways-Traffic-P2SBandwidth Timeline",
                          "label": "Gateway P2S Bandwidth Timeline"
                        },
                        {
                          "columnId": "microsoft.network/virtualnetworkgateways-Traffic-AverageBandwidth",
                          "label": "Gateway S2S Bandwidth (Average)"
                        },
                        {
                          "columnId": "microsoft.network/virtualnetworkgateways-Traffic-AverageBandwidth Timeline",
                          "label": "Gateway S2S Bandwidth Timeline"
                        },
                        {
                          "columnId": "microsoft.network/virtualnetworkgateways-Traffic-P2SConnectionCount",
                          "label": "P2S Connection Count (Count)"
                        },
                        {
                          "columnId": "microsoft.network/virtualnetworkgateways-Traffic-P2SConnectionCount Timeline",
                          "label": "P2S Connection Count Timeline"
                        }
                      ]
                    }
                  },
                  "name": "metric - 11"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "# Recommendations for Azure Front Door\r\nReview Azure Front Doors without network traffic. These resources are billed hourly, consider reconfiguring or deleting them if they are not in use.",
                    "style": "upsell"
                  },
                  "name": "text - 13"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "parameters": [
                      {
                        "id": "2e8b2804-6fc1-4ce5-b4b4-c76a68d37c6f",
                        "version": "KqlParameterItem/1.0",
                        "name": "AzureFrontDoor",
                        "label": "Azure Front Door",
                        "type": 5,
                        "isRequired": true,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "Resources \r\n| where resourceGroup in ({ResourceGroup})\r\n| where type =~ \"microsoft.network/frontdoors\" or (type =~ 'microsoft.cdn/profiles' and kind =~ 'frontdoor')\r\n| project id",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::all"
                          ],
                          "showDefault": false
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "defaultValue": "value::all",
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      {
                        "id": "52337af0-ed30-4ddb-b888-dd7567d7e469",
                        "version": "KqlParameterItem/1.0",
                        "name": "TimeRangeFrontDoor",
                        "label": "Time Range",
                        "type": 4,
                        "isRequired": true,
                        "typeSettings": {
                          "selectableValues": [
                            {
                              "durationMs": 604800000
                            },
                            {
                              "durationMs": 1209600000
                            },
                            {
                              "durationMs": 2419200000
                            },
                            {
                              "durationMs": 2592000000
                            },
                            {
                              "durationMs": 5184000000
                            },
                            {
                              "durationMs": 7776000000
                            }
                          ]
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "value": {
                          "durationMs": 2592000000
                        }
                      }
                    ],
                    "style": "pills",
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources"
                  },
                  "name": "parameters - 14"
                },
                {
                  "type": 10,
                  "content": {
                    "chartId": "workbook078c4654-5fee-406c-9895-a775ae351a98",
                    "version": "MetricsItem/2.0",
                    "size": 0,
                    "chartType": 2,
                    "resourceType": "microsoft.network/frontdoors",
                    "metricScope": 0,
                    "resourceParameter": "AzureFrontDoor",
                    "resourceIds": [
                      "{AzureFrontDoor}"
                    ],
                    "timeContextFromParameter": "TimeRangeFrontDoor",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "metrics": [
                      {
                        "namespace": "microsoft.network/frontdoors",
                        "metric": "microsoft.network/frontdoors--RequestCount",
                        "aggregation": 1,
                        "splitBy": null
                      }
                    ],
                    "title": "Azure Frontdoors",
                    "gridSettings": {
                      "rowLimit": 10000
                    }
                  },
                  "name": "metric - 15"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "RG_Filter",
              "comparison": "isNotEqualTo",
              "value": "Tags"
            },
            "name": "networking - Subscription"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "advisorresources\r\n| where type == \"microsoft.advisor/recommendations\"\r\n| where tostring (properties.category) has \"Cost\"\r\n| where (properties.impactedField) has \"Network\"\r\n| project AffectedResource=tolower(tostring(properties.resourceMetadata.resourceId)),Impact=properties.impact,resourceGroup,AdditionaInfo=properties.extendedProperties,subscriptionId,Recommendation=tostring(properties.shortDescription.problem),AffectedResourceName=tostring(properties.impactedValue)\r\n| join ( resources\r\n    | where type has \"Microsoft.Network\"\r\n    | extend AffectedResource=tolower(id)\r\n) on AffectedResource\r\n| where isnotempty(tags) and isnotnull(tags)\r\n| mvexpand tags\r\n| extend tagName = tostring(bag_keys(tags)[0])\r\n| extend tagValue = tostring(tags[tagName])\r\n| where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n| project  AffectedResource, Impact,resourceGroup,AdditionaInfo, tagName, tagValue,Recommendation, SubscriptionName=subscriptionId",
                    "size": 0,
                    "title": "Azure advisor recommendations - Networking",
                    "noDataMessage": "You are following all Networking Advisor recommendations!",
                    "noDataMessageStyle": 3,
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "Recommendation"
                        ],
                        "expandTopLevel": true
                      }
                    }
                  },
                  "name": "query - 12"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "# Recommendations for Application Gateways\r\nReview Application Gateways which include backend pools with no targets. Resources listed with 2 red signs are considered idle. \r\n",
                    "style": "upsell"
                  },
                  "name": "text - 24"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| where type =~ 'Microsoft.Network/applicationGateways'\r\n| where isnotempty(tags) and isnotnull(tags)\r\n| mvexpand tags\r\n| extend tagName = tostring(bag_keys(tags)[0])\r\n| extend tagValue = tostring(tags[tagName])\r\n| where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n| extend backendPoolsCount = array_length(properties.backendAddressPools),SKUName= tostring(properties.sku.name), SKUTier= tostring(properties.sku.tier),SKUCapacity=properties.sku.capacity,backendPools=properties.backendAddressPools , AppGwId = tostring(id)\r\n| project AppGwId, name, SKUName, SKUTier, SKUCapacity\r\n| join (\r\n    resources\r\n    | where type =~ 'Microsoft.Network/applicationGateways' and (isnotempty(tags) and isnotnull(tags))\r\n    | mvexpand backendPools = properties.backendAddressPools\r\n    | extend backendIPCount = array_length(backendPools.properties.backendIPConfigurations)\r\n    | extend backendAddressesCount = array_length(backendPools.properties.backendAddresses)\r\n    | extend backendPoolName  = backendPools.properties.backendAddressPools.name\r\n    | extend AppGwId = tostring(id)\r\n    | summarize backendIPCount = sum(backendIPCount) ,backendAddressesCount=sum(backendAddressesCount) by AppGwId\r\n) on AppGwId\r\n| project-away AppGwId1\r\n| where  (backendIPCount == 0 or isempty(backendIPCount)) and (backendAddressesCount==0 or isempty(backendAddressesCount))\r\n| order by AppGwId asc",
                    "size": 0,
                    "title": "Application gateways with empty backend pools",
                    "noDataMessage": "You don't have any Application Gateways with empty backendpools",
                    "noDataMessageStyle": 3,
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "backendIPCount",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "0",
                                "representation": "disabled",
                                "text": ""
                              },
                              {
                                "operator": ">",
                                "thresholdValue": "0",
                                "representation": "success",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "backendAddressesCount",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "0",
                                "representation": "disabled",
                                "text": ""
                              },
                              {
                                "operator": ">",
                                "thresholdValue": "0",
                                "representation": "success",
                                "text": ""
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "tagName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Tags",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "tagValue",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Tags",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "backendPoolIPTarget",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": ">",
                                "thresholdValue": "0",
                                "representation": "success",
                                "text": ""
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "0",
                                "representation": "disabled",
                                "text": ""
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "backendPoolVMTarget",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "is Empty",
                                "representation": "disabled",
                                "text": ""
                              },
                              {
                                "operator": ">",
                                "thresholdValue": "0",
                                "representation": "success",
                                "text": ""
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ]
                    }
                  },
                  "name": "query - 0"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "# Recommendations for Load Balancers\r\nReview Load balancers with no backend pools, and remove them if not needed.",
                    "style": "upsell"
                  },
                  "name": "text - 25"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| where type =~ 'microsoft.network/loadbalancers'\r\n| where isnotempty(tags) and isnotnull(tags)\r\n| mvexpand tags\r\n| extend tagName = tostring(bag_keys(tags)[0])\r\n| extend tagValue = tostring(tags[tagName])\r\n| where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n| where tostring(properties.backendAddressPools) == '[]'\r\n| extend Details=id, LoadBalancerName=name, SKUname=sku.name,SkuTier=sku.tier, LBLocation=location, SubscriptionName=subscriptionId\r\n| project Details,LoadBalancerName,SKUname,SkuTier, LBLocation,tagName,tagValue,SubscriptionName\r\n| order by Details asc",
                    "size": 0,
                    "title": "Load balancers with empty backend pools found",
                    "noDataMessage": "You don't have any Azure Load Balancers!",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "tagName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Tags",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "tagValue",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Tags",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ]
                    }
                  },
                  "name": "query - 3"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "# Recommendations for Public IP Addresses\r\nReview unattached Public IP addresses, as they may represent aditional cost.\r\n<br>This query will also show Public IPs attached to Idle network cards",
                    "style": "upsell"
                  },
                  "name": "text - 4"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| where type =~ 'Microsoft.Network/publicIPAddresses'\r\n| where isempty(properties.ipConfiguration) and isempty(properties.natGateway) \r\n| where isnotempty(tags) and isnotnull(tags)\r\n| mvexpand tags\r\n| extend tagName = tostring(bag_keys(tags)[0])\r\n| extend tagValue = tostring(tags[tagName])\r\n| where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n| extend PublicIpId=id, IPName=name, AllocationMethod=tostring(properties.publicIPAllocationMethod), SKUName=sku.name,resourceGroup, Location=location, SubscriptionName=subscriptionId\r\n| project PublicIpId,IPName, SKUName, resourceGroup, Location,tagName,tagValue, AllocationMethod, subscriptionId\r\n| union (\r\n Resources \r\n | where type =~ 'microsoft.network/networkinterfaces' and isempty(properties.virtualMachine) and isnull(properties.privateEndpoint) and isnotempty(properties.ipConfigurations)\r\n | extend IPconfig = properties.ipConfigurations \r\n | mv-expand IPconfig \r\n | extend PublicIpId= tostring(IPconfig.properties.publicIPAddress.id)\r\n | project PublicIpId\r\n | join ( \r\n    resources \r\n    | where type =~ 'Microsoft.Network/publicIPAddresses'\r\n    | where isnotempty(tags) and isnotnull(tags)\r\n    | mvexpand tags\r\n    | extend tagName = tostring(bag_keys(tags)[0])\r\n    | extend tagValue = tostring(tags[tagName])\r\n    | where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n    | extend PublicIpId=id, IPName=name, AllocationMethod=tostring(properties.publicIPAllocationMethod), SKUName=sku.name,resourceGroup, Location=location \r\n ) on PublicIpId\r\n | project PublicIpId,IPName, SKUName, resourceGroup, Location,tagName,tagValue, AllocationMethod, subscriptionId\r\n)\r\n",
                    "size": 0,
                    "title": "Unattached Public IPs",
                    "noDataMessage": "You don't have any unattached Public IPs",
                    "noDataMessageStyle": 3,
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "tagName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Tags",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "tagValue",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Tags",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ]
                    }
                  },
                  "name": "query - 5"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "# Recommendations for Azure Firewall\r\nReview Azure Firewall without network traffic. These resources are billed hourly, consider reconfiguring or deleting them if they are not in use.",
                    "style": "upsell"
                  },
                  "name": "text - 6"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "parameters": [
                      {
                        "id": "b1762aaa-cd4a-4f72-bbfe-55c016908fb5",
                        "version": "KqlParameterItem/1.0",
                        "name": "FirewallTags",
                        "label": "Azure Firewall",
                        "type": 5,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": " resources\r\n| where type == \"microsoft.network/azurefirewalls\"\r\n| mvexpand tags\r\n| where tostring(bag_keys(tags)[0]) has '{TagName}' and tostring(tags['{TagName}']) has '{TagValue}'\r\n| project id\r\n",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::all"
                          ],
                          "showDefault": false
                        },
                        "timeContext": {
                          "durationMs": 2592000000
                        },
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "value": [
                          "value::all"
                        ]
                      },
                      {
                        "id": "784c94cb-7a2b-4b90-9f33-37389e809ab9",
                        "version": "KqlParameterItem/1.0",
                        "name": "TimeRangeFirewallTag",
                        "label": "Time range",
                        "type": 4,
                        "typeSettings": {
                          "selectableValues": [
                            {
                              "durationMs": 300000
                            },
                            {
                              "durationMs": 900000
                            },
                            {
                              "durationMs": 1800000
                            },
                            {
                              "durationMs": 3600000
                            },
                            {
                              "durationMs": 14400000
                            },
                            {
                              "durationMs": 43200000
                            },
                            {
                              "durationMs": 86400000
                            },
                            {
                              "durationMs": 172800000
                            },
                            {
                              "durationMs": 259200000
                            },
                            {
                              "durationMs": 604800000
                            },
                            {
                              "durationMs": 1209600000
                            },
                            {
                              "durationMs": 2419200000
                            },
                            {
                              "durationMs": 2592000000
                            },
                            {
                              "durationMs": 5184000000
                            },
                            {
                              "durationMs": 7776000000
                            }
                          ]
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "value": {
                          "durationMs": 172800000
                        }
                      }
                    ],
                    "style": "pills",
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources"
                  },
                  "name": "parameters - 7"
                },
                {
                  "type": 10,
                  "content": {
                    "chartId": "workbookf564883d-19b5-4838-80f9-d4ed5e7c73c2",
                    "version": "MetricsItem/2.0",
                    "size": 0,
                    "chartType": 2,
                    "resourceType": "microsoft.network/azurefirewalls",
                    "metricScope": 0,
                    "resourceParameter": "FirewallTags",
                    "resourceIds": [
                      "{FirewallTags}"
                    ],
                    "timeContextFromParameter": "TimeRangeFirewallTag",
                    "timeContext": {
                      "durationMs": 172800000
                    },
                    "metrics": [],
                    "title": "Azure Firewalls",
                    "gridSettings": {
                      "rowLimit": 10000
                    }
                  },
                  "name": "metric - 8"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "# Recommendations for VPN Gateways\r\nReview VPN Gateways without network traffic. These gateways are billed hourly, consider reconfiguring or deleting them if they are not in use.",
                    "style": "upsell"
                  },
                  "name": "text - 9"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "parameters": [
                      {
                        "id": "e6cb9ce7-8251-4c94-9687-de5351ac1171",
                        "version": "KqlParameterItem/1.0",
                        "name": "VPNGatewaysTags",
                        "label": "Virtual network gateways",
                        "type": 5,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "Resources \r\n| where type =~ \"microsoft.network/virtualnetworkgateways\" and properties.gatewayType == \"Vpn\"\r\n| mvexpand tags\r\n| where tostring(bag_keys(tags)[0]) has '{TagName}' and tostring(tags['{TagName}']) has '{TagValue}'\r\n| project id\r\n",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::all"
                          ],
                          "showDefault": false
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "defaultValue": "value::all",
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      {
                        "id": "13d85fc1-3da8-49c3-a6b1-26baa0fae24a",
                        "version": "KqlParameterItem/1.0",
                        "name": "TimeRangeVPNTags",
                        "label": "Time Range",
                        "type": 4,
                        "value": {
                          "durationMs": 5184000000
                        },
                        "typeSettings": {
                          "selectableValues": [
                            {
                              "durationMs": 604800000
                            },
                            {
                              "durationMs": 1209600000
                            },
                            {
                              "durationMs": 2419200000
                            },
                            {
                              "durationMs": 2592000000
                            },
                            {
                              "durationMs": 5184000000
                            },
                            {
                              "durationMs": 7776000000
                            }
                          ]
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      }
                    ],
                    "style": "pills",
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources"
                  },
                  "name": "parameters - 10"
                },
                {
                  "type": 10,
                  "content": {
                    "chartId": "workbook42ac488e-882e-4001-859f-86f54b10564c",
                    "version": "MetricsItem/2.0",
                    "size": 0,
                    "chartType": 0,
                    "resourceType": "microsoft.network/virtualnetworkgateways",
                    "metricScope": 0,
                    "resourceParameter": "VPNGatewaysTags",
                    "resourceIds": [
                      "{VPNGatewaysTags}"
                    ],
                    "timeContextFromParameter": "TimeRangeVPNTags",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "metrics": [
                      {
                        "namespace": "microsoft.network/virtualnetworkgateways",
                        "metric": "microsoft.network/virtualnetworkgateways-Traffic-TunnelTotalFlowCount",
                        "aggregation": 1
                      },
                      {
                        "namespace": "microsoft.network/virtualnetworkgateways",
                        "metric": "microsoft.network/virtualnetworkgateways-Traffic-TunnelAverageBandwidth",
                        "aggregation": 4
                      },
                      {
                        "namespace": "microsoft.network/virtualnetworkgateways",
                        "metric": "microsoft.network/virtualnetworkgateways-Traffic-P2SBandwidth",
                        "aggregation": 4
                      },
                      {
                        "namespace": "microsoft.network/virtualnetworkgateways",
                        "metric": "microsoft.network/virtualnetworkgateways-Traffic-AverageBandwidth",
                        "aggregation": 4
                      }
                    ],
                    "title": "Virtual network gateways",
                    "tileSettings": {
                      "showBorder": false,
                      "titleContent": {
                        "columnMatch": "Name",
                        "formatter": 13
                      },
                      "leftContent": {
                        "columnMatch": "Value",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    },
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Subscription",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Name",
                          "formatter": 13,
                          "formatOptions": {
                            "linkTarget": "Resource"
                          }
                        },
                        {
                          "columnMatch": "Metric",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Aggregation",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Value",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Timeline",
                          "formatter": 9
                        },
                        {
                          "columnMatch": "microsoft.network/virtualnetworkgateways-Traffic-TunnelTotalFlowCount",
                          "formatter": 1,
                          "numberFormat": {
                            "unit": 0,
                            "options": null
                          }
                        },
                        {
                          "columnMatch": "microsoft.network/virtualnetworkgateways-Traffic-TunnelAverageBandwidth",
                          "formatter": 1,
                          "numberFormat": {
                            "unit": 11,
                            "options": null
                          }
                        },
                        {
                          "columnMatch": "microsoft.network/virtualnetworkgateways-Traffic-P2SBandwidth",
                          "formatter": 1,
                          "numberFormat": {
                            "unit": 11,
                            "options": null
                          }
                        },
                        {
                          "columnMatch": "microsoft.network/virtualnetworkgateways-Traffic-AverageBandwidth",
                          "formatter": 1,
                          "numberFormat": {
                            "unit": 11,
                            "options": null
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "labelSettings": [
                        {
                          "columnId": "microsoft.network/virtualnetworkgateways-Traffic-TunnelTotalFlowCount",
                          "label": "Tunnel Total Flow Count (Sum)"
                        },
                        {
                          "columnId": "microsoft.network/virtualnetworkgateways-Traffic-TunnelTotalFlowCount Timeline",
                          "label": "Tunnel Total Flow Count Timeline"
                        },
                        {
                          "columnId": "microsoft.network/virtualnetworkgateways-Traffic-TunnelAverageBandwidth",
                          "label": "Tunnel Bandwidth (Average)"
                        },
                        {
                          "columnId": "microsoft.network/virtualnetworkgateways-Traffic-TunnelAverageBandwidth Timeline",
                          "label": "Tunnel Bandwidth Timeline"
                        },
                        {
                          "columnId": "microsoft.network/virtualnetworkgateways-Traffic-P2SBandwidth",
                          "label": "Gateway P2S Bandwidth (Average)"
                        },
                        {
                          "columnId": "microsoft.network/virtualnetworkgateways-Traffic-P2SBandwidth Timeline",
                          "label": "Gateway P2S Bandwidth Timeline"
                        },
                        {
                          "columnId": "microsoft.network/virtualnetworkgateways-Traffic-AverageBandwidth",
                          "label": "Gateway S2S Bandwidth (Average)"
                        },
                        {
                          "columnId": "microsoft.network/virtualnetworkgateways-Traffic-AverageBandwidth Timeline",
                          "label": "Gateway S2S Bandwidth Timeline"
                        }
                      ]
                    }
                  },
                  "name": "metric - 11"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "# Recommendationsss for Azure Front Door\r\nReview Azure Front Doors without network traffic. These front doors are billed hourly, consider reconfiguring or deleting them if they are not in use.\r\n",
                    "style": "upsell"
                  },
                  "name": "text - 13"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [
                      ""
                    ],
                    "parameters": [
                      {
                        "id": "b2836f22-1d25-4398-88a0-fb6a60a2d1c5",
                        "version": "KqlParameterItem/1.0",
                        "name": "AzureFrontDoorTags",
                        "label": "Azure Front Door",
                        "type": 5,
                        "isRequired": true,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "resources\r\n| where type =~ 'microsoft.network/frontdoors' or (type =~ 'microsoft.cdn/profiles' and kind =~ 'frontdoor')\r\n| mvexpand tags\r\n| where tostring(bag_keys(tags)[0]) has '{TagName}' and tostring(tags['{TagName}']) has '{TagValue}'\r\n| project id\r\n",
                        "crossComponentResources": [
                          ""
                        ],
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::all"
                          ],
                          "showDefault": false
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "defaultValue": "value::all",
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "value": [
                          "value::all"
                        ]
                      },
                      {
                        "id": "88c7d0b5-c110-4251-acc0-866e422f2fce",
                        "version": "KqlParameterItem/1.0",
                        "name": "TimerRangeTags",
                        "label": "Time Range",
                        "type": 4,
                        "isRequired": true,
                        "typeSettings": {
                          "selectableValues": [
                            {
                              "durationMs": 604800000
                            },
                            {
                              "durationMs": 1209600000
                            },
                            {
                              "durationMs": 2419200000
                            },
                            {
                              "durationMs": 2592000000
                            },
                            {
                              "durationMs": 5184000000
                            },
                            {
                              "durationMs": 7776000000
                            }
                          ]
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "value": {
                          "durationMs": 1209600000
                        }
                      }
                    ],
                    "style": "pills",
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources"
                  },
                  "name": "parameters - 14"
                },
                {
                  "type": 10,
                  "content": {
                    "chartId": "workbooka4c0fdec-299b-4537-990d-8348f2888416",
                    "version": "MetricsItem/2.0",
                    "size": 0,
                    "chartType": 2,
                    "resourceType": "microsoft.cdn/profiles",
                    "metricScope": 0,
                    "resourceParameter": "AzureFrontDoorTags",
                    "resourceIds": [
                      "{AzureFrontDoorTags}"
                    ],
                    "timeContextFromParameter": "TimerRangeTags",
                    "timeContext": {
                      "durationMs": 1209600000
                    },
                    "metrics": [
                      {
                        "namespace": "microsoft.cdn/profiles",
                        "metric": "microsoft.cdn/profiles--RequestCount",
                        "aggregation": 1,
                        "splitBy": null
                      }
                    ],
                    "title": "Azure Front Door",
                    "gridSettings": {
                      "rowLimit": 10000
                    }
                  },
                  "name": "metric - 15"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "RG_Filter",
              "comparison": "isEqualTo",
              "value": "Tags"
            },
            "name": "networking - Tags"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "SelectedTab",
        "comparison": "isEqualTo",
        "value": "Networking"
      },
      "name": "NetworkingGroup",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Cost Information",
        "items": [
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "parameters": [
                {
                  "id": "fffccc1f-fc7d-497c-b45b-29417117b862",
                  "version": "KqlParameterItem/1.0",
                  "name": "Subscription",
                  "type": 6,
                  "isRequired": true,
                  "value": "",
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "includeAll": true
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  }
                }
              ],
              "style": "pills",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources"
            },
            "name": "parameters - 0"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "1b71c24e-3e21-4598-a1c4-10106dcdfeca",
                  "version": "KqlParameterItem/1.0",
                  "name": "RG_Filter",
                  "label": "Filter By",
                  "type": 2,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\r\n    { \"value\":\"Resource Group\",\"selected\":\"true\"},\r\n    { \"value\":\"Tags\" }\r\n]",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isNotEqualTo",
              "value": "General"
            },
            "name": "parameters - 5"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "parameters": [
                {
                  "id": "42099afa-2462-4f0e-88be-b87bb1d3c908",
                  "version": "KqlParameterItem/1.0",
                  "name": "ResourceGroup",
                  "label": "Resource Group",
                  "type": 2,
                  "isRequired": true,
                  "multiSelect": true,
                  "quote": "\"",
                  "delimiter": ",",
                  "query": "resourceContainers | where type == 'microsoft.resources/subscriptions/resourcegroups'\r\n| project resourceGroup\r\n| sort by resourceGroup asc",
                  "crossComponentResources": [
                    "{Subscription}"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "defaultValue": "value::all",
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources"
                }
              ],
              "style": "pills",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources"
            },
            "conditionalVisibilities": [
              {
                "parameterName": "RG_Filter",
                "comparison": "isEqualTo",
                "value": "Resource Group"
              },
              {
                "parameterName": "SelectedTab",
                "comparison": "isNotEqualTo",
                "value": "General"
              }
            ],
            "name": "parameters - 6"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "parameters": [
                {
                  "id": "90a85a21-e4f8-48e6-92cb-87aa64a11f3b",
                  "version": "KqlParameterItem/1.0",
                  "name": "TagName",
                  "label": "Tag Name",
                  "type": 2,
                  "isRequired": true,
                  "query": "Resources\r\n| where tags != '' and tags != '[]'\r\n| mvexpand tags\r\n| extend tagName = tostring(bag_keys(tags)[0])\r\n| distinct tagName\r\n| sort by tagName asc",
                  "crossComponentResources": [
                    "{Subscription}"
                  ],
                  "value": null,
                  "typeSettings": {
                    "additionalResourceOptions": []
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.resourcegraph/resources"
            },
            "customWidth": "20",
            "conditionalVisibilities": [
              {
                "parameterName": "RG_Filter",
                "comparison": "isEqualTo",
                "value": "Tags"
              },
              {
                "parameterName": "SelectedTab",
                "comparison": "isNotEqualTo",
                "value": "General"
              }
            ],
            "name": "parameters - 7"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "parameters": [
                {
                  "id": "8bd3bf68-2f67-4bf7-a72a-c87817fc172c",
                  "version": "KqlParameterItem/1.0",
                  "name": "TagValue",
                  "label": "Tag Value",
                  "type": 2,
                  "isRequired": true,
                  "query": "Resources\r\n| mvexpand tags\r\n| extend tagName = tostring(bag_keys(tags)[0])\r\n| extend tagValue = tostring(tags[tagName])\r\n| where tags != '' and tags != '[]' and tostring(bag_keys(tags)[0]) == '{TagName}'\r\n| distinct tagValue\r\n| sort by tagValue asc",
                  "crossComponentResources": [
                    "{Subscription}"
                  ],
                  "value": "Azure Policy - Deploy Auditing on SQL servers",
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources"
                }
              ],
              "style": "pills",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources"
            },
            "customWidth": "20",
            "conditionalVisibilities": [
              {
                "parameterName": "RG_Filter",
                "comparison": "isEqualTo",
                "value": "Tags"
              },
              {
                "parameterName": "SelectedTab",
                "comparison": "isNotEqualTo",
                "value": "General"
              },
              {
                "parameterName": "TagName",
                "comparison": "isNotEqualTo"
              }
            ],
            "name": "parameters - 8"
          },
          {
            "type": 1,
            "content": {
              "json": "# This Tab will show Information about idle resource that have impact on cost\r\n### Note: The cost information available  in this tab relates to the previous month.  If the resources was created less than 30 days ago, check the cost management and billing blade.\r\n### *Billing reader permission as a minimum is needed to populate cost information"
            },
            "name": "text - 1"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":\"{\\r\\n\\t\\\"type\\\": \\\"Usage\\\",\\r\\n\\t\\\"timeframe\\\": \\\"TheLastMonth\\\",\\r\\n\\t\\\"dataset\\\": {\\r\\n\\t\\t\\\"granularity\\\": \\\"None\\\",\\r\\n\\t\\t\\\"filter\\\": {\\r\\n\\t\\t\\t\\\"and\\\": [\\r\\n\\t\\t\\t\\t{\\r\\n\\t\\t\\t\\t\\t\\\"dimensions\\\": {\\r\\n\\t\\t\\t\\t\\t\\t\\\"name\\\": \\\"resourceType\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\\"operator\\\": \\\"In\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\\"values\\\": [\\r\\n\\t\\t\\t\\t\\t\\t\\t\\\"microsoft.compute/disks\\\"\\r\\n\\t\\t\\t\\t\\t\\t]\\r\\n\\t\\t\\t\\t\\t}\\r\\n\\t\\t\\t\\t},\\r\\n\\t\\t\\t\\t{\\r\\n\\t\\t\\t\\t\\t\\\"dimensions\\\": {\\r\\n\\t\\t\\t\\t\\t\\t\\\"name\\\": \\\"ResourceGroup\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\\"operator\\\": \\\"In\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\\"values\\\": [\\r\\n\\t\\t\\t\\t\\t\\t\\t{ResourceGroup}\\r\\n\\t\\t\\t\\t\\t\\t\\t]\\r\\n\\t\\t\\t\\t\\t}\\r\\n\\t\\t\\t\\t}\\r\\n\\t\\t\\t]\\r\\n\\t\\t},\\r\\n\\t\\t\\\"aggregation\\\": {\\r\\n\\t\\t\\t\\\"totalCost\\\": {\\r\\n\\t\\t\\t\\t\\\"name\\\": \\\"PreTaxCost\\\",\\r\\n\\t\\t\\t\\t\\\"function\\\": \\\"Sum\\\"\\r\\n\\t\\t\\t}\\r\\n\\t\\t},\\r\\n\\t\\t\\\"grouping\\\": [\\r\\n\\t\\t\\t{\\r\\n\\t\\t\\t\\t\\\"type\\\": \\\"Dimension\\\",\\r\\n\\t\\t\\t\\t\\\"name\\\": \\\"ResourceId\\\"\\r\\n\\t\\t\\t}\\r\\n\\t\\t]\\r\\n\\t}\\r\\n}\",\"headers\":[],\"method\":\"POST\",\"path\":\"/subscriptions/{Subscription:id}/providers/Microsoft.CostManagement/query?\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2019-11-01\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.properties\",\"columns\":[]}}]}",
                    "size": 0,
                    "title": "GetCostAllDisks",
                    "queryType": 12
                  },
                  "conditionalVisibility": {
                    "parameterName": "isVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - GetAllDisksCost"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "Review the unattached disks below to review if they still needed to avoid unnecessary costs.",
                    "style": "upsell"
                  },
                  "name": "text - 5"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources \r\n| where type =~ 'microsoft.compute/disks' and resourceGroup in ({ResourceGroup})\r\n| extend diskState = tostring(properties.diskState)\r\n| where managedBy == \"\" and diskState != 'ActiveSAS'\r\nor diskState == 'Unattached' and diskState != 'ActiveSAS'\r\n| extend DiskID=id, DiskName=name, SKUName=sku.name, SKUTier=sku.tier, DiskSizeGB=tostring(properties.diskSizeGB),DiskRG=resourceGroup, Location=location, TimeCreated=tostring(properties.timeCreated)\r\n| order by id asc \r\n| project DiskID,DiskName, DiskSizeGB, SKUName, SKUTier, DiskRG, Location, TimeCreated, subscriptionId",
                    "size": 0,
                    "title": "Unattached Disks",
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "isVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - GetUnattachedDisks"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"890db43d-bfd3-4a7c-94df-e030a0c03093\",\"mergeType\":\"innerunique\",\"leftTable\":\"query - GetAllDisksCost\",\"rightTable\":\"query - GetUnattachedDisks\",\"leftColumn\":\"ResourceId\",\"rightColumn\":\"DiskID\"}],\"projectRename\":[{\"originalName\":\"[query - GetUnattachedDisks].DiskID\",\"mergedName\":\"DiskID\",\"fromId\":\"890db43d-bfd3-4a7c-94df-e030a0c03093\"},{\"originalName\":\"[query - GetAllDisksCost].PreTaxCost\",\"mergedName\":\"Last Month Cost\",\"fromId\":\"890db43d-bfd3-4a7c-94df-e030a0c03093\"},{\"originalName\":\"[query - GetAllDisksCost].Currency\",\"mergedName\":\"Currency\",\"fromId\":\"890db43d-bfd3-4a7c-94df-e030a0c03093\"},{\"originalName\":\"[query - GetUnattachedDisks].DiskSizeGB\",\"mergedName\":\"DiskSizeGB\",\"fromId\":\"890db43d-bfd3-4a7c-94df-e030a0c03093\"},{\"originalName\":\"[query - GetUnattachedDisks].SKUName\",\"mergedName\":\"SKUName\",\"fromId\":\"890db43d-bfd3-4a7c-94df-e030a0c03093\"},{\"originalName\":\"[query - GetUnattachedDisks].SKUTier\",\"mergedName\":\"SKUTier\",\"fromId\":\"890db43d-bfd3-4a7c-94df-e030a0c03093\"},{\"originalName\":\"[query - GetUnattachedDisks].DiskRG\",\"mergedName\":\"DiskRG\",\"fromId\":\"890db43d-bfd3-4a7c-94df-e030a0c03093\"},{\"originalName\":\"[query - GetUnattachedDisks].Location\",\"mergedName\":\"Location\",\"fromId\":\"890db43d-bfd3-4a7c-94df-e030a0c03093\"},{\"originalName\":\"[query - GetUnattachedDisks].TimeCreated\",\"mergedName\":\"TimeCreated\",\"fromId\":\"890db43d-bfd3-4a7c-94df-e030a0c03093\"},{\"originalName\":\"[query - GetUnattachedDisks].subscriptionId\",\"mergedName\":\"subscriptionId\",\"fromId\":\"890db43d-bfd3-4a7c-94df-e030a0c03093\"},{\"originalName\":\"[query - GetAllDisksCost].ResourceId\"},{\"originalName\":\"[query - GetUnattachedDisks].DiskName\"}]}",
                    "size": 0,
                    "title": "Unattached Managed Disks cost",
                    "showExportToExcel": true,
                    "exportToExcelOptions": "all",
                    "queryType": 7
                  },
                  "showPin": false,
                  "name": "query - Unattaached Disks Cost"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources \r\n| where resourceGroup in ({ResourceGroup})\r\n| where type =~ 'microsoft.network/loadbalancers' and tostring(properties.backendAddressPools) == '[]' \r\n| extend Details=id,LBRG=resourceGroup, LoadBalancerName=name, SKU=sku, LBLocation=location\r\n| order by id asc\r\n| project Details,LoadBalancerName, SKU.name,SKU.tier, LBLocation,LBRG, subscriptionId\r\n",
                          "size": 0,
                          "title": "query - GetUnattachedLoadBalancers",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ]
                        },
                        "conditionalVisibility": {
                          "parameterName": "isVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "query - GetUnattachedLoadBalancers"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":\"{\\r\\n\\t\\\"type\\\": \\\"Usage\\\",\\r\\n\\t\\\"timeframe\\\": \\\"TheLastMonth\\\",\\r\\n\\t\\\"dataset\\\": {\\r\\n\\t\\t\\\"granularity\\\": \\\"None\\\",\\r\\n\\t\\t\\\"filter\\\": {\\r\\n\\t\\t\\t\\\"and\\\": [\\r\\n\\t\\t\\t\\t{\\r\\n\\t\\t\\t\\t\\t\\\"dimensions\\\": {\\r\\n\\t\\t\\t\\t\\t\\t\\\"name\\\": \\\"resourceType\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\\"operator\\\": \\\"In\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\\"values\\\": [\\r\\n\\t\\t\\t\\t\\t\\t\\t\\\"microsoft.network/loadbalancers\\\"\\r\\n\\t\\t\\t\\t\\t\\t]\\r\\n\\t\\t\\t\\t\\t}\\r\\n\\t\\t\\t\\t},\\r\\n\\t\\t\\t\\t{\\r\\n\\t\\t\\t\\t\\t\\\"dimensions\\\": {\\r\\n\\t\\t\\t\\t\\t\\t\\\"name\\\": \\\"ResourceGroup\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\\"operator\\\": \\\"In\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\\"values\\\": [\\r\\n\\t\\t\\t\\t\\t\\t\\t{ResourceGroup}\\r\\n\\t\\t\\t\\t\\t\\t\\t]\\r\\n\\t\\t\\t\\t\\t}\\r\\n\\t\\t\\t\\t}\\r\\n\\t\\t\\t]\\r\\n\\t\\t},\\r\\n\\t\\t\\\"aggregation\\\": {\\r\\n\\t\\t\\t\\\"totalCost\\\": {\\r\\n\\t\\t\\t\\t\\\"name\\\": \\\"PreTaxCost\\\",\\r\\n\\t\\t\\t\\t\\\"function\\\": \\\"Sum\\\"\\r\\n\\t\\t\\t}\\r\\n\\t\\t},\\r\\n\\t\\t\\\"grouping\\\": [\\r\\n\\t\\t\\t{\\r\\n\\t\\t\\t\\t\\\"type\\\": \\\"Dimension\\\",\\r\\n\\t\\t\\t\\t\\\"name\\\": \\\"ResourceId\\\"\\r\\n\\t\\t\\t}\\r\\n\\t\\t]\\r\\n\\t}\\r\\n}\",\"headers\":[],\"method\":\"POST\",\"path\":\"/subscriptions/{Subscription:id}/providers/Microsoft.CostManagement/query?\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2019-11-01\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.properties\",\"columns\":[]}}]}",
                          "size": 0,
                          "title": "GetAllLBsCost",
                          "queryType": 12
                        },
                        "conditionalVisibility": {
                          "parameterName": "isVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "query - GetAllLBsCost"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"a4f6422d-06bc-42c4-809c-708dd791208a\",\"mergeType\":\"innerunique\",\"leftTable\":\"query - GetAllLBsCost\",\"rightTable\":\"query - GetUnattachedLoadBalancers\",\"leftColumn\":\"ResourceId\",\"rightColumn\":\"Details\"}],\"projectRename\":[{\"originalName\":\"[query - GetAllLBsCost].PreTaxCost\",\"mergedName\":\"PreTaxCost\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd791208a\"},{\"originalName\":\"[query - GetAllLBsCost].ResourceId\",\"mergedName\":\"ResourceId\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd791208a\"},{\"originalName\":\"[query - GetAllLBsCost].Currency\",\"mergedName\":\"Currency\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd791208a\"},{\"originalName\":\"[query - GetUnattachedLoadBalancers].Details\",\"mergedName\":\"Details\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd791208a\"},{\"originalName\":\"[query - GetUnattachedLoadBalancers].LoadBalancerName\",\"mergedName\":\"LoadBalancerName\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd791208a\"},{\"originalName\":\"[query - GetUnattachedLoadBalancers].SKU_name\",\"mergedName\":\"SKU_name\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd791208a\"},{\"originalName\":\"[query - GetUnattachedLoadBalancers].SKU_tier\",\"mergedName\":\"SKU_tier\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd791208a\"},{\"originalName\":\"[query - GetUnattachedLoadBalancers].LBLocation\",\"mergedName\":\"LBLocation\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd791208a\"},{\"originalName\":\"[query - GetUnattachedLoadBalancers].LBRG\",\"mergedName\":\"LBRG\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd791208a\"},{\"originalName\":\"[query - GetUnattachedLoadBalancers].subscriptionId\",\"mergedName\":\"subscriptionId\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd791208a\"},{\"originalName\":\"[query - GetAllLoadBalancers].ResourceId\"},{\"originalName\":\"[query - GetUnattachedLoadBalancers].LoadBalancerName\"}]}",
                          "size": 0,
                          "title": "Unattached Load balancers Cost",
                          "showExportToExcel": true,
                          "exportToExcelOptions": "all",
                          "queryType": 7
                        },
                        "showPin": false,
                        "name": "Merge - Unattaached Load balancers Cost"
                      }
                    ]
                  },
                  "name": "Load Balancer"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources\r\n| where type =~ 'Microsoft.Network/applicationGateways' and resourceGroup in ({ResourceGroup})\r\n| extend backendPoolsCount = array_length(properties.backendAddressPools),SKUName= tostring(properties.sku.name), SKUTier= tostring(properties.sku.tier),SKUCapacity=properties.sku.capacity,backendPools=properties.backendAddressPools\r\n| project id, name, SKUName, SKUTier, SKUCapacity\r\n| join (\r\n    resources\r\n    | where type =~ 'Microsoft.Network/applicationGateways' and resourceGroup in ({ResourceGroup})\r\n    | mvexpand backendPools = properties.backendAddressPools\r\n    | extend backendIPCount = array_length(backendPools.properties.backendIPConfigurations)\r\n    | extend backendAddressesCount = array_length(backendPools.properties.backendAddresses)\r\n    | extend backendPoolName  = backendPools.properties.backendAddressPools.name\r\n    | summarize backendIPCount = sum(backendIPCount) ,backendAddressesCount=sum(backendAddressesCount) by id\r\n) on id\r\n| project-away id1\r\n| where  (backendIPCount == 0 or isempty(backendIPCount)) and (backendAddressesCount==0 or isempty(backendAddressesCount))\r\n| order by id asc",
                          "size": 0,
                          "title": "Unattached Application Gateways",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ]
                        },
                        "conditionalVisibility": {
                          "parameterName": "isVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "query - GetUnattachedApplicationGWs"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":\"{\\r\\n    \\\"type\\\": \\\"Usage\\\",\\r\\n    \\\"timeframe\\\": \\\"TheLastMonth\\\",\\r\\n    \\\"dataset\\\": {\\r\\n      \\\"granularity\\\": \\\"None\\\",\\r\\n\\t  \\\"filter\\\": {\\r\\n\\t\\t\\t\\\"and\\\": [\\r\\n\\t\\t\\t\\t{\\r\\n\\t\\t\\t\\t\\t\\\"dimensions\\\": {\\r\\n\\t\\t\\t\\t\\t\\t\\\"name\\\": \\\"resourceType\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\\"operator\\\": \\\"In\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\\"values\\\": [\\r\\n\\t\\t\\t\\t\\t\\t\\t\\\"microsoft.network/applicationgateways\\\"\\r\\n\\t\\t\\t\\t\\t\\t]\\r\\n\\t\\t\\t\\t\\t}\\r\\n\\t\\t\\t\\t},\\r\\n\\t\\t\\t\\t{\\r\\n\\t\\t\\t\\t\\t\\\"dimensions\\\": {\\r\\n\\t\\t\\t\\t\\t\\t\\\"name\\\": \\\"ResourceGroup\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\\"operator\\\": \\\"In\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\\"values\\\": [\\r\\n\\t\\t\\t\\t\\t\\t\\t{ResourceGroup}\\r\\n\\t\\t\\t\\t\\t\\t\\t]\\r\\n\\t\\t\\t\\t\\t}\\r\\n\\t\\t\\t\\t}\\r\\n\\t\\t\\t]\\r\\n\\t\\t},\\r\\n      \\\"aggregation\\\": {\\r\\n       \\\"totalCost\\\": {\\r\\n          \\\"name\\\": \\\"PreTaxCost\\\",\\r\\n          \\\"function\\\": \\\"Sum\\\"\\r\\n        }\\r\\n      },\\r\\n     \\\"grouping\\\": [\\r\\n        {\\r\\n         \\\"type\\\": \\\"Dimension\\\",\\r\\n          \\\"name\\\": \\\"ResourceId\\\"\\r\\n        }\\r\\n      ]\\r\\n    }\\r\\n  }\",\"headers\":[],\"method\":\"POST\",\"path\":\"/subscriptions/{Subscription:id}/providers/Microsoft.CostManagement/query?\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2019-11-01\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.properties\",\"columns\":[]}}]}",
                          "size": 0,
                          "title": "Cost-GetAllApplicationGWs",
                          "queryType": 12
                        },
                        "conditionalVisibility": {
                          "parameterName": "isVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "query - GetAllApplicationGWs"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"a4f6422d-06bc-42c4-809c-708dd79120a7\",\"mergeType\":\"innerunique\",\"leftTable\":\"query - GetAllApplicationGWs\",\"rightTable\":\"query - GetUnattachedApplicationGWs\",\"leftColumn\":\"ResourceId\",\"rightColumn\":\"id\"}],\"projectRename\":[{\"originalName\":\"[query - GetUnattachedApplicationGWs].id\",\"mergedName\":\"id\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120a7\"},{\"originalName\":\"[query - GetAllApplicationGWs].PreTaxCost\",\"mergedName\":\"Last Month Cost\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120a7\"},{\"originalName\":\"[query - GetAllApplicationGWs].Currency\",\"mergedName\":\"Currency\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120a7\"},{\"originalName\":\"[query - GetUnattachedApplicationGWs].SKUName\",\"mergedName\":\"SKUName\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120a7\"},{\"originalName\":\"[query - GetUnattachedApplicationGWs].SKUTier\",\"mergedName\":\"SKUTier\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120a7\"},{\"originalName\":\"[query - GetUnattachedApplicationGWs].SKUCapacity\",\"mergedName\":\"SKUCapacity\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120a7\"},{\"originalName\":\"[query - GetUnattachedApplicationGWs].backendIPCount\",\"mergedName\":\"backendIPCount\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120a7\"},{\"originalName\":\"[query - GetUnattachedApplicationGWs].backendAddressesCount\",\"mergedName\":\"backendAddressesCount\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120a7\"},{\"originalName\":\"[query - GetAllApplicationGWs].ResourceId\"},{\"originalName\":\"[query - GetUnattachedApplicationGWs].name\"}]}",
                          "size": 0,
                          "title": "Idle Application Gateways Cost",
                          "showExportToExcel": true,
                          "exportToExcelOptions": "all",
                          "queryType": 7
                        },
                        "name": "query - Unattached ApplicationGWs Cost"
                      }
                    ]
                  },
                  "name": "Application Gateway"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":\"{\\r\\n    \\\"type\\\": \\\"Usage\\\",\\r\\n    \\\"timeframe\\\": \\\"TheLastMonth\\\",\\r\\n    \\\"dataset\\\": {\\r\\n      \\\"granularity\\\": \\\"None\\\",\\r\\n\\t  \\\"filter\\\": {\\r\\n\\t\\t\\t\\\"and\\\": [\\r\\n\\t\\t\\t\\t{\\r\\n\\t\\t\\t\\t\\t\\\"dimensions\\\": {\\r\\n\\t\\t\\t\\t\\t\\t\\\"name\\\": \\\"resourceType\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\\"operator\\\": \\\"In\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\\"values\\\": [\\r\\n\\t\\t\\t\\t\\t\\t\\t\\\"microsoft.network/publicIPAddresses\\\"\\r\\n\\t\\t\\t\\t\\t\\t]\\r\\n\\t\\t\\t\\t\\t}\\r\\n\\t\\t\\t\\t},\\r\\n\\t\\t\\t\\t{\\r\\n\\t\\t\\t\\t\\t\\\"dimensions\\\": {\\r\\n\\t\\t\\t\\t\\t\\t\\\"name\\\": \\\"ResourceGroup\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\\"operator\\\": \\\"In\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\\"values\\\": [\\r\\n\\t\\t\\t\\t\\t\\t\\t{ResourceGroup}\\r\\n\\t\\t\\t\\t\\t\\t\\t]\\r\\n\\t\\t\\t\\t\\t}\\r\\n\\t\\t\\t\\t}\\r\\n\\t\\t\\t]\\r\\n\\t\\t},\\r\\n      \\\"aggregation\\\": {\\r\\n       \\\"totalCost\\\": {\\r\\n          \\\"name\\\": \\\"PreTaxCost\\\",\\r\\n          \\\"function\\\": \\\"Sum\\\"\\r\\n        }\\r\\n      },\\r\\n     \\\"grouping\\\": [\\r\\n        {\\r\\n         \\\"type\\\": \\\"Dimension\\\",\\r\\n          \\\"name\\\": \\\"ResourceId\\\"\\r\\n        }\\r\\n      ]\\r\\n    }\\r\\n  }\",\"headers\":[],\"method\":\"POST\",\"path\":\"/subscriptions/{Subscription:id}/providers/Microsoft.CostManagement/query?\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2019-11-01\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.properties\",\"columns\":[]}}]}",
                          "size": 0,
                          "title": "Cost-GetAllPublicIPAddresses",
                          "queryType": 12
                        },
                        "conditionalVisibility": {
                          "parameterName": "isVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "query - GetAllPublicIPAddresses"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources \r\n| where resourceGroup in ({ResourceGroup})\r\n| where type =~ 'Microsoft.Network/publicIPAddresses' and isempty(properties.ipConfiguration) and isempty(properties.natGateway) \r\n| extend IdleIP=id, IPName=name, AllocationMethod=tostring(properties.publicIPAllocationMethod), SKUName=sku.name, PIPRG=resourceGroup, Location=location \r\n| project IdleIP,IPName, SKUName, PIPRG, Location, AllocationMethod, subscriptionId\r\n| union (\r\n Resources \r\n | where type =~ 'microsoft.network/networkinterfaces' and isempty(properties.virtualMachine) and isnull(properties.privateEndpoint) and isnotempty(properties.ipConfigurations) \r\n | extend IPconfig = properties.ipConfigurations \r\n | mv-expand IPconfig \r\n | extend IdleIP= tostring(IPconfig.properties.publicIPAddress.id)\r\n | project IdleIP\r\n | join ( \r\n    resources \r\n    | where type =~ 'Microsoft.Network/publicIPAddresses'\r\n    | extend IdleIP=id, IPName=name, AllocationMethod=tostring(properties.publicIPAllocationMethod), SKUName=sku.name, PIPRG=resourceGroup, Location=location \r\n ) on IdleIP\r\n | project IdleIP,IPName, SKUName, PIPRG, Location, AllocationMethod, subscriptionId\r\n)\r\n",
                          "size": 0,
                          "title": "Unattached Public IP Addresses",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ]
                        },
                        "conditionalVisibility": {
                          "parameterName": "isVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "query - GetUnattachedPublicIPAddresses"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"a4f6422d-06bc-42c4-809c-708dd79120c0\",\"mergeType\":\"innerunique\",\"leftTable\":\"query - GetAllPublicIPAddresses\",\"rightTable\":\"query - GetUnattachedPublicIPAddresses\",\"leftColumn\":\"ResourceId\",\"rightColumn\":\"IdleIP\"}],\"projectRename\":[{\"originalName\":\"[query - GetUnattachedPublicIPAddresses].IdleIP\",\"mergedName\":\"IdleIP\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120c0\"},{\"originalName\":\"[query - GetAllPublicIPAddresses].PreTaxCost\",\"mergedName\":\"Last Month Cost\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120c0\"},{\"originalName\":\"[query - GetAllPublicIPAddresses].Currency\",\"mergedName\":\"Currency\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120c0\"},{\"originalName\":\"[query - GetUnattachedPublicIPAddresses].IPName\",\"mergedName\":\"IPName\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120c0\"},{\"originalName\":\"[query - GetUnattachedPublicIPAddresses].SKUName\",\"mergedName\":\"SKUName\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120c0\"},{\"originalName\":\"[query - GetUnattachedPublicIPAddresses].PIPRG\",\"mergedName\":\"PIPRG\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120c0\"},{\"originalName\":\"[query - GetUnattachedPublicIPAddresses].Location\",\"mergedName\":\"Location\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120c0\"},{\"originalName\":\"[query - GetUnattachedPublicIPAddresses].AllocationMethod\",\"mergedName\":\"AllocationMethod\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120c0\"},{\"originalName\":\"[query - GetUnattachedPublicIPAddresses].subscriptionId\",\"mergedName\":\"subscriptionId\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120c0\"},{\"originalName\":\"[query - GetAllPublicIPAddresses].ResourceId\"}]}",
                          "size": 0,
                          "title": "Unattached Public IP addresses Cost",
                          "showExportToExcel": true,
                          "exportToExcelOptions": "all",
                          "queryType": 7
                        },
                        "showPin": false,
                        "name": "query - Unattached Public IP addresses Cost"
                      }
                    ]
                  },
                  "name": "Public IP Address"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":\"{\\r\\n    \\\"type\\\": \\\"Usage\\\",\\r\\n    \\\"timeframe\\\": \\\"TheLastMonth\\\",\\r\\n    \\\"dataset\\\": {\\r\\n      \\\"granularity\\\": \\\"None\\\",\\r\\n\\t  \\\"filter\\\":{\\r\\n\\t\\t  \\\"dimensions\\\" : {\\r\\n                      \\\"name\\\" : \\\"resourceType\\\",\\r\\n                      \\\"operator\\\" : \\\"In\\\",\\r\\n                      \\\"values\\\" : [\\r\\n                         \\\"Microsoft.Compute/VirtualMachines\\\"\\r\\n                      ]\\r\\n                  }\\r\\n\\t  },\\r\\n      \\\"aggregation\\\": {\\r\\n       \\\"totalCost\\\": {\\r\\n          \\\"name\\\": \\\"PreTaxCost\\\",\\r\\n          \\\"function\\\": \\\"Sum\\\"\\r\\n        }\\r\\n      },\\r\\n     \\\"grouping\\\": [\\r\\n        {\\r\\n         \\\"type\\\": \\\"Dimension\\\",\\r\\n          \\\"name\\\": \\\"ResourceId\\\"\\r\\n        }\\r\\n      ]\\r\\n    }\\r\\n  }\",\"headers\":[],\"method\":\"POST\",\"path\":\"/subscriptions/{Subscription:id}/providers/Microsoft.CostManagement/query?\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2019-11-01\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.properties\",\"columns\":[]}}]}",
                          "size": 0,
                          "title": "Cost-GetAllVMs",
                          "queryType": 12
                        },
                        "conditionalVisibility": {
                          "parameterName": "isVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "query - GetAllVMs"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/providers/Microsoft.Compute/skus?$filter=location eq 'westus'\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2019-04-01\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.*[?(@.resourceType=='virtualMachines')]\",\"columns\":[{\"path\":\"name\",\"columnid\":\"Name\"},{\"path\":\"capabilities[?(@.name=='vCPUs')].value\",\"columnid\":\"vCPUs\"}]}}]}",
                          "size": 0,
                          "title": "Get VM vCPU",
                          "queryType": 12
                        },
                        "conditionalVisibility": {
                          "parameterName": "isVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "query - Get VM vCPU"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources \r\n| where resourceGroup in ({ResourceGroup})\r\n| where type =~ 'microsoft.compute/virtualmachines' or type =~ 'microsoft.compute/virtualMachineScaleSets'\r\n| where tostring(properties.storageProfile.osDisk.osType) == 'Windows' or tostring(properties.virtualMachineProfile.storageProfile.osDisk.osType) == 'Windows'\r\n| where tostring(properties.['licenseType']) !has 'Windows' and tostring(properties.virtualMachineProfile.['licenseType']) !has 'Windows'\r\n| extend WindowsId=id, VMName=name, VMLocation=location, VMRG=resourceGroup, OSType=tostring(properties.storageProfile.imageReference.offer), OsVersion = tostring(properties.storageProfile.imageReference.sku), VMSize=tostring (properties.hardwareProfile.vmSize), LicenseType = tostring(properties.['licenseType'])\r\n| order by type asc \r\n| project WindowsId,VMName,VMRG,VMSize, VMLocation,OSType, OsVersion,LicenseType",
                          "size": 0,
                          "title": "Windows VMs and VMSS without Azure Hybrid Benefit",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ]
                        },
                        "conditionalVisibility": {
                          "parameterName": "isVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "query - GetWindowsVMs-AHUB"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources \r\n| where type =~ 'microsoft.compute/virtualmachines' and (properties.storageProfile.imageReference.publisher == 'suse' or properties.storageProfile.imageReference.publisher=='RedHat')\r\n| where tostring(properties.['licenseType']) != 'SLES_BYOS' and tostring(properties.['licenseType']) != 'RHEL_BYOS' \r\n| extend linuxId=id, VMName=name, VMLocation=location, VMRG=resourceGroup, OSType=tostring(properties.storageProfile.imageReference.offer), OsVersion = tostring(properties.storageProfile.imageReference.sku), VMSize=tostring (properties.hardwareProfile.vmSize), LicenseType = tostring(properties.['licenseType']) \r\n    | order by VMSize asc \r\n    | where VMRG in ({ResourceGroup})\r\n    | project linuxId,VMName,VMRG, VMLocation,OSType, OsVersion,LicenseType, VMSize",
                          "size": 0,
                          "title": "Linux VMs without Azure Hybrid Benefit",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ]
                        },
                        "conditionalVisibility": {
                          "parameterName": "isVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "query - GetLinuxVMs-AHUB"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"a4f6422d-06bc-42c4-809c-708dd79120fb\",\"mergeType\":\"innerunique\",\"leftTable\":\"query - GetAllVMs\",\"rightTable\":\"query - GetWindowsVMs-AHUB\",\"leftColumn\":\"ResourceId\",\"rightColumn\":\"WindowsId\"},{\"id\":\"a4f6422d-06bc-42c4-809c-708dd79120ff\",\"mergeType\":\"leftouter\",\"leftTable\":\"query - GetWindowsVMs-AHUB\",\"rightTable\":\"query - Get VM vCPU\",\"leftColumn\":\"VMSize\",\"rightColumn\":\"Name\"}],\"projectRename\":[{\"originalName\":\"[query - GetWindowsVMs-AHUB].WindowsId\",\"mergedName\":\"WindowsId\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120fb\"},{\"originalName\":\"[query - GetAllVMs].PreTaxCost\",\"mergedName\":\"Last Month Cost\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120fb\"},{\"originalName\":\"[query - GetAllVMs].Currency\",\"mergedName\":\"Currency\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120fb\"},{\"originalName\":\"[Added column]\",\"mergedName\":\"Approximate AHUB savings\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"Last Month Cost\",\"operator\":\"isNotNull\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"[\\\"Last Month Cost\\\"] * 0.4402\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"column\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"Last Month Cost with AHUB\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"Last Month Cost\",\"operator\":\"isNotNull\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"[\\\"Last Month Cost\\\"] - [\\\"Approximate AHUB savings\\\"]\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"column\"}}]},{\"originalName\":\"[query - GetWindowsVMs-AHUB].VMName\",\"mergedName\":\"VMName\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120fb\"},{\"originalName\":\"[query - GetWindowsVMs-AHUB].VMRG\",\"mergedName\":\"VMRG\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120fb\"},{\"originalName\":\"[query - GetWindowsVMs-AHUB].VMSize\",\"mergedName\":\"VMSize\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120fb\"},{\"originalName\":\"[query - GetWindowsVMs-AHUB].VMLocation\",\"mergedName\":\"VMLocation\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120fb\"},{\"originalName\":\"[query - GetWindowsVMs-AHUB].OSType\",\"mergedName\":\"OSType\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120fb\"},{\"originalName\":\"[query - GetWindowsVMs-AHUB].OsVersion\",\"mergedName\":\"OsVersion\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120fb\"},{\"originalName\":\"[query - GetWindowsVMs-AHUB].LicenseType\",\"mergedName\":\"LicenseType\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120fb\"},{\"originalName\":\"[query - Get VM vCPU].Name\",\"mergedName\":\"Name\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120ff\"},{\"originalName\":\"[query - Get VM vCPU].vCPUs\",\"mergedName\":\"vCPUs\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120ff\"},{\"originalName\":\"[query - GetAllVMs].ResourceId\"}]}",
                          "size": 0,
                          "title": "Approximate cost of Windows VMs and VMSS without Hybrid Benefit enabled ",
                          "showExportToExcel": true,
                          "queryType": 7
                        },
                        "showPin": false,
                        "name": "query - GetWindowsVM-AHUBCost"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"a4f6422d-06bc-42c4-809c-708dd7912117\",\"mergeType\":\"innerunique\",\"leftTable\":\"query - GetAllVMs\",\"rightTable\":\"query - GetLinuxVMs-AHUB\",\"leftColumn\":\"ResourceId\",\"rightColumn\":\"linuxId\"},{\"id\":\"a4f6422d-06bc-42c4-809c-708dd7912118\",\"mergeType\":\"leftouter\",\"leftTable\":\"query - GetLinuxVMs-AHUB\",\"rightTable\":\"query - Get VM vCPU\",\"leftColumn\":\"VMSize\",\"rightColumn\":\"Name\"}],\"projectRename\":[{\"originalName\":\"[query - GetLinuxVMs-AHUB].linuxId\",\"mergedName\":\"linuxId\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd7912117\"},{\"originalName\":\"[query - GetAllVMs].PreTaxCost\",\"mergedName\":\"Last Month Cost\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd7912117\"},{\"originalName\":\"[query - GetAllVMs].Currency\",\"mergedName\":\"Currency\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd7912117\"},{\"originalName\":\"[query - GetLinuxVMs-AHUB].VMName\",\"mergedName\":\"VMName\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd7912117\"},{\"originalName\":\"[query - GetLinuxVMs-AHUB].VMRG\",\"mergedName\":\"VMRG\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd7912117\"},{\"originalName\":\"[query - GetLinuxVMs-AHUB].VMLocation\",\"mergedName\":\"VMLocation\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd7912117\"},{\"originalName\":\"[query - GetLinuxVMs-AHUB].OSType\",\"mergedName\":\"OSType\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd7912117\"},{\"originalName\":\"[query - GetLinuxVMs-AHUB].OsVersion\",\"mergedName\":\"OsVersion\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd7912117\"},{\"originalName\":\"[query - GetLinuxVMs-AHUB].LicenseType\",\"mergedName\":\"LicenseType\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd7912117\"},{\"originalName\":\"[query - GetLinuxVMs-AHUB].VMSize\",\"mergedName\":\"VMSize\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd7912117\"},{\"originalName\":\"[query - Get VM vCPU].Name\",\"mergedName\":\"Name\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd7912118\"},{\"originalName\":\"[query - Get VM vCPU].vCPUs\",\"mergedName\":\"vCPUs\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd7912118\"},{\"originalName\":\"[Added column]\",\"mergedName\":\"Last Month Cost with AHUB\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"Last Month Cost\",\"operator\":\"isNotNull\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"[\\\"Last Month Cost\\\"] - [\\\"Approximate AHUB savings\\\"]\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"column\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"Added column\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"Last Month Cost\",\"operator\":\"isNotNull\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"[\\\"Last Month Cost\\\"] - [\\\"Approximate AHUB savings\\\"]\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"column\"}}]},{\"originalName\":\"[query - GetAllVMs].ResourceId\"}]}",
                          "size": 0,
                          "title": "Approximate cost of Linux VMs without Hybrid Benefit enabled",
                          "showExportToExcel": true,
                          "queryType": 7
                        },
                        "showPin": false,
                        "name": "query - GetLinuxVM-AHUBCost"
                      }
                    ]
                  },
                  "name": "Virtual Machines"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "RG_Filter",
              "comparison": "isEqualTo",
              "value": "Resource Group"
            },
            "name": "group - CostRG"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":\"{\\r\\n\\t\\\"type\\\": \\\"Usage\\\",\\r\\n\\t\\\"timeframe\\\": \\\"TheLastMonth\\\",\\r\\n\\t\\\"dataset\\\": {\\r\\n\\t\\t\\\"granularity\\\": \\\"None\\\",\\r\\n\\t\\t\\\"filter\\\": {\\r\\n\\t\\t\\t\\t\\t\\\"dimensions\\\": {\\r\\n\\t\\t\\t\\t\\t\\t\\\"name\\\": \\\"resourceType\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\\"operator\\\": \\\"In\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\\"values\\\": [\\r\\n\\t\\t\\t\\t\\t\\t\\t\\\"microsoft.compute/disks\\\"\\r\\n\\t\\t\\t\\t\\t\\t]\\r\\n\\t\\t\\t\\t\\t}\\r\\n\\t\\t},\\r\\n\\t\\t\\\"aggregation\\\": {\\r\\n\\t\\t\\t\\\"totalCost\\\": {\\r\\n\\t\\t\\t\\t\\\"name\\\": \\\"PreTaxCost\\\",\\r\\n\\t\\t\\t\\t\\\"function\\\": \\\"Sum\\\"\\r\\n\\t\\t\\t}\\r\\n\\t\\t},\\r\\n\\t\\t\\\"grouping\\\": [\\r\\n\\t\\t\\t{\\r\\n\\t\\t\\t\\t\\\"type\\\": \\\"Dimension\\\",\\r\\n\\t\\t\\t\\t\\\"name\\\": \\\"ResourceId\\\"\\r\\n\\t\\t\\t}\\r\\n\\t\\t]\\r\\n\\t}\\r\\n}\",\"headers\":[],\"method\":\"POST\",\"path\":\"/subscriptions/{Subscription:id}/providers/Microsoft.CostManagement/query?\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2019-11-01\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.properties\",\"columns\":[]}}]}",
                    "size": 0,
                    "title": "GetCostAllDisks",
                    "queryType": 12
                  },
                  "conditionalVisibility": {
                    "parameterName": "isVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - GetAllDisksCost"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| where type =~ 'microsoft.compute/disks'\r\n| extend diskState = tostring(properties.diskState)\r\n| where managedBy == \"\" and diskState != 'ActiveSAS'\r\nor diskState == 'Unattached' and diskState != 'ActiveSAS'\r\n| where isnotempty(tags) and isnotnull(tags)\r\n| mvexpand tags\r\n| extend tagName = tostring(bag_keys(tags)[0])\r\n| extend tagValue = tostring(tags[tagName])\r\n| where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n| extend DiskID=id, DiskName=name, SKUName=sku.name, SKUTier=sku.tier, DiskSizeGB=tostring(properties.diskSizeGB),DiskRG=resourceGroup, Location=location, TimeCreated=tostring(properties.timeCreated), SubscriptionName=subscriptionId \r\n| project DiskID,DiskName, DiskSizeGB, SKUName, SKUTier, DiskRG,tagName,tagValue, Location, TimeCreated, SubscriptionName\r\n| order by DiskID asc ",
                    "size": 0,
                    "title": "Unattached Disks",
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "isVisible",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "query - GetUnattachedDisks"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"890db43d-bfd3-4a7c-94df-e030a0c03093\",\"mergeType\":\"innerunique\",\"leftTable\":\"query - GetAllDisksCost\",\"rightTable\":\"query - GetUnattachedDisks\",\"leftColumn\":\"ResourceId\",\"rightColumn\":\"DiskID\"}],\"projectRename\":[{\"originalName\":\"[query - GetUnattachedDisks].DiskID\",\"mergedName\":\"DiskID\",\"fromId\":\"890db43d-bfd3-4a7c-94df-e030a0c03093\"},{\"originalName\":\"[query - GetAllDisksCost].PreTaxCost\",\"mergedName\":\"Last Month Cost\",\"fromId\":\"890db43d-bfd3-4a7c-94df-e030a0c03093\"},{\"originalName\":\"[query - GetAllDisksCost].Currency\",\"mergedName\":\"Currency\",\"fromId\":\"890db43d-bfd3-4a7c-94df-e030a0c03093\"},{\"originalName\":\"[query - GetUnattachedDisks].DiskSizeGB\",\"mergedName\":\"DiskSizeGB\",\"fromId\":\"890db43d-bfd3-4a7c-94df-e030a0c03093\"},{\"originalName\":\"[query - GetUnattachedDisks].SKUName\",\"mergedName\":\"SKUName\",\"fromId\":\"890db43d-bfd3-4a7c-94df-e030a0c03093\"},{\"originalName\":\"[query - GetUnattachedDisks].SKUTier\",\"mergedName\":\"SKUTier\",\"fromId\":\"890db43d-bfd3-4a7c-94df-e030a0c03093\"},{\"originalName\":\"[query - GetUnattachedDisks].DiskRG\",\"mergedName\":\"DiskRG\",\"fromId\":\"890db43d-bfd3-4a7c-94df-e030a0c03093\"},{\"originalName\":\"[query - GetUnattachedDisks].subscriptionId\",\"mergedName\":\"subscriptionId\",\"fromId\":\"890db43d-bfd3-4a7c-94df-e030a0c03093\"},{\"originalName\":\"[query - GetUnattachedDisks].tagName\",\"mergedName\":\"tagName\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - GetUnattachedDisks].Location\",\"mergedName\":\"Location\",\"fromId\":\"890db43d-bfd3-4a7c-94df-e030a0c03093\"},{\"originalName\":\"[query - GetUnattachedDisks].TimeCreated\",\"mergedName\":\"TimeCreated\",\"fromId\":\"890db43d-bfd3-4a7c-94df-e030a0c03093\"},{\"originalName\":\"[query - GetUnattachedDisks].tagValue\",\"mergedName\":\"tagValue\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - GetUnattachedDisks].SubscriptionName\",\"mergedName\":\"SubscriptionName\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - GetAllDisksCost].ResourceId\"},{\"originalName\":\"[query - GetUnattachedDisks].DiskName\"}]}",
                    "size": 0,
                    "title": "Unattached Managed Disks cost",
                    "showExportToExcel": true,
                    "exportToExcelOptions": "all",
                    "queryType": 7
                  },
                  "showPin": false,
                  "name": "query - Unattaached Disks Cost"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources \r\n| where type =~ 'microsoft.network/loadbalancers' and tostring(properties.backendAddressPools) == '[]' \r\n| where isnotempty(tags) and isnotnull(tags)\r\n| mvexpand tags\r\n| extend tagName = tostring(bag_keys(tags)[0])\r\n| extend tagValue = tostring(tags[tagName])\r\n| where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n| extend Details=id,LBRG=resourceGroup, LoadBalancerName=name, SKU=sku, LBLocation=location\r\n| order by id asc\r\n| project Details,LoadBalancerName, SKU.name,SKU.tier, LBLocation,LBRG, subscriptionId, tagName,tagValue\r\n",
                          "size": 0,
                          "title": "query - GetUnattachedLoadBalancers",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ]
                        },
                        "conditionalVisibility": {
                          "parameterName": "isVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "query - GetUnattachedLoadBalancers"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":\"{\\r\\n\\t\\\"type\\\": \\\"Usage\\\",\\r\\n\\t\\\"timeframe\\\": \\\"TheLastMonth\\\",\\r\\n\\t\\\"dataset\\\": {\\r\\n\\t\\t\\\"granularity\\\": \\\"None\\\",\\r\\n\\t\\t\\\"filter\\\": {\\r\\n\\t\\t\\t\\t\\t\\\"dimensions\\\": {\\r\\n\\t\\t\\t\\t\\t\\t\\\"name\\\": \\\"resourceType\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\\"operator\\\": \\\"In\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\\"values\\\": [\\r\\n\\t\\t\\t\\t\\t\\t\\t\\\"microsoft.network/loadbalancers\\\"\\r\\n\\t\\t\\t\\t\\t\\t]\\r\\n\\t\\t\\t\\t\\t}\\r\\n\\t\\t},\\r\\n\\t\\t\\\"aggregation\\\": {\\r\\n\\t\\t\\t\\\"totalCost\\\": {\\r\\n\\t\\t\\t\\t\\\"name\\\": \\\"PreTaxCost\\\",\\r\\n\\t\\t\\t\\t\\\"function\\\": \\\"Sum\\\"\\r\\n\\t\\t\\t}\\r\\n\\t\\t},\\r\\n\\t\\t\\\"grouping\\\": [\\r\\n\\t\\t\\t{\\r\\n\\t\\t\\t\\t\\\"type\\\": \\\"Dimension\\\",\\r\\n\\t\\t\\t\\t\\\"name\\\": \\\"ResourceId\\\"\\r\\n\\t\\t\\t}\\r\\n\\t\\t]\\r\\n\\t}\\r\\n}\",\"headers\":[],\"method\":\"POST\",\"path\":\"/subscriptions/{Subscription:id}/providers/Microsoft.CostManagement/query?\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2019-11-01\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.properties\",\"columns\":[]}}]}",
                          "size": 0,
                          "title": "GetAllLBsCost",
                          "queryType": 12
                        },
                        "conditionalVisibility": {
                          "parameterName": "isVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "query - GetAllLBsCost"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"a4f6422d-06bc-42c4-809c-708dd791208a\",\"mergeType\":\"innerunique\",\"leftTable\":\"query - GetAllLBsCost\",\"rightTable\":\"query - GetUnattachedLoadBalancers\",\"leftColumn\":\"ResourceId\",\"rightColumn\":\"Details\"}],\"projectRename\":[{\"originalName\":\"[query - GetAllLBsCost].PreTaxCost\",\"mergedName\":\"PreTaxCost\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd791208a\"},{\"originalName\":\"[query - GetAllLBsCost].ResourceId\",\"mergedName\":\"ResourceId\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd791208a\"},{\"originalName\":\"[query - GetAllLBsCost].Currency\",\"mergedName\":\"Currency\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd791208a\"},{\"originalName\":\"[query - GetUnattachedLoadBalancers].Details\",\"mergedName\":\"Details\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd791208a\"},{\"originalName\":\"[query - GetUnattachedLoadBalancers].LoadBalancerName\",\"mergedName\":\"LoadBalancerName\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd791208a\"},{\"originalName\":\"[query - GetUnattachedLoadBalancers].SKU_name\",\"mergedName\":\"SKU_name\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd791208a\"},{\"originalName\":\"[query - GetUnattachedLoadBalancers].SKU_tier\",\"mergedName\":\"SKU_tier\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd791208a\"},{\"originalName\":\"[query - GetUnattachedLoadBalancers].LBLocation\",\"mergedName\":\"LBLocation\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd791208a\"},{\"originalName\":\"[query - GetUnattachedLoadBalancers].LBRG\",\"mergedName\":\"LBRG\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd791208a\"},{\"originalName\":\"[query - GetUnattachedLoadBalancers].subscriptionId\",\"mergedName\":\"subscriptionId\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd791208a\"},{\"originalName\":\"[query - GetUnattachedLoadBalancers].tagValue\",\"mergedName\":\"tagValue\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - GetUnattachedLoadBalancers].tagName\",\"mergedName\":\"tagName\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - GetAllLoadBalancers].ResourceId\"},{\"originalName\":\"[query - GetUnattachedLoadBalancers].LoadBalancerName\"}]}",
                          "size": 0,
                          "title": "Unattached Load balancers Cost",
                          "showExportToExcel": true,
                          "exportToExcelOptions": "all",
                          "queryType": 7
                        },
                        "showPin": false,
                        "name": "Merge - Unattaached Load balancers Cost"
                      }
                    ]
                  },
                  "name": "Load Balancer"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources\r\n| where type =~ 'Microsoft.Network/applicationGateways'\r\n| where isnotempty(tags) and isnotnull(tags)\r\n| mvexpand tags\r\n| extend tagName = tostring(bag_keys(tags)[0])\r\n| extend tagValue = tostring(tags[tagName])\r\n| where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n| extend backendPoolsCount = array_length(properties.backendAddressPools),SKUName= tostring(properties.sku.name), SKUTier= tostring(properties.sku.tier),SKUCapacity=properties.sku.capacity,backendPools=properties.backendAddressPools\r\n| project id, name, SKUName, SKUTier, SKUCapacity, tagValue, tagName\r\n| join (\r\n    resources\r\n    | where type =~ 'Microsoft.Network/applicationGateways' \r\n    | mvexpand backendPools = properties.backendAddressPools\r\n    | extend backendIPCount = array_length(backendPools.properties.backendIPConfigurations)\r\n    | extend backendAddressesCount = array_length(backendPools.properties.backendAddresses)\r\n    | extend backendPoolName  = backendPools.properties.backendAddressPools.name\r\n    | summarize backendIPCount = sum(backendIPCount) ,backendAddressesCount=sum(backendAddressesCount) by id\r\n) on id\r\n| project-away id1\r\n| where  (backendIPCount == 0 or isempty(backendIPCount)) and (backendAddressesCount==0 or isempty(backendAddressesCount))\r\n| order by id asc",
                          "size": 0,
                          "title": "Unattached Application Gateways",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ]
                        },
                        "conditionalVisibility": {
                          "parameterName": "isVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "query - GetUnattachedApplicationGWs"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":\"{\\r\\n    \\\"type\\\": \\\"Usage\\\",\\r\\n    \\\"timeframe\\\": \\\"TheLastMonth\\\",\\r\\n    \\\"dataset\\\": {\\r\\n      \\\"granularity\\\": \\\"None\\\",\\r\\n\\t  \\\"filter\\\": {\\r\\n\\t\\t\\t\\t\\t\\\"dimensions\\\": {\\r\\n\\t\\t\\t\\t\\t\\t\\\"name\\\": \\\"resourceType\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\\"operator\\\": \\\"In\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\\"values\\\": [\\r\\n\\t\\t\\t\\t\\t\\t\\t\\\"microsoft.network/applicationgateways\\\"\\r\\n\\t\\t\\t\\t\\t\\t]\\r\\n\\t\\t\\t\\t\\t}\\r\\n\\t\\t},\\r\\n      \\\"aggregation\\\": {\\r\\n       \\\"totalCost\\\": {\\r\\n          \\\"name\\\": \\\"PreTaxCost\\\",\\r\\n          \\\"function\\\": \\\"Sum\\\"\\r\\n        }\\r\\n      },\\r\\n     \\\"grouping\\\": [\\r\\n        {\\r\\n         \\\"type\\\": \\\"Dimension\\\",\\r\\n          \\\"name\\\": \\\"ResourceId\\\"\\r\\n        }\\r\\n      ]\\r\\n    }\\r\\n  }\",\"headers\":[],\"method\":\"POST\",\"path\":\"/subscriptions/{Subscription:id}/providers/Microsoft.CostManagement/query?\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2019-11-01\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.properties\",\"columns\":[]}}]}",
                          "size": 0,
                          "title": "Cost-GetAllApplicationGWs",
                          "queryType": 12
                        },
                        "conditionalVisibility": {
                          "parameterName": "isVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "query - GetAllApplicationGWs"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"a4f6422d-06bc-42c4-809c-708dd79120a7\",\"mergeType\":\"innerunique\",\"leftTable\":\"query - GetAllApplicationGWs\",\"rightTable\":\"query - GetUnattachedApplicationGWs\",\"leftColumn\":\"ResourceId\",\"rightColumn\":\"id\"}],\"projectRename\":[{\"originalName\":\"[query - GetUnattachedApplicationGWs].id\",\"mergedName\":\"id\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120a7\"},{\"originalName\":\"[query - GetAllApplicationGWs].PreTaxCost\",\"mergedName\":\"Last Month Cost\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120a7\"},{\"originalName\":\"[query - GetAllApplicationGWs].Currency\",\"mergedName\":\"Currency\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120a7\"},{\"originalName\":\"[query - GetUnattachedApplicationGWs].SKUName\",\"mergedName\":\"SKUName\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120a7\"},{\"originalName\":\"[query - GetUnattachedApplicationGWs].SKUTier\",\"mergedName\":\"SKUTier\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120a7\"},{\"originalName\":\"[query - GetUnattachedApplicationGWs].SKUCapacity\",\"mergedName\":\"SKUCapacity\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120a7\"},{\"originalName\":\"[query - GetUnattachedApplicationGWs].backendIPCount\",\"mergedName\":\"backendIPCount\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120a7\"},{\"originalName\":\"[query - GetUnattachedApplicationGWs].backendAddressesCount\",\"mergedName\":\"backendAddressesCount\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120a7\"},{\"originalName\":\"[query - GetUnattachedApplicationGWs].tagValue\",\"mergedName\":\"tagValue\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - GetUnattachedApplicationGWs].tagName\",\"mergedName\":\"tagName\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - GetAllApplicationGWs].ResourceId\"},{\"originalName\":\"[query - GetUnattachedApplicationGWs].name\"}]}",
                          "size": 0,
                          "title": "Idle Application Gateways Cost",
                          "showExportToExcel": true,
                          "exportToExcelOptions": "all",
                          "queryType": 7
                        },
                        "name": "query - Unattached ApplicationGWs Cost"
                      }
                    ]
                  },
                  "name": "Application Gateway"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":\"{\\r\\n    \\\"type\\\": \\\"Usage\\\",\\r\\n    \\\"timeframe\\\": \\\"TheLastMonth\\\",\\r\\n    \\\"dataset\\\": {\\r\\n      \\\"granularity\\\": \\\"None\\\",\\r\\n\\t  \\\"filter\\\": {\\r\\n\\t\\t\\t\\\"and\\\": [\\r\\n\\t\\t\\t\\t{\\r\\n\\t\\t\\t\\t\\t\\\"dimensions\\\": {\\r\\n\\t\\t\\t\\t\\t\\t\\\"name\\\": \\\"resourceType\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\\"operator\\\": \\\"In\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\\"values\\\": [\\r\\n\\t\\t\\t\\t\\t\\t\\t\\\"microsoft.network/publicIPAddresses\\\"\\r\\n\\t\\t\\t\\t\\t\\t]\\r\\n\\t\\t\\t\\t\\t}\\r\\n\\t\\t\\t\\t},\\r\\n\\t\\t\\t\\t{\\r\\n\\t\\t\\t\\t\\t\\\"dimensions\\\": {\\r\\n\\t\\t\\t\\t\\t\\t\\\"name\\\": \\\"ResourceGroup\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\\"operator\\\": \\\"In\\\",\\r\\n\\t\\t\\t\\t\\t\\t\\\"values\\\": [\\r\\n\\t\\t\\t\\t\\t\\t\\t{ResourceGroup}\\r\\n\\t\\t\\t\\t\\t\\t\\t]\\r\\n\\t\\t\\t\\t\\t}\\r\\n\\t\\t\\t\\t}\\r\\n\\t\\t\\t]\\r\\n\\t\\t},\\r\\n      \\\"aggregation\\\": {\\r\\n       \\\"totalCost\\\": {\\r\\n          \\\"name\\\": \\\"PreTaxCost\\\",\\r\\n          \\\"function\\\": \\\"Sum\\\"\\r\\n        }\\r\\n      },\\r\\n     \\\"grouping\\\": [\\r\\n        {\\r\\n         \\\"type\\\": \\\"Dimension\\\",\\r\\n          \\\"name\\\": \\\"ResourceId\\\"\\r\\n        }\\r\\n      ]\\r\\n    }\\r\\n  }\",\"headers\":[],\"method\":\"POST\",\"path\":\"/subscriptions/{Subscription:id}/providers/Microsoft.CostManagement/query?\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2019-11-01\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.properties\",\"columns\":[]}}]}",
                          "size": 0,
                          "title": "Cost-GetAllPublicIPAddresses",
                          "queryType": 12
                        },
                        "conditionalVisibility": {
                          "parameterName": "isVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "query - GetAllPublicIPAddresses"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources \r\n| where type =~ 'Microsoft.Network/publicIPAddresses' and isempty(properties.ipConfiguration) and isempty(properties.natGateway) \r\n| extend IdleIP=id, IPName=name, AllocationMethod=tostring(properties.publicIPAllocationMethod), SKUName=sku.name, PIPRG=resourceGroup, Location=location \r\n| where isnotempty(tags) and isnotnull(tags)\r\n| mvexpand tags\r\n| extend tagName = tostring(bag_keys(tags)[0])\r\n| extend tagValue = tostring(tags[tagName])\r\n| where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n| project IdleIP,IPName, SKUName, PIPRG, Location, AllocationMethod, subscriptionId, tagName, tagValue\r\n| union (\r\n Resources \r\n | where type =~ 'microsoft.network/networkinterfaces' and isempty(properties.virtualMachine) and isnull(properties.privateEndpoint) and isnotempty(properties.ipConfigurations) \r\n | extend IPconfig = properties.ipConfigurations \r\n | mv-expand IPconfig \r\n | extend IdleIP= tostring(IPconfig.properties.publicIPAddress.id)\r\n | project IdleIP\r\n | join ( \r\n    resources \r\n    | where type =~ 'Microsoft.Network/publicIPAddresses'\r\n    | extend IdleIP=id, IPName=name, AllocationMethod=tostring(properties.publicIPAllocationMethod), SKUName=sku.name, PIPRG=resourceGroup, Location=location \r\n ) on IdleIP\r\n | project IdleIP,IPName, SKUName, PIPRG, Location, AllocationMethod, subscriptionId\r\n)\r\n",
                          "size": 0,
                          "title": "Unattached Public IP Addresses",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ]
                        },
                        "conditionalVisibility": {
                          "parameterName": "isVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "query - GetUnattachedPublicIPAddresses"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"a4f6422d-06bc-42c4-809c-708dd79120c0\",\"mergeType\":\"innerunique\",\"leftTable\":\"query - GetAllPublicIPAddresses\",\"rightTable\":\"query - GetUnattachedPublicIPAddresses\",\"leftColumn\":\"ResourceId\",\"rightColumn\":\"IdleIP\"}],\"projectRename\":[{\"originalName\":\"[query - GetUnattachedPublicIPAddresses].IdleIP\",\"mergedName\":\"IdleIP\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120c0\"},{\"originalName\":\"[query - GetAllPublicIPAddresses].PreTaxCost\",\"mergedName\":\"Last Month Cost\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120c0\"},{\"originalName\":\"[query - GetAllPublicIPAddresses].Currency\",\"mergedName\":\"Currency\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120c0\"},{\"originalName\":\"[query - GetUnattachedPublicIPAddresses].IPName\",\"mergedName\":\"IPName\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120c0\"},{\"originalName\":\"[query - GetUnattachedPublicIPAddresses].SKUName\",\"mergedName\":\"SKUName\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120c0\"},{\"originalName\":\"[query - GetUnattachedPublicIPAddresses].PIPRG\",\"mergedName\":\"PIPRG\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120c0\"},{\"originalName\":\"[query - GetUnattachedPublicIPAddresses].Location\",\"mergedName\":\"Location\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120c0\"},{\"originalName\":\"[query - GetUnattachedPublicIPAddresses].AllocationMethod\",\"mergedName\":\"AllocationMethod\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120c0\"},{\"originalName\":\"[query - GetUnattachedPublicIPAddresses].subscriptionId\",\"mergedName\":\"subscriptionId\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120c0\"},{\"originalName\":\"[query - GetUnattachedPublicIPAddresses].tagValue\",\"mergedName\":\"tagValue\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - GetUnattachedPublicIPAddresses].tagName\",\"mergedName\":\"tagName\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - GetAllPublicIPAddresses].ResourceId\"}]}",
                          "size": 0,
                          "title": "Unattached Public IP addresses Cost",
                          "showExportToExcel": true,
                          "exportToExcelOptions": "all",
                          "queryType": 7
                        },
                        "showPin": false,
                        "name": "query - Unattached Public IP addresses Cost"
                      }
                    ]
                  },
                  "name": "Public IP Address"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":\"{\\r\\n    \\\"type\\\": \\\"Usage\\\",\\r\\n    \\\"timeframe\\\": \\\"TheLastMonth\\\",\\r\\n    \\\"dataset\\\": {\\r\\n      \\\"granularity\\\": \\\"None\\\",\\r\\n\\t  \\\"filter\\\":{\\r\\n\\t\\t  \\\"dimensions\\\" : {\\r\\n                      \\\"name\\\" : \\\"resourceType\\\",\\r\\n                      \\\"operator\\\" : \\\"In\\\",\\r\\n                      \\\"values\\\" : [\\r\\n                         \\\"Microsoft.Compute/VirtualMachines\\\"\\r\\n                      ]\\r\\n                  }\\r\\n\\t  },\\r\\n      \\\"aggregation\\\": {\\r\\n       \\\"totalCost\\\": {\\r\\n          \\\"name\\\": \\\"PreTaxCost\\\",\\r\\n          \\\"function\\\": \\\"Sum\\\"\\r\\n        }\\r\\n      },\\r\\n     \\\"grouping\\\": [\\r\\n        {\\r\\n         \\\"type\\\": \\\"Dimension\\\",\\r\\n          \\\"name\\\": \\\"ResourceId\\\"\\r\\n        }\\r\\n      ]\\r\\n    }\\r\\n  }\",\"headers\":[],\"method\":\"POST\",\"path\":\"/subscriptions/{Subscription:id}/providers/Microsoft.CostManagement/query?\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2019-11-01\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.properties\",\"columns\":[]}}]}",
                          "size": 0,
                          "title": "Cost-GetAllVMs",
                          "queryType": 12
                        },
                        "conditionalVisibility": {
                          "parameterName": "isVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "query - GetAllVMs"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/providers/Microsoft.Compute/skus?$filter=location eq 'westus'\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2019-04-01\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.*[?(@.resourceType=='virtualMachines')]\",\"columns\":[{\"path\":\"name\",\"columnid\":\"Name\"},{\"path\":\"capabilities[?(@.name=='vCPUs')].value\",\"columnid\":\"vCPUs\"}]}}]}",
                          "size": 0,
                          "title": "Get VM vCPU",
                          "queryType": 12
                        },
                        "conditionalVisibility": {
                          "parameterName": "isVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "query - Get VM vCPU"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources \r\n| where resourceGroup in ({ResourceGroup})\r\n| where type =~ 'microsoft.compute/virtualmachines' or type =~ 'microsoft.compute/virtualMachineScaleSets'\r\n| where isnotempty(tags) and isnotnull(tags)\r\n| mvexpand tags\r\n| extend tagName = tostring(bag_keys(tags)[0])\r\n| extend tagValue = tostring(tags[tagName])\r\n| where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n| where tostring(properties.storageProfile.osDisk.osType) == 'Windows' or tostring(properties.virtualMachineProfile.storageProfile.osDisk.osType) == 'Windows'\r\n| where tostring(properties.['licenseType']) !has 'Windows' and tostring(properties.virtualMachineProfile.['licenseType']) !has 'Windows'\r\n| extend WindowsId=id, VMName=name, VMLocation=location, VMRG=resourceGroup, OSType=tostring(properties.storageProfile.imageReference.offer), OsVersion = tostring(properties.storageProfile.imageReference.sku), VMSize=tostring (properties.hardwareProfile.vmSize), LicenseType = tostring(properties.['licenseType'])\r\n| order by type asc \r\n| project WindowsId,VMName,VMRG,VMSize, VMLocation,OSType, OsVersion,LicenseType, tagValue, tagName",
                          "size": 0,
                          "title": "Windows VMs and VMSS without Azure Hybrid Benefit",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ]
                        },
                        "conditionalVisibility": {
                          "parameterName": "isVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "query - GetWindowsVMs-AHUB"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources \r\n| where type =~ 'microsoft.compute/virtualmachines' and (properties.storageProfile.imageReference.publisher == 'suse' or properties.storageProfile.imageReference.publisher=='RedHat')\r\n| where tostring(properties.['licenseType']) != 'SLES_BYOS' and tostring(properties.['licenseType']) != 'REHL_BYOS' \r\n| where isnotempty(tags) and isnotnull(tags)\r\n| mvexpand tags\r\n| extend tagName = tostring(bag_keys(tags)[0])\r\n| extend tagValue = tostring(tags[tagName])\r\n| where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n| extend linuxId=id, VMName=name, VMLocation=location, VMRG=resourceGroup, OSType=tostring(properties.storageProfile.imageReference.offer), OsVersion = tostring(properties.storageProfile.imageReference.sku), VMSize=tostring (properties.hardwareProfile.vmSize), LicenseType = tostring(properties.['licenseType']) \r\n    | order by VMSize asc \r\n    | where VMRG in ({ResourceGroup})\r\n    | project linuxId,VMName,VMRG, VMLocation,OSType, OsVersion,LicenseType, VMSize, tagName, tagValue",
                          "size": 0,
                          "title": "Linux VMs without Azure Hybrid Benefit",
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ]
                        },
                        "conditionalVisibility": {
                          "parameterName": "isVisible",
                          "comparison": "isEqualTo",
                          "value": "true"
                        },
                        "name": "query - GetLinuxVMs-AHUB"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"a4f6422d-06bc-42c4-809c-708dd79120fb\",\"mergeType\":\"innerunique\",\"leftTable\":\"query - GetAllVMs\",\"rightTable\":\"query - GetWindowsVMs-AHUB\",\"leftColumn\":\"ResourceId\",\"rightColumn\":\"WindowsId\"},{\"id\":\"a4f6422d-06bc-42c4-809c-708dd79120ff\",\"mergeType\":\"leftouter\",\"leftTable\":\"query - GetWindowsVMs-AHUB\",\"rightTable\":\"query - Get VM vCPU\",\"leftColumn\":\"VMSize\",\"rightColumn\":\"Name\"}],\"projectRename\":[{\"originalName\":\"[query - GetWindowsVMs-AHUB].WindowsId\",\"mergedName\":\"WindowsId\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120fb\"},{\"originalName\":\"[query - GetAllVMs].PreTaxCost\",\"mergedName\":\"Last Month Cost\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120fb\"},{\"originalName\":\"[query - GetAllVMs].Currency\",\"mergedName\":\"Currency\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120fb\"},{\"originalName\":\"[Added column]\",\"mergedName\":\"Approximate AHUB savings\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"Last Month Cost\",\"operator\":\"isNotNull\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"[\\\"Last Month Cost\\\"] * 0.4402\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"column\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"Last Month Cost with AHUB\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"Last Month Cost\",\"operator\":\"isNotNull\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"[\\\"Last Month Cost\\\"] - [\\\"Approximate AHUB savings\\\"]\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"column\"}}]},{\"originalName\":\"[query - GetWindowsVMs-AHUB].VMName\",\"mergedName\":\"VMName\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120fb\"},{\"originalName\":\"[query - GetWindowsVMs-AHUB].VMRG\",\"mergedName\":\"VMRG\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120fb\"},{\"originalName\":\"[query - GetWindowsVMs-AHUB].VMSize\",\"mergedName\":\"VMSize\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120fb\"},{\"originalName\":\"[query - GetWindowsVMs-AHUB].VMLocation\",\"mergedName\":\"VMLocation\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120fb\"},{\"originalName\":\"[query - GetWindowsVMs-AHUB].OSType\",\"mergedName\":\"OSType\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120fb\"},{\"originalName\":\"[query - GetWindowsVMs-AHUB].OsVersion\",\"mergedName\":\"OsVersion\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120fb\"},{\"originalName\":\"[query - GetWindowsVMs-AHUB].LicenseType\",\"mergedName\":\"LicenseType\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120fb\"},{\"originalName\":\"[query - Get VM vCPU].Name\",\"mergedName\":\"Name\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120ff\"},{\"originalName\":\"[query - Get VM vCPU].vCPUs\",\"mergedName\":\"vCPUs\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd79120ff\"},{\"originalName\":\"[query - GetWindowsVMs-AHUB].tagValue\",\"mergedName\":\"tagValue\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - GetWindowsVMs-AHUB].tagName\",\"mergedName\":\"tagName\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - GetAllVMs].ResourceId\"}]}",
                          "size": 0,
                          "title": "Approximate cost of Windows VMs and VMSS without Hybrid Benefit enabled ",
                          "queryType": 7
                        },
                        "showPin": false,
                        "name": "query - GetWindowsVM-AHUBCost"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"a4f6422d-06bc-42c4-809c-708dd7912117\",\"mergeType\":\"innerunique\",\"leftTable\":\"query - GetAllVMs\",\"rightTable\":\"query - GetLinuxVMs-AHUB\",\"leftColumn\":\"ResourceId\",\"rightColumn\":\"linuxId\"},{\"id\":\"a4f6422d-06bc-42c4-809c-708dd7912118\",\"mergeType\":\"leftouter\",\"leftTable\":\"query - GetLinuxVMs-AHUB\",\"rightTable\":\"query - Get VM vCPU\",\"leftColumn\":\"VMSize\",\"rightColumn\":\"Name\"}],\"projectRename\":[{\"originalName\":\"[query - GetLinuxVMs-AHUB].linuxId\",\"mergedName\":\"linuxId\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd7912117\"},{\"originalName\":\"[query - GetAllVMs].PreTaxCost\",\"mergedName\":\"Last Month Cost\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd7912117\"},{\"originalName\":\"[Added column]\",\"mergedName\":\"Last Month Cost with AHUB\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"Last Month Cost\",\"operator\":\"isNotNull\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"[\\\"Last Month Cost\\\"] - [\\\"Approximate AHUB savings\\\"]\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"column\"}}]},{\"originalName\":\"[query - GetAllVMs].Currency\",\"mergedName\":\"Currency\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd7912117\"},{\"originalName\":\"[query - GetLinuxVMs-AHUB].VMName\",\"mergedName\":\"VMName\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd7912117\"},{\"originalName\":\"[query - GetLinuxVMs-AHUB].VMRG\",\"mergedName\":\"VMRG\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd7912117\"},{\"originalName\":\"[query - GetLinuxVMs-AHUB].VMLocation\",\"mergedName\":\"VMLocation\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd7912117\"},{\"originalName\":\"[query - GetLinuxVMs-AHUB].OSType\",\"mergedName\":\"OSType\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd7912117\"},{\"originalName\":\"[query - GetLinuxVMs-AHUB].OsVersion\",\"mergedName\":\"OsVersion\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd7912117\"},{\"originalName\":\"[query - GetLinuxVMs-AHUB].LicenseType\",\"mergedName\":\"LicenseType\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd7912117\"},{\"originalName\":\"[query - GetLinuxVMs-AHUB].VMSize\",\"mergedName\":\"VMSize\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd7912117\"},{\"originalName\":\"[query - Get VM vCPU].Name\",\"mergedName\":\"Name\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd7912118\"},{\"originalName\":\"[query - Get VM vCPU].vCPUs\",\"mergedName\":\"vCPUs\",\"fromId\":\"a4f6422d-06bc-42c4-809c-708dd7912118\"},{\"originalName\":\"[query - GetLinuxVMs-AHUB].tagName\",\"mergedName\":\"tagName\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - GetLinuxVMs-AHUB].tagValue\",\"mergedName\":\"tagValue\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - GetAllVMs].ResourceId\"}]}",
                          "size": 0,
                          "title": "Approximate cost of Linux VMs without Hybrid Benefit enabled",
                          "queryType": 7
                        },
                        "showPin": false,
                        "name": "query - GetLinuxVM-AHUBCost"
                      }
                    ]
                  },
                  "name": "Virtual Machines"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "RG_Filter",
              "comparison": "isEqualTo",
              "value": "Tags"
            },
            "name": "group - CostTag"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "SelectedTab",
        "comparison": "isEqualTo",
        "value": "CostInformation"
      },
      "name": "group - CostInformation"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Storage Group",
        "items": [
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "StorageGroup",
              "items": [
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "advisorresources\r\n| where type == \"microsoft.advisor/recommendations\"\r\n| where tostring (properties.category) has \"Cost\"\r\n| where properties.impactedField has \"Storage\"\r\n| project AffectedResource=tostring(properties.resourceMetadata.resourceId),Impact=properties.impact,resourceGroup,AdditionaInfo=properties.extendedProperties,subscriptionId,Recommendation=tostring(properties.shortDescription.problem),name\r\n| where resourceGroup in ({ResourceGroup})\r\n",
                          "size": 0,
                          "title": "Azure Advisor Cost recommendations - Storage",
                          "noDataMessage": "You are following all of our cost recommendations for Storage",
                          "noDataMessageStyle": 3,
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "gridSettings": {
                            "hierarchySettings": {
                              "treeType": 1,
                              "groupBy": [
                                "Recommendation"
                              ],
                              "expandTopLevel": true
                            }
                          }
                        },
                        "name": "query - 0"
                      },
                      {
                        "type": 1,
                        "content": {
                          "json": "Review the unattached disks below to review if they still needed to avoid unnecessary costs.",
                          "style": "upsell"
                        },
                        "name": "text - 5"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources \r\n| where type =~ 'microsoft.compute/disks' and managedBy == \"\"\r\n| extend diskState = tostring(properties.diskState)\r\n| where managedBy == \"\" and diskState != 'ActiveSAS'\r\nor diskState == 'Unattached' and diskState != 'ActiveSAS'\r\n| extend DiskId=id, DiskName=name, SKUName=sku.name, SKUTier=sku.tier, DiskSizeGB=tostring(properties.diskSizeGB), Location=location, TimeCreated=tostring(properties.timeCreated)\r\n| order by DiskId asc \r\n| project DiskId,DiskName, DiskSizeGB, SKUName, SKUTier, resourceGroup, diskState, Location, TimeCreated, subscriptionId\r\n| where resourceGroup in ({ResourceGroup})",
                          "size": 0,
                          "title": "Unattached disks",
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "diskState",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "2",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "subscriptionId",
                                "formatter": 15,
                                "formatOptions": {
                                  "linkTarget": null,
                                  "showIcon": true
                                }
                              }
                            ]
                          }
                        },
                        "name": "query - 1"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "RG_Filter",
                    "comparison": "isNotEqualTo",
                    "value": "Tags"
                  },
                  "name": "Storage - subscription"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "loadType": "explicit",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "advisorresources\r\n| where type == \"microsoft.advisor/recommendations\"\r\n| where tostring (properties.category) has \"Cost\"\r\n| where (properties.impactedField) has \"Storage\"\r\n| project AffectedResource=tolower(tostring(properties.resourceMetadata.resourceId)),Impact=properties.impact,resourceGroup,AdditionaInfo=properties.extendedProperties,subscriptionId,Recommendation=tostring(properties.shortDescription.problem),AffectedResourceName=tostring(properties.impactedValue)\r\n| join ( resources\r\n    | where type has \"Microsoft.Storage\"\r\n    | extend  AffectedResource=tolower(id)\r\n    ) on AffectedResource\r\n| where isnotempty(tags) and isnotnull(tags)\r\n| mvexpand tags\r\n| extend tagName = tostring(bag_keys(tags)[0])\r\n| extend tagValue = tostring(tags[tagName])\r\n| where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n| project  AffectedResource, Impact,resourceGroup,AdditionaInfo, tagName, tagValue,Recommendation, SubscriptionName=subscriptionId",
                          "size": 0,
                          "title": "Azure advisor Cost recommendations - Storage",
                          "noDataMessage": "You are following all Storage advisor recommendations",
                          "noDataMessageStyle": 3,
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "gridSettings": {
                            "hierarchySettings": {
                              "treeType": 1,
                              "groupBy": [
                                "Recommendation"
                              ],
                              "expandTopLevel": true
                            }
                          }
                        },
                        "name": "query - 0"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources\r\n| where type =~ 'microsoft.compute/disks'\r\n| extend diskState = tostring(properties.diskState)\r\n| where managedBy == \"\" and diskState != 'ActiveSAS'\r\nor diskState == 'Unattached' and diskState != 'ActiveSAS'\r\n| where isnotempty(tags) and isnotnull(tags)\r\n| mvexpand tags\r\n| extend tagName = tostring(bag_keys(tags)[0])\r\n| extend tagValue = tostring(tags[tagName])\r\n| where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n| extend DiskID=id, DiskName=name, SKUName=sku.name, SKUTier=sku.tier, DiskSizeGB=tostring(properties.diskSizeGB),DiskRG=resourceGroup, Location=location, TimeCreated=tostring(properties.timeCreated), SubscriptionName=subscriptionId \r\n| project DiskID,DiskName, DiskSizeGB, SKUName, SKUTier, DiskRG,tagName,tagValue, Location, TimeCreated, SubscriptionName\r\n| order by DiskID asc ",
                          "size": 0,
                          "title": "Unattached disks",
                          "noDataMessage": "You don't have any unattached disks!",
                          "noDataMessageStyle": 3,
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "tagName",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Tags",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "tagValue",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "Tags",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        },
                        "name": "query - 5"
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "RG_Filter",
                    "comparison": "isEqualTo",
                    "value": "Tags"
                  },
                  "name": "Storage - Tags"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "Storage"
            },
            "name": "StorageGroup"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "SelectedTab",
        "comparison": "isEqualTo",
        "value": "Storage"
      },
      "name": "StorageGroup",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Data Group",
        "items": [
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "advisorresources\r\n| where type == \"microsoft.advisor/recommendations\"\r\n| where tostring (properties.category) has \"Cost\"\r\n| where properties.impactedField has \"Data\" or properties.impactedField has \"Sql\"\r\n| project AffectedResource=tostring(properties.resourceMetadata.resourceId),Impact=properties.impact,resourceGroup,AdditionaInfo=properties.extendedProperties,subscriptionId,Recommendation=tostring(properties.shortDescription.problem),name\r\n| where resourceGroup in ({ResourceGroup})\r\n",
                    "size": 0,
                    "title": "Azure Advisor Cost recommendations - Data",
                    "noDataMessage": "You are following all of our cost recommendations for Data",
                    "noDataMessageStyle": 3,
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "filter": true,
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "Recommendation"
                        ],
                        "expandTopLevel": true
                      }
                    }
                  },
                  "name": "query - 0"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "# Azure SQL \r\n Azure Hybrid Benefit allows you to exchange your existing licenses for discounted rates on Azure SQL Database and Azure SQL Managed Instance. You can save up to 30 percent or more on SQL Database and SQL Managed Instance by using your Software Assurance-enabled SQL Server licenses on Azure. The [Azure Hybrid Benefit page](https://azure.microsoft.com/pricing/hybrid-benefit/) has a calculator to help determine savings. \r\n\r\n",
                    "style": "upsell"
                  },
                  "name": "text - 5"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ResourceContainers\r\n| where type =~ 'Microsoft.Resources/subscriptions' \r\n| extend SubscriptionName=name | join (resources |  where type =~ 'Microsoft.Sql/servers/databases' and name != 'master' and tostring(properties.['licenseType']) == 'LicenseIncluded' \r\n| extend   SQLDBID=id,SQLName = name, SQLRG = resourceGroup, SKUName=sku.name, SKUTier=sku.tier, SQLLocation = location, LicenseType = tostring(properties.['licenseType']), StorageAccountType=tostring(properties.['storageAccountType'])) on subscriptionId \r\n| project SQLDBID,SQLName,SQLRG, SKUName, SKUTier, SQLLocation, LicenseType, StorageAccountType, SubscriptionName\r\n| where SQLRG in ({ResourceGroup})",
                    "size": 0,
                    "title": "Azure SQL Databases not using Hybrid Benefit",
                    "noDataMessage": "The query returned no results. There 2 reasons for that 1) All of your SQL Databases are using Hybrid benefit or 2) There are no SQL Databases deployed in this scope.",
                    "noDataMessageStyle": 3,
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ]
                  },
                  "name": "query - 1"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ResourceContainers\r\n | where type =~ 'Microsoft.Resources/subscriptions' \r\n | extend SubscriptionName=name \r\n | join (resources |  where type =~ 'Microsoft.Sql/managedInstances' and tostring(properties.['licenseType']) == 'LicenseIncluded'\r\n | extend ManagedInstance=id, SQLRG=resourceGroup, SQLLocation=location, LicenseType = tostring(properties.['licenseType'])) on subscriptionId \r\n | project ManagedInstance,SQLRG, SQLLocation, LicenseType, SubscriptionName\r\n | where SQLRG in ({ResourceGroup})",
                    "size": 0,
                    "title": "Azure SQL Managed Instances not using Hybrid Benefit",
                    "noDataMessage": "The query returned no results. There 2 reasons for that 1) All of your SQL Managed Instances are using Hybrid benefit or 2) There are no SQL Managed Instances  deployed in this scope.",
                    "noDataMessageStyle": 3,
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ]
                  },
                  "name": "query - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ResourceContainers | where type =~ 'Microsoft.Resources/subscriptions' | extend SubscriptionName=name | join ( resources | where type =~ 'Microsoft.SqlVirtualMachine/SqlVirtualMachines' and tostring(properties.['sqlServerLicenseType']) != 'AHUB'  | extend SQLID=id, VMName = name, VMRG = resourceGroup, VMLocation = location, LicenseType = tostring(properties.['sqlServerLicenseType']), OSType=tostring(properties.storageProfile.imageReference.offer), SQLAgentType = tostring(properties.['sqlManagement']), SQLVersion = tostring(properties.['sqlImageOffer']), SQLSKU=tostring(properties.['sqlImageSku'])) on subscriptionId \r\n    | order by id asc    \r\n    | project SQLID,VMName,VMRG, VMLocation, SQLVersion, SQLSKU, SQLAgentType, LicenseType, SubscriptionName\r\n    | where VMRG in ({ResourceGroup}) and SQLSKU != \"Developer\" and SQLSKU != \"Express\"",
                    "size": 0,
                    "title": "SQL Virtual Machines not using Hybrid Benefit",
                    "noDataMessage": "The query returned no results. There 2 reasons for that 1) All of your SQL Virtual Machines are using Hybrid benefit (For SQL) or 2) There are no SQL Virtual Machines deployed in this scope.",
                    "noDataMessageStyle": 3,
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ]
                  },
                  "name": "query - 3"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "RG_Filter",
              "comparison": "isNotEqualTo",
              "value": "Tags"
            },
            "name": "DataGroup - Subscription"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "advisorresources\r\n| where type == \"microsoft.advisor/recommendations\"\r\n| where tostring(properties.category) has \"Cost\"\r\n| where properties.impactedField has \"Data\" or properties.impactedField has \"Sql\"\r\n| project AffectedResource=tolower(tostring(properties.resourceMetadata.resourceId)), Impact=properties.impact, resourceGroup, AdditionaInfo=properties.extendedProperties,subscriptionId, Recommendation=tostring(properties.shortDescription.problem), AffectedResourceName=tostring(properties.impactedValue)\r\n| join (resources\r\n    | where type has \"Sql\" or type has 'DocumentDB' or type has 'DB'\r\n    | extend  AffectedResource=tolower(id)\r\n    ) on AffectedResource\r\n| where isnotempty(tags) and isnotnull(tags)\r\n| mvexpand tags\r\n| extend tagName = tostring(bag_keys(tags)[0])\r\n| extend tagValue = tostring(tags[tagName])\r\n| where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n| project  AffectedResource, Impact,resourceGroup,AdditionaInfo, tagName, tagValue, Recommendation, SubscriptionName=subscriptionId",
                    "size": 0,
                    "title": "Azure Advisor Cost recommendations - Data",
                    "noDataMessage": "You are following all Data Advisor recommendations",
                    "noDataMessageStyle": 3,
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "tagName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Tags",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "tagValue",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Tags",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "filter": true,
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "Recommendation"
                        ],
                        "expandTopLevel": true
                      }
                    }
                  },
                  "name": "query - 0"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "# Azure SQL \r\n Azure Hybrid Benefit allows you to exchange your existing licenses for discounted rates on Azure SQL Database and Azure SQL Managed Instance. You can save up to 30 percent or more on SQL Database and SQL Managed Instance by using your Software Assurance-enabled SQL Server licenses on Azure. The [Azure Hybrid Benefit page](https://azure.microsoft.com/pricing/hybrid-benefit/) has a calculator to help determine savings. \r\n\r\n",
                    "style": "upsell"
                  },
                  "name": "text - 5"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| where type =~ 'Microsoft.Sql/servers/databases'\r\n| where name != 'master'\r\n| where isnotempty(tags) and isnotnull(tags)\r\n| mvexpand tags\r\n| extend tagName = tostring(bag_keys(tags)[0])\r\n| extend tagValue = tostring(tags[tagName])\r\n| where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n| where tostring(properties.['licenseType']) == 'LicenseIncluded' \r\n| extend   SQLDBID=id,SQLName = name, SQLRG = resourceGroup, SKUName=sku.name, SKUTier=sku.tier, SQLLocation = location, LicenseType = tostring(properties.['licenseType']), StorageAccountType=tostring(properties.['storageAccountType']), SubscriptionName=subscriptionId \r\n| project SQLDBID,SQLName,SQLRG, SKUName, SKUTier, SQLLocation, LicenseType, StorageAccountType,tagName,tagValue, SubscriptionName",
                    "size": 0,
                    "title": "Azure SQL Databases not using Hybrid Benefit",
                    "noDataMessage": "All Azure SQL Databases are using Azure Hybrid Benefit or you don't have any Azure SQL Databases!",
                    "noDataMessageStyle": 3,
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "tagName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Tags",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "tagValue",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Tags",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ]
                    }
                  },
                  "name": "query - 1"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| where type =~ 'Microsoft.Sql/managedInstances'\r\n| where isnotempty(tags) and isnotnull(tags)\r\n| mvexpand tags\r\n| extend tagName = tostring(bag_keys(tags)[0])\r\n| extend tagValue = tostring(tags[tagName])\r\n| where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n| where tostring(properties.['licenseType']) == 'LicenseIncluded'\r\n| extend ManagedInstance=id,SQLName=name, SQLRG=resourceGroup, SQLLocation=location, LicenseType = tostring(properties.['licenseType']), SubscriptionName = subscriptionId\r\n| project ManagedInstance,SQLRG, SQLLocation, LicenseType,tagName,tagValue, SubscriptionName",
                    "size": 0,
                    "title": "Azure SQL Managed Instances not using Hybrid Benefit",
                    "noDataMessage": "All Azure SQL Managed Instances are using Azure Hybrid Benefit or you don't have any Azure SQL Managed Instances!",
                    "noDataMessageStyle": 3,
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ]
                  },
                  "name": "query - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| where type =~ 'Microsoft.SqlVirtualMachine/SqlVirtualMachines'\r\n| where  tostring(properties.['sqlImageSku']) != \"Developer\" and tostring(properties.['sqlImageSku']) != \"Express\"\r\n| where isnotempty(tags) and isnotnull(tags)\r\n| mvexpand tags\r\n| extend tagName = tostring(bag_keys(tags)[0])\r\n| extend tagValue = tostring(tags[tagName])\r\n| where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n| where tostring(properties.['sqlServerLicenseType']) != 'AHUB'\r\n| extend SQLID=id, VMName = name, VMRG = resourceGroup, VMLocation = location, LicenseType = tostring(properties.['sqlServerLicenseType']), OSType=tostring(properties.storageProfile.imageReference.offer), SQLAgentType = tostring(properties.['sqlManagement']), SQLVersion = tostring(properties.['sqlImageOffer']), SQLSKU=tostring(properties.['sqlImageSku']), SubscriptionName = subscriptionId\r\n| project SQLID,VMName,VMRG, VMLocation, SQLVersion, SQLSKU, SQLAgentType, LicenseType,tagName,tagValue, SubscriptionName\r\n| order by SQLID asc    ",
                    "size": 0,
                    "title": "SQL Virtual Machines not using Hybrid Benefit",
                    "noDataMessage": "All Azure SQL VMs are using Azure Hybrid Benefit or you don't have any Azure SQL VMs!",
                    "noDataMessageStyle": 3,
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ]
                  },
                  "name": "query - 3"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "RG_Filter",
              "comparison": "isEqualTo",
              "value": "Tags"
            },
            "name": "DataGroup - Tags"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "SelectedTab",
        "comparison": "isEqualTo",
        "value": "Data"
      },
      "name": "DataGroup",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Compute Group",
        "items": [
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "advisorresources\r\n| where type == \"microsoft.advisor/recommendations\"\r\n| where tostring (properties.category) has \"Cost\"\r\n| where properties.impactedField has \"Compute\" or properties.impactedField has \"Container\" or properties.impactedField has \"Web\"\r\n| project AffectedResource=tostring(properties.resourceMetadata.resourceId),Impact=properties.impact,resourceGroup,AdditionaInfo=properties.extendedProperties,subscriptionId,Recommendation=tostring(properties.shortDescription.problem)\r\n| where resourceGroup in ({ResourceGroup})\r\n",
                    "size": 0,
                    "title": "Azure Advisor Cost recommendations",
                    "noDataMessage": "You are following all of our cost recommendations for Compute",
                    "noDataMessageStyle": 3,
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "subscriptionId",
                          "formatter": 15,
                          "formatOptions": {
                            "linkTarget": null,
                            "showIcon": true
                          }
                        }
                      ],
                      "filter": true,
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "Recommendation"
                        ],
                        "expandTopLevel": true
                      }
                    }
                  },
                  "name": "query - 0"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "# Virtual Machines\r\nFor customers with Software Assurance, Azure Hybrid Benefit for Windows Server allows you to use your on-premises Windows Server licenses to run Windows virtual machines on Azure at a reduced cost. Make sure to have the right licences before enabling the Hybrid benefit. For more information about Azure Hybrid Benefit for Windows Server licensing and cost savings, see the [Azure Hybrid Benefit for Windows Server licensing page](https://azure.microsoft.com/pricing/hybrid-use-benefit/)\r\n\r\n",
                    "style": "upsell"
                  },
                  "name": "text - 5"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources \r\n| where resourceGroup in ({ResourceGroup})\r\n| where type =~ 'microsoft.compute/virtualmachines' or type =~ 'microsoft.compute/virtualMachineScaleSets'\r\n| where tostring(properties.storageProfile.osDisk.osType) == 'Windows' or tostring(properties.virtualMachineProfile.storageProfile.osDisk.osType) == 'Windows'\r\n| where tostring(properties.['licenseType']) !has 'Windows' and tostring(properties.virtualMachineProfile.['licenseType']) !has 'Windows'\r\n| extend WindowsId=id, VMName=name, VMLocation=location, VMRG=resourceGroup, OSType=tostring(properties.storageProfile.imageReference.offer), OsVersion = tostring(properties.storageProfile.imageReference.sku), VMSize=tostring (properties.hardwareProfile.vmSize), LicenseType = tostring(properties.['licenseType'])\r\n| order by type asc \r\n| project WindowsId,VMName,VMRG,VMSize, VMLocation,OSType, OsVersion,LicenseType",
                    "size": 0,
                    "title": "Windows VMs and VM scale sets without Azure Hybrid Benefit enabled",
                    "noDataMessage": "All Windows VMs and VM scale sets have the Azure Hybrid Benefit enabled",
                    "noDataMessageStyle": 3,
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "LicenseType",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "2",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ]
                    }
                  },
                  "name": "query - 1"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources \r\n| where type =~ 'microsoft.compute/virtualmachines' and (properties.storageProfile.imageReference.publisher == 'suse' or properties.storageProfile.imageReference.publisher=='RedHat')\r\n| where tostring(properties.['licenseType']) != 'SLES_BYOS' and tostring(properties.['licenseType']) != 'RHEL_BYOS' \r\n| extend WindowsId=id, VMName=name, VMLocation=location, VMRG=resourceGroup, OSType=tostring(properties.storageProfile.imageReference.offer), OsVersion = tostring(properties.storageProfile.imageReference.sku), VMSize=tostring (properties.hardwareProfile.vmSize), LicenseType = tostring(properties.['licenseType']) \r\n    | order by VMSize asc \r\n    | where VMRG in ({ResourceGroup})\r\n    | project WindowsId,VMName,VMRG, VMLocation,OSType, OsVersion,LicenseType, VMSize",
                    "size": 0,
                    "title": "Linux VMs without Azure Hybrid Benefit enabled",
                    "noDataMessage": "All applicable Linux VMs have the Azure Hybrid Benefit enabled",
                    "noDataMessageStyle": 3,
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "LicenseType",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "2",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ]
                    }
                  },
                  "name": "query - 2"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "Review the stopped status of the following virtual machines to avoid incuring any unnecessary costs. For more information about power states and billing, please review this [article](https://learn.microsoft.com/azure/virtual-machines/states-billing#power-states-and-billing). ",
                    "style": "upsell"
                  },
                  "name": "text - 5"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources \r\n| where type =~ 'microsoft.compute/virtualmachines' and tostring(properties.extended.instanceView.powerState.displayStatus) != 'VM deallocated' and tostring(properties.extended.instanceView.powerState.displayStatus) != 'VM running'\r\n| where resourceGroup in ({ResourceGroup})\r\n| extend  VMname=name, PowerState=tostring(properties.extended.instanceView.powerState.displayStatus), VMLocation=location, VirtualMachineId=id\r\n| order by VirtualMachineId asc\r\n| project VirtualMachineId,VMname, PowerState, VMLocation, resourceGroup, subscriptionId",
                    "size": 0,
                    "title": "Virtual Machines in a Stopped State",
                    "noDataMessage": "You have no VMs in a stopped state",
                    "noDataMessageStyle": 3,
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "PowerState",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "2",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ]
                    }
                  },
                  "name": "query - 3"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "Review the [virtual machine SKUs](https://learn.microsoft.com/azure/virtual-machines/sizes) that you are using, and explore if there are newer versions of the same SKUs that can provide newer hardware, more resources and less cost",
                    "style": "upsell"
                  },
                  "name": "text - 5"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Resources \r\n| where type =~ 'Microsoft.Compute/virtualMachines' and resourceGroup in ({ResourceGroup})\r\n| extend  VMID=id, VMName=name, TotalDataDisks=array_length(properties.storageProfile.dataDisks), TotalNICs=array_length(properties.networkProfile.networkInterfaces), VMLocation=location, VMSKU=tostring(properties.hardwareProfile.vmSize)\r\n| project VMID,VMSKU, TotalDataDisks, TotalNICs, VMLocation, resourceGroup, subscriptionId,VMName\r\n| order by VMSKU asc\r\n\r\n",
                    "size": 0,
                    "title": "All virtual machines",
                    "noDataMessage": "You have no VMs!",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "subscriptionId",
                          "formatter": 15,
                          "formatOptions": {
                            "linkTarget": null,
                            "showIcon": true
                          }
                        }
                      ],
                      "filter": true,
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "VMSKU"
                        ]
                      }
                    },
                    "graphSettings": {
                      "type": 0,
                      "topContent": {
                        "columnMatch": "VMID",
                        "formatter": 1
                      },
                      "centerContent": {
                        "columnMatch": "TotalDataDisks",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    }
                  },
                  "name": "query - 4"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "# Azure App Service\r\n## Save with Premium v3 reserved instances\r\nWhen you commit to an Azure App Service Premium v3 reserved instance you can save money. The reservation discount is applied automatically to the number of running instances that match the reservation scope and attributes - you don't need to assign a reservation to a specific instance to get the discounts.\r\n\r\n## Determine the right reserved instance size before you buy\r\nBefore you buy a reservation, you should determine the size of the Premium v3 reserved instance that you need. The following sections will help you determine the right Premium v3 reserved instance size.\r\n\r\n## Use Autoscale appropriately\r\nAutoscale can be used to provision resources for when they're needed or on demand, which allows you to minimize costs when your environment is idle.\r\n",
                    "style": "upsell"
                  },
                  "name": "text - 6"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| where resourceGroup in ({ResourceGroup})\r\n| where type =~ 'Microsoft.Web/sites'\r\n| extend WebAppId=id, WebAppRG=resourceGroup, WebAppName=name, AppServicePlan=tostring(properties.serverFarmId), SKU=tostring(properties.sku), Type=kind, Status=tostring(properties.state), WebAppLocation=location, SubscriptionName=subscriptionId\r\n| project WebAppId,WebAppName, Type, Status, WebAppLocation, AppServicePlan, WebAppRG,SubscriptionName\r\n| order by WebAppId asc",
                    "size": 0,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "isVisible",
                    "comparison": "isEqualTo",
                    "value": "Never"
                  },
                  "name": "query - WebFunctionStatus"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| where resourceGroup in ({ResourceGroup})\r\n| where type == \"microsoft.web/serverfarms\"\r\n| extend  planId=tolower(tostring(id)),skuname = tostring(sku.name) , skutier = tostring(sku.tier), workers=tostring(properties.numberOfWorkers),webRG=resourceGroup,maxworkers=tostring(properties.maximumNumberOfWorkers), SubscriptionName=subscriptionId\r\n| project planId, name, skuname, skutier, workers, maxworkers, webRG, SubscriptionName\r\n| join kind=leftouter (resources | where type ==\"microsoft.insights/autoscalesettings\" | project planId=tolower(tostring(properties.targetResourceUri)), PredictiveAutoscale=properties.predictiveAutoscalePolicy.scaleMode, AutoScaleProfiles=properties.profiles,resourceGroup) on planId",
                    "size": 0,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "isVisible",
                    "comparison": "isEqualTo",
                    "value": "Never"
                  },
                  "name": "query - AppServiceplandetails"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\",\"mergeType\":\"inner\",\"leftTable\":\"query - AppServiceplandetails\",\"rightTable\":\"query - WebFunctionStatus\",\"leftColumn\":\"planId\",\"rightColumn\":\"AppServicePlan\"}],\"projectRename\":[{\"originalName\":\"[query - WebFunctionStatus].WebAppId\",\"mergedName\":\"WebAppId\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\"},{\"originalName\":\"[query - WebFunctionStatus].Type\",\"mergedName\":\"Type\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\"},{\"originalName\":\"[query - WebFunctionStatus].WebAppLocation\",\"mergedName\":\"WebAppLocation\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\"},{\"originalName\":\"[query - WebFunctionStatus].Status\",\"mergedName\":\"Status\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\"},{\"originalName\":\"[query - AppServiceplandetails].SubscriptionName\",\"mergedName\":\"SubscriptionName\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - WebFunctionStatus].WebAppRG\",\"mergedName\":\"ResourceGroup\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\"},{\"originalName\":\"[query - AppServiceplandetails].type\",\"mergedName\":\"type\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].tenantId\",\"mergedName\":\"tenantId\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].kind\",\"mergedName\":\"kind\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].location\",\"mergedName\":\"location\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].subscriptionId\",\"mergedName\":\"subscriptionId\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].managedBy\",\"mergedName\":\"managedBy\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].sku\",\"mergedName\":\"sku\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].plan\",\"mergedName\":\"plan\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].skuname\",\"mergedName\":\"skuname\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\"},{\"originalName\":\"[query - AppServiceplandetails].skutier\",\"mergedName\":\"skutier\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\"},{\"originalName\":\"[query - AppServiceplandetails].workers\",\"mergedName\":\"workers\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\"},{\"originalName\":\"[query - AppServiceplandetails].maxworkers\",\"mergedName\":\"maxworkers\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\"},{\"originalName\":\"[query - AppServiceplandetails].properties\",\"mergedName\":\"properties\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].tags\",\"mergedName\":\"tags\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].identity\",\"mergedName\":\"identity\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].zones\",\"mergedName\":\"zones\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].extendedLocation\",\"mergedName\":\"extendedLocation\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].planId\",\"mergedName\":\"planId\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].PredictiveAutoscale\",\"mergedName\":\"PredictiveAutoscale\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].AutoScaleProfiles\",\"mergedName\":\"AutoScaleProfiles\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].resourceGroup1\",\"mergedName\":\"resourceGroup1\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].name\",\"mergedName\":\"name\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\"},{\"originalName\":\"[query - AppServiceplandetails].webRG\",\"mergedName\":\"webRG\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\"},{\"originalName\":\"[query - AppServiceplandetails].planId1\",\"mergedName\":\"planId1\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\"},{\"originalName\":\"[query - AppServiceplandetails].resourceGroup\",\"mergedName\":\"resourceGroup\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\"},{\"originalName\":\"[query - WebFunctionStatus].WebAppName\",\"mergedName\":\"WebAppName\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\"},{\"originalName\":\"[query - WebFunctionStatus].AppServicePlan\",\"mergedName\":\"AppServicePlan\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\"},{\"originalName\":\"[query - WebFunctionStatus].SubscriptionName\"}]}",
                    "size": 0,
                    "title": "Web Apps",
                    "noDataMessage": "You have no WebApps!",
                    "showExportToExcel": true,
                    "queryType": 7,
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Status",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Running",
                                "representation": "success",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Stopped",
                                "representation": "disabled",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "SubscriptionName",
                          "formatter": 15,
                          "formatOptions": {
                            "linkTarget": null,
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "name",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "webRG",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "planId1",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "resourceGroup",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "WebAppName",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "AppServicePlan",
                          "formatter": 5
                        }
                      ],
                      "filter": true,
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "name"
                        ],
                        "expandTopLevel": true
                      }
                    }
                  },
                  "showPin": false,
                  "name": "query - 10"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "# Azure Kubernetes Service\r\n-Enable cluster autoscaler to automatically adjust the number of agent nodes in response to resource constraints\r\n\r\n-Consider using Azure Spot VMs for workloads that can handle interruptions, early terminations, or evictions. For example, workloads such as batch processing jobs, development and testing environments, and large compute workloads may be good candidates to be scheduled on a spot node pool.\r\n\r\n-Utilize the Horizontal pod autoscaler to adjust the number of pods in a deployment depending on CPU utilization or other select metrics.\r\n\r\n-Use the Start/Stop feature in Azure Kubernetes Services (AKS).\r\n\r\n",
                    "style": "upsell"
                  },
                  "name": "text - 11"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "\tresources\r\n    | where resourceGroup in ({ResourceGroup})\r\n\t| where type == \"microsoft.containerservice/managedclusters\"\r\n\t| extend  AKSname=name,location=location,AKSRG=tolower(resourceGroup),Sku=tostring(sku.name),Tier=tostring(sku.tier),AgentPoolProfiles=properties.agentPoolProfiles\r\n\t| mvexpand AgentPoolProfiles\r\n\t| extend ProfileName = tostring(AgentPoolProfiles.name) ,mode=AgentPoolProfiles.mode,AutoScaleEnabled = AgentPoolProfiles.enableAutoScaling ,SpotVM=AgentPoolProfiles.scaleSetPriority,  VMSize=tostring(AgentPoolProfiles.vmSize),minCount=tostring(AgentPoolProfiles.minCount),maxCount=tostring(AgentPoolProfiles.maxCount) , nodeCount=tostring(AgentPoolProfiles.['count'])\r\n    | project id,ProfileName,Sku,Tier,mode,AutoScaleEnabled,SpotVM, VMSize,nodeCount,minCount,maxCount,location,AKSRG,AKSname\r\n",
                    "size": 0,
                    "noDataMessage": "You have no AKS clusters!",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "id",
                          "formatter": 13,
                          "formatOptions": {
                            "linkTarget": "Resource",
                            "subTarget": "Insights",
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "mode",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "System",
                                "representation": "Gear",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "User",
                                "representation": "Person",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AutoScaleEnabled",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "true",
                                "representation": "success",
                                "text": ""
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "disabled",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "SpotVM",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "is Empty",
                                "representation": "3",
                                "text": "{0}{1}Not Spot VM"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "filter": true,
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "AKSname"
                        ],
                        "expandTopLevel": true
                      }
                    }
                  },
                  "name": "query - 12"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "RG_Filter",
              "comparison": "isNotEqualTo",
              "value": "Tags"
            },
            "name": "Compute - Subscription"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "advisorresources\r\n| where type == \"microsoft.advisor/recommendations\"\r\n| where tostring (properties.category) has \"Cost\"\r\n| where properties.impactedField has \"Compute\" or properties.impactedField has \"Container\" or properties.impactedField has \"Web\"\r\n| project AffectedResource=tolower(tostring(properties.resourceMetadata.resourceId)),Impact=properties.impact,resourceGroup,AdditionaInfo=properties.extendedProperties,subscriptionId,Recommendation=tostring(properties.shortDescription.problem),AffectedResourceName=tostring(properties.impactedValue)\r\n| join ( resources\r\n    | where type has \"Compute\" or type has \"Web\" or type has \"Container\"\r\n    | extend  AffectedResource=tolower(id)\r\n    ) on AffectedResource\r\n| where isnotempty(tags) and isnotnull(tags)\r\n| mvexpand tags\r\n| extend tagName = tostring(bag_keys(tags)[0])\r\n| extend tagValue = tostring(tags[tagName])\r\n| where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n| project  AffectedResource, Impact,resourceGroup,AdditionaInfo, tagName, tagValue, Recommendation, SubscriptionName=subscriptionId\r\n",
                    "size": 0,
                    "title": "Azure advisor Cost recommendations",
                    "noDataMessage": "You are following all Compute Advisor recommendations",
                    "noDataMessageStyle": 3,
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "tagName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Tags",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "tagValue",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Tags",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "filter": true,
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "Recommendation"
                        ],
                        "expandTopLevel": true
                      }
                    }
                  },
                  "name": "query - 0"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "# Virtual Machines\r\nFor customers with Software Assurance, Azure Hybrid Benefit for Windows Server allows you to use your on-premises Windows Server licenses to run Windows virtual machines on Azure at a reduced cost. This article discusses how to deploy new VMs with Azure Hybrid Benefit for Windows Server enabled, and how you can update any existing running VMs. For more information about Azure Hybrid Benefit for Windows Server licensing and cost savings, see the [Azure Hybrid Benefit for Windows Server licensing page](https://azure.microsoft.com/pricing/hybrid-use-benefit/)\r\n",
                    "style": "upsell"
                  },
                  "name": "text - 5"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| where isnotempty(tags) and isnotnull(tags)\r\n| where type =~ 'microsoft.compute/virtualmachines' or type =~ 'microsoft.compute/virtualMachineScaleSets'\r\n| mvexpand tags\r\n| extend tagName = tostring(bag_keys(tags)[0])\r\n| extend tagValue = tostring(tags[tagName])\r\n| where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n| where tostring(properties.storageProfile.osDisk.osType) == 'Windows' or tostring(properties.virtualMachineProfile.storageProfile.osDisk.osType) == 'Windows'\r\n| where tostring(properties.['licenseType']) !has 'Windows' and tostring(properties.virtualMachineProfile.['licenseType']) !has 'Windows'\r\n| extend WindowsId=id, VMName=name, VMLocation=location, VMRG=resourceGroup, OSType=tostring(properties.storageProfile.imageReference.offer), OsVersion = tostring(properties.storageProfile.imageReference.sku), VMSize=tostring (properties.hardwareProfile.vmSize), LicenseType = tostring(properties.['licenseType']), SubscriptionName=subscriptionId\r\n| project WindowsId,VMName,VMRG,VMSize, VMLocation,OSType,tagName,tagValue, OsVersion,LicenseType, SubscriptionName\r\n| order by VMSize asc",
                    "size": 0,
                    "title": "Windows VMs and VMSS without Azure Hybrid Benefit enabled",
                    "noDataMessage": "All Windows VMs and VMSS  are using the Azure Hybrid Benefit",
                    "noDataMessageStyle": 3,
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "tagName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Tags",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "tagValue",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Tags",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ]
                    }
                  },
                  "name": "query - 1"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| where type =~ 'microsoft.compute/virtualmachines'\r\n| where isnotempty(tags) and isnotnull(tags)\r\n| mvexpand tags\r\n| extend tagName = tostring(bag_keys(tags)[0])\r\n| extend tagValue = tostring(tags[tagName])\r\n| where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n| where properties.storageProfile.imageReference.publisher in ('suse', 'RedHat')\r\n| where tostring(properties.['licenseType']) !in ('SLES_BYOS','REHL_BYOS')\r\n| extend WindowsId=id, VMName=name, VMLocation=location, VMRG=resourceGroup, OSType=tostring(properties.storageProfile.imageReference.offer), OsVersion = tostring(properties.storageProfile.imageReference.sku), VMSize=tostring (properties.hardwareProfile.vmSize), LicenseType = tostring(properties.['licenseType']), SubscriptionName=subscriptionId \r\n| project WindowsId,name,VMRG,VMSize, VMLocation,OSType,tagName,tagValue, OsVersion,LicenseType, SubscriptionName\r\n| order by VMSize asc ",
                    "size": 0,
                    "title": "Linux VMs without Azure Hybrid Benefit enabled",
                    "noDataMessage": "All Linux VMs are using the Azure Hybrid Benefit",
                    "noDataMessageStyle": 3,
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "tagName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Tags",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "tagValue",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Tags",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ]
                    }
                  },
                  "name": "query - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| where type =~ 'microsoft.compute/virtualmachines'\r\n| where isnotempty(tags) and isnotnull(tags)\r\n| mvexpand tags\r\n| extend tagName = tostring(bag_keys(tags)[0])\r\n| extend tagValue = tostring(tags[tagName])\r\n| where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n| where tostring(properties.extended.instanceView.powerState.displayStatus) != 'VM deallocated'\r\n| where tostring(properties.extended.instanceView.powerState.displayStatus) != 'VM running'\r\n| extend  VMname=name, PowerState=tostring(properties.extended.instanceView.powerState.displayStatus), VMLocation=location, VMRG=resourceGroup, VirtualMachineId=id, SubscriptionName=subscriptionId\r\n| project VirtualMachineId,VMname, PowerState, VMLocation, tagName,tagValue,VMRG, SubscriptionName\r\n| order by VirtualMachineId asc",
                    "size": 0,
                    "title": "Virtual Machines in a Stopped State",
                    "noDataMessage": "No Virtual Machines found in stopped state",
                    "noDataMessageStyle": 3,
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ]
                  },
                  "name": "query - 3"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "Review the [virtual machine SKUs](https://learn.microsoft.com/azure/virtual-machines/sizes) that you are using, and explore if there are newer versions of the same SKUs that can provide newer hardware, more resources and less cost",
                    "style": "upsell"
                  },
                  "name": "text - 5"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Resources\r\n| where type =~ 'Microsoft.Compute/virtualMachines'\r\n| where isnotempty(tags) and isnotnull(tags)\r\n| mvexpand tags\r\n| extend tagName = tostring(bag_keys(tags)[0])\r\n| extend tagValue = tostring(tags[tagName])\r\n| where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n| extend  VMID=id, TotalDataDisks=array_length(properties.storageProfile.dataDisks), VMName=name, TotalNICs=array_length(properties.networkProfile.networkInterfaces), VMLocation=location, VMRG=resourceGroup, VMSKU=tostring(properties.hardwareProfile.vmSize), SubscriptionName=subscriptionId\r\n| project VMID,VMSKU, TotalDataDisks, TotalNICs, VMLocation, VMRG, SubscriptionName,tagName,tagValue,VMName\r\n| order by VMSKU asc\r\n    ",
                    "size": 0,
                    "title": "All virtual machines",
                    "noDataMessage": "No Virtual machines found!",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "tagName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Tags",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "tagValue",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Tags",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "filter": true,
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "VMSKU"
                        ]
                      }
                    }
                  },
                  "name": "query - 4"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "# Azure App Service\r\n## Save with Premium v3 reserved instances\r\nWhen you commit to an Azure App Service Premium v3 reserved instance you can save money. The reservation discount is applied automatically to the number of running instances that match the reservation scope and attributes - you don't need to assign a reservation to a specific instance to get the discounts.\r\n\r\n## Determine the right reserved instance size before you buy\r\nBefore you buy a reservation, you should determine the size of the Premium v3 reserved instance that you need. The following sections will help you determine the right Premium v3 reserved instance size.\r\n\r\n## Use Autoscale appropriately\r\nAutoscale can be used to provision resources for when they're needed or on demand, which allows you to minimize costs when your environment is idle.\r\n",
                    "style": "upsell"
                  },
                  "name": "text - 6"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| where type =~ 'Microsoft.Web/sites'\r\n| where isnotempty(tags) and isnotnull(tags)\r\n| mvexpand tags\r\n| extend tagName = tostring(bag_keys(tags)[0])\r\n| extend tagValue = tostring(tags[tagName])\r\n| where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n| extend WebAppId=id, WebAppRG=resourceGroup, WebAppName=name, AppServicePlan=tostring(properties.serverFarmId), SKU=tostring(properties.sku), Type=kind, Status=tostring(properties.state), WebAppLocation=location, SubscriptionName=subscriptionId\r\n| project WebAppId,WebAppName, Type, Status, WebAppLocation, AppServicePlan, WebAppRG,tagName,tagValue,SubscriptionName\r\n| order by WebAppId asc",
                    "size": 0,
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "isVisible",
                    "comparison": "isEqualTo",
                    "value": "Never"
                  },
                  "name": "query - WebFunctionStatus-Tags"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| where type == \"microsoft.web/serverfarms\"\r\n| extend  planId=tolower(tostring(id)),skuname = tostring(sku.name) , skutier = tostring(sku.tier), workers=tostring(properties.numberOfWorkers),webRG=resourceGroup,maxworkers=tostring(properties.maximumNumberOfWorkers)\r\n| join ( resources | mvexpand tags | extend  Tags=tags, resourceGroup \r\n| extend tagName = tostring(bag_keys(tags)[0])\r\n| extend tagValue = tostring(tags[tagName]) ) on name\r\n| where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n| project planId,name,skuname,skutier,workers, maxworkers,webRG,tagName,tagValue\r\n| join kind=leftouter (resources | where type ==\"microsoft.insights/autoscalesettings\" | project planId=tolower(tostring(properties.targetResourceUri)), PredictiveAutoscale=properties.predictiveAutoscalePolicy.scaleMode, AutoScaleProfiles=properties.profiles,resourceGroup) on planId",
                    "size": 0,
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "isVisible",
                    "comparison": "isEqualTo",
                    "value": "Never"
                  },
                  "name": "query - AppServiceplandetails-Tags"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b268\",\"mergeType\":\"inner\",\"leftTable\":\"query - AppServiceplandetails-Tags\",\"rightTable\":\"query - WebFunctionStatus-Tags\",\"leftColumn\":\"planId\",\"rightColumn\":\"AppServicePlan\"}],\"projectRename\":[{\"originalName\":\"[query - WebFunctionStatus-Tags].WebAppId\",\"mergedName\":\"WebAppId\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b268\"},{\"originalName\":\"[query - WebFunctionStatus-Tags].Type\",\"mergedName\":\"Type\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b268\"},{\"originalName\":\"[query - WebFunctionStatus-Tags].Status\",\"mergedName\":\"Status\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b268\"},{\"originalName\":\"[query - WebFunctionStatus-Tags].SubscriptionName\",\"mergedName\":\"SubscriptionName\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b268\"},{\"originalName\":\"[query - WebFunctionStatus-Tags].WebAppRG\",\"mergedName\":\"WebAppRG\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b268\"},{\"originalName\":\"[query - WebFunctionStatus-Tags].WebAppLocation\",\"mergedName\":\"WebAppLocation\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b268\"},{\"originalName\":\"[query - AppServiceplandetails-Tags].planId\",\"mergedName\":\"planId\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b268\"},{\"originalName\":\"[query - AppServiceplandetails-Tags].WebAppName\",\"mergedName\":\"WebAppName\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b268\"},{\"originalName\":\"[query - AppServiceplandetails-Tags].skuname\",\"mergedName\":\"skuname\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b268\"},{\"originalName\":\"[query - AppServiceplandetails-Tags].skutier\",\"mergedName\":\"skutier\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b268\"},{\"originalName\":\"[query - AppServiceplandetails-Tags].workers\",\"mergedName\":\"workers\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b268\"},{\"originalName\":\"[query - AppServiceplandetails-Tags].maxworkers\",\"mergedName\":\"maxworkers\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b268\"},{\"originalName\":\"[query - AppServiceplandetails-Tags].tagName\",\"mergedName\":\"tagName\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b268\"},{\"originalName\":\"[query - AppServiceplandetails-Tags].tagValue\",\"mergedName\":\"tagValue\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b268\"},{\"originalName\":\"[query - AppServiceplandetails-Tags].PredictiveAutoscale\",\"mergedName\":\"PredictiveAutoscale\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b268\"},{\"originalName\":\"[query - AppServiceplandetails-Tags].AutoScaleProfiles\",\"mergedName\":\"AutoScaleProfiles\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b268\"},{\"originalName\":\"[query - AppServiceplandetails-Tags].name\",\"mergedName\":\"name\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b268\"},{\"originalName\":\"[query - AppServiceplandetails-Tags].webRG\",\"mergedName\":\"webRG\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b268\"},{\"originalName\":\"[query - AppServiceplandetails-Tags].planId1\",\"mergedName\":\"planId1\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b268\"},{\"originalName\":\"[query - AppServiceplandetails-Tags].resourceGroup\",\"mergedName\":\"resourceGroup\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b268\"},{\"originalName\":\"[query - WebFunctionStatus-Tags].WebAppName\",\"mergedName\":\"WebAppName\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b268\"},{\"originalName\":\"[query - WebFunctionStatus-Tags].AppServicePlan\",\"mergedName\":\"AppServicePlan\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b268\"},{\"originalName\":\"[query - WebFunctionStatus-Tags].tagValue\"},{\"originalName\":\"[query - WebFunctionStatus-Tags].tagName\"}]}",
                    "size": 0,
                    "title": "Web Apps",
                    "noDataMessage": "No Web Apps found!",
                    "showExportToExcel": true,
                    "queryType": 7,
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Status",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Running",
                                "representation": "success",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Stopped",
                                "representation": "disabled",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "SubscriptionName",
                          "formatter": 15,
                          "formatOptions": {
                            "linkTarget": null,
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "tagName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Tags",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "tagValue",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Tags",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "name",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "webRG",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "planId1",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "resourceGroup",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "WebAppName",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "AppServicePlan",
                          "formatter": 5
                        }
                      ],
                      "filter": true,
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "name"
                        ],
                        "expandTopLevel": true
                      }
                    }
                  },
                  "showPin": false,
                  "name": "query - 10"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "# Azure Kubernetes Service\r\n-Enable cluster autoscaler to automatically adjust the number of agent nodes in response to resource constraints\r\n\r\n-Consider using Azure Spot VMs for workloads that can handle interruptions, early terminations, or evictions. For example, workloads such as batch processing jobs, development and testing environments, and large compute workloads may be good candidates to be scheduled on a spot node pool.\r\n\r\n-Utilize the Horizontal pod autoscaler to adjust the number of pods in a deployment depending on CPU utilization or other select metrics.\r\n\r\n-Use the Start/Stop feature in Azure Kubernetes Services (AKS).\r\n\r\n",
                    "style": "upsell"
                  },
                  "name": "text - 11"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| where type == \"microsoft.containerservice/managedclusters\"\r\n| where isnotempty(tags) and isnotnull(tags)\r\n| mvexpand tags\r\n| extend tagName = tostring(bag_keys(tags)[0])\r\n| extend tagValue = tostring(tags[tagName])\r\n| where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n| extend  AKSname=name,AKSID=id,location=location,AKSRG=resourceGroup,Sku=tostring(sku.name),Tier=tostring(sku.tier),AgentPoolProfiles=properties.agentPoolProfiles, SubscriptionName = subscriptionId\r\n| mvexpand AgentPoolProfiles\r\n| extend ProfileName = tostring(AgentPoolProfiles.name) ,mode=AgentPoolProfiles.mode,AutoScaleEnabled = AgentPoolProfiles.enableAutoScaling ,SpotVM=AgentPoolProfiles.scaleSetPriority,  VMSize=tostring(AgentPoolProfiles.vmSize),minCount=tostring(AgentPoolProfiles.minCount),maxCount=tostring(AgentPoolProfiles.maxCount) , nodeCount=tostring(AgentPoolProfiles.['count'])\r\n| project id,ProfileName,Sku,Tier,mode,AutoScaleEnabled,SpotVM, VMSize,nodeCount,minCount,maxCount,location,AKSRG,AKSname",
                    "size": 0,
                    "noDataMessage": "No AKS clusters found!",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "AKSID",
                          "formatter": 13,
                          "formatOptions": {
                            "linkTarget": "Resource",
                            "subTarget": "Insights",
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "ProfileName",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "mode",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "System",
                                "representation": "Gear",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "User",
                                "representation": "Person",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AutoScaleEnabled",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "true",
                                "representation": "success",
                                "text": ""
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "disabled",
                                "text": ""
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "tagName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Tags",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "tagValue",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Tags",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "filter": true,
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "AKSname"
                        ],
                        "expandTopLevel": true
                      }
                    }
                  },
                  "name": "query - 12"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "RG_Filter",
              "comparison": "isEqualTo",
              "value": "Tags"
            },
            "name": "Compute - Tags"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "SelectedTab",
        "comparison": "isEqualTo",
        "value": "Compute"
      },
      "name": "ComputeGroup",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## Resources distribution per region"
            },
            "name": "text - 3"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "summarize count() by location",
              "size": 2,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "visualization": "map",
              "mapSettings": {
                "locInfo": "AzureLoc",
                "locInfoColumn": "location",
                "sizeSettings": "count_",
                "sizeAggregation": "Sum",
                "labelSettings": "location",
                "legendMetric": "count_",
                "legendAggregation": "Sum",
                "itemColorSettings": {
                  "nodeColorField": "count_",
                  "colorAggregation": "Sum",
                  "type": "heatmap",
                  "heatmapPalette": "greenRed"
                }
              }
            },
            "name": "query - 0"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "ResourceContainers  | where type =~ 'Microsoft.Resources/subscriptions' | project SubscriptionName = name, subscriptionId | join (Resources| summarize resourceCount=count() by subscriptionId) on subscriptionId\r\n",
              "size": 0,
              "title": "Resources per Subscription",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "showBorder": false,
                "titleContent": {
                  "columnMatch": "SubscriptionName",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "resourceCount",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              }
            },
            "customWidth": "33",
            "name": "query - 1"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "Resources | where type =~ 'Microsoft.Compute/virtualMachines' | project SKU = tostring(properties.hardwareProfile.vmSize)| summarize count() by SKU",
              "size": 0,
              "title": "Virtual machines per SKU",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "visualization": "piechart",
              "tileSettings": {
                "showBorder": false,
                "titleContent": {
                  "columnMatch": "SKU",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "count_",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              }
            },
            "customWidth": "66",
            "name": "query - 2"
          },
          {
            "type": 1,
            "content": {
              "json": "## Tagged vs Untagged Resource Groups\r\n\r\nTags are a crucial part of organizing your Azure resources into a taxonomy. When following best practices for tag management, tags can be the basis for applying your business policies with Azure Policy or tracking costs with Cost Management. No matter how or why you use tags, it's important that you can quickly add, change, and remove those tags on your Azure resources. To see if your Azure resource supports tagging, see [Tag support](https://docs.microsoft.com/en-us/azure/azure-resource-manager/management/tag-support).\r\n\r\nConsider using Azure Policy to place mandatory Tag rules such as Enforce Tags on Resource Groups and inheritance on the Resources.\r\n\r\nhttps://docs.microsoft.com/en-us/azure/azure-resource-manager/management/tag-policies\r\n"
            },
            "name": "text - 5"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "ResourceContainers\r\n| where type =~ 'microsoft.resources/subscriptions/resourcegroups'\r\n| extend TagBool = iff(tags != '' and tags != '[]', \"Tagged\",\"Untagged\")\r\n| summarize count() by TagBool\r\n//| project resourceGroup, tags\r\n",
              "size": 0,
              "title": "Tagged Resource Groups",
              "exportFieldName": "resourceGroupTag",
              "exportParameterName": "resourceGroupTag",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "visualization": "piechart"
            },
            "customWidth": "50",
            "name": "query - 3"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "Resources | extend TagBool = iff(tags != '' and tags != '[]', \"Tagged\",\"Untagged\") | summarize count() by TagBool\r\n\r\n",
              "size": 0,
              "title": "Untagged Resource Count",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "visualization": "piechart"
            },
            "customWidth": "50",
            "name": "query - 7"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "30ab4c42-0169-445b-b482-dc4d50e82dca",
                  "version": "KqlParameterItem/1.0",
                  "name": "ShowTaggedRG",
                  "type": 2,
                  "description": "Show RG with Tags",
                  "isRequired": true,
                  "value": "Yes",
                  "typeSettings": {
                    "additionalResourceOptions": []
                  },
                  "jsonData": "[\"Yes\", \"No\"]",
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "label": "Show tagged resource groups"
                },
                {
                  "version": "KqlParameterItem/1.0",
                  "name": "ShowUntaggedRG",
                  "type": 2,
                  "description": "Show RG with Tags",
                  "isRequired": true,
                  "value": "Yes",
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\"Yes\", \"No\"]",
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "id": "579f68ee-5a65-4b2a-9fda-0c567e194fe0",
                  "label": "Show un-tagged resource groups"
                },
                {
                  "id": "d58029c8-a1ca-4b40-ad00-ad9d749879ac",
                  "version": "KqlParameterItem/1.0",
                  "name": "ShowUntaggedResources",
                  "label": "Show un-tagged resources",
                  "type": 2,
                  "isRequired": true,
                  "value": "Yes",
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[\"Yes\",\"No\"]",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - 9"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "ResourceContainers\r\n| where type =~ 'Microsoft.Resources/subscriptions' \r\n| extend SubscriptionName=name \r\n| join  ( ResourceContainers | where type =~ 'microsoft.resources/subscriptions/resourcegroups'  | where tags !~ '' and tags != '{}'\r\n| extend resourceGroupName=id, RGLocation=location, RGTags=tags) on subscriptionId\r\n| project resourceGroupName, RGTags, RGLocation, SubscriptionName\r\n",
              "size": 0,
              "title": "Tagged Resource Groups",
              "noDataMessageStyle": 3,
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ]
            },
            "customWidth": "50",
            "conditionalVisibility": {
              "parameterName": "ShowTaggedRG",
              "comparison": "isEqualTo",
              "value": "Yes"
            },
            "name": "query - 10"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "ResourceContainers\r\n| where type =~ 'Microsoft.Resources/subscriptions' \r\n| extend SubscriptionName=name \r\n| join  ( ResourceContainers | where type =~ 'microsoft.resources/subscriptions/resourcegroups' | where tags =~ '' or tags =~ '{}'\r\n| extend resourceGroupName=id, RGLocation=location) on subscriptionId\r\n| project resourceGroupName, RGLocation, SubscriptionName\r\n",
              "size": 0,
              "title": "Untagged Resource Groups",
              "noDataMessageStyle": 3,
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ]
            },
            "customWidth": "50",
            "conditionalVisibility": {
              "parameterName": "ShowUntaggedRG",
              "comparison": "isEqualTo",
              "value": "Yes"
            },
            "name": "query - 10 - Copy"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "parameters": [
                {
                  "id": "6e771b18-7292-42da-8d55-581097f4eb70",
                  "version": "KqlParameterItem/1.0",
                  "name": "ResourceType",
                  "label": "Resource Type",
                  "type": 7,
                  "isRequired": true,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "resources | where tags == ''\r\n| distinct type",
                  "crossComponentResources": [
                    "{Subscription}"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::1",
                      "value::all"
                    ],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources",
                  "value": []
                }
              ],
              "style": "pills",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources"
            },
            "conditionalVisibility": {
              "parameterName": "ShowUntaggedResources",
              "comparison": "isEqualTo",
              "value": "Yes"
            },
            "name": "parameters - 11"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources \r\n| where tags =~ '' or tags =~ '{}'\r\n| where type in~ ({ResourceType}) or '*' in~ ({ResourceType})\r\n| project Name=id, subscriptionId\r\n\r\n",
              "size": 0,
              "title": "Untagged Resources",
              "noDataMessage": "No Untagged Resources found",
              "noDataMessageStyle": 3,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "gridSettings": {
                "rowLimit": 1000,
                "filter": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "ShowUntaggedResources",
              "comparison": "isEqualTo",
              "value": "Yes"
            },
            "name": "query - 10"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "SelectedTab",
        "comparison": "isEqualTo",
        "value": "General"
      },
      "name": "Group General",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# Welcome to the Cost Optimization Workbook"
            },
            "name": "text - 6"
          },
          {
            "type": 1,
            "content": {
              "json": "### Reference: [Microsoft Azure Well-Architected Framework - Cost Optimization Pillar](https://learn.microsoft.com/en-us/azure/architecture/framework/cost/overview)",
              "style": "upsell"
            },
            "name": "text - 5"
          },
          {
            "type": 1,
            "content": {
              "json": "The objective of this workbook is to provide an overview of the Cost posture of your Azure environment. The workbook is to be used as guidance only, and does not represent a guarantee of any Cost Reduction.\r\n\r\n## Overview of the cost optimization pillar\r\n\r\n* The cost optimization pillar provides principles for balancing business goals with budget justification to create a cost-effective workload while avoiding capital-intensive solutions. Cost optimization is about looking at ways to reduce unnecessary expenses and improve operational efficiencies.\r\n\r\n* To assess your workload using the tenets found in the [Microsoft Azure Well-Architected Framework](https://learn.microsoft.com/en-us/azure/architecture/framework/), reference the [Microsoft Azure Well-Architected Review](https://learn.microsoft.com/en-us/assessments/?id=azure-architecture-review&mode=pre-assessment&session=20dc50e4-5b71-4f38-bc49-51cc1d9f205c).\r\n\r\n\r\n\r\n\r\n"
            },
            "name": "text - 0"
          },
          {
            "type": 1,
            "content": {
              "json": "Indicates an implemented feature that can result in a environment that is following the Cost Optimization & Cost Governance principles.",
              "style": "success"
            },
            "customWidth": "50",
            "name": "text - 1",
            "styleSettings": {
              "margin": "10px",
              "showBorder": true
            }
          },
          {
            "type": 1,
            "content": {
              "json": "Indicates a feature that has not been implemented, and therefore should be reviewed",
              "style": "warning"
            },
            "customWidth": "50",
            "name": "text - 2",
            "styleSettings": {
              "margin": "10px",
              "showBorder": true
            }
          },
          {
            "type": 1,
            "content": {
              "json": "## RBAC Needed\r\n\r\nThis workbook will present various cost-related details in the form of governance, networking, storage, VMs, Webapps, SQL, and cost information to educate the business about cost related to various resources.\r\n\r\n\r\n* Consider the following least-privilege (minimum) RBAC permissions when deploying the workbook:\r\n\r\n  * **Reader** , **Billing Reader** and **Workbook Contributor** : allows you to import the workbook, view all of the workbook tabs including the *Cost Information* tab and save the workbook in a resource group.\r\n  * **Reader** and **Workbook Contributor** : allows you to import the workbook, view all of the workbook tabs except the *Cost Information* tab and save the workbook in a resource group.\r\n  * **Reader** : allows you to import the workbook and view all of the workbook tabs except the *Cost Information* tab.\r\n\r\n\r\n"
            },
            "name": "text - 3"
          },
          {
            "type": 1,
            "content": {
              "json": "  > The **Cost Information** tab only works with one subscription at the time.",
              "style": "info"
            },
            "name": "text - 4"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "SelectedTab",
        "comparison": "isEqualTo",
        "value": "Welcome"
      },
      "name": "Welcome"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "advisorresources\r\n| where type == \"microsoft.advisor/recommendations\"\r\n| where tostring (properties.category) has \"Cost\"\r\n| where properties.impactedField has \"Microsoft.Subscriptions/subscriptions\" or properties.impactedField has \"Microsoft.ReservedInstances/reservedInstances\"\r\n| project AffectedResource=tostring(properties.resourceMetadata.resourceId),Recommendation=tostring(properties.shortDescription.problem),Impact=tostring(properties.impact),resourceGroup,AdditionaInfo=properties.extendedProperties,subscriptionId\r\n",
              "size": 0,
              "title": "Azure Advisor subscriptions recommendations",
              "noDataMessage": "You are following all of our cost recommendations for Subscriptions",
              "noDataMessageStyle": 3,
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "$gen_group",
                    "formatter": 15,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true
                    }
                  }
                ],
                "hierarchySettings": {
                  "treeType": 1,
                  "groupBy": [
                    "subscriptionId",
                    "Impact",
                    "Recommendation"
                  ],
                  "expandTopLevel": true
                }
              }
            },
            "name": "query - 12"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "SelectedTab",
        "comparison": "isEqualTo",
        "value": "Advisor"
      },
      "name": "Advisor"
    }
  ],
  "fallbackResourceIds": [
    "Azure Monitor"
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}