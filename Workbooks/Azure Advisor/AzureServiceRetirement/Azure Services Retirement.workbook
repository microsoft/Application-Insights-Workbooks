{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "# Services Retirement Workbook\r\n\r\nThis workbook shows Azure services that are being phased out so that you can mitigate affected resources. Currently, this workbook contains information for subset of services and features that are in the retirement lifecycle. If this page is helpful to you or if you have feedback on how we can improve then please [**submit feedback here**](https://aka.ms/srwb-survey). \r\n\r\nWhile we continue to add more services to this workbook, you can view the lifecycle status of all Azure products and services by visiting [Azure updates](https://azure.microsoft.com/updates/?updateType=retirements). \r\n\r\n<span style=\"color:maroon\"> **Required Action:** </span> To avoid service disruptions, please review and migrate the affected resources before the retirement date by following recommendations as outlined in the respective documents."
      },
      "name": "Summary Header",
      "styleSettings": {
        "margin": "0",
        "padding": "0"
      }
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "16030a75-1de4-4dad-bfad-0cb49f81690c",
            "version": "KqlParameterItem/1.0",
            "name": "SubscriptionId",
            "label": "Subscription",
            "type": 6,
            "isRequired": true,
            "isGlobal": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "includeAll": false,
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "defaultValue": "value::all",
            "value": [
              "value::all"
            ]
          },
          {
            "id": "d3cb53ad-aabe-43cc-9019-f317ece41ea5",
            "version": "KqlParameterItem/1.0",
            "name": "ResourceGroup",
            "label": "Resource group",
            "type": 2,
            "description": "A resource group is a collection of resources that share the same lifecycle, permissions, and policies",
            "isGlobal": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "resources\r\n| distinct resourceGroup",
            "crossComponentResources": [
              "{SubscriptionId}"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "selectAllValue": "*",
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "defaultValue": "value::all",
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "value": [
              "value::all"
            ]
          },
          {
            "id": "fd8fc823-879f-4647-b9ea-23e37fe830c7",
            "version": "KqlParameterItem/1.0",
            "name": "Region",
            "label": "Location",
            "type": 8,
            "description": "A geographic location where resources are located",
            "isGlobal": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "includeAll": true,
              "selectAllValue": "*",
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "defaultValue": "value::all",
            "value": [
              "value::all"
            ]
          },
          {
            "id": "71b581de-889a-4276-9001-f30d4c904e04",
            "version": "KqlParameterItem/1.0",
            "name": "FullList",
            "label": "Choose view",
            "type": 10,
            "description": "\"All services\" seclection will show the list of all Azure Services which are in retirement lifecycle even if none of your resoures are affected",
            "isRequired": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[{ \"value\": \"Yes\", \"label\": \"Services with affected resources\", \"selected\":true},\r\n {\"value\": \"No\", \"label\": \"All services\"}]"
          }
        ],
        "style": "above",
        "queryType": 0,
        "resourceType": "microsoft.resourcegraph/resources"
      },
      "name": "ParameterDeclaration"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "{\"version\":\"1.0.0\",\"content\":\"[\\r\\n    {\\r\\n        \\\"Id\\\":1\\r\\n        ,\\\"ServiceName\\\":\\\"Virtual Machines\\\"\\r\\n        ,\\\"RetiringFeature\\\":\\\"Av1-series\\\"\\r\\n        ,\\\"RetirementDate\\\":\\\"2024-08-31\\\"\\r\\n        ,\\\"Link\\\": \\\"https://learn.microsoft.com/azure/virtual-machines/av1-series-retirement\\\"\\r\\n    }\\r\\n,   {\\r\\n        \\\"Id\\\":2\\r\\n        ,\\\"ServiceName\\\":\\\"Virtual Machines\\\"\\r\\n        ,\\\"RetiringFeature\\\":\\\"Classic IaaS\\\"\\r\\n        ,\\\"RetirementDate\\\":\\\"2023-09-01\\\"\\r\\n        ,\\\"Link\\\": \\\"https://learn.microsoft.com/azure/virtual-machines/classic-vm-deprecation\\\"\\r\\n    }\\r\\n,   {\\r\\n        \\\"Id\\\":3\\r\\n        ,\\\"ServiceName\\\":\\\"App Service\\\"\\r\\n        ,\\\"RetiringFeature\\\":\\\"App Service Environment v1/v2\\\"\\r\\n        ,\\\"RetirementDate\\\":\\\"2024-08-31\\\"\\r\\n        ,\\\"Link\\\": \\\"https://azure.microsoft.com/updates/app-service-environment-v1-v2-retirement/\\\"\\r\\n    }\\r\\n,   {\\r\\n        \\\"Id\\\":4\\r\\n        ,\\\"ServiceName\\\":\\\"Azure Disks\\\"\\r\\n        ,\\\"RetiringFeature\\\":\\\"Unmanaged Disks\\\"\\r\\n        ,\\\"RetirementDate\\\":\\\"2025-09-30\\\"\\r\\n        ,\\\"Link\\\": \\\"https://learn.microsoft.com/azure/virtual-machines/unmanaged-disks-deprecation\\\"\\r\\n    }\\r\\n,   {\\r\\n        \\\"Id\\\":5\\r\\n        ,\\\"ServiceName\\\":\\\"Azure Database for PostgreSQL\\\"\\r\\n        ,\\\"RetiringFeature\\\":\\\"Single server\\\"\\r\\n        ,\\\"RetirementDate\\\":\\\"2025-03-28\\\"\\r\\n        ,\\\"Link\\\": \\\"https://azure.microsoft.com/updates/azure-database-for-postgresql-single-server-will-be-retired-migrate-to-flexible-server-by-28-march-2025/\\\"\\r\\n    }\\r\\n,   {\\r\\n        \\\"Id\\\":6\\r\\n        ,\\\"ServiceName\\\":\\\"Azure Cache for Redis\\\"\\r\\n        ,\\\"RetiringFeature\\\":\\\"Version 4.x\\\"\\r\\n        ,\\\"RetirementDate\\\":\\\"2023-06-30\\\"\\r\\n        ,\\\"Link\\\": \\\"https://learn.microsoft.com/azure/azure-cache-for-redis/cache-retired-features\\\"\\r\\n    }\\r\\n,   {\\r\\n        \\\"Id\\\":7\\r\\n        ,\\\"ServiceName\\\":\\\"Azure Database for MySQL\\\"\\r\\n        ,\\\"RetiringFeature\\\":\\\"Single server\\\"\\r\\n        ,\\\"RetirementDate\\\":\\\"2024-09-16\\\"\\r\\n        ,\\\"Link\\\": \\\"https://learn.microsoft.com/azure/mysql/single-server/whats-happening-to-mysql-single-server\\\"\\r\\n    }\\r\\n,   {\\r\\n        \\\"Id\\\":8\\r\\n        ,\\\"ServiceName\\\":\\\"Azure Load Balancer\\\"\\r\\n        ,\\\"RetiringFeature\\\":\\\"Basic Load Balancer\\\"\\r\\n        ,\\\"RetirementDate\\\":\\\"2025-09-30\\\"\\r\\n        ,\\\"Link\\\": \\\"https://azure.microsoft.com/updates/azure-basic-load-balancer-will-be-retired-on-30-september-2025-upgrade-to-standard-load-balancer/\\\"\\r\\n    }\\r\\n,   {\\r\\n        \\\"Id\\\":9\\r\\n        ,\\\"ServiceName\\\":\\\"Azure Service Map\\\"\\r\\n        ,\\\"RetiringFeature\\\":\\\"Entire Service\\\"\\r\\n        ,\\\"RetirementDate\\\":\\\"2025-09-30\\\"\\r\\n        ,\\\"Link\\\": \\\"https://azure.microsoft.com/updates/migrate-to-azure-monitor-vm-insights-by-30-september-2025-when-service-map-will-be-retired/\\\"\\r\\n    }\\r\\n,   {\\r\\n        \\\"Id\\\":10\\r\\n        ,\\\"ServiceName\\\":\\\"Application Insights\\\"\\r\\n        ,\\\"RetiringFeature\\\":\\\"Classic\\\"\\r\\n        ,\\\"RetirementDate\\\":\\\"2024-02-29\\\"\\r\\n        ,\\\"Link\\\": \\\"https://azure.microsoft.com/updates/we-re-retiring-classic-application-insights-on-29-february-2024/\\\"\\r\\n    }\\r\\n,   {\\r\\n        \\\"Id\\\":11\\r\\n        ,\\\"ServiceName\\\":\\\"Azure Data Lake Analytics\\\"\\r\\n        ,\\\"RetiringFeature\\\":\\\"Entire Service\\\"\\r\\n        ,\\\"RetirementDate\\\":\\\"2024-02-29\\\"\\r\\n        ,\\\"Link\\\": \\\"https://azure.microsoft.com/updates/migrate-to-azure-synapse-analytics/\\\"\\r\\n    }\\r\\n,   {\\r\\n        \\\"Id\\\":12\\r\\n        ,\\\"ServiceName\\\":\\\"Storage Account\\\"\\r\\n        ,\\\"RetiringFeature\\\":\\\"Classic\\\"\\r\\n        ,\\\"RetirementDate\\\":\\\"2024-08-31\\\"\\r\\n        ,\\\"Link\\\": \\\"https://learn.microsoft.com/azure/storage/common/classic-account-migration-overview\\\"\\r\\n    }\\r\\n,   {\\r\\n        \\\"Id\\\":13\\r\\n        ,\\\"ServiceName\\\":\\\"Cloud service (classic)\\\"\\r\\n        ,\\\"RetiringFeature\\\":\\\"Classic\\\"\\r\\n        ,\\\"RetirementDate\\\":\\\"2024-08-31\\\"\\r\\n        ,\\\"Link\\\": \\\"https://learn.microsoft.com/azure/cloud-services-extended-support/in-place-migration-overview\\\"\\r\\n    }\\r\\n,   {\\r\\n        \\\"Id\\\":14\\r\\n        ,\\\"ServiceName\\\":\\\"Azure Database for PostgreSQL\\\"\\r\\n        ,\\\"RetiringFeature\\\":\\\"Single Server- Version 11\\\"\\r\\n        ,\\\"RetirementDate\\\":\\\"2024-11-09\\\"\\r\\n        ,\\\"Link\\\": \\\"https://azure.microsoft.com/updates/singlepg11-retirement\\\"\\r\\n    }\\r\\n,   {\\r\\n        \\\"Id\\\":15\\r\\n        ,\\\"ServiceName\\\":\\\"Azure Logic Apps\\\"\\r\\n        ,\\\"RetiringFeature\\\":\\\"Integration Services Environment (IES)\\\"\\r\\n        ,\\\"RetirementDate\\\":\\\"2024-08-31\\\"\\r\\n        ,\\\"Link\\\": \\\"https://azure.microsoft.com/updates/integration-services-environment-will-be-retired-on-31-august-2024-transition-to-logic-apps-standard/\\\"\\r\\n    }\\r\\n,   {\\r\\n        \\\"Id\\\":16\\r\\n        ,\\\"ServiceName\\\":\\\"Virtual Network\\\"\\r\\n        ,\\\"RetiringFeature\\\":\\\"Classic\\\"\\r\\n        ,\\\"RetirementDate\\\":\\\"2024-08-31\\\"\\r\\n        ,\\\"Link\\\": \\\"https://learn.microsoft.com/azure/virtual-network/migrate-classic-vnet-powershell\\\"\\r\\n    }\\r\\n,   {\\r\\n        \\\"Id\\\":17\\r\\n        ,\\\"ServiceName\\\":\\\"Azure Application Gateway\\\"\\r\\n        ,\\\"RetiringFeature\\\":\\\"V1\\\"\\r\\n        ,\\\"RetirementDate\\\":\\\"2026-04-28\\\"\\r\\n        ,\\\"Link\\\": \\\"https://learn.microsoft.com/azure/application-gateway/migrate-v1-v2\\\"\\r\\n    }\\r\\n,   {\\r\\n        \\\"Id\\\":18\\r\\n        ,\\\"ServiceName\\\":\\\"Virtual Machines\\\"\\r\\n        ,\\\"RetiringFeature\\\":\\\"NV and NV_Promo series\\\"\\r\\n        ,\\\"RetirementDate\\\":\\\"2023-08-31\\\"\\r\\n        ,\\\"Link\\\": \\\"https://learn.microsoft.com/azure/virtual-machines/nv-series-retirement\\\"\\r\\n    }\\r\\n    ,   {\\r\\n        \\\"Id\\\":19\\r\\n        ,\\\"ServiceName\\\":\\\"Azure Data Lake Storage\\\"\\r\\n        ,\\\"RetiringFeature\\\":\\\"Gen 1\\\"\\r\\n        ,\\\"RetirementDate\\\":\\\"2024-02-29\\\"\\r\\n        ,\\\"Link\\\": \\\"https://azure.microsoft.com/updates/action-required-switch-to-azure-data-lake-storage-gen2-by-29-february-2024/\\\"\\r\\n    }\\r\\n    ,   {\\r\\n        \\\"Id\\\":20\\r\\n        ,\\\"ServiceName\\\":\\\"Reserved IPs\\\"\\r\\n        ,\\\"RetiringFeature\\\":\\\"Classic\\\"\\r\\n        ,\\\"RetirementDate\\\":\\\"2024-08-31\\\"\\r\\n        ,\\\"Link\\\": \\\"https://learn.microsoft.com/azure/virtual-network/ip-services/public-ip-upgrade-classic\\\"\\r\\n    }\\r\\n    ,\\r\\n        {\\r\\n        \\\"Id\\\":21\\r\\n        ,\\\"ServiceName\\\":\\\"Network Security Group\\\"\\r\\n        ,\\\"RetiringFeature\\\":\\\"Classic\\\"\\r\\n        ,\\\"RetirementDate\\\":\\\"2024-08-31\\\"\\r\\n        ,\\\"Link\\\": \\\"https://azure.microsoft.com/updates/five-azure-classic-networking-services-will-be-retired-on-31-august-2024/\\\"\\r\\n    }\\r\\n    ,   \\r\\n        {\\r\\n        \\\"Id\\\":22\\r\\n        ,\\\"ServiceName\\\":\\\"Azure Cache for Redis\\\"\\r\\n        ,\\\"RetiringFeature\\\":\\\"Classic\\\"\\r\\n        ,\\\"RetirementDate\\\":\\\"2024-08-31\\\"\\r\\n        ,\\\"Link\\\": \\\"https://learn.microsoft.com/azure/azure-cache-for-redis/cache-faq\\\"\\r\\n    }\\r\\n\\t    ,   \\r\\n        {\\r\\n        \\\"Id\\\":31\\r\\n        ,\\\"ServiceName\\\":\\\"Azure Synapse Analytics\\\"\\r\\n        ,\\\"RetiringFeature\\\":\\\"Synapse Runtime for Apache Spark 2.4\\\"\\r\\n        ,\\\"RetirementDate\\\":\\\"2023-09-29\\\"\\r\\n        ,\\\"Link\\\": \\\"https://learn.microsoft.com/azure/synapse-analytics/spark/apache-spark-24-runtime\\\"\\r\\n    }\\r\\n\\t\\t    ,   \\r\\n        {\\r\\n        \\\"Id\\\":32\\r\\n        ,\\\"ServiceName\\\":\\\"Azure Synapse Analytics\\\"\\r\\n        ,\\\"RetiringFeature\\\":\\\"Synapse Runtime for Apache Spark 3.1\\\"\\r\\n        ,\\\"RetirementDate\\\":\\\"2024-01-26\\\"\\r\\n        ,\\\"Link\\\": \\\"https://learn.microsoft.com/azure/synapse-analytics/spark/apache-spark-3-runtime\\\"\\r\\n    }\\r\\n\\t,   \\r\\n        {\\r\\n        \\\"Id\\\":36\\r\\n        ,\\\"ServiceName\\\":\\\"Cognitive Services\\\"\\r\\n        ,\\\"RetiringFeature\\\":\\\"QnAMaker\\\"\\r\\n        ,\\\"RetirementDate\\\":\\\"2025-03-31\\\"\\r\\n        ,\\\"Link\\\": \\\"https://azure.microsoft.com/updates/azure-qna-maker-will-be-retired-on-31-march-2025/\\\"\\r\\n    }\\r\\n\\t\\t    ,   \\r\\n        {\\r\\n        \\\"Id\\\":37\\r\\n        ,\\\"ServiceName\\\":\\\"Virtual Machines\\\"\\r\\n        ,\\\"RetiringFeature\\\":\\\"NC-series\\\"\\r\\n        ,\\\"RetirementDate\\\":\\\"2023-08-31\\\"\\r\\n        ,\\\"Link\\\": \\\"https://azure.microsoft.com/updates/ncseries-azure-virtual-machines-retirement-extended-to-31-august-2023/\\\"\\r\\n    }\\r\\n\\t\\t    ,   \\r\\n        {\\r\\n        \\\"Id\\\":38\\r\\n        ,\\\"ServiceName\\\":\\\"Virtual Machines\\\"\\r\\n        ,\\\"RetiringFeature\\\":\\\"NC V2 series\\\"\\r\\n        ,\\\"RetirementDate\\\":\\\"2023-08-31\\\"\\r\\n        ,\\\"Link\\\": \\\"https://azure.microsoft.com/updates/nc-v2series-azure-virtual-machines-will-be-retired-by-31-august-2022/\\\"\\r\\n    }\\r\\n\\t\\t    ,   \\r\\n        {\\r\\n        \\\"Id\\\":39\\r\\n        ,\\\"ServiceName\\\":\\\"Virtual Machines\\\"\\r\\n        ,\\\"RetiringFeature\\\":\\\"ND-Series\\\"\\r\\n        ,\\\"RetirementDate\\\":\\\"2023-08-31\\\"\\r\\n        ,\\\"Link\\\": \\\"https://azure.microsoft.com/updates/ndseries-azure-virtual-machines-will-be-retired-by-31-august-2022/\\\"\\r\\n    }\\r\\n\\t\\t    ,   \\r\\n        {\\r\\n        \\\"Id\\\":40\\r\\n        ,\\\"ServiceName\\\":\\\"Virtual Machines\\\"\\r\\n        ,\\\"RetiringFeature\\\":\\\"HB-series\\\"\\r\\n        ,\\\"RetirementDate\\\":\\\"2024-08-31\\\"\\r\\n        ,\\\"Link\\\": \\\"https://learn.microsoft.com/azure/virtual-machines/hb-series-retirement\\\"\\r\\n    }\\r\\n\\t\\t    ,   \\r\\n        {\\r\\n        \\\"Id\\\":41\\r\\n        ,\\\"ServiceName\\\":\\\"Machine Learning Studio (classic)\\\"\\r\\n        ,\\\"RetiringFeature\\\":\\\"Entire service\\\"\\r\\n        ,\\\"RetirementDate\\\":\\\"2024-08-31\\\"\\r\\n        ,\\\"Link\\\": \\\"https://azure.microsoft.com/updates/machine-learning-studio-classic-will-retire-on-31-august-2024/\\\"\\r\\n    }\\r\\n\\t\\t    ,   \\r\\n        {\\r\\n        \\\"Id\\\":42\\r\\n        ,\\\"ServiceName\\\":\\\"Public IP address\\\"\\r\\n        ,\\\"RetiringFeature\\\":\\\"Basic Sku\\\"\\r\\n        ,\\\"RetirementDate\\\":\\\"2025-09-30\\\"\\r\\n        ,\\\"Link\\\": \\\"https://learn.microsoft.com/azure/virtual-network/ip-services/public-ip-basic-upgrade-guidance\\\" \\r\\n    }\\t    ,   \\r\\n        {\\r\\n        \\\"Id\\\":45\\r\\n        ,\\\"ServiceName\\\":\\\"Azure Database for PostgreSQL\\\"\\r\\n        ,\\\"RetiringFeature\\\":\\\"FlexibleServers- Version 11\\\"\\r\\n        ,\\\"RetirementDate\\\":\\\"2024-11-09\\\"\\r\\n        ,\\\"Link\\\": \\\"https://azure.microsoft.com/updates/flexpg11-retirement/\\\"\\r\\n    }\\t    ,   \\r\\n        {\\r\\n        \\\"Id\\\":46\\r\\n        ,\\\"ServiceName\\\":\\\"Azure Cosmos DB for PostgreSQL\\\"\\r\\n        ,\\\"RetiringFeature\\\":\\\"Version 11\\\"\\r\\n        ,\\\"RetirementDate\\\":\\\"2023-11-09\\\"\\r\\n        ,\\\"Link\\\": \\\"https://azure.microsoft.com/updates/hyperscalecitus-pg11/\\\"\\r\\n    }\\r\\n    ,   \\r\\n        {\\r\\n        \\\"Id\\\":43\\r\\n        ,\\\"ServiceName\\\":\\\"Cognitive Services\\\"\\r\\n        ,\\\"RetiringFeature\\\":\\\"Language Understanding (LUIS)\\\"\\r\\n        ,\\\"RetirementDate\\\":\\\"2025-09-30\\\"\\r\\n        ,\\\"Link\\\": \\\"https://azure.microsoft.com/updates/language-understanding-retirement/\\\"\\r\\n    }\\r\\n\\t,   \\r\\n        {\\r\\n        \\\"Id\\\":44\\r\\n        ,\\\"ServiceName\\\":\\\"Azure Time Series Insights\\\"\\r\\n        ,\\\"RetiringFeature\\\":\\\"Entire service\\\"\\r\\n        ,\\\"RetirementDate\\\":\\\"2025-03-31\\\"\\r\\n        ,\\\"Link\\\": \\\"https://azure.microsoft.com/updates/we-ll-retire-azure-time-series-insights-on-31-of-march-2025/\\\"\\r\\n    }\\r\\n\\t,\\r\\n\\t{\\r\\n        \\\"Id\\\":49\\r\\n        ,\\\"ServiceName\\\":\\\"Virtual Machines\\\"\\r\\n        ,\\\"RetiringFeature\\\":\\\"Azure Dedicated Host SKUs (Dsv3-Type1, Esv3-Type1, Dsv3-Type2, Esv3-Type2)\\\"\\r\\n        ,\\\"RetirementDate\\\":\\\"2023-06-30\\\"\\r\\n        ,\\\"Link\\\": \\\"https://learn.microsoft.com/azure/virtual-machines/dedicated-host-retirement\\\"\\r\\n    }\\r\\n\\t,\\r\\n\\t\\t{\\r\\n        \\\"Id\\\":50\\r\\n        ,\\\"ServiceName\\\":\\\"Azure Media Services\\\"\\r\\n        ,\\\"RetiringFeature\\\":\\\"Entire service\\\"\\r\\n        ,\\\"RetirementDate\\\":\\\"2024-06-30\\\"\\r\\n        ,\\\"Link\\\": \\\"https://learn.microsoft.com/azure/media-services/latest/azure-media-services-retirement\\\"\\r\\n    }\\r\\n]\\r\\n\\r\\n\",\"transformers\":null}",
        "size": 1,
        "queryType": 8,
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "RetirementDate",
              "formatter": 6,
              "formatOptions": {
                "customColumnWidthSetting": "20ch"
              },
              "dateFormat": {
                "showUtcTime": true,
                "formatName": "shortDatePattern"
              }
            }
          ],
          "sortBy": [
            {
              "itemKey": "Id",
              "sortOrder": 1
            }
          ]
        },
        "sortBy": [
          {
            "itemKey": "Id",
            "sortOrder": 1
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "showtable",
        "comparison": "isEqualTo",
        "value": "show"
      },
      "name": "MasterData"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "resources\r\n| extend ServiceID= case(\r\ntype contains \"microsoft.compute/virtualmachine\" and  (tostring(properties.hardwareProfile.vmSize) in~ ('basic_a0','basic_a1','basic_a2','basic_a3','basic_a4','standard_a0','standard_a1','standard_a2','standard_a3','standard_a4','standard_a5','standard_a6','standard_a7','standard_a9')  or tostring(sku.name) in~ ('basic_a0','basic_a1','basic_a2','basic_a3','basic_a4','standard_a0','standard_a1','standard_a2','standard_a3','standard_a4','standard_a5','standard_a6','standard_a7','standard_a9')),1\r\n,type contains \"virtualmachine\" and type contains \"classic\",2\r\n,type == \"microsoft.web/hostingenvironments\" and kind in ('ASEV1','ASEV2'),3\r\n,type == \"microsoft.compute/virtualmachines\" and isempty(properties.storageProfile.osDisk.managedDisk),4\r\n,type == \"microsoft.dbforpostgresql/servers\" ,5\r\n,type == \"microsoft.cache/redis\" and properties.redisVersion=='4.0',6\r\n,type == \"microsoft.dbformysql/servers\"  ,7\r\n,type == \"microsoft.network/loadbalancers\" and sku.name=='Basic',8\r\n,type == \"microsoft.operationsmanagement/solutions\" and plan.product=='OMSGallery/ServiceMap',9\r\n,type == \"microsoft.insights/components\" and isempty(properties.WorkspaceResourceId) ,10\r\n,type == 'microsoft.datalakeanalytics/accounts' and not(location in ('westcentralus','westus2','westus3')) and properties contains 'defaultDataLakeStoreAccount', 11\r\n,type == 'microsoft.classicstorage/storageaccounts',12\r\n,type == 'microsoft.classiccompute/domainnames', 13\r\n,type == \"microsoft.dbforpostgresql/servers\" and properties.version == \"11\",14\r\n,type == \"microsoft.logic/integrationserviceenvironments\",15\r\n,type == 'microsoft.classicnetwork/virtualnetworks',16\r\n,type == \"microsoft.network/applicationgateways\" and properties.sku.tier in~ ('Standard','WAF'),17\r\n,type contains \"microsoft.compute/virtualmachine\" and  (tostring(properties.hardwareProfile.vmSize) in~ ('Standard_NV12','Standard_NV12_Promo','Standard_NV24','Standard_NV24_Promo','Standard_NV6','Standard_NV6_Promo')  or tostring(sku.name) in~ ('Standard_NV12','Standard_NV12_Promo','Standard_NV24','Standard_NV24_Promo','Standard_NV6','Standard_NV6_Promo')) ,18\r\n,type == \"microsoft.datalakestore/accounts\" and not(location in ('westcentralus','westus2')),19\r\n,type == 'microsoft.classicnetwork/reservedips',20\r\n,type == 'microsoft.classicnetwork/networksecuritygroups',21\r\n,type =~ 'Microsoft.CognitiveServices/accounts' and kind=~'QnAMaker',36\r\n,type contains \"microsoft.compute/virtualmachine\" and  (tostring(properties.hardwareProfile.vmSize) in~ ('Standard_NC6','Standard_NC6_Promo','Standard_NC12','Standard_NC12_Promo','Standard_NC24','Standard_NC24_Promo','Standard_NC24r','Standard_NC24r_Promo')  or tostring(sku.name) in~ ('Standard_NC6','Standard_NC6_Promo','Standard_NC12','Standard_NC12_Promo','Standard_NC24','Standard_NC24_Promo','Standard_NC24r','Standard_NC24r_Promo')) ,37\r\n,type contains \"microsoft.compute/virtualmachine\" and  (tostring(properties.hardwareProfile.vmSize) in~ ('Standard_NC6s_v2','Standard_NC12s_v2','Standard_NC24s_v2','Standard_NC24rs_v2')  or tostring(sku.name) in~ ('Standard_NC6s_v2','Standard_NC12s_v2','Standard_NC24s_v2','Standard_NC24rs_v2')) ,38\r\n,type contains \"microsoft.compute/virtualmachine\" and  (tostring(properties.hardwareProfile.vmSize) in~ ('Standard_ND6','Standard_ND12','Standard_ND24','Standard_ND24r')  or tostring(sku.name) in~ ('Standard_ND6','Standard_ND12','Standard_ND24','Standard_ND24r')) ,39\r\n,type contains \"microsoft.compute/virtualmachine\" and  (tostring(properties.hardwareProfile.vmSize) in~ ('Standard_HB60rs','Standard_HB60-45rs','Standard_HB60-30rs','Standard_HB60-15rs')  or tostring(sku.name) in~ ('Standard_HB60rs','Standard_HB60-45rs','Standard_HB60-30rs','Standard_HB60-15rs')) ,40\r\n,type contains \"Microsoft.MachineLearning/\",41\r\n,type =~ \"Microsoft.Network/publicIPAddresses\" and sku.name=='Basic',42\r\n,type =~ 'Microsoft.CognitiveServices/accounts' and kind contains 'LUIS',43\r\n,type contains 'Microsoft.TimeSeriesInsights',44\r\n,type =~ \"microsoft.dbforpostgresql/servers\" and properties.version == \"11\",45\r\n,type =~ \"Microsoft.DBforPostgreSQL/serverGroupsv2\" and properties.postgresqlVersion==11,46\r\n,type =~ \"microsoft.compute/hostgroups/hosts\" and toupper(sku.name) in~ (\"DSV3-TYPE1\",\"DSV3-TYPE2\",\"ESV3-TYPE1\",\"ESV3-TYPE2\"),49\r\n,type contains \"microsoft.media/mediaservices\",50\r\n,-9999)\r\n| where ServiceID >0\r\n| project ServiceID , id, resourceGroup, location\r\n|union \r\n// Query for Classic Redis caches retired\r\n(\r\n    AdvisorResources\r\n    | where type =='microsoft.advisor/recommendations'\r\n    | where properties.shortDescription contains 'Cloud service caches are being retired'\r\n    | project id=tolower(tostring(properties.resourceMetadata.resourceId))\r\n    | join \r\n    (\r\n        resources\r\n        | where type contains 'microsoft.cache/redis'\r\n        | project id=tolower(id), resourceGroup, location\r\n    ) on id\r\n    | project ServiceID=22 , id, resourceGroup, location \r\n)\r\n|union \r\n// Query for synapse Runtime for Apache Spark 2.4 and 3.1\r\n(\r\n    Resources\r\n    | where type == \"microsoft.synapse/workspaces/bigdatapools\"  and todouble(properties.sparkVersion) in (2.4,3.1)\r\n    | extend workspaceId = tostring(split(id,'/')[8]) \r\n    | join kind=leftouter\r\n    (\r\n        Resources\r\n        | where type == \"microsoft.synapse/workspaces\" and properties.adlaResourceId == \"\"\r\n        | project workspaceId = name, adla=1\r\n    ) on workspaceId\r\n    | where adla==1\r\n    | project ServiceID = iff (todouble(properties.sparkVersion)==2.4,31,32),id, resourceGroup, location\r\n)\r\n| where ('*' in (dynamic([{ResourceGroup}])) or resourceGroup in (dynamic([{ResourceGroup}]))) \r\n| where ('*' in (dynamic([{Region}])) or location in (dynamic([{Region}])))\r\n| summarize ResourceCount=count() by ServiceID",
        "size": 4,
        "exportFieldName": "Name",
        "exportParameterName": "ResourceInSelectedService",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "{SubscriptionId}"
        ],
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "RetirementAnnouncementDetails",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "Url",
                "linkLabel": "Click here"
              }
            },
            {
              "columnMatch": "Link",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "Url",
                "linkLabel": "Click here"
              }
            }
          ],
          "sortBy": [
            {
              "itemKey": "ServiceID",
              "sortOrder": 1
            }
          ]
        },
        "sortBy": [
          {
            "itemKey": "ServiceID",
            "sortOrder": 1
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "ShowData",
        "comparison": "isEqualTo",
        "value": "Show"
      },
      "customWidth": "100",
      "name": "ResourceCount"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"6d0dff21-0ef8-414e-bf72-7e5e95d7f024\",\"mergeType\":\"innerunique\",\"leftTable\":\"MasterData\",\"rightTable\":\"ResourceCount\",\"leftColumn\":\"Id\",\"rightColumn\":\"ServiceID\"}],\"projectRename\":[{\"originalName\":\"[MasterData].Category\",\"mergedName\":\"Category\",\"fromId\":\"unknown\"},{\"originalName\":\"[MasterData].ServiceName\",\"mergedName\":\"ServiceName\",\"fromId\":\"6d0dff21-0ef8-414e-bf72-7e5e95d7f024\"},{\"originalName\":\"[MasterData].RetiringFeature\",\"mergedName\":\"RetiringFeature\",\"fromId\":\"unknown\"},{\"originalName\":\"[MasterData].RetirementDate\",\"mergedName\":\"RetirementDate\",\"fromId\":\"6d0dff21-0ef8-414e-bf72-7e5e95d7f024\"},{\"originalName\":\"[ResourceCount].ResourceCount\",\"mergedName\":\"ResourceCount\",\"fromId\":\"6d0dff21-0ef8-414e-bf72-7e5e95d7f024\"},{\"originalName\":\"[MasterData].Link\",\"mergedName\":\"Link\",\"fromId\":\"6d0dff21-0ef8-414e-bf72-7e5e95d7f024\"},{\"originalName\":\"[MasterData].Id\",\"mergedName\":\"Id\",\"fromId\":\"6d0dff21-0ef8-414e-bf72-7e5e95d7f024\"},{\"originalName\":\"[ResourceCount].ServiceID\",\"mergedName\":\"ServiceID\",\"fromId\":\"6d0dff21-0ef8-414e-bf72-7e5e95d7f024\"}]}",
        "size": 2,
        "title": "Retiring Azure services (ðŸ’¡Select services to see affected resources and more details)",
        "noDataMessage": "This workbook has not identified any resources affected by an upcoming service retirement",
        "showRefreshButton": true,
        "exportMultipleValues": true,
        "exportedParameters": [
          {
            "fieldName": "ServiceID",
            "parameterName": "SelectedServiceId",
            "parameterType": 1,
            "quote": ""
          }
        ],
        "showExportToExcel": true,
        "queryType": 7,
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "ServiceName",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "30ch"
              }
            },
            {
              "columnMatch": "RetiringFeature",
              "formatter": 1,
              "formatOptions": {
                "linkColumn": "Link",
                "linkTarget": "Url",
                "customColumnWidthSetting": "33ch"
              }
            },
            {
              "columnMatch": "RetirementDate",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "contains",
                    "thresholdValue": "2023",
                    "representation": "Sev0",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "Blank",
                    "text": "{0}{1}"
                  }
                ],
                "customColumnWidthSetting": "20ch"
              },
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal"
                }
              },
              "dateFormat": {
                "showUtcTime": true,
                "formatName": "shortDatePattern"
              }
            },
            {
              "columnMatch": "ResourceCount",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "<",
                    "thresholdValue": "100",
                    "representation": "Sev2",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": ">=",
                    "thresholdValue": "100",
                    "representation": "Sev1",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "Blank",
                    "text": "{0}{1}"
                  }
                ],
                "compositeBarSettings": {
                  "labelText": "",
                  "columnSettings": [
                    {
                      "columnName": "RetirementDate",
                      "color": "blue"
                    }
                  ]
                },
                "customColumnWidthSetting": "17ch"
              }
            },
            {
              "columnMatch": "Link",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "Url",
                "linkLabel": "Learn more",
                "customColumnWidthSetting": "12ch"
              }
            },
            {
              "columnMatch": "Id",
              "formatter": 5
            },
            {
              "columnMatch": "ServiceID",
              "formatter": 5
            },
            {
              "columnMatch": "Category",
              "formatter": 5
            }
          ],
          "filter": true,
          "sortBy": [
            {
              "itemKey": "$gen_thresholds_RetirementDate_2",
              "sortOrder": 1
            }
          ],
          "labelSettings": [
            {
              "columnId": "ServiceName",
              "label": "Service Name"
            },
            {
              "columnId": "RetiringFeature",
              "label": "Retiring Feature"
            },
            {
              "columnId": "RetirementDate",
              "label": "Retirement Date"
            },
            {
              "columnId": "ResourceCount",
              "label": "# Resources"
            },
            {
              "columnId": "Link",
              "label": "Actions"
            }
          ]
        },
        "sortBy": [
          {
            "itemKey": "$gen_thresholds_RetirementDate_2",
            "sortOrder": 1
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "FullList",
        "comparison": "isEqualTo",
        "value": "Yes"
      },
      "customWidth": "57",
      "name": "Summary view with inner join"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"6d0dff21-0ef8-414e-bf72-7e5e95d7f024\",\"mergeType\":\"leftouter\",\"leftTable\":\"MasterData\",\"rightTable\":\"ResourceCount\",\"leftColumn\":\"Id\",\"rightColumn\":\"ServiceID\"}],\"projectRename\":[{\"originalName\":\"[MasterData].Category\",\"mergedName\":\"Category\",\"fromId\":\"unknown\"},{\"originalName\":\"[MasterData].ServiceName\",\"mergedName\":\"ServiceName\",\"fromId\":\"6d0dff21-0ef8-414e-bf72-7e5e95d7f024\"},{\"originalName\":\"[MasterData].RetiringFeature\",\"mergedName\":\"RetiringFeature\",\"fromId\":\"unknown\"},{\"originalName\":\"[MasterData].RetirementDate\",\"mergedName\":\"RetirementDate\",\"fromId\":\"6d0dff21-0ef8-414e-bf72-7e5e95d7f024\"},{\"originalName\":\"[ResourceCount].ResourceCount\",\"mergedName\":\"ResourceCount\",\"fromId\":\"6d0dff21-0ef8-414e-bf72-7e5e95d7f024\"},{\"originalName\":\"[MasterData].Link\",\"mergedName\":\"Link\",\"fromId\":\"6d0dff21-0ef8-414e-bf72-7e5e95d7f024\"},{\"originalName\":\"[ResourceCount].ServiceID\",\"mergedName\":\"ServiceID\",\"fromId\":\"6d0dff21-0ef8-414e-bf72-7e5e95d7f024\"},{\"originalName\":\"[MasterData].Id\",\"mergedName\":\"Id\",\"fromId\":\"6d0dff21-0ef8-414e-bf72-7e5e95d7f024\"},{\"originalName\":\"[MasterData].Recommendation\"}]}",
        "size": 2,
        "title": "Retiring Azure services (ðŸ’¡Select services to see affected resources and more details)",
        "noDataMessage": "This workbook has not identified any resources affected by an upcoming service retirement",
        "showRefreshButton": true,
        "exportMultipleValues": true,
        "exportedParameters": [
          {
            "fieldName": "Id",
            "parameterName": "SelectedServiceId",
            "parameterType": 1,
            "quote": ""
          }
        ],
        "showExportToExcel": true,
        "queryType": 7,
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "ServiceName",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "30ch"
              }
            },
            {
              "columnMatch": "RetiringFeature",
              "formatter": 1,
              "formatOptions": {
                "linkColumn": "Link",
                "linkTarget": "Url",
                "customColumnWidthSetting": "33ch"
              }
            },
            {
              "columnMatch": "RetirementDate",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "contains",
                    "thresholdValue": "2023",
                    "representation": "Sev0",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "Blank",
                    "text": "{0}{1}"
                  }
                ],
                "customColumnWidthSetting": "20ch"
              },
              "dateFormat": {
                "showUtcTime": true,
                "formatName": "shortDatePattern"
              }
            },
            {
              "columnMatch": "ResourceCount",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "0",
                    "representation": "success",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "<",
                    "thresholdValue": "100",
                    "representation": "Sev2",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": ">=",
                    "thresholdValue": "100",
                    "representation": "Sev1",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "Blank",
                    "text": "{0}{1}"
                  }
                ],
                "customColumnWidthSetting": "17ch"
              },
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal"
                },
                "emptyValCustomText": "None"
              }
            },
            {
              "columnMatch": "Link",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "Url",
                "linkLabel": "Learn more",
                "customColumnWidthSetting": "12ch"
              }
            },
            {
              "columnMatch": "ServiceID",
              "formatter": 5
            },
            {
              "columnMatch": "Id",
              "formatter": 5
            },
            {
              "columnMatch": "Category",
              "formatter": 5
            }
          ],
          "filter": true,
          "sortBy": [
            {
              "itemKey": "$gen_thresholds_RetirementDate_2",
              "sortOrder": 1
            }
          ],
          "labelSettings": [
            {
              "columnId": "ServiceName",
              "label": "Service Name"
            },
            {
              "columnId": "RetiringFeature",
              "label": "Retiring Feature"
            },
            {
              "columnId": "RetirementDate",
              "label": "Retirement Date"
            },
            {
              "columnId": "ResourceCount",
              "label": "# Resources"
            },
            {
              "columnId": "Link",
              "label": "Actions"
            }
          ]
        },
        "sortBy": [
          {
            "itemKey": "$gen_thresholds_RetirementDate_2",
            "sortOrder": 1
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "FullList",
        "comparison": "isEqualTo",
        "value": "No"
      },
      "customWidth": "57",
      "name": "Summary view with left join"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "resources\r\n| extend ServiceID= case(\r\ntype contains \"microsoft.compute/virtualmachine\" and  (tostring(properties.hardwareProfile.vmSize) in~ ('basic_a0','basic_a1','basic_a2','basic_a3','basic_a4','standard_a0','standard_a1','standard_a2','standard_a3','standard_a4','standard_a5','standard_a6','standard_a7','standard_a9')  or tostring(sku.name) in~ ('basic_a0','basic_a1','basic_a2','basic_a3','basic_a4','standard_a0','standard_a1','standard_a2','standard_a3','standard_a4','standard_a5','standard_a6','standard_a7','standard_a9')),1\r\n,type contains \"virtualmachine\" and type contains \"classic\",2\r\n,type == \"microsoft.web/hostingenvironments\" and kind in ('ASEV1','ASEV2'),3\r\n,type == \"microsoft.compute/virtualmachines\" and isempty(properties.storageProfile.osDisk.managedDisk),4\r\n,type == \"microsoft.dbforpostgresql/servers\" ,5\r\n,type == \"microsoft.cache/redis\" and properties.redisVersion=='4.0',6\r\n,type == \"microsoft.dbformysql/servers\"  ,7\r\n,type == \"microsoft.network/loadbalancers\" and sku.name=='Basic',8\r\n,type == \"microsoft.operationsmanagement/solutions\" and plan.product=='OMSGallery/ServiceMap',9\r\n,type == \"microsoft.insights/components\" and isempty(properties.WorkspaceResourceId) ,10\r\n,type == 'microsoft.datalakeanalytics/accounts' and not(location in ('westcentralus','westus2','westus3')) and properties contains 'defaultDataLakeStoreAccount', 11\r\n,type == 'microsoft.classicstorage/storageaccounts',12\r\n,type == 'microsoft.classiccompute/domainnames', 13\r\n,type == \"microsoft.dbforpostgresql/servers\" and properties.version == \"11\",14\r\n,type == \"microsoft.logic/integrationserviceenvironments\",15\r\n,type == 'microsoft.classicnetwork/virtualnetworks',16\r\n,type == \"microsoft.network/applicationgateways\" and properties.sku.tier in~ ('Standard','WAF'),17\r\n,type contains \"microsoft.compute/virtualmachine\" and   (tostring(properties.hardwareProfile.vmSize) in~ ('Standard_NV12','Standard_NV12_Promo','Standard_NV24','Standard_NV24_Promo','Standard_NV6','Standard_NV6_Promo')  or tostring(sku.name) in~ ('Standard_NV12','Standard_NV12_Promo','Standard_NV24','Standard_NV24_Promo','Standard_NV6','Standard_NV6_Promo')) ,18\r\n,type == \"microsoft.datalakestore/accounts\" and not(location in ('westcentralus','westus2')) ,19\r\n,type == 'microsoft.classicnetwork/reservedips',20\r\n,type == 'microsoft.classicnetwork/networksecuritygroups',21\r\n,type =~ 'Microsoft.CognitiveServices/accounts' and kind=~'QnAMaker',36\r\n,type contains \"microsoft.compute/virtualmachine\" and  (tostring(properties.hardwareProfile.vmSize) in~ ('Standard_NC6','Standard_NC6_Promo','Standard_NC12','Standard_NC12_Promo','Standard_NC24','Standard_NC24_Promo','Standard_NC24r','Standard_NC24r_Promo')  or tostring(sku.name) in~ ('Standard_NC6','Standard_NC6_Promo','Standard_NC12','Standard_NC12_Promo','Standard_NC24','Standard_NC24_Promo','Standard_NC24r','Standard_NC24r_Promo')) ,37\r\n,type contains \"microsoft.compute/virtualmachine\" and  (tostring(properties.hardwareProfile.vmSize) in~ ('Standard_NC6s_v2','Standard_NC12s_v2','Standard_NC24s_v2','Standard_NC24rs_v2')  or tostring(sku.name) in~ ('Standard_NC6s_v2','Standard_NC12s_v2','Standard_NC24s_v2','Standard_NC24rs_v2')) ,38\r\n,type contains \"microsoft.compute/virtualmachine\" and  (tostring(properties.hardwareProfile.vmSize) in~ ('Standard_ND6','Standard_ND12','Standard_ND24','Standard_ND24r')  or tostring(sku.name) in~ ('Standard_ND6','Standard_ND12','Standard_ND24','Standard_ND24r')) ,39\r\n,type contains \"microsoft.compute/virtualmachine\" and  (tostring(properties.hardwareProfile.vmSize) in~ ('Standard_HB60rs','Standard_HB60-45rs','Standard_HB60-30rs','Standard_HB60-15rs')  or tostring(sku.name) in~ ('Standard_HB60rs','Standard_HB60-45rs','Standard_HB60-30rs','Standard_HB60-15rs')) ,40\r\n,type contains \"Microsoft.MachineLearning/\",41\r\n,type =~ \"Microsoft.Network/publicIPAddresses\" and sku.name=='Basic',42\r\n,type =~ 'Microsoft.CognitiveServices/accounts' and kind contains 'LUIS',43\r\n,type contains 'Microsoft.TimeSeriesInsights',44\r\n,type =~ \"microsoft.dbforpostgresql/servers\" and properties.version == \"11\",45\r\n,type =~ \"Microsoft.DBforPostgreSQL/serverGroupsv2\" and properties.postgresqlVersion==11,46\r\n,type =~ \"microsoft.compute/hostgroups/hosts\" and toupper(sku.name) in~ (\"DSV3-TYPE1\",\"DSV3-TYPE2\",\"ESV3-TYPE1\",\"ESV3-TYPE2\"),49\r\n,type contains \"microsoft.media/mediaservices\",50\r\n,-9999)\r\n| where ServiceID >0\r\n| project ServiceID , location, id , resourceGroup\r\n|union \r\n// Query for Classic Redis caches retired\r\n(AdvisorResources\r\n| where type =='microsoft.advisor/recommendations'\r\n| where properties.shortDescription contains 'Cloud service caches are being retired'\r\n| project id=tolower(tostring(properties.resourceMetadata.resourceId))\r\n| join \r\n(resources\r\n| where type contains 'microsoft.cache/redis'\r\n| project id=tolower(id), location, resourceGroup\r\n) on id\r\n| project ServiceID=22 ,location, id, resourceGroup )\r\n|union \r\n// Query for synapse Runtime for Apache Spark 2.4 and 3.1\r\n(Resources\r\n    | where type == \"microsoft.synapse/workspaces/bigdatapools\"  and todouble(properties.sparkVersion) in (2.4,3.1)\r\n    | extend workspaceId = tostring(split(id,'/')[8]) \r\n    | join kind=leftouter\r\n    (\r\n            Resources\r\n            | where type == \"microsoft.synapse/workspaces\" and properties.adlaResourceId == \"\"\r\n            | project workspaceId = name, adla=1\r\n        ) on workspaceId\r\n| where adla==1\r\n| project  ServiceID = iff (todouble(properties.sparkVersion)==2.4,31,32), location,id, resourceGroup\r\n)\r\n| where ('*' in (dynamic([{ResourceGroup}])) or resourceGroup in (dynamic([{ResourceGroup}]))) \r\n| where ('*' in (dynamic([{Region}])) or location in (dynamic([{Region}])))\r\n| where array_length(dynamic([{SelectedServiceId}])) == 0 or ServiceID in (dynamic([{SelectedServiceId}])) \r\n| summarize ResourceCount = count() by Region=location",
        "size": 0,
        "title": "Resource count by region",
        "noDataMessage": "This workbook has not identified any resources affected by an upcoming service retirement",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "{SubscriptionId}"
        ],
        "visualization": "map",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "ResourceCount",
              "formatter": 3,
              "formatOptions": {
                "palette": "blue"
              }
            }
          ],
          "sortBy": [
            {
              "itemKey": "$gen_bar_ResourceCount_1",
              "sortOrder": 2
            }
          ]
        },
        "sortBy": [
          {
            "itemKey": "$gen_bar_ResourceCount_1",
            "sortOrder": 2
          }
        ],
        "tileSettings": {
          "showBorder": false,
          "titleContent": {
            "columnMatch": "Region",
            "formatter": 1
          },
          "leftContent": {
            "columnMatch": "ResourceCount",
            "formatter": 12,
            "formatOptions": {
              "palette": "auto"
            },
            "numberFormat": {
              "unit": 17,
              "options": {
                "maximumSignificantDigits": 3,
                "maximumFractionDigits": 2
              }
            }
          }
        },
        "graphSettings": {
          "type": 0,
          "topContent": {
            "columnMatch": "Region",
            "formatter": 1
          },
          "centerContent": {
            "columnMatch": "ResourceCount",
            "formatter": 1,
            "numberFormat": {
              "unit": 17,
              "options": {
                "maximumSignificantDigits": 3,
                "maximumFractionDigits": 2
              }
            }
          }
        },
        "chartSettings": {
          "group": "Region",
          "createOtherGroup": 7
        },
        "mapSettings": {
          "locInfo": "AzureLoc",
          "locInfoColumn": "Region",
          "latitude": "Region",
          "longitude": "Region",
          "sizeSettings": "ResourceCount",
          "sizeAggregation": "Sum",
          "legendMetric": "ResourceCount",
          "numberOfMetrics": 10,
          "legendAggregation": "Sum",
          "itemColorSettings": {
            "nodeColorField": "ResourceCount",
            "colorAggregation": "Sum",
            "type": "heatmap",
            "heatmapPalette": "yellowOrangeRed"
          },
          "numberFormatSettings": {
            "unit": 0,
            "options": {
              "style": "decimal"
            }
          }
        }
      },
      "customWidth": "43",
      "name": "ResourceCountByLocation"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "resources\r\n| extend ServiceID= case(\r\ntype contains \"microsoft.compute/virtualmachine\" and  (tostring(properties.hardwareProfile.vmSize) in~ ('basic_a0','basic_a1','basic_a2','basic_a3','basic_a4','standard_a0','standard_a1','standard_a2','standard_a3','standard_a4','standard_a5','standard_a6','standard_a7','standard_a9')  or tostring(sku.name) in~ ('basic_a0','basic_a1','basic_a2','basic_a3','basic_a4','standard_a0','standard_a1','standard_a2','standard_a3','standard_a4','standard_a5','standard_a6','standard_a7','standard_a9')),1\r\n,type contains \"virtualmachine\" and type contains \"classic\",2\r\n,type == \"microsoft.web/hostingenvironments\" and kind in ('ASEV1','ASEV2'),3\r\n,type == \"microsoft.compute/virtualmachines\" and isempty(properties.storageProfile.osDisk.managedDisk),4\r\n,type == \"microsoft.dbforpostgresql/servers\" ,5\r\n,type == \"microsoft.cache/redis\" and properties.redisVersion=='4.0',6\r\n,type == \"microsoft.dbformysql/servers\"  ,7\r\n,type == \"microsoft.network/loadbalancers\" and sku.name=='Basic',8\r\n,type == \"microsoft.operationsmanagement/solutions\" and plan.product=='OMSGallery/ServiceMap',9\r\n,type == \"microsoft.insights/components\" and isempty(properties.WorkspaceResourceId) ,10\r\n,type == 'microsoft.datalakeanalytics/accounts' and not(location in ('westcentralus','westus2','westus3')) and properties contains 'defaultDataLakeStoreAccount', 11\r\n,type == 'microsoft.classicstorage/storageaccounts',12\r\n,type == 'microsoft.classiccompute/domainnames', 13\r\n,type == \"microsoft.dbforpostgresql/servers\" and properties.version == \"11\",14\r\n,type == \"microsoft.logic/integrationserviceenvironments\",15\r\n,type == 'microsoft.classicnetwork/virtualnetworks',16\r\n,type == \"microsoft.network/applicationgateways\" and properties.sku.tier in~ ('Standard','WAF'),17\r\n,type contains \"microsoft.compute/virtualmachine\" and   (tostring(properties.hardwareProfile.vmSize) in~ ('Standard_NV12','Standard_NV12_Promo','Standard_NV24','Standard_NV24_Promo','Standard_NV6','Standard_NV6_Promo')  or tostring(sku.name) in~ ('Standard_NV12','Standard_NV12_Promo','Standard_NV24','Standard_NV24_Promo','Standard_NV6','Standard_NV6_Promo')) ,18\r\n,type == \"microsoft.datalakestore/accounts\" and not(location in ('westcentralus','westus2')) ,19\r\n,type == 'microsoft.classicnetwork/reservedips',20\r\n,type == 'microsoft.classicnetwork/networksecuritygroups',21\r\n,type =~ 'Microsoft.CognitiveServices/accounts' and kind=~'QnAMaker',36\r\n,type contains \"microsoft.compute/virtualmachine\" and  (tostring(properties.hardwareProfile.vmSize) in~ ('Standard_NC6','Standard_NC6_Promo','Standard_NC12','Standard_NC12_Promo','Standard_NC24','Standard_NC24_Promo','Standard_NC24r','Standard_NC24r_Promo')  or tostring(sku.name) in~ ('Standard_NC6','Standard_NC6_Promo','Standard_NC12','Standard_NC12_Promo','Standard_NC24','Standard_NC24_Promo','Standard_NC24r','Standard_NC24r_Promo')) ,37\r\n,type contains \"microsoft.compute/virtualmachine\" and  (tostring(properties.hardwareProfile.vmSize) in~ ('Standard_NC6s_v2','Standard_NC12s_v2','Standard_NC24s_v2','Standard_NC24rs_v2')  or tostring(sku.name) in~ ('Standard_NC6s_v2','Standard_NC12s_v2','Standard_NC24s_v2','Standard_NC24rs_v2')) ,38\r\n,type contains \"microsoft.compute/virtualmachine\" and  (tostring(properties.hardwareProfile.vmSize) in~ ('Standard_ND6','Standard_ND12','Standard_ND24','Standard_ND24r')  or tostring(sku.name) in~ ('Standard_ND6','Standard_ND12','Standard_ND24','Standard_ND24r')) ,39\r\n,type contains \"microsoft.compute/virtualmachine\" and  (tostring(properties.hardwareProfile.vmSize) in~ ('Standard_HB60rs','Standard_HB60-45rs','Standard_HB60-30rs','Standard_HB60-15rs')  or tostring(sku.name) in~ ('Standard_HB60rs','Standard_HB60-45rs','Standard_HB60-30rs','Standard_HB60-15rs')) ,40\r\n,type contains \"Microsoft.MachineLearning/\",41\r\n,type =~ \"Microsoft.Network/publicIPAddresses\" and sku.name=='Basic',42\r\n,type =~ 'Microsoft.CognitiveServices/accounts' and kind contains 'LUIS',43\r\n,type contains 'Microsoft.TimeSeriesInsights',44\r\n,type =~ \"microsoft.dbforpostgresql/servers\" and properties.version == \"11\",45\r\n,type =~ \"Microsoft.DBforPostgreSQL/serverGroupsv2\" and properties.postgresqlVersion==11,46\r\n,type =~ \"microsoft.compute/hostgroups/hosts\" and toupper(sku.name) in~ (\"DSV3-TYPE1\",\"DSV3-TYPE2\",\"ESV3-TYPE1\",\"ESV3-TYPE2\"),49\r\n,type contains \"microsoft.media/mediaservices\",50\r\n,-9999)\r\n| where ServiceID >0\r\n| project ServiceID , subscriptionId,type, resourceGroup, location, id , tags\r\n|union \r\n// Query for Classic Redis caches retired\r\n(AdvisorResources\r\n| where type =='microsoft.advisor/recommendations'\r\n| where properties.shortDescription contains 'Cloud service caches are being retired in August 2024'\r\n| project id=tolower(tostring(properties.resourceMetadata.resourceId))\r\n| join \r\n(resources\r\n| where type contains 'microsoft.cache/redis'\r\n| project id=tolower(id), subscriptionId, resourceGroup, location,type, tags\r\n) on id\r\n| project ServiceID=22 , subscriptionId,type, resourceGroup, location, id, tags )\r\n|union \r\n// Query for synapse Runtime for Apache Spark 2.4 and 3.1\r\n(Resources\r\n    | where type == \"microsoft.synapse/workspaces/bigdatapools\"  and todouble(properties.sparkVersion) in (2.4,3.1)\r\n    | extend workspaceId = tostring(split(id,'/')[8]) \r\n    | join kind=leftouter\r\n    (\r\n            Resources\r\n            | where type == \"microsoft.synapse/workspaces\" and properties.adlaResourceId == \"\"\r\n            | project workspaceId = name, adla=1\r\n        ) on workspaceId\r\n| where adla==1\r\n| project  ServiceID = iff (todouble(properties.sparkVersion)==2.4,31,32) , subscriptionId,type, resourceGroup, location, id , tags\r\n)\r\n| where ('*' in (dynamic([{ResourceGroup}])) or resourceGroup in (dynamic([{ResourceGroup}]))) \r\n| where ('*' in (dynamic([{Region}])) or location in (dynamic([{Region}])))\r\n| where ServiceID in (dynamic([{SelectedServiceId}])) ",
        "size": 4,
        "title": "This is just a data Set used for detailed section below. ",
        "noDataMessage": "This workbook has not identified any resources affected by an upcoming service retirement",
        "showExportToExcel": true,
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources",
        "crossComponentResources": [
          "{SubscriptionId}"
        ],
        "sortBy": []
      },
      "conditionalVisibilities": [
        {
          "parameterName": "SelectedServiceId",
          "comparison": "isNotEqualTo"
        },
        {
          "parameterName": "showTable",
          "comparison": "isEqualTo",
          "value": "show"
        }
      ],
      "name": "DetailedData"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"a076ea4a-3efd-4239-8156-72ba5426606c\",\"mergeType\":\"innerunique\",\"leftTable\":\"MasterData\",\"rightTable\":\"DetailedData\",\"leftColumn\":\"Id\",\"rightColumn\":\"ServiceID\"}],\"projectRename\":[{\"originalName\":\"[MasterData].ServiceName\",\"mergedName\":\"ServiceName\",\"fromId\":\"a076ea4a-3efd-4239-8156-72ba5426606c\"},{\"originalName\":\"[MasterData].RetiringFeature\",\"mergedName\":\"RetiringFeature\",\"fromId\":\"unknown\"},{\"originalName\":\"[MasterData].RetirementDate\",\"mergedName\":\"RetirementDate\",\"fromId\":\"a076ea4a-3efd-4239-8156-72ba5426606c\"},{\"originalName\":\"[DetailedData].subscriptionId\",\"mergedName\":\"subscriptionId\",\"fromId\":\"a076ea4a-3efd-4239-8156-72ba5426606c\"},{\"originalName\":\"[DetailedData].resourceGroup\",\"mergedName\":\"resourceGroup\",\"fromId\":\"a076ea4a-3efd-4239-8156-72ba5426606c\"},{\"originalName\":\"[DetailedData].location\",\"mergedName\":\"location\",\"fromId\":\"a076ea4a-3efd-4239-8156-72ba5426606c\"},{\"originalName\":\"[DetailedData].type\",\"mergedName\":\"type\",\"fromId\":\"a076ea4a-3efd-4239-8156-72ba5426606c\"},{\"originalName\":\"[DetailedData].id\",\"mergedName\":\"id\",\"fromId\":\"a076ea4a-3efd-4239-8156-72ba5426606c\"},{\"originalName\":\"[MasterData].Link\",\"mergedName\":\"Link\",\"fromId\":\"a076ea4a-3efd-4239-8156-72ba5426606c\"},{\"originalName\":\"[DetailedData].tags\",\"mergedName\":\"tags\",\"fromId\":\"unknown\"},{\"originalName\":\"[MasterData].Id\"},{\"originalName\":\"[MasterData].RetirementDate\"},{\"originalName\":\"[MasterData].Link\"},{\"originalName\":\"[DetailedData].ServiceId\"},{\"originalName\":\"[DetailedData].ServiceID\"},{\"originalName\":\"[MasterData].Category\"}]}",
        "size": 0,
        "title": "Based on the above table, this list shows your resources affected by the selected service retirement(s).",
        "noDataMessage": "This workbook has not identified any resources affected by an upcoming service retirement",
        "showRefreshButton": true,
        "showExportToExcel": true,
        "queryType": 7,
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "ServiceName",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "25ch"
              }
            },
            {
              "columnMatch": "RetiringFeature",
              "formatter": 1,
              "formatOptions": {
                "linkColumn": "Link",
                "linkTarget": "Url",
                "customColumnWidthSetting": "25ch"
              }
            },
            {
              "columnMatch": "RetirementDate",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "20ch"
              }
            },
            {
              "columnMatch": "subscriptionId",
              "formatter": 15,
              "formatOptions": {
                "linkTarget": null,
                "showIcon": true,
                "customColumnWidthSetting": "37ch"
              }
            },
            {
              "columnMatch": "resourceGroup",
              "formatter": 14,
              "formatOptions": {
                "linkTarget": null,
                "showIcon": true,
                "customColumnWidthSetting": "30ch"
              }
            },
            {
              "columnMatch": "location",
              "formatter": 17,
              "formatOptions": {
                "customColumnWidthSetting": "15ch"
              }
            },
            {
              "columnMatch": "type",
              "formatter": 16,
              "formatOptions": {
                "showIcon": true,
                "customColumnWidthSetting": "30ch"
              }
            },
            {
              "columnMatch": "id",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "30ch"
              }
            },
            {
              "columnMatch": "Link",
              "formatter": 5
            }
          ],
          "filter": true,
          "labelSettings": [
            {
              "columnId": "ServiceName",
              "label": "Service Name"
            },
            {
              "columnId": "RetiringFeature",
              "label": "Retiring Feature"
            },
            {
              "columnId": "RetirementDate",
              "label": "Retirement Date"
            },
            {
              "columnId": "subscriptionId",
              "label": "Subscription"
            },
            {
              "columnId": "resourceGroup",
              "label": "Resource Group"
            },
            {
              "columnId": "location",
              "label": "Location"
            },
            {
              "columnId": "type",
              "label": "Type"
            },
            {
              "columnId": "id",
              "label": "Resource Name"
            },
            {
              "columnId": "tags",
              "label": "Tags"
            }
          ]
        },
        "sortBy": []
      },
      "conditionalVisibility": {
        "parameterName": "SelectedServiceId",
        "comparison": "isNotEqualTo"
      },
      "customWidth": "98",
      "name": "FinalDetailedData",
      "styleSettings": {
        "maxWidth": "98"
      }
    }
  ],
  "fallbackResourceIds": [
    "azure monitor"
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}
