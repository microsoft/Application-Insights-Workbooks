{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "# Communication Service"
      },
      "name": "general-title"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "b1841bbb-0dec-444a-9873-ee90e6749e99",
            "version": "KqlParameterItem/1.0",
            "name": "time_range",
            "label": "Time range",
            "type": 4,
            "description": "Define a time range to aggregate logs over",
            "isRequired": true,
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 300000
                },
                {
                  "durationMs": 900000
                },
                {
                  "durationMs": 1800000
                },
                {
                  "durationMs": 3600000
                },
                {
                  "durationMs": 14400000
                },
                {
                  "durationMs": 43200000
                },
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 172800000
                },
                {
                  "durationMs": 259200000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 1209600000
                },
                {
                  "durationMs": 2419200000
                },
                {
                  "durationMs": 2592000000
                },
                {
                  "durationMs": 5184000000
                },
                {
                  "durationMs": 7776000000
                }
              ],
              "allowCustom": true
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "value": {
              "durationMs": 604800000
            }
          },
          {
            "id": "83d98c35-4d74-457c-9353-79397fcbfa81",
            "version": "KqlParameterItem/1.0",
            "name": "time_granularity",
            "label": "Time granularity",
            "type": 2,
            "description": "Choose the time granularity to use to aggregate logs",
            "isRequired": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[\r\n    { \"value\":\"1m\", \"label\":\"1 minute\" },\r\n    { \"value\":\"10m\", \"label\":\"10 minutes\" },\r\n    { \"value\":\"15m\", \"label\":\"15 minutes\" },\r\n    { \"value\":\"30m\", \"label\":\"30 minutes\" },\r\n    { \"value\":\"1h\", \"label\":\"1 hour\", \"selected\":true  },\r\n    { \"value\":\"2h\", \"label\":\"2 hours\" },\r\n    { \"value\":\"12h\", \"label\":\"12 hours\" },\r\n    { \"value\":\"1d\", \"label\":\"1 day\"},\r\n    { \"value\":\"2d\", \"label\":\"2 days\" },\r\n    { \"value\":\"3d\", \"label\":\"3 days\" },\r\n    { \"value\":\"7d\", \"label\":\"1 week\" }\r\n]",
            "timeContext": {
              "durationMs": 86400000
            },
            "value": "12h"
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.communication/communicationservices"
      },
      "name": "global-params"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "links": [
          {
            "id": "bb077035-d197-45dc-bfb4-d872a204bf47",
            "cellValue": "tab",
            "linkTarget": "parameter",
            "linkLabel": "Overview",
            "subTarget": "overview",
            "style": "link"
          },
          {
            "id": "666e153e-688d-4c46-aa22-958401423542",
            "cellValue": "tab",
            "linkTarget": "parameter",
            "linkLabel": "Voice and video",
            "subTarget": "calling",
            "style": "link"
          },
          {
            "id": "8c3e53ce-25cd-432e-b9f8-e7201f501111",
            "cellValue": "tab",
            "linkTarget": "parameter",
            "linkLabel": "Authentication",
            "subTarget": "auth",
            "style": "link"
          },
          {
            "id": "ab89abea-8f97-4f27-8c8a-42c91d71d90f",
            "cellValue": "tab",
            "linkTarget": "parameter",
            "linkLabel": "SMS",
            "subTarget": "sms",
            "style": "link"
          },
          {
            "id": "a72508b3-b261-4226-a907-06dd581cd903",
            "cellValue": "tab",
            "linkTarget": "parameter",
            "linkLabel": "Chat",
            "subTarget": "chat",
            "style": "link"
          },
          {
            "id": "c1361cd8-a3b2-4e2d-ba47-5ee3a55745c6",
            "cellValue": "tab",
            "linkTarget": "parameter",
            "linkLabel": "TURN",
            "subTarget": "turn",
            "style": "link"
          },
          {
            "id": "bfb30085-cd9e-446d-a38e-cd39c45228a7",
            "cellValue": "tab",
            "linkTarget": "parameter",
            "linkLabel": "Email",
            "subTarget": "email",
            "style": "link"
          },
          {
            "id": "94867372-10b2-4c21-8047-627729da1556",
            "cellValue": "tab",
            "linkTarget": "parameter",
            "linkLabel": "Recording",
            "subTarget": "recording",
            "style": "link"
          },
          {
            "id": "b4317d8b-a2a3-448a-9686-9d438bbadcb8",
            "cellValue": "tab",
            "linkTarget": "parameter",
            "linkLabel": "Call Automation",
            "subTarget": "automation",
            "style": "link"
          }
        ]
      },
      "name": "nav_menu"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "The Overview tab displays counts over time of your key communications services' activity.\r\n\r\n**Click any bar in the chart to display the associated logs (note that this only works for the last bar that is clicked)**"
            },
            "name": "overview-text"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "0cfaad60-33d7-4643-89e3-17cb0b99eb03",
                  "version": "KqlParameterItem/1.0",
                  "name": "plot_type",
                  "label": "Plot type",
                  "type": 2,
                  "description": "Select the type of plot to visualize the data",
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": []
                  },
                  "jsonData": "[\r\n    {\"value\": \"columnchart\", \"label\": \"Bar chart\", \"selected\":true},\r\n    {\"value\": \"areachart\", \"label\": \"Area chart\"}\r\n]",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "Microsoft.Communication/CommunicationServices"
            },
            "name": "overview-params"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let CallStreams = ACSCallDiagnostics\r\n| join kind=inner ACSCallSummary on CorrelationId, ParticipantId, EndpointId\r\n| where CallStartTime {time_range:query}\r\n| project Timestamp=CallStartTime, Operation=tostring(\"CallStreams\");\r\n\r\nlet ChatOperations = ACSChatIncomingOperations\r\n| where TimeGenerated {time_range:query}\r\n| project Timestamp=TimeGenerated, Operation=tostring(\"ChatOperations\");\r\n\r\nlet SMSOperations = ACSSMSIncomingOperations\r\n| where TimeGenerated {time_range:query}\r\n| project Timestamp=TimeGenerated, Operation=tostring(\"SMSOperations\");\r\n\r\nlet AuthOperations = ACSAuthIncomingOperations\r\n| where TimeGenerated {time_range:query}\r\n| project Timestamp=TimeGenerated, Operation=tostring(\"AuthOperations\");\r\n\r\nlet TURNOperations = ACSNetworkTraversalIncomingOperations\r\n| where TimeGenerated {time_range:query}\r\n| project Timestamp=TimeGenerated, Operation=tostring(\"TURNOperations\");\r\n\r\nlet EmailOperations = ACSEmailStatusUpdateOperational\r\n| where TimeGenerated {time_range:query}\r\n| project Timestamp=TimeGenerated, Operation=tostring(\"EmailOperations\");\r\n\r\nlet RecordingOperations = ACSCallRecordingSummary\r\n| where TimeGenerated {time_range:query}\r\n| project Timestamp=TimeGenerated, Operation=tostring(\"RecordingOperations\");\r\n\r\nlet CallAutomationOperations = ACSCallAutomationIncomingOperations \r\n| where TimeGenerated {time_range:query}\r\n| project Timestamp=TimeGenerated, Operation=tostring(\"CallAutomationOperations\");\r\n\r\nCallStreams\r\n| union ChatOperations, SMSOperations, AuthOperations, TURNOperations, EmailOperations, RecordingOperations, CallAutomationOperations\r\n| extend time_span = floor(Timestamp, {time_granularity})\r\n| make-series count() default=0 on Timestamp from {time_range:start} to {time_range:end} step {time_granularity} by Operation\r\n| render {plot_type}",
              "size": 0,
              "noDataMessage": "No Communication Services operations found in the specified time range",
              "exportedParameters": [
                {
                  "fieldName": "series",
                  "parameterName": "operation_type",
                  "parameterType": 1
                },
                {
                  "parameterName": "all_operations",
                  "parameterType": 1
                },
                {
                  "fieldName": "x",
                  "parameterName": "operation_time",
                  "parameterType": 1
                }
              ],
              "queryType": 0,
              "resourceType": "microsoft.communication/communicationservices"
            },
            "name": "all-operations-query"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let selected_operations = todynamic('{all_operations}');\r\n\r\nlet CallData = ACSCallDiagnostics | join kind=inner ACSCallSummary on CorrelationId, ParticipantId, EndpointId | extend OperationType = tostring(\"CallStreams\"), Timestamp = CallStartTime;\r\nlet AuthData = ACSAuthIncomingOperations | extend OperationType = tostring(\"AuthOperations\"), Timestamp = TimeGenerated;\r\nlet SMSData = ACSSMSIncomingOperations | extend OperationType = tostring(\"SMSOperations\"), Timestamp = TimeGenerated;\r\nlet ChatData = ACSChatIncomingOperations | extend OperationType = tostring(\"ChatOperations\"), Timestamp = TimeGenerated;\r\nlet TURNData = ACSNetworkTraversalIncomingOperations | extend OperationType = tostring(\"TURNOperations\"), Timestamp = TimeGenerated;\r\n\r\nlet AllData = CallData\r\n| union AuthData, SMSData, ChatData, TURNData\r\n| where OperationType == '{operation_type}' and Timestamp between (todatetime(selected_operations.x) .. {time_granularity});\r\n\r\nlet all_cols = toscalar(AllData\r\n| extend all_cols = pack_all()\r\n| project all_cols\r\n| extend col_names = bag_keys(all_cols)\r\n| summarize make_set(col_names));\r\n\r\nlet schemas_dict = dynamic({\r\n    \"CallStreams\": [\"CorrelationId\", \"CallStartTime\", \"CallType\", \"Identifier\", \"ParticipantId\", \"EndpointId\", \"EndpointType\", \"TeamsThreadId\", \"SdkVersion\", \"OsVersion\", \"ParticipantEndReason\", \"MediaType\", \"StreamId\", \"TransportType\", \"JitterAvg\", \"JitterMax\", \"RoundTripTimeAvg\", \"RoundTripTimeMax\", \"PacketLossRateAvg\", \"PacketLossRateMax\"],\r\n    \"ChatOperations\": [\"TimeGenerated\", \"OperationName\", \"CorrelationId\", \"OperationVersion\", \"Category\", \"ResultType\", \"ResultSignature\", \"ResultDescription\", \"DurationMs\", \"CallerIpAddress\", \"Level\", \"URI\", \"UserId\", \"ChatThreadId\", \"ChatMessageId\", \"SdkType\", \"PlatformType\", \"Type\"],\r\n    \"SMSOperations\": [\"TimeGenerated\", \"OperationName\", \"CorrelationId\", \"OperationVersion\", \"Category\", \"ResultType\", \"ResultSignature\", \"ResultDescription\", \"DurationMs\", \"CallerIpAddress\", \"Level\", \"URI\", \"OutgoingMessageLength\", \"IncomingMessageLength\", \"DeliveryAttempts\", \"PhoneNumber\", \"SdkType\", \"PlatformType\", \"Method\", \"Type\"],\r\n    \"AuthOperations\": [\"TimeGenerated\", \"OperationName\", \"CorrelationId\", \"OperationVersion\", \"Category\", \"ResultType\", \"ResultSignature\", \"ResultDescription\", \"DurationMs\", \"CallerIpAddress\", \"Level\", \"URI\", \"Identity\", \"Scopes\", \"SdkType\", \"PlatformType\", \"Type\"],\r\n    \"TURNOperations\": [\"TenantId\", \"TimeGenerated\", \"OperationName\", \"CorrelationId\", \"OperationVersion\", \"Category\", \"ResultType\", \"ResultSignature\", \"DurationMs\", \"Level\", \"URI\", \"Identity\", \"SdkType\", \"PlatformType\", \"RouteType\", \"Type\"]\r\n});\r\n\r\nlet remove_cols = set_difference(all_cols, todynamic(schemas_dict.{operation_type}));\r\n\r\nAllData\r\n| extend rec = pack_all()\r\n| project filteredRec = bag_remove_keys(rec, remove_cols)\r\n| evaluate bag_unpack(filteredRec)",
              "size": 0,
              "title": "{operation_type} logs at time {operation_time}",
              "noDataMessage": "No operations registered at the specified time",
              "queryType": 0,
              "resourceType": "microsoft.communication/communicationservices"
            },
            "conditionalVisibility": {
              "parameterName": "operation_type",
              "comparison": "isNotEqualTo"
            },
            "name": "selected-operation-logs"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "tab",
        "comparison": "isEqualTo",
        "value": "overview"
      },
      "name": "overview"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "tabs",
              "links": [
                {
                  "id": "7c2f282b-4005-4f41-ab99-ed720c1e14b7",
                  "cellValue": "calling_tab",
                  "linkTarget": "parameter",
                  "linkLabel": "Summary",
                  "subTarget": "general",
                  "style": "link"
                },
                {
                  "id": "8614c8ca-beb7-4cac-9766-119a196393ff",
                  "cellValue": "calling_tab",
                  "linkTarget": "parameter",
                  "linkLabel": "Volume",
                  "subTarget": "usage",
                  "style": "link"
                },
                {
                  "id": "6747113b-1bd8-42f6-9b83-636e6b6a97a3",
                  "cellValue": "calling_tab",
                  "linkTarget": "parameter",
                  "linkLabel": "Quality",
                  "subTarget": "quality",
                  "style": "link"
                },
                {
                  "id": "91fd1f28-5f6f-4c4e-a731-2c7c61cfdf75",
                  "cellValue": "calling_tab",
                  "linkTarget": "parameter",
                  "linkLabel": "Details",
                  "subTarget": "details",
                  "style": "link"
                }
              ]
            },
            "name": "voice-video-nav"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "The Quality tab within \"Voice and video\" displays counts and ratios of key entities that signal call quality."
                  },
                  "name": "voice-video-quality-text"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "bb9e8d89-0532-49e5-b699-403c33fce006",
                        "version": "KqlParameterItem/1.0",
                        "name": "call_quality_media_types",
                        "label": "Media types",
                        "type": 2,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "value": [
                          "AppSharing",
                          "Video",
                          "VBSS",
                          "Audio"
                        ],
                        "typeSettings": {
                          "additionalResourceOptions": [],
                          "showDefault": false
                        },
                        "jsonData": "[\r\n    {\"value\": \"Audio\", \"label\": \"Audio\", \"selected\":true},\r\n    {\"value\": \"Video\", \"label\": \"Video\", \"selected\":true},\r\n    {\"value\": \"VBSS\", \"label\": \"Screen sharing\", \"selected\":true},\r\n    {\"value\": \"AppSharing\", \"label\": \"App sharing\", \"selected\":true}\r\n]",
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      },
                      {
                        "version": "KqlParameterItem/1.0",
                        "name": "call_quality_endpoint_types",
                        "label": "Endpoint types",
                        "type": 2,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "typeSettings": {
                          "additionalResourceOptions": [],
                          "showDefault": false
                        },
                        "jsonData": "[\r\n    {\"value\": \"VoIP\", \"label\": \"VoIP\", \"selected\":true},\r\n    {\"value\": \"PSTN\", \"label\": \"PSTN\", \"selected\":true},\r\n    {\"value\": \"Bot\", \"label\": \"Bot\", \"selected\":true},\r\n    {\"value\": \"Server\", \"label\": \"Server\", \"selected\":true},\r\n    {\"value\": \"Unknown\", \"label\": \"Unknown\", \"selected\":true}\r\n]",
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "id": "2666fe6a-842f-46ad-9f75-5e52e8517ff8",
                        "value": [
                          "Unknown",
                          "Server",
                          "Bot",
                          "PSTN",
                          "VoIP"
                        ]
                      },
                      {
                        "id": "868602ec-a0f7-4983-a292-4acde38c2f2a",
                        "version": "KqlParameterItem/1.0",
                        "name": "call_quality_os",
                        "label": "OS version",
                        "type": 2,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "ACSCallSummary\r\n| where CallStartTime {time_range:query}\r\n| extend OsVersion = case(  indexof(OsVersion, \"Android\") != -1, tostring(split(OsVersion, \";\")[0]),\r\n                            indexof(OsVersion, \"Darwin\") != -1, tostring(split(OsVersion, \":\")[0]),\r\n                            indexof(OsVersion, \"Windows\") != -1, tostring(split(OsVersion, \".\")[0]),\r\n                            OsVersion\r\n                        )\r\n| distinct OsVersion\r\n| order by OsVersion\r\n| where isnotempty(OsVersion)",
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::all"
                          ],
                          "showDefault": false
                        },
                        "defaultValue": "value::all",
                        "queryType": 0,
                        "resourceType": "microsoft.communication/communicationservices",
                        "value": [
                          "value::all"
                        ]
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices"
                  },
                  "name": "voice-video-quality-params"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "title": "Stream health",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "Streams are classified as healthy if they exhibit telemetry values within the following ranges:\r\n\r\n- Round trip time under 500 milliseconds\r\n- Packet loss rate of less than 10%\r\n- Jitter under 30 milliseconds"
                        },
                        "name": "stream-health-info"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "ACSCallDiagnostics\r\n| join kind=inner ACSCallSummary on CorrelationId, ParticipantId, EndpointId\r\n| where CallStartTime {time_range:query} and MediaType in (dynamic([{call_quality_media_types}])) and EndpointType in (dynamic([{call_quality_endpoint_types}]))\r\n| extend SimpleOsVersion = case(  indexof(OsVersion, \"Android\") != -1, tostring(split(OsVersion, \";\")[0]),\r\n                            indexof(OsVersion, \"Darwin\") != -1, tostring(split(OsVersion, \":\")[0]),\r\n                            indexof(OsVersion, \"Windows\") != -1, tostring(split(OsVersion, \".\")[0]),\r\n                            OsVersion\r\n                        )\r\n| where SimpleOsVersion in (dynamic([{call_quality_os}]))\r\n| order by CallStartTime asc, ParticipantStartTime asc\r\n| extend JitterQuality = iff(JitterAvg > 30, \"jitter\", \"\")\r\n| extend PacketLossRateQuality = iff(PacketLossRateAvg > 0.1, \"packet loss rate\", \"\")\r\n| extend RoundTripTimeQuality = iff(RoundTripTimeAvg > 500, \"round-trip time\", \"\")\r\n| extend TelemetryString = JitterQuality\r\n| extend TelemetryString = iff(isempty(PacketLossRateQuality), TelemetryString, iff(isempty(TelemetryString), PacketLossRateQuality, strcat_delim(\" and \", TelemetryString, PacketLossRateQuality)))\r\n| extend TelemetryString = iff(isempty(RoundTripTimeQuality), TelemetryString, iff(isempty(TelemetryString), RoundTripTimeQuality, strcat_delim(\" and \", TelemetryString, RoundTripTimeQuality)))\r\n//| extend TelemetryString = strcat_delim(\" and \", JitterQuality, PacketLossRateQuality, RoundTripTimeQuality)\r\n| extend StreamClassification = iff(isempty(TelemetryString), \"Healthy\", strcat(\"Unhealthy \", TelemetryString))\r\n//| extend StreamQuality = iff((JitterQuality == \"Poor\") or (PacketLossRateQuality == \"Poor\") or (RoundTripTimeQuality == \"Poor\"), \"Poor\", \"Good\")\r\n| summarize count() by StreamClassification\r\n| render piechart",
                          "size": 0,
                          "noDataMessage": "No streams were found for the specified time range",
                          "queryType": 0,
                          "resourceType": "microsoft.communication/communicationservices"
                        },
                        "name": "voice-video-quality-streams"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "stream-health-group"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "title": "Impacted calls",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "An impacted call is defined here as a call that has at least one unhealthy media stream as defined in **Stream health**"
                        },
                        "name": "impacted-calls-info"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "ACSCallDiagnostics\r\n| join kind=inner ACSCallSummary on CorrelationId, ParticipantId, EndpointId\r\n| where CallStartTime {time_range:query} and MediaType in (dynamic([{call_quality_media_types}])) and EndpointType in (dynamic([{call_quality_endpoint_types}]))\r\n| extend SimpleOsVersion = case(  indexof(OsVersion, \"Android\") != -1, tostring(split(OsVersion, \";\")[0]),\r\n                            indexof(OsVersion, \"Darwin\") != -1, tostring(split(OsVersion, \":\")[0]),\r\n                            indexof(OsVersion, \"Windows\") != -1, tostring(split(OsVersion, \".\")[0]),\r\n                            OsVersion\r\n                        )\r\n| where SimpleOsVersion in (dynamic([{call_quality_os}]))\r\n| extend JitterQuality = iff(JitterAvg > 30, \"Poor\", \"Good\")\r\n| extend PacketLossRateQuality = iff(PacketLossRateAvg > 0.1, \"Poor\", \"Good\")\r\n| extend RoundTripTimeQuality = iff(RoundTripTimeAvg > 500, \"Poor\", \"Good\")\r\n| extend StreamQuality = iff((JitterQuality == \"Poor\") or (PacketLossRateQuality == \"Poor\") or (RoundTripTimeQuality == \"Poor\"), \"Impacted\", \"Not impacted\")\r\n| distinct CorrelationId, StreamQuality\r\n| summarize CallQuality=arg_min(StreamQuality, *) by CorrelationId\r\n| summarize count() by CallQuality\r\n| render piechart",
                          "size": 0,
                          "noDataMessage": "No calls found in the specified time range",
                          "queryType": 0,
                          "resourceType": "microsoft.communication/communicationservices"
                        },
                        "name": "voice-video-quality-calls"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "impacted-calls-group"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ACSCallDiagnostics\r\n| join kind=inner ACSCallSummary on CorrelationId, ParticipantId, EndpointId\r\n| where CallStartTime {time_range:query} and MediaType in (dynamic([{call_quality_media_types}])) and EndpointType in (dynamic([{call_quality_endpoint_types}]))\r\n| extend SimpleOsVersion = case(  indexof(OsVersion, \"Android\") != -1, tostring(split(OsVersion, \";\")[0]),\r\n                            indexof(OsVersion, \"Darwin\") != -1, tostring(split(OsVersion, \":\")[0]),\r\n                            indexof(OsVersion, \"Windows\") != -1, tostring(split(OsVersion, \".\")[0]),\r\n                            OsVersion\r\n                        )\r\n| where SimpleOsVersion in (dynamic([{call_quality_os}]))\r\n| order by CallStartTime asc, ParticipantStartTime asc\r\n| extend ParticipantEndReason = case(\r\n                                tostring(ParticipantEndReason) startswith \"0\", \"Success\",\r\n                                tostring(ParticipantEndReason) startswith \"1\", \"Provisional\",\r\n                                tostring(ParticipantEndReason) startswith \"2\", \"Success\",\r\n                                tostring(ParticipantEndReason) startswith \"3\", \"Redirection\",\r\n                                tostring(ParticipantEndReason) startswith \"4\", \"Client Failure\",\r\n                                tostring(ParticipantEndReason) startswith \"5\", \"Server Failure\",\r\n                                tostring(ParticipantEndReason) startswith \"6\", \"Global Failure\",\r\n                            ParticipantEndReason\r\n                        )\r\n| summarize count() by ParticipantEndReason\r\n| render piechart",
                    "size": 0,
                    "title": "Participant end reason categories",
                    "noDataMessage": "No participants found in the specified time range",
                    "exportMultipleValues": true,
                    "exportedParameters": [
                      {
                        "fieldName": "series",
                        "parameterName": "end_reason_category",
                        "parameterType": 1
                      }
                    ],
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices"
                  },
                  "customWidth": "50",
                  "name": "voice-video-quality-participant-end-reason-class"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SIPCodes =  datatable(ParticipantEndReason: string, SIPCode: string, Troubleshooting: string)\r\n[\r\n    \"0\",   \"Success\", \"\",\r\n    \"100\", \"Trying\", \"\",\r\n    \"180\", \"Ringing\", \"\",\r\n    \"181\", \"Call Is Being Forwarded\", \"\",\r\n    \"182\", \"Queued\", \"\",\r\n    \"183\", \"Session Progress\", \"\",\r\n    \"199\", \"Early Dialog Terminated\", \"\",\r\n    \"200\", \"Success\", \"\",\r\n    \"202\", \"Accepted\", \"\",\r\n    \"204\", \"No Notification\", \"\",\r\n    \"300\", \"Multiple Choices\", \"\",\r\n    \"301\", \"Moved Permanently\", \"\",\r\n    \"302\", \"Moved Temporarily\", \"\",\r\n    \"305\", \"Use Proxy\", \"\",\r\n    \"380\", \"Alternative Service\", \"\",\r\n    \"400\", \"Bad Request\", \"\",\r\n    \"401\", \"Unauthorized\", \"\",\r\n    \"402\", \"Payment Required\", \"\",\r\n    \"403\", \"Forbidden / Authentication failure\", \"Ensure that your Communication Services token is valid and not expired.\",\r\n    \"404\", \"Call not found\", \"Ensure that the number you're calling (or call you're joining) exists.\",\r\n    \"405\", \"Method Not Allowed\", \"\",\r\n    \"406\", \"Not Acceptable\", \"\",\r\n    \"407\", \"Proxy Authentication Required\", \"\",\r\n    \"408\", \"Call controller timed out\", \"Call Controller timed out waiting for protocol messages from user endpoints. Ensure clients are connected and available.\",\r\n    \"409\", \"Conflict\", \"\",\r\n    \"410\", \"Local media stack or media infrastructure error\", \"Ensure that you're using the latest SDK in a supported environment.\",\r\n    \"411\", \"Length Required\", \"\",\r\n    \"412\", \"Conditional Request Failed\", \"\",\r\n    \"413\", \"Request Entity Too Large\", \"\",\r\n    \"414\", \"Request-URI Too Large\", \"\",\r\n    \"415\", \"Unsupported Media Type\", \"\",\r\n    \"416\", \"Unsupported URI Scheme\", \"\",\r\n    \"417\", \"Unknown Resource-Priority\", \"\",\r\n    \"420\", \"Bad Extension\", \"\",\r\n    \"421\", \"Extension Required\", \"\",\r\n    \"422\", \"Session Interval Too Small\", \"\",\r\n    \"423\", \"Interval Too Brief\", \"\",\r\n    \"424\", \"Bad Location Information\", \"\",\r\n    \"428\", \"Use Identity Header\", \"\",\r\n    \"429\", \"Provide Referrer Identity\", \"\",\r\n    \"430\", \"Unable to deliver message to client application\", \"Ensure that the client application is running and available.\",\r\n    \"433\", \"Anonymity Disallowed\", \"\",\r\n    \"436\", \"Bad Identity-Info\", \"\",\r\n    \"437\", \"Unsupported Certificate\", \"\",\r\n    \"438\", \"Invalid Identity Header\", \"\",\r\n    \"439\", \"First Hop Lacks Outbound Support\", \"\",\r\n    \"440\", \"Max-Breadth Exceeded\", \"\",\r\n    \"469\", \"Bad Info Package\", \"\",\r\n    \"470\", \"Consent Needed\", \"\",\r\n    \"480\", \"Remote client endpoint not registered\", \"Ensure that the remote endpoint is available.\",\r\n    \"481\", \"Failed to handle incoming call\", \"File a support request through the Azure portal.\",\r\n    \"482\", \"Loop Detected\", \"\",\r\n    \"483\", \"Too Many Hops\", \"\",\r\n    \"484\", \"Address Incomplete\", \"\",\r\n    \"485\", \"Ambiguous\", \"\",\r\n    \"486\", \"Busy Here\", \"\",\r\n    \"487\", \"Call canceled, locally declined, ended due to an endpoint mismatch issue, or failed to generate media offer\", \"Expected behavior.\",\r\n    \"488\", \"Not Acceptable Here\", \"\",\r\n    \"489\", \"Bad Event\", \"\",\r\n    \"490\", \"Local endpoint network issues\", \"Check your network.\",\r\n    \"491\", \"Local endpoint network issues\", \"Check your network.\",\r\n    \"493\", \"Undecipherable\", \"\",\r\n    \"494\", \"Security Agreement Required\", \"\",\r\n    \"496\", \"Local endpoint network issues\", \"Check your network.\",\r\n    \"497\", \"Local endpoint network issues\", \"Check your network.\",\r\n    \"498\", \"Local endpoint network issues\", \"Check your network.\",\r\n    \"500\", \"Communication Services infrastructure error\", \"File a support request through the Azure portal.\",\r\n    \"501\", \"Not Implemented\", \"\",\r\n    \"502\", \"Bad Gateway\", \"\",\r\n    \"503\", \"Communication Services infrastructure error\", \"File a support request through the Azure portal.\",\r\n    \"504\", \"Communication Services infrastructure error\", \"File a support request through the Azure portal.\",\r\n    \"505\", \"Version Not Supported\", \"\",\r\n    \"513\", \"Message Too Large\", \"\",\r\n    \"555\", \"Push Notification Service Not Supported\", \"\",\r\n    \"580\", \"Precondition Failure\", \"\",\r\n    \"600\", \"Busy Everywhere\", \"\",\r\n    \"603\", \"Call globally declined by remote Communication Services participant\", \"Expected behavior.\",\r\n    \"604\", \"Does Not Exist Anywhere\", \"\",\r\n    \"606\", \"Not Acceptable\", \"\",\r\n    \"607\", \"Unwanted\", \"\",\r\n    \"608\", \"Rejected\", \"\",\r\n];\r\n\r\nACSCallDiagnostics\r\n| join kind=inner ACSCallSummary on CorrelationId, ParticipantId, EndpointId\r\n| join kind=leftouter SIPCodes on ParticipantEndReason\r\n| extend EndReason=strcat(ParticipantEndReason, \": \", SIPCode)\r\n| where CallStartTime {time_range:query} and MediaType in (dynamic([{call_quality_media_types}])) and EndpointType in (dynamic([{call_quality_endpoint_types}]))\r\n| extend SimpleOsVersion = case(  indexof(OsVersion, \"Android\") != -1, tostring(split(OsVersion, \";\")[0]),\r\n                            indexof(OsVersion, \"Darwin\") != -1, tostring(split(OsVersion, \":\")[0]),\r\n                            indexof(OsVersion, \"Windows\") != -1, tostring(split(OsVersion, \".\")[0]),\r\n                            OsVersion\r\n                        )\r\n| where SimpleOsVersion in (dynamic([{call_quality_os}]))\r\n| summarize ParticipantEndReasonCounts=count() by EndReason, Troubleshooting\r\n| order by ParticipantEndReasonCounts",
                    "size": 0,
                    "title": "Participant end reasons {end_reason_category}",
                    "noDataMessage": "No participants found in the specified time range",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices",
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "ParticipantEndReasonCounts",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "name": "voice-video-quality-participant-end-reasons"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "calling_tab",
              "comparison": "isEqualTo",
              "value": "quality"
            },
            "name": "call_quality"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "The Summary tab within \"Voice and video\" displays high level stats ratios of key call dimensions."
                  },
                  "customWidth": "100",
                  "name": "voice-video-text"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "items": [
                      {
                        "type": 1,
                        "content": {
                          "json": "This chart provides information about the proportion of impacted calls, either by poor telemetry or failed participant end reasons.\r\n\r\n**Click any bar in the chart to display the associated usage logs (note that this only works for the last bar that is clicked)**"
                        },
                        "name": "overview-impacted-calls-text"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "ACSCallDiagnostics\r\n| join kind=inner ACSCallSummary on CorrelationId, ParticipantId, EndpointId\r\n| where CallStartTime {time_range:query}\r\n| order by CallStartTime asc, ParticipantStartTime asc\r\n| extend UnsuccessfulEndReason = iff((ParticipantEndReason startswith \"0\") or (ParticipantEndReason startswith \"2\"), \"\", \"Failed end reason\")\r\n| extend JitterQuality = iff(JitterAvg > 30, \"Poor\", \"Good\")\r\n| extend PacketLossRateQuality = iff(PacketLossRateAvg > 0.1, \"Poor\", \"Good\")\r\n| extend RoundTripTimeQuality = iff(RoundTripTimeAvg > 500, \"Poor\", \"Good\")\r\n| extend StreamQuality = iff((JitterQuality == \"Poor\") or (PacketLossRateQuality == \"Poor\") or (RoundTripTimeQuality == \"Poor\"), \"Unhealthy stream\", \"\")\r\n| extend IsImpacted = case(\r\n                            isnotempty(UnsuccessfulEndReason) and isnotempty(StreamQuality), 4,\r\n                            isnotempty(StreamQuality), 3,\r\n                            isnotempty(UnsuccessfulEndReason), 2,\r\n                            1)\r\n| summarize arg_max(IsImpacted, *) by CorrelationId\r\n| extend Classification = case(\r\n                                IsImpacted == 4, strcat(UnsuccessfulEndReason, \" and \", StreamQuality),\r\n                                IsImpacted == 3, StreamQuality,\r\n                                IsImpacted == 2, UnsuccessfulEndReason,\r\n                                \"Successful\"\r\n                            )\r\n//| project CallDate, InteropType, CallLabel, CallId = CorrelationId\r\n| make-series NumCalls=dcount(CorrelationId) default=0 on CallStartTime from {time_range:start} to {time_range:end} step {time_granularity} by Classification\r\n| render barchart",
                          "size": 0,
                          "noDataMessage": "No calling logs found in the specified time range",
                          "exportedParameters": [
                            {
                              "fieldName": "x",
                              "parameterName": "call_impact_time",
                              "parameterType": 1
                            },
                            {
                              "fieldName": "label",
                              "parameterName": "call_impact_type",
                              "parameterType": 1
                            },
                            {
                              "parameterName": "call_impact",
                              "parameterType": 1
                            }
                          ],
                          "queryType": 0,
                          "resourceType": "microsoft.communication/communicationservices"
                        },
                        "name": "impacted-calls-barchart"
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "items": [
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "let selected_call_impact = todynamic('{call_impact}');\r\n\r\nACSCallDiagnostics\r\n| join kind=inner ACSCallSummary on CorrelationId, ParticipantId, EndpointId\r\n| where CallStartTime between (todatetime(selected_call_impact.x) .. {time_granularity})\r\n| order by CallStartTime asc, ParticipantStartTime asc\r\n| extend CallDate=format_datetime(CallStartTime, 'MM/dd/y')\r\n| extend CallTime=format_datetime(CallStartTime, 'hh:mm:ss')\r\n| extend InteropType = iff(isempty(TeamsThreadId), \"ðŸ“ž ACS call\", \"ðŸ”€ Teams interop\")\r\n\r\n| extend UnsuccessfulEndReason = iff((ParticipantEndReason startswith \"0\") or (ParticipantEndReason startswith \"2\"), \"\", \"Failed end reason\")\r\n| extend JitterQuality = iff(JitterAvg > 30, \"Poor\", \"Good\")\r\n| extend PacketLossRateQuality = iff(PacketLossRateAvg > 0.1, \"Poor\", \"Good\")\r\n| extend RoundTripTimeQuality = iff(RoundTripTimeAvg > 500, \"Poor\", \"Good\")\r\n| extend StreamQuality = iff((JitterQuality == \"Poor\") or (PacketLossRateQuality == \"Poor\") or (RoundTripTimeQuality == \"Poor\"), \"Unhealthy stream\", \"\")\r\n| extend IsImpacted = case(\r\n                            isnotempty(UnsuccessfulEndReason) and isnotempty(StreamQuality), 4,\r\n                            isnotempty(StreamQuality), 3,\r\n                            isnotempty(UnsuccessfulEndReason), 2,\r\n                            1)\r\n| summarize arg_max(IsImpacted, *) by CorrelationId\r\n| extend Classification = case(\r\n                                IsImpacted == 4, strcat(UnsuccessfulEndReason, \" and \", StreamQuality),\r\n                                IsImpacted == 3, StreamQuality,\r\n                                IsImpacted == 2, UnsuccessfulEndReason,\r\n                                \"Successful\"\r\n                            )\r\n| where Classification == selected_call_impact.label\r\n| extend CallIcon = case(\r\n                                IsImpacted == 4, \"ðŸ›‘ðŸš©\",\r\n                                IsImpacted == 3, \"ðŸš©\",\r\n                                IsImpacted == 2, \"ðŸ›‘\",\r\n                                \"\"\r\n                            )\r\n| extend CallLabel = strcat(CallTime, \" \", CallIcon)\r\n| summarize arg_max(CallLabel, *) by CorrelationId\r\n| project CallDate, InteropType, CallLabel, CallId = CorrelationId",
                                "size": 0,
                                "title": "{call_impact_type} calls aat {call_impact_time}",
                                "noDataMessage": "No calls found in the specified time range",
                                "exportFieldName": "CallId",
                                "exportParameterName": "call_impact_id",
                                "queryType": 0,
                                "resourceType": "microsoft.communication/communicationservices",
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "CallDate",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "CallLabel",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "$gen_group",
                                      "formatter": 0,
                                      "tooltipFormat": {
                                        "tooltip": "Details for call {0}"
                                      }
                                    }
                                  ],
                                  "hierarchySettings": {
                                    "treeType": 1,
                                    "groupBy": [
                                      "CallDate"
                                    ],
                                    "expandTopLevel": true,
                                    "finalBy": "CallLabel"
                                  }
                                }
                              },
                              "customWidth": "30",
                              "conditionalVisibility": {
                                "parameterName": "call_impact",
                                "comparison": "isNotEqualTo"
                              },
                              "name": "call-impact-list"
                            },
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "let SIPCodes =  datatable(ParticipantEndReason: string, SIPCode: string, Troubleshooting: string)\r\n[\r\n    \"0\",   \"Success\", \"\",\r\n    \"100\", \"Trying\", \"\",\r\n    \"180\", \"Ringing\", \"\",\r\n    \"181\", \"Call Is Being Forwarded\", \"\",\r\n    \"182\", \"Queued\", \"\",\r\n    \"183\", \"Session Progress\", \"\",\r\n    \"199\", \"Early Dialog Terminated\", \"\",\r\n    \"200\", \"Success\", \"\",\r\n    \"202\", \"Accepted\", \"\",\r\n    \"204\", \"No Notification\", \"\",\r\n    \"300\", \"Multiple Choices\", \"\",\r\n    \"301\", \"Moved Permanently\", \"\",\r\n    \"302\", \"Moved Temporarily\", \"\",\r\n    \"305\", \"Use Proxy\", \"\",\r\n    \"380\", \"Alternative Service\", \"\",\r\n    \"400\", \"Bad Request\", \"\",\r\n    \"401\", \"Unauthorized\", \"\",\r\n    \"402\", \"Payment Required\", \"\",\r\n    \"403\", \"Forbidden / Authentication failure\", \"Ensure that your Communication Services token is valid and not expired.\",\r\n    \"404\", \"Call not found\", \"Ensure that the number you're calling (or call you're joining) exists.\",\r\n    \"405\", \"Method Not Allowed\", \"\",\r\n    \"406\", \"Not Acceptable\", \"\",\r\n    \"407\", \"Proxy Authentication Required\", \"\",\r\n    \"408\", \"Call controller timed out\", \"Call Controller timed out waiting for protocol messages from user endpoints. Ensure clients are connected and available.\",\r\n    \"409\", \"Conflict\", \"\",\r\n    \"410\", \"Local media stack or media infrastructure error\", \"Ensure that you're using the latest SDK in a supported environment.\",\r\n    \"411\", \"Length Required\", \"\",\r\n    \"412\", \"Conditional Request Failed\", \"\",\r\n    \"413\", \"Request Entity Too Large\", \"\",\r\n    \"414\", \"Request-URI Too Large\", \"\",\r\n    \"415\", \"Unsupported Media Type\", \"\",\r\n    \"416\", \"Unsupported URI Scheme\", \"\",\r\n    \"417\", \"Unknown Resource-Priority\", \"\",\r\n    \"420\", \"Bad Extension\", \"\",\r\n    \"421\", \"Extension Required\", \"\",\r\n    \"422\", \"Session Interval Too Small\", \"\",\r\n    \"423\", \"Interval Too Brief\", \"\",\r\n    \"424\", \"Bad Location Information\", \"\",\r\n    \"428\", \"Use Identity Header\", \"\",\r\n    \"429\", \"Provide Referrer Identity\", \"\",\r\n    \"430\", \"Unable to deliver message to client application\", \"Ensure that the client application is running and available.\",\r\n    \"433\", \"Anonymity Disallowed\", \"\",\r\n    \"436\", \"Bad Identity-Info\", \"\",\r\n    \"437\", \"Unsupported Certificate\", \"\",\r\n    \"438\", \"Invalid Identity Header\", \"\",\r\n    \"439\", \"First Hop Lacks Outbound Support\", \"\",\r\n    \"440\", \"Max-Breadth Exceeded\", \"\",\r\n    \"469\", \"Bad Info Package\", \"\",\r\n    \"470\", \"Consent Needed\", \"\",\r\n    \"480\", \"Remote client endpoint not registered\", \"Ensure that the remote endpoint is available.\",\r\n    \"481\", \"Failed to handle incoming call\", \"File a support request through the Azure portal.\",\r\n    \"482\", \"Loop Detected\", \"\",\r\n    \"483\", \"Too Many Hops\", \"\",\r\n    \"484\", \"Address Incomplete\", \"\",\r\n    \"485\", \"Ambiguous\", \"\",\r\n    \"486\", \"Busy Here\", \"\",\r\n    \"487\", \"Call canceled, locally declined, ended due to an endpoint mismatch issue, or failed to generate media offer\", \"Expected behavior.\",\r\n    \"488\", \"Not Acceptable Here\", \"\",\r\n    \"489\", \"Bad Event\", \"\",\r\n    \"490\", \"Local endpoint network issues\", \"Check your network.\",\r\n    \"491\", \"Local endpoint network issues\", \"Check your network.\",\r\n    \"493\", \"Undecipherable\", \"\",\r\n    \"494\", \"Security Agreement Required\", \"\",\r\n    \"496\", \"Local endpoint network issues\", \"Check your network.\",\r\n    \"497\", \"Local endpoint network issues\", \"Check your network.\",\r\n    \"498\", \"Local endpoint network issues\", \"Check your network.\",\r\n    \"500\", \"Communication Services infrastructure error\", \"File a support request through the Azure portal.\",\r\n    \"501\", \"Not Implemented\", \"\",\r\n    \"502\", \"Bad Gateway\", \"\",\r\n    \"503\", \"Communication Services infrastructure error\", \"File a support request through the Azure portal.\",\r\n    \"504\", \"Communication Services infrastructure error\", \"File a support request through the Azure portal.\",\r\n    \"505\", \"Version Not Supported\", \"\",\r\n    \"513\", \"Message Too Large\", \"\",\r\n    \"555\", \"Push Notification Service Not Supported\", \"\",\r\n    \"580\", \"Precondition Failure\", \"\",\r\n    \"600\", \"Busy Everywhere\", \"\",\r\n    \"603\", \"Call globally declined by remote Communication Services participant\", \"Expected behavior.\",\r\n    \"604\", \"Does Not Exist Anywhere\", \"\",\r\n    \"606\", \"Not Acceptable\", \"\",\r\n    \"607\", \"Unwanted\", \"\",\r\n    \"608\", \"Rejected\", \"\",\r\n];\r\n\r\nACSCallDiagnostics\r\n| where CorrelationId == \"{call_impact_id}\"\r\n| join kind=inner ACSCallSummary on CorrelationId, ParticipantId, EndpointId\r\n| join kind=leftouter SIPCodes on ParticipantEndReason\r\n| extend EndReason=strcat(ParticipantEndReason, \": \", SIPCode)\r\n| extend UnsuccessfulEndReason = iff((ParticipantEndReason startswith \"0\") or (ParticipantEndReason startswith \"2\"), \"\", \"ðŸ›‘\")\r\n| extend ParticipantTime=format_datetime(ParticipantStartTime, 'hh:mm:ss')\r\n| extend EndpointType = case(  indexof(EndpointType, \"VoIP\") != -1, strcat(\"ðŸ—£ï¸ \", EndpointType),\r\n                            indexof(EndpointType, \"PSTN\") != -1, strcat(\"ðŸ“ž \", EndpointType),\r\n                            indexof(EndpointType, \"Bot\") != -1, strcat(\"ðŸ¤– \", EndpointType),\r\n                            indexof(EndpointType, \"Server\") != -1, strcat(\"ðŸ–¥ï¸ \", EndpointType),\r\n                            indexof(EndpointType, \"Unknown\") != -1, strcat(\"ðŸ‘½ \", EndpointType),\r\n                            EndpointType\r\n                        )\r\n| extend IsInterop = Identifier !startswith \"acs:\"\r\n| extend ParticipantType = iff(IsInterop, \"ðŸ”€ Teams\", EndpointType)\r\n| extend JitterQuality = iff(JitterAvg > 30, \"Poor\", \"Good\")\r\n| extend PacketLossRateQuality = iff(PacketLossRateAvg > 0.1, \"Poor\", \"Good\")\r\n| extend RoundTripTimeQuality = iff(RoundTripTimeAvg > 500, \"Poor\", \"Good\")\r\n| extend StreamQuality = iff((JitterQuality == \"Poor\") or (PacketLossRateQuality == \"Poor\") or (RoundTripTimeQuality == \"Poor\"), \"ðŸš©\", \"\")\r\n| extend Participant = strcat(ParticipantType, \" \", UnsuccessfulEndReason, \" \", StreamQuality, \" \", ParticipantTime, \" (\", iff(isnotempty(ParticipantId), ParticipantId, strcat(\"Endpoint ID: \", EndpointId)), \")\")\r\n| extend MediaType = case(  indexof(MediaType, \"Audio\") != -1, strcat(\"ðŸ”Š \", MediaType),\r\n                            indexof(MediaType, \"Video\") != -1, strcat(\"ðŸŽ¥ \", MediaType),\r\n                            indexof(MediaType, \"VBSS\") != -1, strcat(\"ðŸ’» \", MediaType),\r\n                            indexof(MediaType, \"AppSharing\") != -1, strcat(\"ðŸ“² \", MediaType),\r\n                            MediaType\r\n                        )\r\n| project CallId = strcat(\"ðŸ“ž \", CorrelationId), Participant, MediaType, ParticipantDuration, EndReason, JitterAvg, PacketLossRateAvg, RoundTripTimeAvg",
                                "size": 0,
                                "title": "Details for call {call_impact_id}",
                                "noDataMessage": "Please select a call from the left column",
                                "queryType": 0,
                                "resourceType": "microsoft.communication/communicationservices",
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "CallId",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "Participant",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "MediaType",
                                      "formatter": 5
                                    },
                                    {
                                      "columnMatch": "EndReason",
                                      "formatter": 18,
                                      "formatOptions": {
                                        "thresholdsOptions": "icons",
                                        "thresholdsGrid": [
                                          {
                                            "operator": "startsWith",
                                            "thresholdValue": "2",
                                            "representation": "success",
                                            "text": "{0}{1}"
                                          },
                                          {
                                            "operator": "startsWith",
                                            "thresholdValue": "0",
                                            "representation": "success",
                                            "text": "{0}{1}"
                                          },
                                          {
                                            "operator": "Default",
                                            "thresholdValue": null,
                                            "representation": "3",
                                            "text": "{0}{1}"
                                          }
                                        ]
                                      }
                                    },
                                    {
                                      "columnMatch": "JitterAvg",
                                      "formatter": 18,
                                      "formatOptions": {
                                        "thresholdsOptions": "colors",
                                        "thresholdsGrid": [
                                          {
                                            "operator": ">",
                                            "thresholdValue": "30",
                                            "representation": "redBright",
                                            "text": "{0}{1}"
                                          },
                                          {
                                            "operator": "Default",
                                            "thresholdValue": null,
                                            "text": "{0}{1}"
                                          }
                                        ]
                                      }
                                    },
                                    {
                                      "columnMatch": "PacketLossRateAvg",
                                      "formatter": 18,
                                      "formatOptions": {
                                        "thresholdsOptions": "colors",
                                        "thresholdsGrid": [
                                          {
                                            "operator": ">",
                                            "thresholdValue": ".1",
                                            "representation": "redBright",
                                            "text": "{0}{1}"
                                          },
                                          {
                                            "operator": "Default",
                                            "thresholdValue": null,
                                            "text": "{0}{1}"
                                          }
                                        ]
                                      }
                                    },
                                    {
                                      "columnMatch": "RoundTripTimeAvg",
                                      "formatter": 18,
                                      "formatOptions": {
                                        "thresholdsOptions": "colors",
                                        "thresholdsGrid": [
                                          {
                                            "operator": ">",
                                            "thresholdValue": "500",
                                            "representation": "redBright",
                                            "text": "{0}{1}"
                                          },
                                          {
                                            "operator": "Default",
                                            "thresholdValue": null,
                                            "text": "{0}{1}"
                                          }
                                        ]
                                      }
                                    }
                                  ],
                                  "hierarchySettings": {
                                    "treeType": 1,
                                    "groupBy": [
                                      "CallId",
                                      "Participant"
                                    ],
                                    "expandTopLevel": true,
                                    "finalBy": "MediaType"
                                  }
                                }
                              },
                              "customWidth": "70",
                              "conditionalVisibility": {
                                "parameterName": "call_impact_id",
                                "comparison": "isNotEqualTo"
                              },
                              "name": "call-impact-details"
                            },
                            {
                              "type": 1,
                              "content": {
                                "json": "**Select a call from the left column to visualize its details**",
                                "style": "info"
                              },
                              "customWidth": "70",
                              "conditionalVisibility": {
                                "parameterName": "call_impact_id",
                                "comparison": "isEqualTo"
                              },
                              "name": "call-impact-details-info"
                            }
                          ]
                        },
                        "conditionalVisibility": {
                          "parameterName": "call_impact",
                          "comparison": "isNotEqualTo"
                        },
                        "name": "call-impact-details-group"
                      }
                    ]
                  },
                  "name": "overview-impacted-calls"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let CallOverview = ACSCallDiagnostics\r\n| join kind=inner ACSCallSummary on CorrelationId, ParticipantId, EndpointId;\r\n\r\nCallOverview\r\n| where CallStartTime {time_range:query}\r\n| summarize media_types=count() by MediaType\r\n| render piechart",
                    "size": 0,
                    "title": "Media Type Ratio",
                    "noDataMessage": "No media streams found in the specified time range",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices"
                  },
                  "customWidth": "50",
                  "name": "voice-video-media-types"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let CallOverview = ACSCallDiagnostics\r\n| join kind=inner ACSCallSummary on CorrelationId, ParticipantId, EndpointId;\r\n\r\nCallOverview\r\n| where CallStartTime {time_range:query}\r\n| summarize endpoint_types=count() by EndpointType\r\n| render piechart",
                    "size": 0,
                    "title": "Endpoint Types",
                    "noDataMessage": "No endpoints found in the specified time range",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices"
                  },
                  "customWidth": "50",
                  "name": "voice-video-endpoint-types"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ACSCallSummary\r\n| where CallStartTime {time_range:query}\r\n| extend SimpleOs = case(  indexof(OsVersion, \"Android\") != -1, tostring(split(OsVersion, \";\")[0]),\r\n                            indexof(OsVersion, \"Darwin\") != -1, tostring(split(OsVersion, \":\")[0]),\r\n                            indexof(OsVersion, \"Windows\") != -1, tostring(split(OsVersion, \".\")[0]),\r\n                            OsVersion\r\n                        )\r\n| summarize OsCounts=count() by SimpleOs\r\n| render piechart",
                    "size": 0,
                    "title": "OS Usage",
                    "noDataMessage": "No OS information reported in the specified time range",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices"
                  },
                  "customWidth": "50",
                  "name": "voice-video-os-usage"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "title": "Participant End Reasons",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "let SIPCodes =  datatable(ParticipantEndReason: string, SIPCode: string)\r\n[\r\n    \"0\",   \"Success\",\r\n    \"100\", \"Trying\",\r\n    \"180\", \"Ringing\",\r\n    \"181\", \"Call Is Being Forwarded\",\r\n    \"182\", \"Queued\",\r\n    \"183\", \"Session Progress\",\r\n    \"199\", \"Early Dialog Terminated\",\r\n    \"200\", \"Success\",\r\n    \"202\", \"Accepted\",\r\n    \"204\", \"No Notification\",\r\n    \"300\", \"Multiple Choices\",\r\n    \"301\", \"Moved Permanently\",\r\n    \"302\", \"Moved Temporarily\",\r\n    \"305\", \"Use Proxy\",\r\n    \"380\", \"Alternative Service\",\r\n    \"400\", \"Bad Request\",\r\n    \"401\", \"Unauthorized\",\r\n    \"402\", \"Payment Required\",\r\n    \"403\", \"Forbidden / Authentication failure\",\r\n    \"404\", \"Call not found\",\r\n    \"405\", \"Method Not Allowed\",\r\n    \"406\", \"Not Acceptable\",\r\n    \"407\", \"Proxy Authentication Required\",\r\n    \"408\", \"Call controller timed out\",\r\n    \"409\", \"Conflict\",\r\n    \"410\", \"Local media stack or media infrastructure error\",\r\n    \"411\", \"Length Required\",\r\n    \"412\", \"Conditional Request Failed\",\r\n    \"413\", \"Request Entity Too Large\",\r\n    \"414\", \"Request-URI Too Large\",\r\n    \"415\", \"Unsupported Media Type\",\r\n    \"416\", \"Unsupported URI Scheme\",\r\n    \"417\", \"Unknown Resource-Priority\",\r\n    \"420\", \"Bad Extension\",\r\n    \"421\", \"Extension Required\",\r\n    \"422\", \"Session Interval Too Small\",\r\n    \"423\", \"Interval Too Brief\",\r\n    \"424\", \"Bad Location Information\",\r\n    \"428\", \"Use Identity Header\",\r\n    \"429\", \"Provide Referrer Identity\",\r\n    \"430\", \"Unable to deliver message to client application\",\r\n    \"433\", \"Anonymity Disallowed\",\r\n    \"436\", \"Bad Identity-Info\",\r\n    \"437\", \"Unsupported Certificate\",\r\n    \"438\", \"Invalid Identity Header\",\r\n    \"439\", \"First Hop Lacks Outbound Support\",\r\n    \"440\", \"Max-Breadth Exceeded\",\r\n    \"469\", \"Bad Info Package\",\r\n    \"470\", \"Consent Needed\",\r\n    \"480\", \"Remote client endpoint not registered\",\r\n    \"481\", \"Failed to handle incoming call\",\r\n    \"482\", \"Loop Detected\",\r\n    \"483\", \"Too Many Hops\",\r\n    \"484\", \"Address Incomplete\",\r\n    \"485\", \"Ambiguous\",\r\n    \"486\", \"Busy Here\",\r\n    \"487\", \"Call canceled, locally declined, ended due to an endpoint mismatch issue, or failed to generate media offer\",\r\n    \"488\", \"Not Acceptable Here\",\r\n    \"489\", \"Bad Event\",\r\n    \"490\", \"Local endpoint network issues\",\r\n    \"491\", \"Local endpoint network issues\",\r\n    \"493\", \"Undecipherable\",\r\n    \"494\", \"Security Agreement Required\",\r\n    \"496\", \"Local endpoint network issues\",\r\n    \"497\", \"Local endpoint network issues\",\r\n    \"498\", \"Local endpoint network issues\",\r\n    \"500\", \"Communication Services infrastructure error\",\r\n    \"501\", \"Not Implemented\",\r\n    \"502\", \"Bad Gateway\",\r\n    \"503\", \"Communication Services infrastructure error\",\r\n    \"504\", \"Communication Services infrastructure error\",\r\n    \"505\", \"Version Not Supported\",\r\n    \"513\", \"Message Too Large\",\r\n    \"555\", \"Push Notification Service Not Supported\",\r\n    \"580\", \"Precondition Failure\",\r\n    \"600\", \"Busy Everywhere\",\r\n    \"603\", \"Call globally declined by remote Communication Services participant\",\r\n    \"604\", \"Does Not Exist Anywhere\",\r\n    \"606\", \"Not Acceptable\",\r\n    \"607\", \"Unwanted\",\r\n    \"608\", \"Rejected\",\r\n];\r\n\r\n\r\nACSCallSummary\r\n| where CallStartTime {time_range:query}\r\n| join kind=leftouter SIPCodes on ParticipantEndReason\r\n| extend EndReason=strcat(ParticipantEndReason, \": \", SIPCode)\r\n| summarize EndReasonCounts=count() by EndReason//ParticipantEndReason, SIPCode=SIPCode\r\n| render piechart",
                          "size": 0,
                          "noDataMessage": "No participants found in the specified time range",
                          "exportFieldName": "series",
                          "exportParameterName": "selected_end_reason",
                          "queryType": 0,
                          "resourceType": "microsoft.communication/communicationservices"
                        },
                        "name": "voice-video-participant-end-reasons"
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "voice-video-participant-end-reasons-group"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "calling_tab",
              "comparison": "isEqualTo",
              "value": "general"
            },
            "name": "voice-video-summary"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "The Volume tab within \"Voice and video\" displays counts of calls and participants over time."
                  },
                  "name": "voice-video-volume-text"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "d2f5dd7b-1559-4d49-aff9-d7e046049210",
                        "version": "KqlParameterItem/1.0",
                        "name": "usage_grouping",
                        "label": "Grouping",
                        "type": 2,
                        "value": "by Interop",
                        "typeSettings": {
                          "additionalResourceOptions": [],
                          "showDefault": false
                        },
                        "jsonData": "[\r\n    {\"value\": \"by Interop\", \"label\": \"Interop type\"},\r\n    {\"value\": \"by CallType\", \"label\": \"Call type\"}\r\n]",
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      },
                      {
                        "id": "1ca814c8-26f3-457f-9170-c41449e167a7",
                        "version": "KqlParameterItem/1.0",
                        "name": "duration_unit",
                        "label": "Duration unit",
                        "type": 2,
                        "isRequired": true,
                        "typeSettings": {
                          "additionalResourceOptions": []
                        },
                        "jsonData": "[\r\n    { \"value\":\"1\", \"label\":\"Seconds\" },\r\n    { \"value\":\"60\", \"label\":\"Minutes\", \"selected\":true },\r\n    { \"value\":\"3600\", \"label\":\"Hours\" },\r\n    { \"value\":\"86400\", \"label\":\"Days\" }\r\n]"
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices"
                  },
                  "name": "voice-video-volume-params"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ACSCallSummary\r\n| distinct CorrelationId, TeamsThreadId, CallStartTime, CallType, CallDuration\r\n//| extend Interop=iff(isnull(TeamsThreadId), \"ACS\", \"Teams Interop\") // Current data might not have the right null format\r\n| extend Interop=iff(isempty(TeamsThreadId), \"ACS\", \"Teams Interop\")\r\n| make-series time_seconds=toreal(sum(CallDuration)) / {duration_unit} default=0 on CallStartTime from {time_range:start} to {time_range:end} step {time_granularity} {usage_grouping}",
                    "size": 0,
                    "title": "Calling time in {duration_unit:label} {usage_grouping}",
                    "noDataMessage": "No calls found in the specified time range",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices",
                    "visualization": "barchart"
                  },
                  "customWidth": "50",
                  "name": "voice-video-volume-calls"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ACSCallSummary\r\n| distinct CorrelationId, TeamsThreadId, CallStartTime, CallType, ParticipantId, ParticipantDuration, EndpointId, Identifier\r\n//| extend Interop=iff(isnull(TeamsThreadId), \"ACS\", \"Teams Interop\")\r\n| extend Interop=iff(Identifier startswith \"acs:\", \"ACS\", \"Teams Interop\")\r\n| make-series time_seconds=toreal(sum(ParticipantDuration)) / {duration_unit} default=0 on CallStartTime from {time_range:start} to {time_range:end} step {time_granularity} {usage_grouping}",
                    "size": 0,
                    "title": "Participant calling time in {duration_unit:label} {usage_grouping}",
                    "noDataMessage": "No participant found in the specified time range",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices",
                    "visualization": "barchart"
                  },
                  "customWidth": "50",
                  "name": "voice-video-volume-participants"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "calling_tab",
              "comparison": "isEqualTo",
              "value": "usage"
            },
            "name": "voice-video-volume"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Call drill-down",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "The Details tab within \"Voice and video\" displays an expandable view of individual calls, broken down to the participant and stream level, with duration and quality metrics.\r\n\r\nTo easily detect problematic calls and participants, the following icons denote specific situations:\r\n- ðŸ›‘ indicates a failed participant end reason\r\n- ðŸš© indicates a call with at least one stream with unhealthy telemetry values\r\n- ðŸ”€ marks Teams interop calls or participants\r\n- ðŸ“ž marks a call that consists entirely of Azure Communication Services (ACS)\r\n\r\nTo search for a specific call, enter the callId below. Note this will be overidden if a callId is selected from the table below."
                  },
                  "name": "details_info"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "229e2b8b-5dec-4ec1-b939-49933f704eb7",
                        "version": "KqlParameterItem/1.0",
                        "name": "call_id",
                        "label": "Search by Call Id ",
                        "type": 2,
                        "description": "Enter a Call Id to show more details below",
                        "query": "ACSCallDiagnostics\r\n| join kind=inner ACSCallSummary on CorrelationId, ParticipantId, EndpointId\r\n| where CallStartTime {time_range:query}\r\n| distinct CorrelationId\r\n| project-rename callId = CorrelationId",
                        "typeSettings": {
                          "additionalResourceOptions": []
                        },
                        "queryType": 0,
                        "resourceType": "microsoft.communication/communicationservices",
                        "value": null
                      }
                    ],
                    "style": "formHorizontal",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices"
                  },
                  "customWidth": "20",
                  "name": "search_by_callId"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let summaryOfLegs = \r\nACSCallDiagnostics\r\n| join kind=inner ACSCallSummary on CorrelationId, ParticipantId, EndpointId\r\n| where CallStartTime {time_range:query}                 \r\n| summarize take_any(EndpointType) by Identifier, CorrelationId;\r\nlet typeCount = summaryOfLegs | summarize count() by EndpointType, CorrelationId\r\n| extend info = strcat(count_, ' ', EndpointType) | summarize summaryInfo = make_list(info, 100) by CorrelationId | extend user_info = strcat_array(summaryInfo, ', ');\r\nlet totalNumOfUser = summaryOfLegs | summarize Count = count() by CorrelationId;\r\nACSCallDiagnostics\r\n| join kind=inner ACSCallSummary on CorrelationId, ParticipantId, EndpointId\r\n| where CallStartTime {time_range:query}\r\n| order by CallStartTime asc, ParticipantStartTime asc\r\n| extend CallDate=strcat(\"ðŸ“…\", format_datetime(CallStartTime, 'MM/dd/y'))\r\n| extend CallTime=format_datetime(CallStartTime, 'hh:mm:ss')\r\n| extend UnsuccessfulEndReason = iff((ParticipantEndReason startswith \"0\") or (ParticipantEndReason startswith \"2\"), \"\", \"ðŸ›‘\")\r\n| extend InteropType = iff(isempty(TeamsThreadId), \"ðŸ“ž ACS call\", \"ðŸ”€ Teams interop\")\r\n| extend JitterQuality = iff(JitterAvg > 30, \"Poor\", \"Good\")\r\n| extend PacketLossRateQuality = iff(PacketLossRateAvg > 0.1, \"Poor\", \"Good\")\r\n| extend RoundTripTimeQuality = iff(RoundTripTimeAvg > 500, \"Poor\", \"Good\")\r\n| extend StreamQuality = iff((JitterQuality == \"Poor\") or (PacketLossRateQuality == \"Poor\") or (RoundTripTimeQuality == \"Poor\"), \"ðŸš©\", \"\")\r\n| extend CallLabel = strcat(UnsuccessfulEndReason, \" \", StreamQuality)\r\n| extend CallEndTime = CallStartTime + totimespan(strcat(tostring(CallDuration), 's'))\r\n| summarize arg_max(CallLabel, *) by CorrelationId\r\n| project CallDate, InteropType, CallLabel, CorrelationId, CallStartTime, CallEndTime\r\n| join kind=inner totalNumOfUser on CorrelationId\r\n| join kind=inner typeCount on CorrelationId\r\n| project CallDate, InteropType, CallLabel, CallId = CorrelationId, CallStartTime, CallEndTime, [\"Total Number of Users\"] = Count, [\"User Type Breakdown\"] = user_info",
                    "size": 0,
                    "noDataMessage": "No calls found for the specified time range",
                    "exportFieldName": "CallId",
                    "exportParameterName": "call_id",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Group",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "CallDate",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "CallLabel",
                          "formatter": 5
                        }
                      ],
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "CallDate"
                        ],
                        "expandTopLevel": true,
                        "finalBy": "CallLabel"
                      }
                    }
                  },
                  "customWidth": "100",
                  "name": "call_ids"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SIPCodes =  datatable(ParticipantEndReason: string, SIPCode: string, Troubleshooting: string)\r\n[\r\n    \"0\",   \"Success\", \"\",\r\n    \"100\", \"Trying\", \"\",\r\n    \"180\", \"Ringing\", \"\",\r\n    \"181\", \"Call Is Being Forwarded\", \"\",\r\n    \"182\", \"Queued\", \"\",\r\n    \"183\", \"Session Progress\", \"\",\r\n    \"199\", \"Early Dialog Terminated\", \"\",\r\n    \"200\", \"Success\", \"\",\r\n    \"202\", \"Accepted\", \"\",\r\n    \"204\", \"No Notification\", \"\",\r\n    \"300\", \"Multiple Choices\", \"\",\r\n    \"301\", \"Moved Permanently\", \"\",\r\n    \"302\", \"Moved Temporarily\", \"\",\r\n    \"305\", \"Use Proxy\", \"\",\r\n    \"380\", \"Alternative Service\", \"\",\r\n    \"400\", \"Bad Request\", \"\",\r\n    \"401\", \"Unauthorized\", \"\",\r\n    \"402\", \"Payment Required\", \"\",\r\n    \"403\", \"Forbidden / Authentication failure\", \"Ensure that your Communication Services token is valid and not expired.\",\r\n    \"404\", \"Call not found\", \"Ensure that the number you're calling (or call you're joining) exists.\",\r\n    \"405\", \"Method Not Allowed\", \"\",\r\n    \"406\", \"Not Acceptable\", \"\",\r\n    \"407\", \"Proxy Authentication Required\", \"\",\r\n    \"408\", \"Call controller timed out\", \"Call Controller timed out waiting for protocol messages from user endpoints. Ensure clients are connected and available.\",\r\n    \"409\", \"Conflict\", \"\",\r\n    \"410\", \"Local media stack or media infrastructure error\", \"Ensure that you're using the latest SDK in a supported environment.\",\r\n    \"411\", \"Length Required\", \"\",\r\n    \"412\", \"Conditional Request Failed\", \"\",\r\n    \"413\", \"Request Entity Too Large\", \"\",\r\n    \"414\", \"Request-URI Too Large\", \"\",\r\n    \"415\", \"Unsupported Media Type\", \"\",\r\n    \"416\", \"Unsupported URI Scheme\", \"\",\r\n    \"417\", \"Unknown Resource-Priority\", \"\",\r\n    \"420\", \"Bad Extension\", \"\",\r\n    \"421\", \"Extension Required\", \"\",\r\n    \"422\", \"Session Interval Too Small\", \"\",\r\n    \"423\", \"Interval Too Brief\", \"\",\r\n    \"424\", \"Bad Location Information\", \"\",\r\n    \"428\", \"Use Identity Header\", \"\",\r\n    \"429\", \"Provide Referrer Identity\", \"\",\r\n    \"430\", \"Unable to deliver message to client application\", \"Ensure that the client application is running and available.\",\r\n    \"433\", \"Anonymity Disallowed\", \"\",\r\n    \"436\", \"Bad Identity-Info\", \"\",\r\n    \"437\", \"Unsupported Certificate\", \"\",\r\n    \"438\", \"Invalid Identity Header\", \"\",\r\n    \"439\", \"First Hop Lacks Outbound Support\", \"\",\r\n    \"440\", \"Max-Breadth Exceeded\", \"\",\r\n    \"469\", \"Bad Info Package\", \"\",\r\n    \"470\", \"Consent Needed\", \"\",\r\n    \"480\", \"Remote client endpoint not registered\", \"Ensure that the remote endpoint is available.\",\r\n    \"481\", \"Failed to handle incoming call\", \"File a support request through the Azure portal.\",\r\n    \"482\", \"Loop Detected\", \"\",\r\n    \"483\", \"Too Many Hops\", \"\",\r\n    \"484\", \"Address Incomplete\", \"\",\r\n    \"485\", \"Ambiguous\", \"\",\r\n    \"486\", \"Busy Here\", \"\",\r\n    \"487\", \"Call canceled, locally declined, ended due to an endpoint mismatch issue, or failed to generate media offer\", \"Expected behavior.\",\r\n    \"488\", \"Not Acceptable Here\", \"\",\r\n    \"489\", \"Bad Event\", \"\",\r\n    \"490\", \"Local endpoint network issues\", \"Check your network.\",\r\n    \"491\", \"Local endpoint network issues\", \"Check your network.\",\r\n    \"493\", \"Undecipherable\", \"\",\r\n    \"494\", \"Security Agreement Required\", \"\",\r\n    \"496\", \"Local endpoint network issues\", \"Check your network.\",\r\n    \"497\", \"Local endpoint network issues\", \"Check your network.\",\r\n    \"498\", \"Local endpoint network issues\", \"Check your network.\",\r\n    \"500\", \"Communication Services infrastructure error\", \"File a support request through the Azure portal.\",\r\n    \"501\", \"Not Implemented\", \"\",\r\n    \"502\", \"Bad Gateway\", \"\",\r\n    \"503\", \"Communication Services infrastructure error\", \"File a support request through the Azure portal.\",\r\n    \"504\", \"Communication Services infrastructure error\", \"File a support request through the Azure portal.\",\r\n    \"505\", \"Version Not Supported\", \"\",\r\n    \"513\", \"Message Too Large\", \"\",\r\n    \"555\", \"Push Notification Service Not Supported\", \"\",\r\n    \"580\", \"Precondition Failure\", \"\",\r\n    \"600\", \"Busy Everywhere\", \"\",\r\n    \"603\", \"Call globally declined by remote Communication Services participant\", \"Expected behavior.\",\r\n    \"604\", \"Does Not Exist Anywhere\", \"\",\r\n    \"606\", \"Not Acceptable\", \"\",\r\n    \"607\", \"Unwanted\", \"\",\r\n    \"608\", \"Rejected\", \"\",\r\n];\r\nACSCallDiagnostics\r\n| where CorrelationId == \"{call_id}\"\r\n| join kind=inner ACSCallSummary on CorrelationId, ParticipantId, EndpointId\r\n| join kind=leftouter SIPCodes on ParticipantEndReason\r\n| extend EndReason=strcat(ParticipantEndReason, \": \", SIPCode)\r\n| extend UnsuccessfulEndReason = iff((ParticipantEndReason startswith \"0\") or (ParticipantEndReason startswith \"2\"), \"\", \"ðŸ›‘\")\r\n| extend EndpointType = case(  indexof(EndpointType, \"VoIP\") != -1, strcat(\"ðŸ—£ï¸ \", EndpointType),\r\n                            indexof(EndpointType, \"PSTN\") != -1, strcat(\"ðŸ“ž \", EndpointType),\r\n                            indexof(EndpointType, \"Bot\") != -1, strcat(\"ðŸ¤– \", EndpointType),\r\n                            indexof(EndpointType, \"Server\") != -1, strcat(\"ðŸ–¥ï¸ \", EndpointType),\r\n                            indexof(EndpointType, \"Unknown\") != -1, strcat(\"ðŸ‘½ \", EndpointType),\r\n                            EndpointType\r\n                        )\r\n| extend JitterQuality = iff(JitterAvg > 30, \"Poor\", \"Good\")\r\n| extend PacketLossRateQuality = iff(PacketLossRateAvg > 0.1, \"Poor\", \"Good\")\r\n| extend RoundTripTimeQuality = iff(RoundTripTimeAvg > 500, \"Poor\", \"Good\")\r\n| extend StreamQuality = iff((JitterQuality == \"Poor\") or (PacketLossRateQuality == \"Poor\") or (RoundTripTimeQuality == \"Poor\"), \"ðŸš©\", \"\")\r\n| extend ParticipantId = iff(isnotempty(ParticipantId) and ParticipantId != CorrelationId, ParticipantId, strcat(\"Endpoint ID:\", EndpointId))\r\n| extend Participant = strcat(EndpointType, \" (\", ParticipantType, \") \", UnsuccessfulEndReason, \" \", StreamQuality)\r\n| extend ParticipantEndTime = ParticipantStartTime + totimespan(strcat(tostring(ParticipantDuration), 's'))\r\n| project CallId = CorrelationId, Participant, ParticipantId, EndReason, Identifier, ParticipantStartTime, ParticipantEndTime, ParticipantDuration, TransportType\r\n| summarize ParticipantStartTime = min(ParticipantStartTime), ParticipantEndTime = max(ParticipantEndTime),\r\nParticipantDuration = max(ParticipantDuration), Participant = max(Participant), EndReason = max(EndReason), TransportType = any(TransportType)\r\n by ParticipantId, CallId, Identifier\r\n| sort by ParticipantStartTime asc, Identifier asc\r\n| extend User = row_rank_dense(Identifier)\r\n| project User, ParticipantType=Participant, ParticipantId, EndReason, TransportType, ParticipantStartTime, ParticipantEndTime, ParticipantDuration",
                    "size": 0,
                    "title": "Participant details for call {call_id}",
                    "noDataMessage": "Enter a callId in the search bar or select a call from the top table to visualize its details",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "EndReason",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "startsWith",
                                "thresholdValue": "2",
                                "representation": "success",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "startsWith",
                                "thresholdValue": "0",
                                "representation": "success",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "error",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "ParticipantDuration",
                          "formatter": 19,
                          "formatOptions": {
                            "palette": "bluePurple",
                            "timelineSettings": {
                              "timelineStartColumn": "ParticipantStartTime"
                            },
                            "customColumnWidthSetting": "100ch"
                          },
                          "numberFormat": {
                            "unit": 24,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumFractionDigits": 0
                            }
                          }
                        },
                        {
                          "columnMatch": "Group",
                          "formatter": 1
                        }
                      ]
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "call_id",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "participant-details"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "Streams are classified as healthy if they exhibit telemetry values within the following ranges:\r\n\r\n- Round trip time under 500 milliseconds\r\n- Packet loss rate of less than 10%\r\n- Jitter under 30 milliseconds"
                  },
                  "conditionalVisibility": {
                    "parameterName": "call_id",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "steam-health-classification"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SIPCodes =  datatable(ParticipantEndReason: string, SIPCode: string, Troubleshooting: string)\r\n[\r\n    \"0\",   \"Success\", \"\",\r\n    \"100\", \"Trying\", \"\",\r\n    \"180\", \"Ringing\", \"\",\r\n    \"181\", \"Call Is Being Forwarded\", \"\",\r\n    \"182\", \"Queued\", \"\",\r\n    \"183\", \"Session Progress\", \"\",\r\n    \"199\", \"Early Dialog Terminated\", \"\",\r\n    \"200\", \"Success\", \"\",\r\n    \"202\", \"Accepted\", \"\",\r\n    \"204\", \"No Notification\", \"\",\r\n    \"300\", \"Multiple Choices\", \"\",\r\n    \"301\", \"Moved Permanently\", \"\",\r\n    \"302\", \"Moved Temporarily\", \"\",\r\n    \"305\", \"Use Proxy\", \"\",\r\n    \"380\", \"Alternative Service\", \"\",\r\n    \"400\", \"Bad Request\", \"\",\r\n    \"401\", \"Unauthorized\", \"\",\r\n    \"402\", \"Payment Required\", \"\",\r\n    \"403\", \"Forbidden / Authentication failure\", \"Ensure that your Communication Services token is valid and not expired.\",\r\n    \"404\", \"Call not found\", \"Ensure that the number you're calling (or call you're joining) exists.\",\r\n    \"405\", \"Method Not Allowed\", \"\",\r\n    \"406\", \"Not Acceptable\", \"\",\r\n    \"407\", \"Proxy Authentication Required\", \"\",\r\n    \"408\", \"Call controller timed out\", \"Call Controller timed out waiting for protocol messages from user endpoints. Ensure clients are connected and available.\",\r\n    \"409\", \"Conflict\", \"\",\r\n    \"410\", \"Local media stack or media infrastructure error\", \"Ensure that you're using the latest SDK in a supported environment.\",\r\n    \"411\", \"Length Required\", \"\",\r\n    \"412\", \"Conditional Request Failed\", \"\",\r\n    \"413\", \"Request Entity Too Large\", \"\",\r\n    \"414\", \"Request-URI Too Large\", \"\",\r\n    \"415\", \"Unsupported Media Type\", \"\",\r\n    \"416\", \"Unsupported URI Scheme\", \"\",\r\n    \"417\", \"Unknown Resource-Priority\", \"\",\r\n    \"420\", \"Bad Extension\", \"\",\r\n    \"421\", \"Extension Required\", \"\",\r\n    \"422\", \"Session Interval Too Small\", \"\",\r\n    \"423\", \"Interval Too Brief\", \"\",\r\n    \"424\", \"Bad Location Information\", \"\",\r\n    \"428\", \"Use Identity Header\", \"\",\r\n    \"429\", \"Provide Referrer Identity\", \"\",\r\n    \"430\", \"Unable to deliver message to client application\", \"Ensure that the client application is running and available.\",\r\n    \"433\", \"Anonymity Disallowed\", \"\",\r\n    \"436\", \"Bad Identity-Info\", \"\",\r\n    \"437\", \"Unsupported Certificate\", \"\",\r\n    \"438\", \"Invalid Identity Header\", \"\",\r\n    \"439\", \"First Hop Lacks Outbound Support\", \"\",\r\n    \"440\", \"Max-Breadth Exceeded\", \"\",\r\n    \"469\", \"Bad Info Package\", \"\",\r\n    \"470\", \"Consent Needed\", \"\",\r\n    \"480\", \"Remote client endpoint not registered\", \"Ensure that the remote endpoint is available.\",\r\n    \"481\", \"Failed to handle incoming call\", \"File a support request through the Azure portal.\",\r\n    \"482\", \"Loop Detected\", \"\",\r\n    \"483\", \"Too Many Hops\", \"\",\r\n    \"484\", \"Address Incomplete\", \"\",\r\n    \"485\", \"Ambiguous\", \"\",\r\n    \"486\", \"Busy Here\", \"\",\r\n    \"487\", \"Call canceled, locally declined, ended due to an endpoint mismatch issue, or failed to generate media offer\", \"Expected behavior.\",\r\n    \"488\", \"Not Acceptable Here\", \"\",\r\n    \"489\", \"Bad Event\", \"\",\r\n    \"490\", \"Local endpoint network issues\", \"Check your network.\",\r\n    \"491\", \"Local endpoint network issues\", \"Check your network.\",\r\n    \"493\", \"Undecipherable\", \"\",\r\n    \"494\", \"Security Agreement Required\", \"\",\r\n    \"496\", \"Local endpoint network issues\", \"Check your network.\",\r\n    \"497\", \"Local endpoint network issues\", \"Check your network.\",\r\n    \"498\", \"Local endpoint network issues\", \"Check your network.\",\r\n    \"500\", \"Communication Services infrastructure error\", \"File a support request through the Azure portal.\",\r\n    \"501\", \"Not Implemented\", \"\",\r\n    \"502\", \"Bad Gateway\", \"\",\r\n    \"503\", \"Communication Services infrastructure error\", \"File a support request through the Azure portal.\",\r\n    \"504\", \"Communication Services infrastructure error\", \"File a support request through the Azure portal.\",\r\n    \"505\", \"Version Not Supported\", \"\",\r\n    \"513\", \"Message Too Large\", \"\",\r\n    \"555\", \"Push Notification Service Not Supported\", \"\",\r\n    \"580\", \"Precondition Failure\", \"\",\r\n    \"600\", \"Busy Everywhere\", \"\",\r\n    \"603\", \"Call globally declined by remote Communication Services participant\", \"Expected behavior.\",\r\n    \"604\", \"Does Not Exist Anywhere\", \"\",\r\n    \"606\", \"Not Acceptable\", \"\",\r\n    \"607\", \"Unwanted\", \"\",\r\n    \"608\", \"Rejected\", \"\",\r\n];\r\nACSCallDiagnostics\r\n| where CorrelationId == \"{call_id}\"\r\n| join kind=inner ACSCallSummary on CorrelationId, ParticipantId, EndpointId\r\n| join kind=leftouter SIPCodes on ParticipantEndReason\r\n| extend EndReason=strcat(ParticipantEndReason, \": \", SIPCode)\r\n| extend UnsuccessfulEndReason = iff((ParticipantEndReason startswith \"0\") or (ParticipantEndReason startswith \"2\"), \"\", \"ðŸ›‘\")\r\n| extend EndpointType = case(  indexof(EndpointType, \"VoIP\") != -1, strcat(\"ðŸ—£ï¸ \", EndpointType),\r\n                            indexof(EndpointType, \"PSTN\") != -1, strcat(\"ðŸ“ž \", EndpointType),\r\n                            indexof(EndpointType, \"Bot\") != -1, strcat(\"ðŸ¤– \", EndpointType),\r\n                            indexof(EndpointType, \"Server\") != -1, strcat(\"ðŸ–¥ï¸ \", EndpointType),\r\n                            indexof(EndpointType, \"Unknown\") != -1, strcat(\"ðŸ‘½ \", EndpointType),\r\n                            EndpointType\r\n                        )\r\n| extend JitterQuality = iff(JitterAvg > 30, \"Poor\", \"Good\")\r\n| extend PacketLossRateQuality = iff(PacketLossRateAvg > 0.1, \"Poor\", \"Good\")\r\n| extend RoundTripTimeQuality = iff(RoundTripTimeAvg > 500, \"Poor\", \"Good\")\r\n| extend StreamQuality = iff((JitterQuality == \"Poor\") or (PacketLossRateQuality == \"Poor\") or (RoundTripTimeQuality == \"Poor\"), \"ðŸš©\", \"\")\r\n| extend ParticipantId = iff(isnotempty(ParticipantId) and ParticipantId != CorrelationId, ParticipantId, strcat(\"Endpoint ID:\", EndpointId))\r\n| extend Participant = strcat(EndpointType, \" (\", ParticipantType, \") \", UnsuccessfulEndReason, \" \", \" (\", ParticipantId, \")\")\r\n| extend ParticipantEndTime = ParticipantStartTime + totimespan(strcat(tostring(ParticipantDuration), 's'))\r\n| extend MediaType = case(  indexof(MediaType, \"Audio\") != -1, strcat(\"ðŸ”Š \", MediaType),\r\n                            indexof(MediaType, \"Video\") != -1, strcat(\"ðŸŽ¥ \", MediaType),\r\n                            indexof(MediaType, \"VBSS\") != -1, strcat(\"ðŸ’» \", MediaType),\r\n                            indexof(MediaType, \"AppSharing\") != -1, strcat(\"ðŸ“² \", MediaType),\r\n                            MediaType\r\n                        )\r\n| extend MediaType = strcat(MediaType, \" \", StreamQuality)\r\n| sort by ParticipantStartTime asc, Identifier asc\r\n| extend User = row_rank_dense(Identifier)\r\n| project Participant, MediaType, User, EndReason, StreamId, JitterAvg, PacketLossRateAvg, RoundTripTimeAvg\r\n| summarize JitterAvg=take_any(JitterAvg), PacketLossRateAvg=take_any(PacketLossRateAvg), RoundTripTimeAvg=take_any(RoundTripTimeAvg) \r\nby Participant, MediaType, User, EndReason, StreamId\r\n| project-away StreamId\r\n",
                    "size": 0,
                    "title": "Stream details for call {call_id}",
                    "noDataMessage": "Enter a callId in the search bar or select a call from the top table to visualize its details",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Group",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Participant",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "MediaType",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "User",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "EndReason",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "startsWith",
                                "thresholdValue": "0",
                                "representation": "success",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "startsWith",
                                "thresholdValue": "2",
                                "representation": "success",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "error",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "JitterAvg",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": ">",
                                "thresholdValue": "30",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "PacketLossRateAvg",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": ">",
                                "thresholdValue": ".1",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "RoundTripTimeAvg",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": ">",
                                "thresholdValue": "500",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "Participant"
                        ],
                        "expandTopLevel": true,
                        "finalBy": "MediaType"
                      }
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "call_id",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "stream-details"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "calling_tab",
              "comparison": "isEqualTo",
              "value": "details"
            },
            "name": "call-drill-down"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "tab",
        "comparison": "isEqualTo",
        "value": "calling"
      },
      "name": "call_quality"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "The following visualizations represent data from the Authentication Operational logs.\r\n\r\n**Click on any part of the pie charts below to visualize filtered logs.**"
            },
            "name": "auth-text"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Authentication API Results",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ACSAuthIncomingOperations\r\n| where TimeGenerated {time_range:query}\r\n| summarize count() by ResultType\r\n| render piechart",
                    "size": 0,
                    "noDataMessage": "No authentication operations found in the specified time range",
                    "exportMultipleValues": true,
                    "exportedParameters": [
                      {
                        "fieldName": "series",
                        "parameterName": "auth_result",
                        "parameterType": 1
                      }
                    ],
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices"
                  },
                  "name": "auth-result-types"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SIPCodesAuth =  datatable(ResultSignature: string, SIPCode: string)\r\n[\r\n    \"0\", \"Success\",\r\n    \"100\", \"Trying\",\r\n    \"180\", \"Ringing\",\r\n    \"181\", \"Call Is Being Forwarded\",\r\n    \"182\", \"Queued\",\r\n    \"183\", \"Session Progress\",\r\n    \"199\", \"Early Dialog Terminated\",\r\n    \"200\", \"Success\",\r\n    \"202\", \"Accepted\",\r\n    \"204\", \"No Notification\",\r\n    \"300\", \"Multiple Choices\",\r\n    \"301\", \"Moved Permanently\",\r\n    \"302\", \"Moved Temporarily\",\r\n    \"305\", \"Use Proxy\",\r\n    \"380\", \"Alternative Service\",\r\n    \"400\", \"Bad Request\",\r\n    \"401\", \"Unauthorized\",\r\n    \"402\", \"Payment Required\",\r\n    \"403\", \"Forbidden\",\r\n    \"404\", \"Not Found\",\r\n    \"405\", \"Method Not Allowed\",\r\n    \"406\", \"Not Acceptable\",\r\n    \"407\", \"Proxy Authentication Required\",\r\n    \"408\", \"Request Timeout\",\r\n    \"409\", \"Conflict\",\r\n    \"410\", \"Gone\",\r\n    \"411\", \"Length Required\",\r\n    \"412\", \"Conditional Request Failed\",\r\n    \"413\", \"Request Entity Too Large\",\r\n    \"414\", \"Request-URI Too Large\",\r\n    \"415\", \"Unsupported Media Type\",\r\n    \"416\", \"Unsupported URI Scheme\",\r\n    \"417\", \"Unknown Resource-Priority\",\r\n    \"420\", \"Bad Extension\",\r\n    \"421\", \"Extension Required\",\r\n    \"422\", \"Session Interval Too Small\",\r\n    \"423\", \"Interval Too Brief\",\r\n    \"424\", \"Bad Location Information\",\r\n    \"428\", \"Use Identity Header\",\r\n    \"429\", \"Provide Referrer Identity\",\r\n    \"430\", \"Flow Failed\",\r\n    \"433\", \"Anonymity Disallowed\",\r\n    \"436\", \"Bad Identity-Info\",\r\n    \"437\", \"Unsupported Certificate\",\r\n    \"438\", \"Invalid Identity Header\",\r\n    \"439\", \"First Hop Lacks Outbound Support\",\r\n    \"440\", \"Max-Breadth Exceeded\",\r\n    \"469\", \"Bad Info Package\",\r\n    \"470\", \"Consent Needed\",\r\n    \"480\", \"Temporarily Unavailable\",\r\n    \"481\", \"Call/Transaction Does Not Exist\",\r\n    \"482\", \"Loop Detected\",\r\n    \"483\", \"Too Many Hops\",\r\n    \"484\", \"Address Incomplete\",\r\n    \"485\", \"Ambiguous\",\r\n    \"486\", \"Busy Here\",\r\n    \"487\", \"Request Terminated\",\r\n    \"488\", \"Not Acceptable Here\",\r\n    \"489\", \"Bad Event\",\r\n    \"491\", \"Request Pending\",\r\n    \"493\", \"Undecipherable\",\r\n    \"494\", \"Security Agreement Required\",\r\n    \"500\", \"Internal Server Error\",\r\n    \"501\", \"Not Implemented\",\r\n    \"502\", \"Bad Gateway\",\r\n    \"503\", \"Service Unavailable\",\r\n    \"504\", \"Server Time-out\",\r\n    \"505\", \"Version Not Supported\",\r\n    \"513\", \"Message Too Large\",\r\n    \"555\", \"Push Notification Service Not Supported\",\r\n    \"580\", \"Precondition Failure\",\r\n    \"600\", \"Busy Everywhere\",\r\n    \"603\", \"Decline\",\r\n    \"604\", \"Does Not Exist Anywhere\",\r\n    \"606\", \"Not Acceptable\",\r\n    \"607\", \"Unwanted\",\r\n    \"608\", \"Rejected\",\r\n];\r\n\r\nlet other_auth_results = ACSAuthIncomingOperations\r\n| where TimeGenerated {time_range:query}\r\n| summarize operation_count=count() by ResultType\r\n| order by operation_count desc\r\n| extend Rank=row_number()\r\n| where Rank > 5\r\n| project ResultType;\r\n\r\nACSAuthIncomingOperations\r\n| where TimeGenerated {time_range:query} and (ResultType in (dynamic([{auth_result}])) or iff(\"Other\" in (dynamic([{auth_result}])), (ResultType in (other_auth_results)), false))\r\n| join kind=leftouter SIPCodesAuth on ResultSignature\r\n| extend OperationDate=strcat(\"ðŸ“…\", format_datetime(TimeGenerated, 'MM/dd/y'))\r\n| extend OperationTime=format_datetime(TimeGenerated, 'hh:mm:ss')\r\n| extend ResultIcon=iff(ResultType == \"Succeeded\", \"âœ”ï¸\", \"âŒ\")\r\n| extend Result=strcat(ResultIcon, \" \", ResultSignature, \": \", SIPCode)\r\n| order by TimeGenerated\r\n| project OperationName, Level, Result, OperationDate, OperationTime, DurationMs\r\n",
                    "size": 0,
                    "title": "Authentication operations with result type {auth_result}",
                    "noDataMessage": "No authentication operations found for the specified time range and result type",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Level",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Warning",
                                "representation": "warning",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "info",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "OperationDate",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "OperationTime",
                          "formatter": 5
                        }
                      ],
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "OperationDate"
                        ],
                        "expandTopLevel": true,
                        "finalBy": "OperationTime"
                      }
                    },
                    "sortBy": []
                  },
                  "conditionalVisibility": {
                    "parameterName": "auth_result",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "auth-by-result"
                }
              ]
            },
            "customWidth": "50",
            "name": "auth-results-group"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Authentication API Result Signatures",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SIPCodesAuth =  datatable(ResultSignature: string, SIPCode: string)\r\n[\r\n    \"0\", \"Success\",\r\n    \"100\", \"Trying\",\r\n    \"180\", \"Ringing\",\r\n    \"181\", \"Call Is Being Forwarded\",\r\n    \"182\", \"Queued\",\r\n    \"183\", \"Session Progress\",\r\n    \"199\", \"Early Dialog Terminated\",\r\n    \"200\", \"Success\",\r\n    \"202\", \"Accepted\",\r\n    \"204\", \"No Notification\",\r\n    \"300\", \"Multiple Choices\",\r\n    \"301\", \"Moved Permanently\",\r\n    \"302\", \"Moved Temporarily\",\r\n    \"305\", \"Use Proxy\",\r\n    \"380\", \"Alternative Service\",\r\n    \"400\", \"Bad Request\",\r\n    \"401\", \"Unauthorized\",\r\n    \"402\", \"Payment Required\",\r\n    \"403\", \"Forbidden\",\r\n    \"404\", \"Not Found\",\r\n    \"405\", \"Method Not Allowed\",\r\n    \"406\", \"Not Acceptable\",\r\n    \"407\", \"Proxy Authentication Required\",\r\n    \"408\", \"Request Timeout\",\r\n    \"409\", \"Conflict\",\r\n    \"410\", \"Gone\",\r\n    \"411\", \"Length Required\",\r\n    \"412\", \"Conditional Request Failed\",\r\n    \"413\", \"Request Entity Too Large\",\r\n    \"414\", \"Request-URI Too Large\",\r\n    \"415\", \"Unsupported Media Type\",\r\n    \"416\", \"Unsupported URI Scheme\",\r\n    \"417\", \"Unknown Resource-Priority\",\r\n    \"420\", \"Bad Extension\",\r\n    \"421\", \"Extension Required\",\r\n    \"422\", \"Session Interval Too Small\",\r\n    \"423\", \"Interval Too Brief\",\r\n    \"424\", \"Bad Location Information\",\r\n    \"428\", \"Use Identity Header\",\r\n    \"429\", \"Provide Referrer Identity\",\r\n    \"430\", \"Flow Failed\",\r\n    \"433\", \"Anonymity Disallowed\",\r\n    \"436\", \"Bad Identity-Info\",\r\n    \"437\", \"Unsupported Certificate\",\r\n    \"438\", \"Invalid Identity Header\",\r\n    \"439\", \"First Hop Lacks Outbound Support\",\r\n    \"440\", \"Max-Breadth Exceeded\",\r\n    \"469\", \"Bad Info Package\",\r\n    \"470\", \"Consent Needed\",\r\n    \"480\", \"Temporarily Unavailable\",\r\n    \"481\", \"Call/Transaction Does Not Exist\",\r\n    \"482\", \"Loop Detected\",\r\n    \"483\", \"Too Many Hops\",\r\n    \"484\", \"Address Incomplete\",\r\n    \"485\", \"Ambiguous\",\r\n    \"486\", \"Busy Here\",\r\n    \"487\", \"Request Terminated\",\r\n    \"488\", \"Not Acceptable Here\",\r\n    \"489\", \"Bad Event\",\r\n    \"491\", \"Request Pending\",\r\n    \"493\", \"Undecipherable\",\r\n    \"494\", \"Security Agreement Required\",\r\n    \"500\", \"Internal Server Error\",\r\n    \"501\", \"Not Implemented\",\r\n    \"502\", \"Bad Gateway\",\r\n    \"503\", \"Service Unavailable\",\r\n    \"504\", \"Server Time-out\",\r\n    \"505\", \"Version Not Supported\",\r\n    \"513\", \"Message Too Large\",\r\n    \"555\", \"Push Notification Service Not Supported\",\r\n    \"580\", \"Precondition Failure\",\r\n    \"600\", \"Busy Everywhere\",\r\n    \"603\", \"Decline\",\r\n    \"604\", \"Does Not Exist Anywhere\",\r\n    \"606\", \"Not Acceptable\",\r\n    \"607\", \"Unwanted\",\r\n    \"608\", \"Rejected\",\r\n];\r\n\r\nACSAuthIncomingOperations\r\n| where TimeGenerated {time_range:query}\r\n//| summarize count() by ResultSignature\r\n| join kind=leftouter SIPCodesAuth on ResultSignature\r\n| extend ResultIcon=iff(ResultType == \"Succeeded\", \"âœ”ï¸\", \"âŒ\")\r\n| extend Result=strcat(ResultIcon, \" \", ResultSignature, \": \", SIPCode)\r\n| summarize count() by Result//Signature\r\n| render piechart",
                    "size": 0,
                    "noDataMessage": "No authentication operations found in the specified time range",
                    "exportMultipleValues": true,
                    "exportedParameters": [
                      {
                        "fieldName": "series",
                        "parameterName": "auth_signature",
                        "parameterType": 1
                      }
                    ],
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices"
                  },
                  "name": "auth-results-signature"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SIPCodesAuth =  datatable(ResultSignature: string, SIPCode: string)\r\n[\r\n    \"0\", \"Success\",\r\n    \"100\", \"Trying\",\r\n    \"180\", \"Ringing\",\r\n    \"181\", \"Call Is Being Forwarded\",\r\n    \"182\", \"Queued\",\r\n    \"183\", \"Session Progress\",\r\n    \"199\", \"Early Dialog Terminated\",\r\n    \"200\", \"Success\",\r\n    \"202\", \"Accepted\",\r\n    \"204\", \"No Notification\",\r\n    \"300\", \"Multiple Choices\",\r\n    \"301\", \"Moved Permanently\",\r\n    \"302\", \"Moved Temporarily\",\r\n    \"305\", \"Use Proxy\",\r\n    \"380\", \"Alternative Service\",\r\n    \"400\", \"Bad Request\",\r\n    \"401\", \"Unauthorized\",\r\n    \"402\", \"Payment Required\",\r\n    \"403\", \"Forbidden\",\r\n    \"404\", \"Not Found\",\r\n    \"405\", \"Method Not Allowed\",\r\n    \"406\", \"Not Acceptable\",\r\n    \"407\", \"Proxy Authentication Required\",\r\n    \"408\", \"Request Timeout\",\r\n    \"409\", \"Conflict\",\r\n    \"410\", \"Gone\",\r\n    \"411\", \"Length Required\",\r\n    \"412\", \"Conditional Request Failed\",\r\n    \"413\", \"Request Entity Too Large\",\r\n    \"414\", \"Request-URI Too Large\",\r\n    \"415\", \"Unsupported Media Type\",\r\n    \"416\", \"Unsupported URI Scheme\",\r\n    \"417\", \"Unknown Resource-Priority\",\r\n    \"420\", \"Bad Extension\",\r\n    \"421\", \"Extension Required\",\r\n    \"422\", \"Session Interval Too Small\",\r\n    \"423\", \"Interval Too Brief\",\r\n    \"424\", \"Bad Location Information\",\r\n    \"428\", \"Use Identity Header\",\r\n    \"429\", \"Provide Referrer Identity\",\r\n    \"430\", \"Flow Failed\",\r\n    \"433\", \"Anonymity Disallowed\",\r\n    \"436\", \"Bad Identity-Info\",\r\n    \"437\", \"Unsupported Certificate\",\r\n    \"438\", \"Invalid Identity Header\",\r\n    \"439\", \"First Hop Lacks Outbound Support\",\r\n    \"440\", \"Max-Breadth Exceeded\",\r\n    \"469\", \"Bad Info Package\",\r\n    \"470\", \"Consent Needed\",\r\n    \"480\", \"Temporarily Unavailable\",\r\n    \"481\", \"Call/Transaction Does Not Exist\",\r\n    \"482\", \"Loop Detected\",\r\n    \"483\", \"Too Many Hops\",\r\n    \"484\", \"Address Incomplete\",\r\n    \"485\", \"Ambiguous\",\r\n    \"486\", \"Busy Here\",\r\n    \"487\", \"Request Terminated\",\r\n    \"488\", \"Not Acceptable Here\",\r\n    \"489\", \"Bad Event\",\r\n    \"491\", \"Request Pending\",\r\n    \"493\", \"Undecipherable\",\r\n    \"494\", \"Security Agreement Required\",\r\n    \"500\", \"Internal Server Error\",\r\n    \"501\", \"Not Implemented\",\r\n    \"502\", \"Bad Gateway\",\r\n    \"503\", \"Service Unavailable\",\r\n    \"504\", \"Server Time-out\",\r\n    \"505\", \"Version Not Supported\",\r\n    \"513\", \"Message Too Large\",\r\n    \"555\", \"Push Notification Service Not Supported\",\r\n    \"580\", \"Precondition Failure\",\r\n    \"600\", \"Busy Everywhere\",\r\n    \"603\", \"Decline\",\r\n    \"604\", \"Does Not Exist Anywhere\",\r\n    \"606\", \"Not Acceptable\",\r\n    \"607\", \"Unwanted\",\r\n    \"608\", \"Rejected\",\r\n];\r\n\r\nlet other_auth_signatures = ACSAuthIncomingOperations\r\n| where TimeGenerated {time_range:query}\r\n| summarize operation_count=count() by ResultSignature\r\n| order by operation_count desc\r\n| extend Rank=row_number()\r\n| where Rank > 5\r\n| project ResultSignature;\r\n\r\nACSAuthIncomingOperations\r\n| where TimeGenerated {time_range:query} // and (ResultSignature in (dynamic([{auth_signature}])) or iff(\"Other\" in (dynamic([{auth_signature}])), (ResultSignature in (other_auth_signatures)), false))\r\n| join kind=leftouter SIPCodesAuth on ResultSignature\r\n| extend OperationDate=strcat(\"ðŸ“…\", format_datetime(TimeGenerated, 'MM/dd/y'))\r\n| extend OperationTime=format_datetime(TimeGenerated, 'hh:mm:ss')\r\n| extend ResultIcon=iff(ResultType == \"Succeeded\", \"âœ”ï¸\", \"âŒ\")\r\n| extend Result=strcat(ResultIcon, \" \", ResultSignature, \": \", SIPCode)\r\n| where (Result in (dynamic([{auth_signature}])) or iff(\"Other\" in (dynamic([{auth_signature}])), (ResultSignature in (other_auth_signatures)), false))\r\n| order by TimeGenerated\r\n| project OperationName, Level, Result, OperationDate, OperationTime, DurationMs",
                    "size": 0,
                    "title": "Authentication operations with result type {auth_signature}",
                    "noDataMessage": "No authentication operations found for the specified time range and result type",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Level",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Warning",
                                "representation": "warning",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "info",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "OperationDate",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "OperationTime",
                          "formatter": 5
                        }
                      ],
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "OperationDate"
                        ],
                        "expandTopLevel": true,
                        "finalBy": "OperationTime"
                      }
                    },
                    "sortBy": []
                  },
                  "conditionalVisibility": {
                    "parameterName": "auth_signature",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "auth-by-signature"
                }
              ]
            },
            "customWidth": "50",
            "name": "auth-signatures-group"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Authentication Operation Names",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ACSAuthIncomingOperations\r\n| where TimeGenerated {time_range:query}\r\n| summarize count() by OperationName\r\n| render piechart",
                    "size": 0,
                    "noDataMessage": "No authentication operations found in the specified time range",
                    "exportMultipleValues": true,
                    "exportedParameters": [
                      {
                        "fieldName": "series",
                        "parameterName": "auth_operation",
                        "parameterType": 1
                      }
                    ],
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices"
                  },
                  "name": "auth-operation-names"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SIPCodesChat =  datatable(ResultSignature: string, SIPCode: string)\r\n[\r\n    \"0\", \"Success\",\r\n    \"100\", \"Trying\",\r\n    \"180\", \"Ringing\",\r\n    \"181\", \"Call Is Being Forwarded\",\r\n    \"182\", \"Queued\",\r\n    \"183\", \"Session Progress\",\r\n    \"199\", \"Early Dialog Terminated\",\r\n    \"200\", \"Success\",\r\n    \"202\", \"Accepted\",\r\n    \"204\", \"No Notification\",\r\n    \"300\", \"Multiple Choices\",\r\n    \"301\", \"Moved Permanently\",\r\n    \"302\", \"Moved Temporarily\",\r\n    \"305\", \"Use Proxy\",\r\n    \"380\", \"Alternative Service\",\r\n    \"400\", \"Bad Request\",\r\n    \"401\", \"Unauthorized\",\r\n    \"402\", \"Payment Required\",\r\n    \"403\", \"Forbidden\",\r\n    \"404\", \"Not Found\",\r\n    \"405\", \"Method Not Allowed\",\r\n    \"406\", \"Not Acceptable\",\r\n    \"407\", \"Proxy Authentication Required\",\r\n    \"408\", \"Request Timeout\",\r\n    \"409\", \"Conflict\",\r\n    \"410\", \"Gone\",\r\n    \"411\", \"Length Required\",\r\n    \"412\", \"Conditional Request Failed\",\r\n    \"413\", \"Request Entity Too Large\",\r\n    \"414\", \"Request-URI Too Large\",\r\n    \"415\", \"Unsupported Media Type\",\r\n    \"416\", \"Unsupported URI Scheme\",\r\n    \"417\", \"Unknown Resource-Priority\",\r\n    \"420\", \"Bad Extension\",\r\n    \"421\", \"Extension Required\",\r\n    \"422\", \"Session Interval Too Small\",\r\n    \"423\", \"Interval Too Brief\",\r\n    \"424\", \"Bad Location Information\",\r\n    \"428\", \"Use Identity Header\",\r\n    \"429\", \"Provide Referrer Identity\",\r\n    \"430\", \"Flow Failed\",\r\n    \"433\", \"Anonymity Disallowed\",\r\n    \"436\", \"Bad Identity-Info\",\r\n    \"437\", \"Unsupported Certificate\",\r\n    \"438\", \"Invalid Identity Header\",\r\n    \"439\", \"First Hop Lacks Outbound Support\",\r\n    \"440\", \"Max-Breadth Exceeded\",\r\n    \"469\", \"Bad Info Package\",\r\n    \"470\", \"Consent Needed\",\r\n    \"480\", \"Temporarily Unavailable\",\r\n    \"481\", \"Call/Transaction Does Not Exist\",\r\n    \"482\", \"Loop Detected\",\r\n    \"483\", \"Too Many Hops\",\r\n    \"484\", \"Address Incomplete\",\r\n    \"485\", \"Ambiguous\",\r\n    \"486\", \"Busy Here\",\r\n    \"487\", \"Request Terminated\",\r\n    \"488\", \"Not Acceptable Here\",\r\n    \"489\", \"Bad Event\",\r\n    \"491\", \"Request Pending\",\r\n    \"493\", \"Undecipherable\",\r\n    \"494\", \"Security Agreement Required\",\r\n    \"500\", \"Internal Server Error\",\r\n    \"501\", \"Not Implemented\",\r\n    \"502\", \"Bad Gateway\",\r\n    \"503\", \"Service Unavailable\",\r\n    \"504\", \"Server Time-out\",\r\n    \"505\", \"Version Not Supported\",\r\n    \"513\", \"Message Too Large\",\r\n    \"555\", \"Push Notification Service Not Supported\",\r\n    \"580\", \"Precondition Failure\",\r\n    \"600\", \"Busy Everywhere\",\r\n    \"603\", \"Decline\",\r\n    \"604\", \"Does Not Exist Anywhere\",\r\n    \"606\", \"Not Acceptable\",\r\n    \"607\", \"Unwanted\",\r\n    \"608\", \"Rejected\",\r\n];\r\n\r\nlet other_auth_operations = ACSAuthIncomingOperations\r\n| where TimeGenerated {time_range:query}\r\n| summarize operation_count=count() by OperationName\r\n| order by operation_count desc\r\n| extend Rank=row_number()\r\n| where Rank > 5\r\n| project OperationName;\r\n\r\nACSAuthIncomingOperations\r\n| where TimeGenerated {time_range:query} and (OperationName in (dynamic([{auth_operation}])) or iff(\"Other\" in (dynamic([{auth_operation}])), (OperationName in (other_auth_operations)), false))\r\n| join kind=leftouter SIPCodesChat on ResultSignature\r\n| extend OperationDate=strcat(\"ðŸ“…\", format_datetime(TimeGenerated, 'MM/dd/y'))\r\n| extend OperationTime=format_datetime(TimeGenerated, 'hh:mm:ss')\r\n| extend ResultIcon=iff(ResultType == \"Succeeded\", \"âœ”ï¸\", \"âŒ\")\r\n| extend Result=strcat(ResultIcon, \" \", ResultSignature, \": \", SIPCode)\r\n| order by TimeGenerated\r\n| project OperationName, Identity, Level, Result, OperationDate, OperationTime, DurationMs",
                    "size": 0,
                    "title": "Authentication operations with result type {auth_operation}",
                    "noDataMessage": "No authentication operations found for the specified time range and result type",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Level",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Warning",
                                "representation": "warning",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "info",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "OperationDate",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "OperationTime",
                          "formatter": 5
                        }
                      ],
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "OperationDate"
                        ],
                        "expandTopLevel": true,
                        "finalBy": "OperationTime"
                      }
                    },
                    "sortBy": []
                  },
                  "conditionalVisibility": {
                    "parameterName": "auth_operation",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "auth-by-operation"
                }
              ]
            },
            "customWidth": "50",
            "name": "auth-operation-names-group"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Authentication Operation Versions",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ACSAuthIncomingOperations\r\n| where TimeGenerated {time_range:query}\r\n| summarize count() by OperationVersion\r\n| render piechart",
                    "size": 0,
                    "noDataMessage": "No authentication operations found in the specified time range",
                    "exportMultipleValues": true,
                    "exportedParameters": [
                      {
                        "fieldName": "series",
                        "parameterName": "auth_version",
                        "parameterType": 1
                      }
                    ],
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices"
                  },
                  "showPin": false,
                  "name": "auth-operation-versions"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SIPCodesChat =  datatable(ResultSignature: string, SIPCode: string)\r\n[\r\n    \"0\", \"Success\",\r\n    \"100\", \"Trying\",\r\n    \"180\", \"Ringing\",\r\n    \"181\", \"Call Is Being Forwarded\",\r\n    \"182\", \"Queued\",\r\n    \"183\", \"Session Progress\",\r\n    \"199\", \"Early Dialog Terminated\",\r\n    \"200\", \"Success\",\r\n    \"202\", \"Accepted\",\r\n    \"204\", \"No Notification\",\r\n    \"300\", \"Multiple Choices\",\r\n    \"301\", \"Moved Permanently\",\r\n    \"302\", \"Moved Temporarily\",\r\n    \"305\", \"Use Proxy\",\r\n    \"380\", \"Alternative Service\",\r\n    \"400\", \"Bad Request\",\r\n    \"401\", \"Unauthorized\",\r\n    \"402\", \"Payment Required\",\r\n    \"403\", \"Forbidden\",\r\n    \"404\", \"Not Found\",\r\n    \"405\", \"Method Not Allowed\",\r\n    \"406\", \"Not Acceptable\",\r\n    \"407\", \"Proxy Authentication Required\",\r\n    \"408\", \"Request Timeout\",\r\n    \"409\", \"Conflict\",\r\n    \"410\", \"Gone\",\r\n    \"411\", \"Length Required\",\r\n    \"412\", \"Conditional Request Failed\",\r\n    \"413\", \"Request Entity Too Large\",\r\n    \"414\", \"Request-URI Too Large\",\r\n    \"415\", \"Unsupported Media Type\",\r\n    \"416\", \"Unsupported URI Scheme\",\r\n    \"417\", \"Unknown Resource-Priority\",\r\n    \"420\", \"Bad Extension\",\r\n    \"421\", \"Extension Required\",\r\n    \"422\", \"Session Interval Too Small\",\r\n    \"423\", \"Interval Too Brief\",\r\n    \"424\", \"Bad Location Information\",\r\n    \"428\", \"Use Identity Header\",\r\n    \"429\", \"Provide Referrer Identity\",\r\n    \"430\", \"Flow Failed\",\r\n    \"433\", \"Anonymity Disallowed\",\r\n    \"436\", \"Bad Identity-Info\",\r\n    \"437\", \"Unsupported Certificate\",\r\n    \"438\", \"Invalid Identity Header\",\r\n    \"439\", \"First Hop Lacks Outbound Support\",\r\n    \"440\", \"Max-Breadth Exceeded\",\r\n    \"469\", \"Bad Info Package\",\r\n    \"470\", \"Consent Needed\",\r\n    \"480\", \"Temporarily Unavailable\",\r\n    \"481\", \"Call/Transaction Does Not Exist\",\r\n    \"482\", \"Loop Detected\",\r\n    \"483\", \"Too Many Hops\",\r\n    \"484\", \"Address Incomplete\",\r\n    \"485\", \"Ambiguous\",\r\n    \"486\", \"Busy Here\",\r\n    \"487\", \"Request Terminated\",\r\n    \"488\", \"Not Acceptable Here\",\r\n    \"489\", \"Bad Event\",\r\n    \"491\", \"Request Pending\",\r\n    \"493\", \"Undecipherable\",\r\n    \"494\", \"Security Agreement Required\",\r\n    \"500\", \"Internal Server Error\",\r\n    \"501\", \"Not Implemented\",\r\n    \"502\", \"Bad Gateway\",\r\n    \"503\", \"Service Unavailable\",\r\n    \"504\", \"Server Time-out\",\r\n    \"505\", \"Version Not Supported\",\r\n    \"513\", \"Message Too Large\",\r\n    \"555\", \"Push Notification Service Not Supported\",\r\n    \"580\", \"Precondition Failure\",\r\n    \"600\", \"Busy Everywhere\",\r\n    \"603\", \"Decline\",\r\n    \"604\", \"Does Not Exist Anywhere\",\r\n    \"606\", \"Not Acceptable\",\r\n    \"607\", \"Unwanted\",\r\n    \"608\", \"Rejected\",\r\n];\r\n\r\nlet other_auth_versions = ACSAuthIncomingOperations\r\n| where TimeGenerated {time_range:query}\r\n| summarize operation_count=count() by OperationVersion\r\n| order by operation_count desc\r\n| extend Rank=row_number()\r\n| where Rank > 5\r\n| project OperationVersion;\r\n\r\nACSAuthIncomingOperations\r\n| where TimeGenerated {time_range:query} and (OperationVersion in (dynamic([{auth_version}])) or iff(\"Other\" in (dynamic([{auth_version}])), (OperationVersion in (other_auth_versions)), false))\r\n| join kind=leftouter SIPCodesChat on ResultSignature\r\n| extend OperationDate=strcat(\"ðŸ“…\", format_datetime(TimeGenerated, 'MM/dd/y'))\r\n| extend OperationTime=format_datetime(TimeGenerated, 'hh:mm:ss')\r\n| extend ResultIcon=iff(ResultType == \"Succeeded\", \"âœ”ï¸\", \"âŒ\")\r\n| extend Result=strcat(ResultIcon, \" \", ResultSignature, \": \", SIPCode)\r\n| order by TimeGenerated\r\n| project OperationName, Identity, Level, Result, OperationDate, OperationTime, DurationMs",
                    "size": 0,
                    "title": "Authentication operations with result type {auth_version}",
                    "noDataMessage": "No authentication operations found for the specified time range and result type",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Level",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Warning",
                                "representation": "warning",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "info",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "OperationDate",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "OperationTime",
                          "formatter": 5
                        }
                      ],
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "OperationDate"
                        ],
                        "expandTopLevel": true,
                        "finalBy": "OperationTime"
                      }
                    },
                    "sortBy": []
                  },
                  "conditionalVisibility": {
                    "parameterName": "auth_version",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "auth-by-version"
                }
              ]
            },
            "customWidth": "50",
            "name": "auth-operation-versions-group"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Identity drill-down",
              "items": [
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "0c0b56fd-ffd9-4761-b14e-c916660f9ccc",
                        "version": "KqlParameterItem/1.0",
                        "name": "identity",
                        "label": "Identity",
                        "type": 2,
                        "description": "Choose an identity to visualize",
                        "query": "ACSAuthIncomingOperations\r\n| where TimeGenerated {time_range:query}\r\n| order by TimeGenerated\r\n| distinct Identity\r\n| where isnotempty(Identity)",
                        "value": null,
                        "typeSettings": {
                          "additionalResourceOptions": [],
                          "showDefault": false
                        },
                        "queryType": 0,
                        "resourceType": "microsoft.communication/communicationservices"
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices"
                  },
                  "name": "auth-identity-parameters"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "**Select an identity from the drop-down menu to display its associated data**",
                    "style": "info"
                  },
                  "conditionalVisibility": {
                    "parameterName": "identity",
                    "comparison": "isEqualTo"
                  },
                  "name": "identity-drilldown-info"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SIPCodes =  datatable(ParticipantEndReason: string, SIPCode: string)\r\n[\r\n    \"0\", \"Success\",\r\n    \"100\", \"Trying\",\r\n    \"180\", \"Ringing\",\r\n    \"181\", \"Call Is Being Forwarded\",\r\n    \"182\", \"Queued\",\r\n    \"183\", \"Session Progress\",\r\n    \"199\", \"Early Dialog Terminated\",\r\n    \"200\", \"Success\",\r\n    \"202\", \"Accepted\",\r\n    \"204\", \"No Notification\",\r\n    \"300\", \"Multiple Choices\",\r\n    \"301\", \"Moved Permanently\",\r\n    \"302\", \"Moved Temporarily\",\r\n    \"305\", \"Use Proxy\",\r\n    \"380\", \"Alternative Service\",\r\n    \"400\", \"Bad Request\",\r\n    \"401\", \"Unauthorized\",\r\n    \"402\", \"Payment Required\",\r\n    \"403\", \"Forbidden\",\r\n    \"404\", \"Not Found\",\r\n    \"405\", \"Method Not Allowed\",\r\n    \"406\", \"Not Acceptable\",\r\n    \"407\", \"Proxy Authentication Required\",\r\n    \"408\", \"Request Timeout\",\r\n    \"409\", \"Conflict\",\r\n    \"410\", \"Gone\",\r\n    \"411\", \"Length Required\",\r\n    \"412\", \"Conditional Request Failed\",\r\n    \"413\", \"Request Entity Too Large\",\r\n    \"414\", \"Request-URI Too Large\",\r\n    \"415\", \"Unsupported Media Type\",\r\n    \"416\", \"Unsupported URI Scheme\",\r\n    \"417\", \"Unknown Resource-Priority\",\r\n    \"420\", \"Bad Extension\",\r\n    \"421\", \"Extension Required\",\r\n    \"422\", \"Session Interval Too Small\",\r\n    \"423\", \"Interval Too Brief\",\r\n    \"424\", \"Bad Location Information\",\r\n    \"428\", \"Use Identity Header\",\r\n    \"429\", \"Provide Referrer Identity\",\r\n    \"430\", \"Flow Failed\",\r\n    \"433\", \"Anonymity Disallowed\",\r\n    \"436\", \"Bad Identity-Info\",\r\n    \"437\", \"Unsupported Certificate\",\r\n    \"438\", \"Invalid Identity Header\",\r\n    \"439\", \"First Hop Lacks Outbound Support\",\r\n    \"440\", \"Max-Breadth Exceeded\",\r\n    \"469\", \"Bad Info Package\",\r\n    \"470\", \"Consent Needed\",\r\n    \"480\", \"Temporarily Unavailable\",\r\n    \"481\", \"Call/Transaction Does Not Exist\",\r\n    \"482\", \"Loop Detected\",\r\n    \"483\", \"Too Many Hops\",\r\n    \"484\", \"Address Incomplete\",\r\n    \"485\", \"Ambiguous\",\r\n    \"486\", \"Busy Here\",\r\n    \"487\", \"Request Terminated\",\r\n    \"488\", \"Not Acceptable Here\",\r\n    \"489\", \"Bad Event\",\r\n    \"491\", \"Request Pending\",\r\n    \"493\", \"Undecipherable\",\r\n    \"494\", \"Security Agreement Required\",\r\n    \"500\", \"Internal Server Error\",\r\n    \"501\", \"Not Implemented\",\r\n    \"502\", \"Bad Gateway\",\r\n    \"503\", \"Service Unavailable\",\r\n    \"504\", \"Server Time-out\",\r\n    \"505\", \"Version Not Supported\",\r\n    \"513\", \"Message Too Large\",\r\n    \"555\", \"Push Notification Service Not Supported\",\r\n    \"580\", \"Precondition Failure\",\r\n    \"600\", \"Busy Everywhere\",\r\n    \"603\", \"Decline\",\r\n    \"604\", \"Does Not Exist Anywhere\",\r\n    \"606\", \"Not Acceptable\",\r\n    \"607\", \"Unwanted\",\r\n    \"608\", \"Rejected\",\r\n];\r\n\r\nACSCallDiagnostics\r\n| join kind=inner ACSCallSummary on CorrelationId, ParticipantId, EndpointId\r\n| where CallStartTime {time_range:query} and Identifier == substring(\"{identity}\", indexof(\"{identity}\", \"acs:\"))\r\n| join kind=leftouter SIPCodes on ParticipantEndReason\r\n| extend EndReason=strcat(ParticipantEndReason, \": \", SIPCode)\r\n| extend CallDate=strcat(\"ðŸ“…\", format_datetime(CallStartTime, 'MM/dd/y'))\r\n| extend UnsuccessfulEndReason = iff((ParticipantEndReason startswith \"0\") or (ParticipantEndReason startswith \"2\"), \"\", \"ðŸ›‘\")\r\n| extend ParticipantTime=format_datetime(ParticipantStartTime, 'hh:mm:ss')\r\n| extend EndpointType = case(  indexof(EndpointType, \"VoIP\") != -1, strcat(\"ðŸ—£ï¸ \", EndpointType),\r\n                            indexof(EndpointType, \"PSTN\") != -1, strcat(\"ðŸ“ž \", EndpointType),\r\n                            indexof(EndpointType, \"Bot\") != -1, strcat(\"ðŸ¤– \", EndpointType),\r\n                            indexof(EndpointType, \"Server\") != -1, strcat(\"ðŸ–¥ï¸ \", EndpointType),\r\n                            indexof(EndpointType, \"Unknown\") != -1, strcat(\"ðŸ‘½ \", EndpointType),\r\n                            EndpointType\r\n                        )\r\n| extend Participant = strcat(EndpointType, \" \", UnsuccessfulEndReason, \" \", ParticipantTime, \" (\", ParticipantId, \")\")\r\n| extend MediaType = case(  indexof(MediaType, \"Audio\") != -1, strcat(\"ðŸ”Š \", MediaType),\r\n                            indexof(MediaType, \"Video\") != -1, strcat(\"ðŸŽ¥ \", MediaType),\r\n                            indexof(MediaType, \"VBSS\") != -1, strcat(\"ðŸ’» \", MediaType),\r\n                            indexof(MediaType, \"AppSharing\") != -1, strcat(\"ðŸ“² \", MediaType),\r\n                            MediaType\r\n                        )\r\n| project CallDate, CallId = strcat(\"ðŸ“ž \", CorrelationId), Participant, MediaType, ParticipantDuration, EndReason, JitterAvg, PacketLossRateAvg, RoundTripTimeAvg",
                    "size": 0,
                    "title": "Calls for identity {identity}",
                    "noDataMessage": "No calls found for the specified time range and identity",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "CallDate",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "CallId",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Participant",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "MediaType",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "EndReason",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "startsWith",
                                "thresholdValue": "2",
                                "representation": "success",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "startsWith",
                                "thresholdValue": "0",
                                "representation": "success",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "3",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "JitterAvg",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": ">",
                                "thresholdValue": "30",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "PacketLossRateAvg",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": ">",
                                "thresholdValue": ".1",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "RoundTripTimeAvg",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": ">",
                                "thresholdValue": "500",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "CallDate",
                          "CallId",
                          "Participant"
                        ],
                        "expandTopLevel": true,
                        "finalBy": "MediaType"
                      }
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "identity",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "identity-call-details"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SIPCodesChat =  datatable(ResultSignature: string, SIPCode: string)\r\n[\r\n    \"0\", \"Success\",\r\n    \"100\", \"Trying\",\r\n    \"180\", \"Ringing\",\r\n    \"181\", \"Call Is Being Forwarded\",\r\n    \"182\", \"Queued\",\r\n    \"183\", \"Session Progress\",\r\n    \"199\", \"Early Dialog Terminated\",\r\n    \"200\", \"Success\",\r\n    \"202\", \"Accepted\",\r\n    \"204\", \"No Notification\",\r\n    \"300\", \"Multiple Choices\",\r\n    \"301\", \"Moved Permanently\",\r\n    \"302\", \"Moved Temporarily\",\r\n    \"305\", \"Use Proxy\",\r\n    \"380\", \"Alternative Service\",\r\n    \"400\", \"Bad Request\",\r\n    \"401\", \"Unauthorized\",\r\n    \"402\", \"Payment Required\",\r\n    \"403\", \"Forbidden\",\r\n    \"404\", \"Not Found\",\r\n    \"405\", \"Method Not Allowed\",\r\n    \"406\", \"Not Acceptable\",\r\n    \"407\", \"Proxy Authentication Required\",\r\n    \"408\", \"Request Timeout\",\r\n    \"409\", \"Conflict\",\r\n    \"410\", \"Gone\",\r\n    \"411\", \"Length Required\",\r\n    \"412\", \"Conditional Request Failed\",\r\n    \"413\", \"Request Entity Too Large\",\r\n    \"414\", \"Request-URI Too Large\",\r\n    \"415\", \"Unsupported Media Type\",\r\n    \"416\", \"Unsupported URI Scheme\",\r\n    \"417\", \"Unknown Resource-Priority\",\r\n    \"420\", \"Bad Extension\",\r\n    \"421\", \"Extension Required\",\r\n    \"422\", \"Session Interval Too Small\",\r\n    \"423\", \"Interval Too Brief\",\r\n    \"424\", \"Bad Location Information\",\r\n    \"428\", \"Use Identity Header\",\r\n    \"429\", \"Provide Referrer Identity\",\r\n    \"430\", \"Flow Failed\",\r\n    \"433\", \"Anonymity Disallowed\",\r\n    \"436\", \"Bad Identity-Info\",\r\n    \"437\", \"Unsupported Certificate\",\r\n    \"438\", \"Invalid Identity Header\",\r\n    \"439\", \"First Hop Lacks Outbound Support\",\r\n    \"440\", \"Max-Breadth Exceeded\",\r\n    \"469\", \"Bad Info Package\",\r\n    \"470\", \"Consent Needed\",\r\n    \"480\", \"Temporarily Unavailable\",\r\n    \"481\", \"Call/Transaction Does Not Exist\",\r\n    \"482\", \"Loop Detected\",\r\n    \"483\", \"Too Many Hops\",\r\n    \"484\", \"Address Incomplete\",\r\n    \"485\", \"Ambiguous\",\r\n    \"486\", \"Busy Here\",\r\n    \"487\", \"Request Terminated\",\r\n    \"488\", \"Not Acceptable Here\",\r\n    \"489\", \"Bad Event\",\r\n    \"491\", \"Request Pending\",\r\n    \"493\", \"Undecipherable\",\r\n    \"494\", \"Security Agreement Required\",\r\n    \"500\", \"Internal Server Error\",\r\n    \"501\", \"Not Implemented\",\r\n    \"502\", \"Bad Gateway\",\r\n    \"503\", \"Service Unavailable\",\r\n    \"504\", \"Server Time-out\",\r\n    \"505\", \"Version Not Supported\",\r\n    \"513\", \"Message Too Large\",\r\n    \"555\", \"Push Notification Service Not Supported\",\r\n    \"580\", \"Precondition Failure\",\r\n    \"600\", \"Busy Everywhere\",\r\n    \"603\", \"Decline\",\r\n    \"604\", \"Does Not Exist Anywhere\",\r\n    \"606\", \"Not Acceptable\",\r\n    \"607\", \"Unwanted\",\r\n    \"608\", \"Rejected\",\r\n];\r\n\r\nACSChatIncomingOperations\r\n| where TimeGenerated {time_range:query} and UserId == \"{identity}\"\r\n| join kind=leftouter SIPCodesChat on ResultSignature\r\n| extend OperationDate=strcat(\"ðŸ“…\", format_datetime(TimeGenerated, 'MM/dd/y'))\r\n| extend OperationTime=format_datetime(TimeGenerated, 'hh:mm:ss')\r\n| extend ResultIcon=iff(ResultType == \"Succeeded\", \"âœ”ï¸\", \"âŒ\")\r\n| extend Result=strcat(ResultIcon, \" \", ResultSignature, \": \", SIPCode)\r\n| order by TimeGenerated\r\n| project OperationName, Level, Result, OperationDate, OperationTime, DurationMs\r\n",
                    "size": 0,
                    "title": "Chat operations for identity {identity}",
                    "noDataMessage": "No chat operations found for the specified  time range and identity",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Level",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Warning",
                                "representation": "warning",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "info",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "OperationDate",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "OperationTime",
                          "formatter": 5
                        }
                      ],
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "OperationDate"
                        ],
                        "expandTopLevel": true,
                        "finalBy": "OperationTime"
                      }
                    },
                    "sortBy": []
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "identity",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "identity-chat-details"
                }
              ]
            },
            "name": "identity-drill-down-group"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "tab",
        "comparison": "isEqualTo",
        "value": "auth"
      },
      "name": "Auth-group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "The following visualizations represent data from the Chat Operational logs.\r\n\r\n**Click on any part of the pie charts below to visualize filtered logs.**"
            },
            "name": "auth-text"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Chat API Results",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ACSChatIncomingOperations\r\n| where TimeGenerated {time_range:query}\r\n| summarize count() by ResultType\r\n| render piechart",
                    "size": 0,
                    "noDataMessage": "No chat operations found in the specified time range",
                    "exportMultipleValues": true,
                    "exportedParameters": [
                      {
                        "fieldName": "series",
                        "parameterName": "chat_result",
                        "parameterType": 1
                      }
                    ],
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices"
                  },
                  "name": "chat-result-types"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SIPCodesChat =  datatable(ResultSignature: string, SIPCode: string)\r\n[\r\n    \"0\", \"Success\",\r\n    \"100\", \"Trying\",\r\n    \"180\", \"Ringing\",\r\n    \"181\", \"Call Is Being Forwarded\",\r\n    \"182\", \"Queued\",\r\n    \"183\", \"Session Progress\",\r\n    \"199\", \"Early Dialog Terminated\",\r\n    \"200\", \"Success\",\r\n    \"202\", \"Accepted\",\r\n    \"204\", \"No Notification\",\r\n    \"300\", \"Multiple Choices\",\r\n    \"301\", \"Moved Permanently\",\r\n    \"302\", \"Moved Temporarily\",\r\n    \"305\", \"Use Proxy\",\r\n    \"380\", \"Alternative Service\",\r\n    \"400\", \"Bad Request\",\r\n    \"401\", \"Unauthorized\",\r\n    \"402\", \"Payment Required\",\r\n    \"403\", \"Forbidden\",\r\n    \"404\", \"Not Found\",\r\n    \"405\", \"Method Not Allowed\",\r\n    \"406\", \"Not Acceptable\",\r\n    \"407\", \"Proxy Authentication Required\",\r\n    \"408\", \"Request Timeout\",\r\n    \"409\", \"Conflict\",\r\n    \"410\", \"Gone\",\r\n    \"411\", \"Length Required\",\r\n    \"412\", \"Conditional Request Failed\",\r\n    \"413\", \"Request Entity Too Large\",\r\n    \"414\", \"Request-URI Too Large\",\r\n    \"415\", \"Unsupported Media Type\",\r\n    \"416\", \"Unsupported URI Scheme\",\r\n    \"417\", \"Unknown Resource-Priority\",\r\n    \"420\", \"Bad Extension\",\r\n    \"421\", \"Extension Required\",\r\n    \"422\", \"Session Interval Too Small\",\r\n    \"423\", \"Interval Too Brief\",\r\n    \"424\", \"Bad Location Information\",\r\n    \"428\", \"Use Identity Header\",\r\n    \"429\", \"Provide Referrer Identity\",\r\n    \"430\", \"Flow Failed\",\r\n    \"433\", \"Anonymity Disallowed\",\r\n    \"436\", \"Bad Identity-Info\",\r\n    \"437\", \"Unsupported Certificate\",\r\n    \"438\", \"Invalid Identity Header\",\r\n    \"439\", \"First Hop Lacks Outbound Support\",\r\n    \"440\", \"Max-Breadth Exceeded\",\r\n    \"469\", \"Bad Info Package\",\r\n    \"470\", \"Consent Needed\",\r\n    \"480\", \"Temporarily Unavailable\",\r\n    \"481\", \"Call/Transaction Does Not Exist\",\r\n    \"482\", \"Loop Detected\",\r\n    \"483\", \"Too Many Hops\",\r\n    \"484\", \"Address Incomplete\",\r\n    \"485\", \"Ambiguous\",\r\n    \"486\", \"Busy Here\",\r\n    \"487\", \"Request Terminated\",\r\n    \"488\", \"Not Acceptable Here\",\r\n    \"489\", \"Bad Event\",\r\n    \"491\", \"Request Pending\",\r\n    \"493\", \"Undecipherable\",\r\n    \"494\", \"Security Agreement Required\",\r\n    \"500\", \"Internal Server Error\",\r\n    \"501\", \"Not Implemented\",\r\n    \"502\", \"Bad Gateway\",\r\n    \"503\", \"Service Unavailable\",\r\n    \"504\", \"Server Time-out\",\r\n    \"505\", \"Version Not Supported\",\r\n    \"513\", \"Message Too Large\",\r\n    \"555\", \"Push Notification Service Not Supported\",\r\n    \"580\", \"Precondition Failure\",\r\n    \"600\", \"Busy Everywhere\",\r\n    \"603\", \"Decline\",\r\n    \"604\", \"Does Not Exist Anywhere\",\r\n    \"606\", \"Not Acceptable\",\r\n    \"607\", \"Unwanted\",\r\n    \"608\", \"Rejected\",\r\n];\r\n\r\nlet other_chat_results = ACSChatIncomingOperations\r\n| where TimeGenerated {time_range:query}\r\n| summarize operation_count=count() by ResultType\r\n| order by operation_count desc\r\n| extend Rank=row_number()\r\n| where Rank > 5\r\n| project ResultType;\r\n\r\nACSChatIncomingOperations\r\n| where TimeGenerated {time_range:query} and (ResultType in (dynamic([{chat_result}])) or iff(\"Other\" in (dynamic([{chat_result}])), (ResultType in (other_chat_results)), false))\r\n| join kind=leftouter SIPCodesChat on ResultSignature\r\n| extend OperationDate=strcat(\"ðŸ“…\", format_datetime(TimeGenerated, 'MM/dd/y'))\r\n| extend OperationTime=format_datetime(TimeGenerated, 'hh:mm:ss')\r\n| extend ResultIcon=iff(ResultType == \"Succeeded\", \"âœ”ï¸\", \"âŒ\")\r\n| extend Result=strcat(ResultIcon, \" \", ResultSignature, \": \", SIPCode)\r\n| order by TimeGenerated\r\n| project OperationName, Level, Result, ResultDescription, OperationDate, OperationTime, DurationMs\r\n",
                    "size": 0,
                    "title": "Chat operations with result type {chat_result}",
                    "noDataMessage": "No chat operations found for the specified time range and result type",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Level",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Warning",
                                "representation": "warning",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "info",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "OperationDate",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "OperationTime",
                          "formatter": 5
                        }
                      ],
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "OperationDate"
                        ],
                        "expandTopLevel": true,
                        "finalBy": "OperationTime"
                      }
                    },
                    "sortBy": []
                  },
                  "conditionalVisibility": {
                    "parameterName": "chat_result",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "chat-by-result"
                }
              ]
            },
            "customWidth": "50",
            "name": "chat-results-group"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Chat API Result Signatures",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SIPCodesChat =  datatable(ResultSignature: string, SIPCode: string, Troubleshooting: string)\r\n[\r\n    \"0\", \"Success\", \"\",\r\n    \"100\", \"Trying\", \"\",\r\n    \"180\", \"Ringing\", \"\",\r\n    \"181\", \"Call Is Being Forwarded\", \"\",\r\n    \"182\", \"Queued\", \"\",\r\n    \"183\", \"Session Progress\", \"\",\r\n    \"199\", \"Early Dialog Terminated\", \"\",\r\n    \"200\", \"Success\", \"\",\r\n    \"202\", \"Accepted\", \"\",\r\n    \"204\", \"No Notification\", \"\",\r\n    \"300\", \"Multiple Choices\", \"\",\r\n    \"301\", \"Moved Permanently\", \"\",\r\n    \"302\", \"Moved Temporarily\", \"\",\r\n    \"305\", \"Use Proxy\", \"\",\r\n    \"380\", \"Alternative Service\", \"\",\r\n    \"400\", \"Bad Request\", \"\",\r\n    \"401\", \"Unauthorized\", \"Ensure that your Communication Services token is valid and not expired.\",\r\n    \"402\", \"Payment Required\", \"\",\r\n    \"403\", \"Forbidden\", \"Ensure that the initiator of the request has access to the resource.\",\r\n    \"404\", \"Not Found\", \"\",\r\n    \"405\", \"Method Not Allowed\", \"\",\r\n    \"406\", \"Not Acceptable\", \"\",\r\n    \"407\", \"Proxy Authentication Required\", \"\",\r\n    \"408\", \"Request Timeout\", \"\",\r\n    \"409\", \"Conflict\", \"\",\r\n    \"410\", \"Gone\", \"\",\r\n    \"411\", \"Length Required\", \"\",\r\n    \"412\", \"Conditional Request Failed\", \"\",\r\n    \"413\", \"Request Entity Too Large\", \"\",\r\n    \"414\", \"Request-URI Too Large\", \"\",\r\n    \"415\", \"Unsupported Media Type\", \"\",\r\n    \"416\", \"Unsupported URI Scheme\", \"\",\r\n    \"417\", \"Unknown Resource-Priority\", \"\",\r\n    \"420\", \"Bad Extension\", \"\",\r\n    \"421\", \"Extension Required\", \"\",\r\n    \"422\", \"Session Interval Too Small\", \"\",\r\n    \"423\", \"Interval Too Brief\", \"\",\r\n    \"424\", \"Bad Location Information\", \"\",\r\n    \"428\", \"Use Identity Header\", \"\",\r\n    \"429\", \"Too many requests\", \"Ensure that your client-side application handles this scenario in a user-friendly manner. If the error persists please file a support request.\",\r\n    \"430\", \"Flow Failed\", \"\",\r\n    \"433\", \"Anonymity Disallowed\", \"\",\r\n    \"436\", \"Bad Identity-Info\", \"\",\r\n    \"437\", \"Unsupported Certificate\", \"\",\r\n    \"438\", \"Invalid Identity Header\", \"\",\r\n    \"439\", \"First Hop Lacks Outbound Support\", \"\",\r\n    \"440\", \"Max-Breadth Exceeded\", \"\",\r\n    \"469\", \"Bad Info Package\", \"\",\r\n    \"470\", \"Consent Needed\", \"\",\r\n    \"480\", \"Temporarily Unavailable\", \"\",\r\n    \"481\", \"Call/Transaction Does Not Exist\", \"\",\r\n    \"482\", \"Loop Detected\", \"\",\r\n    \"483\", \"Too Many Hops\", \"\",\r\n    \"484\", \"Address Incomplete\", \"\",\r\n    \"485\", \"Ambiguous\", \"\",\r\n    \"486\", \"Busy Here\", \"\",\r\n    \"487\", \"Request Terminated\", \"\",\r\n    \"488\", \"Not Acceptable Here\", \"\",\r\n    \"489\", \"Bad Event\", \"\",\r\n    \"491\", \"Request Pending\", \"\",\r\n    \"493\", \"Undecipherable\", \"\",\r\n    \"494\", \"Security Agreement Required\", \"\",\r\n    \"500\", \"Internal Server Error\", \"\",\r\n    \"501\", \"Not Implemented\", \"\",\r\n    \"502\", \"Bad Gateway\", \"\",\r\n    \"503\", \"Service Unavailable\", \"File a support request through the Azure portal.\",\r\n    \"504\", \"Server Time-out\", \"\",\r\n    \"505\", \"Version Not Supported\", \"\",\r\n    \"513\", \"Message Too Large\", \"\",\r\n    \"555\", \"Push Notification Service Not Supported\", \"\",\r\n    \"580\", \"Precondition Failure\", \"\",\r\n    \"600\", \"Busy Everywhere\", \"\",\r\n    \"603\", \"Decline\", \"\",\r\n    \"604\", \"Does Not Exist Anywhere\", \"\",\r\n    \"606\", \"Not Acceptable\", \"\",\r\n    \"607\", \"Unwanted\", \"\",\r\n    \"608\", \"Rejected\", \"\"\r\n];\r\n\r\nACSChatIncomingOperations\r\n| where TimeGenerated {time_range:query}\r\n| join kind=leftouter SIPCodesChat on ResultSignature\r\n| extend ResultIcon=iff(ResultType == \"Succeeded\", \"âœ”ï¸\", \"âŒ\")\r\n| extend Result=strcat(ResultIcon, \" \", ResultSignature, \": \", SIPCode)\r\n| summarize count() by Result//Signature\r\n| render piechart",
                    "size": 0,
                    "noDataMessage": "No chat operations found in the specified time range",
                    "exportMultipleValues": true,
                    "exportedParameters": [
                      {
                        "fieldName": "series",
                        "parameterName": "chat_signature",
                        "parameterType": 1
                      }
                    ],
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices"
                  },
                  "name": "sms-results-signature"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SIPCodesChat =  datatable(ResultSignature: string, SIPCode: string, Troubleshooting: string)\r\n[\r\n    \"0\", \"Success\", \"\",\r\n    \"100\", \"Trying\", \"\",\r\n    \"180\", \"Ringing\", \"\",\r\n    \"181\", \"Call Is Being Forwarded\", \"\",\r\n    \"182\", \"Queued\", \"\",\r\n    \"183\", \"Session Progress\", \"\",\r\n    \"199\", \"Early Dialog Terminated\", \"\",\r\n    \"200\", \"Success\", \"\",\r\n    \"202\", \"Accepted\", \"\",\r\n    \"204\", \"No Notification\", \"\",\r\n    \"300\", \"Multiple Choices\", \"\",\r\n    \"301\", \"Moved Permanently\", \"\",\r\n    \"302\", \"Moved Temporarily\", \"\",\r\n    \"305\", \"Use Proxy\", \"\",\r\n    \"380\", \"Alternative Service\", \"\",\r\n    \"400\", \"Bad Request\", \"\",\r\n    \"401\", \"Unauthorized\", \"Ensure that your Communication Services token is valid and not expired.\",\r\n    \"402\", \"Payment Required\", \"\",\r\n    \"403\", \"Forbidden\", \"Ensure that the initiator of the request has access to the resource.\",\r\n    \"404\", \"Not Found\", \"\",\r\n    \"405\", \"Method Not Allowed\", \"\",\r\n    \"406\", \"Not Acceptable\", \"\",\r\n    \"407\", \"Proxy Authentication Required\", \"\",\r\n    \"408\", \"Request Timeout\", \"\",\r\n    \"409\", \"Conflict\", \"\",\r\n    \"410\", \"Gone\", \"\",\r\n    \"411\", \"Length Required\", \"\",\r\n    \"412\", \"Conditional Request Failed\", \"\",\r\n    \"413\", \"Request Entity Too Large\", \"\",\r\n    \"414\", \"Request-URI Too Large\", \"\",\r\n    \"415\", \"Unsupported Media Type\", \"\",\r\n    \"416\", \"Unsupported URI Scheme\", \"\",\r\n    \"417\", \"Unknown Resource-Priority\", \"\",\r\n    \"420\", \"Bad Extension\", \"\",\r\n    \"421\", \"Extension Required\", \"\",\r\n    \"422\", \"Session Interval Too Small\", \"\",\r\n    \"423\", \"Interval Too Brief\", \"\",\r\n    \"424\", \"Bad Location Information\", \"\",\r\n    \"428\", \"Use Identity Header\", \"\",\r\n    \"429\", \"Too many requests\", \"Ensure that your client-side application handles this scenario in a user-friendly manner. If the error persists please file a support request.\",\r\n    \"430\", \"Flow Failed\", \"\",\r\n    \"433\", \"Anonymity Disallowed\", \"\",\r\n    \"436\", \"Bad Identity-Info\", \"\",\r\n    \"437\", \"Unsupported Certificate\", \"\",\r\n    \"438\", \"Invalid Identity Header\", \"\",\r\n    \"439\", \"First Hop Lacks Outbound Support\", \"\",\r\n    \"440\", \"Max-Breadth Exceeded\", \"\",\r\n    \"469\", \"Bad Info Package\", \"\",\r\n    \"470\", \"Consent Needed\", \"\",\r\n    \"480\", \"Temporarily Unavailable\", \"\",\r\n    \"481\", \"Call/Transaction Does Not Exist\", \"\",\r\n    \"482\", \"Loop Detected\", \"\",\r\n    \"483\", \"Too Many Hops\", \"\",\r\n    \"484\", \"Address Incomplete\", \"\",\r\n    \"485\", \"Ambiguous\", \"\",\r\n    \"486\", \"Busy Here\", \"\",\r\n    \"487\", \"Request Terminated\", \"\",\r\n    \"488\", \"Not Acceptable Here\", \"\",\r\n    \"489\", \"Bad Event\", \"\",\r\n    \"491\", \"Request Pending\", \"\",\r\n    \"493\", \"Undecipherable\", \"\",\r\n    \"494\", \"Security Agreement Required\", \"\",\r\n    \"500\", \"Internal Server Error\", \"\",\r\n    \"501\", \"Not Implemented\", \"\",\r\n    \"502\", \"Bad Gateway\", \"\",\r\n    \"503\", \"Service Unavailable\", \"File a support request through the Azure portal.\",\r\n    \"504\", \"Server Time-out\", \"\",\r\n    \"505\", \"Version Not Supported\", \"\",\r\n    \"513\", \"Message Too Large\", \"\",\r\n    \"555\", \"Push Notification Service Not Supported\", \"\",\r\n    \"580\", \"Precondition Failure\", \"\",\r\n    \"600\", \"Busy Everywhere\", \"\",\r\n    \"603\", \"Decline\", \"\",\r\n    \"604\", \"Does Not Exist Anywhere\", \"\",\r\n    \"606\", \"Not Acceptable\", \"\",\r\n    \"607\", \"Unwanted\", \"\",\r\n    \"608\", \"Rejected\", \"\"\r\n];\r\n\r\nlet other_chat_signature = ACSChatIncomingOperations\r\n| where TimeGenerated {time_range:query}\r\n| summarize operation_count=count() by ResultSignature\r\n| order by operation_count desc\r\n| extend Rank=row_number()\r\n| where Rank > 5\r\n| project ResultSignature;\r\n\r\nACSChatIncomingOperations\r\n| where TimeGenerated {time_range:query} // and (ResultSignature in (dynamic([{chat_signature}])) or iff(\"Other\" in (dynamic([{chat_signature}])), (ResultSignature in (other_chat_signature)), false))\r\n| join kind=leftouter SIPCodesChat on ResultSignature\r\n| extend OperationDate=strcat(\"ðŸ“…\", format_datetime(TimeGenerated, 'MM/dd/y'))\r\n| extend OperationTime=format_datetime(TimeGenerated, 'hh:mm:ss')\r\n| extend ResultIcon=iff(ResultType == \"Succeeded\", \"âœ”ï¸\", \"âŒ\")\r\n| extend Result=strcat(ResultIcon, \" \", ResultSignature, \": \", SIPCode)\r\n| where (Result in (dynamic([{chat_signature}])) or iff(\"Other\" in (dynamic([{chat_signature}])), (ResultSignature in (other_chat_signature)), false))\r\n| order by TimeGenerated\r\n| project OperationName, Level, Result, ResultDescription, Troubleshooting, OperationDate, OperationTime, DurationMs",
                    "size": 0,
                    "title": "Chat operations with result signature {chat_signature}",
                    "noDataMessage": "No chat operations found for the specified time range and result signature",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Level",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Warning",
                                "representation": "warning",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "info",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "OperationDate",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "OperationTime",
                          "formatter": 5
                        }
                      ],
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "OperationDate"
                        ],
                        "expandTopLevel": true,
                        "finalBy": "OperationTime"
                      }
                    },
                    "sortBy": []
                  },
                  "conditionalVisibility": {
                    "parameterName": "chat_signature",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "chat-by-signature"
                }
              ]
            },
            "customWidth": "50",
            "name": "chat-signatures-group"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Chat Operation Names",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ACSChatIncomingOperations\r\n| where TimeGenerated {time_range:query}\r\n| summarize count() by OperationName\r\n| render piechart",
                    "size": 0,
                    "noDataMessage": "No chat operations found in the specified time range",
                    "exportMultipleValues": true,
                    "exportedParameters": [
                      {
                        "fieldName": "series",
                        "parameterName": "chat_operation",
                        "parameterType": 1
                      }
                    ],
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices"
                  },
                  "name": "chat-operation-names"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SIPCodesChat =  datatable(ResultSignature: string, SIPCode: string)\r\n[\r\n    \"0\", \"Success\",\r\n    \"100\", \"Trying\",\r\n    \"180\", \"Ringing\",\r\n    \"181\", \"Call Is Being Forwarded\",\r\n    \"182\", \"Queued\",\r\n    \"183\", \"Session Progress\",\r\n    \"199\", \"Early Dialog Terminated\",\r\n    \"200\", \"Success\",\r\n    \"202\", \"Accepted\",\r\n    \"204\", \"No Notification\",\r\n    \"300\", \"Multiple Choices\",\r\n    \"301\", \"Moved Permanently\",\r\n    \"302\", \"Moved Temporarily\",\r\n    \"305\", \"Use Proxy\",\r\n    \"380\", \"Alternative Service\",\r\n    \"400\", \"Bad Request\",\r\n    \"401\", \"Unauthorized\",\r\n    \"402\", \"Payment Required\",\r\n    \"403\", \"Forbidden\",\r\n    \"404\", \"Not Found\",\r\n    \"405\", \"Method Not Allowed\",\r\n    \"406\", \"Not Acceptable\",\r\n    \"407\", \"Proxy Authentication Required\",\r\n    \"408\", \"Request Timeout\",\r\n    \"409\", \"Conflict\",\r\n    \"410\", \"Gone\",\r\n    \"411\", \"Length Required\",\r\n    \"412\", \"Conditional Request Failed\",\r\n    \"413\", \"Request Entity Too Large\",\r\n    \"414\", \"Request-URI Too Large\",\r\n    \"415\", \"Unsupported Media Type\",\r\n    \"416\", \"Unsupported URI Scheme\",\r\n    \"417\", \"Unknown Resource-Priority\",\r\n    \"420\", \"Bad Extension\",\r\n    \"421\", \"Extension Required\",\r\n    \"422\", \"Session Interval Too Small\",\r\n    \"423\", \"Interval Too Brief\",\r\n    \"424\", \"Bad Location Information\",\r\n    \"428\", \"Use Identity Header\",\r\n    \"429\", \"Provide Referrer Identity\",\r\n    \"430\", \"Flow Failed\",\r\n    \"433\", \"Anonymity Disallowed\",\r\n    \"436\", \"Bad Identity-Info\",\r\n    \"437\", \"Unsupported Certificate\",\r\n    \"438\", \"Invalid Identity Header\",\r\n    \"439\", \"First Hop Lacks Outbound Support\",\r\n    \"440\", \"Max-Breadth Exceeded\",\r\n    \"469\", \"Bad Info Package\",\r\n    \"470\", \"Consent Needed\",\r\n    \"480\", \"Temporarily Unavailable\",\r\n    \"481\", \"Call/Transaction Does Not Exist\",\r\n    \"482\", \"Loop Detected\",\r\n    \"483\", \"Too Many Hops\",\r\n    \"484\", \"Address Incomplete\",\r\n    \"485\", \"Ambiguous\",\r\n    \"486\", \"Busy Here\",\r\n    \"487\", \"Request Terminated\",\r\n    \"488\", \"Not Acceptable Here\",\r\n    \"489\", \"Bad Event\",\r\n    \"491\", \"Request Pending\",\r\n    \"493\", \"Undecipherable\",\r\n    \"494\", \"Security Agreement Required\",\r\n    \"500\", \"Internal Server Error\",\r\n    \"501\", \"Not Implemented\",\r\n    \"502\", \"Bad Gateway\",\r\n    \"503\", \"Service Unavailable\",\r\n    \"504\", \"Server Time-out\",\r\n    \"505\", \"Version Not Supported\",\r\n    \"513\", \"Message Too Large\",\r\n    \"555\", \"Push Notification Service Not Supported\",\r\n    \"580\", \"Precondition Failure\",\r\n    \"600\", \"Busy Everywhere\",\r\n    \"603\", \"Decline\",\r\n    \"604\", \"Does Not Exist Anywhere\",\r\n    \"606\", \"Not Acceptable\",\r\n    \"607\", \"Unwanted\",\r\n    \"608\", \"Rejected\",\r\n];\r\n\r\nlet other_chat_operations = ACSChatIncomingOperations\r\n| where TimeGenerated {time_range:query}\r\n| summarize operation_count=count() by OperationName\r\n| order by operation_count desc\r\n| extend Rank=row_number()\r\n| where Rank > 5\r\n| project OperationName;\r\n\r\nACSChatIncomingOperations\r\n| where TimeGenerated {time_range:query} and (OperationName in (dynamic([{chat_operation}])) or iff(\"Other\" in (dynamic([{chat_operation}])), (OperationName in (other_chat_operations)), false))\r\n| join kind=leftouter SIPCodesChat on ResultSignature\r\n| extend OperationDate=strcat(\"ðŸ“…\", format_datetime(TimeGenerated, 'MM/dd/y'))\r\n| extend OperationTime=format_datetime(TimeGenerated, 'hh:mm:ss')\r\n| extend ResultIcon=iff(ResultType == \"Succeeded\", \"âœ”ï¸\", \"âŒ\")\r\n| extend Result=strcat(ResultIcon, \" \", ResultSignature, \": \", SIPCode)\r\n| order by TimeGenerated\r\n| project OperationName, Result, UserId, ChatThreadId, CallerIpAddress, Level, OperationDate, OperationTime, DurationMs",
                    "size": 0,
                    "title": "Chat operations with operation name {chat_operation}",
                    "noDataMessage": "No chat operations found for the specified time range and operation name",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Level",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Warning",
                                "representation": "warning",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "info",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "OperationDate",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "OperationTime",
                          "formatter": 5
                        }
                      ],
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "OperationDate"
                        ],
                        "expandTopLevel": true,
                        "finalBy": "OperationTime"
                      }
                    },
                    "sortBy": []
                  },
                  "conditionalVisibility": {
                    "parameterName": "chat_operation",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "chat-by-operation"
                }
              ]
            },
            "customWidth": "50",
            "name": "chat-operation-names-group"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Chat Operation Versions",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ACSChatIncomingOperations\r\n| where TimeGenerated {time_range:query}\r\n| summarize count() by OperationVersion\r\n| render piechart",
                    "size": 0,
                    "noDataMessage": "No chat operations found in the specified time range",
                    "exportMultipleValues": true,
                    "exportedParameters": [
                      {
                        "fieldName": "series",
                        "parameterName": "chat_version",
                        "parameterType": 1
                      }
                    ],
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices"
                  },
                  "showPin": false,
                  "name": "chat-operation-versions"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SIPCodesChat =  datatable(ResultSignature: string, SIPCode: string)\r\n[\r\n    \"0\", \"Success\",\r\n    \"100\", \"Trying\",\r\n    \"180\", \"Ringing\",\r\n    \"181\", \"Call Is Being Forwarded\",\r\n    \"182\", \"Queued\",\r\n    \"183\", \"Session Progress\",\r\n    \"199\", \"Early Dialog Terminated\",\r\n    \"200\", \"Success\",\r\n    \"202\", \"Accepted\",\r\n    \"204\", \"No Notification\",\r\n    \"300\", \"Multiple Choices\",\r\n    \"301\", \"Moved Permanently\",\r\n    \"302\", \"Moved Temporarily\",\r\n    \"305\", \"Use Proxy\",\r\n    \"380\", \"Alternative Service\",\r\n    \"400\", \"Bad Request\",\r\n    \"401\", \"Unauthorized\",\r\n    \"402\", \"Payment Required\",\r\n    \"403\", \"Forbidden\",\r\n    \"404\", \"Not Found\",\r\n    \"405\", \"Method Not Allowed\",\r\n    \"406\", \"Not Acceptable\",\r\n    \"407\", \"Proxy Authentication Required\",\r\n    \"408\", \"Request Timeout\",\r\n    \"409\", \"Conflict\",\r\n    \"410\", \"Gone\",\r\n    \"411\", \"Length Required\",\r\n    \"412\", \"Conditional Request Failed\",\r\n    \"413\", \"Request Entity Too Large\",\r\n    \"414\", \"Request-URI Too Large\",\r\n    \"415\", \"Unsupported Media Type\",\r\n    \"416\", \"Unsupported URI Scheme\",\r\n    \"417\", \"Unknown Resource-Priority\",\r\n    \"420\", \"Bad Extension\",\r\n    \"421\", \"Extension Required\",\r\n    \"422\", \"Session Interval Too Small\",\r\n    \"423\", \"Interval Too Brief\",\r\n    \"424\", \"Bad Location Information\",\r\n    \"428\", \"Use Identity Header\",\r\n    \"429\", \"Provide Referrer Identity\",\r\n    \"430\", \"Flow Failed\",\r\n    \"433\", \"Anonymity Disallowed\",\r\n    \"436\", \"Bad Identity-Info\",\r\n    \"437\", \"Unsupported Certificate\",\r\n    \"438\", \"Invalid Identity Header\",\r\n    \"439\", \"First Hop Lacks Outbound Support\",\r\n    \"440\", \"Max-Breadth Exceeded\",\r\n    \"469\", \"Bad Info Package\",\r\n    \"470\", \"Consent Needed\",\r\n    \"480\", \"Temporarily Unavailable\",\r\n    \"481\", \"Call/Transaction Does Not Exist\",\r\n    \"482\", \"Loop Detected\",\r\n    \"483\", \"Too Many Hops\",\r\n    \"484\", \"Address Incomplete\",\r\n    \"485\", \"Ambiguous\",\r\n    \"486\", \"Busy Here\",\r\n    \"487\", \"Request Terminated\",\r\n    \"488\", \"Not Acceptable Here\",\r\n    \"489\", \"Bad Event\",\r\n    \"491\", \"Request Pending\",\r\n    \"493\", \"Undecipherable\",\r\n    \"494\", \"Security Agreement Required\",\r\n    \"500\", \"Internal Server Error\",\r\n    \"501\", \"Not Implemented\",\r\n    \"502\", \"Bad Gateway\",\r\n    \"503\", \"Service Unavailable\",\r\n    \"504\", \"Server Time-out\",\r\n    \"505\", \"Version Not Supported\",\r\n    \"513\", \"Message Too Large\",\r\n    \"555\", \"Push Notification Service Not Supported\",\r\n    \"580\", \"Precondition Failure\",\r\n    \"600\", \"Busy Everywhere\",\r\n    \"603\", \"Decline\",\r\n    \"604\", \"Does Not Exist Anywhere\",\r\n    \"606\", \"Not Acceptable\",\r\n    \"607\", \"Unwanted\",\r\n    \"608\", \"Rejected\",\r\n];\r\n\r\nlet other_chat_versions = ACSChatIncomingOperations\r\n| where TimeGenerated {time_range:query}\r\n| summarize operation_count=count() by OperationVersion\r\n| order by operation_count desc\r\n| extend Rank=row_number()\r\n| where Rank > 5\r\n| project OperationVersion;\r\n\r\nACSChatIncomingOperations\r\n| where TimeGenerated {time_range:query} and (OperationVersion in (dynamic([{chat_version}])) or iff(\"Other\" in (dynamic([{chat_version}])), (OperationVersion in (other_chat_versions)), false))\r\n| join kind=leftouter SIPCodesChat on ResultSignature\r\n| extend OperationDate=strcat(\"ðŸ“…\", format_datetime(TimeGenerated, 'MM/dd/y'))\r\n| extend OperationTime=format_datetime(TimeGenerated, 'hh:mm:ss')\r\n| extend ResultIcon=iff(ResultType == \"Succeeded\", \"âœ”ï¸\", \"âŒ\")\r\n| extend Result=strcat(ResultIcon, \" \", ResultSignature, \": \", SIPCode)\r\n| order by TimeGenerated\r\n| project OperationName, Result, UserId, ChatThreadId, CallerIpAddress, Level, OperationDate, OperationTime, DurationMs",
                    "size": 0,
                    "title": "Chat operations with operation version {chat_version}",
                    "noDataMessage": "No chat operations found for the specified time range and operation version",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Level",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Warning",
                                "representation": "warning",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "info",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "OperationDate",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "OperationTime",
                          "formatter": 5
                        }
                      ],
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "OperationDate"
                        ],
                        "expandTopLevel": true,
                        "finalBy": "OperationTime"
                      }
                    },
                    "sortBy": []
                  },
                  "conditionalVisibility": {
                    "parameterName": "chat_version",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "chat-by-version"
                }
              ]
            },
            "customWidth": "50",
            "name": "chat-operation-versions-group"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Identity drill-down",
              "items": [
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "0c0b56fd-ffd9-4761-b14e-c916660f9ccc",
                        "version": "KqlParameterItem/1.0",
                        "name": "chat_identity",
                        "label": "Identity",
                        "type": 2,
                        "description": "Choose an identity to visualize",
                        "query": "ACSChatIncomingOperations\r\n| where TimeGenerated {time_range:query}\r\n| order by TimeGenerated\r\n| distinct UserId\r\n| where isnotempty(UserId)",
                        "value": null,
                        "typeSettings": {
                          "additionalResourceOptions": [],
                          "showDefault": false
                        },
                        "queryType": 0,
                        "resourceType": "microsoft.communication/communicationservices"
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices"
                  },
                  "name": "chat-identity-parameters"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "**Select an identity from the drop-down menu to display its associated data**",
                    "style": "info"
                  },
                  "conditionalVisibility": {
                    "parameterName": "chat_identity",
                    "comparison": "isEqualTo"
                  },
                  "name": "chat-identity-drilldown-info"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SIPCodes =  datatable(ParticipantEndReason: string, SIPCode: string)\r\n[\r\n    \"0\", \"Success\",\r\n    \"100\", \"Trying\",\r\n    \"180\", \"Ringing\",\r\n    \"181\", \"Call Is Being Forwarded\",\r\n    \"182\", \"Queued\",\r\n    \"183\", \"Session Progress\",\r\n    \"199\", \"Early Dialog Terminated\",\r\n    \"200\", \"Success\",\r\n    \"202\", \"Accepted\",\r\n    \"204\", \"No Notification\",\r\n    \"300\", \"Multiple Choices\",\r\n    \"301\", \"Moved Permanently\",\r\n    \"302\", \"Moved Temporarily\",\r\n    \"305\", \"Use Proxy\",\r\n    \"380\", \"Alternative Service\",\r\n    \"400\", \"Bad Request\",\r\n    \"401\", \"Unauthorized\",\r\n    \"402\", \"Payment Required\",\r\n    \"403\", \"Forbidden\",\r\n    \"404\", \"Not Found\",\r\n    \"405\", \"Method Not Allowed\",\r\n    \"406\", \"Not Acceptable\",\r\n    \"407\", \"Proxy Authentication Required\",\r\n    \"408\", \"Request Timeout\",\r\n    \"409\", \"Conflict\",\r\n    \"410\", \"Gone\",\r\n    \"411\", \"Length Required\",\r\n    \"412\", \"Conditional Request Failed\",\r\n    \"413\", \"Request Entity Too Large\",\r\n    \"414\", \"Request-URI Too Large\",\r\n    \"415\", \"Unsupported Media Type\",\r\n    \"416\", \"Unsupported URI Scheme\",\r\n    \"417\", \"Unknown Resource-Priority\",\r\n    \"420\", \"Bad Extension\",\r\n    \"421\", \"Extension Required\",\r\n    \"422\", \"Session Interval Too Small\",\r\n    \"423\", \"Interval Too Brief\",\r\n    \"424\", \"Bad Location Information\",\r\n    \"428\", \"Use Identity Header\",\r\n    \"429\", \"Provide Referrer Identity\",\r\n    \"430\", \"Flow Failed\",\r\n    \"433\", \"Anonymity Disallowed\",\r\n    \"436\", \"Bad Identity-Info\",\r\n    \"437\", \"Unsupported Certificate\",\r\n    \"438\", \"Invalid Identity Header\",\r\n    \"439\", \"First Hop Lacks Outbound Support\",\r\n    \"440\", \"Max-Breadth Exceeded\",\r\n    \"469\", \"Bad Info Package\",\r\n    \"470\", \"Consent Needed\",\r\n    \"480\", \"Temporarily Unavailable\",\r\n    \"481\", \"Call/Transaction Does Not Exist\",\r\n    \"482\", \"Loop Detected\",\r\n    \"483\", \"Too Many Hops\",\r\n    \"484\", \"Address Incomplete\",\r\n    \"485\", \"Ambiguous\",\r\n    \"486\", \"Busy Here\",\r\n    \"487\", \"Request Terminated\",\r\n    \"488\", \"Not Acceptable Here\",\r\n    \"489\", \"Bad Event\",\r\n    \"491\", \"Request Pending\",\r\n    \"493\", \"Undecipherable\",\r\n    \"494\", \"Security Agreement Required\",\r\n    \"500\", \"Internal Server Error\",\r\n    \"501\", \"Not Implemented\",\r\n    \"502\", \"Bad Gateway\",\r\n    \"503\", \"Service Unavailable\",\r\n    \"504\", \"Server Time-out\",\r\n    \"505\", \"Version Not Supported\",\r\n    \"513\", \"Message Too Large\",\r\n    \"555\", \"Push Notification Service Not Supported\",\r\n    \"580\", \"Precondition Failure\",\r\n    \"600\", \"Busy Everywhere\",\r\n    \"603\", \"Decline\",\r\n    \"604\", \"Does Not Exist Anywhere\",\r\n    \"606\", \"Not Acceptable\",\r\n    \"607\", \"Unwanted\",\r\n    \"608\", \"Rejected\",\r\n];\r\n\r\nACSCallDiagnostics\r\n| join kind=inner ACSCallSummary on CorrelationId, ParticipantId, EndpointId\r\n| where CallStartTime {time_range:query} and Identifier == substring(\"{chat_identity}\", indexof(\"{chat_identity}\", \"acs:\"))\r\n| join kind=leftouter SIPCodes on ParticipantEndReason\r\n| extend EndReason=strcat(ParticipantEndReason, \": \", SIPCode)\r\n| extend CallDate=strcat(\"ðŸ“…\", format_datetime(CallStartTime, 'MM/dd/y'))\r\n| extend UnsuccessfulEndReason = iff((ParticipantEndReason startswith \"0\") or (ParticipantEndReason startswith \"2\"), \"\", \"ðŸ›‘\")\r\n| extend ParticipantTime=format_datetime(ParticipantStartTime, 'hh:mm:ss')\r\n| extend EndpointType = case(  indexof(EndpointType, \"VoIP\") != -1, strcat(\"ðŸ—£ï¸ \", EndpointType),\r\n                            indexof(EndpointType, \"PSTN\") != -1, strcat(\"ðŸ“ž \", EndpointType),\r\n                            indexof(EndpointType, \"Bot\") != -1, strcat(\"ðŸ¤– \", EndpointType),\r\n                            indexof(EndpointType, \"Server\") != -1, strcat(\"ðŸ–¥ï¸ \", EndpointType),\r\n                            indexof(EndpointType, \"Unknown\") != -1, strcat(\"ðŸ‘½ \", EndpointType),\r\n                            EndpointType\r\n                        )\r\n| extend Participant = strcat(EndpointType, \" \", UnsuccessfulEndReason, \" \", ParticipantTime, \" (\", ParticipantId, \")\")\r\n| extend MediaType = case(  indexof(MediaType, \"Audio\") != -1, strcat(\"ðŸ”Š \", MediaType),\r\n                            indexof(MediaType, \"Video\") != -1, strcat(\"ðŸŽ¥ \", MediaType),\r\n                            indexof(MediaType, \"VBSS\") != -1, strcat(\"ðŸ’» \", MediaType),\r\n                            indexof(MediaType, \"AppSharing\") != -1, strcat(\"ðŸ“² \", MediaType),\r\n                            MediaType\r\n                        )\r\n| project CallDate, CallId = strcat(\"ðŸ“ž \", CorrelationId), Participant, MediaType, ParticipantDuration, EndReason, JitterAvg, PacketLossRateAvg, RoundTripTimeAvg",
                    "size": 0,
                    "title": "Calls for identity {chat_identity}",
                    "noDataMessage": "No calls found for the specified time range and identity",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "CallDate",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "CallId",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Participant",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "MediaType",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "EndReason",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "startsWith",
                                "thresholdValue": "2",
                                "representation": "success",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "startsWith",
                                "thresholdValue": "0",
                                "representation": "success",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "3",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "JitterAvg",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": ">",
                                "thresholdValue": "30",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "PacketLossRateAvg",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": ">",
                                "thresholdValue": ".1",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "RoundTripTimeAvg",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": ">",
                                "thresholdValue": "500",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "CallDate",
                          "CallId",
                          "Participant"
                        ],
                        "expandTopLevel": true,
                        "finalBy": "MediaType"
                      }
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "chat_identity",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "chat-identity-call-details"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SIPCodesChat =  datatable(ResultSignature: string, SIPCode: string)\r\n[\r\n    \"0\", \"Success\",\r\n    \"100\", \"Trying\",\r\n    \"180\", \"Ringing\",\r\n    \"181\", \"Call Is Being Forwarded\",\r\n    \"182\", \"Queued\",\r\n    \"183\", \"Session Progress\",\r\n    \"199\", \"Early Dialog Terminated\",\r\n    \"200\", \"Success\",\r\n    \"202\", \"Accepted\",\r\n    \"204\", \"No Notification\",\r\n    \"300\", \"Multiple Choices\",\r\n    \"301\", \"Moved Permanently\",\r\n    \"302\", \"Moved Temporarily\",\r\n    \"305\", \"Use Proxy\",\r\n    \"380\", \"Alternative Service\",\r\n    \"400\", \"Bad Request\",\r\n    \"401\", \"Unauthorized\",\r\n    \"402\", \"Payment Required\",\r\n    \"403\", \"Forbidden\",\r\n    \"404\", \"Not Found\",\r\n    \"405\", \"Method Not Allowed\",\r\n    \"406\", \"Not Acceptable\",\r\n    \"407\", \"Proxy Authentication Required\",\r\n    \"408\", \"Request Timeout\",\r\n    \"409\", \"Conflict\",\r\n    \"410\", \"Gone\",\r\n    \"411\", \"Length Required\",\r\n    \"412\", \"Conditional Request Failed\",\r\n    \"413\", \"Request Entity Too Large\",\r\n    \"414\", \"Request-URI Too Large\",\r\n    \"415\", \"Unsupported Media Type\",\r\n    \"416\", \"Unsupported URI Scheme\",\r\n    \"417\", \"Unknown Resource-Priority\",\r\n    \"420\", \"Bad Extension\",\r\n    \"421\", \"Extension Required\",\r\n    \"422\", \"Session Interval Too Small\",\r\n    \"423\", \"Interval Too Brief\",\r\n    \"424\", \"Bad Location Information\",\r\n    \"428\", \"Use Identity Header\",\r\n    \"429\", \"Provide Referrer Identity\",\r\n    \"430\", \"Flow Failed\",\r\n    \"433\", \"Anonymity Disallowed\",\r\n    \"436\", \"Bad Identity-Info\",\r\n    \"437\", \"Unsupported Certificate\",\r\n    \"438\", \"Invalid Identity Header\",\r\n    \"439\", \"First Hop Lacks Outbound Support\",\r\n    \"440\", \"Max-Breadth Exceeded\",\r\n    \"469\", \"Bad Info Package\",\r\n    \"470\", \"Consent Needed\",\r\n    \"480\", \"Temporarily Unavailable\",\r\n    \"481\", \"Call/Transaction Does Not Exist\",\r\n    \"482\", \"Loop Detected\",\r\n    \"483\", \"Too Many Hops\",\r\n    \"484\", \"Address Incomplete\",\r\n    \"485\", \"Ambiguous\",\r\n    \"486\", \"Busy Here\",\r\n    \"487\", \"Request Terminated\",\r\n    \"488\", \"Not Acceptable Here\",\r\n    \"489\", \"Bad Event\",\r\n    \"491\", \"Request Pending\",\r\n    \"493\", \"Undecipherable\",\r\n    \"494\", \"Security Agreement Required\",\r\n    \"500\", \"Internal Server Error\",\r\n    \"501\", \"Not Implemented\",\r\n    \"502\", \"Bad Gateway\",\r\n    \"503\", \"Service Unavailable\",\r\n    \"504\", \"Server Time-out\",\r\n    \"505\", \"Version Not Supported\",\r\n    \"513\", \"Message Too Large\",\r\n    \"555\", \"Push Notification Service Not Supported\",\r\n    \"580\", \"Precondition Failure\",\r\n    \"600\", \"Busy Everywhere\",\r\n    \"603\", \"Decline\",\r\n    \"604\", \"Does Not Exist Anywhere\",\r\n    \"606\", \"Not Acceptable\",\r\n    \"607\", \"Unwanted\",\r\n    \"608\", \"Rejected\",\r\n];\r\n\r\nACSChatIncomingOperations\r\n| where TimeGenerated {time_range:query} and UserId == \"{chat_identity}\"\r\n| join kind=leftouter SIPCodesChat on ResultSignature\r\n| extend OperationDate=strcat(\"ðŸ“…\", format_datetime(TimeGenerated, 'MM/dd/y'))\r\n| extend OperationTime=format_datetime(TimeGenerated, 'hh:mm:ss')\r\n| extend ResultIcon=iff(ResultType == \"Succeeded\", \"âœ”ï¸\", \"âŒ\")\r\n| extend Result=strcat(ResultIcon, \" \", ResultSignature, \": \", SIPCode)\r\n| order by TimeGenerated\r\n| project OperationName, Level, Result, OperationDate, OperationTime, DurationMs\r\n",
                    "size": 0,
                    "title": "Chat operations for identity {chat_identity}",
                    "noDataMessage": "No chat operations found for the specified  time range and identity",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Level",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Warning",
                                "representation": "warning",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "info",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "OperationDate",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "OperationTime",
                          "formatter": 5
                        }
                      ],
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "OperationDate"
                        ],
                        "expandTopLevel": true,
                        "finalBy": "OperationTime"
                      }
                    },
                    "sortBy": []
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "chat_identity",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "chat-identity-chat-details"
                }
              ]
            },
            "name": "chat-identity-drill-down-group"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Chat meeting drill-down",
              "items": [
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "0c0b56fd-ffd9-4761-b14e-c916660f9ccc",
                        "version": "KqlParameterItem/1.0",
                        "name": "chat_meeting",
                        "label": "Chat meeting ID",
                        "type": 2,
                        "description": "Choose a chat meeting ID to visualize",
                        "query": "ACSChatIncomingOperations\r\n| where TimeGenerated {time_range:query}\r\n| order by TimeGenerated\r\n| distinct ChatThreadId\r\n| where isnotempty(ChatThreadId)",
                        "value": null,
                        "typeSettings": {
                          "additionalResourceOptions": [],
                          "showDefault": false
                        },
                        "queryType": 0,
                        "resourceType": "microsoft.communication/communicationservices"
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices"
                  },
                  "name": "chat-meeting-parameters"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "**Select a chat meeting ID from the drop-down menu to display its associated data**",
                    "style": "info"
                  },
                  "conditionalVisibility": {
                    "parameterName": "chat_meeting",
                    "comparison": "isEqualTo"
                  },
                  "name": "chat-meeting-drilldown-info"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SIPCodesChat =  datatable(ResultSignature: string, SIPCode: string)\r\n[\r\n    \"0\", \"Success\",\r\n    \"100\", \"Trying\",\r\n    \"180\", \"Ringing\",\r\n    \"181\", \"Call Is Being Forwarded\",\r\n    \"182\", \"Queued\",\r\n    \"183\", \"Session Progress\",\r\n    \"199\", \"Early Dialog Terminated\",\r\n    \"200\", \"Success\",\r\n    \"202\", \"Accepted\",\r\n    \"204\", \"No Notification\",\r\n    \"300\", \"Multiple Choices\",\r\n    \"301\", \"Moved Permanently\",\r\n    \"302\", \"Moved Temporarily\",\r\n    \"305\", \"Use Proxy\",\r\n    \"380\", \"Alternative Service\",\r\n    \"400\", \"Bad Request\",\r\n    \"401\", \"Unauthorized\",\r\n    \"402\", \"Payment Required\",\r\n    \"403\", \"Forbidden\",\r\n    \"404\", \"Not Found\",\r\n    \"405\", \"Method Not Allowed\",\r\n    \"406\", \"Not Acceptable\",\r\n    \"407\", \"Proxy Authentication Required\",\r\n    \"408\", \"Request Timeout\",\r\n    \"409\", \"Conflict\",\r\n    \"410\", \"Gone\",\r\n    \"411\", \"Length Required\",\r\n    \"412\", \"Conditional Request Failed\",\r\n    \"413\", \"Request Entity Too Large\",\r\n    \"414\", \"Request-URI Too Large\",\r\n    \"415\", \"Unsupported Media Type\",\r\n    \"416\", \"Unsupported URI Scheme\",\r\n    \"417\", \"Unknown Resource-Priority\",\r\n    \"420\", \"Bad Extension\",\r\n    \"421\", \"Extension Required\",\r\n    \"422\", \"Session Interval Too Small\",\r\n    \"423\", \"Interval Too Brief\",\r\n    \"424\", \"Bad Location Information\",\r\n    \"428\", \"Use Identity Header\",\r\n    \"429\", \"Provide Referrer Identity\",\r\n    \"430\", \"Flow Failed\",\r\n    \"433\", \"Anonymity Disallowed\",\r\n    \"436\", \"Bad Identity-Info\",\r\n    \"437\", \"Unsupported Certificate\",\r\n    \"438\", \"Invalid Identity Header\",\r\n    \"439\", \"First Hop Lacks Outbound Support\",\r\n    \"440\", \"Max-Breadth Exceeded\",\r\n    \"469\", \"Bad Info Package\",\r\n    \"470\", \"Consent Needed\",\r\n    \"480\", \"Temporarily Unavailable\",\r\n    \"481\", \"Call/Transaction Does Not Exist\",\r\n    \"482\", \"Loop Detected\",\r\n    \"483\", \"Too Many Hops\",\r\n    \"484\", \"Address Incomplete\",\r\n    \"485\", \"Ambiguous\",\r\n    \"486\", \"Busy Here\",\r\n    \"487\", \"Request Terminated\",\r\n    \"488\", \"Not Acceptable Here\",\r\n    \"489\", \"Bad Event\",\r\n    \"491\", \"Request Pending\",\r\n    \"493\", \"Undecipherable\",\r\n    \"494\", \"Security Agreement Required\",\r\n    \"500\", \"Internal Server Error\",\r\n    \"501\", \"Not Implemented\",\r\n    \"502\", \"Bad Gateway\",\r\n    \"503\", \"Service Unavailable\",\r\n    \"504\", \"Server Time-out\",\r\n    \"505\", \"Version Not Supported\",\r\n    \"513\", \"Message Too Large\",\r\n    \"555\", \"Push Notification Service Not Supported\",\r\n    \"580\", \"Precondition Failure\",\r\n    \"600\", \"Busy Everywhere\",\r\n    \"603\", \"Decline\",\r\n    \"604\", \"Does Not Exist Anywhere\",\r\n    \"606\", \"Not Acceptable\",\r\n    \"607\", \"Unwanted\",\r\n    \"608\", \"Rejected\",\r\n];\r\n\r\nACSChatIncomingOperations\r\n| where TimeGenerated {time_range:query} and ChatThreadId == \"{chat_meeting}\"\r\n| join kind=leftouter SIPCodesChat on ResultSignature\r\n| extend OperationDate=strcat(\"ðŸ“…\", format_datetime(TimeGenerated, 'MM/dd/y'))\r\n| extend OperationTime=format_datetime(TimeGenerated, 'hh:mm:ss')\r\n| extend ResultIcon=iff(ResultType == \"Succeeded\", \"âœ”ï¸\", \"âŒ\")\r\n| extend Result=strcat(ResultIcon, \" \", ResultSignature, \": \", SIPCode)\r\n| order by TimeGenerated\r\n| project OperationName, Level, Result, OperationDate, OperationTime, DurationMs\r\n",
                    "size": 0,
                    "title": "Chat operations for meeting {chat_meeting}",
                    "noDataMessage": "No chat operations found for the specified time range and meeting ID",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Level",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Warning",
                                "representation": "warning",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "info",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "OperationDate",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "OperationTime",
                          "formatter": 5
                        }
                      ],
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "OperationDate"
                        ],
                        "expandTopLevel": true,
                        "finalBy": "OperationTime"
                      }
                    },
                    "sortBy": []
                  },
                  "conditionalVisibility": {
                    "parameterName": "chat_meeting",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "chat-meeting-details"
                }
              ]
            },
            "name": "chat-meeting-drill-down-group"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Chat IP address drill-down",
              "items": [
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "0c0b56fd-ffd9-4761-b14e-c916660f9ccc",
                        "version": "KqlParameterItem/1.0",
                        "name": "chat_ip",
                        "label": "IP address",
                        "type": 2,
                        "description": "Choose an IP address to visualize",
                        "query": "ACSChatIncomingOperations\r\n| where TimeGenerated {time_range:query}\r\n| order by TimeGenerated\r\n| distinct CallerIpAddress\r\n| where isnotempty(CallerIpAddress)",
                        "value": null,
                        "typeSettings": {
                          "additionalResourceOptions": [],
                          "showDefault": false
                        },
                        "queryType": 0,
                        "resourceType": "microsoft.communication/communicationservices"
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices"
                  },
                  "name": "chat-ip-parameters"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "**Select an IP address from the drop-down menu to display its associated data**",
                    "style": "info"
                  },
                  "conditionalVisibility": {
                    "parameterName": "chat_ip",
                    "comparison": "isEqualTo"
                  },
                  "name": "chat-ip-drilldown-info"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SIPCodesChat =  datatable(ResultSignature: string, SIPCode: string)\r\n[\r\n    \"0\", \"Success\",\r\n    \"100\", \"Trying\",\r\n    \"180\", \"Ringing\",\r\n    \"181\", \"Call Is Being Forwarded\",\r\n    \"182\", \"Queued\",\r\n    \"183\", \"Session Progress\",\r\n    \"199\", \"Early Dialog Terminated\",\r\n    \"200\", \"Success\",\r\n    \"202\", \"Accepted\",\r\n    \"204\", \"No Notification\",\r\n    \"300\", \"Multiple Choices\",\r\n    \"301\", \"Moved Permanently\",\r\n    \"302\", \"Moved Temporarily\",\r\n    \"305\", \"Use Proxy\",\r\n    \"380\", \"Alternative Service\",\r\n    \"400\", \"Bad Request\",\r\n    \"401\", \"Unauthorized\",\r\n    \"402\", \"Payment Required\",\r\n    \"403\", \"Forbidden\",\r\n    \"404\", \"Not Found\",\r\n    \"405\", \"Method Not Allowed\",\r\n    \"406\", \"Not Acceptable\",\r\n    \"407\", \"Proxy Authentication Required\",\r\n    \"408\", \"Request Timeout\",\r\n    \"409\", \"Conflict\",\r\n    \"410\", \"Gone\",\r\n    \"411\", \"Length Required\",\r\n    \"412\", \"Conditional Request Failed\",\r\n    \"413\", \"Request Entity Too Large\",\r\n    \"414\", \"Request-URI Too Large\",\r\n    \"415\", \"Unsupported Media Type\",\r\n    \"416\", \"Unsupported URI Scheme\",\r\n    \"417\", \"Unknown Resource-Priority\",\r\n    \"420\", \"Bad Extension\",\r\n    \"421\", \"Extension Required\",\r\n    \"422\", \"Session Interval Too Small\",\r\n    \"423\", \"Interval Too Brief\",\r\n    \"424\", \"Bad Location Information\",\r\n    \"428\", \"Use Identity Header\",\r\n    \"429\", \"Provide Referrer Identity\",\r\n    \"430\", \"Flow Failed\",\r\n    \"433\", \"Anonymity Disallowed\",\r\n    \"436\", \"Bad Identity-Info\",\r\n    \"437\", \"Unsupported Certificate\",\r\n    \"438\", \"Invalid Identity Header\",\r\n    \"439\", \"First Hop Lacks Outbound Support\",\r\n    \"440\", \"Max-Breadth Exceeded\",\r\n    \"469\", \"Bad Info Package\",\r\n    \"470\", \"Consent Needed\",\r\n    \"480\", \"Temporarily Unavailable\",\r\n    \"481\", \"Call/Transaction Does Not Exist\",\r\n    \"482\", \"Loop Detected\",\r\n    \"483\", \"Too Many Hops\",\r\n    \"484\", \"Address Incomplete\",\r\n    \"485\", \"Ambiguous\",\r\n    \"486\", \"Busy Here\",\r\n    \"487\", \"Request Terminated\",\r\n    \"488\", \"Not Acceptable Here\",\r\n    \"489\", \"Bad Event\",\r\n    \"491\", \"Request Pending\",\r\n    \"493\", \"Undecipherable\",\r\n    \"494\", \"Security Agreement Required\",\r\n    \"500\", \"Internal Server Error\",\r\n    \"501\", \"Not Implemented\",\r\n    \"502\", \"Bad Gateway\",\r\n    \"503\", \"Service Unavailable\",\r\n    \"504\", \"Server Time-out\",\r\n    \"505\", \"Version Not Supported\",\r\n    \"513\", \"Message Too Large\",\r\n    \"555\", \"Push Notification Service Not Supported\",\r\n    \"580\", \"Precondition Failure\",\r\n    \"600\", \"Busy Everywhere\",\r\n    \"603\", \"Decline\",\r\n    \"604\", \"Does Not Exist Anywhere\",\r\n    \"606\", \"Not Acceptable\",\r\n    \"607\", \"Unwanted\",\r\n    \"608\", \"Rejected\",\r\n];\r\n\r\nACSChatIncomingOperations\r\n| where TimeGenerated {time_range:query} and CallerIpAddress == \"{chat_ip}\"\r\n| join kind=leftouter SIPCodesChat on ResultSignature\r\n| extend OperationDate=strcat(\"ðŸ“…\", format_datetime(TimeGenerated, 'MM/dd/y'))\r\n| extend OperationTime=format_datetime(TimeGenerated, 'hh:mm:ss')\r\n| extend ResultIcon=iff(ResultType == \"Succeeded\", \"âœ”ï¸\", \"âŒ\")\r\n| extend Result=strcat(ResultIcon, \" \", ResultSignature, \": \", SIPCode)\r\n| order by TimeGenerated\r\n| project OperationName, Level, Result, OperationDate, OperationTime, DurationMs\r\n",
                    "size": 0,
                    "title": "Chat operations for IP address {chat_ip}",
                    "noDataMessage": "No chat operations found for the specified time range and IP address",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Level",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Warning",
                                "representation": "warning",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "info",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "OperationDate",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "OperationTime",
                          "formatter": 5
                        }
                      ],
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "OperationDate"
                        ],
                        "expandTopLevel": true,
                        "finalBy": "OperationTime"
                      }
                    },
                    "sortBy": []
                  },
                  "conditionalVisibility": {
                    "parameterName": "chat_ip",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "chat-ip-details"
                }
              ]
            },
            "name": "chat-ip-drill-down-group"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "tab",
        "comparison": "isEqualTo",
        "value": "chat"
      },
      "name": "chat-group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "tabs",
              "links": [
                {
                  "id": "ce0cf675-8b7d-4564-bc03-4a24a7a41de4",
                  "cellValue": "tab",
                  "linkTarget": "parameter",
                  "linkLabel": "Overview",
                  "subTarget": "overview",
                  "style": "link"
                },
                {
                  "id": "8f11c89c-1098-468e-9348-86268f1c97e0",
                  "cellValue": "tab",
                  "linkTarget": "parameter",
                  "linkLabel": "Message Delivery rates",
                  "subTarget": "delivery",
                  "style": "link"
                },
                {
                  "id": "18cbfbc7-0b07-4075-bd91-ccacd0ca7720",
                  "cellValue": "tab",
                  "linkTarget": "parameter",
                  "linkLabel": "Opt-in & opt-out rates",
                  "subTarget": "opt",
                  "style": "link"
                },
                {
                  "id": "339e38a6-37cc-4a0f-90cf-e33eda8e6c44",
                  "cellValue": "tab",
                  "linkTarget": "parameter",
                  "linkLabel": "Response patterns",
                  "subTarget": "patterns",
                  "preText": "Overview",
                  "style": "link"
                }
              ]
            },
            "name": "sms-tabs"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "0a691a68-d70c-4571-8ded-67541fb970db",
                  "version": "KqlParameterItem/1.0",
                  "name": "number_type",
                  "label": "Number type",
                  "type": 2,
                  "isRequired": true,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "ACSSMSIncomingOperations\r\n| where TimeGenerated {time_range:query}\r\n| extend temp = case(NumberType <> '', NumberType, 'None')\r\n| extend NumberType = temp\r\n| distinct NumberType",
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "showDefault": false
                  },
                  "defaultValue": "value::all",
                  "queryType": 0,
                  "resourceType": "microsoft.communication/communicationservices",
                  "value": [
                    "value::all"
                  ]
                },
                {
                  "id": "938da893-f132-445b-a8e6-355865a31d59",
                  "version": "KqlParameterItem/1.0",
                  "name": "country",
                  "label": "Geo",
                  "type": 2,
                  "isRequired": true,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "ACSSMSIncomingOperations\r\n| where TimeGenerated {time_range:query}\r\n| extend temp = case(Country <> '', Country, 'UNKNOWN')\r\n| extend Country = temp\r\n| distinct Country",
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "showDefault": false
                  },
                  "defaultValue": "value::all",
                  "queryType": 0,
                  "resourceType": "microsoft.communication/communicationservices",
                  "value": [
                    "value::all"
                  ]
                },
                {
                  "id": "19168ccb-20ac-46a7-9219-eca8134b40f4",
                  "version": "KqlParameterItem/1.0",
                  "name": "phone_number",
                  "label": "Phone number",
                  "type": 2,
                  "isRequired": true,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "ACSSMSIncomingOperations\r\n| where TimeGenerated {time_range:query}\r\n| extend temp = case(PhoneNumber <> '', PhoneNumber, 'None')\r\n| extend PhoneNumber = temp\r\n| distinct PhoneNumber",
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ]
                  },
                  "defaultValue": "value::all",
                  "queryType": 0,
                  "resourceType": "microsoft.communication/communicationservices"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.communication/communicationservices"
            },
            "name": "sms-params"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "**Average SMS count during the day**"
                  },
                  "name": "text - 1"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ACSSMSIncomingOperations\r\n| where TimeGenerated {time_range:query}\r\n| where OperationName =='SMSDeliveryReportsReceived'\r\n| extend temp0 = case(NumberType <> '', NumberType, 'None')\r\n| extend NumberType = temp0\r\n| where NumberType in ({number_type})\r\n| extend temp0 = case(Country <> '', Country, 'UNKNOWN')\r\n| extend Country = temp0\r\n| where Country in ({country})\r\n| extend temp0 = case(PhoneNumber <> '', PhoneNumber, 'None')\r\n| extend PhoneNumber = temp0\r\n| where PhoneNumber in ({phone_number})\r\n| extend temp1 = case(ResultDescription in ('ErrorCode: 4005. ErrorMessage: Message is blocked by destination carrier',\r\n'ErrorCode: 4010. ErrorMessage: Message was blocked due to the toll-free number not being verified'), 'Blocked', ResultType)\r\n| extend ResultType = temp1\r\n| extend temp1 = case(ResultType == 'Succeeded', 'Delivered', ResultType)\r\n| extend ResultType = temp1\r\n| extend time_span = floor(TimeGenerated, 30m)\r\n| summarize event_count=count() by time_span, ResultType\r\n| extend time_span = todatetime(strcat(tostring(format_datetime(now(), 'yyyy-MM-dd')),'T', substring(tostring(time_span),11)))\r\n| summarize event_count=avg(event_count) by time_span, ResultType\r\n| union (\r\nACSSMSIncomingOperations\r\n| where TimeGenerated {time_range:query}\r\n| where OperationName =='SMSMessagesReceived'\r\n| extend temp0 = case(NumberType <> '', NumberType, 'None')\r\n| extend NumberType = temp0\r\n| where NumberType in ({number_type})\r\n| where ResultSignature == '200'\r\n| extend ResultType = 'Received'\r\n| extend time_span = floor(TimeGenerated, 30m)\r\n| summarize event_count=count() by time_span, ResultType\r\n| extend time_span = todatetime(strcat(tostring(format_datetime(now(), 'yyyy-MM-dd')),'T', substring(tostring(time_span),11)))\r\n| summarize event_count=avg(event_count) by time_span, ResultType\r\n)\r\n| render columnchart\r\n",
                    "size": 0,
                    "aggregation": 3,
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices",
                    "chartSettings": {
                      "xSettings": {
                        "numberFormatSettings": {
                          "unit": 0,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true,
                            "maximumFractionDigits": 0
                          }
                        }
                      },
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 0,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true,
                            "maximumFractionDigits": 0
                          }
                        }
                      }
                    }
                  },
                  "name": "sms-average-chart"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "tab",
              "comparison": "isEqualTo",
              "value": "patterns"
            },
            "name": "sms-overview"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "SMS delivery rate",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ACSSMSIncomingOperations\r\n| where TimeGenerated {time_range:query}\r\n| where OperationName =='SMSDeliveryReportsReceived'\r\n| extend temp0 = case(NumberType <> '', NumberType, 'None')\r\n| extend NumberType = temp0\r\n| where NumberType in ({number_type})\r\n| extend temp0 = case(Country <> '', Country, 'UNKNOWN')\r\n| extend Country = temp0\r\n| where Country in ({country})\r\n| extend temp0 = case(PhoneNumber <> '', PhoneNumber, 'None')\r\n| extend PhoneNumber = temp0\r\n| where PhoneNumber in ({phone_number})\r\n| extend temp1 = case(ResultDescription in ('ErrorCode: 4005. ErrorMessage: Message is blocked by destination carrier',\r\n'ErrorCode: 4010. ErrorMessage: Message was blocked due to the toll-free number not being verified'), 'Blocked', ResultType)\r\n| extend ResultType = temp1\r\n| extend temp1 = case(ResultType == 'Succeeded', 'Delivered', ResultType)\r\n| extend ResultType = temp1\r\n| extend time_span = floor(TimeGenerated, 1d)\r\n| summarize event_count=count() by ResultType, time_span\r\n| project ResultType , time_span, event_count\r\n| extend DeliveryRate = case(ResultType == 'Delivered', event_count, 0)\r\n| extend BlockedRate = case(ResultType == 'Blocked', toint(event_count), 0)\r\n| extend FailedRate = case(ResultType == 'Failed', toint(event_count), 0)\r\n| extend Total = DeliveryRate + BlockedRate + FailedRate\r\n| summarize DeliveryRate = todouble(sum(DeliveryRate))/sum(Total), FailedRate = todouble(sum(FailedRate))/sum(Total), BlockedRate = todouble(sum(BlockedRate))/sum(Total) by time_span\r\n| render barchart",
                    "size": 0,
                    "aggregation": 3,
                    "noDataMessage": "No results for given time range.",
                    "exportFieldName": "series",
                    "exportParameterName": "time_series",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices",
                    "chartSettings": {
                      "xSettings": {
                        "numberFormatSettings": {
                          "unit": 0,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true,
                            "maximumFractionDigits": 0
                          }
                        }
                      },
                      "ySettings": {
                        "numberFormatSettings": {
                          "unit": 0,
                          "options": {
                            "style": "percent",
                            "useGrouping": true,
                            "minimumFractionDigits": 2
                          }
                        }
                      }
                    }
                  },
                  "name": "sms-delivery-rate-main"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "tab",
              "comparison": "isEqualTo",
              "value": "delivery"
            },
            "name": "sms-delivery-rate"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ACSSMSIncomingOperations\r\n| where TimeGenerated {time_range:query}\r\n| where OperationName =='SMSDeliveryReportsReceived'\r\n| extend temp0 = case(NumberType <> '', NumberType, 'None')\r\n| extend NumberType = temp0\r\n| where NumberType in ({number_type})\r\n| extend temp0 = case(Country <> '', Country, 'UNKNOWN')\r\n| extend Country = temp0\r\n| where Country in ({country})\r\n| extend temp0 = case(PhoneNumber <> '', PhoneNumber, 'None')\r\n| extend PhoneNumber = temp0\r\n| where PhoneNumber in ({phone_number})\r\n| extend temp1 = case(ResultDescription in ('ErrorCode: 4005. ErrorMessage: Message is blocked by destination carrier',\r\n'ErrorCode: 4010. ErrorMessage: Message was blocked due to the toll-free number not being verified'), 'Blocked', ResultType)\r\n| extend ResultType = temp1\r\n| extend temp1 = case(ResultType == 'Succeeded', 'Successfully Sent', ResultType)\r\n| extend ResultType = temp1\r\n| summarize event_count=count() by ResultType\r\n| project ResultType , event_count\r\n| render piechart",
                    "size": 3,
                    "title": "Total SMS sent",
                    "noDataMessage": "No results for given time range.",
                    "exportMultipleValues": true,
                    "exportedParameters": [
                      {
                        "fieldName": "series",
                        "parameterName": "delivery_result"
                      }
                    ],
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices"
                  },
                  "customWidth": "33",
                  "name": "sms-delivery-rate-main",
                  "styleSettings": {
                    "margin": "0",
                    "padding": "0"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ACSSMSIncomingOperations\r\n| where TimeGenerated {time_range:query}\r\n| where OperationName == 'SMSDeliveryReportsReceived'\r\n| extend temp0 = case(NumberType <> '', NumberType, 'None')\r\n| extend NumberType = temp0\r\n| where NumberType in ({number_type})\r\n| extend temp0 = case(Country <> '', Country, 'UNKNOWN')\r\n| extend Country = temp0\r\n| where Country in ({country})\r\n| extend temp0 = case(PhoneNumber <> '', PhoneNumber, 'None')\r\n| extend PhoneNumber = temp0\r\n| where PhoneNumber in ({phone_number})\r\n| extend temp1 = case(ResultDescription in ('ErrorCode: 4005. ErrorMessage: Message is blocked by destination carrier',\r\n'ErrorCode: 4010. ErrorMessage: Message was blocked due to the toll-free number not being verified'), 'Blocked', ResultType)\r\n| extend ResultType = temp1\r\n| where ResultType == 'Failed'\r\n| extend Description = substring(ResultDescription, 30)\r\n| summarize count_failures=count() by Description\r\n| render piechart",
                    "size": 3,
                    "title": "Failed SMS",
                    "noDataMessage": "No results for given time range.",
                    "exportMultipleValues": true,
                    "exportedParameters": [
                      {
                        "fieldName": "series",
                        "parameterName": "error",
                        "parameterType": 1
                      }
                    ],
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices"
                  },
                  "customWidth": "34",
                  "conditionalVisibilities": [
                    {
                      "parameterName": "delivery_result",
                      "comparison": "isNotEqualTo",
                      "value": "\"Successfully Sent\",\"Blocked\""
                    },
                    {
                      "parameterName": "delivery_result",
                      "comparison": "isNotEqualTo",
                      "value": "\"Blocked\",\"Successfully Sent\""
                    },
                    {
                      "parameterName": "delivery_result",
                      "comparison": "isNotEqualTo",
                      "value": "\"Successfully Sent\""
                    },
                    {
                      "parameterName": "delivery_result",
                      "comparison": "isNotEqualTo",
                      "value": "\"Blocked\""
                    }
                  ],
                  "name": "sms-failed"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ACSSMSIncomingOperations\r\n| where TimeGenerated {time_range:query}\r\n| where OperationName =='SMSDeliveryReportsReceived'\r\n| extend temp0 = case(NumberType <> '', NumberType, 'None')\r\n| extend NumberType = temp0\r\n| where NumberType in ({number_type})\r\n| extend temp0 = case(Country <> '', Country, 'UNKNOWN')\r\n| extend Country = temp0\r\n| where Country in ({country})\r\n| extend temp0 = case(PhoneNumber <> '', PhoneNumber, 'None')\r\n| extend PhoneNumber = temp0\r\n| where PhoneNumber in ({phone_number})\r\n| extend temp1 = case(ResultDescription in ('ErrorCode: 4005. ErrorMessage: Message is blocked by destination carrier',\r\n'ErrorCode: 4010. ErrorMessage: Message was blocked due to the toll-free number not being verified'), 'Blocked', ResultType)\r\n| extend ResultType = temp1\r\n| where ResultType == 'Blocked'\r\n| extend Description = substring(ResultDescription, 30)\r\n| summarize count_blocked = count() by Description\r\n| render piechart",
                    "size": 3,
                    "title": "Blocked SMS",
                    "exportMultipleValues": true,
                    "exportedParameters": [
                      {
                        "fieldName": "series",
                        "parameterName": "blocked",
                        "parameterType": 1
                      }
                    ],
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices"
                  },
                  "customWidth": "33",
                  "conditionalVisibilities": [
                    {
                      "parameterName": "delivery_result",
                      "comparison": "isNotEqualTo",
                      "value": "\"Failed\",\"Successfully Sent\""
                    },
                    {
                      "parameterName": "delivery_result",
                      "comparison": "isNotEqualTo",
                      "value": "\"Successfully Sent\",\"Failed\""
                    },
                    {
                      "parameterName": "delivery_result",
                      "comparison": "isNotEqualTo",
                      "value": "\"Successfully Sent\""
                    },
                    {
                      "parameterName": "delivery_result",
                      "comparison": "isNotEqualTo",
                      "value": "\"Failed\""
                    }
                  ],
                  "name": "sms-blocked"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ACSSMSIncomingOperations\r\n| where TimeGenerated {time_range:query}\r\n| where OperationName == 'SMSDeliveryReportsReceived'\r\n| where ResultType == \"Succeeded\"\r\n| extend temp0 = case(NumberType <> '', NumberType, 'None')\r\n| extend NumberType = temp0\r\n| where NumberType in ({number_type})\r\n| extend temp0 = case(Country <> '', Country, 'UNKNOWN')\r\n| extend Country = temp0\r\n| where Country in ({country})\r\n| project TenantId, MessageId, TimeGenerated, OperationName, CorrelationId, ResultType, ResultDescription, DurationMs, PhoneNumber, NumberType, Country\r\n\r\n",
                    "size": 0,
                    "title": "Successfully sent logs",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices"
                  },
                  "conditionalVisibilities": [
                    {
                      "parameterName": "delivery_result",
                      "comparison": "isNotEqualTo",
                      "value": ""
                    },
                    {
                      "parameterName": "delivery_result",
                      "comparison": "isNotEqualTo",
                      "value": "\"Failed\""
                    },
                    {
                      "parameterName": "delivery_result",
                      "comparison": "isNotEqualTo",
                      "value": "\"Blocked\""
                    },
                    {
                      "parameterName": "delivery_result",
                      "comparison": "isNotEqualTo",
                      "value": "\"Failed\",\"Blocked\""
                    },
                    {
                      "parameterName": "delivery_result",
                      "comparison": "isNotEqualTo",
                      "value": "\"Blocked\",\"Failed\""
                    }
                  ],
                  "name": "sms-success-log"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ACSSMSIncomingOperations\r\n| where TimeGenerated {time_range:query}\r\n| where OperationName == 'SMSDeliveryReportsReceived'\r\n| extend temp0 = case(NumberType <> '', NumberType, 'None')\r\n| extend NumberType = temp0\r\n| where NumberType in ({number_type})\r\n| extend temp0 = case(Country <> '', Country, 'UNKNOWN')\r\n| extend Country = temp0\r\n| where Country in ({country})\r\n| where substring(ResultDescription, 30) in({error})\r\n| project TenantId, MessageId, TimeGenerated, OperationName, CorrelationId, ResultType, ResultDescription, DurationMs, PhoneNumber, NumberType, Country\r\n\r\n",
                    "size": 0,
                    "title": "Error logs {error}",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices"
                  },
                  "conditionalVisibility": {
                    "parameterName": "error",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "sms-failed-log"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ACSSMSIncomingOperations\r\n| where TimeGenerated {time_range:query}\r\n| where OperationName =='SMSDeliveryReportsReceived'\r\n| extend temp0 = case(NumberType <> '', NumberType, 'None')\r\n| extend NumberType = temp0\r\n| where NumberType in ({number_type})\r\n| extend temp0 = case(Country <> '', Country, 'UNKNOWN')\r\n| extend Country = temp0\r\n| where Country in ({country})\r\n| extend temp1 = case(ResultDescription in ('ErrorCode: 4005. ErrorMessage: Message is blocked by destination carrier',\r\n'ErrorCode: 4010. ErrorMessage: Message was blocked due to the toll-free number not being verified'), 'Blocked', ResultType)\r\n| extend ResultType = temp1\r\n| where ResultType == 'Blocked'\r\n| extend Description = substring(ResultDescription, 30)\r\n| where (ResultType == 'Blocked' and DurationMs <32 ) or (ResultType in ('Delivered','Failed'))\r\n| where substring(ResultDescription, 30) in ({blocked})\r\n| project TenantId, MessageId, TimeGenerated, OperationName, CorrelationId, ResultType, ResultDescription, DurationMs, PhoneNumber, NumberType, Country",
                    "size": 0,
                    "title": "Blocked logs {blocked}",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices"
                  },
                  "conditionalVisibility": {
                    "parameterName": "blocked",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "sms-blocked-log "
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ACSSMSIncomingOperations\r\n| where TimeGenerated {time_range:query}\r\n| where OperationName =='SMSDeliveryReportsReceived'\r\n| extend temp0 = case(NumberType <> '', NumberType, 'None')\r\n| extend NumberType = temp0\r\n| where NumberType in ({number_type})\r\n| extend temp0 = case(Country <> '', Country, 'UNKNOWN')\r\n| extend Country = temp0\r\n| where Country in ({country})\r\n| extend temp0 = case(PhoneNumber <> '', PhoneNumber, 'None')\r\n| extend PhoneNumber = temp0\r\n| where PhoneNumber in ({phone_number})\r\n| summarize event_count=count() by Country\r\n| where Country  !in ('UNKNOWN','Unknown')\r\n| project Country , event_count\r\n| render barchart",
                    "size": 3,
                    "title": "SMS by country",
                    "noDataMessage": "No results for given time range.",
                    "exportFieldName": "series",
                    "exportParameterName": "country",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices"
                  },
                  "name": "sms-country",
                  "styleSettings": {
                    "margin": "0",
                    "padding": "0"
                  }
                }
              ]
            },
            "customWidth": "0",
            "conditionalVisibility": {
              "parameterName": "tab",
              "comparison": "isEqualTo",
              "value": "overview"
            },
            "name": "sms-overview",
            "styleSettings": {
              "margin": "0"
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ACSSMSIncomingOperations\r\n| where TimeGenerated {time_range:query}\r\n| where ResultDescription in ('OptIn', 'OptOut', 'OptHelp')\r\n| where NumberType in ({number_type})\r\n| extend temp0 = case(Country <> '', Country, 'UNKNOWN')\r\n| extend Country = temp0\r\n| where Country in ({country})\r\n| extend temp0 = case(PhoneNumber <> '', PhoneNumber, 'None')\r\n| extend PhoneNumber = temp0\r\n| where PhoneNumber in ({phone_number})\r\n| summarize Total=count() by ResultDescription\r\n| render piechart",
                    "size": 3,
                    "noDataMessage": "No Opt messages received",
                    "exportMultipleValues": true,
                    "exportedParameters": [
                      {
                        "fieldName": "series",
                        "parameterName": "opt_value"
                      }
                    ],
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices"
                  },
                  "name": "sms-opt-pie"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ACSSMSIncomingOperations\r\n| where TimeGenerated {time_range:query}\r\n| where ResultDescription in ({opt_value})\r\n| where NumberType in ({number_type})\r\n| extend temp0 = case(Country <> '', Country, 'UNKNOWN')\r\n| extend Country = temp0\r\n| where Country in ({country})\r\n| extend Direction = 'Inbound'\r\n| project OperationName = ResultDescription, TimeGenerated, Status=ResultType, PhoneNumber, Direction\r\n| render table",
                    "size": 0,
                    "title": "Logs for {opt_value}",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices"
                  },
                  "conditionalVisibilities": [
                    {
                      "parameterName": "opt_value",
                      "comparison": "isNotEqualTo"
                    },
                    {
                      "parameterName": "opt_value",
                      "comparison": "isNotEqualTo",
                      "value": "\"Received with no OptIn, OptOut or OptHelp\""
                    }
                  ],
                  "name": "sms-opt-logs"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "tab",
              "comparison": "isEqualTo",
              "value": "opt"
            },
            "name": "sms-opt"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "tab",
        "comparison": "isEqualTo",
        "value": "sms"
      },
      "name": "SMS-group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "The following visualizations represent data from the TURN logs."
            },
            "name": "auth-text"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "TURN Results",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ACSNetworkTraversalIncomingOperations\r\n| where TimeGenerated {time_range:query}\r\n| summarize count() by ResultType\r\n| render piechart",
                    "size": 0,
                    "noDataMessage": "No TURN operations found in the specified time range",
                    "exportMultipleValues": true,
                    "exportedParameters": [
                      {
                        "fieldName": "series",
                        "parameterName": "turn_result",
                        "parameterType": 1
                      }
                    ],
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices"
                  },
                  "name": "turn-result-types"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SIPCodesChat =  datatable(ResultSignature: string, SIPCode: string)\r\n[\r\n    \"0\", \"Success\",\r\n    \"100\", \"Trying\",\r\n    \"180\", \"Ringing\",\r\n    \"181\", \"Call Is Being Forwarded\",\r\n    \"182\", \"Queued\",\r\n    \"183\", \"Session Progress\",\r\n    \"199\", \"Early Dialog Terminated\",\r\n    \"200\", \"Success\",\r\n    \"202\", \"Accepted\",\r\n    \"204\", \"No Notification\",\r\n    \"300\", \"Multiple Choices\",\r\n    \"301\", \"Moved Permanently\",\r\n    \"302\", \"Moved Temporarily\",\r\n    \"305\", \"Use Proxy\",\r\n    \"380\", \"Alternative Service\",\r\n    \"400\", \"Bad Request\",\r\n    \"401\", \"Unauthorized\",\r\n    \"402\", \"Payment Required\",\r\n    \"403\", \"Forbidden\",\r\n    \"404\", \"Not Found\",\r\n    \"405\", \"Method Not Allowed\",\r\n    \"406\", \"Not Acceptable\",\r\n    \"407\", \"Proxy Authentication Required\",\r\n    \"408\", \"Request Timeout\",\r\n    \"409\", \"Conflict\",\r\n    \"410\", \"Gone\",\r\n    \"411\", \"Length Required\",\r\n    \"412\", \"Conditional Request Failed\",\r\n    \"413\", \"Request Entity Too Large\",\r\n    \"414\", \"Request-URI Too Large\",\r\n    \"415\", \"Unsupported Media Type\",\r\n    \"416\", \"Unsupported URI Scheme\",\r\n    \"417\", \"Unknown Resource-Priority\",\r\n    \"420\", \"Bad Extension\",\r\n    \"421\", \"Extension Required\",\r\n    \"422\", \"Session Interval Too Small\",\r\n    \"423\", \"Interval Too Brief\",\r\n    \"424\", \"Bad Location Information\",\r\n    \"428\", \"Use Identity Header\",\r\n    \"429\", \"Provide Referrer Identity\",\r\n    \"430\", \"Flow Failed\",\r\n    \"433\", \"Anonymity Disallowed\",\r\n    \"436\", \"Bad Identity-Info\",\r\n    \"437\", \"Unsupported Certificate\",\r\n    \"438\", \"Invalid Identity Header\",\r\n    \"439\", \"First Hop Lacks Outbound Support\",\r\n    \"440\", \"Max-Breadth Exceeded\",\r\n    \"469\", \"Bad Info Package\",\r\n    \"470\", \"Consent Needed\",\r\n    \"480\", \"Temporarily Unavailable\",\r\n    \"481\", \"Call/Transaction Does Not Exist\",\r\n    \"482\", \"Loop Detected\",\r\n    \"483\", \"Too Many Hops\",\r\n    \"484\", \"Address Incomplete\",\r\n    \"485\", \"Ambiguous\",\r\n    \"486\", \"Busy Here\",\r\n    \"487\", \"Request Terminated\",\r\n    \"488\", \"Not Acceptable Here\",\r\n    \"489\", \"Bad Event\",\r\n    \"491\", \"Request Pending\",\r\n    \"493\", \"Undecipherable\",\r\n    \"494\", \"Security Agreement Required\",\r\n    \"500\", \"Internal Server Error\",\r\n    \"501\", \"Not Implemented\",\r\n    \"502\", \"Bad Gateway\",\r\n    \"503\", \"Service Unavailable\",\r\n    \"504\", \"Server Time-out\",\r\n    \"505\", \"Version Not Supported\",\r\n    \"513\", \"Message Too Large\",\r\n    \"555\", \"Push Notification Service Not Supported\",\r\n    \"580\", \"Precondition Failure\",\r\n    \"600\", \"Busy Everywhere\",\r\n    \"603\", \"Decline\",\r\n    \"604\", \"Does Not Exist Anywhere\",\r\n    \"606\", \"Not Acceptable\",\r\n    \"607\", \"Unwanted\",\r\n    \"608\", \"Rejected\",\r\n];\r\n\r\nACSNetworkTraversalIncomingOperations \r\n| where TimeGenerated {time_range:query} and ResultType in ({turn_result})\r\n| join kind=leftouter SIPCodesChat on ResultSignature\r\n| extend OperationDate=strcat(\"ðŸ“…\", format_datetime(TimeGenerated, 'MM/dd/y'))\r\n| extend OperationTime=format_datetime(TimeGenerated, 'hh:mm:ss')\r\n| extend ResultIcon=iff(ResultType == \"Succeeded\", \"âœ”ï¸\", \"âŒ\")\r\n| extend Result=strcat(ResultIcon, \" \", ResultSignature, \": \", SIPCode)\r\n| order by TimeGenerated\r\n| project OperationName, Level, Result,  OperationDate, OperationTime, DurationMs\r\n",
                    "size": 0,
                    "title": "TURN operations with result type {turn_result}",
                    "noDataMessage": "No TURN operations found for the specified time range and result type",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Level",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Warning",
                                "representation": "warning",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "info",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "OperationDate",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "OperationTime",
                          "formatter": 5
                        }
                      ],
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "OperationDate"
                        ],
                        "expandTopLevel": true,
                        "finalBy": "OperationTime"
                      }
                    },
                    "sortBy": []
                  },
                  "conditionalVisibility": {
                    "parameterName": "turn_result",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "turn-by-result"
                }
              ]
            },
            "customWidth": "50",
            "name": "turn-results-group"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "TURN Levels",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ACSNetworkTraversalIncomingOperations\r\n| where TimeGenerated {time_range:query}\r\n| summarize count() by Level\r\n| render piechart",
                    "size": 0,
                    "noDataMessage": "No TURN operations found in the specified time range",
                    "exportMultipleValues": true,
                    "exportedParameters": [
                      {
                        "fieldName": "series",
                        "parameterName": "turn_level",
                        "parameterType": 1
                      }
                    ],
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices"
                  },
                  "name": "turn-level"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SIPCodesChat =  datatable(ResultSignature: string, SIPCode: string)\r\n[\r\n    \"0\", \"Success\",\r\n    \"100\", \"Trying\",\r\n    \"180\", \"Ringing\",\r\n    \"181\", \"Call Is Being Forwarded\",\r\n    \"182\", \"Queued\",\r\n    \"183\", \"Session Progress\",\r\n    \"199\", \"Early Dialog Terminated\",\r\n    \"200\", \"Success\",\r\n    \"202\", \"Accepted\",\r\n    \"204\", \"No Notification\",\r\n    \"300\", \"Multiple Choices\",\r\n    \"301\", \"Moved Permanently\",\r\n    \"302\", \"Moved Temporarily\",\r\n    \"305\", \"Use Proxy\",\r\n    \"380\", \"Alternative Service\",\r\n    \"400\", \"Bad Request\",\r\n    \"401\", \"Unauthorized\",\r\n    \"402\", \"Payment Required\",\r\n    \"403\", \"Forbidden\",\r\n    \"404\", \"Not Found\",\r\n    \"405\", \"Method Not Allowed\",\r\n    \"406\", \"Not Acceptable\",\r\n    \"407\", \"Proxy Authentication Required\",\r\n    \"408\", \"Request Timeout\",\r\n    \"409\", \"Conflict\",\r\n    \"410\", \"Gone\",\r\n    \"411\", \"Length Required\",\r\n    \"412\", \"Conditional Request Failed\",\r\n    \"413\", \"Request Entity Too Large\",\r\n    \"414\", \"Request-URI Too Large\",\r\n    \"415\", \"Unsupported Media Type\",\r\n    \"416\", \"Unsupported URI Scheme\",\r\n    \"417\", \"Unknown Resource-Priority\",\r\n    \"420\", \"Bad Extension\",\r\n    \"421\", \"Extension Required\",\r\n    \"422\", \"Session Interval Too Small\",\r\n    \"423\", \"Interval Too Brief\",\r\n    \"424\", \"Bad Location Information\",\r\n    \"428\", \"Use Identity Header\",\r\n    \"429\", \"Provide Referrer Identity\",\r\n    \"430\", \"Flow Failed\",\r\n    \"433\", \"Anonymity Disallowed\",\r\n    \"436\", \"Bad Identity-Info\",\r\n    \"437\", \"Unsupported Certificate\",\r\n    \"438\", \"Invalid Identity Header\",\r\n    \"439\", \"First Hop Lacks Outbound Support\",\r\n    \"440\", \"Max-Breadth Exceeded\",\r\n    \"469\", \"Bad Info Package\",\r\n    \"470\", \"Consent Needed\",\r\n    \"480\", \"Temporarily Unavailable\",\r\n    \"481\", \"Call/Transaction Does Not Exist\",\r\n    \"482\", \"Loop Detected\",\r\n    \"483\", \"Too Many Hops\",\r\n    \"484\", \"Address Incomplete\",\r\n    \"485\", \"Ambiguous\",\r\n    \"486\", \"Busy Here\",\r\n    \"487\", \"Request Terminated\",\r\n    \"488\", \"Not Acceptable Here\",\r\n    \"489\", \"Bad Event\",\r\n    \"491\", \"Request Pending\",\r\n    \"493\", \"Undecipherable\",\r\n    \"494\", \"Security Agreement Required\",\r\n    \"500\", \"Internal Server Error\",\r\n    \"501\", \"Not Implemented\",\r\n    \"502\", \"Bad Gateway\",\r\n    \"503\", \"Service Unavailable\",\r\n    \"504\", \"Server Time-out\",\r\n    \"505\", \"Version Not Supported\",\r\n    \"513\", \"Message Too Large\",\r\n    \"555\", \"Push Notification Service Not Supported\",\r\n    \"580\", \"Precondition Failure\",\r\n    \"600\", \"Busy Everywhere\",\r\n    \"603\", \"Decline\",\r\n    \"604\", \"Does Not Exist Anywhere\",\r\n    \"606\", \"Not Acceptable\",\r\n    \"607\", \"Unwanted\",\r\n    \"608\", \"Rejected\",\r\n];\r\n\r\nACSNetworkTraversalIncomingOperations\r\n| where TimeGenerated {time_range:query} and Level in ({turn_level})\r\n| join kind=leftouter SIPCodesChat on ResultSignature\r\n| extend OperationDate=strcat(\"ðŸ“…\", format_datetime(TimeGenerated, 'MM/dd/y'))\r\n| extend OperationTime=format_datetime(TimeGenerated, 'hh:mm:ss')\r\n| extend ResultIcon=iff(ResultType == \"Succeeded\", \"âœ”ï¸\", \"âŒ\")\r\n| extend Result=strcat(ResultIcon, \" \", ResultSignature, \": \", SIPCode)\r\n| order by TimeGenerated\r\n| project OperationName, Level, Result,  OperationDate, OperationTime, DurationMs",
                    "size": 0,
                    "title": "TURN with result level {turn_level}",
                    "noDataMessage": "No TURN operations found for the specified time range and result signature",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Level",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Warning",
                                "representation": "warning",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "info",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "OperationDate",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "OperationTime",
                          "formatter": 5
                        }
                      ],
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "OperationDate"
                        ],
                        "expandTopLevel": true,
                        "finalBy": "OperationTime"
                      }
                    },
                    "sortBy": []
                  },
                  "conditionalVisibility": {
                    "parameterName": "turn_level",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "turn-by-level"
                }
              ]
            },
            "customWidth": "50",
            "name": "turn-level-group"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "TURN Operation Names",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ACSNetworkTraversalIncomingOperations\r\n| where TimeGenerated {time_range:query}\r\n| summarize count() by OperationName\r\n| render piechart",
                    "size": 0,
                    "noDataMessage": "No TURN operations found in the specified time range",
                    "exportMultipleValues": true,
                    "exportedParameters": [
                      {
                        "fieldName": "series",
                        "parameterName": "turn_operation",
                        "parameterType": 1
                      }
                    ],
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices"
                  },
                  "name": "turn-operation-names"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SIPCodesChat =  datatable(ResultSignature: string, SIPCode: string)\r\n[\r\n    \"0\", \"Success\",\r\n    \"100\", \"Trying\",\r\n    \"180\", \"Ringing\",\r\n    \"181\", \"Call Is Being Forwarded\",\r\n    \"182\", \"Queued\",\r\n    \"183\", \"Session Progress\",\r\n    \"199\", \"Early Dialog Terminated\",\r\n    \"200\", \"Success\",\r\n    \"202\", \"Accepted\",\r\n    \"204\", \"No Notification\",\r\n    \"300\", \"Multiple Choices\",\r\n    \"301\", \"Moved Permanently\",\r\n    \"302\", \"Moved Temporarily\",\r\n    \"305\", \"Use Proxy\",\r\n    \"380\", \"Alternative Service\",\r\n    \"400\", \"Bad Request\",\r\n    \"401\", \"Unauthorized\",\r\n    \"402\", \"Payment Required\",\r\n    \"403\", \"Forbidden\",\r\n    \"404\", \"Not Found\",\r\n    \"405\", \"Method Not Allowed\",\r\n    \"406\", \"Not Acceptable\",\r\n    \"407\", \"Proxy Authentication Required\",\r\n    \"408\", \"Request Timeout\",\r\n    \"409\", \"Conflict\",\r\n    \"410\", \"Gone\",\r\n    \"411\", \"Length Required\",\r\n    \"412\", \"Conditional Request Failed\",\r\n    \"413\", \"Request Entity Too Large\",\r\n    \"414\", \"Request-URI Too Large\",\r\n    \"415\", \"Unsupported Media Type\",\r\n    \"416\", \"Unsupported URI Scheme\",\r\n    \"417\", \"Unknown Resource-Priority\",\r\n    \"420\", \"Bad Extension\",\r\n    \"421\", \"Extension Required\",\r\n    \"422\", \"Session Interval Too Small\",\r\n    \"423\", \"Interval Too Brief\",\r\n    \"424\", \"Bad Location Information\",\r\n    \"428\", \"Use Identity Header\",\r\n    \"429\", \"Provide Referrer Identity\",\r\n    \"430\", \"Flow Failed\",\r\n    \"433\", \"Anonymity Disallowed\",\r\n    \"436\", \"Bad Identity-Info\",\r\n    \"437\", \"Unsupported Certificate\",\r\n    \"438\", \"Invalid Identity Header\",\r\n    \"439\", \"First Hop Lacks Outbound Support\",\r\n    \"440\", \"Max-Breadth Exceeded\",\r\n    \"469\", \"Bad Info Package\",\r\n    \"470\", \"Consent Needed\",\r\n    \"480\", \"Temporarily Unavailable\",\r\n    \"481\", \"Call/Transaction Does Not Exist\",\r\n    \"482\", \"Loop Detected\",\r\n    \"483\", \"Too Many Hops\",\r\n    \"484\", \"Address Incomplete\",\r\n    \"485\", \"Ambiguous\",\r\n    \"486\", \"Busy Here\",\r\n    \"487\", \"Request Terminated\",\r\n    \"488\", \"Not Acceptable Here\",\r\n    \"489\", \"Bad Event\",\r\n    \"491\", \"Request Pending\",\r\n    \"493\", \"Undecipherable\",\r\n    \"494\", \"Security Agreement Required\",\r\n    \"500\", \"Internal Server Error\",\r\n    \"501\", \"Not Implemented\",\r\n    \"502\", \"Bad Gateway\",\r\n    \"503\", \"Service Unavailable\",\r\n    \"504\", \"Server Time-out\",\r\n    \"505\", \"Version Not Supported\",\r\n    \"513\", \"Message Too Large\",\r\n    \"555\", \"Push Notification Service Not Supported\",\r\n    \"580\", \"Precondition Failure\",\r\n    \"600\", \"Busy Everywhere\",\r\n    \"603\", \"Decline\",\r\n    \"604\", \"Does Not Exist Anywhere\",\r\n    \"606\", \"Not Acceptable\",\r\n    \"607\", \"Unwanted\",\r\n    \"608\", \"Rejected\",\r\n];\r\n\r\nACSNetworkTraversalIncomingOperations\r\n| where TimeGenerated {time_range:query} and OperationName in ({turn_operation})\r\n| join kind=leftouter SIPCodesChat on ResultSignature\r\n| extend OperationDate=strcat(\"ðŸ“…\", format_datetime(TimeGenerated, 'MM/dd/y'))\r\n| extend OperationTime=format_datetime(TimeGenerated, 'hh:mm:ss')\r\n| extend ResultIcon=iff(ResultType == \"Succeeded\", \"âœ”ï¸\", \"âŒ\")\r\n| extend Result=strcat(ResultIcon, \" \", ResultSignature, \": \", SIPCode)\r\n| order by TimeGenerated\r\n| project OperationName, Result,  Level, OperationDate, OperationTime, DurationMs",
                    "size": 0,
                    "title": "TURN operations with operation name {turn_operation}",
                    "noDataMessage": "No TURN operations found for the specified time range and operation name",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Level",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Warning",
                                "representation": "warning",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "info",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "OperationDate",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "OperationTime",
                          "formatter": 5
                        }
                      ],
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "OperationDate"
                        ],
                        "expandTopLevel": true,
                        "finalBy": "OperationTime"
                      }
                    },
                    "sortBy": []
                  },
                  "conditionalVisibility": {
                    "parameterName": "turn_operation",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "turn-by-operation"
                }
              ]
            },
            "customWidth": "50",
            "name": "Turn-operation-names-group"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "TURN Categories",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ACSNetworkTraversalIncomingOperations\r\n| where TimeGenerated {time_range:query}\r\n| summarize count() by Category\r\n| render piechart",
                    "size": 0,
                    "noDataMessage": "No TURN operations found in the specified time range",
                    "exportMultipleValues": true,
                    "exportedParameters": [
                      {
                        "fieldName": "series",
                        "parameterName": "turn_category",
                        "parameterType": 1
                      }
                    ],
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices"
                  },
                  "name": "turn-category"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SIPCodesChat =  datatable(ResultSignature: string, SIPCode: string)\r\n[\r\n    \"0\", \"Success\",\r\n    \"100\", \"Trying\",\r\n    \"180\", \"Ringing\",\r\n    \"181\", \"Call Is Being Forwarded\",\r\n    \"182\", \"Queued\",\r\n    \"183\", \"Session Progress\",\r\n    \"199\", \"Early Dialog Terminated\",\r\n    \"200\", \"Success\",\r\n    \"202\", \"Accepted\",\r\n    \"204\", \"No Notification\",\r\n    \"300\", \"Multiple Choices\",\r\n    \"301\", \"Moved Permanently\",\r\n    \"302\", \"Moved Temporarily\",\r\n    \"305\", \"Use Proxy\",\r\n    \"380\", \"Alternative Service\",\r\n    \"400\", \"Bad Request\",\r\n    \"401\", \"Unauthorized\",\r\n    \"402\", \"Payment Required\",\r\n    \"403\", \"Forbidden\",\r\n    \"404\", \"Not Found\",\r\n    \"405\", \"Method Not Allowed\",\r\n    \"406\", \"Not Acceptable\",\r\n    \"407\", \"Proxy Authentication Required\",\r\n    \"408\", \"Request Timeout\",\r\n    \"409\", \"Conflict\",\r\n    \"410\", \"Gone\",\r\n    \"411\", \"Length Required\",\r\n    \"412\", \"Conditional Request Failed\",\r\n    \"413\", \"Request Entity Too Large\",\r\n    \"414\", \"Request-URI Too Large\",\r\n    \"415\", \"Unsupported Media Type\",\r\n    \"416\", \"Unsupported URI Scheme\",\r\n    \"417\", \"Unknown Resource-Priority\",\r\n    \"420\", \"Bad Extension\",\r\n    \"421\", \"Extension Required\",\r\n    \"422\", \"Session Interval Too Small\",\r\n    \"423\", \"Interval Too Brief\",\r\n    \"424\", \"Bad Location Information\",\r\n    \"428\", \"Use Identity Header\",\r\n    \"429\", \"Provide Referrer Identity\",\r\n    \"430\", \"Flow Failed\",\r\n    \"433\", \"Anonymity Disallowed\",\r\n    \"436\", \"Bad Identity-Info\",\r\n    \"437\", \"Unsupported Certificate\",\r\n    \"438\", \"Invalid Identity Header\",\r\n    \"439\", \"First Hop Lacks Outbound Support\",\r\n    \"440\", \"Max-Breadth Exceeded\",\r\n    \"469\", \"Bad Info Package\",\r\n    \"470\", \"Consent Needed\",\r\n    \"480\", \"Temporarily Unavailable\",\r\n    \"481\", \"Call/Transaction Does Not Exist\",\r\n    \"482\", \"Loop Detected\",\r\n    \"483\", \"Too Many Hops\",\r\n    \"484\", \"Address Incomplete\",\r\n    \"485\", \"Ambiguous\",\r\n    \"486\", \"Busy Here\",\r\n    \"487\", \"Request Terminated\",\r\n    \"488\", \"Not Acceptable Here\",\r\n    \"489\", \"Bad Event\",\r\n    \"491\", \"Request Pending\",\r\n    \"493\", \"Undecipherable\",\r\n    \"494\", \"Security Agreement Required\",\r\n    \"500\", \"Internal Server Error\",\r\n    \"501\", \"Not Implemented\",\r\n    \"502\", \"Bad Gateway\",\r\n    \"503\", \"Service Unavailable\",\r\n    \"504\", \"Server Time-out\",\r\n    \"505\", \"Version Not Supported\",\r\n    \"513\", \"Message Too Large\",\r\n    \"555\", \"Push Notification Service Not Supported\",\r\n    \"580\", \"Precondition Failure\",\r\n    \"600\", \"Busy Everywhere\",\r\n    \"603\", \"Decline\",\r\n    \"604\", \"Does Not Exist Anywhere\",\r\n    \"606\", \"Not Acceptable\",\r\n    \"607\", \"Unwanted\",\r\n    \"608\", \"Rejected\",\r\n];\r\n\r\nACSNetworkTraversalIncomingOperations\r\n| where TimeGenerated {time_range:query} and Category in ({turn_category})\r\n| join kind=leftouter SIPCodesChat on ResultSignature\r\n| extend OperationDate=strcat(\"ðŸ“…\", format_datetime(TimeGenerated, 'MM/dd/y'))\r\n| extend OperationTime=format_datetime(TimeGenerated, 'hh:mm:ss')\r\n| extend ResultIcon=iff(ResultType == \"Succeeded\", \"âœ”ï¸\", \"âŒ\")\r\n| extend Result=strcat(ResultIcon, \" \", ResultSignature, \": \", SIPCode)\r\n| order by TimeGenerated\r\n| project OperationName, Result, Level, OperationDate, OperationTime, DurationMs",
                    "size": 0,
                    "title": "TURN operations with category {turn_category}",
                    "noDataMessage": "No TURN operations found for the specified time range and operation version",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Level",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Warning",
                                "representation": "warning",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "info",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "OperationDate",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "OperationTime",
                          "formatter": 5
                        }
                      ],
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "OperationDate"
                        ],
                        "expandTopLevel": true,
                        "finalBy": "OperationTime"
                      }
                    },
                    "sortBy": []
                  },
                  "conditionalVisibility": {
                    "parameterName": "turn_category",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "turn-by-category"
                }
              ]
            },
            "customWidth": "50",
            "name": "turn-category-group"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Identity drill-down",
              "items": [
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "0c0b56fd-ffd9-4761-b14e-c916660f9ccc",
                        "version": "KqlParameterItem/1.0",
                        "name": "turn_identity",
                        "label": "Identity",
                        "type": 2,
                        "description": "Choose an identity to visualize",
                        "query": "ACSNetworkTraversalIncomingOperations\r\n| where TimeGenerated {time_range:query}\r\n| order by TimeGenerated\r\n| distinct Identity\r\n| where isnotempty(Identity)",
                        "value": null,
                        "typeSettings": {
                          "additionalResourceOptions": [],
                          "showDefault": false
                        },
                        "queryType": 0,
                        "resourceType": "microsoft.communication/communicationservices"
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices"
                  },
                  "name": "turn-identity-parameters"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "**Select an identity from the drop-down menu to display its associated data**",
                    "style": "info"
                  },
                  "conditionalVisibility": {
                    "parameterName": "identity",
                    "comparison": "isEqualTo"
                  },
                  "name": "identity-drilldown-info"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SIPCodesChat =  datatable(ResultSignature: string, SIPCode: string)\r\n[\r\n    \"0\", \"Success\",\r\n    \"100\", \"Trying\",\r\n    \"180\", \"Ringing\",\r\n    \"181\", \"Call Is Being Forwarded\",\r\n    \"182\", \"Queued\",\r\n    \"183\", \"Session Progress\",\r\n    \"199\", \"Early Dialog Terminated\",\r\n    \"200\", \"Success\",\r\n    \"202\", \"Accepted\",\r\n    \"204\", \"No Notification\",\r\n    \"300\", \"Multiple Choices\",\r\n    \"301\", \"Moved Permanently\",\r\n    \"302\", \"Moved Temporarily\",\r\n    \"305\", \"Use Proxy\",\r\n    \"380\", \"Alternative Service\",\r\n    \"400\", \"Bad Request\",\r\n    \"401\", \"Unauthorized\",\r\n    \"402\", \"Payment Required\",\r\n    \"403\", \"Forbidden\",\r\n    \"404\", \"Not Found\",\r\n    \"405\", \"Method Not Allowed\",\r\n    \"406\", \"Not Acceptable\",\r\n    \"407\", \"Proxy Authentication Required\",\r\n    \"408\", \"Request Timeout\",\r\n    \"409\", \"Conflict\",\r\n    \"410\", \"Gone\",\r\n    \"411\", \"Length Required\",\r\n    \"412\", \"Conditional Request Failed\",\r\n    \"413\", \"Request Entity Too Large\",\r\n    \"414\", \"Request-URI Too Large\",\r\n    \"415\", \"Unsupported Media Type\",\r\n    \"416\", \"Unsupported URI Scheme\",\r\n    \"417\", \"Unknown Resource-Priority\",\r\n    \"420\", \"Bad Extension\",\r\n    \"421\", \"Extension Required\",\r\n    \"422\", \"Session Interval Too Small\",\r\n    \"423\", \"Interval Too Brief\",\r\n    \"424\", \"Bad Location Information\",\r\n    \"428\", \"Use Identity Header\",\r\n    \"429\", \"Provide Referrer Identity\",\r\n    \"430\", \"Flow Failed\",\r\n    \"433\", \"Anonymity Disallowed\",\r\n    \"436\", \"Bad Identity-Info\",\r\n    \"437\", \"Unsupported Certificate\",\r\n    \"438\", \"Invalid Identity Header\",\r\n    \"439\", \"First Hop Lacks Outbound Support\",\r\n    \"440\", \"Max-Breadth Exceeded\",\r\n    \"469\", \"Bad Info Package\",\r\n    \"470\", \"Consent Needed\",\r\n    \"480\", \"Temporarily Unavailable\",\r\n    \"481\", \"Call/Transaction Does Not Exist\",\r\n    \"482\", \"Loop Detected\",\r\n    \"483\", \"Too Many Hops\",\r\n    \"484\", \"Address Incomplete\",\r\n    \"485\", \"Ambiguous\",\r\n    \"486\", \"Busy Here\",\r\n    \"487\", \"Request Terminated\",\r\n    \"488\", \"Not Acceptable Here\",\r\n    \"489\", \"Bad Event\",\r\n    \"491\", \"Request Pending\",\r\n    \"493\", \"Undecipherable\",\r\n    \"494\", \"Security Agreement Required\",\r\n    \"500\", \"Internal Server Error\",\r\n    \"501\", \"Not Implemented\",\r\n    \"502\", \"Bad Gateway\",\r\n    \"503\", \"Service Unavailable\",\r\n    \"504\", \"Server Time-out\",\r\n    \"505\", \"Version Not Supported\",\r\n    \"513\", \"Message Too Large\",\r\n    \"555\", \"Push Notification Service Not Supported\",\r\n    \"580\", \"Precondition Failure\",\r\n    \"600\", \"Busy Everywhere\",\r\n    \"603\", \"Decline\",\r\n    \"604\", \"Does Not Exist Anywhere\",\r\n    \"606\", \"Not Acceptable\",\r\n    \"607\", \"Unwanted\",\r\n    \"608\", \"Rejected\",\r\n];\r\n\r\nACSNetworkTraversalIncomingOperations\r\n| where TimeGenerated {time_range:query} and Identity == \"{turn_identity}\"\r\n| join kind=leftouter SIPCodesChat on ResultSignature\r\n| extend OperationDate=strcat(\"ðŸ“…\", format_datetime(TimeGenerated, 'MM/dd/y'))\r\n| extend OperationTime=format_datetime(TimeGenerated, 'hh:mm:ss')\r\n| extend ResultIcon=iff(ResultType == \"Succeeded\", \"âœ”ï¸\", \"âŒ\")\r\n| extend Result=strcat(ResultIcon, \" \", ResultSignature, \": \", SIPCode)\r\n| order by TimeGenerated\r\n| project OperationName, Level, Result, OperationDate, OperationTime, DurationMs\r\n",
                    "size": 0,
                    "title": "TURN operations for identity {turn_identity}",
                    "noDataMessage": "No TURN operations found for the specified  time range and identity",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Level",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Warning",
                                "representation": "warning",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "info",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "OperationDate",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "OperationTime",
                          "formatter": 5
                        }
                      ],
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "OperationDate"
                        ],
                        "expandTopLevel": true,
                        "finalBy": "OperationTime"
                      }
                    },
                    "sortBy": []
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "turn_identity",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "turn-identity-details"
                }
              ]
            },
            "name": "turn-identity-drill-down-group"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Route Type drill-down",
              "items": [
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "0c0b56fd-ffd9-4761-b14e-c916660f9ccc",
                        "version": "KqlParameterItem/1.0",
                        "name": "turn_route_type",
                        "label": "Route Type",
                        "type": 2,
                        "description": "Choose a chat meeting ID to visualize",
                        "query": "ACSNetworkTraversalIncomingOperations \r\n| where TimeGenerated {time_range:query}\r\n| order by TimeGenerated\r\n| distinct RouteType\r\n| where isnotempty(RouteType)",
                        "value": null,
                        "typeSettings": {
                          "additionalResourceOptions": [],
                          "showDefault": false
                        },
                        "queryType": 0,
                        "resourceType": "microsoft.communication/communicationservices"
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices"
                  },
                  "name": "turn-route-parameters"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "**Select a Route Type from the drop-down menu to display its associated data**",
                    "style": "info"
                  },
                  "conditionalVisibility": {
                    "parameterName": "turn_route_type",
                    "comparison": "isEqualTo"
                  },
                  "name": "turn-route-type-drilldown-info"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SIPCodesChat =  datatable(ResultSignature: string, SIPCode: string)\r\n[\r\n    \"0\", \"Success\",\r\n    \"100\", \"Trying\",\r\n    \"180\", \"Ringing\",\r\n    \"181\", \"Call Is Being Forwarded\",\r\n    \"182\", \"Queued\",\r\n    \"183\", \"Session Progress\",\r\n    \"199\", \"Early Dialog Terminated\",\r\n    \"200\", \"Success\",\r\n    \"202\", \"Accepted\",\r\n    \"204\", \"No Notification\",\r\n    \"300\", \"Multiple Choices\",\r\n    \"301\", \"Moved Permanently\",\r\n    \"302\", \"Moved Temporarily\",\r\n    \"305\", \"Use Proxy\",\r\n    \"380\", \"Alternative Service\",\r\n    \"400\", \"Bad Request\",\r\n    \"401\", \"Unauthorized\",\r\n    \"402\", \"Payment Required\",\r\n    \"403\", \"Forbidden\",\r\n    \"404\", \"Not Found\",\r\n    \"405\", \"Method Not Allowed\",\r\n    \"406\", \"Not Acceptable\",\r\n    \"407\", \"Proxy Authentication Required\",\r\n    \"408\", \"Request Timeout\",\r\n    \"409\", \"Conflict\",\r\n    \"410\", \"Gone\",\r\n    \"411\", \"Length Required\",\r\n    \"412\", \"Conditional Request Failed\",\r\n    \"413\", \"Request Entity Too Large\",\r\n    \"414\", \"Request-URI Too Large\",\r\n    \"415\", \"Unsupported Media Type\",\r\n    \"416\", \"Unsupported URI Scheme\",\r\n    \"417\", \"Unknown Resource-Priority\",\r\n    \"420\", \"Bad Extension\",\r\n    \"421\", \"Extension Required\",\r\n    \"422\", \"Session Interval Too Small\",\r\n    \"423\", \"Interval Too Brief\",\r\n    \"424\", \"Bad Location Information\",\r\n    \"428\", \"Use Identity Header\",\r\n    \"429\", \"Provide Referrer Identity\",\r\n    \"430\", \"Flow Failed\",\r\n    \"433\", \"Anonymity Disallowed\",\r\n    \"436\", \"Bad Identity-Info\",\r\n    \"437\", \"Unsupported Certificate\",\r\n    \"438\", \"Invalid Identity Header\",\r\n    \"439\", \"First Hop Lacks Outbound Support\",\r\n    \"440\", \"Max-Breadth Exceeded\",\r\n    \"469\", \"Bad Info Package\",\r\n    \"470\", \"Consent Needed\",\r\n    \"480\", \"Temporarily Unavailable\",\r\n    \"481\", \"Call/Transaction Does Not Exist\",\r\n    \"482\", \"Loop Detected\",\r\n    \"483\", \"Too Many Hops\",\r\n    \"484\", \"Address Incomplete\",\r\n    \"485\", \"Ambiguous\",\r\n    \"486\", \"Busy Here\",\r\n    \"487\", \"Request Terminated\",\r\n    \"488\", \"Not Acceptable Here\",\r\n    \"489\", \"Bad Event\",\r\n    \"491\", \"Request Pending\",\r\n    \"493\", \"Undecipherable\",\r\n    \"494\", \"Security Agreement Required\",\r\n    \"500\", \"Internal Server Error\",\r\n    \"501\", \"Not Implemented\",\r\n    \"502\", \"Bad Gateway\",\r\n    \"503\", \"Service Unavailable\",\r\n    \"504\", \"Server Time-out\",\r\n    \"505\", \"Version Not Supported\",\r\n    \"513\", \"Message Too Large\",\r\n    \"555\", \"Push Notification Service Not Supported\",\r\n    \"580\", \"Precondition Failure\",\r\n    \"600\", \"Busy Everywhere\",\r\n    \"603\", \"Decline\",\r\n    \"604\", \"Does Not Exist Anywhere\",\r\n    \"606\", \"Not Acceptable\",\r\n    \"607\", \"Unwanted\",\r\n    \"608\", \"Rejected\",\r\n];\r\n\r\nACSNetworkTraversalIncomingOperations \r\n| where TimeGenerated {time_range:query} and RouteType == \"{turn_route_type}\"\r\n| join kind=leftouter SIPCodesChat on ResultSignature\r\n| extend OperationDate=strcat(\"ðŸ“…\", format_datetime(TimeGenerated, 'MM/dd/y'))\r\n| extend OperationTime=format_datetime(TimeGenerated, 'hh:mm:ss')\r\n| extend ResultIcon=iff(ResultType == \"Succeeded\", \"âœ”ï¸\", \"âŒ\")\r\n| extend Result=strcat(ResultIcon, \" \", ResultSignature, \": \", SIPCode)\r\n| order by TimeGenerated\r\n| project OperationName, Level, Result, OperationDate, OperationTime, DurationMs\r\n",
                    "size": 0,
                    "title": "TURN operations for Route Type {turn_route_type}",
                    "noDataMessage": "No TURN operations found for the specified time range and meeting ID",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Level",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Warning",
                                "representation": "warning",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "info",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "OperationDate",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "OperationTime",
                          "formatter": 5
                        }
                      ],
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "OperationDate"
                        ],
                        "expandTopLevel": true,
                        "finalBy": "OperationTime"
                      }
                    },
                    "sortBy": []
                  },
                  "conditionalVisibility": {
                    "parameterName": "turn_route_type",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "turn-route-type-details"
                }
              ]
            },
            "name": "Route-type-drill-down-group"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "tab",
        "comparison": "isEqualTo",
        "value": "turn"
      },
      "name": "Turn-group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "tabs",
              "links": [
                {
                  "id": "8e2d5862-e7d0-4238-9b61-b1e2b7a0b541",
                  "cellValue": "tab",
                  "linkTarget": "parameter",
                  "linkLabel": "Email Overview",
                  "subTarget": "overview",
                  "style": "link",
                  "linkIsContextBlade": true
                },
                {
                  "id": "7667d622-e3a3-46f9-98b4-ecd7f4deee3d",
                  "cellValue": "tab",
                  "linkTarget": "parameter",
                  "linkLabel": "Email Performance",
                  "subTarget": "performance",
                  "style": "link"
                }
              ]
            },
            "name": "email_workbook_tabs"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "36134be5-8638-4f33-8fcc-0432d0b9cf63",
                  "version": "KqlParameterItem/1.0",
                  "name": "email_mailfrom",
                  "label": "Mail From Address",
                  "type": 2,
                  "isRequired": true,
                  "query": "let empty_sender = datatable(sender:string)[\"All senders\"];\r\nACSEmailStatusUpdateOperational \r\n| where OperationName == \"DeliveryStatusUpdate\" and isnotempty(DeliveryStatus)and isnotempty(RecipientId) and DeliveryStatus != \"OutForDelivery\" \r\n| summarize by sender=strcat(SenderUsername, '@', SenderDomain)\r\n| union (empty_sender | project tostring(sender))\r\n| extend sender_display = sender\r\n| extend IsSelected = (sender == \"All senders\")",
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "queryType": 0,
                  "resourceType": "microsoft.communication/communicationservices"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.communication/communicationservices"
            },
            "name": "email_workbook_parameters"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "ACSEmailStatusUpdateOperational \r\n| where OperationName == \"DeliveryStatusUpdate\" and isnotempty(DeliveryStatus) and DeliveryStatus != \"OutForDelivery\"\r\n| where ('{email_mailfrom:value}' == \"All senders\") or (strcat(SenderUsername, '@', SenderDomain) == '{email_mailfrom:value}')\r\n| summarize total=count(), successes=countif(DeliveryStatus == \"Delivered\")\r\n| extend rate=round(((successes * 100.0)/total),2)\r\n| extend label=\"Emails successfully delivered\", TotalMessage=strcat('out of ', total, ', ', rate,'% total Emails sent')",
              "size": 4,
              "timeContextFromParameter": "time_range",
              "queryType": 0,
              "resourceType": "microsoft.communication/communicationservices",
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "label",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "successes",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "none"
                  }
                },
                "secondaryContent": {
                  "columnMatch": "TotalMessage",
                  "formatter": 1
                },
                "showBorder": true,
                "size": "full"
              }
            },
            "customWidth": "50",
            "conditionalVisibility": {
              "parameterName": "tab",
              "comparison": "isEqualTo",
              "value": "performance"
            },
            "name": "email_performance_tile_success"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "ACSEmailStatusUpdateOperational \r\n| where OperationName == \"DeliveryStatusUpdate\" and isnotempty(DeliveryStatus) and DeliveryStatus != \"OutForDelivery\"\r\n| where ('{email_mailfrom:value}' == \"All senders\") or (strcat(SenderUsername, '@', SenderDomain) == '{email_mailfrom:value}')\r\n| summarize total=count(), failures=countif(DeliveryStatus != \"Delivered\")\r\n| extend rate=round(((failures * 100.0)/total),2)\r\n| extend label=\"Emails failed\", TotalMessage=strcat('out of ', total, ', ', rate,'% total Emails sent')",
              "size": 4,
              "timeContextFromParameter": "time_range",
              "queryType": 0,
              "resourceType": "microsoft.communication/communicationservices",
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "label",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "failures",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "none"
                  }
                },
                "secondaryContent": {
                  "columnMatch": "TotalMessage",
                  "formatter": 1
                },
                "showBorder": true,
                "size": "full"
              }
            },
            "customWidth": "50",
            "conditionalVisibility": {
              "parameterName": "tab",
              "comparison": "isEqualTo",
              "value": "performance"
            },
            "name": "email_performance_tile_failed"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "ACSEmailStatusUpdateOperational\r\n| where OperationName == \"DeliveryStatusUpdate\" and isnotempty(DeliveryStatus) and DeliveryStatus != \"OutForDelivery\"\r\n| where ('{email_mailfrom:value}' == \"All senders\") or (strcat(SenderUsername, '@', SenderDomain) == '{email_mailfrom:value}')\r\n| summarize total=count(), successes=countif(DeliveryStatus == \"Delivered\")\r\n| extend rate=round(((successes * 100.0)/total),2)\r\n| extend label=\"Emails successfully delivered\", TotalMessage=strcat('out of ', total, ', ', rate,'% total Emails sent')",
              "size": 4,
              "timeContextFromParameter": "time_range",
              "queryType": 0,
              "resourceType": "microsoft.communication/communicationservices",
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "label",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "successes",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "none"
                  }
                },
                "secondaryContent": {
                  "columnMatch": "TotalMessage",
                  "formatter": 1
                },
                "showBorder": true,
                "size": "full"
              }
            },
            "customWidth": "33.3",
            "conditionalVisibility": {
              "parameterName": "tab",
              "comparison": "isEqualTo",
              "value": "overview"
            },
            "name": "email_overview_tile_success",
            "styleSettings": {
              "margin": "4px"
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "ACSEmailStatusUpdateOperational \r\n| where OperationName == \"DeliveryStatusUpdate\" and isnotempty(DeliveryStatus) and DeliveryStatus != \"OutForDelivery\"\r\n| where ('{email_mailfrom:value}' == \"All senders\") or (strcat(SenderUsername, '@', SenderDomain) == '{email_mailfrom:value}')\r\n| summarize total=count(), failures=countif(DeliveryStatus != \"Delivered\" and DeliveryStatus != \"Suppressed\")\r\n| extend rate=round(((failures * 100.0)/total),2)\r\n| extend label=\"Emails failed\", TotalMessage=strcat('out of ', total, ', ', rate,'% total Emails sent')",
              "size": 4,
              "timeContextFromParameter": "time_range",
              "queryType": 0,
              "resourceType": "microsoft.communication/communicationservices",
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "label",
                  "formatter": 1,
                  "tooltipFormat": {
                    "tooltip": "Failed count represents the number of emails that didnâ€™t get delivered to the recipient for various reasons"
                  }
                },
                "leftContent": {
                  "columnMatch": "failures",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "none"
                  }
                },
                "secondaryContent": {
                  "columnMatch": "TotalMessage",
                  "formatter": 1,
                  "tooltipFormat": {
                    "tooltip": "Failed count represents the number of emails that didnâ€™t get delivered to the recipient for various reasons"
                  }
                },
                "showBorder": true,
                "size": "full"
              }
            },
            "customWidth": "33.3",
            "conditionalVisibility": {
              "parameterName": "tab",
              "comparison": "isEqualTo",
              "value": "overview"
            },
            "name": "email_overview_tile_failed",
            "styleSettings": {
              "margin": "4px"
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let totalcount = toscalar(ACSEmailStatusUpdateOperational \r\n| where ('{email_mailfrom:value}' == \"All senders\") or (strcat(SenderUsername, '@', SenderDomain) == '{email_mailfrom:value}')\r\n| where OperationName == \"DeliveryStatusUpdate\" and isnotempty(DeliveryStatus) and DeliveryStatus != \"OutForDelivery\"| summarize value=count());\r\nlet failed = ACSEmailStatusUpdateOperational \r\n| where OperationName == \"DeliveryStatusUpdate\" and isnotempty(DeliveryStatus) and DeliveryStatus != \"OutForDelivery\"\r\n| where ('{email_mailfrom:value}' == \"All senders\") or (strcat(SenderUsername, '@', SenderDomain) == '{email_mailfrom:value}')\r\n| where DeliveryStatus != \"Delivered\" | summarize value=count() | extend label=\"Emails failed\", TotalMessage=strcat('out of ', totalcount, ' total Emails sent'), icon='error';\r\nlet suppressed = ACSEmailStatusUpdateOperational \r\n| where OperationName == \"DeliveryStatusUpdate\" and isnotempty(DeliveryStatus) and DeliveryStatus != \"OutForDelivery\"\r\n| where ('{email_mailfrom:value}' == \"All senders\") or (strcat(SenderUsername, '@', SenderDomain) == '{email_mailfrom:value}')\r\n| where DeliveryStatus == \"Suppressed\"    | summarize value=count() | extend label=\"Suppressed\", TotalMessage=strcat('out of ', totalcount, ' total Emails sent'), icon='none';\r\nsuppressed",
              "size": 4,
              "timeContextFromParameter": "time_range",
              "queryType": 0,
              "resourceType": "microsoft.communication/communicationservices",
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "label",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "value",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "none",
                    "compositeBarSettings": {
                      "labelText": "",
                      "columnSettings": [
                        {
                          "columnName": "icon",
                          "color": "blue"
                        },
                        {
                          "columnName": "label",
                          "color": "blue"
                        }
                      ]
                    }
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 3,
                      "maximumSignificantDigits": 6
                    }
                  },
                  "tooltipFormat": {
                    "tooltip": "Suppressed count represents the number of recipients who expressed interest and agreed to receive email messages from you but has no valid mailbox with that address anymore or opt-out of receiving emails from you."
                  }
                },
                "secondaryContent": {
                  "columnMatch": "TotalMessage",
                  "formatter": 1
                },
                "showBorder": true,
                "size": "full"
              }
            },
            "customWidth": "33.3",
            "conditionalVisibility": {
              "parameterName": "tab",
              "comparison": "isEqualTo",
              "value": "overview"
            },
            "name": "email_overview_tile_suppressed",
            "styleSettings": {
              "margin": "4px"
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let all = ACSEmailStatusUpdateOperational \r\n| where OperationName == \"DeliveryStatusUpdate\" and isnotempty(DeliveryStatus) and DeliveryStatus != \"OutForDelivery\"\r\n| where ('{email_mailfrom:value}' == \"All senders\") or (strcat(SenderUsername, '@', SenderDomain) == '{email_mailfrom:value}')\r\n| project DeliveryStatus, ts=bin(TimeGenerated, iif(\"{time_granularity:label}\" == \"<unset>\", 4h, totimespan(\"{time_granularity:value}\")));\r\nall | summarize \r\n        total=count(),\r\n        success=countif(DeliveryStatus == \"Delivered\"),\r\n        failures=countif(DeliveryStatus != \"Delivered\")\r\n        by ts",
              "size": 0,
              "timeContextFromParameter": "time_range",
              "queryType": 0,
              "resourceType": "microsoft.communication/communicationservices",
              "visualization": "linechart",
              "chartSettings": {
                "xAxis": "ts",
                "yAxis": [
                  "failures",
                  "success",
                  "total"
                ],
                "showLegend": true,
                "seriesLabelSettings": [
                  {
                    "seriesName": "total",
                    "label": "Total emails sent",
                    "color": "magenta"
                  },
                  {
                    "seriesName": "success",
                    "label": "Successfully delivered emails",
                    "color": "greenDark"
                  },
                  {
                    "seriesName": "failures",
                    "label": "Failed emails",
                    "color": "orange"
                  }
                ],
                "showDataPoints": true,
                "ySettings": {
                  "numberFormatSettings": {
                    "unit": 0,
                    "options": {
                      "style": "decimal",
                      "useGrouping": true,
                      "minimumSignificantDigits": 1,
                      "maximumSignificantDigits": 21
                    }
                  }
                }
              }
            },
            "conditionalVisibility": {
              "parameterName": "tab",
              "comparison": "isEqualTo",
              "value": "overview"
            },
            "name": "email_overview_linechart_rates",
            "styleSettings": {
              "padding": "0"
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "ACSEmailStatusUpdateOperational \r\n| where DeliveryStatus == \"Quarantined\"\r\n| where ('{email_mailfrom:value}' == \"All senders\") or (strcat(SenderUsername, '@', SenderDomain) == '{email_mailfrom:value}')\r\n| summarize value=count() | extend label=\"Emails quarantined\"\r\n",
              "size": 4,
              "timeContextFromParameter": "time_range",
              "queryType": 0,
              "resourceType": "microsoft.communication/communicationservices",
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "label",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "value",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "none",
                    "compositeBarSettings": {
                      "labelText": "",
                      "columnSettings": [
                        {
                          "columnName": "icon",
                          "color": "blue"
                        },
                        {
                          "columnName": "label",
                          "color": "blue"
                        }
                      ]
                    }
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 3,
                      "maximumSignificantDigits": 6
                    }
                  }
                },
                "secondaryContent": {
                  "columnMatch": "TotalMessage",
                  "formatter": 1
                },
                "showBorder": true,
                "size": "full"
              }
            },
            "customWidth": "25",
            "conditionalVisibility": {
              "parameterName": "tab",
              "comparison": "isEqualTo",
              "value": "overview"
            },
            "name": "email_overview_tile_quarantined"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "ACSEmailStatusUpdateOperational \r\n| where ('{email_mailfrom:value}' == \"All senders\") or (strcat(SenderUsername, '@', SenderDomain) == '{email_mailfrom:value}')\r\n| where OperationName == \"DeliveryStatusUpdate\" and isnotempty(DeliveryStatus) and DeliveryStatus == \"Failed\" and IsHardBounce == true\r\n| summarize value=count() | extend label=\"Emails bounced\"\r\n",
              "size": 4,
              "timeContextFromParameter": "time_range",
              "queryType": 0,
              "resourceType": "microsoft.communication/communicationservices",
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "label",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "value",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "none",
                    "compositeBarSettings": {
                      "labelText": "",
                      "columnSettings": [
                        {
                          "columnName": "icon",
                          "color": "blue"
                        },
                        {
                          "columnName": "label",
                          "color": "blue"
                        }
                      ]
                    }
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 3,
                      "maximumSignificantDigits": 6
                    }
                  }
                },
                "secondaryContent": {
                  "columnMatch": "TotalMessage",
                  "formatter": 1
                },
                "showBorder": true,
                "size": "full"
              }
            },
            "customWidth": "25",
            "conditionalVisibility": {
              "parameterName": "tab",
              "comparison": "isEqualTo",
              "value": "overview"
            },
            "name": "email_overview_tile_bounced"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "ACSEmailUserEngagementOperational\r\n| where EngagementType == \"View\"\r\n| summarize value=count() | extend label=\"Emails viewed\"\r\n",
              "size": 4,
              "timeContextFromParameter": "time_range",
              "queryType": 0,
              "resourceType": "microsoft.communication/communicationservices",
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "label",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "value",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "none",
                    "compositeBarSettings": {
                      "labelText": "",
                      "columnSettings": [
                        {
                          "columnName": "icon",
                          "color": "blue"
                        },
                        {
                          "columnName": "label",
                          "color": "blue"
                        }
                      ]
                    }
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 3,
                      "maximumSignificantDigits": 6
                    }
                  }
                },
                "secondaryContent": {
                  "columnMatch": "TotalMessage",
                  "formatter": 1
                },
                "showBorder": true,
                "size": "full"
              }
            },
            "customWidth": "25",
            "conditionalVisibility": {
              "parameterName": "tab",
              "comparison": "isEqualTo",
              "value": "overview"
            },
            "name": "email_overview_tile_viewed"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "ACSEmailUserEngagementOperational\r\n| where EngagementType == \"Click\"\r\n| summarize value=count() | extend label=\"Emails clicled\"\r\n",
              "size": 4,
              "timeContextFromParameter": "time_range",
              "queryType": 0,
              "resourceType": "microsoft.communication/communicationservices",
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "label",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "value",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "none",
                    "compositeBarSettings": {
                      "labelText": "",
                      "columnSettings": [
                        {
                          "columnName": "icon",
                          "color": "blue"
                        },
                        {
                          "columnName": "label",
                          "color": "blue"
                        }
                      ]
                    }
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 3,
                      "maximumSignificantDigits": 6
                    }
                  }
                },
                "secondaryContent": {
                  "columnMatch": "TotalMessage",
                  "formatter": 1
                },
                "showBorder": true,
                "size": "full"
              }
            },
            "customWidth": "25",
            "conditionalVisibility": {
              "parameterName": "tab",
              "comparison": "isEqualTo",
              "value": "overview"
            },
            "name": "email_overview_tile_clicked"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "ACSEmailStatusUpdateOperational \r\n| where OperationName == \"DeliveryStatusUpdate\" and isnotempty(DeliveryStatus) and DeliveryStatus != \"OutForDelivery\"\r\n| where ('{email_mailfrom:value}' == \"All senders\") or (strcat(SenderUsername, '@', SenderDomain) == '{email_mailfrom:value}')\r\n| extend ts=bin(TimeGenerated, iif(\"{time_granularity:label}\" == \"<unset>\", 4h, totimespan(\"{time_granularity:value}\")))\r\n| summarize successRate=((countif(DeliveryStatus == \"Delivered\") * 100.0)/count()) by ts;",
              "size": 1,
              "aggregation": 3,
              "title": "Delivery Success Rate",
              "timeContextFromParameter": "time_range",
              "queryType": 0,
              "resourceType": "microsoft.communication/communicationservices",
              "visualization": "linechart",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "label",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "icon",
                  "formatter": 11,
                  "formatOptions": {
                    "compositeBarSettings": {
                      "labelText": "",
                      "columnSettings": [
                        {
                          "columnName": "icon",
                          "color": "blue"
                        },
                        {
                          "columnName": "TotalMessage",
                          "color": "blue"
                        },
                        {
                          "columnName": "value",
                          "color": "blue"
                        }
                      ]
                    }
                  },
                  "numberFormat": {
                    "unit": 0,
                    "options": {
                      "style": "decimal"
                    }
                  },
                  "tooltipFormat": {
                    "tooltip": "This is a tooltip."
                  }
                },
                "rightContent": {
                  "columnMatch": "value",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "blue"
                  }
                },
                "secondaryContent": {
                  "columnMatch": "TotalMessage",
                  "formatter": 1
                },
                "showBorder": true,
                "size": "full"
              },
              "chartSettings": {
                "xAxis": "ts",
                "yAxis": [
                  "successRate"
                ],
                "seriesLabelSettings": [
                  {
                    "seriesName": "successRate",
                    "label": "Success Rate",
                    "color": "blue"
                  }
                ],
                "ySettings": {
                  "max": 100
                }
              }
            },
            "customWidth": "100",
            "conditionalVisibility": {
              "parameterName": "tab",
              "comparison": "isEqualTo",
              "value": "performance"
            },
            "name": "email_performance_linechart_successrate",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let cvids = ACSEmailStatusUpdateOperational\r\n| where OperationName == \"DeliveryStatusUpdate\" and isnotempty(DeliveryStatus) and DeliveryStatus != \"OutForDelivery\"\r\n| where ('{email_mailfrom:value}' == \"All senders\") or (strcat(SenderUsername, '@', SenderDomain) == '{email_mailfrom:value}')\r\n| summarize by CorrelationId;\r\nACSEmailSendMailOperational\r\n| join cvids on CorrelationId\r\n| extend sizeForAllRecipients=(Size * UniqueRecipientsCount)\r\n| summarize sizeForAllRecipients=sum(sizeForAllRecipients) by bin(TimeGenerated, iif(\"{time_granularity:label}\" == \"<unset>\", 4h, totimespan(\"{time_granularity:value}\")))",
              "size": 0,
              "title": "Total Size For Emails Sent",
              "timeContextFromParameter": "time_range",
              "queryType": 0,
              "resourceType": "microsoft.communication/communicationservices",
              "visualization": "barchart",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "label",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "value",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "none",
                    "compositeBarSettings": {
                      "labelText": "",
                      "columnSettings": [
                        {
                          "columnName": "icon",
                          "color": "blue"
                        },
                        {
                          "columnName": "label",
                          "color": "blue"
                        }
                      ]
                    }
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 3,
                      "maximumSignificantDigits": 6
                    }
                  }
                },
                "secondaryContent": {
                  "columnMatch": "TotalMessage",
                  "formatter": 1
                },
                "showBorder": true,
                "size": "full"
              },
              "chartSettings": {
                "seriesLabelSettings": [
                  {
                    "seriesName": "sizeForAllRecipients",
                    "label": "Size Per Email Sent",
                    "color": "grayBlue"
                  }
                ]
              }
            },
            "customWidth": "50",
            "conditionalVisibility": {
              "parameterName": "tab",
              "comparison": "isEqualTo",
              "value": "overview"
            },
            "name": "email_overview_barchart_size",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let cvids = ACSEmailStatusUpdateOperational\r\n| where OperationName == \"DeliveryStatusUpdate\" and isnotempty(DeliveryStatus) and DeliveryStatus != \"OutForDelivery\"\r\n| where ('{email_mailfrom:value}' == \"All senders\") or (strcat(SenderUsername, '@', SenderDomain) == '{email_mailfrom:value}')\r\n| summarize by CorrelationId;\r\nACSEmailSendMailOperational\r\n| join cvids on CorrelationId\r\n| extend sizeForAllRecipients=(Size * UniqueRecipientsCount)\r\n| summarize totalMessages=dcount(CorrelationId) by bin(TimeGenerated, iif(\"{time_granularity:label}\" == \"<unset>\", 4h, totimespan(\"{time_granularity:value}\")))",
              "size": 0,
              "title": "Total Emails Sent",
              "timeContextFromParameter": "time_range",
              "queryType": 0,
              "resourceType": "microsoft.communication/communicationservices",
              "visualization": "barchart",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "label",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "value",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "none",
                    "compositeBarSettings": {
                      "labelText": "",
                      "columnSettings": [
                        {
                          "columnName": "icon",
                          "color": "blue"
                        },
                        {
                          "columnName": "label",
                          "color": "blue"
                        }
                      ]
                    }
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 3,
                      "maximumSignificantDigits": 6
                    }
                  }
                },
                "secondaryContent": {
                  "columnMatch": "TotalMessage",
                  "formatter": 1
                },
                "showBorder": true,
                "size": "full"
              },
              "chartSettings": {
                "seriesLabelSettings": [
                  {
                    "seriesName": "totalMessages",
                    "label": "Total Emails",
                    "color": "grayBlue",
                    "comment": "Thisis a comment"
                  }
                ]
              }
            },
            "customWidth": "50",
            "conditionalVisibility": {
              "parameterName": "tab",
              "comparison": "isEqualTo",
              "value": "overview"
            },
            "name": "email_overview_barchart_totalemails",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": " ACSEmailStatusUpdateOperational \r\n| where OperationName == \"DeliveryStatusUpdate\" and isnotempty(DeliveryStatus) and DeliveryStatus != \"OutForDelivery\" and DeliveryStatus != \"Delivered\"\r\n| where ('{email_mailfrom:value}' == \"All senders\") or (strcat(SenderUsername, '@', SenderDomain) == '{email_mailfrom:value}')\r\n| summarize value=count() by DeliveryStatus=iff(DeliveryStatus != \"Failed\", DeliveryStatus, iff(tobool(IsHardBounce), \"Failed (hard bounce)\", \"Failed\")), ts=bin(TimeGenerated, 5m)",
              "size": 3,
              "title": "Error Summary",
              "color": "blueDarkDark",
              "timeContextFromParameter": "time_range",
              "queryType": 0,
              "resourceType": "microsoft.communication/communicationservices",
              "visualization": "piechart",
              "chartSettings": {
                "xAxis": "ts"
              }
            },
            "customWidth": "50",
            "conditionalVisibility": {
              "parameterName": "tab",
              "comparison": "isEqualTo",
              "value": "performance"
            },
            "name": "email_performance_piechart_errors",
            "styleSettings": {
              "padding": "8px",
              "maxWidth": "50",
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": " ACSEmailStatusUpdateOperational \r\n| where OperationName == \"DeliveryStatusUpdate\" and isnotempty(DeliveryStatus) and DeliveryStatus !in (\"Delivered\", \"OutForDelivery\")\r\n| where ('{email_mailfrom:value}' == \"All senders\") or (strcat(SenderUsername, '@', SenderDomain) == '{email_mailfrom:value}')\r\n| summarize value=count() by SmtpStatusCode, EnhancedSmtpStatusCode",
              "size": 1,
              "title": "Error Code Details",
              "color": "blueDarkDark",
              "timeContextFromParameter": "email_time",
              "queryType": 0,
              "resourceType": "microsoft.communication/communicationservices",
              "visualization": "table",
              "gridSettings": {
                "labelSettings": [
                  {
                    "columnId": "SmtpStatusCode",
                    "label": "SMTP Status Code"
                  },
                  {
                    "columnId": "EnhancedSmtpStatusCode",
                    "label": "Enhanced SMTP"
                  },
                  {
                    "columnId": "value",
                    "label": "Total"
                  }
                ]
              },
              "chartSettings": {
                "xAxis": "ts",
                "group": "SmtpStatusCode",
                "createOtherGroup": null
              }
            },
            "customWidth": "50",
            "conditionalVisibility": {
              "parameterName": "tab",
              "comparison": "isEqualTo",
              "value": "performance"
            },
            "name": "email_performance_table_errordetails",
            "styleSettings": {
              "padding": "8px",
              "maxWidth": "50",
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "ACSEmailStatusUpdateOperational \r\n| where OperationName == \"DeliveryStatusUpdate\" and isnotempty(DeliveryStatus) and DeliveryStatus != \"OutForDelivery\"\r\n| where ('{email_mailfrom:value}' == \"All senders\") or (strcat(SenderUsername, '@', SenderDomain) == '{email_mailfrom:value}')\r\n| project    Id=CorrelationId, [\"Mail To Address\"]=RecipientId, [\"Mail From Address\"]=strcat(SenderUsername, \"@\", SenderDomain), DeliveryStatus, Status=iff(DeliveryStatus == \"Delivered\", \"success\", \"error\"), [\"Date Sent\"]=TimeGenerated",
              "size": 0,
              "title": "Per-recipient Delivery Details",
              "timeContextFromParameter": "time_range",
              "queryType": 0,
              "resourceType": "microsoft.communication/communicationservices",
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Status",
                    "formatter": 11
                  }
                ],
                "rowLimit": 500,
                "filter": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "tab",
              "comparison": "isEqualTo",
              "value": "performance"
            },
            "name": "email_performance_table_details",
            "styleSettings": {
              "margin": "8px",
              "padding": "8px"
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "tab",
        "comparison": "isEqualTo",
        "value": "email"
      },
      "name": "Email-group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Number of Recordings per {time_granularity} UTC",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ACSCallRecordingSummary\r\n| where TimeGenerated {time_range:query}\r\n| extend time_span = floor(TimeGenerated, {time_granularity})\r\n| summarize recordings=count() by time_span\r\n| render barchart\r\n\r\n",
                    "size": 0,
                    "noDataMessage": "No recordings found in the specified time range",
                    "exportedParameters": [
                      {
                        "fieldName": "",
                        "parameterName": "recordings_day",
                        "parameterType": 1
                      },
                      {
                        "fieldName": "x",
                        "parameterName": "timebin",
                        "parameterType": 1
                      }
                    ],
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices",
                    "sortBy": []
                  },
                  "name": "recordings-day"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let recordings_results = todynamic('{recordings_day}');\r\nACSCallRecordingSummary\r\n| extend OperationDate=strcat(\"ðŸ“…\", format_datetime(TimeGenerated, 'MM/dd/y'))\r\n| where TimeGenerated between (todatetime(recordings_results.x) .. {time_granularity})\r\n\r\n\r\n\r\n\r\n\r\n",
                    "size": 0,
                    "title": "Recordings within selected TimeBin ",
                    "noDataMessage": "No recordings found for the specified time range",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Level",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Warning",
                                "representation": "warning",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "info",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "OperationDate",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "OperationTime",
                          "formatter": 5
                        }
                      ],
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "OperationDate"
                        ],
                        "expandTopLevel": true,
                        "finalBy": "OperationTime"
                      }
                    },
                    "sortBy": []
                  },
                  "conditionalVisibility": {
                    "parameterName": "recordings_day",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "recordings-by-date"
                }
              ]
            },
            "customWidth": "100",
            "name": "recordings-day-group"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Recording Duration in Hours per {time_granularity} UTC",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ACSCallRecordingSummary\r\n| where TimeGenerated {time_range:query}\r\n| extend time_span = floor(TimeGenerated, {time_granularity})\r\n| summarize recordings=sum(RecordingLength)/3600 by time_span\r\n| render barchart\r\n\r\n",
                    "size": 0,
                    "noDataMessage": "No recordings found in the specified time range",
                    "exportedParameters": [
                      {
                        "fieldName": "",
                        "parameterName": "recordings_day",
                        "parameterType": 1
                      },
                      {
                        "fieldName": "x",
                        "parameterName": "timebin",
                        "parameterType": 1
                      }
                    ],
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices",
                    "sortBy": []
                  },
                  "name": "recordings-day"
                }
              ]
            },
            "customWidth": "100",
            "name": "recordings-hours-day-group"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Recording Usage by Format",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ACSCallRecordingSummary\r\n| where TimeGenerated {time_range:query}\r\n| summarize count() by FormatType\r\n| render piechart",
                    "size": 0,
                    "noDataMessage": "No recordings found in the specified time range",
                    "exportMultipleValues": true,
                    "exportedParameters": [
                      {
                        "fieldName": "series",
                        "parameterName": "recordings_format",
                        "parameterType": 1
                      }
                    ],
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices"
                  },
                  "name": "recordings-format"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ACSCallRecordingSummary\r\n| where TimeGenerated {time_range:query}\r\n| where FormatType in ({recordings_format})\r\n| extend OperationDate=strcat(\"ðŸ“…\", format_datetime(TimeGenerated, 'MM/dd/y'))",
                    "size": 0,
                    "title": "Recordings with Format {recordings_format}",
                    "noDataMessage": "No recordings found for the specified time range and format",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Level",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Warning",
                                "representation": "warning",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "info",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "OperationDate",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "OperationTime",
                          "formatter": 5
                        }
                      ],
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "OperationDate"
                        ],
                        "expandTopLevel": true,
                        "finalBy": "OperationTime"
                      },
                      "sortBy": [
                        {
                          "itemKey": "$gen_count_$gen_group_0",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_count_$gen_group_0",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "recordings_format",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "recordings-by-format"
                }
              ]
            },
            "customWidth": "50",
            "name": "recordings-format"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Recording Usage by Channel",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ACSCallRecordingSummary\r\n| where TimeGenerated {time_range:query}\r\n| summarize count() by ChannelType\r\n| render piechart",
                    "size": 0,
                    "noDataMessage": "No recordings found in the specified time range",
                    "exportMultipleValues": true,
                    "exportedParameters": [
                      {
                        "fieldName": "series",
                        "parameterName": "recordings_channel",
                        "parameterType": 1
                      }
                    ],
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices"
                  },
                  "name": "recordings-channel"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ACSCallRecordingSummary\r\n| where TimeGenerated {time_range:query}\r\n| where ChannelType in ({recordings_channel})\r\n| extend OperationDate=strcat(\"ðŸ“…\", format_datetime(TimeGenerated, 'MM/dd/y'))",
                    "size": 0,
                    "title": "Recordings with Channel {recordings_channel}",
                    "noDataMessage": "No recordings found for the specified time range and format",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Level",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Warning",
                                "representation": "warning",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "info",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "OperationDate",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "OperationTime",
                          "formatter": 5
                        }
                      ],
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "OperationDate"
                        ],
                        "expandTopLevel": true,
                        "finalBy": "OperationTime"
                      },
                      "sortBy": [
                        {
                          "itemKey": "$gen_count_$gen_group_0",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_count_$gen_group_0",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "recordings_channel",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "recordings-by-channel"
                }
              ]
            },
            "customWidth": "50",
            "name": "recordings-channel"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Number of Recordings per Call",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ACSCallRecordingSummary\r\n| where TimeGenerated {time_range:query}\r\n| distinct  CorrelationId, RecordingId\r\n| summarize recordings_by_session = count() by CorrelationId\r\n| summarize count() by bin(recordings_by_session, 1)\r\n| render columnchart\r\n\r\n\r\n",
                    "size": 0,
                    "noDataMessage": "No recordings found in the specified time range",
                    "exportMultipleValues": true,
                    "exportedParameters": [
                      {
                        "fieldName": "series",
                        "parameterName": "recordingsession",
                        "parameterType": 1
                      }
                    ],
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices"
                  },
                  "name": "recordings-session"
                }
              ]
            },
            "customWidth": "50",
            "name": "recordings-per-session-group "
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "tab",
        "comparison": "isEqualTo",
        "value": "recording"
      },
      "name": "Recording-group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Summary",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ACSCallAutomationIncomingOperations \r\n| where TimeGenerated {time_range:query} \r\n| summarize Calls = count_distinct(CorrelationId) ",
                    "size": 0,
                    "title": "Count of Calls",
                    "noDataMessage": "No operations found for the specified  time range and OperationName",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices",
                    "crossComponentResources": [],
                    "visualization": "tiles",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Level",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Warning",
                                "representation": "warning",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "info",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "OperationDate",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "OperationTime",
                          "formatter": 5
                        }
                      ],
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "OperationDate"
                        ],
                        "expandTopLevel": true,
                        "finalBy": "OperationTime"
                      },
                      "sortBy": [
                        {
                          "itemKey": "$gen_count_$gen_group_0",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_count_$gen_group_0",
                        "sortOrder": 2
                      }
                    ],
                    "tileSettings": {
                      "titleContent": {
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "Calls",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "blueGreen"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2
                          }
                        }
                      },
                      "showBorder": true,
                      "sortCriteriaField": "Calls"
                    },
                    "textSettings": {
                      "style": "bignumber"
                    }
                  },
                  "customWidth": "33",
                  "name": "count-operations-details"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ACSCallAutomationIncomingOperations \r\n| where TimeGenerated {time_range:query} \r\n| summarize Operations = count()",
                    "size": 0,
                    "title": "Count of Operations",
                    "noDataMessage": "No operations found for the specified  time range and OperationName",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices",
                    "crossComponentResources": [],
                    "visualization": "tiles",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Level",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Warning",
                                "representation": "warning",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "info",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "OperationDate",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "OperationTime",
                          "formatter": 5
                        }
                      ],
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "OperationDate"
                        ],
                        "expandTopLevel": true,
                        "finalBy": "OperationTime"
                      },
                      "sortBy": [
                        {
                          "itemKey": "$gen_count_$gen_group_0",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_count_$gen_group_0",
                        "sortOrder": 2
                      }
                    ],
                    "tileSettings": {
                      "titleContent": {
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "Operations",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "blueGreen"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2
                          }
                        }
                      },
                      "showBorder": true,
                      "sortCriteriaField": "Calls"
                    },
                    "textSettings": {
                      "style": "bignumber"
                    }
                  },
                  "customWidth": "34",
                  "name": "count-operations2-details"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ACSCallAutomationIncomingOperations \r\n| where TimeGenerated {time_range:query}\r\n| where (ResultSignature >= 500 and ResultSignature < 600)\r\n| summarize Errors = count() \r\n",
                    "size": 0,
                    "title": "Count of Operational Errors (5xx errors only)",
                    "noDataMessage": "No operations found for the specified  time range and OperationName",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices",
                    "crossComponentResources": [],
                    "visualization": "tiles",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Level",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Warning",
                                "representation": "warning",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "info",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "OperationDate",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "OperationTime",
                          "formatter": 5
                        }
                      ],
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "OperationDate"
                        ],
                        "expandTopLevel": true,
                        "finalBy": "OperationTime"
                      },
                      "sortBy": [
                        {
                          "itemKey": "$gen_count_$gen_group_0",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_count_$gen_group_0",
                        "sortOrder": 2
                      }
                    ],
                    "tileSettings": {
                      "titleContent": {
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "Errors",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "blueGreen"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2
                          }
                        }
                      },
                      "showBorder": true,
                      "sortCriteriaField": "Calls"
                    },
                    "textSettings": {
                      "style": "bignumber"
                    }
                  },
                  "customWidth": "33",
                  "name": "count-operations3-details"
                }
              ]
            },
            "customWidth": "100",
            "name": "count-calls-summary-group  "
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Count of Active Calls",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ACSCallAutomationIncomingOperations \r\n| where TimeGenerated {time_range:query} \r\n| extend time_span = floor(TimeGenerated, {time_granularity})\r\n| summarize Calls = count_distinct(CorrelationId) by time_span\r\n| render columnchart",
                    "size": 0,
                    "noDataMessage": "No operations found for the specified  time range and OperationName",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices",
                    "crossComponentResources": [],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Level",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Warning",
                                "representation": "warning",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "info",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "OperationDate",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "OperationTime",
                          "formatter": 5
                        }
                      ],
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "OperationDate"
                        ],
                        "expandTopLevel": true,
                        "finalBy": "OperationTime"
                      },
                      "sortBy": [
                        {
                          "itemKey": "$gen_count_$gen_group_0",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_count_$gen_group_0",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "customWidth": "100",
                  "name": "count-operations-details"
                }
              ]
            },
            "customWidth": "100",
            "name": "count-calls-group "
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Count of Operations",
              "items": [
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [],
                    "parameters": [
                      {
                        "id": "0c0b56fd-ffd9-4761-b14e-c916660f9ccc",
                        "version": "KqlParameterItem/1.0",
                        "name": "operation_name",
                        "label": "OperationName",
                        "type": 2,
                        "description": "Choose a delivery status to visualize",
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "ACSCallAutomationIncomingOperations \r\n| where TimeGenerated {time_range:query}\r\n| order by TimeGenerated\r\n| distinct OperationName\r\n",
                        "crossComponentResources": [],
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::all"
                          ],
                          "showDefault": false
                        },
                        "defaultValue": "value::all",
                        "queryType": 0,
                        "resourceType": "microsoft.communication/communicationservices",
                        "value": [
                          "value::all"
                        ]
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices"
                  },
                  "customWidth": "50",
                  "name": "parameters - percentiles"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [],
                    "parameters": [
                      {
                        "id": "de286d0d-1892-4c99-89db-b8dc1282f296",
                        "version": "KqlParameterItem/1.0",
                        "name": "operation_version",
                        "label": "OperationVersion",
                        "type": 2,
                        "description": "Choose a delivery status to visualize",
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "ACSCallAutomationIncomingOperations \r\n| where TimeGenerated {time_range:query}\r\n| where OperationName in ({operation_name})\r\n| order by TimeGenerated\r\n| distinct OperationVersion\r\n",
                        "crossComponentResources": [],
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::all"
                          ],
                          "showDefault": false
                        },
                        "defaultValue": "value::all",
                        "queryType": 0,
                        "resourceType": "microsoft.communication/communicationservices",
                        "value": [
                          "value::all"
                        ]
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices"
                  },
                  "customWidth": "50",
                  "name": "parameters - percentiles2 "
                },
                {
                  "type": 1,
                  "content": {
                    "json": "**Select 1 or several OperationNames and OperationVersions from the drop-down menu to display its associated data**",
                    "style": "info"
                  },
                  "conditionalVisibility": {
                    "parameterName": "operation_name",
                    "comparison": "isEqualTo"
                  },
                  "name": "operations-percentiles-drilldown-info"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ACSCallAutomationIncomingOperations \r\n| where OperationName in ({operation_name}) \r\n| where OperationVersion in ({operation_version}) \r\n| where TimeGenerated {time_range:query} \r\n| extend time_span = floor(TimeGenerated, {time_granularity})\r\n| summarize count() by time_span, OperationName\r\n| render columnchart\r\n",
                    "size": 0,
                    "noDataMessage": "No operations found for the specified  time range and OperationName",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices",
                    "crossComponentResources": [],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Level",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Warning",
                                "representation": "warning",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "info",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "OperationDate",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "OperationTime",
                          "formatter": 5
                        }
                      ],
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "OperationDate"
                        ],
                        "expandTopLevel": true,
                        "finalBy": "OperationTime"
                      },
                      "sortBy": [
                        {
                          "itemKey": "$gen_count_$gen_group_0",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_count_$gen_group_0",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "customWidth": "100",
                  "conditionalVisibility": {
                    "parameterName": "operation_name",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "count-operations-details"
                }
              ]
            },
            "customWidth": "100",
            "name": "operations-percentiles-drill-down-group"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Count of Operational Result Signatures",
              "items": [
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [],
                    "parameters": [
                      {
                        "id": "0c0b56fd-ffd9-4761-b14e-c916660f9ccc",
                        "version": "KqlParameterItem/1.0",
                        "name": "operation_name0",
                        "label": "OperationName",
                        "type": 2,
                        "description": "Choose a delivery status to visualize",
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "ACSCallAutomationIncomingOperations \r\n| where TimeGenerated {time_range:query}\r\n| order by TimeGenerated\r\n| distinct OperationName\r\n",
                        "crossComponentResources": [],
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::all"
                          ],
                          "showDefault": false
                        },
                        "defaultValue": "value::all",
                        "queryType": 0,
                        "resourceType": "microsoft.communication/communicationservices",
                        "value": [
                          "value::all"
                        ]
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices"
                  },
                  "customWidth": "33",
                  "name": "parameters - errors"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [],
                    "parameters": [
                      {
                        "id": "c923cdd1-82ff-4308-ada1-c1e0a2e31f2b",
                        "version": "KqlParameterItem/1.0",
                        "name": "result_signature",
                        "label": "ResultSignature",
                        "type": 2,
                        "description": "Choose a delivery status to visualize",
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "ACSCallAutomationIncomingOperations \r\n| where TimeGenerated {time_range:query}\r\n| order by TimeGenerated\r\n| distinct ResultSignature\r\n",
                        "crossComponentResources": [],
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::all"
                          ],
                          "showDefault": false
                        },
                        "defaultValue": "value::all",
                        "queryType": 0,
                        "resourceType": "microsoft.communication/communicationservices",
                        "value": [
                          "value::all"
                        ]
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices"
                  },
                  "customWidth": "34",
                  "name": "parameters - errors2"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [],
                    "parameters": [
                      {
                        "id": "cfc2374f-f1ee-456b-b3a8-a22bea744472",
                        "version": "KqlParameterItem/1.0",
                        "name": "operation_version0",
                        "label": "OperationVersion",
                        "type": 2,
                        "description": "Choose a delivery status to visualize",
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "ACSCallAutomationIncomingOperations \r\n| where TimeGenerated {time_range:query}\r\n| where OperationName in ({operation_name0})\r\n| order by TimeGenerated\r\n| distinct OperationVersion\r\n",
                        "crossComponentResources": [],
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::all"
                          ],
                          "showDefault": false
                        },
                        "defaultValue": "value::all",
                        "queryType": 0,
                        "resourceType": "microsoft.communication/communicationservices"
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices"
                  },
                  "customWidth": "33",
                  "name": "parameters - errors3"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "**Select 1 or several OperationNames and ResultSignatures from the drop-down menu to display its associated data**",
                    "style": "info"
                  },
                  "conditionalVisibilities": [
                    {
                      "parameterName": "operation_name0",
                      "comparison": "isEqualTo"
                    },
                    {
                      "parameterName": "result_signature",
                      "comparison": "isEqualTo"
                    }
                  ],
                  "name": "operations-errors-drilldown-info"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ACSCallAutomationIncomingOperations \r\n| where TimeGenerated {time_range:query}\r\n| where ResultSignature in ({result_signature})\r\n| where OperationName in ({operation_name0})\r\n| where OperationVersion in ({operation_version0})\r\n| extend time_span = floor(TimeGenerated, {time_granularity})\r\n| summarize count() by time_span, tostring(ResultSignature)\r\n| render columnchart\r\n\r\n",
                    "size": 0,
                    "noDataMessage": "No operations found for the specified  time range and OperationName",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices",
                    "crossComponentResources": [],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Level",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Warning",
                                "representation": "warning",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "info",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "OperationDate",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "OperationTime",
                          "formatter": 5
                        }
                      ],
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "OperationDate"
                        ],
                        "expandTopLevel": true,
                        "finalBy": "OperationTime"
                      },
                      "sortBy": [
                        {
                          "itemKey": "$gen_count_$gen_group_0",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_count_$gen_group_0",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "customWidth": "100",
                  "conditionalVisibilities": [
                    {
                      "parameterName": "operation_name0",
                      "comparison": "isNotEqualTo"
                    },
                    {
                      "parameterName": "result_signature",
                      "comparison": "isNotEqualTo"
                    }
                  ],
                  "name": "count-errors-details"
                }
              ]
            },
            "customWidth": "100",
            "name": "Operational-Errors-group"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "All Operations done on a Call",
              "items": [
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [],
                    "parameters": [
                      {
                        "id": "0c0b56fd-ffd9-4761-b14e-c916660f9ccc",
                        "version": "KqlParameterItem/1.0",
                        "name": "correlation_id",
                        "label": "CorrelationId",
                        "type": 2,
                        "description": "Choose a delivery status to visualize",
                        "query": "ACSCallAutomationIncomingOperations \r\n| where TimeGenerated {time_range:query}\r\n| order by TimeGenerated\r\n| distinct CorrelationId\r\n",
                        "crossComponentResources": [],
                        "typeSettings": {
                          "additionalResourceOptions": [],
                          "showDefault": false
                        },
                        "queryType": 0,
                        "resourceType": "microsoft.communication/communicationservices",
                        "value": null
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices"
                  },
                  "name": "parameters - correlationid"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "**Select a CorrelationId from the drop-down menu to display its associated data**",
                    "style": "info"
                  },
                  "conditionalVisibility": {
                    "parameterName": "correlation_id",
                    "comparison": "isEqualTo"
                  },
                  "name": "correlation-id-drilldown-info"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ACSCallAutomationIncomingOperations \r\n| where CorrelationId == \"{correlation_id}\" \r\n| where TimeGenerated {time_range:query} \r\n| extend OperationDate=strcat(\"ðŸ“…\", format_datetime(TimeGenerated, 'MM/dd/y'))\r\n| project OperationDate, OperationName, ResultSignature, DurationMs, CallerIpAddress, OperationVersion, SdkType, SdkVersion\r\n",
                    "size": 0,
                    "noDataMessage": "No operations found for the specified  time range and CorrelationId",
                    "queryType": 0,
                    "resourceType": "microsoft.communication/communicationservices",
                    "crossComponentResources": [],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Level",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Warning",
                                "representation": "warning",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "info",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "OperationDate",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "OperationTime",
                          "formatter": 5
                        }
                      ],
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "OperationDate"
                        ],
                        "expandTopLevel": true,
                        "finalBy": "OperationTime"
                      },
                      "sortBy": [
                        {
                          "itemKey": "$gen_count_$gen_group_0",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_count_$gen_group_0",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "customWidth": "100",
                  "conditionalVisibility": {
                    "parameterName": "correlation_id",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "correlation-id-details"
                }
              ]
            },
            "customWidth": "100",
            "name": "correlation-id-drill-down-group "
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "tab",
        "comparison": "isEqualTo",
        "value": "automation"
      },
      "name": "Automation-group"
    }
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}
