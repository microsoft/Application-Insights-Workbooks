{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 9,
      "content": {
        "version": "ParameterCollectionItem/1.0",
        "parameters": [
          {
            "id": "4f40cabd-848b-41c7-b4a7-2ac7e64764be",
            "version": "ParameterItem/1.0",
            "name": "TimeRange",
            "label": "Time Range",
            "type": 4,
            "isRequired": true,
            "value": {
              "durationMs": 2592000000
            },
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 300000
                },
                {
                  "durationMs": 900000
                },
                {
                  "durationMs": 1800000
                },
                {
                  "durationMs": 3600000
                },
                {
                  "durationMs": 14400000
                },
                {
                  "durationMs": 43200000
                },
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 172800000
                },
                {
                  "durationMs": 259200000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 1209600000
                },
                {
                  "durationMs": 2419200000
                },
                {
                  "durationMs": 2592000000
                },
                {
                  "durationMs": 5184000000
                },
                {
                  "durationMs": 7776000000
                }
              ]
            }
          },
          {
            "id": "2e8f7c9d-4a5b-42e1-8f3a-6d2c9e1b8a4f",
            "version": "ParameterItem/1.0",
            "name": "SdkVersion",
            "label": "SDK Version",
            "type": 2,
            "isRequired": false,
            "multiSelect": false,
            "query": "union (\ndatatable(sdkVersion:string) [\n'All'\n]\n), (\ncustomMetrics\n| where name in (\"preview.item.success.count\", \"preview.item.dropped.count\")\n| where isnotempty(sdkVersion)\n| distinct sdkVersion\n| order by sdkVersion asc\n)",
            "value": "All",
            "typeSettings": {
              "showDefault": true
            },
            "timeContext": {
              "durationMs": 0,
              "endTime": null,
              "createdTime": "2025-08-11T00:00:00.000Z"
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 0,
            "resourceType": "microsoft.insights/components"
          },
          {
            "id": "8c1f9e2d-3b4a-45e6-9f8c-7d5e2a1b9c8f",
            "version": "ParameterItem/1.0",
            "name": "SelectedMetric",
            "label": "Selected Metric",
            "type": 1,
            "isRequired": false,
            "value": "",
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 0,
              "endTime": null,
              "createdTime": "2025-08-12T00:00:00.000Z"
            }
          },
          {
            "id": "9d2e8f3c-4b5a-46e7-8f9c-6d5e3a2b1c9f",
            "version": "ParameterItem/1.0",
            "name": "SelectedTimeBucket",
            "label": "Selected Time Bucket",
            "type": 1,
            "isRequired": false,
            "value": "",
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 0,
              "endTime": null,
              "createdTime": "2025-08-12T00:00:00.000Z"
            }
          },
          {
            "id": "1a3b5c7d-9e2f-48a1-b3c5-7d9e2f1a3b5c",
            "version": "ParameterItem/1.0",
            "name": "DropReason",
            "label": "Drop Reason",
            "type": 2,
            "isRequired": false,
            "multiSelect": false,
            "query": "union (\ndatatable(drop_reason:string) [\n'All'\n]\n), (\ncustomMetrics\n| where name == \"preview.item.dropped.count\"\n| extend drop_reason = tostring(customDimensions[\"drop.reason\"])\n| where isnotempty(drop_reason)\n| distinct drop_reason\n| order by drop_reason asc\n)",
            "value": "All",
            "typeSettings": {
              "showDefault": true
            },
            "timeContext": {
              "durationMs": 0,
              "endTime": null,
              "createdTime": "2025-08-12T00:00:00.000Z"
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 0,
            "resourceType": "microsoft.insights/components"
          },
          {
            "id": "2f4a6c8e-5d7b-49f2-a4c6-8e0d2f4a6c8e",
            "version": "ParameterItem/1.0",
            "name": "DropCode",
            "label": "Drop Code",
            "type": 2,
            "isRequired": false,
            "multiSelect": false,
            "query": "union (\ndatatable(drop_code:string) [\n'All'\n]\n), (\ncustomMetrics\n| where name == \"preview.item.dropped.count\"\n| extend drop_code = tostring(customDimensions[\"drop.code\"])\n| where isnotempty(drop_code)\n| distinct drop_code\n| order by drop_code asc\n)",
            "value": "All",
            "typeSettings": {
              "showDefault": true
            },
            "timeContext": {
              "durationMs": 0,
              "endTime": null,
              "createdTime": "2025-08-12T00:00:00.000Z"
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 0,
            "resourceType": "microsoft.insights/components"
          },
          {
            "id": "3e5a7c9f-6d8b-4af3-b5c7-9f1d3e5a7c9f",
            "version": "ParameterItem/1.0",
            "name": "TelemetryType",
            "label": "Telemetry Type",
            "type": 2,
            "isRequired": false,
            "multiSelect": false,
            "query": "union (\ndatatable(telemetry_type:string) [\n'All'\n]\n), (\ncustomMetrics\n| where name in (\"preview.item.success.count\", \"preview.item.dropped.count\")\n| extend telemetry_type = tostring(customDimensions[\"telemetry_type\"])\n| where isnotempty(telemetry_type)\n| distinct telemetry_type\n| order by telemetry_type asc\n)",
            "value": "All",
            "typeSettings": {
              "showDefault": true
            },
            "timeContext": {
              "durationMs": 0,
              "endTime": null,
              "createdTime": "2025-08-14T00:00:00.000Z"
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 0,
            "resourceType": "microsoft.insights/components"
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.insights/components"
      },
      "name": "parameters - 1"
    },
    {
      "type": 1,
      "content": {
        "json": "## SDK Stats\n---\nThe SDK Stats workbook provides a clear visualization of success and failure metrics for your application. It leverages the Azure Monitor SDK to track and chart two key custom metrics: preview.item.success.count and preview.item.dropped.count. This workbook helps teams monitor operational health, identify trends, and quickly detect anomalies in customer-facing processes by displaying these metrics over time in an intuitive line chart format.\n"
      },
      "name": "text - 2"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "let success_data = customMetrics\n| where name == \"preview.item.success.count\"\n| where isempty('{SdkVersion}') or '{SdkVersion}' == 'All' or sdkVersion == '{SdkVersion}'\n| extend telemetry_type = tostring(customDimensions[\"telemetry_type\"])\n| where isempty('{TelemetryType}') or '{TelemetryType}' == 'All' or telemetry_type == '{TelemetryType}'\n| summarize success_count = sum(todouble(value)) by bin(timestamp, {TimeRange:grain});\nlet dropped_data = customMetrics\n| where name == \"preview.item.dropped.count\"\n| where isempty('{SdkVersion}') or '{SdkVersion}' == 'All' or sdkVersion == '{SdkVersion}'\n| extend drop_reason = tostring(customDimensions[\"drop.reason\"])\n| extend drop_code = tostring(customDimensions[\"drop.code\"])\n| extend telemetry_type = tostring(customDimensions[\"telemetry_type\"])\n| where isempty('{TelemetryType}') or '{TelemetryType}' == 'All' or telemetry_type == '{TelemetryType}'\n| where isempty('{DropReason}') or '{DropReason}' == 'All' or drop_reason == '{DropReason}'\n| where isempty('{DropCode}') or '{DropCode}' == 'All' or drop_code == '{DropCode}'\n| summarize dropped_count = sum(todouble(value)) by bin(timestamp, {TimeRange:grain});\nlet all_timestamps = union success_data, dropped_data | distinct timestamp;\nlet combined_data = all_timestamps\n| join kind=leftouter success_data on timestamp\n| join kind=leftouter dropped_data on timestamp\n| extend success_count = coalesce(success_count, 0.0)\n| extend dropped_count = coalesce(dropped_count, 0.0);\n// Create success records\nlet success_records = combined_data\n| where (isempty('{DropReason}') or '{DropReason}' == 'All') and (isempty('{DropCode}') or '{DropCode}' == 'All')\n| project timestamp, metric_type = \"Success Count\", count_value = success_count;\n// Create dropped records\nlet dropped_records = combined_data\n| project timestamp, metric_type = \"Dropped Count\", count_value = dropped_count;\n// Union the records\nunion success_records, dropped_records\n| order by timestamp asc, metric_type asc\n| render timechart",
        "size": 1,
        "title": "Telemetry Export Success vs. Failure",
        "timeContext": {
          "durationMs": 0,
          "createdTime": "2025-07-30T00:00:00.000Z"
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.insights/components",
        "chartSettings": {
          "seriesLabelSettings": [
            {
              "seriesName": "Dropped Count",
              "color": "redBright"
            },
            {
              "seriesName": "Success Count",
              "color": "green"
            }
          ],
          "ySettings": {
            "numberFormatSettings": {
              "unit": 0,
              "options": {
                "style": "decimal",
                "useGrouping": true
              }
            }
          }
        }
      },
      "name": "Success and Failure Count Line Chart"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "customMetrics\n| where name in (\"preview.item.dropped.count\", \"preview.item.success.count\")\n| where isempty('{SdkVersion}') or '{SdkVersion}' == 'All' or sdkVersion == '{SdkVersion}'\n| extend drop_reason = iff(name == \"preview.item.dropped.count\", tostring(customDimensions[\"drop.reason\"]), \"\")\n| extend drop_code = iff(name == \"preview.item.dropped.count\", tostring(customDimensions[\"drop.code\"]), \"\")\n| extend telemetry_type = tostring(customDimensions[\"telemetry_type\"])\n| where isempty('{TelemetryType}') or '{TelemetryType}' == 'All' or telemetry_type == '{TelemetryType}'\n| where isempty('{DropReason}') or '{DropReason}' == 'All' or drop_reason == '{DropReason}'\n| where isempty('{DropCode}') or '{DropCode}' == 'All' or drop_code == '{DropCode}'\n| summarize total_count = sum(todouble(value)) by name, bin(timestamp, {TimeRange:grain})\n| summarize success_count = sumif(total_count, name == \"preview.item.success.count\"), dropped_count = sumif(total_count, name == \"preview.item.dropped.count\") by timestamp\n| extend failure_ratio = iff(success_count > 0, dropped_count / success_count, 0.0)\n| project timestamp, [\"Failure Ratio\"] = failure_ratio\n| order by timestamp asc",
        "size": 1,
        "title": "Failure Ratio (Dropped/Success)",
        "timeContext": {
          "durationMs": 0,
          "createdTime": "2025-08-20T00:00:00.000Z"
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.insights/components",
        "visualization": "timechart",
        "chartSettings": {
          "seriesLabelSettings": [
            {
              "seriesName": "Failure Ratio",
              "color": "orange"
            }
          ],
          "ySettings": {
            "numberFormatSettings": {
              "unit": 0,
              "options": {
                "style": "percent",
                "useGrouping": true,
                "minimumFractionDigits": 1,
                "maximumFractionDigits": 2
              }
            }
          }
        }
      },
      "conditionalVisibility": {
        "parameterName": "DropReason",
        "comparison": "isEqualTo",
        "value": "All"
      },
      "conditionalVisibilities": [
        {
          "parameterName": "DropReason",
          "comparison": "isEqualTo",
          "value": "All"
        },
        {
          "parameterName": "DropCode",
          "comparison": "isEqualTo",
          "value": "All"
        }
      ],
      "name": "Failure Ratio Chart"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "let request_data = requests\n| where isempty('{SdkVersion}') or '{SdkVersion}' == 'All' or client_Type == '{SdkVersion}'\n| extend success_status = iff(success == true, \"Successful Telemetry\", \"Failed Telemetry\")\n| summarize request_count = count() by success_status;\nlet dependency_data = dependencies\n| where isempty('{SdkVersion}') or '{SdkVersion}' == 'All' or client_Type == '{SdkVersion}'\n| extend success_status = iff(success == true, \"Successful Telemetry\", \"Failed Telemetry\")\n| summarize dependency_count = count() by success_status;\nlet dropped_data = customMetrics\n| where name == \"preview.item.dropped.count\"\n| where isempty('{SdkVersion}') or '{SdkVersion}' == 'All' or sdkVersion == '{SdkVersion}'\n| extend telemetry_success = tostring(customDimensions[\"telemetry_success\"])\n| extend telemetry_type = tostring(customDimensions[\"telemetry_type\"])\n| where telemetry_type in (\"DEPENDENCY\", \"REQUEST\")\n| where isnotempty(telemetry_success)\n| extend success_status = iff(telemetry_success == \"true\", \"Successful Telemetry\", \"Failed Telemetry\")\n| summarize dropped_count = sum(todouble(value)) by success_status;\nunion \n    (request_data | project success_status, series_name = \"Sent\", count_value = todouble(request_count)),\n    (dependency_data | project success_status, series_name = \"Sent\", count_value = todouble(dependency_count)),\n    (dropped_data | project success_status, series_name = \"Dropped\", count_value = dropped_count)\n| summarize count_value = sum(count_value) by success_status, series_name\n| evaluate pivot(series_name, sum(count_value))\n| project success_status, Sent = coalesce(Sent, 0.0), Dropped = coalesce(Dropped, 0.0)",
        "size": 1,
        "title": "Dropped Requests/Dependencies Success or Failure",
        "timeContext": {
          "durationMs": 0,
          "createdTime": "2025-08-21T00:00:00.000Z"
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.insights/components",
        "visualization": "barchart",
        "chartSettings": {
          "group": "success_status",
          "createOtherGroup": false,
          "seriesLabelSettings": [
            {
              "seriesName": "Sent",
              "color": "blue"
            },
            {
              "seriesName": "Dropped",
              "color": "orange"
            }
          ],
          "ySettings": {
            "numberFormatSettings": {
              "unit": 0,
              "options": {
                "style": "decimal",
                "useGrouping": true
              }
            }
          }
        }
      },
      "name": "Dependencies and Requests Dropped Count Chart"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Drop Reasons for Selected Time Bucket",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "### Drop Reasons for Time Bucket: {SelectedTimeBucket}\nShowing detailed drop reasons for the selected time bucket. This analysis helps identify specific causes of telemetry failures during this time period."
            },
            "name": "selected time bucket header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let selected_time_bucket = datetime('{SelectedTimeBucket}');\ncustomMetrics\n| where name == \"preview.item.dropped.count\"\n| where isempty('{SdkVersion}') or '{SdkVersion}' == 'All' or sdkVersion == '{SdkVersion}'\n| where bin(timestamp, {TimeRange:grain}) == selected_time_bucket\n| extend drop_reason = tostring(customDimensions[\"drop.reason\"])\n| extend drop_code = tostring(customDimensions[\"drop.code\"])\n| where isnotempty(drop_reason)\n| where isempty('{DropReason}') or '{DropReason}' == 'All' or drop_reason == '{DropReason}'\n| where isempty('{DropCode}') or '{DropCode}' == 'All' or drop_code == '{DropCode}'\n| summarize total_dropped = sum(todouble(value)) by drop_reason\n| order by total_dropped desc\n| project [\"Drop Reason\"] = drop_reason, [\"Total Dropped\"] = tolong(total_dropped)",
              "size": 0,
              "title": "Drop Reasons Breakdown",
              "timeContext": {
                "durationMs": 0,
                "createdTime": "2025-08-12T00:00:00.000Z"
              },
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.insights/components",
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Total Dropped",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "redBright"
                    }
                  }
                ]
              }
            },
            "name": "selected time bucket drop reasons"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let selected_time_bucket = datetime('{SelectedTimeBucket}');\ncustomMetrics\n| where name == \"preview.item.dropped.count\"\n| where isempty('{SdkVersion}') or '{SdkVersion}' == 'All' or sdkVersion == '{SdkVersion}'\n| where bin(timestamp, {TimeRange:grain}) == selected_time_bucket\n| extend drop_reason = tostring(customDimensions[\"drop.reason\"])\n| extend drop_code = tostring(customDimensions[\"drop.code\"])\n| where isnotempty(drop_reason)\n| where isempty('{DropReason}') or '{DropReason}' == 'All' or drop_reason == '{DropReason}'\n| where isempty('{DropCode}') or '{DropCode}' == 'All' or drop_code == '{DropCode}'\n| summarize total_dropped = sum(todouble(value)) by drop_reason\n| order by total_dropped desc\n| project drop_reason, total_dropped\n| render piechart",
              "size": 0,
              "title": "Drop Reasons Distribution",
              "timeContext": {
                "durationMs": 0,
                "createdTime": "2025-08-12T00:00:00.000Z"
              },
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.insights/components",
              "chartSettings": {
                "seriesLabelSettings": [
                  {
                    "seriesName": "*",
                    "color": "redBright"
                  }
                ]
              }
            },
            "name": "selected time bucket pie chart"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "SelectedTimeBucket",
        "comparison": "isNotEqualTo",
        "value": ""
      },
      "name": "selected time bucket group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Drop Reasons Analysis",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "### Drop Reasons Breakdown\nShowing detailed drop reasons for the selected time period. This analysis helps identify specific causes of telemetry failures."
            },
            "name": "drop reasons header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "customMetrics\n| where name == \"preview.item.dropped.count\"\n| where isempty('{SdkVersion}') or '{SdkVersion}' == 'All' or sdkVersion == '{SdkVersion}'\n| extend drop_reason = tostring(customDimensions[\"drop.reason\"])\n| extend drop_code = tostring(customDimensions[\"drop.code\"])\n| where isnotempty(drop_reason)\n| where isempty('{DropCode}') or '{DropCode}' == 'All' or drop_code == '{DropCode}'\n| summarize total_dropped = sum(value) by drop_reason, bin(timestamp, {TimeRange:grain})\n| project timestamp, drop_reason, total_dropped\n| render timechart",
              "size": 1,
              "title": "Drop Reasons Over Time",
              "timeContext": {
                "durationMs": 0,
                "createdTime": "2025-08-12T00:00:00.000Z"
              },
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.insights/components"
            },
            "name": "drop reasons timechart"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "customMetrics\n| where name == \"preview.item.dropped.count\"\n| where isempty('{SdkVersion}') or '{SdkVersion}' == 'All' or sdkVersion == '{SdkVersion}'\n| extend drop_reason = tostring(customDimensions[\"drop.reason\"])\n| extend drop_code = tostring(customDimensions[\"drop.code\"])\n| where isnotempty(drop_reason)\n| where isempty('{DropCode}') or '{DropCode}' == 'All' or drop_code == '{DropCode}'\n| summarize total_dropped = sum(value) by drop_reason\n| order by total_dropped desc\n| project [\"Drop Reason\"] = drop_reason, [\"Total Dropped\"] = total_dropped",
              "size": 0,
              "title": "Drop Reasons Summary",
              "timeContext": {
                "durationMs": 0,
                "createdTime": "2025-08-12T00:00:00.000Z"
              },
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.insights/components",
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Total Dropped",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "redBright"
                    }
                  }
                ]
              }
            },
            "name": "drop reasons summary"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "SelectedMetric",
        "comparison": "isEqualTo",
        "value": "dropped count"
      },
      "name": "drop reasons group"
    }
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}