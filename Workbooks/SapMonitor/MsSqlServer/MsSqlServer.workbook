{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "7a6caffd-86b3-424c-a572-87b526494733",
            "version": "KqlParameterItem/1.0",
            "name": "Days",
            "type": 4,
            "isRequired": true,
            "value": {
              "durationMs": 172800000
            },
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 300000
                },
                {
                  "durationMs": 900000
                },
                {
                  "durationMs": 1800000
                },
                {
                  "durationMs": 3600000
                },
                {
                  "durationMs": 14400000
                },
                {
                  "durationMs": 43200000
                },
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 172800000
                },
                {
                  "durationMs": 259200000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 1209600000
                },
                {
                  "durationMs": 2419200000
                },
                {
                  "durationMs": 2592000000
                },
                {
                  "durationMs": 5184000000
                },
                {
                  "durationMs": 7776000000
                }
              ]
            }
          },
          {
            "id": "a93b8903-9fd3-4817-a869-db24544a3744",
            "version": "KqlParameterItem/1.0",
            "name": "Provider",
            "type": 2,
            "isRequired": true,
            "query": "MSSQL_SystemProps_CL\r\n| project PROVIDER_INSTANCE_s \r\n| distinct PROVIDER_INSTANCE_s\r\n",
            "value": "MOM-Node-1",
            "typeSettings": {
              "additionalResourceOptions": []
            },
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "9d767659-b350-4ac8-bce0-6348d4ebc9dc",
            "version": "KqlParameterItem/1.0",
            "name": "Hostname",
            "type": 1,
            "query": "let LastOne = MSSQL_SystemProps_CL\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| summarize TimeGenerated = max(TimeGenerated)\r\n| project TimeGenerated;\r\n\r\nMSSQL_SystemProps_CL\r\n| join kind=inner (LastOne) on TimeGenerated\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| project Value_s,TimeGenerated, Setting_s, PROVIDER_INSTANCE_s\r\n| where Setting_s == \"ComputerNamePhysicalNetBIOS\" \r\n| take 1\r\n",
            "isHiddenWhenLocked": true,
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "4352266b-0bd9-49a2-a6e8-1b4a88b29c58",
            "version": "KqlParameterItem/1.0",
            "name": "SQLInstance",
            "type": 1,
            "query": "let LastOne = MSSQL_SystemProps_CL\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| summarize TimeGenerated = max(TimeGenerated)\r\n| project TimeGenerated;\r\n\r\nMSSQL_SystemProps_CL\r\n| join kind=inner (LastOne) on TimeGenerated\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| project Value_s,TimeGenerated, Setting_s, PROVIDER_INSTANCE_s\r\n| where Setting_s == \"ServerName\" \r\n| take 1\r\n",
            "isHiddenWhenLocked": true,
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "ea8bbc0a-0748-4cd0-a0bf-083fa073ec37",
            "version": "KqlParameterItem/1.0",
            "name": "WindowsRelease",
            "type": 1,
            "query": "let LastOne = MSSQL_SystemProps_CL\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| summarize TimeGenerated = max(TimeGenerated)\r\n| project TimeGenerated;\r\n\r\nMSSQL_SystemProps_CL\r\n| join kind=inner (LastOne) on TimeGenerated\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| project Value_s,TimeGenerated, Setting_s, PROVIDER_INSTANCE_s\r\n| where Setting_s == \"WindowsRelease\" \r\n| take 1\r\n\r\n",
            "isHiddenWhenLocked": true,
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "2f4852b9-6def-4f3b-abd0-94a10ec7b993",
            "version": "KqlParameterItem/1.0",
            "name": "WindowsSKU",
            "type": 1,
            "query": "let LastOne = MSSQL_SystemProps_CL\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| summarize TimeGenerated = max(TimeGenerated)\r\n| project TimeGenerated;\r\n\r\nMSSQL_SystemProps_CL\r\n| join kind=inner (LastOne) on TimeGenerated\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| project Value_s,TimeGenerated, Setting_s, PROVIDER_INSTANCE_s\r\n| where Setting_s == \"WindowsSKU\" \r\n| take 1\r\n\r\n",
            "isHiddenWhenLocked": true,
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "32ba2c87-5b17-4097-86b2-4bc2eee8d544",
            "version": "KqlParameterItem/1.0",
            "name": "SQLEdition",
            "type": 1,
            "query": "let LastOne = MSSQL_SystemProps_CL\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| summarize TimeGenerated = max(TimeGenerated)\r\n| project TimeGenerated;\r\n\r\nMSSQL_SystemProps_CL\r\n| join kind=inner (LastOne) on TimeGenerated\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| project Value_s,TimeGenerated, Setting_s, PROVIDER_INSTANCE_s\r\n| where Setting_s == \"Edition\" \r\n| take 1\r\n",
            "isHiddenWhenLocked": true,
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "f6b011a1-e3ec-466a-8bd3-e35b437b900e",
            "version": "KqlParameterItem/1.0",
            "name": "SQLVersion",
            "type": 1,
            "query": "let LastOne = MSSQL_SystemProps_CL\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| summarize TimeGenerated = max(TimeGenerated)\r\n| project TimeGenerated;\r\n\r\nMSSQL_SystemProps_CL\r\n| join kind=inner (LastOne) on TimeGenerated\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| project Value_s,TimeGenerated, Setting_s, PROVIDER_INSTANCE_s\r\n| where Setting_s == \"ProductVersion\" \r\n| take 1\r\n\r\n",
            "isHiddenWhenLocked": true,
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "3aa26357-6464-448c-8664-2a6bf23ab632",
            "version": "KqlParameterItem/1.0",
            "name": "WindowsLanguage",
            "type": 1,
            "query": "let LastOne = MSSQL_SystemProps_CL\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| summarize TimeGenerated = max(TimeGenerated)\r\n| project TimeGenerated;\r\n\r\nMSSQL_SystemProps_CL\r\n| join kind=inner (LastOne) on TimeGenerated\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| project Value_s,TimeGenerated, Setting_s, PROVIDER_INSTANCE_s\r\n| where Setting_s == \"WindowsOSLanguage\" \r\n| take 1\r\n\r\n",
            "isHiddenWhenLocked": true,
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "9de79599-f0b0-4fdf-8647-49fc893062f7",
            "version": "KqlParameterItem/1.0",
            "name": "SAPSID",
            "type": 1,
            "query": "MSSQL_SystemProps_CL\r\n| where PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| project METADATA_sid_s,TimeGenerated\r\n| order by TimeGenerated desc\r\n| take 1",
            "isHiddenWhenLocked": true,
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "842310b3-c00a-43bb-b55a-b77335526979",
            "version": "KqlParameterItem/1.0",
            "name": "BlockingTableExists",
            "type": 1,
            "isRequired": true,
            "query": "MSSQL_BlockingProcesses_CL \r\n| limit 1\r\n\r\n\r\n\r\n\r\n\r\n",
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 3600000
            },
            "queryType": 0,
            "resourceType": "microsoft.insights/components"
          }
        ],
        "style": "above",
        "queryType": 0
      },
      "customWidth": "50",
      "name": "Parameter "
    },
    {
      "type": 1,
      "content": {
        "json": "## Azure Monitor for SAP Solutions on MS SQL Server\r\n---\r\n<b style=\"color:DodgerBlue;\">OS Hostname:</b> {Hostname} on {WindowsRelease} ({WindowsSKU}) - {WindowsLanguage} </br>\r\n<b style=\"color:DodgerBlue;\">SQL Instance:</b> {SQLInstance} - {SQLEdition} Version {SQLVersion}  </br>\r\n<b style=\"color:DodgerBlue;\">SAP Instance:</b> {SAPSID}\r\n"
      },
      "customWidth": "50",
      "name": "Headline"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "links": [
          {
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Current Load",
            "subTarget": "1",
            "style": "link"
          },
          {
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Statistics",
            "subTarget": "2",
            "style": "link"
          },
          {
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Resources",
            "subTarget": "3",
            "style": "link"
          },
          {
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Problems",
            "subTarget": "4",
            "style": "link"
          },
          {
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "AlwaysOn",
            "subTarget": "5",
            "style": "link"
          }
        ]
      },
      "name": "Links - 12"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "MSSQL_BatchRequests_CL \r\n| where TimeGenerated {Days}\r\n| where PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| where counter_name_s has \"Batch\"\r\n| project TimeGenerated, counter_name_s, cntr_value_d\r\n",
        "size": 0,
        "aggregation": 3,
        "title": "Batch Request/sec ({Days:label})",
        "timeContext": {
          "durationMs": 172800000
        },
        "timeContextFromParameter": "Days",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "areachart",
        "chartSettings": {
          "xSettings": {},
          "ySettings": {}
        }
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "1"
      },
      "customWidth": "33",
      "name": "BatcheRequests",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "MSSQL_BatchRequests_CL\r\n| where TimeGenerated {Days}\r\n| where PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| where counter_name_s has 'Compilations'\r\n| project TimeGenerated, counter_name_s, cntr_value_d",
        "size": 0,
        "aggregation": 3,
        "title": "Compilations and Re-Compilations/sec ({Days:label})",
        "noDataMessage": "Sorry, no data.",
        "timeContext": {
          "durationMs": 172800000
        },
        "timeContextFromParameter": "Days",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "areachart",
        "chartSettings": {
          "seriesLabelSettings": [
            {
              "seriesName": "SQL Compilations/sec                                                                                                            ",
              "color": "orange"
            },
            {
              "seriesName": "SQL Re-Compilations/sec                                                                                                         ",
              "color": "redDark"
            }
          ],
          "xSettings": {},
          "ySettings": {}
        }
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "1"
      },
      "customWidth": "33",
      "name": "Compilations",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "MSSQL_CPUUsage_CL\r\n| where TimeGenerated {Days}\r\n| where PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| project TimeGenerated, CPU_SQL_d, CPU_Idle_d, CPU_Others_d\r\n",
        "size": 0,
        "aggregation": 5,
        "title": "CPU Usage",
        "noDataMessage": "No Data.",
        "timeContext": {
          "durationMs": 172800000
        },
        "timeContextFromParameter": "Days",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "linechart",
        "chartSettings": {
          "seriesLabelSettings": [
            {
              "seriesName": "CPU_SQL_d",
              "label": "SQL Server",
              "color": "green"
            },
            {
              "seriesName": "CPU_Idle_d",
              "label": "Idle",
              "color": "blue"
            },
            {
              "seriesName": "CPU_Others_d",
              "label": "Others",
              "color": "red"
            }
          ],
          "xSettings": {},
          "ySettings": {}
        }
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "1"
      },
      "customWidth": "33",
      "name": "CPUUsage",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "MSSQL_IOPerformance_CL\r\n| where TimeGenerated {Days}\r\n| where PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| project TimeGenerated, Filename_s, TotalLatency_ms__d, ReadLatency_ms__d, WriteLatency_ms__d\r\n",
        "size": 0,
        "aggregation": 3,
        "title": "DB IO Latency ({Days:label})",
        "noDataMessage": "Sorry, no data.",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "linechart",
        "tileSettings": {
          "showBorder": false
        },
        "graphSettings": {
          "type": 0
        },
        "chartSettings": {
          "group": null,
          "createOtherGroup": 0,
          "seriesLabelSettings": [
            {
              "seriesName": "TotalLatency_ms__d",
              "label": "TotalLatency (ms)",
              "color": "gray"
            },
            {
              "seriesName": "ReadLatency_ms__d",
              "label": "ReadLatency (ms)",
              "color": "grayBlue"
            },
            {
              "seriesName": "WriteLatency_ms__d",
              "label": "WriteLatency (ms)",
              "color": "green"
            }
          ],
          "xSettings": {},
          "ySettings": {}
        },
        "mapSettings": {
          "locInfo": "LatLong",
          "sizeSettings": "TotalLatency_ms__d",
          "sizeAggregation": "Sum",
          "legendMetric": "TotalLatency_ms__d",
          "legendAggregation": "Sum",
          "itemColorSettings": {
            "type": "heatmap",
            "colorAggregation": "Sum",
            "nodeColorField": "TotalLatency_ms__d",
            "heatmapPalette": "greenRed"
          }
        }
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "1"
      },
      "customWidth": "33",
      "name": "IO Latency",
      "styleSettings": {
        "maxWidth": "100%",
        "showBorder": true
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "MSSQL_PageLifeExpectancy2_CL\r\n| where TimeGenerated {Days}\r\n| where PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| where counter_name_s has \"Buffer\"\r\n| project TimeGenerated, counter_name_s, cntr_value_d",
        "size": 0,
        "aggregation": 5,
        "title": "Buffer Cache Hit Ratio ({Days:label})",
        "noDataMessage": "No data.",
        "timeContext": {
          "durationMs": 172800000
        },
        "timeContextFromParameter": "Days",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "barchart",
        "tileSettings": {
          "showBorder": false,
          "titleContent": {
            "columnMatch": "counter_name_s",
            "formatter": 1
          },
          "leftContent": {
            "columnMatch": "cntr_value_d",
            "formatter": 12,
            "formatOptions": {
              "palette": "auto"
            },
            "numberFormat": {
              "unit": 17,
              "options": {
                "maximumSignificantDigits": 3,
                "maximumFractionDigits": 2
              }
            }
          }
        },
        "graphSettings": {
          "type": 0,
          "topContent": {
            "columnMatch": "counter_name_s",
            "formatter": 1
          },
          "centerContent": {
            "columnMatch": "cntr_value_d",
            "formatter": 1,
            "numberFormat": {
              "unit": 17,
              "options": {
                "maximumSignificantDigits": 3,
                "maximumFractionDigits": 2
              }
            }
          }
        },
        "chartSettings": {
          "seriesLabelSettings": [
            {
              "seriesName": "Buffer cache hit ratio                                                                                                          ",
              "color": "green"
            }
          ],
          "xSettings": {},
          "ySettings": {}
        }
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "1"
      },
      "customWidth": "33",
      "name": "BatchRequests",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "MSSQL_PageLifeExpectancy2_CL\r\n| where TimeGenerated {Days}\r\n| where PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| where counter_name_s has \"Page\"\r\n| project TimeGenerated, counter_name_s, cntr_value_d",
        "size": 0,
        "aggregation": 5,
        "title": "Page File Expectency ({Days:label})",
        "noDataMessage": "No data.",
        "timeContext": {
          "durationMs": 172800000
        },
        "timeContextFromParameter": "Days",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "linechart"
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "1"
      },
      "customWidth": "33",
      "name": "PLE",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "MSSQL_MemoryOverview_CL\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| where TimeGenerated {Days}\r\n| summarize avg(allocated_kb_d) by type_s\r\n\r\n",
        "size": 0,
        "title": "Memory Overview ({Days:label})",
        "noDataMessage": "Sorry, no data.",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "piechart",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "allocated_kb_d",
              "formatter": 3,
              "formatOptions": {
                "palette": "magenta"
              },
              "numberFormat": {
                "unit": 3,
                "options": {
                  "style": "decimal",
                  "useGrouping": false
                }
              }
            }
          ]
        },
        "tileSettings": {
          "showBorder": false,
          "titleContent": {
            "columnMatch": "type_s",
            "formatter": 1
          },
          "leftContent": {
            "columnMatch": "allocated_kb_d",
            "formatter": 12,
            "formatOptions": {
              "palette": "auto"
            },
            "numberFormat": {
              "unit": 17,
              "options": {
                "maximumSignificantDigits": 3,
                "maximumFractionDigits": 2
              }
            }
          }
        },
        "chartSettings": {
          "yAxis": [
            "avg_allocated_kb_d"
          ],
          "seriesLabelSettings": [
            {
              "seriesName": "Andere",
              "color": "gray"
            }
          ],
          "ySettings": {
            "numberFormatSettings": {
              "unit": 3,
              "options": {
                "style": "decimal",
                "useGrouping": true,
                "maximumFractionDigits": 1
              }
            }
          }
        }
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "2"
      },
      "customWidth": "33",
      "name": "MemoryOverview",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "MSSQL_WaitPercs_CL\r\n| where TimeGenerated {Days}\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| summarize avg(Percentage_d) by WaitType_s\r\n| order by avg_Percentage_d\r\n\r\n",
        "size": 3,
        "title": "Actual Top 10 Waits Statistics (Percent)",
        "noDataMessage": "Sorry, no data.",
        "timeContext": {
          "durationMs": 172800000
        },
        "timeContextFromParameter": "Days",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "tiles",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "WaitType",
              "formatter": 1,
              "formatOptions": {}
            },
            {
              "columnMatch": "Percentage",
              "formatter": 8,
              "formatOptions": {
                "palette": "greenRed"
              },
              "numberFormat": {
                "unit": 1,
                "options": {
                  "style": "decimal",
                  "useGrouping": false
                }
              }
            }
          ],
          "labelSettings": [
            {
              "columnId": "WaitType_s",
              "label": "WaitType"
            },
            {
              "columnId": "Percentage_d",
              "label": "Percentage"
            }
          ]
        },
        "tileSettings": {
          "titleContent": {
            "columnMatch": "WaitType_s",
            "formatter": 1,
            "formatOptions": {}
          },
          "leftContent": {
            "columnMatch": "avg_Percentage_d",
            "formatter": 12,
            "formatOptions": {
              "palette": "greenRed"
            },
            "numberFormat": {
              "unit": 1,
              "options": {
                "style": "decimal",
                "useGrouping": false,
                "maximumFractionDigits": 2
              }
            }
          },
          "showBorder": true,
          "sortCriteriaField": "avg_Percentage_d",
          "sortOrderField": 2
        },
        "chartSettings": {
          "seriesLabelSettings": [
            {
              "seriesName": "PAGEIOLATCH_SH",
              "color": "greenDark"
            },
            {
              "seriesName": "ASYNC_NETWORK_IO",
              "color": "orange"
            },
            {
              "seriesName": "Other",
              "color": "pink"
            },
            {
              "seriesName": "PAGEIOLATCH_EX",
              "color": "redDark"
            },
            {
              "seriesName": "WRITELOG",
              "color": "blueDark"
            },
            {
              "seriesName": "CXPACKET",
              "color": "lightBlue"
            }
          ],
          "ySettings": {
            "numberFormatSettings": {
              "unit": 1,
              "options": {
                "style": "decimal",
                "useGrouping": true
              }
            }
          }
        }
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "2"
      },
      "customWidth": "33",
      "name": "WaitStats",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "MSSQL_Top10Statements_CL\r\n| where TimeGenerated {Days}\r\n| where PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| take 200\r\n| project TimeGenerated, last_execution_time_t, sqltext_s,exec_count_d,total_rows_d,avg_rows_d,total_logical_reads_d, avg_logical_reads_d , total_elapsed_time_d,avg_elapsed_time_d,total_cpu_time_d, avg_cpu_time_d, total_phys_reads_d, avg_phys_reads_d,total_log_writes_d, avg_log_writes_d\r\n| order by TimeGenerated, last_execution_time_t,total_elapsed_time_d desc\r\n",
        "size": 0,
        "title": "Top 10 SQL Statements ({Days:label})",
        "noDataMessage": "Sorry, no data.",
        "timeContext": {
          "durationMs": 172800000
        },
        "timeContextFromParameter": "Days",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "TimeGenerated",
              "formatter": 5,
              "formatOptions": {}
            },
            {
              "columnMatch": "last_execution_time_t",
              "formatter": 6,
              "formatOptions": {}
            },
            {
              "columnMatch": "sqltext_s",
              "formatter": 5,
              "formatOptions": {}
            },
            {
              "columnMatch": "exec_count_d",
              "formatter": 8,
              "formatOptions": {
                "palette": "grayBlue"
              },
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal",
                  "useGrouping": true
                }
              }
            },
            {
              "columnMatch": "total_rows_d",
              "formatter": 8,
              "formatOptions": {
                "palette": "grayBlue"
              },
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal",
                  "useGrouping": true
                }
              }
            },
            {
              "columnMatch": "avg_rows_d",
              "formatter": 8,
              "formatOptions": {
                "palette": "grayBlue"
              },
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal",
                  "useGrouping": true
                }
              }
            },
            {
              "columnMatch": "total_logical_reads_d",
              "formatter": 8,
              "formatOptions": {
                "palette": "grayBlue"
              },
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal",
                  "useGrouping": true
                }
              }
            },
            {
              "columnMatch": "avg_logical_reads_d",
              "formatter": 8,
              "formatOptions": {
                "palette": "grayBlue"
              },
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal",
                  "useGrouping": true
                }
              }
            },
            {
              "columnMatch": "total_elapsed_time_d",
              "formatter": 8,
              "formatOptions": {
                "palette": "yellow"
              },
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal",
                  "useGrouping": true
                }
              }
            },
            {
              "columnMatch": "avg_elapsed_time_d",
              "formatter": 8,
              "formatOptions": {
                "palette": "grayBlue"
              },
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal",
                  "useGrouping": true
                }
              }
            },
            {
              "columnMatch": "total_cpu_time_d",
              "formatter": 8,
              "formatOptions": {
                "palette": "grayBlue"
              },
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal",
                  "useGrouping": true
                }
              }
            },
            {
              "columnMatch": "avg_cpu_time_d",
              "formatter": 8,
              "formatOptions": {
                "palette": "grayBlue"
              },
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal",
                  "useGrouping": true
                }
              }
            },
            {
              "columnMatch": "total_phys_reads_d",
              "formatter": 8,
              "formatOptions": {
                "palette": "grayBlue"
              },
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal",
                  "useGrouping": true
                }
              }
            },
            {
              "columnMatch": "avg_phys_reads_d",
              "formatter": 8,
              "formatOptions": {
                "palette": "grayBlue"
              },
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal",
                  "useGrouping": true
                }
              }
            },
            {
              "columnMatch": "total_log_writes_d",
              "formatter": 8,
              "formatOptions": {
                "palette": "grayBlue"
              },
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal",
                  "useGrouping": true
                }
              }
            },
            {
              "columnMatch": "avg_log_writes_d",
              "formatter": 8,
              "formatOptions": {
                "palette": "grayBlue"
              },
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal",
                  "useGrouping": true
                }
              }
            }
          ],
          "hierarchySettings": {
            "treeType": 1,
            "groupBy": [
              "TimeGenerated"
            ],
            "expandTopLevel": true,
            "finalBy": "sqltext_s"
          },
          "labelSettings": [
            {
              "columnId": "TimeGenerated"
            },
            {
              "columnId": "last_execution_time_t",
              "label": "Last Execution"
            },
            {
              "columnId": "sqltext_s",
              "label": "SQL Statement"
            },
            {
              "columnId": "exec_count_d",
              "label": "Executions"
            },
            {
              "columnId": "total_rows_d",
              "label": "Rows (total)"
            },
            {
              "columnId": "avg_rows_d",
              "label": "Rows (avg)"
            },
            {
              "columnId": "total_logical_reads_d",
              "label": "Logical reads (total ms)"
            },
            {
              "columnId": "avg_logical_reads_d",
              "label": "Logical reads (avgms)"
            },
            {
              "columnId": "total_elapsed_time_d",
              "label": "Elapsed Time ( (total ms)"
            },
            {
              "columnId": "avg_elapsed_time_d",
              "label": "Elapsed Time ( (avg ms)"
            },
            {
              "columnId": "total_cpu_time_d",
              "label": "CPU Time (total ms)"
            },
            {
              "columnId": "avg_cpu_time_d",
              "label": "CPU Time  (avg ms)"
            },
            {
              "columnId": "total_phys_reads_d",
              "label": "Physical reads (total)"
            },
            {
              "columnId": "avg_phys_reads_d",
              "label": "Physical reads (avg)"
            },
            {
              "columnId": "total_log_writes_d",
              "label": "Writes (total)"
            },
            {
              "columnId": "avg_log_writes_d",
              "label": "Writes (avg)"
            }
          ]
        },
        "sortBy": []
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "3"
      },
      "name": "Top10Stmt",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "let LastOne = MSSQL_TableSizes_CL\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| where TimeGenerated {Days}\r\n| summarize TimeGenerated = max(TimeGenerated)\r\n| project TimeGenerated;\r\n\r\nMSSQL_TableSizes_CL\r\n| join kind=inner (LastOne) on TimeGenerated\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| project Table_s, Row_Count_d, Reserved_GB__d, Used_GB__d,BLOB_Size_GB__d\r\n| order by Reserved_GB__d\r\n| limit 12\r\n",
        "size": 3,
        "title": "Top 12 largest Tables",
        "noDataMessage": "Sorry, no data.",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "table",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Table_s",
              "formatter": 1,
              "formatOptions": {}
            },
            {
              "columnMatch": "Row_Count_d",
              "formatter": 8,
              "formatOptions": {
                "palette": "grayBlue"
              }
            },
            {
              "columnMatch": "Reserved_GB__d",
              "formatter": 8,
              "formatOptions": {
                "palette": "grayBlue"
              }
            },
            {
              "columnMatch": "Used_GB__d",
              "formatter": 8,
              "formatOptions": {
                "palette": "grayBlue"
              }
            },
            {
              "columnMatch": "BLOB_Size_GB__d",
              "formatter": 8,
              "formatOptions": {
                "palette": "grayBlue"
              }
            }
          ]
        },
        "sortBy": [],
        "tileSettings": {
          "showBorder": false
        },
        "graphSettings": {
          "type": 0
        },
        "chartSettings": {
          "seriesLabelSettings": [
            {
              "seriesName": "TotalLatency_ms__d",
              "label": "TotalLatency (ms)",
              "color": "gray"
            },
            {
              "seriesName": "ReadLatency_ms__d",
              "label": "ReadLatency (ms)",
              "color": "grayBlue"
            },
            {
              "seriesName": "WriteLatency_ms__d",
              "label": "WriteLatency (ms)",
              "color": "green"
            }
          ],
          "xSettings": {},
          "ySettings": {}
        },
        "mapSettings": {
          "locInfo": "LatLong",
          "sizeSettings": "TotalLatency_ms__d",
          "sizeAggregation": "Sum",
          "legendMetric": "TotalLatency_ms__d",
          "legendAggregation": "Sum",
          "itemColorSettings": {
            "type": "heatmap",
            "colorAggregation": "Sum",
            "nodeColorField": "TotalLatency_ms__d",
            "heatmapPalette": "greenRed"
          }
        }
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "3"
      },
      "customWidth": "50",
      "name": "TableSizes",
      "styleSettings": {
        "maxWidth": "100",
        "showBorder": true
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "MSSQL_Errorlog_CL\r\n| where PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| where Text_s startswith(\"Error:\") or Text_s has \"cachestore flush\" or Text_s startswith(\"A significant part of sql server\")\r\n| where LogDate_t {Days}\r\n| distinct LogDate_t, ProcessInfo_s, Text_s\r\n| extend IsSevere = Text_s startswith(\"Error:\")\r\n| order by LogDate_t desc\r\n| project LogDate_t, ProcessInfo_s,IsSevere, Text_s\r\n",
        "size": 4,
        "title": "Recorded problems in the Errorlog ({Days:label}).",
        "noDataMessage": "No warnings or errors for the given timeframe.",
        "noDataMessageStyle": 3,
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "LogDate_t",
              "formatter": 6,
              "formatOptions": {}
            },
            {
              "columnMatch": "IsSevere",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "true",
                    "representation": "3",
                    "text": ""
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "false",
                    "representation": "2",
                    "text": ""
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "success",
                    "text": "{0}{1}"
                  }
                ]
              }
            },
            {
              "columnMatch": "Text_s",
              "formatter": 1,
              "formatOptions": {}
            }
          ],
          "labelSettings": [
            {
              "columnId": "LogDate_t",
              "label": "Date/Time"
            },
            {
              "columnId": "ProcessInfo_s",
              "label": "Process"
            },
            {
              "columnId": "IsSevere",
              "label": "Sev.",
              "comment": "Is severe"
            },
            {
              "columnId": "Text_s",
              "label": "Message"
            }
          ]
        },
        "sortBy": []
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "4"
      },
      "name": "ErrorAnalysis",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "MSSQL_BlockingProcesses_CL\r\n| where TimeGenerated {Days}\r\n| where PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| extend status_s = replace(@\"(\\s+)$\", @\"\", status_s) \r\n| extend waitresource_s = replace(@\"(\\s+)$\", @\"\", waitresource_s) \r\n| extend hostname_s = replace(@\"(\\s+)$\", @\"\", hostname_s) \r\n| project TimeGenerated, spid_d, blocked_d, type_s, status_s, cmd_s, lastwaittype_s, waitresource_s, waittime_d, cpu_d, ecid_d, dbid_d, physical_io_d, memusage_d, kpid_d, hostname_s, program_name_s, sql_handle_s\r\n| take 200\r\n\r\n\r\n\r\n",
        "size": 0,
        "title": "Blocking Processes ({Days:label})",
        "noDataMessage": "No data.",
        "timeContext": {
          "durationMs": 172800000
        },
        "timeContextFromParameter": "Days",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "table",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "TimeGenerated",
              "formatter": 5,
              "formatOptions": {}
            },
            {
              "columnMatch": "blocked_d",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "0",
                    "representation": "3",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "success",
                    "text": "{0}{1}"
                  }
                ]
              }
            },
            {
              "columnMatch": "type_s",
              "formatter": 5,
              "formatOptions": {}
            },
            {
              "columnMatch": "status_s",
              "formatter": 1,
              "formatOptions": {}
            }
          ],
          "hierarchySettings": {
            "treeType": 1,
            "groupBy": [
              "TimeGenerated"
            ],
            "expandTopLevel": true,
            "finalBy": "type_s"
          }
        }
      },
      "conditionalVisibilities": [
        {
          "parameterName": "selectedTab",
          "comparison": "isEqualTo",
          "value": "4"
        },
        {
          "parameterName": "BlockingTableExists",
          "comparison": "isNotEqualTo",
          "value": ""
        }
      ],
      "name": "Blocking",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "let LastOne = MSSQL_AOOverview_CL\r\n| where TimeGenerated {Days} and PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| summarize TimeGenerated = max(TimeGenerated)\r\n| project TimeGenerated;\r\n\r\nMSSQL_AOOverview_CL\r\n| join kind=inner (LastOne) on TimeGenerated\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| project replica_server_s, replica_role_s, replica_loc_s, sync_state_s, ag_name_s, avail_mode_s, conn_state_s, db_name_s, sec_behind_d, redoqueue_sz_d, sendqueue_sz_d, last_hardnd_tm_t, last_hardnd_lsn_s\r\n| order by replica_server_s asc\r\n\r\n",
        "size": 3,
        "title": "AlwaysOn Overview",
        "noDataMessage": "No Data.",
        "timeContext": {
          "durationMs": 86400000
        },
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "5"
      },
      "name": "AOOverview",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "let LastOne = MSSQL_AOWaitstats_CL\r\n| where TimeGenerated {Days} and PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| summarize TimeGenerated = max(TimeGenerated)\r\n| project TimeGenerated;\r\n\r\nMSSQL_AOWaitstats_CL\r\n| join kind=inner (LastOne) on TimeGenerated\r\n| where PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| project WaitType_s, Percentage_d, WaitCount_d, Wait_S_d, AvgWait_S_d,Resource_S_d, AvgRes_S_d, Signal_S_d, AvgSig_S_d, TimeGenerated\r\n| order by Percentage_d desc",
        "size": 3,
        "title": "AlwaysOn Waitstats",
        "noDataMessage": "No data.",
        "timeContext": {
          "durationMs": 86400000
        },
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "table",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Percentage_d",
              "formatter": 4,
              "formatOptions": {
                "max": 100,
                "palette": "orange"
              },
              "numberFormat": {
                "unit": 1,
                "options": {
                  "style": "decimal",
                  "useGrouping": false,
                  "minimumFractionDigits": 2,
                  "maximumFractionDigits": 2
                }
              }
            },
            {
              "columnMatch": "TimeGenerated",
              "formatter": 5
            }
          ],
          "labelSettings": [
            {
              "columnId": "WaitType_s",
              "label": "Waitytype"
            },
            {
              "columnId": "Percentage_d",
              "label": "Percent"
            },
            {
              "columnId": "WaitCount_d",
              "label": "Waits (#)"
            },
            {
              "columnId": "Wait_S_d",
              "label": "Waits (sec)"
            },
            {
              "columnId": "AvgWait_S_d",
              "label": "Waits (avg. sec)"
            },
            {
              "columnId": "Resource_S_d",
              "label": "Resource Wait (sec)"
            },
            {
              "columnId": "AvgRes_S_d",
              "label": "Resource Wait (avg. sec)"
            },
            {
              "columnId": "Signal_S_d",
              "label": "Signal Waits (sec)"
            },
            {
              "columnId": "AvgSig_S_d",
              "label": "Signalwait (avg. sec)"
            },
            {
              "columnId": "TimeGenerated"
            }
          ]
        }
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "5"
      },
      "name": "AOWaitStats",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "let LastOne = MSSQL_AOFailovers_CL\r\n| where TimeGenerated {Days} and PROVIDER_INSTANCE_s == \"{Provider}\"\r\n| summarize TimeGenerated = max(TimeGenerated)\r\n| project TimeGenerated;\r\n\r\nMSSQL_AOFailovers_CL\r\n| join kind=inner (LastOne) on TimeGenerated\r\n| where PROVIDER_INSTANCE_s == '{Provider}'\r\n| project server_name_s, timestamp_t, Message\r\n\r\n",
        "size": 3,
        "title": "AlwaysOn Failovers",
        "noDataMessage": "No data.",
        "timeContext": {
          "durationMs": 86400000
        },
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "5"
      },
      "name": "AOFailovers",
      "styleSettings": {
        "showBorder": true
      }
    }
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}