{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "f1acf9ad-0350-4a76-816f-a92fc5c72ccd",
            "version": "KqlParameterItem/1.0",
            "name": "HideWorkspace",
            "label": "Hide Workspace picker",
            "type": 2,
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[\"True\", \"False\"]",
            "value": "False"
          },
          {
            "id": "b6d18465-b67f-4db4-aea5-242f17bb3da5",
            "version": "KqlParameterItem/1.0",
            "name": "HideTimeRange",
            "label": "Hide TimeRange Picker",
            "type": 2,
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[\"True\", \"False\"]",
            "value": "False"
          },
          {
            "id": "04a653b0-1e8e-4993-abd2-c11fb7ee7888",
            "version": "KqlParameterItem/1.0",
            "name": "HideFeatureFlag",
            "label": "Hide Feature Flag Picker",
            "type": 2,
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[\"True\", \"False\"]",
            "value": "False"
          },
          {
            "id": "bfa6c2ac-b5b6-4bd8-9bf8-27130e6f99fb",
            "version": "KqlParameterItem/1.0",
            "name": "HideExperiment",
            "label": "Hide Experiment Picker",
            "type": 2,
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[\"True\", \"False\"]",
            "value": "False"
          },
          {
            "id": "8457ab9c-f249-4f3a-8a65-a0ed296932df",
            "version": "KqlParameterItem/1.0",
            "name": "HideLabel",
            "label": "Hide Label picker",
            "type": 2,
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": []
            },
            "jsonData": "[\"True\", \"False\"]",
            "value": "False"
          },
          {
            "id": "d9ed57df-03d4-4827-8ef3-cb905764b343",
            "version": "KqlParameterItem/1.0",
            "name": "AppConfigEndpoint",
            "label": "App Config Endpoint",
            "type": 1,
            "isHiddenWhenLocked": true
          }
        ],
        "style": "above",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "customWidth": "100",
      "name": "Parameters - Show/Hide",
      "styleSettings": {
        "margin": "5px"
      }
    },
    {
      "type": 1,
      "content": {
        "json": "If no analysis result report is displayed below, please verify that the correct [Azure subscription](https://learn.microsoft.com/en-us/azure/azure-portal/set-preferences) is selected.",
        "style": "info"
      },
      "name": "text - 8"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "113c3ea5-8b94-4949-b294-597916807477",
            "version": "KqlParameterItem/1.0",
            "name": "Workspace",
            "label": "Log Analytics workspace",
            "type": 5,
            "description": "Select the log analytics workspace containing your application experiment data",
            "isRequired": true,
            "query": "where type == \"microsoft.operationalinsights/workspaces\"\r\n| project value = id, label = id, selected = false, group = resourceGroup",
            "crossComponentResources": [
              "value::selected"
            ],
            "typeSettings": {
              "additionalResourceOptions": []
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          }
        ],
        "style": "above",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "conditionalVisibility": {
        "parameterName": "HideWorkspace",
        "comparison": "isNotEqualTo",
        "value": "True"
      },
      "customWidth": "0",
      "name": "Parameters - Select law",
      "styleSettings": {
        "margin": "5px"
      }
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "dd72945c-246e-427f-9031-20a486df0a9a",
            "version": "KqlParameterItem/1.0",
            "name": "TimeRange",
            "label": "Time range",
            "type": 4,
            "description": "Select a time window to search for experiment analyses",
            "isRequired": true,
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 2592000000
                },
                {
                  "durationMs": 7776000000
                }
              ],
              "allowCustom": true
            },
            "value": {
              "durationMs": 2592000000
            }
          }
        ],
        "style": "above",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "conditionalVisibility": {
        "parameterName": "HideTimeRange",
        "comparison": "isNotEqualTo",
        "value": "True"
      },
      "customWidth": "0",
      "name": "Parameters - Select time range",
      "styleSettings": {
        "margin": "5px"
      }
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "parameters": [
          {
            "id": "151387c1-e6af-4fca-b9d2-540d2d0ac8ed",
            "version": "KqlParameterItem/1.0",
            "name": "FeatureName",
            "label": "âœ¨Feature flag",
            "type": 2,
            "description": "Select the feature flag to analyze",
            "isRequired": true,
            "query": "OEWExperimentScorecards\r\n| where FeatureFlagReference startswith '{AppConfigEndpoint}'\r\n| summarize LatestScorecard=max(TimeGenerated) by FeatureName\r\n| order by LatestScorecard desc, FeatureName asc\r\n| project FeatureName",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          }
        ],
        "style": "above",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
      "conditionalVisibility": {
        "parameterName": "HideFeatureFlag",
        "comparison": "isNotEqualTo",
        "value": "True"
      },
      "customWidth": "0",
      "name": "Parameters - Select feature flag",
      "styleSettings": {
        "margin": "5px"
      }
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "parameters": [
          {
            "id": "2b2553e9-e276-4a7e-8820-b30b7beca46e",
            "version": "KqlParameterItem/1.0",
            "name": "Label",
            "type": 2,
            "isRequired": true,
            "query": "OEWExperimentScorecards\n| where TimeGenerated between ({TimeRange:start} .. {TimeRange:end})\n| where FeatureName == '{FeatureName}'\n| where FeatureFlagReference startswith '{AppConfigEndpoint}'\n| summarize LatestScorecard=max(TimeGenerated) by Label\n| order by LatestScorecard desc, Label asc\n| project Label = iff(Label == \"\", \"(No label)\", Label)",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 2592000000
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces",
            "value": null
          }
        ],
        "style": "above",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "conditionalVisibility": {
        "parameterName": "HideLabel",
        "comparison": "isNotEqualTo",
        "value": "True"
      },
      "customWidth": "0",
      "name": "HideLabel",
      "styleSettings": {
        "margin": "5px",
        "padding": "0"
      }
    },
        {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "parameters": [
          {
            "id": "89e7fe9d-309c-4d96-adb3-65699d418777",
            "version": "KqlParameterItem/1.0",
            "name": "AllocationId",
            "label": "ðŸ”¬Experiment",
            "type": 2,
            "description": "A new experiment starts when the experiment configuration changes",
            "isRequired": true,
            "query": "OEWExperimentScorecards\r\n| where FeatureName == '{FeatureName}'\r\n| where FeatureFlagReference startswith '{AppConfigEndpoint}'\r\n| where isempty('{Label}') or Label == iff('{Label}' == '(No label)', '', '{Label}')\r\n| summarize EarliestAnalysisTime = min(AnalysisStartTime) by AllocationId\r\n| order by EarliestAnalysisTime asc\r\n| extend Iteration = row_number()\r\n| order by Iteration desc\r\n| project\r\n    value = AllocationId,\r\n    label = strcat('Iteration ', Iteration, ' (', AllocationId, ')'),\r\n    selected = row_number() == 1",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "typeSettings": {
              "additionalResourceOptions": [],
              "defaultItemsText": "Latest"
            },
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          }
        ],
        "style": "above",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
      "conditionalVisibility": {
        "parameterName": "HideExperiment",
        "comparison": "isNotEqualTo",
        "value": "True"
      },
      "customWidth": "0",
      "name": "Parameters - Select experiment",
      "styleSettings": {
        "margin": "5px"
      }
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "parameters": [
          {
            "id": "773a3f34-a30d-4bc8-adae-31a0471b3e34",
            "version": "KqlParameterItem/1.0",
            "name": "ScorecardId",
            "label": "ðŸ“…Analysis period",
            "type": 2,
            "description": "Experiment data accumulates over time. Experiment analysis provides regular snapshots of the metric results.",
            "isRequired": true,
            "query": "OEWExperimentScorecards\r\n| where FeatureFlagReference startswith '{AppConfigEndpoint}'\r\n| where FeatureName == '{FeatureName}' and AllocationId == '{AllocationId}'\r\n| where isempty('{Label}') or Label == iff('{Label}' == '(No label)', '', '{Label}')\r\n| project ScorecardId, TimeGenerated, AnalysisStartTime, AnalysisEndTime\r\n| summarize arg_max(TimeGenerated, *) by ScorecardId\r\n| summarize arg_max(TimeGenerated, *) by AnalysisEndTime\r\n| order by AnalysisEndTime desc\r\n| project\r\n    value = ScorecardId,\r\n    label = strcat(\r\n        round((AnalysisEndTime - AnalysisStartTime) / 1d, 1),\r\n        \" days (\",\r\n        format_datetime(AnalysisStartTime, 'MM/dd/yyyy HH:mm'),\r\n        ' - ',\r\n        format_datetime(AnalysisEndTime, 'MM/dd/yyyy HH:mm'),\r\n        ' UTC)'\r\n    ),\r\n    selected = row_number() == 1",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "typeSettings": {
              "additionalResourceOptions": [],
              "defaultItemsText": "Latest"
            },
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "73bb864b-2b6f-46fd-bfcb-4a2b587e675b",
            "version": "KqlParameterItem/1.0",
            "name": "IsAnySrm",
            "label": "SRM check",
            "type": 10,
            "description": "Indicates whether any variant exhibits an SRM",
            "isRequired": true,
            "query": "let srm_check = OEWExperimentScorecards\r\n| where ScorecardId == '{ScorecardId}'\r\n| summarize arg_max(TimeGenerated, *)\r\n| project Variants = Insights.Assignment\r\n| mv-expand VariantMetadata = Variants\r\n| where not(tobool(VariantMetadata.IsControlVariant))\r\n| project IsSrm = toreal(VariantMetadata.SampleRatioMismatchPValue) <= 0.0005\r\n| summarize IsAnySrm = max(IsSrm)\r\n;\r\ndatatable(value: bool, label: string) [\r\n    false, 'Pass',\r\n    true, 'Fail'\r\n]\r\n| extend selected = value == toscalar(srm_check)",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          }
        ],
        "style": "above",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "customWidth": "0",
      "name": "Parameters - Select analysis",
      "styleSettings": {
        "margin": "5px"
      }
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Summary of variants",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let expanded_variants = OEWExperimentScorecards\r\n| where ScorecardId == '{ScorecardId}'\r\n| summarize arg_max(TimeGenerated, *)\r\n| project Variants = Insights.Assignment\r\n| where array_length(Variants) > 0\r\n| mv-expand VariantMetadata = Variants;\r\nlet control_assignment_user_count = toscalar( expanded_variants\r\n| where tobool(VariantMetadata.IsControlVariant)\r\n| take 1\r\n| project VariantMetadata.AssignmentUserCount\r\n);\r\nlet variants = expanded_variants\r\n| project\r\n    Variant = tostring(VariantMetadata.Variant),\r\n    Type = iff(tobool(VariantMetadata.IsControlVariant), \"Control\", \"Treatment\"),\r\n    Allocation = toreal(VariantMetadata.VariantAssignmentPercentage),\r\n    Assignment = tolong(VariantMetadata.AssignmentUserCount),\r\n    DataQuality = case(\r\n        tobool(VariantMetadata.IsControlVariant), 'n/a',\r\n        tolong(VariantMetadata.AssignmentUserCount) + control_assignment_user_count <= 13, 'Too few samples',\r\n        toreal(VariantMetadata.SampleRatioMismatchPValue) <= 0.0005, 'SRM check: Fail',\r\n        'SRM check: Pass'\r\n    )\r\n| order by Type asc, Allocation desc;\r\nlet pvalue_bh = OEWExperimentScorecardMetricPairs\r\n| where ScorecardId ==  '{ScorecardId}'\r\n| summarize arg_max(TimeGenerated, *) by ScorecardId, MetricId, TreatmentVariant, ControlVariant // de-dupe\r\n| where not(set_has_element(MetricCategories, '__Internal__')) and isnotempty(MetricId)\r\n| where TreatmentEffect !in ('Zero samples', 'Too few samples')\r\n| where TreatmentStandardErrorNormalized > 0 and ControlStandardErrorNormalized > 0 and PValue < 1 and PValue >= 0;\r\nlet N = pvalue_bh | summarize N=count() by TreatmentVariant;\r\nlet variants_tea = pvalue_bh\r\n| join kind=leftouter N on TreatmentVariant\r\n| sort by TreatmentVariant asc, PValue asc\r\n| extend rank = row_number(1, prev(TreatmentVariant) != TreatmentVariant)\r\n| extend pvalue_adjusted_initial = PValue * N / rank\r\n| summarize pvalue_tea = min(pvalue_adjusted_initial) by TreatmentVariant\r\n| project Variant = TreatmentVariant, MetricSummary = case(pvalue_tea <= 0.05, 'Change detected', 'Change undetected');\r\nvariants\r\n| join kind=leftouter variants_tea on Variant\r\n| project-away Variant1\r\n| extend MetricSummary = iff(isempty(MetricSummary), 'Change undetected', MetricSummary)\r\n| extend MetricSummary  = iff(Type == 'Control', 'n/a', MetricSummary)",
              "size": 3,
              "showAnalytics": true,
              "noDataMessage": "Zero variants were found in this experiment analysis",
              "noDataMessageStyle": 4,
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Allocation",
                    "formatter": 0,
                    "numberFormat": {
                      "unit": 1,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false
                      }
                    }
                  },
                  {
                    "columnMatch": "Assignment",
                    "formatter": 0,
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "useGrouping": true
                      }
                    }
                  },
                  {
                    "columnMatch": "DataQuality",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "samples",
                          "representation": "warning",
                          "text": "{0}{1}",
                          "tooltipFormat": {
                            "tooltip": "Insufficient observations to detect sample ratio mismatch."
                          }
                        },
                        {
                          "operator": "contains",
                          "thresholdValue": "Pass",
                          "representation": "success",
                          "text": "{0}{1}",
                          "tooltipFormat": {
                            "tooltip": "No sample ratio mismatch detected."
                          }
                        },
                        {
                          "operator": "contains",
                          "thresholdValue": "Fail",
                          "representation": "critical",
                          "text": "{0}{1}",
                          "tooltipFormat": {
                            "tooltip": "Sample ratio mismatch detected."
                          }
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "MetricSummary",
                    "formatter": 18,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch",
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                            "operator": "==",
                            "thresholdValue": "Change detected",
                            "representation": "1",
                            "text": "{0}{1}",
                            "tooltipFormat": {
                              "tooltip": "Observed metric movements are inconsistent with statistical noise."
                            }
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Change undetected",
                          "representation": "unknown",
                          "text": "{0}{1}",
                          "tooltipFormat": {
                            "tooltip": "Observed metric movements are consistent with statistical noise. Either the experiment is underpowered or had limited impact on the metrics."
                          }
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "Variant",
                    "label": "Variant ðŸ’Š"
                  },
                  {
                    "columnId": "Assignment",
                    "label": "Assigned users"
                  },
                  {
                    "columnId": "DataQuality",
                    "label": "Data quality"
                  },
                  {
                    "columnId": "MetricSummary",
                    "label": "Treatment effect"
                  }
                ]
              }
            },
            "name": "Variants table"
          }
        ],
        "exportParameters": true
      },
      "conditionalVisibility": {
        "parameterName": "ScorecardId",
        "comparison": "isNotEqualTo"
      },
      "name": "Variants",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Metric results",
        "items": [
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "e4a559fa-7d55-42b6-bef5-14cbd4807326",
                  "version": "KqlParameterItem/1.0",
                  "name": "SelectedTreatments",
                  "label": "Treatment variants",
                  "type": 2,
                  "isRequired": true,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "OEWExperimentScorecardMetricPairs\r\n| where ScorecardId == \"{ScorecardId}\"\r\n| summarize arg_max(TimeGenerated, *) by ScorecardId, MetricId, TreatmentVariant, ControlVariant // de-dupe\r\n| where isnotempty(TreatmentVariant)\r\n| distinct TreatmentVariant",
                  "crossComponentResources": [
                    "{Workspace}"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "selectAllValue": "",
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "defaultValue": "value::all",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "671a73a2-6028-4d75-a2a8-397ffd7c9140",
                  "version": "KqlParameterItem/1.0",
                  "name": "SelectedCategories",
                  "label": "Metric categories",
                  "type": 2,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "OEWExperimentScorecardMetricPairs\r\n| where ScorecardId == \"{ScorecardId}\"\r\n| summarize arg_max(TimeGenerated, *) by ScorecardId, MetricId, TreatmentVariant, ControlVariant // de-dupe\r\n| summarize MetricCategories = array_sort_asc(make_set(iff(array_length(MetricCategories) == 0, dynamic([\"Uncategorized\"]), MetricCategories)))\r\n| mv-expand MetricCategory = MetricCategories\r\n| filter MetricCategory != '__Internal__'\r\n| project MetricCategory",
                  "crossComponentResources": [
                    "{Workspace}"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "selectAllValue": "[]",
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "defaultValue": "value::all",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "value": [
                    "value::all"
                  ]
                },
                {
                  "id": "ec86029e-4f37-4c83-b003-6828b94e70d8",
                  "version": "KqlParameterItem/1.0",
                  "name": "SelectedMetrics",
                  "label": "Metrics",
                  "type": 2,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "let selected_categories = dynamic([{SelectedCategories}]);\r\nOEWExperimentScorecardMetricPairs\r\n| where ScorecardId == \"{ScorecardId}\"\r\n| summarize arg_max(TimeGenerated, *) by ScorecardId, MetricId, TreatmentVariant, ControlVariant // de-dupe\r\n| where not(set_has_element(MetricCategories, '__Internal__')) and isnotempty(MetricId)\r\n| extend MetricCategories = iff(array_length(MetricCategories) == 0 or isempty(MetricCategories), dynamic([\"Uncategorized\"]), MetricCategories)\r\n| where array_length(selected_categories) == 0 or array_length(set_intersect(MetricCategories, selected_categories)) > 0\r\n| project MetricId, MetricDisplayName, MetricCategories\r\n| mv-expand MetricCategories\r\n| extend MetricCategory = tostring(MetricCategories)\r\n| distinct MetricId, MetricDisplayName, MetricCategory\r\n| order by MetricCategory asc, MetricDisplayName asc\r\n| project value = MetricId, label = MetricDisplayName, selected = false, group = MetricCategory",
                  "crossComponentResources": [
                    "{Workspace}"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "selectAllValue": "",
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "defaultValue": "value::all",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "7d7c98e9-833f-4695-87a2-c02df6aa8d90",
                  "version": "KqlParameterItem/1.0",
                  "name": "MinimalConfidence",
                  "label": "Confidence",
                  "type": 10,
                  "description": "Select the minimum strength of evidence for the treatment effect",
                  "isRequired": true,
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "jsonData": "[{\"label\": \"High\", \"value\": \"High\"}, {\"label\": \"Marginal\", \"value\": \"Marginal\"}, {\"label\": \"All metrics\", \"value\": \"All metrics\", \"selected\": true}]",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                },
                {
                  "id": "5a14e1a1-a69f-4ec1-8a23-fb2624bfd4d9",
                  "version": "KqlParameterItem/1.0",
                  "name": "IsMultiTreatment",
                  "label": "Multiple treatments",
                  "type": 1,
                  "description": "Determines whether metric results are displayed as a hierarchy",
                  "isRequired": true,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "SelectedTreatments",
                        "operator": "notContains",
                        "rightValType": "static",
                        "rightVal": ",",
                        "resultValType": "static",
                        "resultVal": "false"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "resultValType": "static",
                        "resultVal": "true"
                      }
                    }
                  ]
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "Parameters - Metric filters"
          },
          {
            "type": 1,
            "content": {
              "json": "This experiment exhibits a Sample Ratio Mismatch (SRM) between the treatment and control groups. SRM can bias the results of an experiment. Ensure the experiment is properly configured and interpret the metric results with caution.",
              "style": "error"
            },
            "conditionalVisibility": {
              "parameterName": "IsAnySrm",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "SRM warning"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "OEWExperimentScorecardMetricPairs\r\n| where ScorecardId == '{ScorecardId}'\r\n| summarize arg_max(TimeGenerated, *) by ScorecardId, MetricId, TreatmentVariant, ControlVariant // de-dupe\r\n| where not(set_has_element(MetricCategories, '__Internal__')) and isnotempty(MetricId)\r\n| where MetricId in ({SelectedMetrics})\r\n| project\r\n    MetricDisplayName,\r\n    TreatmentVariant = strcat(TreatmentVariant, ' ðŸ’Š'),\r\n    TreatmentEffect,\r\n    Confidence = case(\r\n        TreatmentEffect in ('Zero samples', 'Too few samples'), '',\r\n        PValue <= 0.001, 'High',\r\n        PValue <= 0.05, 'Marginal',\r\n        PValue > 0.05, 'Not stat sig',\r\n        'Unknown'\r\n    ),\r\n    PValue = case(\r\n        PValue == 0, 'â‰ˆ0',\r\n        PValue < 0.001, strcat('<1e', tostring(toint(ceiling(log10(PValue))))),\r\n        tostring(round(PValue, 3))\r\n    ),\r\n    RelativeDifference,\r\n    ControlMetricValue,\r\n    TreatmentMetricValue,\r\n    Details = bag_pack(\r\n        \"MetricId\", MetricId,\r\n        \"MetricDisplayName\", MetricDisplayName,\r\n        \"MetricDescription\", MetricDescription,\r\n        \"MetricType\", MetricType,\r\n        \"MetricLifecycle\", MetricLifecycle,\r\n        \"MetricCategories\", strcat_array(MetricCategories, ', '),\r\n        \"DesiredDirection\", DesiredDirection,\r\n        \"ControlVariant\", ControlVariant,\r\n        \"ControlCount\", ControlCount,\r\n        \"ControlMetricValue\", ControlMetricValue,\r\n        \"ControlMetricValueNormalized\", ControlMetricValueNormalized,\r\n        \"ControlStandardErrorNormalized\", ControlStandardErrorNormalized,\r\n        \"TreatmentVariant\", TreatmentVariant,\r\n        \"TreatmentCount\", TreatmentCount,\r\n        \"TreatmentMetricValue\", TreatmentMetricValue,\r\n        \"TreatmentMetricValueNormalized\", TreatmentMetricValueNormalized,\r\n        \"TreatmentStandardErrorNormalized\", TreatmentStandardErrorNormalized,\r\n        \"RelativeDifference\", RelativeDifference,\r\n        \"PValue\", PValue,\r\n        \"TreatmentEffect\", TreatmentEffect\r\n    )\r\n| where case(\r\n    '{MinimalConfidence}' == 'High', Confidence == 'High',\r\n    '{MinimalConfidence}' == 'Marginal', Confidence in ('High', 'Marginal'),\r\n    true\r\n)\r\n| order by MetricDisplayName asc\r\n",
              "size": 2,
              "showAnalytics": true,
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "$gen_group",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "70ch"
                    }
                  },
                  {
                    "columnMatch": "MetricDisplayName",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "TreatmentVariant",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "TreatmentEffect",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Improved",
                          "representation": "success",
                          "text": "{0}{1}",
                          "tooltipFormat": {
                            "tooltip": "Statistically significant and matches the desired direction"
                          }
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Degraded",
                          "representation": "4",
                          "text": "{0}{1}",
                          "tooltipFormat": {
                            "tooltip": "Statistically significant and against the desired direction"
                          }
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Changed",
                          "representation": "1",
                          "text": "{0}{1}",
                          "tooltipFormat": {
                            "tooltip": "Statistically significant and the desired direction is neutral"
                          }
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Inconclusive",
                          "representation": "unknown",
                          "text": "{0}{1}",
                          "tooltipFormat": {
                            "tooltip": "Not statistically significant"
                          }
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Too few samples",
                          "representation": "warning",
                          "text": "{0}{1}",
                          "tooltipFormat": {
                            "tooltip": "Insufficient observations to determine statistical significance"
                          }
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Zero samples",
                          "representation": "2",
                          "text": "{0}{1}",
                          "tooltipFormat": {
                            "tooltip": "Zero observations might indicate a problem with the metric definition or data collection"
                          }
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "Confidence",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "High",
                          "representation": "DoubleChevron",
                          "text": "{0}{1}",
                          "tooltipFormat": {
                            "tooltip": "p-value: [\"PValue\"]"
                          }
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Marginal",
                          "representation": "CaretUp",
                          "text": "{0}{1}",
                          "tooltipFormat": {
                            "tooltip": "p-value: [\"PValue\"]"
                          }
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Not stat sig",
                          "representation": "Subtract",
                          "text": "{0}{1}",
                          "tooltipFormat": {
                            "tooltip": "p-value: [\"PValue\"]"
                          }
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "PValue",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "RelativeDifference",
                    "formatter": 2,
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "percent",
                        "maximumFractionDigits": 1
                      }
                    },
                    "tooltipFormat": {
                      "tooltip": "For count and sum metrics, this calculation accounts for unequal variant allocations."
                    }
                  },
                  {
                    "columnMatch": "ControlMetricValue",
                    "formatter": 0,
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "useGrouping": true,
                        "maximumSignificantDigits": 4
                      },
                      "emptyValCustomText": "--"
                    }
                  },
                  {
                    "columnMatch": "TreatmentMetricValue",
                    "formatter": 0,
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "useGrouping": true,
                        "maximumSignificantDigits": 4
                      },
                      "emptyValCustomText": "--"
                    }
                  },
                  {
                    "columnMatch": "Details",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "CellDetails",
                      "linkLabel": "Details",
                      "linkIsContextBlade": true
                    }
                  },
                  {
                    "columnMatch": "$gen_group",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "70ch"
                    }
                  }
                ],
                "hierarchySettings": {
                  "treeType": 1,
                  "groupBy": [
                    "MetricDisplayName"
                  ],
                  "expandTopLevel": true,
                  "finalBy": "TreatmentVariant"
                },
                "labelSettings": [
                  {
                    "columnId": "MetricDisplayName",
                    "label": "Metric"
                  },
                  {
                    "columnId": "TreatmentEffect",
                    "label": "Treatment effect"
                  },
                  {
                    "columnId": "RelativeDifference",
                    "label": "Effect estimate"
                  },
                  {
                    "columnId": "ControlMetricValue",
                    "label": "Control value"
                  },
                  {
                    "columnId": "TreatmentMetricValue",
                    "label": "Treatment value"
                  }
                ]
              }
            },
            "conditionalVisibility": {
              "parameterName": "IsMultiTreatment",
              "comparison": "isEqualTo",
              "value": "true"
            },
            "name": "Metric results table (multiple treatments)"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let AllowedMetrics = dynamic([ {SelectedMetrics} ]);\r\nOEWExperimentScorecardMetricPairs\r\n| where ScorecardId == '{ScorecardId}'\r\n| summarize arg_max(TimeGenerated, *) by ScorecardId, MetricId, TreatmentVariant, ControlVariant // de-dupe\r\n| where not(set_has_element(MetricCategories, '__Internal__')) and isnotempty(MetricId)\r\n| where MetricId in (AllowedMetrics)\r\n| project\r\n    MetricDisplayName,\r\n    TreatmentVariant = strcat(TreatmentVariant, ' ðŸ’Š'),\r\n    TreatmentEffect,\r\n    Confidence = case(\r\n        TreatmentEffect in ('Zero samples', 'Too few samples'), '',\r\n        PValue <= 0.001, 'High',\r\n        PValue <= 0.05, 'Marginal',\r\n        PValue > 0.05, 'Not stat sig',\r\n        'Unknown'\r\n    ),\r\n    PValue = case(\r\n        PValue == 0, 'â‰ˆ0',\r\n        PValue < 0.001, strcat('<1e', tostring(toint(ceiling(log10(PValue))))),\r\n        tostring(round(PValue, 3))\r\n    ),\r\n    RelativeDifference,\r\n    ControlMetricValue,\r\n    TreatmentMetricValue,\r\n    Details = bag_pack(\r\n        \"MetricId\", MetricId,\r\n        \"MetricDisplayName\", MetricDisplayName,\r\n        \"MetricDescription\", MetricDescription,\r\n        \"MetricType\", MetricType,\r\n        \"MetricLifecycle\", MetricLifecycle,\r\n        \"MetricCategories\", strcat_array(MetricCategories, ', '),\r\n        \"DesiredDirection\", DesiredDirection,\r\n        \"ControlVariant\", ControlVariant,\r\n        \"ControlCount\", ControlCount,\r\n        \"ControlMetricValue\", ControlMetricValue,\r\n        \"ControlMetricValueNormalized\", ControlMetricValueNormalized,\r\n        \"ControlStandardErrorNormalized\", ControlStandardErrorNormalized,\r\n        \"TreatmentVariant\", TreatmentVariant,\r\n        \"TreatmentCount\", TreatmentCount,\r\n        \"TreatmentMetricValue\", TreatmentMetricValue,\r\n        \"TreatmentMetricValueNormalized\", TreatmentMetricValueNormalized,\r\n        \"TreatmentStandardErrorNormalized\", TreatmentStandardErrorNormalized,\r\n        \"RelativeDifference\", RelativeDifference,\r\n        \"PValue\", PValue,\r\n        \"TreatmentEffect\", TreatmentEffect\r\n    )\r\n| where case(\r\n    '{MinimalConfidence}' == 'High', Confidence == 'High',\r\n    '{MinimalConfidence}' == 'Marginal', Confidence in ('High', 'Marginal'),\r\n    true\r\n)\r\n| order by MetricDisplayName asc\r\n",
              "size": 2,
              "showAnalytics": true,
              "noDataMessage": "No metrics found. To learn how to add them, see https://aka.ms/exp3p/metrics",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "TreatmentVariant",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "TreatmentEffect",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Improved",
                          "representation": "success",
                          "text": "{0}{1}",
                          "tooltipFormat": {
                            "tooltip": "Statistically significant and matches the desired direction"
                          }
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Degraded",
                          "representation": "4",
                          "text": "{0}{1}",
                          "tooltipFormat": {
                            "tooltip": "Statistically significant and against the desired direction"
                          }
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Changed",
                          "representation": "1",
                          "text": "{0}{1}",
                          "tooltipFormat": {
                            "tooltip": "Statistically significant and the desired direction is neutral"
                          }
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Inconclusive",
                          "representation": "unknown",
                          "text": "{0}{1}",
                          "tooltipFormat": {
                            "tooltip": "Not statistically significant"
                          }
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Too few samples",
                          "representation": "warning",
                          "text": "{0}{1}",
                          "tooltipFormat": {
                            "tooltip": "Insufficient observations to determine statistical significance"
                          }
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Zero samples",
                          "representation": "2",
                          "text": "{0}{1}",
                          "tooltipFormat": {
                            "tooltip": "Zero observations might indicate a problem with the metric definition or data collection"
                          }
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "Confidence",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "High",
                          "representation": "DoubleChevron",
                          "text": "{0}{1}",
                          "tooltipFormat": {
                            "tooltip": "p-value: [\"PValue\"]"
                          }
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Marginal",
                          "representation": "CaretUp",
                          "text": "{0}{1}",
                          "tooltipFormat": {
                            "tooltip": "p-value: [\"PValue\"]"
                          }
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Not stat sig",
                          "representation": "Subtract",
                          "text": "{0}{1}",
                          "tooltipFormat": {
                            "tooltip": "p-value: [\"PValue\"]"
                          }
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Blank",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "PValue",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "RelativeDifference",
                    "formatter": 2,
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "percent",
                        "maximumFractionDigits": 1
                      }
                    },
                    "tooltipFormat": {
                      "tooltip": "For count and sum metrics, this calculation accounts for unequal variant allocations."
                    }
                  },
                  {
                    "columnMatch": "ControlMetricValue",
                    "formatter": 0,
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "useGrouping": true,
                        "maximumSignificantDigits": 4
                      },
                      "emptyValCustomText": "--"
                    }
                  },
                  {
                    "columnMatch": "TreatmentMetricValue",
                    "formatter": 0,
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal",
                        "useGrouping": true,
                        "maximumSignificantDigits": 4
                      },
                      "emptyValCustomText": "--"
                    }
                  },
                  {
                    "columnMatch": "Details",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "CellDetails",
                      "linkLabel": "Details",
                      "linkIsContextBlade": true
                    }
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "MetricDisplayName",
                    "label": "Metric"
                  },
                  {
                    "columnId": "TreatmentEffect",
                    "label": "Treatment effect"
                  },
                  {
                    "columnId": "RelativeDifference",
                    "label": "Effect estimate"
                  },
                  {
                    "columnId": "ControlMetricValue",
                    "label": "Control value"
                  },
                  {
                    "columnId": "TreatmentMetricValue",
                    "label": "Treatment value"
                  }
                ]
              }
            },
            "conditionalVisibility": {
              "parameterName": "IsMultiTreatment",
              "comparison": "isEqualTo",
              "value": "false"
            },
            "name": "Metric results table (single treatments)"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "ScorecardId",
        "comparison": "isNotEqualTo"
      },
      "name": "Metric results",
      "styleSettings": {
        "showBorder": true
      }
    }
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}